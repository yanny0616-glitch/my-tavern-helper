{"version":3,"file":"index.js","mappings":"4EAAA,MAAM,EAA+BA,ICE/BC,EAAa,CAAEC,MAAO,YACtBC,EAAa,CAAED,MAAO,aACtBE,EAAa,CAAEF,MAAO,YACtBG,EAAa,CACfC,IAAK,EACLJ,MAAO,oBAELK,EAAa,CACfD,IAAK,EACLJ,MAAO,mBAELM,EAAa,CAAEN,MAAO,WACtBO,EAAa,CAAEP,MAAO,mBACtBQ,EAAa,CACfJ,IAAK,EACLJ,MAAO,sBAELS,EAAa,CACfL,IAAK,EACLJ,MAAO,qBAELU,EAAc,CAAC,aACfC,EAAc,CAAEX,MAAO,YACvBY,EAAc,CAAEZ,MAAO,iBACvBa,EAAc,CAAC,aAEfC,EAAoB,cACpBC,EAAgB,sBAChBC,EAAc,oBCvBpB,GDwB6B,qBAAiB,CAC1CC,OAAQ,MACR,KAAAC,CAAMC,GACF,MAAMC,GAAgB,IAAAC,KAAI,IACpBC,GAAiB,IAAAD,KAAI,IACrBE,GAAc,IAAAF,KAAI,GAClBG,GAAkB,IAAAH,MAAI,GACtBI,GAAa,IAAAJ,MAAI,GACjBK,GAAa,IAAAL,MAAI,GACjBM,GAAS,IAAAN,MAAI,GACbO,GAAiB,IAAAP,MAAI,GACrBQ,EAAaC,OAAOC,OAAOC,YAAc,IAC/C,SAASC,IACL,MAAMC,EAAOC,SAASD,KAClBR,EAAWU,OACXF,EAAKG,UAAUC,OAAO,eACtBJ,EAAKG,UAAUE,IAAI,gBAGnBL,EAAKG,UAAUC,OAAO,cACtBJ,EAAKG,UAAUE,IAAI,gBAEvBC,GACJ,CACA,SAASC,IACL,IAAKhB,EAAWW,MACZ,OACJ,MAAMM,GAAO,IAAIC,MAAOC,WAClBC,EAAYH,GAAQ,GAAKA,EAAO,GACtChB,EAAWU,OAASS,EACpBZ,GACJ,CACA,SAASa,IACLrB,EAAWW,OAAQ,EACnBK,GACJ,CACA,SAASM,IACLtB,EAAWW,OAAQ,EACnBV,EAAWU,OAASV,EAAWU,MAC/BH,GACJ,CACA,SAASe,IACLC,WAAW,KACP,MAAMC,EAAaf,SAASD,KAAKiB,aAC7BpB,OAAOqB,QAAUrB,OAAOqB,SAAWrB,QACnCA,OAAOqB,OAAOC,YAAY,CAAEC,KAAM,eAAgBC,OAAQL,GAAc,MAE7E,GACP,CACAM,eAAeC,IACXjC,EAAgBY,OAASZ,EAAgBY,MACpCZ,EAAgBY,OAAUR,EAAeQ,cAwDlDoB,iBACI,MACME,EAvCV,SAAsBC,GAClB,MAAMC,EAAMD,EAAIE,MAAM,WAChBC,EAAS,GACf,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAII,OAAQD,IAAK,CACjC,MAAME,EAAIL,EAAIG,GAAGG,QAAQ,aAAc,IAClCD,KAED,WAAWE,KAAKF,IAAM,QAAQE,KAAKF,KACnCH,EAAOM,KAAKH,GACpB,CACA,OAAOH,CACX,CA4BoBO,CA3CpB,SAA4BC,GACxB,MAAMC,EAAQD,EAAQC,MAAM,gCAC5B,OAAOA,EAAQA,EAAM,GAAGL,QAAQ,aAAc,IAAM,EACxD,CAuCsBM,CAAmB3C,IAGrC,GADAN,EAAYa,MAAQsB,EAAQM,OACL,IAAnBN,EAAQM,OAER,YADA1C,EAAec,MAAQ,oCAG3B,IAAIqC,EAAS,GACb,IAEI,GADAnD,EAAec,MAAQ,mCACK,mBAAjBsC,aAA6B,CACpC,MAAMC,QAAWD,aAAa,CAAEpB,KAAM,SAClCqB,GAAMA,EAAGC,oBACTH,EAASE,EAAGC,kBACpB,CAIA,GAHKH,GAAmD,mBAAlCI,gCAClBJ,QAAeI,kCAEdJ,GAAwC,mBAAvBK,mBAGlB,OAFAxD,EAAec,MAAQsB,EAAQqB,IAAIC,GAAQC,EAAiBD,EAAM,OAAOE,KAAK,SAC9ElC,IAGJ,MAAMmC,QAAgBL,mBAAmBL,GACzC,IAAKU,EACD,OACJ7D,EAAec,MAAQsB,EAAQqB,IAAIC,GAAQC,EAAiBD,EApDpE,SAAwBG,EAASC,GAC7B,MAAMC,EAAWD,EAAUE,cAC3B,IAAK,IAAIvB,EAAI,EAAGA,EAAIoB,EAAQnB,OAAQD,IAAK,CACrC,MAAMwB,EAAQJ,EAAQpB,GACtB,GAAIwB,EAAMnF,KAAOmF,EAAMnF,IAAI4D,OACvB,IAAK,IAAIwB,EAAI,EAAGA,EAAID,EAAMnF,IAAI4D,OAAQwB,IAClC,GAAI1D,OAAOyD,EAAMnF,IAAIoF,IAAIF,gBAAkBD,EACvC,OAAOE,CAGvB,CACA,OAAO,IACX,CAwC0EE,CAAeN,EAASH,KAAQE,KAAK,IACvGlC,GACJ,CACA,MAAO0C,GACHC,QAAQC,MAAM,UAAWF,GACzBpE,EAAec,MAAQsB,EAAQqB,IAAIC,GAAQC,EAAiBD,EAAM,OAAOE,KAAK,IAC9ElC,GACJ,CACJ,CA1Fc6C,GACNjE,EAAeQ,OAAQ,GAE3BY,GACJ,CACA,SAAS8C,EAAWC,GAChB,MAAMC,EAAM7D,SAAS8D,cAAc,OAEnC,OADAD,EAAIE,YAAcH,EACXC,EAAIG,SACf,CAkCA,SAASlB,EAAiBmB,EAAQb,GAC9B,IAAKA,EACD,MAAO,+DAA+DO,EAAWM,iBAErF,MAAMC,EAAQd,EAAMe,SAAW,MACzBhC,EAAUiB,EAAMjB,SAAW,QACjC,MAAO,+DAA+DwB,EAAWM,8CAAmDN,EAAWO,6CAAiDP,EAAWxB,gBAC/M,CAyCA,SAASiC,EAAcC,GACnBA,EAAMC,kBACN,MAAMV,EAAO3E,EAAcgB,MAAM8B,QAAQ,WAAY,IAAIwC,OACnDC,EAAWxE,SAAS8D,cAAc,YACxCU,EAASvE,MAAQ2D,EACjB5D,SAASD,KAAK0E,YAAYD,GAC1BA,EAASE,SACT,IACI1E,SAAS2E,YAAY,QACrBnF,EAAOS,OAAQ,EACfa,WAAW,IAAOtB,EAAOS,OAAQ,EAAQ,KAC7C,CACA,MAAOsD,GACHC,QAAQC,MAAM,cAAeF,EACjC,CACAvD,SAASD,KAAK6E,YAAYJ,EAC9B,CACA,SAASnE,IACL,MAAMwE,EAAUC,KAAKC,UAAU,CAC3BC,KAAM1F,EAAWW,MAAQ,OAAS,SAClCgF,KAAM1F,EAAWU,MACjBiF,UAAW1E,KAAK2E,QAEpB,IACIC,aAAaC,QAAQ1G,EAAmBkG,EAC5C,CACA,MAAOtB,GACHC,QAAQ8B,KAAK,uCAAwC/B,EACzD,CACA,IACI,MAAMgC,EAAU,IAAIC,iBAAiB5G,GACrC2G,EAAQrE,YAAY2D,GACpBU,EAAQE,OACZ,CACA,MAAOlC,GACHC,QAAQ8B,KAAK,mCAAoC/B,EACrD,CACA,IACQ3D,OAAOqB,QAAUrB,OAAOqB,SAAWrB,SACnCA,OAAOqB,OAAOyE,gBAAkBb,EAChCjF,OAAOqB,OAAO0E,cAAc,IAAIC,YAAY/G,EAAa,CAAEgH,OAAQhB,KAE3E,CACA,MAAOtB,GACHC,QAAQ8B,KAAK,uCAAwC/B,EACzD,CACJ,CACA,SAASuC,EAAgBtE,GACrB,GAAKA,EAEL,IACI,MAAMuE,EAASjB,KAAKkB,MAAMxE,GAC1B,GAAoB,SAAhBuE,EAAOf,KAGP,OAFA1F,EAAWW,OAAQ,OACnBK,IAGgB,WAAhByF,EAAOf,OACP1F,EAAWW,OAAQ,EACQ,kBAAhB8F,EAAOd,OACd1F,EAAWU,MAAQ8F,EAAOd,MAC9BnF,IAER,CACA,MAAOyD,GACHC,QAAQ8B,KAAK,uCAAwC/B,EACzD,CACJ,CA2DA,OArCA,IAAA0C,WAAU,MArBV,WACI,IACI,GAAIrG,OAAOqB,QAAUrB,OAAOqB,SAAWrB,OAAQ,CAC3C,MAAMsG,EAAYtG,OAAOqB,OAAOjB,SAC1BmG,EAASD,EAAUE,cAAc,cAAgBF,EAAUE,cAAc,aAAeF,EAAUnG,KAClGsG,EAAQzG,OAAOqB,OAAOqF,iBAAiBH,GACvCI,EAAOF,EAAMG,SACbC,EAAaJ,EAAMI,WACrBF,IACAvG,SAAS0G,gBAAgBL,MAAMM,YAAY,iBAAkBJ,GAC7DvG,SAASD,KAAKsG,MAAMG,SAAWD,GAE/BE,IACAzG,SAASD,KAAKsG,MAAMI,WAAaA,EAEzC,CACJ,CACA,MAAOlD,GACHC,QAAQ8B,KAAK,8CAA+C/B,EAChE,CACJ,CAEIqD,GACA,MAAMC,EAASzB,aAAa0B,QAAQnI,GAChCkI,EACAf,EAAgBe,GAGhBxG,IAEJT,OAAOmH,iBAAiB,UAAW1C,IAC3BA,EAAMpG,MAAQU,GACdmH,EAAgBzB,EAAM2C,YAE9B,IACoB,IAAIxB,iBAAiB5G,GAC7BmI,iBAAiB,UAAW1C,GAASyB,EAAgBnG,OAAO0E,EAAM4C,MAAQ,KACtF,CACA,MAAO1D,GACHC,QAAQ8B,KAAK,0CAA2C/B,EAC5D,CACA,IACI,GAAI3D,OAAOqB,QAAUrB,OAAOqB,SAAWrB,OAAQ,CAC3CA,OAAOqB,OAAO8F,iBAAiBlI,EAAcwF,IACzCyB,EAAgBnG,OAAO0E,EAAMwB,QAAU,OAE3C,MAAMqB,EAActH,OAAOqB,OAAOyE,gBAC9BwB,GACApB,EAAgBoB,EACxB,CACJ,CACA,MAAO3D,GACHC,QAAQ8B,KAAK,6CAA8C/B,EAC/D,CACAjD,IAlKJ,WACI,MAAM6G,EA1CV,SAAwBhF,GACpB,MAAMC,EAAQD,EAAQC,MAAM,gCAC5B,OAAOA,EAAQA,EAAM,GAAGL,QAAQ,aAAc,IAAM,EACxD,CAuCoBqF,CAAe1H,GAAYqC,QAAQ,aAAc,IACjE9C,EAAcgB,MAAQkH,EAAUxD,EAAWwD,GAAW,uCAC1D,CAgKIE,GACAxG,MAEG,CAACyG,EAAMC,MACF,kBAAc,wBAAoB,MAAO3J,EAAY,EACzD,wBAAoB,MAAOE,EAAY,CACnCyJ,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE1J,MAAO,YAAc,EACxE,wBAAoB,OAAQ,CAAEA,MAAO,mBACrC,qBAAiB,YACjB,KACJ,wBAAoB,MAAOE,EAAY,EACnC,wBAAoB,SAAU,CAC1BF,OAAO,oBAAgB,CAAC,SAAU,CAAE2J,OAAQlI,EAAWW,SACvDwH,QAAS9G,GACV,KAAM,IACT,wBAAoB,SAAU,CAC1B9C,MAAO,SACP4J,QAAS7G,GACV,CACErB,EAAgB,QACV,kBAAc,wBAAoB,IAAKvB,MACvC,kBAAc,wBAAoB,IAAKE,WAI1D,wBAAoB,UAAWC,EAAY,EACvC,wBAAoB,MAAOC,EAAY,CACnCmJ,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE1J,MAAO,kBAAoB,MAAO,KACzF,wBAAoB,SAAU,CAC1BA,MAAO,cACP4J,QAASrD,EACTF,MAAO,QACR,CACG1E,EAAOS,QAEF,kBAAc,wBAAoB,IAAK3B,MADvC,kBAAc,wBAAoB,IAAKD,SAItD,wBAAoB,MAAO,CACvBR,MAAO,gBACPmG,UAAW/E,EAAcgB,OAC1B,KAAM,EAAe1B,MAE5B,wBAAoB,UAAW,CAC3BV,OAAO,oBAAgB,CAAC,+BAAgC,CAAE6J,UAAWrI,EAAgBY,UACtF,EACC,wBAAoB,MAAO,CACvBpC,MAAO,kBACP4J,QAASnG,GACV,CACCiG,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAE1J,MAAO,kBAAoB,MAAO,KACzF,wBAAoB,OAAQW,GAAa,qBAAiBY,EAAYa,OAAQ,GAC9EsH,EAAO,KAAOA,EAAO,IAAK,wBAAoB,IAAK,CAAE1J,MAAO,uCAAyC,MAAO,OAEhH,wBAAoB,MAAOY,EAAa,EACpC,wBAAoB,MAAO,CACvBZ,MAAO,iBACPmG,UAAW7E,EAAec,OAC3B,KAAM,EAAevB,MAE7B,KAGf,IEtWJiJ,EAAE,KACE,MAAMC,GAAM,IAAAC,WAAU,GAAKC,IAAI,KAC/BF,EAAIG,MAAM,QACVJ,EAAE/H,QAAQoI,GAAG,WAAY,IAAMJ,EAAIK","sources":["src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/黑科技正则替换/app.vue?417b","webpack://tavern_helper_template/src/黑科技正则替换/app.vue?392a","src://tavern_helper_template/src/黑科技正则替换/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = { class: \"th-panel\" };\nconst _hoisted_2 = { class: \"th-header\" };\nconst _hoisted_3 = { class: \"th-tools\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"fa-solid fa-moon\"\n};\nconst _hoisted_5 = {\n    key: 1,\n    class: \"fa-solid fa-sun\"\n};\nconst _hoisted_6 = { class: \"th-card\" };\nconst _hoisted_7 = { class: \"th-card__header\" };\nconst _hoisted_8 = {\n    key: 0,\n    class: \"fa-regular fa-copy\"\n};\nconst _hoisted_9 = {\n    key: 1,\n    class: \"fa-solid fa-check\"\n};\nconst _hoisted_10 = [\"innerHTML\"];\nconst _hoisted_11 = { class: \"th-badge\" };\nconst _hoisted_12 = { class: \"th-card__body\" };\nconst _hoisted_13 = [\"innerHTML\"];\nimport { onMounted, ref } from 'vue';\nconst THEME_STORAGE_KEY = 'th-ui-theme';\nconst THEME_CHANNEL = 'th-ui-theme-channel';\nconst THEME_EVENT = 'th-ui-theme-event';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const userInputHtml = ref('');\n        const memoryListHtml = ref('');\n        const memoryCount = ref(0);\n        const recallCollapsed = ref(true);\n        const isAutoMode = ref(true);\n        const isDarkMode = ref(true);\n        const copied = ref(false);\n        const memoriesLoaded = ref(false);\n        const rawContent = String(window.__TH_RAW__ ?? '');\n        function updateThemeUI() {\n            const body = document.body;\n            if (isDarkMode.value) {\n                body.classList.remove('theme-light');\n                body.classList.add('theme-dark');\n            }\n            else {\n                body.classList.remove('theme-dark');\n                body.classList.add('theme-light');\n            }\n            syncThemeState();\n        }\n        function checkTimeAndApplyAuto() {\n            if (!isAutoMode.value)\n                return;\n            const hour = new Date().getHours();\n            const isDayTime = hour >= 6 && hour < 18;\n            isDarkMode.value = !isDayTime;\n            updateThemeUI();\n        }\n        function enableAutoTheme() {\n            isAutoMode.value = true;\n            checkTimeAndApplyAuto();\n        }\n        function toggleManualTheme() {\n            isAutoMode.value = false;\n            isDarkMode.value = !isDarkMode.value;\n            updateThemeUI();\n        }\n        function updateIframeHeight() {\n            setTimeout(() => {\n                const bodyHeight = document.body.scrollHeight;\n                if (window.parent && window.parent !== window) {\n                    window.parent.postMessage({ type: 'resizeIframe', height: bodyHeight }, '*');\n                }\n            }, 50);\n        }\n        async function toggleRecallSection() {\n            recallCollapsed.value = !recallCollapsed.value;\n            if (!recallCollapsed.value && !memoriesLoaded.value) {\n                await loadMemories();\n                memoriesLoaded.value = true;\n            }\n            updateIframeHeight();\n        }\n        function escapeHtml(text) {\n            const div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        }\n        function parseUserInput(content) {\n            const match = content.match(/<本轮用户输入>([\\s\\S]*?)<\\/本轮用户输入>/);\n            return match ? match[1].replace(/^\\s+|\\s+$/g, '') : '';\n        }\n        function parseRecallContent(content) {\n            const match = content.match(/<recall>([\\s\\S]*?)<\\/recall>/);\n            return match ? match[1].replace(/^\\s+|\\s+$/g, '') : '';\n        }\n        function parseAmCodes(raw) {\n            const arr = raw.split(/[,，\\s]+/);\n            const result = [];\n            for (let i = 0; i < arr.length; i++) {\n                const s = arr[i].replace(/^\\s+|\\s+$/g, '');\n                if (!s)\n                    continue;\n                if (/^AM\\d+$/i.test(s) || /^\\d+$/.test(s))\n                    result.push(s);\n            }\n            return result;\n        }\n        function findEntryByKey(entries, keyToFind) {\n            const keyUpper = keyToFind.toUpperCase();\n            for (let i = 0; i < entries.length; i++) {\n                const entry = entries[i];\n                if (entry.key && entry.key.length) {\n                    for (let j = 0; j < entry.key.length; j++) {\n                        if (String(entry.key[j]).toUpperCase() === keyUpper)\n                            return entry;\n                    }\n                }\n            }\n            return null;\n        }\n        function renderMemoryItem(amCode, entry) {\n            if (!entry) {\n                return `<div class=\"th-memory-item\"><div class=\"th-memory-item__id\">${escapeHtml(amCode)}</div></div>`;\n            }\n            const title = entry.comment || '无标题';\n            const content = entry.content || '（无内容）';\n            return `<div class=\"th-memory-item\"><div class=\"th-memory-item__id\">${escapeHtml(amCode)}</div><div class=\"th-memory-item__title\">${escapeHtml(title)}</div><div class=\"th-memory-item__body\">${escapeHtml(content)}</div></div>`;\n        }\n        function initUserInput() {\n            const trimmed = parseUserInput(rawContent).replace(/^\\s+|\\s+$/g, '');\n            userInputHtml.value = trimmed ? escapeHtml(trimmed) : '<span class=\"th-muted\">（无输入内容）</span>';\n        }\n        async function loadMemories() {\n            const rawAmList = parseRecallContent(rawContent);\n            const amCodes = parseAmCodes(rawAmList);\n            memoryCount.value = amCodes.length;\n            if (amCodes.length === 0) {\n                memoryListHtml.value = '<div class=\"th-muted\">暂无回声</div>';\n                return;\n            }\n            let wbName = '';\n            try {\n                memoryListHtml.value = '<div class=\"th-muted\">载入中…</div>';\n                if (typeof getVariables === 'function') {\n                    const cv = await getVariables({ type: 'chat' });\n                    if (cv && cv.selectedWorldBook)\n                        wbName = cv.selectedWorldBook;\n                }\n                if (!wbName && typeof getCurrentCharPrimaryLorebook === 'function') {\n                    wbName = await getCurrentCharPrimaryLorebook();\n                }\n                if (!wbName || typeof getLorebookEntries !== 'function') {\n                    memoryListHtml.value = amCodes.map(code => renderMemoryItem(code, null)).join('');\n                    updateIframeHeight();\n                    return;\n                }\n                const entries = await getLorebookEntries(wbName);\n                if (!entries)\n                    return;\n                memoryListHtml.value = amCodes.map(code => renderMemoryItem(code, findEntryByKey(entries, code))).join('');\n                updateIframeHeight();\n            }\n            catch (err) {\n                console.error('记忆召回失败:', err);\n                memoryListHtml.value = amCodes.map(code => renderMemoryItem(code, null)).join('');\n                updateIframeHeight();\n            }\n        }\n        function copyUserInput(event) {\n            event.stopPropagation();\n            const text = userInputHtml.value.replace(/<[^>]+>/g, '').trim();\n            const textarea = document.createElement('textarea');\n            textarea.value = text;\n            document.body.appendChild(textarea);\n            textarea.select();\n            try {\n                document.execCommand('copy');\n                copied.value = true;\n                setTimeout(() => (copied.value = false), 1200);\n            }\n            catch (err) {\n                console.error('Copy failed', err);\n            }\n            document.body.removeChild(textarea);\n        }\n        function syncThemeState() {\n            const payload = JSON.stringify({\n                mode: isAutoMode.value ? 'auto' : 'manual',\n                dark: isDarkMode.value,\n                updatedAt: Date.now(),\n            });\n            try {\n                localStorage.setItem(THEME_STORAGE_KEY, payload);\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to write storage', err);\n            }\n            try {\n                const channel = new BroadcastChannel(THEME_CHANNEL);\n                channel.postMessage(payload);\n                channel.close();\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to broadcast', err);\n            }\n            try {\n                if (window.parent && window.parent !== window) {\n                    window.parent.__TH_UI_THEME__ = payload;\n                    window.parent.dispatchEvent(new CustomEvent(THEME_EVENT, { detail: payload }));\n                }\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to notify parent', err);\n            }\n        }\n        function applyThemeState(raw) {\n            if (!raw)\n                return;\n            try {\n                const parsed = JSON.parse(raw);\n                if (parsed.mode === 'auto') {\n                    isAutoMode.value = true;\n                    checkTimeAndApplyAuto();\n                    return;\n                }\n                if (parsed.mode === 'manual') {\n                    isAutoMode.value = false;\n                    if (typeof parsed.dark === 'boolean')\n                        isDarkMode.value = parsed.dark;\n                    updateThemeUI();\n                }\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to parse storage', err);\n            }\n        }\n        function syncFontSizeFromParent() {\n            try {\n                if (window.parent && window.parent !== window) {\n                    const parentDoc = window.parent.document;\n                    const sample = parentDoc.querySelector('.mes_text') || parentDoc.querySelector('.message') || parentDoc.body;\n                    const style = window.parent.getComputedStyle(sample);\n                    const size = style.fontSize;\n                    const lineHeight = style.lineHeight;\n                    if (size) {\n                        document.documentElement.style.setProperty('--st-font-size', size);\n                        document.body.style.fontSize = size;\n                    }\n                    if (lineHeight) {\n                        document.body.style.lineHeight = lineHeight;\n                    }\n                }\n            }\n            catch (err) {\n                console.warn('[font-sync] failed to read parent font size', err);\n            }\n        }\n        onMounted(() => {\n            syncFontSizeFromParent();\n            const stored = localStorage.getItem(THEME_STORAGE_KEY);\n            if (stored) {\n                applyThemeState(stored);\n            }\n            else {\n                syncThemeState();\n            }\n            window.addEventListener('storage', event => {\n                if (event.key === THEME_STORAGE_KEY)\n                    applyThemeState(event.newValue);\n            });\n            try {\n                const channel = new BroadcastChannel(THEME_CHANNEL);\n                channel.addEventListener('message', event => applyThemeState(String(event.data || '')));\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to listen broadcast', err);\n            }\n            try {\n                if (window.parent && window.parent !== window) {\n                    window.parent.addEventListener(THEME_EVENT, (event) => {\n                        applyThemeState(String(event.detail || ''));\n                    });\n                    const parentValue = window.parent.__TH_UI_THEME__;\n                    if (parentValue)\n                        applyThemeState(parentValue);\n                }\n            }\n            catch (err) {\n                console.warn('[theme-sync] failed to listen parent event', err);\n            }\n            checkTimeAndApplyAuto();\n            initUserInput();\n            updateIframeHeight();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"th-title\" }, [\n                        _createElementVNode(\"span\", { class: \"th-title__dot\" }),\n                        _createTextVNode(\" 记忆索引 \")\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"th-btn\", { active: isAutoMode.value }]),\n                            onClick: enableAutoTheme\n                        }, \"自动\", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: \"th-btn\",\n                            onClick: toggleManualTheme\n                        }, [\n                            (isDarkMode.value)\n                                ? (_openBlock(), _createElementBlock(\"i\", _hoisted_4))\n                                : (_openBlock(), _createElementBlock(\"i\", _hoisted_5))\n                        ])\n                    ])\n                ]),\n                _createElementVNode(\"section\", _hoisted_6, [\n                    _createElementVNode(\"div\", _hoisted_7, [\n                        _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"th-card__title\" }, \"输入\", -1 /* CACHED */)),\n                        _createElementVNode(\"button\", {\n                            class: \"th-icon-btn\",\n                            onClick: copyUserInput,\n                            title: \"复制内容\"\n                        }, [\n                            (!copied.value)\n                                ? (_openBlock(), _createElementBlock(\"i\", _hoisted_8))\n                                : (_openBlock(), _createElementBlock(\"i\", _hoisted_9))\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", {\n                        class: \"th-card__body\",\n                        innerHTML: userInputHtml.value\n                    }, null, 8 /* PROPS */, _hoisted_10)\n                ]),\n                _createElementVNode(\"section\", {\n                    class: _normalizeClass([\"th-card th-card--collapsible\", { collapsed: recallCollapsed.value }])\n                }, [\n                    _createElementVNode(\"div\", {\n                        class: \"th-card__header\",\n                        onClick: toggleRecallSection\n                    }, [\n                        _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"th-card__title\" }, \"回声\", -1 /* CACHED */)),\n                        _createElementVNode(\"span\", _hoisted_11, _toDisplayString(memoryCount.value), 1 /* TEXT */),\n                        _cache[3] || (_cache[3] = _createElementVNode(\"i\", { class: \"fa-solid fa-chevron-down th-chevron\" }, null, -1 /* CACHED */))\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_12, [\n                        _createElementVNode(\"div\", {\n                            class: \"th-memory-list\",\n                            innerHTML: memoryListHtml.value\n                        }, null, 8 /* PROPS */, _hoisted_13)\n                    ])\n                ], 2 /* CLASS */)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=426bdcfb&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp } from 'vue';\nimport App from './app.vue';\n$(() => {\n    const app = createApp(App).use(createPinia());\n    app.mount('#app');\n    $(window).on('pagehide', () => app.unmount());\n});\n"],"names":["Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","key","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","THEME_STORAGE_KEY","THEME_CHANNEL","THEME_EVENT","__name","setup","__props","userInputHtml","ref","memoryListHtml","memoryCount","recallCollapsed","isAutoMode","isDarkMode","copied","memoriesLoaded","rawContent","String","window","__TH_RAW__","updateThemeUI","body","document","value","classList","remove","add","syncThemeState","checkTimeAndApplyAuto","hour","Date","getHours","isDayTime","enableAutoTheme","toggleManualTheme","updateIframeHeight","setTimeout","bodyHeight","scrollHeight","parent","postMessage","type","height","async","toggleRecallSection","amCodes","raw","arr","split","result","i","length","s","replace","test","push","parseAmCodes","content","match","parseRecallContent","wbName","getVariables","cv","selectedWorldBook","getCurrentCharPrimaryLorebook","getLorebookEntries","map","code","renderMemoryItem","join","entries","keyToFind","keyUpper","toUpperCase","entry","j","findEntryByKey","err","console","error","loadMemories","escapeHtml","text","div","createElement","textContent","innerHTML","amCode","title","comment","copyUserInput","event","stopPropagation","trim","textarea","appendChild","select","execCommand","removeChild","payload","JSON","stringify","mode","dark","updatedAt","now","localStorage","setItem","warn","channel","BroadcastChannel","close","__TH_UI_THEME__","dispatchEvent","CustomEvent","detail","applyThemeState","parsed","parse","onMounted","parentDoc","sample","querySelector","style","getComputedStyle","size","fontSize","lineHeight","documentElement","setProperty","syncFontSizeFromParent","stored","getItem","addEventListener","newValue","data","parentValue","trimmed","parseUserInput","initUserInput","_ctx","_cache","active","onClick","collapsed","$","app","createApp","use","mount","on","unmount"],"sourceRoot":""}