{"version":3,"file":"index.js","mappings":"AAOA,SAASA,EAAWC,GAClB,IAAKA,EACH,OAAO,EAET,MAAMC,EAAMD,EAAGE,QAAQC,cACvB,SAAIH,aAAcI,aAAeJ,EAAGK,qBAGrB,aAARJ,GAA8B,UAARA,EAC/B,CAEA,SAASK,EAAuBN,GAC9B,OAAKA,IAGDA,aAAcO,qBAGdP,aAAcQ,kBAFT,CAAEC,MAAOT,EAAGU,gBAAkB,EAAGC,IAAKX,EAAGY,cAAgB,GAHzD,IASX,CAWA,SAASC,EAAoBC,GAC3B,MAAMC,EAASD,EAAIE,cACnB,IAAKD,EACH,OAEF,MAAME,EAAQX,EAAuBS,GACrC,GAAKE,IAGDF,aAAkBR,qBAAuBQ,aAAkBP,kBAAkB,CAC/E,MAAMU,EAAQD,EAAMN,IACpBI,EAAOI,kBAAkBD,EAAOA,EAClC,CACF,CAkBA,SAASE,EAAeN,GACtB,MAAMO,EAAYP,EAAIQ,eAClBD,IAAcA,EAAUE,aAC1BF,EAAUG,iBAEd,CAEA,SAASC,EAAaX,GACpB,MAAMC,EAASD,EAAIE,cACfD,aAAkBX,aAAeL,EAAWgB,IAC9CA,EAAOW,MAEX,CAEAC,EAAE,KACA,IAtFF,WACE,MAAMC,EAAKC,UAAUC,UACfC,EAAgB,mBAAmBC,KAAKJ,GACxCK,EAAsC,aAAvBJ,UAAUK,UAA2BL,UAAUM,eAAiB,EACrF,OAAOJ,GAAiBE,CAC1B,CAiFOG,GACH,OAGF,MAAMtB,EAAMuB,OAAOC,QAAQC,SAC3B,IAAKzB,EACH,OAGF,MAAM0B,EAAiBC,IACrB,IA9BJ,SAA4B3B,GAC1B,MAAMO,EAAYP,EAAIQ,eACtB,QAASD,IAAcA,EAAUE,WACnC,CA2BSmB,CAAmB5B,KAjE5B,SAAiCA,GAC/B,MACMG,EAAQX,EADCQ,EAAIE,eAEnB,QAAKC,GAGEA,EAAMR,QAAUQ,EAAMN,GAC/B,CA0DqCgC,CAAwB7B,GACvD,QA1CN,SAAyBd,GACvB,IAAI4C,EAAU5C,EACd,KAAO4C,GAAS,CACd,GAAI7C,EAAW6C,GACb,OAAOA,EAETA,EAAUA,EAAQC,aACpB,CACA,OAAO,IACT,EAqCQC,CADWL,EAAMM,UAMrB3B,EAAeN,GACfD,EAAoBC,GACpBW,EAAaX,KAGfA,EAAIkC,iBAAiB,aAAcR,GAAe,GAClD1B,EAAIkC,iBAAiB,YAAaR,GAAe,GAEjD,MAAMS,EAAa,KAEjBC,WAAW,KACT9B,EAAeN,GACfD,EAAoBC,GACpBW,EAAaX,IACZ,IAGLA,EAAIkC,iBAAiB,OAAQC,GAAY,GACzCnC,EAAIkC,iBAAiB,MAAOC,GAAY,GAExCE,QAAQC,KAAK,iCAEbzB,EAAEU,QAAQgB,GAAG,WAAY,KACvBvC,EAAIwC,oBAAoB,aAAcd,GAAe,GACrD1B,EAAIwC,oBAAoB,YAAad,GAAe,GACpD1B,EAAIwC,oBAAoB,OAAQL,GAAY,GAC5CnC,EAAIwC,oBAAoB,MAAOL,GAAY","sources":["src://tavern_helper_template/src/ios-selection-guard/index.ts"],"sourcesContent":["function isIOS(): boolean {\n  const ua = navigator.userAgent;\n  const isAppleMobile = /iPad|iPhone|iPod/.test(ua);\n  const isModernIPad = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;\n  return isAppleMobile || isModernIPad;\n}\n\nfunction isEditable(el: Element | null): boolean {\n  if (!el) {\n    return false;\n  }\n  const tag = el.tagName.toLowerCase();\n  if (el instanceof HTMLElement && el.isContentEditable) {\n    return true;\n  }\n  return tag === 'textarea' || tag === 'input';\n}\n\nfunction getInputSelectionRange(el: Element | null): { start: number; end: number } | null {\n  if (!el) {\n    return null;\n  }\n  if (el instanceof HTMLTextAreaElement) {\n    return { start: el.selectionStart ?? 0, end: el.selectionEnd ?? 0 };\n  }\n  if (el instanceof HTMLInputElement) {\n    return { start: el.selectionStart ?? 0, end: el.selectionEnd ?? 0 };\n  }\n  return null;\n}\n\nfunction hasActiveInputSelection(doc: Document): boolean {\n  const active = doc.activeElement;\n  const range = getInputSelectionRange(active);\n  if (!range) {\n    return false;\n  }\n  return range.start !== range.end;\n}\n\nfunction clearInputSelection(doc: Document): void {\n  const active = doc.activeElement;\n  if (!active) {\n    return;\n  }\n  const range = getInputSelectionRange(active);\n  if (!range) {\n    return;\n  }\n  if (active instanceof HTMLTextAreaElement || active instanceof HTMLInputElement) {\n    const caret = range.end;\n    active.setSelectionRange(caret, caret);\n  }\n}\n\nfunction closestEditable(el: Element | null): Element | null {\n  let current = el;\n  while (current) {\n    if (isEditable(current)) {\n      return current;\n    }\n    current = current.parentElement;\n  }\n  return null;\n}\n\nfunction hasActiveSelection(doc: Document): boolean {\n  const selection = doc.getSelection();\n  return !!selection && !selection.isCollapsed;\n}\n\nfunction clearSelection(doc: Document): void {\n  const selection = doc.getSelection();\n  if (selection && !selection.isCollapsed) {\n    selection.removeAllRanges();\n  }\n}\n\nfunction blurEditable(doc: Document): void {\n  const active = doc.activeElement;\n  if (active instanceof HTMLElement && isEditable(active)) {\n    active.blur();\n  }\n}\n\n$(() => {\n  if (!isIOS()) {\n    return;\n  }\n\n  const doc = window.parent?.document;\n  if (!doc) {\n    return;\n  }\n\n  const onPointerDown = (event: Event) => {\n    if (!hasActiveSelection(doc) && !hasActiveInputSelection(doc)) {\n      return;\n    }\n\n    const target = event.target as Element | null;\n    if (closestEditable(target)) {\n      return;\n    }\n\n    // Exit selection mode so the next tap can trigger real clicks.\n    clearSelection(doc);\n    clearInputSelection(doc);\n    blurEditable(doc);\n  };\n\n  doc.addEventListener('touchstart', onPointerDown, true);\n  doc.addEventListener('mousedown', onPointerDown, true);\n\n  const onCopyLike = () => {\n    // iOS sometimes stays in selection mode after copy; exit it ASAP.\n    setTimeout(() => {\n      clearSelection(doc);\n      clearInputSelection(doc);\n      blurEditable(doc);\n    }, 0);\n  };\n\n  doc.addEventListener('copy', onCopyLike, true);\n  doc.addEventListener('cut', onCopyLike, true);\n\n  console.info('[ios-selection-guard] enabled');\n\n  $(window).on('pagehide', () => {\n    doc.removeEventListener('touchstart', onPointerDown, true);\n    doc.removeEventListener('mousedown', onPointerDown, true);\n    doc.removeEventListener('copy', onCopyLike, true);\n    doc.removeEventListener('cut', onCopyLike, true);\n  });\n});\n"],"names":["isEditable","el","tag","tagName","toLowerCase","HTMLElement","isContentEditable","getInputSelectionRange","HTMLTextAreaElement","HTMLInputElement","start","selectionStart","end","selectionEnd","clearInputSelection","doc","active","activeElement","range","caret","setSelectionRange","clearSelection","selection","getSelection","isCollapsed","removeAllRanges","blurEditable","blur","$","ua","navigator","userAgent","isAppleMobile","test","isModernIPad","platform","maxTouchPoints","isIOS","window","parent","document","onPointerDown","event","hasActiveSelection","hasActiveInputSelection","current","parentElement","closestEditable","target","addEventListener","onCopyLike","setTimeout","console","info","on","removeEventListener"],"sourceRoot":""}