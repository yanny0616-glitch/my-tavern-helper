{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src//entry/buttons.ts","src://tavern_helper_template/src//services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src//services/libraryService.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src//state/store.ts","src://tavern_helper_template/src//services/tagService.ts","src://tavern_helper_template/src//ui/components/ManageContent.vue","webpack://tavern_helper_template/src//ui/components/ManageContent.vue?5bac","src://tavern_helper_template/src//ui/components/ManageOverview.vue","webpack://tavern_helper_template/src//ui/components/ManageOverview.vue?ce7d","src://tavern_helper_template/src//ui/components/ManageModal.vue","webpack://tavern_helper_template/src//ui/components/ManageModal.vue?bb46","src://tavern_helper_template/src//ui/composables/useBatchTags.ts","src://tavern_helper_template/src//ui/composables/useLibraryActions.ts","src://tavern_helper_template/src//ui/App.vue","src://tavern_helper_template/src//ui/composables/useTagFilters.ts","src://tavern_helper_template/src//ui/composables/useTagEditing.ts","webpack://tavern_helper_template/src//ui/App.vue?a8e8","src://tavern_helper_template/src//entry/portal.mount.ts","src://tavern_helper_template/src//entry/portal.styles.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src//entry/portal.controller.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  const $existing = $(`#${buttonId}`);\n  if ($existing.length) {\n    $existing\n      .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n      .attr('title', ' CardHub ')\n      .attr('aria-label', ' CardHub ')\n      .empty();\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const openOnce = createOpenOnce(() => controller.open('role'));\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n    .attr('title', ' CardHub ')\n    .attr('aria-label', ' CardHub ')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      openOnce();\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], openOnce);\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return //.test(text) || //.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const openOnce = createOpenOnce(() => controller.open('magic'));\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .html('<i class=\"fa-solid fa-id-badge\" aria-hidden=\"true\"></i><span></span>')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        openOnce();\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], openOnce);\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n\nfunction createOpenOnce(handler: () => void): () => void {\n  let lastFiredAt = 0;\n  return () => {\n    const now = Date.now();\n    if (now - lastFiredAt < 250) {\n      return;\n    }\n    lastFiredAt = now;\n    handler();\n  };\n}\n","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] ', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const idCounts = new Map<string, number>();\n  const tagKeyCounts = new Map<string, number>();\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map((character, index) => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar;\n    const name = character.name ?? '';\n    const createdRaw =\n      character.create_date ??\n      character.date_added ??\n      (character as any)?.created ??\n      (character as any)?.created_at ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      character.data?.create_date ??\n      character.data?.date_added ??\n      (character as any)?.data?.created ??\n      (character as any)?.data?.created_at ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n    const createdAt = coerceToTimestamp(createdRaw) ?? 0;\n    const stamp = createdRaw ?? String(index);\n    const tagBaseKey = avatarKey ?? `name:${name}::${stamp}`;\n    let tagKey = tagBaseKey;\n    if (!avatarKey) {\n      const tagCount = tagKeyCounts.get(tagBaseKey) ?? 0;\n      tagKeyCounts.set(tagBaseKey, tagCount + 1);\n      if (tagCount) {\n        tagKey = `${tagBaseKey}::${tagCount}`;\n      }\n    }\n\n    const hasTagKey = Boolean(ctx?.tagMap && Object.prototype.hasOwnProperty.call(ctx.tagMap, tagKey));\n    const mappedIds = hasTagKey ? (ctx!.tagMap![tagKey] ?? []) : [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = hasTagKey ? mappedTags : directTags;\n    const baseId = avatarKey ? `avatar:${avatarKey}` : `name:${name}::${stamp}`;\n    const count = idCounts.get(baseId) ?? 0;\n    idCounts.set(baseId, count + 1);\n    const id = count ? `${baseId}::${count}` : baseId;\n\n    const lastChatRaw =\n      (character as any)?.last_interaction ??\n      (character as any)?.last_interaction_time ??\n      (character as any)?.last_interaction_date ??\n      (character as any)?.last_chat_time ??\n      (character as any)?.last_chat_date ??\n      (character as any)?.last_message_time ??\n      (character as any)?.last_message_date ??\n      (character as any)?.update_time ??\n      (character as any)?.last_modified ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      (character as any)?.data?.last_interaction ??\n      (character as any)?.data?.last_interaction_time ??\n      (character as any)?.data?.last_interaction_date ??\n      (character as any)?.data?.last_chat_time ??\n      (character as any)?.data?.last_chat_date ??\n      (character as any)?.data?.last_message_time ??\n      (character as any)?.data?.last_message_date ??\n      (character as any)?.data?.update_time ??\n      (character as any)?.data?.last_modified ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n\n    return {\n      id,\n      name,\n      avatar: character.avatar ?? null,\n      tags,\n      tagKey,\n      origin: 'tavern',\n      createdAt,\n      lastChatAt: coerceToTimestamp(lastChatRaw) ?? 0,\n    };\n  });\n}\n\nfunction coerceToTimestamp(value: unknown): number | null {\n  if (typeof value === 'number' && !Number.isNaN(value)) {\n    return value < 1e12 ? value * 1000 : value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Date.parse(value);\n    if (!Number.isNaN(parsed)) {\n      return parsed;\n    }\n  }\n  return null;\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}'  >= '${expected}'`, '');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [` ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`   : ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`   : ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\n\nconst LIBRARY_KEY = 'cardhub_library';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getGlobalStorage() {\n  return {\n    type: 'global',\n  } as const;\n}\n\nfunction getScriptStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibrary(): StoredLibrary {\n  const globalVars = TavernHelper.getVariables(getGlobalStorage()) as Record<string, unknown>;\n  const globalRaw = globalVars?.[LIBRARY_KEY];\n  if (globalRaw && typeof globalRaw === 'object') {\n    const entries = Array.isArray((globalRaw as StoredLibrary).entries) ? (globalRaw as StoredLibrary).entries : [];\n    return { entries };\n  }\n\n  const scriptVars = TavernHelper.getVariables(getScriptStorage()) as Record<string, unknown>;\n  const scriptRaw = scriptVars?.[LIBRARY_KEY];\n  if (!scriptRaw || typeof scriptRaw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((scriptRaw as StoredLibrary).entries) ? (scriptRaw as StoredLibrary).entries : [];\n  if (entries.length) {\n    writeLibrary(entries);\n  }\n  return { entries };\n}\n\nfunction writeLibrary(entries: CardHubItem[]) {\n  const vars = TavernHelper.getVariables(getGlobalStorage()) as Record<string, unknown>;\n  TavernHelper.replaceVariables(\n    {\n      ...vars,\n      [LIBRARY_KEY]: { entries },\n    },\n    getGlobalStorage(),\n  );\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction parseJsonSafe(raw: string): any | null {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nfunction decodeBase64Text(value: string): string | null {\n  try {\n    const binary = atob(value);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return new TextDecoder().decode(bytes);\n  } catch {\n    return null;\n  }\n}\n\nfunction isLikelyBase64(value: string): boolean {\n  if (value.length < 16 || value.length % 4 !== 0) {\n    return false;\n  }\n  return /^[A-Za-z0-9+/=]+$/.test(value);\n}\n\nfunction parseCardPayload(value: string): any | null {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n  const direct = parseJsonSafe(trimmed);\n  if (direct) {\n    return direct;\n  }\n  if (!isLikelyBase64(trimmed)) {\n    return null;\n  }\n  const decoded = decodeBase64Text(trimmed);\n  if (!decoded) {\n    return null;\n  }\n  return parseJsonSafe(decoded);\n}\n\nfunction extractCardTagsFromData(data: any): string[] {\n  const tags = data?.tags ?? data?.data?.tags;\n  if (!Array.isArray(tags)) {\n    return [];\n  }\n  return tags\n    .filter(tag => typeof tag === 'string')\n    .map(tag => tag.trim())\n    .filter(Boolean);\n}\n\nfunction dataUrlToBytes(dataUrl: string): Uint8Array | null {\n  const comma = dataUrl.indexOf(',');\n  if (comma < 0) {\n    return null;\n  }\n  const base64 = dataUrl.slice(comma + 1);\n  try {\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n  } catch {\n    return null;\n  }\n}\n\nfunction bytesToString(bytes: Uint8Array): string {\n  return new TextDecoder().decode(bytes);\n}\n\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\n  return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n}\n\nfunction parseTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseIntlTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const compressed = data[nullIndex + 1] === 1;\n  let cursor = nullIndex + 2;\n  const langEnd = data.indexOf(0, cursor);\n  if (langEnd < 0) {\n    return null;\n  }\n  cursor = langEnd + 1;\n  const translatedEnd = data.indexOf(0, cursor);\n  if (translatedEnd < 0) {\n    return null;\n  }\n  cursor = translatedEnd + 1;\n  if (compressed) {\n    return null;\n  }\n  const value = bytesToString(data.subarray(cursor)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction extractPngTextChunks(bytes: Uint8Array): Array<{ key: string; value: string }> {\n  if (bytes.length < 8) {\n    return [];\n  }\n  const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n  for (let i = 0; i < signature.length; i += 1) {\n    if (bytes[i] !== signature[i]) {\n      return [];\n    }\n  }\n  const chunks: Array<{ key: string; value: string }> = [];\n  let offset = 8;\n  while (offset + 8 <= bytes.length) {\n    const length = readUint32BE(bytes, offset);\n    const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n    const dataStart = offset + 8;\n    const dataEnd = dataStart + length;\n    if (dataEnd + 4 > bytes.length) {\n      break;\n    }\n    const data = bytes.subarray(dataStart, dataEnd);\n    if (type === 'tEXt') {\n      const entry = parseTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    } else if (type === 'iTXt') {\n      const entry = parseIntlTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    }\n    offset = dataEnd + 4;\n  }\n  return chunks;\n}\n\nfunction parsePngCardName(dataUrl: string): string | null {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return null;\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    const name = parsed?.name ?? parsed?.data?.name;\n    if (typeof name === 'string' && name.trim()) {\n      return name.trim();\n    }\n  }\n  return null;\n}\n\nfunction parsePngCardTags(dataUrl: string): string[] {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return [];\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    if (parsed) {\n      const tags = extractCardTagsFromData(parsed);\n      if (tags.length) {\n        return tags;\n      }\n    }\n  }\n  return [];\n}\n\nfunction parseJsonCardTags(raw: string): string[] {\n  const parsed = parseJsonSafe(raw);\n  return parsed ? extractCardTagsFromData(parsed) : [];\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nfunction hashString(value: string): string {\n  let hash = 5381;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = (hash * 33) ^ value.charCodeAt(i);\n  }\n  return (hash >>> 0).toString(16);\n}\n\nfunction stableStringify(value: unknown): string {\n  if (value === null || typeof value !== 'object') {\n    return JSON.stringify(value);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(item => stableStringify(item)).join(',')}]`;\n  }\n  const entries = Object.entries(value as Record<string, unknown>).sort(([a], [b]) => a.localeCompare(b));\n  return `{${entries.map(([key, val]) => `${JSON.stringify(key)}:${stableStringify(val)}`).join(',')}}`;\n}\n\nfunction buildFingerprint(rawType: CardHubItem['rawType'], raw: string): string {\n  let source = raw;\n  if (rawType === 'json') {\n    const trimmed = raw.trim();\n    try {\n      source = stableStringify(JSON.parse(trimmed));\n    } catch {\n      source = trimmed;\n    }\n  }\n  return `${rawType}:${hashString(source)}`;\n}\n\nfunction ensureFingerprint(entry: CardHubItem): string | null {\n  if (entry.fingerprint) {\n    return entry.fingerprint;\n  }\n  if (!entry.rawType || !entry.raw) {\n    return null;\n  }\n  const fingerprint = buildFingerprint(entry.rawType, entry.raw);\n  entry.fingerprint = fingerprint;\n  return fingerprint;\n}\n\nexport function loadLibrary(): CardHubItem[] {\n  const stored = readLibrary().entries;\n  let changed = false;\n  const now = Date.now();\n  const entries = stored.map((entry, index) => {\n    const normalized: CardHubItem = {\n      ...entry,\n      origin: entry.origin ?? 'library',\n      tags: Array.isArray(entry.tags) ? entry.tags : [],\n      note: typeof entry.note === 'string' ? entry.note : '',\n    };\n    if (!normalized.tagsEdited && !normalized.tags.length && normalized.raw && normalized.rawType) {\n      const rawTags =\n        normalized.rawType === 'png' ? parsePngCardTags(normalized.raw) : parseJsonCardTags(normalized.raw);\n      if (rawTags.length) {\n        normalized.tags = rawTags;\n        changed = true;\n      }\n    }\n    if (typeof normalized.createdAt === 'number') {\n      return normalized;\n    }\n    changed = true;\n    return {\n      ...normalized,\n      createdAt: now - (stored.length - 1 - index) * 1000,\n    };\n  });\n  if (changed) {\n    writeLibrary(entries);\n  }\n  return entries;\n}\n\nexport async function addToLibrary(files: FileList | File[], existingEntries?: CardHubItem[]): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return loadLibrary();\n  }\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : loadLibrary();\n  const fingerprints = new Set<string>();\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n  });\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      const parsedName = parsePngCardName(dataUrl) ?? name;\n      const parsedTags = parsePngCardTags(dataUrl);\n      const fingerprint = buildFingerprint('png', dataUrl);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: dataUrl,\n        tags: parsedTags,\n        origin: 'library',\n        note: '',\n        importFileName: file.name,\n        rawType: 'png',\n        raw: dataUrl,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      const parsedTags = parseJsonCardTags(text);\n      const fingerprint = buildFingerprint('json', text);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: parsedTags,\n        origin: 'library',\n        note: '',\n        importFileName: file.name,\n        rawType: 'json',\n        raw: text,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  writeLibrary(merged);\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[], existingEntries?: CardHubItem[]): CardHubItem[] {\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags, tagsEdited: true };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function updateLibraryNote(entryId: string, note: string, existingEntries?: CardHubItem[]): CardHubItem[] {\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, note };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.filter(entry => entry.id !== entryId);\n  writeLibrary(updated);\n  return updated;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library.map(entry => ({\n    ...entry,\n    origin: entry.origin ?? 'library',\n    tags: Array.isArray(entry.tags) ? entry.tags : [],\n    note: typeof entry.note === 'string' ? entry.note : '',\n  }));\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar ? ctx.characters.find(character => character.avatar === target.avatar) : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nfunction getTagMapEntry(tagKey: string | null | undefined): { hasKey: boolean; tags: string[] } {\n  if (!tagKey) {\n    return { hasKey: false, tags: [] };\n  }\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return { hasKey: false, tags: [] };\n  }\n  const hasKey = Object.prototype.hasOwnProperty.call(ctx.tagMap, tagKey);\n  if (!hasKey) {\n    return { hasKey: false, tags: [] };\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const ids = ctx.tagMap[tagKey] ?? [];\n  const tags = ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n  return { hasKey: true, tags };\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const entry = getTagMapEntry(target.tagKey ?? target.avatar);\n  if (entry.hasKey) {\n    return entry.tags;\n  }\n  return target.tags ?? [];\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)));\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const tagKey = target.tagKey ?? character.avatar ?? null;\n  if (tagKey) {\n    ctx.tagMap![tagKey] = tagIds;\n  }\n\n  ctx.saveSettingsDebounced?.();\n  const st = window.parent?.SillyTavern ?? SillyTavern;\n  st?.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = { class: \"cardhub-manage__section\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"cardhub-manage__details\"\n};\nconst _hoisted_3 = { class: \"cardhub-manage__detail-label\" };\nconst _hoisted_4 = { class: \"cardhub-manage__detail-content\" };\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_7 = { class: \"cardhub-manage__section\" };\nconst _hoisted_8 = { class: \"cardhub-manage__label\" };\nconst _hoisted_9 = { class: \"cardhub-manage__content\" };\nconst _hoisted_10 = {\n    key: 0,\n    class: \"cardhub-manage__opening-meta\"\n};\nconst _hoisted_11 = { class: \"cardhub-manage__opening-meta-value\" };\nconst _hoisted_12 = {\n    key: 0,\n    class: \"cardhub-manage__opening-meta-hint\"\n};\nconst _hoisted_13 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_14 = {\n    key: 2,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_15 = { class: \"cardhub-manage__section\" };\nconst _hoisted_16 = { class: \"cardhub-manage__label\" };\nconst _hoisted_17 = { class: \"cardhub-manage__jump-row\" };\nconst _hoisted_18 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_19 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_20 = { class: \"cardhub-manage__chat-main\" };\nconst _hoisted_21 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_22 = {\n    key: 0,\n    class: \"cardhub-manage__chat-label\"\n};\nconst _hoisted_23 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_24 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_25 = {\n    key: 2,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_26 = [\"disabled\"];\nconst _hoisted_27 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_28 = [\"disabled\"];\nconst _hoisted_29 = { class: \"cardhub-manage__actions\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageContent',\n    props: {\n        manageCard: {},\n        manageDetails: {},\n        manageDetailsHint: {},\n        openingItems: {},\n        openingSummary: {},\n        manageChats: {},\n        pagedChats: {},\n        chatPage: {},\n        chatTotalPages: {},\n        manageChatHint: {},\n        openDetail: { type: Function },\n        openOpeningList: { type: Function },\n        openLatestChat: { type: Function },\n        openNewChat: { type: Function },\n        openChat: { type: Function },\n        prevChatPage: { type: Function },\n        nextChatPage: { type: Function },\n        handleCardAction: { type: Function },\n        manageDelete: { type: Function }\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _cache[19] || (_cache[19] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"\", -1 /* CACHED */)),\n                    (__props.manageDetails.length)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.manageDetails, (detail) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: detail.label,\n                                    class: \"cardhub-manage__detail\"\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_3, _toDisplayString(detail.label), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_4, _toDisplayString(detail.preview), 1 /* TEXT */),\n                                    (detail.hasMore)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"cardhub-manage__detail-toggle\",\n                                            type: \"button\",\n                                            onClick: ($event) => (__props.openDetail(detail))\n                                        }, \"  \", 8 /* PROPS */, _hoisted_5))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, _toDisplayString(__props.manageDetailsHint), 1 /* TEXT */))\n                ]),\n                _createElementVNode(\"div\", _hoisted_7, [\n                    _createElementVNode(\"div\", _hoisted_8, [\n                        _cache[20] || (_cache[20] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                        (__props.openingItems.length)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 0,\n                                class: \"cardhub-manage__toggle\",\n                                type: \"button\",\n                                onClick: _cache[0] || (_cache[0] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openOpeningList && __props.openOpeningList(...args)))\n                            }, \" \" + _toDisplayString(__props.openingItems.length) + \" \", 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_9, [\n                        (__props.openingSummary.hasData)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [\n                                _createElementVNode(\"span\", _hoisted_11, _toDisplayString(__props.openingSummary.value), 1 /* TEXT */),\n                                (__props.openingSummary.hint)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_12, _toDisplayString(__props.openingSummary.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true),\n                        (!__props.openingItems.length)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"\"))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \"\"))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_15, [\n                    _createElementVNode(\"div\", _hoisted_16, [\n                        _cache[21] || (_cache[21] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_17, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__btn is-primary\",\n                                type: \"button\",\n                                onClick: _cache[1] || (_cache[1] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openLatestChat && __props.openLatestChat(...args))),\n                                onPointerdown: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"])),\n                                onMousedown: _cache[3] || (_cache[3] = _withModifiers(() => { }, [\"stop\"])),\n                                onTouchstart: _cache[4] || (_cache[4] = _withModifiers(() => { }, [\"stop\"]))\n                            }, \"  \", 32 /* NEED_HYDRATION */),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__btn is-secondary\",\n                                type: \"button\",\n                                onClick: _cache[5] || (_cache[5] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openNewChat && __props.openNewChat(...args))),\n                                onPointerdown: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"])),\n                                onMousedown: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"])),\n                                onTouchstart: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"]))\n                            }, \"  \", 32 /* NEED_HYDRATION */)\n                        ])\n                    ]),\n                    (__props.pagedChats.length)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.pagedChats, (msg, index) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: index,\n                                    class: \"cardhub-manage__chat-row\",\n                                    role: \"button\",\n                                    tabindex: \"0\",\n                                    onClick: ($event) => (__props.openChat(msg)),\n                                    onKeydown: _withKeys(_withModifiers(($event) => (__props.openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_20, [\n                                        _createElementVNode(\"div\", _hoisted_21, _toDisplayString(msg.name), 1 /* TEXT */),\n                                        (msg.label && msg.label !== msg.name)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, _toDisplayString(msg.label), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]),\n                                    _createElementVNode(\"span\", _hoisted_23, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_19));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_24, _toDisplayString(__props.manageChatHint), 1 /* TEXT */)),\n                    (__props.chatTotalPages > 1)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__pager-btn\",\n                                type: \"button\",\n                                disabled: __props.chatPage <= 1,\n                                onClick: _cache[9] || (_cache[9] =\n                                    //@ts-ignore\n                                    (...args) => (__props.prevChatPage && __props.prevChatPage(...args)))\n                            }, \"  \", 8 /* PROPS */, _hoisted_26),\n                            _createElementVNode(\"span\", _hoisted_27, _toDisplayString(__props.chatPage) + \" / \" + _toDisplayString(__props.chatTotalPages), 1 /* TEXT */),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__pager-btn\",\n                                type: \"button\",\n                                disabled: __props.chatPage >= __props.chatTotalPages,\n                                onClick: _cache[10] || (_cache[10] =\n                                    //@ts-ignore\n                                    (...args) => (__props.nextChatPage && __props.nextChatPage(...args)))\n                            }, \"  \", 8 /* PROPS */, _hoisted_28)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createElementVNode(\"div\", _hoisted_29, [\n                    _createElementVNode(\"button\", {\n                        class: \"cardhub-manage__btn is-secondary\",\n                        type: \"button\",\n                        onClick: _cache[11] || (_cache[11] = _withModifiers(($event) => (__props.handleCardAction(__props.manageCard)), [\"stop\"])),\n                        onPointerdown: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"])),\n                        onMousedown: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"])),\n                        onTouchstart: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"]))\n                    }, _toDisplayString(__props.manageCard.origin === 'tavern' ? '' : ''), 33 /* TEXT, NEED_HYDRATION */),\n                    _createElementVNode(\"button\", {\n                        class: \"cardhub-manage__btn is-primary\",\n                        type: \"button\",\n                        onClick: _cache[15] || (_cache[15] = _withModifiers(($event) => (__props.manageDelete(__props.manageCard)), [\"stop\"])),\n                        onPointerdown: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"])),\n                        onMousedown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                        onTouchstart: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"]))\n                    }, \"  \", 32 /* NEED_HYDRATION */)\n                ])\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageContent.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageContent.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = { class: \"cardhub-manage__top\" };\nconst _hoisted_2 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_3 = { class: \"cardhub-preview__name\" };\nconst _hoisted_4 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_5 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_6 = { class: \"cardhub-manage__overview\" };\nconst _hoisted_7 = { class: \"cardhub-manage__overview-label\" };\nconst _hoisted_8 = { class: \"cardhub-manage__overview-value\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"cardhub-manage__overview-hint\"\n};\nconst _hoisted_10 = { class: \"cardhub-manage__media\" };\nconst _hoisted_11 = [\"src\"];\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageOverview',\n    props: {\n        manageCard: {},\n        manageAvatarUrl: {},\n        manageOverview: {},\n        displayTags: { type: Function },\n        openNoteDialog: { type: Function },\n        worldbookAvailable: { type: Boolean },\n        openWorldbookList: { type: Function }\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.manageCard.name), 1 /* TEXT */),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-note-trigger\",\n                            type: \"button\",\n                            \"aria-label\": \"\",\n                            onClick: _cache[0] || (_cache[0] =\n                                //@ts-ignore\n                                (...args) => (__props.openNoteDialog && __props.openNoteDialog(...args)))\n                        }, [...(_cache[2] || (_cache[2] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"fa-solid fa-pen\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */)\n                            ]))])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.manageCard.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.displayTags(__props.manageCard).length) + \" \", 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.displayTags(__props.manageCard), (tag) => {\n                            return (_openBlock(), _createElementBlock(\"span\", {\n                                key: tag,\n                                class: \"cardhub-preview__tag\"\n                            }, _toDisplayString(tag), 1 /* TEXT */));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_6, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.manageOverview, (item) => {\n                            return (_openBlock(), _createElementBlock(\"div\", {\n                                key: item.label,\n                                class: \"cardhub-manage__overview-card\"\n                            }, [\n                                _createElementVNode(\"div\", _hoisted_7, _toDisplayString(item.label), 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_8, _toDisplayString(item.value), 1 /* TEXT */),\n                                (item.hint)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, _toDisplayString(item.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (item.label === '' && __props.worldbookAvailable)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 1,\n                                        class: \"cardhub-manage__overview-action\",\n                                        type: \"button\",\n                                        onClick: _cache[1] || (_cache[1] =\n                                            //@ts-ignore\n                                            (...args) => (__props.openWorldbookList && __props.openWorldbookList(...args)))\n                                    }, \"  \"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_10, [\n                    (__props.manageAvatarUrl)\n                        ? (_openBlock(), _createElementBlock(\"img\", {\n                            key: 0,\n                            src: __props.manageAvatarUrl,\n                            alt: \"\"\n                        }, null, 8 /* PROPS */, _hoisted_11))\n                        : _createCommentVNode(\"v-if\", true)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageOverview.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageOverview.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-manage__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_2 = {\n    class: \"cardhub-note__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_3 = {\n    class: \"cardhub-openings__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_4 = { class: \"cardhub-openings__meta\" };\nconst _hoisted_5 = { key: 0 };\nconst _hoisted_6 = {\n    key: 0,\n    class: \"cardhub-openings__list\"\n};\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = { class: \"cardhub-openings__item-title\" };\nconst _hoisted_9 = { class: \"cardhub-openings__item-preview\" };\nconst _hoisted_10 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_11 = {\n    key: 2,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_14 = [\"disabled\"];\nconst _hoisted_15 = {\n    class: \"cardhub-worldbook__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_16 = { class: \"cardhub-worldbook__header\" };\nconst _hoisted_17 = { class: \"cardhub-worldbook__title\" };\nconst _hoisted_18 = { class: \"cardhub-worldbook__meta\" };\nconst _hoisted_19 = { key: 0 };\nconst _hoisted_20 = {\n    key: 0,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_21 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_22 = {\n    key: 2,\n    class: \"cardhub-worldbook__list\"\n};\nconst _hoisted_23 = [\"onClick\"];\nconst _hoisted_24 = { class: \"cardhub-worldbook__item-title\" };\nconst _hoisted_25 = {\n    key: 0,\n    class: \"cardhub-worldbook__item-disabled\"\n};\nconst _hoisted_26 = { class: \"cardhub-worldbook__item-preview\" };\nconst _hoisted_27 = {\n    key: 3,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_28 = {\n    key: 4,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_29 = [\"disabled\"];\nconst _hoisted_30 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_31 = [\"disabled\"];\nconst _hoisted_32 = [\"aria-label\"];\nconst _hoisted_33 = { class: \"cardhub-manage-viewer__header\" };\nconst _hoisted_34 = { class: \"cardhub-manage-viewer__title\" };\nconst _hoisted_35 = [\"innerHTML\"];\nimport { computed, ref, watch } from 'vue';\nimport ManageContent from './ManageContent.vue';\nimport ManageOverview from './ManageOverview.vue';\nconst worldbookPageSize = 10;\nconst chatPageSize = 6;\nconst openingPageSize = 10;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageModal',\n    props: {\n        card: {},\n        displayTags: { type: Function },\n        handleCardAction: { type: Function },\n        manageDelete: { type: Function },\n        closeManage: { type: Function },\n        closeRoot: { type: Function },\n        applyNoteUpdate: { type: Function },\n        parseLibraryCardData: { type: Function },\n        updateLastChatCacheForCard: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const manageCard = computed(() => props.card);\n        const manageOpenings = ref([]);\n        const manageWorldbookEntries = ref([]);\n        const manageProfile = ref(null);\n        const manageOpeningSummary = ref(null);\n        const manageChats = ref([]);\n        const manageChatSummary = ref(null);\n        const manageAvatarUrl = computed(() => (manageCard.value ? avatarUrl(manageCard.value, true) : null));\n        const manageDetailsHint = computed(() => {\n            if (!manageCard.value || manageDetails.value.length) {\n                return '';\n            }\n            if (manageCard.value.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageChatHint = computed(() => {\n            if (manageCard.value?.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageOverview = computed(() => {\n            const items = [];\n            const profile = manageProfile.value;\n            const worldName = profile?.worldBookName?.trim() || '';\n            const worldCount = profile?.worldBookCount;\n            let worldValue = '';\n            let worldHint = '';\n            if (worldName || typeof worldCount === 'number') {\n                worldValue = worldName || '';\n                worldHint = typeof worldCount === 'number' ? `${worldCount} ` : '';\n            }\n            items.push({ label: '', value: worldValue, hint: worldHint });\n            const chat = manageChatSummary.value;\n            let chatValue = '';\n            let chatHint = '';\n            if (chat && chat.total > 0) {\n                chatValue = `${chat.total} `;\n                if (chat.latest) {\n                    chatHint = `${chat.latest}`;\n                }\n            }\n            items.push({ label: '', value: chatValue, hint: chatHint });\n            return items;\n        });\n        const manageDetails = computed(() => {\n            const details = [];\n            const profile = manageProfile.value;\n            const pushDetail = (label, value, maxChars = 240) => {\n                const preview = previewDetailText(value, 3, maxChars);\n                if (preview) {\n                    details.push({ label, preview, full: value.trim(), hasMore: preview !== value.trim() });\n                }\n            };\n            if (manageCard.value?.origin === 'library' && manageCard.value.importFileName) {\n                pushDetail('', manageCard.value.importFileName, 120);\n            }\n            if (manageCard.value?.note?.trim()) {\n                pushDetail('', manageCard.value.note.trim(), 200);\n            }\n            if (profile) {\n                pushDetail('', profile.description ?? '');\n                pushDetail('', profile.personality ?? '');\n                pushDetail('', profile.scenario ?? '');\n                pushDetail('', profile.creatorNotes ?? '');\n                pushDetail('', profile.systemPrompt ?? '', 200);\n                pushDetail('', profile.postHistory ?? '', 200);\n                pushDetail('', profile.creator ?? '', 80);\n            }\n            return details;\n        });\n        const openingItems = computed(() => manageOpenings.value.map((opening, index) => ({\n            id: index,\n            preview: previewOpeningLines(opening, 2).join('\\n'),\n            html: renderOpeningHtml(opening),\n        })));\n        const openingSummary = computed(() => {\n            const opening = manageOpeningSummary.value;\n            const total = opening?.total ?? openingItems.value.length;\n            const alternate = opening?.alternate ?? 0;\n            if (!total) {\n                return { value: '', hint: '', hasData: false };\n            }\n            return {\n                value: ` ${total} `,\n                hint: alternate > 0 ? ` ${alternate} ` : '',\n                hasData: true,\n            };\n        });\n        const worldbookName = computed(() => manageProfile.value?.worldBookName?.trim() || '');\n        const worldbookAvailable = computed(() => Boolean(worldbookName.value || manageWorldbookEntries.value.length));\n        const worldbookEntries = ref([]);\n        const worldbookLoadedName = ref('');\n        const worldbookLoading = ref(false);\n        const worldbookError = ref('');\n        const worldbookOpen = ref(false);\n        const worldbookPage = ref(1);\n        const worldbookItems = computed(() => worldbookEntries.value.map((entry, index) => ({\n            uid: entry.uid ?? index,\n            name: entry.name || ` ${index + 1}`,\n            enabled: entry.enabled !== false,\n            preview: previewDetailText(String(entry.content ?? ''), 2, 200) || '',\n            content: String(entry.content ?? ''),\n        })));\n        const worldbookTotalPages = computed(() => Math.max(1, Math.ceil(worldbookItems.value.length / worldbookPageSize)));\n        const pagedWorldbookItems = computed(() => {\n            const start = (worldbookPage.value - 1) * worldbookPageSize;\n            return worldbookItems.value.slice(start, start + worldbookPageSize);\n        });\n        const worldbookSummary = computed(() => {\n            if (!worldbookAvailable.value) {\n                return '';\n            }\n            if (worldbookLoading.value) {\n                return '';\n            }\n            return ` ${worldbookItems.value.length} `;\n        });\n        const worldbookSummaryHint = computed(() => (worldbookItems.value.length ? worldbookName.value : ''));\n        const chatPage = ref(1);\n        const chatTotalPages = computed(() => Math.max(1, Math.ceil(manageChats.value.length / chatPageSize)));\n        const pagedChats = computed(() => {\n            const start = (chatPage.value - 1) * chatPageSize;\n            return manageChats.value.slice(start, start + chatPageSize);\n        });\n        const openingPage = ref(1);\n        const openingTotalPages = computed(() => Math.max(1, Math.ceil(openingItems.value.length / openingPageSize)));\n        const pagedOpenings = computed(() => {\n            const start = (openingPage.value - 1) * openingPageSize;\n            return openingItems.value.slice(start, start + openingPageSize);\n        });\n        const noteDialogOpen = ref(false);\n        const noteDraft = ref('');\n        const openingListOpen = ref(false);\n        const viewerOpen = ref(false);\n        const viewerTitle = ref('');\n        const viewerHtml = ref('');\n        let manageRequestId = 0;\n        watch(manageCard, card => {\n            if (!card) {\n                manageOpenings.value = [];\n                manageWorldbookEntries.value = [];\n                manageProfile.value = null;\n                manageOpeningSummary.value = null;\n                manageChats.value = [];\n                manageChatSummary.value = null;\n                chatPage.value = 1;\n                openingPage.value = 1;\n                noteDialogOpen.value = false;\n                noteDraft.value = '';\n                openingListOpen.value = false;\n                worldbookOpen.value = false;\n                worldbookEntries.value = [];\n                worldbookLoadedName.value = '';\n                worldbookLoading.value = false;\n                worldbookError.value = '';\n                worldbookPage.value = 1;\n                viewerOpen.value = false;\n                viewerTitle.value = '';\n                viewerHtml.value = '';\n                return;\n            }\n            void openManage(card);\n        }, { immediate: true });\n        function prevChatPage() {\n            if (chatPage.value > 1) {\n                chatPage.value -= 1;\n            }\n        }\n        function nextChatPage() {\n            if (chatPage.value < chatTotalPages.value) {\n                chatPage.value += 1;\n            }\n        }\n        async function openWorldbookList() {\n            const name = worldbookName.value;\n            if (!name && !manageWorldbookEntries.value.length) {\n                return;\n            }\n            worldbookOpen.value = true;\n            worldbookError.value = '';\n            worldbookPage.value = 1;\n            if (manageWorldbookEntries.value.length) {\n                worldbookEntries.value = manageWorldbookEntries.value;\n                worldbookLoadedName.value = name || 'embedded';\n                return;\n            }\n            if (worldbookLoadedName.value === name && worldbookEntries.value.length) {\n                return;\n            }\n            if (typeof getWorldbook !== 'function') {\n                worldbookError.value = '';\n                return;\n            }\n            worldbookLoading.value = true;\n            try {\n                const entries = await getWorldbook(name);\n                worldbookEntries.value = Array.isArray(entries) ? entries : [];\n                worldbookLoadedName.value = name;\n            }\n            catch (error) {\n                worldbookError.value = '';\n                worldbookEntries.value = [];\n                console.warn('[CardHub] ', error);\n            }\n            finally {\n                worldbookLoading.value = false;\n            }\n        }\n        function closeWorldbookList() {\n            worldbookOpen.value = false;\n        }\n        function prevWorldbookPage() {\n            if (worldbookPage.value > 1) {\n                worldbookPage.value -= 1;\n            }\n        }\n        function nextWorldbookPage() {\n            if (worldbookPage.value < worldbookTotalPages.value) {\n                worldbookPage.value += 1;\n            }\n        }\n        function openOpeningList() {\n            if (!openingItems.value.length) {\n                return;\n            }\n            openingPage.value = 1;\n            openingListOpen.value = true;\n        }\n        function closeOpeningList() {\n            openingListOpen.value = false;\n        }\n        function prevOpeningPage() {\n            if (openingPage.value > 1) {\n                openingPage.value -= 1;\n            }\n        }\n        function nextOpeningPage() {\n            if (openingPage.value < openingTotalPages.value) {\n                openingPage.value += 1;\n            }\n        }\n        function openNoteDialog() {\n            if (!manageCard.value) {\n                return;\n            }\n            noteDraft.value = manageCard.value.note ?? '';\n            noteDialogOpen.value = true;\n        }\n        function closeNoteDialog() {\n            noteDialogOpen.value = false;\n        }\n        function saveNoteDialog() {\n            if (!manageCard.value) {\n                return;\n            }\n            props.applyNoteUpdate(manageCard.value, noteDraft.value);\n            noteDialogOpen.value = false;\n        }\n        function openDetailViewer(detail) {\n            viewerTitle.value = detail.label;\n            viewerHtml.value = textToHtml(detail.full || detail.preview);\n            viewerOpen.value = true;\n        }\n        function openOpeningViewer(item) {\n            openingListOpen.value = false;\n            viewerTitle.value = ` ${item.id + 1}`;\n            viewerHtml.value = item.html || textToHtml(item.preview);\n            viewerOpen.value = true;\n        }\n        function openWorldbookEntry(item) {\n            worldbookOpen.value = false;\n            viewerTitle.value = item.name || '';\n            viewerHtml.value = textToHtml(item.content);\n            viewerOpen.value = true;\n        }\n        function closeViewer() {\n            viewerOpen.value = false;\n        }\n        async function openManage(card) {\n            const requestId = ++manageRequestId;\n            manageOpenings.value = [];\n            manageWorldbookEntries.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n            chatPage.value = 1;\n            openingPage.value = 1;\n            openingListOpen.value = false;\n            worldbookOpen.value = false;\n            worldbookEntries.value = [];\n            worldbookLoadedName.value = '';\n            worldbookLoading.value = false;\n            worldbookError.value = '';\n            worldbookPage.value = 1;\n            const [manageResult, chatsResult] = await Promise.allSettled([resolveManageData(card), resolveRecentChats(card)]);\n            if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n                return;\n            }\n            const manageData = manageResult.status === 'fulfilled'\n                ? manageResult.value\n                : { openings: [], profile: null, openingSummary: null, worldbookEntries: [] };\n            manageOpenings.value = manageData.openings;\n            manageProfile.value = manageData.profile;\n            manageOpeningSummary.value = manageData.openingSummary;\n            manageWorldbookEntries.value = manageData.worldbookEntries;\n            const chatData = chatsResult.status === 'fulfilled' ? chatsResult.value : { list: [], summary: null };\n            manageChats.value = chatData.list;\n            manageChatSummary.value = chatData.summary;\n        }\n        async function resolveManageData(card) {\n            if (card.origin !== 'tavern') {\n                const data = props.parseLibraryCardData(card);\n                return {\n                    openings: extractOpeningMessages(data),\n                    profile: extractCardProfile(data),\n                    openingSummary: extractOpeningSummary(data),\n                    worldbookEntries: extractWorldbookEntries(data),\n                };\n            }\n            const raw = await getFullCharacterData(card);\n            const fallback = raw ??\n                TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            const primary = raw ?? fallback;\n            let openings = extractOpeningMessages(primary);\n            if (!openings.length && fallback && fallback !== primary) {\n                openings = extractOpeningMessages(fallback);\n            }\n            const openingSummary = extractOpeningSummary(primary ?? fallback);\n            return {\n                openings,\n                profile: extractCardProfile(primary ?? fallback),\n                openingSummary,\n                worldbookEntries: extractWorldbookEntries(primary ?? fallback),\n            };\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return { list: [], summary: null };\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return { list: [], summary: { total: 0, latest: '' } };\n            }\n            const sorted = sortChatBrief(brief);\n            const latestTimestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n            props.updateLastChatCacheForCard(card, latestTimestamp);\n            const list = sorted.map((entry) => ({\n                name: formatChatTitle(entry),\n                label: formatChatFileLabel(entry),\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n            }));\n            const latest = extractChatLatestLabel(sorted[0]);\n            return {\n                list,\n                summary: {\n                    total: brief.length,\n                    latest,\n                },\n            };\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openNewChat() {\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            try {\n                await triggerSlash('/newchat');\n                props.closeManage();\n                props.closeRoot();\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n                toastr.error('');\n            }\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('');\n                return;\n            }\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            const { ctx, st } = selection;\n            const target = normalizeChatId(file);\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] ', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                props.closeManage();\n                props.closeRoot();\n                return;\n            }\n            toastr.warning('');\n        }\n        async function selectManageCharacter(options = {}) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            if (idx < 0) {\n                toastr.warning('');\n                return null;\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (!selector) {\n                toastr.warning('');\n                return null;\n            }\n            try {\n                await selector(idx, { switchMenu: false });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n            if (options.ensureSelected && !selected) {\n                toastr.warning('');\n                return null;\n            }\n            return { ctx, st, idx };\n        }\n        function getCurrentCharacterId(ctx, st) {\n            const value = ctx?.characterId ?? st?.characterId ?? '';\n            return value === undefined || value === null ? '' : String(value);\n        }\n        async function waitForCharacterSelection(idx, ctx, st, timeoutMs) {\n            const target = String(idx);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = getCurrentCharacterId(ctx, st);\n                if (current === target) {\n                    return true;\n                }\n                await sleep(80);\n            }\n            return false;\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await sleep(200);\n            }\n            return false;\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function findCharacterIndex(list, card) {\n            const targetName = normalizeNameKey(card.name);\n            const targetAvatar = card.avatar ? normalizeAvatarKey(card.avatar) : '';\n            const byAvatar = targetAvatar\n                ? list.findIndex(item => normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\n                : -1;\n            if (byAvatar >= 0) {\n                return byAvatar;\n            }\n            const byName = list.findIndex(item => normalizeNameKey(String(item.name ?? '')) === targetName);\n            if (byName >= 0) {\n                return byName;\n            }\n            return list.findIndex(item => normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function normalizeAvatarKey(value) {\n            let raw = value.trim();\n            if (!raw) {\n                return '';\n            }\n            try {\n                raw = decodeURIComponent(raw);\n            }\n            catch {\n                // ignore\n            }\n            raw = raw.split('?')[0];\n            if (raw.includes('/')) {\n                raw = raw.split('/').pop() ?? raw;\n            }\n            return raw.trim().toLowerCase();\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar) : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractCardProfile(data) {\n            if (!data) {\n                return null;\n            }\n            const profile = {\n                description: pickString(data?.description, data?.data?.description),\n                personality: pickString(data?.personality, data?.data?.personality),\n                scenario: pickString(data?.scenario, data?.data?.scenario),\n                creatorNotes: pickString(data?.creatorcomment, data?.data?.creatorcomment, data?.creator_notes, data?.data?.creator_notes),\n                systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n                postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n                creator: pickString(data?.creator, data?.data?.creator),\n            };\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (book) {\n                profile.worldBookName = pickString(book?.name);\n                profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n            }\n            const hasValue = Boolean(profile.description) ||\n                Boolean(profile.personality) ||\n                Boolean(profile.scenario) ||\n                Boolean(profile.creatorNotes) ||\n                Boolean(profile.systemPrompt) ||\n                Boolean(profile.postHistory) ||\n                Boolean(profile.creator) ||\n                Boolean(profile.worldBookName) ||\n                typeof profile.worldBookCount === 'number';\n            return hasValue ? profile : null;\n        }\n        function extractWorldbookEntries(data) {\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (!book || !Array.isArray(book?.entries)) {\n                return [];\n            }\n            return book.entries;\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function extractOpeningSummary(data) {\n            if (!data) {\n                return null;\n            }\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            let alternate = 0;\n            if (Array.isArray(alt)) {\n                alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                alternate = 1;\n            }\n            return {\n                total: firstCount + alternate,\n                alternate,\n            };\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function formatChatTitle(entry) {\n            const label = extractChatLatestLabel(entry);\n            return label || '';\n        }\n        function formatChatFileLabel(entry) {\n            const raw = pickString(entry?.file_name, entry?.file_id);\n            if (!raw) {\n                return '';\n            }\n            return raw.replace(/\\.jsonl$/i, '');\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function previewDetailText(text, maxLines, maxChars) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return '';\n            }\n            const lines = extractContentLines(trimmed);\n            const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n            let preview = source.slice(0, maxLines).join('\\n').trim();\n            if (!preview) {\n                return '';\n            }\n            const truncated = preview.length > maxChars;\n            if (truncated) {\n                preview = preview.slice(0, maxChars).trim();\n            }\n            const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n            if (hasMore && !preview.endsWith('')) {\n                preview = `${preview}`;\n            }\n            return preview;\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function renderOpeningHtml(text) {\n            const trimmed = stripCodeFences(text).trim();\n            if (!trimmed) {\n                return '';\n            }\n            if (/<\\/?[a-z][\\s\\S]*>/i.test(trimmed)) {\n                return trimmed;\n            }\n            return escapeHtml(trimmed).replace(/\\n/g, '<br>');\n        }\n        function escapeHtml(text) {\n            return text\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#39;');\n        }\n        function textToHtml(text) {\n            const trimmed = stripCodeFences(text).trim();\n            if (!trimmed) {\n                return '';\n            }\n            return escapeHtml(trimmed).replace(/\\n/g, '<br>');\n        }\n        function stripCodeFences(text) {\n            return text.replace(/^\\s*```[a-zA-Z0-9_-]*\\s*$/gm, '').replace(/^\\s*```\\s*$/gm, '');\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        function sortChatBrief(list) {\n            return [...list].sort((a, b) => (extractChatLatestTimestamp(b) ?? 0) - (extractChatLatestTimestamp(a) ?? 0));\n        }\n        function extractChatLatestLabel(entry) {\n            return pickString(entry?.chat_name, entry?.chat_title, entry?.name, entry?.file_name, entry?.file_id);\n        }\n        function extractChatLatestTimestamp(entry) {\n            const raw = entry?.last_message_time ??\n                entry?.last_message_date ??\n                entry?.last_message_timestamp ??\n                entry?.last_chat_time ??\n                entry?.last_chat_date ??\n                entry?.last_interaction ??\n                entry?.update_time ??\n                entry?.timestamp ??\n                entry?.time ??\n                null;\n            return coerceToTimestamp(raw) ?? parseTimestampFromText(String(entry?.file_name ?? entry?.file_id ?? ''));\n        }\n        function coerceToTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                return value < 1e12 ? value * 1000 : value;\n            }\n            if (typeof value === 'string') {\n                const parsed = Date.parse(value);\n                if (!Number.isNaN(parsed)) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function parseTimestampFromText(raw) {\n            const text = raw.replace(/\\.jsonl$/i, '').trim();\n            const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:](\\d{1,2})(?:[:](\\d{1,2}))?)?/;\n            const match = text.match(pattern);\n            if (!match) {\n                return null;\n            }\n            const year = Number(match[1]);\n            const month = Number(match[2]);\n            const day = Number(match[3]);\n            const hour = match[4] ? Number(match[4]) : 0;\n            const minute = match[5] ? Number(match[5]) : 0;\n            const second = match[6] ? Number(match[6]) : 0;\n            if (!year || !month || !day) {\n                return null;\n            }\n            const value = new Date(year, month - 1, day, hour, minute, second).getTime();\n            return Number.isNaN(value) ? null : value;\n        }\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-manage cardhub-modal\",\n                        onClick: _cache[1] || (_cache[1] = _withModifiers(\n                        //@ts-ignore\n                        (...args) => (__props.closeManage && __props.closeManage(...args)), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_1, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: _cache[0] || (_cache[0] =\n                                    //@ts-ignore\n                                    (...args) => (__props.closeManage && __props.closeManage(...args)))\n                            }, \"\"),\n                            _createVNode(ManageOverview, {\n                                \"manage-card\": manageCard.value,\n                                \"manage-avatar-url\": manageAvatarUrl.value,\n                                \"manage-overview\": manageOverview.value,\n                                \"display-tags\": __props.displayTags,\n                                \"open-note-dialog\": openNoteDialog,\n                                \"worldbook-available\": worldbookAvailable.value,\n                                \"open-worldbook-list\": openWorldbookList\n                            }, null, 8 /* PROPS */, [\"manage-card\", \"manage-avatar-url\", \"manage-overview\", \"display-tags\", \"worldbook-available\"]),\n                            _createVNode(ManageContent, {\n                                \"manage-card\": manageCard.value,\n                                \"manage-details\": manageDetails.value,\n                                \"manage-details-hint\": manageDetailsHint.value,\n                                \"opening-items\": openingItems.value,\n                                \"opening-summary\": openingSummary.value,\n                                \"manage-chats\": manageChats.value,\n                                \"paged-chats\": pagedChats.value,\n                                \"chat-page\": chatPage.value,\n                                \"chat-total-pages\": chatTotalPages.value,\n                                \"manage-chat-hint\": manageChatHint.value,\n                                \"open-detail\": openDetailViewer,\n                                \"open-opening-list\": openOpeningList,\n                                \"open-latest-chat\": openLatestChat,\n                                \"open-new-chat\": openNewChat,\n                                \"open-chat\": openChat,\n                                \"prev-chat-page\": prevChatPage,\n                                \"next-chat-page\": nextChatPage,\n                                \"handle-card-action\": __props.handleCardAction,\n                                \"manage-delete\": __props.manageDelete\n                            }, null, 8 /* PROPS */, [\"manage-card\", \"manage-details\", \"manage-details-hint\", \"opening-items\", \"opening-summary\", \"manage-chats\", \"paged-chats\", \"chat-page\", \"chat-total-pages\", \"manage-chat-hint\", \"handle-card-action\", \"manage-delete\"])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (noteDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-note cardhub-modal\",\n                        onClick: _withModifiers(closeNoteDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_2, [\n                            _createElementVNode(\"div\", { class: \"cardhub-note__header\" }, [\n                                _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"cardhub-note__title\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeNoteDialog\n                                }, \"\")\n                            ]),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((noteDraft).value = $event)),\n                                class: \"cardhub-note__input\",\n                                placeholder: \"\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, noteDraft.value]\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-note__actions\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-note__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeNoteDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-note__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveNoteDialog\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (openingListOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"cardhub-openings cardhub-modal\",\n                        onClick: _withModifiers(closeOpeningList, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _createElementVNode(\"div\", { class: \"cardhub-openings__header\" }, [\n                                _cache[4] || (_cache[4] = _createElementVNode(\"div\", { class: \"cardhub-openings__title\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeOpeningList\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_4, [\n                                _createElementVNode(\"span\", null, _toDisplayString(openingSummary.value.value), 1 /* TEXT */),\n                                (openingSummary.value.hint)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_5, _toDisplayString(openingSummary.value.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            (pagedOpenings.value.length)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedOpenings.value, (item) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: item.id,\n                                            class: \"cardhub-openings__item\",\n                                            type: \"button\",\n                                            onClick: ($event) => (openOpeningViewer(item))\n                                        }, [\n                                            _createElementVNode(\"div\", _hoisted_8, \" \" + _toDisplayString(item.id + 1), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_9, _toDisplayString(item.preview), 1 /* TEXT */)\n                                        ], 8 /* PROPS */, _hoisted_7));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \"\")),\n                            (openingTotalPages.value > 1)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: openingPage.value <= 1,\n                                        onClick: prevOpeningPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_12),\n                                    _createElementVNode(\"span\", _hoisted_13, _toDisplayString(openingPage.value) + \" / \" + _toDisplayString(openingTotalPages.value), 1 /* TEXT */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: openingPage.value >= openingTotalPages.value,\n                                        onClick: nextOpeningPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_14)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (worldbookOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"cardhub-worldbook cardhub-modal\",\n                        onClick: _withModifiers(closeWorldbookList, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_15, [\n                            _createElementVNode(\"div\", _hoisted_16, [\n                                _createElementVNode(\"div\", _hoisted_17, _toDisplayString(worldbookName.value || ''), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeWorldbookList\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_18, [\n                                _createElementVNode(\"span\", null, _toDisplayString(worldbookSummary.value), 1 /* TEXT */),\n                                (worldbookSummaryHint.value)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_19, _toDisplayString(worldbookSummaryHint.value), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            (worldbookLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20, \"...\"))\n                                : (worldbookError.value)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, _toDisplayString(worldbookError.value), 1 /* TEXT */))\n                                    : (pagedWorldbookItems.value.length)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedWorldbookItems.value, (item) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: item.uid,\n                                                    class: \"cardhub-worldbook__item\",\n                                                    type: \"button\",\n                                                    onClick: ($event) => (openWorldbookEntry(item))\n                                                }, [\n                                                    _createElementVNode(\"div\", _hoisted_24, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(item.name), 1 /* TEXT */),\n                                                        (!item.enabled)\n                                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_25, \"\"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_26, _toDisplayString(item.preview), 1 /* TEXT */)\n                                                ], 8 /* PROPS */, _hoisted_23));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_27, \"\")),\n                            (worldbookTotalPages.value > 1)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_28, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: worldbookPage.value <= 1,\n                                        onClick: prevWorldbookPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_29),\n                                    _createElementVNode(\"span\", _hoisted_30, _toDisplayString(worldbookPage.value) + \" / \" + _toDisplayString(worldbookTotalPages.value), 1 /* TEXT */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: worldbookPage.value >= worldbookTotalPages.value,\n                                        onClick: nextWorldbookPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_31)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (viewerOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"cardhub-manage-viewer cardhub-modal\",\n                        onClick: _withModifiers(closeViewer, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"cardhub-manage-viewer__panel cardhub-modal__panel\",\n                            role: \"dialog\",\n                            \"aria-label\": viewerTitle.value\n                        }, [\n                            _createElementVNode(\"div\", _hoisted_33, [\n                                _createElementVNode(\"div\", _hoisted_34, _toDisplayString(viewerTitle.value), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeViewer\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", {\n                                class: \"cardhub-manage-viewer__content\",\n                                innerHTML: viewerHtml.value\n                            }, null, 8 /* PROPS */, _hoisted_35)\n                        ], 8 /* PROPS */, _hoisted_32)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageModal.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageModal.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { computed, ref, type ComputedRef } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype ConfirmResult = 'confirm' | 'cancel' | 'alt';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\ntype BatchTagOptions = {\n  allCards: ComputedRef<CardHubItem[]>;\n  filteredCharacters: ComputedRef<CardHubItem[]>;\n  allTags: ComputedRef<string[]>;\n  displayTags: (card: CardHubItem) => string[];\n  applyTagUpdate: (card: CardHubItem, tags: string[]) => void;\n  openConfirm: (options: ConfirmOptions) => Promise<ConfirmResult>;\n};\n\nexport function useBatchTags(options: BatchTagOptions) {\n  const tagManagerOpen = ref(false);\n  const tagManagerTab = ref<'filter' | 'batch'>('filter');\n  const batchTagSelectedIds = ref<string[]>([]);\n  const batchTagSearch = ref('');\n  const batchTagInput = ref('');\n  const batchTagSelectedTags = ref<string[]>([]);\n\n  const batchTagCandidates = computed(() => options.filteredCharacters.value);\n  const batchTagVisibleCandidates = computed(() => {\n    const keyword = batchTagSearch.value.trim().toLowerCase();\n    if (!keyword) {\n      return batchTagCandidates.value;\n    }\n    return batchTagCandidates.value.filter(card => {\n      if (card.name.toLowerCase().includes(keyword)) {\n        return true;\n      }\n      const tags = options.displayTags(card);\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\n    });\n  });\n\n  const batchTagSelectedSet = computed(() => new Set(batchTagSelectedIds.value));\n  const batchTagSuggestions = computed(() => options.allTags.value);\n\n  function openTagManager(tab: 'filter' | 'batch' = 'filter') {\n    if (tab === 'batch') {\n      if (!batchTagVisibleCandidates.value.length) {\n        toastr.warning('');\n        return;\n      }\n      batchTagInput.value = '';\n      batchTagSearch.value = '';\n      batchTagSelectedTags.value = [];\n      batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n    }\n    tagManagerTab.value = tab;\n    tagManagerOpen.value = true;\n  }\n\n  function closeTagManager() {\n    tagManagerOpen.value = false;\n  }\n\n  function toggleBatchTagSelection(id: string) {\n    if (batchTagSelectedSet.value.has(id)) {\n      batchTagSelectedIds.value = batchTagSelectedIds.value.filter(item => item !== id);\n    } else {\n      batchTagSelectedIds.value = [...batchTagSelectedIds.value, id];\n    }\n  }\n\n  function selectAllBatchTags() {\n    batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n  }\n\n  function clearBatchTagSelection() {\n    batchTagSelectedIds.value = [];\n  }\n\n  function parseBatchTags(input: string, selected: string[]): string[] {\n    const items = input\n      .split(/[,\\n;]/)\n      .map(part => part.trim())\n      .filter(Boolean);\n    return Array.from(new Set([...items, ...selected]));\n  }\n\n  function getCardsByIds(ids: string[]): CardHubItem[] {\n    const map = new Map(options.allCards.value.map(card => [card.id, card]));\n    return ids.map(id => map.get(id)).filter(Boolean) as CardHubItem[];\n  }\n\n  function toggleBatchTagSuggestion(tag: string) {\n    if (batchTagSelectedTags.value.includes(tag)) {\n      batchTagSelectedTags.value = batchTagSelectedTags.value.filter(item => item !== tag);\n    } else {\n      batchTagSelectedTags.value = [...batchTagSelectedTags.value, tag];\n    }\n  }\n\n  function isSameTagSet(current: string[], next: string[]): boolean {\n    if (current.length !== next.length) {\n      return false;\n    }\n    const currentSet = new Set(current);\n    return next.every(tag => currentSet.has(tag));\n  }\n\n  async function applyBatchTags(mode: 'add' | 'remove') {\n    if (!batchTagSelectedIds.value.length) {\n      toastr.warning('');\n      return;\n    }\n    const tags = parseBatchTags(batchTagInput.value, batchTagSelectedTags.value);\n    if (!tags.length) {\n      toastr.warning('');\n      return;\n    }\n    const actionLabel = mode === 'add' ? '' : '';\n    const message = `${actionLabel}${tags.join('')}\\n ${batchTagSelectedIds.value.length} `;\n    const result = await options.openConfirm({\n      title: `${actionLabel}`,\n      message,\n      confirmLabel: `${actionLabel}`,\n      cancelLabel: '',\n    });\n    if (result !== 'confirm') {\n      return;\n    }\n    const cards = getCardsByIds(batchTagSelectedIds.value);\n    let changed = 0;\n    cards.forEach(card => {\n      const currentTags = options.displayTags(card);\n      const nextSet = new Set(currentTags);\n      if (mode === 'add') {\n        tags.forEach(tag => nextSet.add(tag));\n      } else {\n        tags.forEach(tag => nextSet.delete(tag));\n      }\n      const nextTags = Array.from(nextSet);\n      if (!isSameTagSet(currentTags, nextTags)) {\n        options.applyTagUpdate(card, nextTags);\n        changed += 1;\n      }\n    });\n    toastr.success(` ${changed} `);\n  }\n\n  return {\n    tagManagerOpen,\n    tagManagerTab,\n    openTagManager,\n    closeTagManager,\n    batchTagSelectedIds,\n    batchTagSearch,\n    batchTagInput,\n    batchTagSelectedTags,\n    batchTagSelectedSet,\n    batchTagVisibleCandidates,\n    batchTagSuggestions,\n    toggleBatchTagSelection,\n    selectAllBatchTags,\n    clearBatchTagSelection,\n    toggleBatchTagSuggestion,\n    applyBatchTags,\n  };\n}\n","import { computed, ref, type ComputedRef, type Ref } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype ConfirmResult = 'confirm' | 'cancel' | 'alt';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\ntype LibraryActionOptions = {\n  allCards: ComputedRef<CardHubItem[]>;\n  stateSearch: Ref<string>;\n  selectedTags: Ref<string[]>;\n  statusFilter: Ref<'all' | 'imported' | 'unimported'>;\n  getCharacters: () => CardHubItem[];\n  getLibrary: () => CardHubItem[];\n  setLibrary: (library: CardHubItem[]) => void;\n  setCharacters: (characters: CardHubItem[]) => void;\n  fetchCharacterSummaries: () => Promise<CardHubItem[]>;\n  addToLibrary: (files: FileList | File[], existingEntries?: CardHubItem[]) => Promise<CardHubItem[]>;\n  removeFromLibrary: (entryId: string) => CardHubItem[];\n  updateCharacterTags: (target: CardHubItem, nextTags: string[]) => string[];\n  parseLibraryCardData: (card: CardHubItem) => any | null;\n  extractCardTagsFromData: (data: any) => string[];\n  normalizeNameKey: (value: string) => string;\n  normalizeAvatarKey: (value: string) => string;\n  dataUrlToBlob: (dataUrl: string) => Promise<Blob>;\n  downloadBlob: (blob: Blob, fileName: string) => void;\n  openConfirm: (options: ConfirmOptions) => Promise<ConfirmResult>;\n  closeManage: () => void;\n  sleep: (ms: number) => Promise<void>;\n};\n\nexport function useLibraryActions(options: LibraryActionOptions) {\n  const importInput = ref<HTMLInputElement | null>(null);\n  const exportDialogOpen = ref(false);\n  const exportSelectedIds = ref<string[]>([]);\n  const exportSearch = ref('');\n  const exportStatusFilter = ref<'all' | 'imported' | 'unimported'>('all');\n  const exportTagFilters = ref<string[]>([]);\n\n  const exportCandidates = computed(() => [...options.allCards.value]);\n  const exportAllTags = computed(() => {\n    const tagSet = new Set<string>();\n    exportCandidates.value.forEach(card => {\n      (card.tags ?? []).forEach(tag => tagSet.add(tag));\n    });\n    exportTagFilters.value.forEach(tag => tagSet.add(tag));\n    return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n  });\n  const exportVisibleCandidates = computed(() => {\n    let list = exportCandidates.value;\n    if (exportStatusFilter.value === 'imported') {\n      list = list.filter(item => item.origin === 'tavern');\n    } else if (exportStatusFilter.value === 'unimported') {\n      list = list.filter(item => item.origin === 'library');\n    }\n    if (exportTagFilters.value.length) {\n      list = list.filter(card => exportTagFilters.value.some(tag => (card.tags ?? []).includes(tag)));\n    }\n    const keyword = exportSearch.value.trim().toLowerCase();\n    if (!keyword) {\n      return list;\n    }\n    return list.filter(card => {\n      if (card.name.toLowerCase().includes(keyword)) {\n        return true;\n      }\n      const tags = card.tags ?? [];\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\n    });\n  });\n  const exportSelectedSet = computed(() => new Set(exportSelectedIds.value));\n  const exportSelectedItems = computed(() =>\n    exportCandidates.value.filter(item => exportSelectedSet.value.has(item.id)),\n  );\n\n  function openExportDialog() {\n    exportDialogOpen.value = true;\n    exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n  }\n\n  function isExportSelected(id: string): boolean {\n    return exportSelectedSet.value.has(id);\n  }\n\n  function toggleExportSelection(id: string) {\n    if (exportSelectedSet.value.has(id)) {\n      exportSelectedIds.value = exportSelectedIds.value.filter(item => item !== id);\n    } else {\n      exportSelectedIds.value = [...exportSelectedIds.value, id];\n    }\n  }\n\n  function selectAllExport() {\n    exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n  }\n\n  function clearExportSelection() {\n    exportSelectedIds.value = [];\n  }\n\n  function triggerImport() {\n    importInput.value?.click();\n  }\n\n  async function handleImportFiles(event: Event) {\n    const target = event.target as HTMLInputElement | null;\n    const files = target?.files;\n    if (!files || !files.length) {\n      return;\n    }\n    const updated = await options.addToLibrary(files, options.getLibrary());\n    options.setLibrary(updated);\n    target.value = '';\n  }\n\n  function findDuplicateCharacterByName(name: string): CardHubItem | null {\n    const target = options.normalizeNameKey(name);\n    if (!target) {\n      return null;\n    }\n    return options.getCharacters().find(item => options.normalizeNameKey(item.name) === target) ?? null;\n  }\n\n  async function importLibraryCard(card: CardHubItem) {\n    if (!card.raw || !card.rawType) {\n      toastr.error('');\n      return;\n    }\n    const duplicate = findDuplicateCharacterByName(card.name);\n    if (duplicate) {\n      toastr.warning(`${duplicate.name}`);\n      return;\n    }\n    const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\n    delete (headers as Record<string, string>)['Content-Type'];\n\n    const beforeCharacters = await options.fetchCharacterSummaries();\n    const beforeAvatarKeys = new Set(\n      beforeCharacters.map(item => options.normalizeAvatarKey(item.avatar ?? '')).filter(Boolean),\n    );\n\n    if (card.rawType === 'png') {\n      const blob = await options.dataUrlToBlob(card.raw);\n      await TavernHelper.importRawCharacter(card.name, blob);\n    } else {\n      const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n      const form = new FormData();\n      form.append('avatar', file);\n      form.append('file_type', 'json');\n      form.append('preserved_name', file.name);\n      await fetch('/api/characters/import', {\n        method: 'POST',\n        headers,\n        body: form,\n        cache: 'no-cache',\n      });\n    }\n\n    const characters = await options.fetchCharacterSummaries();\n    const expectedNames = new Set([card.name]);\n    if (card.rawType === 'json') {\n      try {\n        const parsed = JSON.parse(card.raw) as { name?: string; data?: { name?: string } };\n        if (parsed?.name) {\n          expectedNames.add(parsed.name);\n        }\n        if (parsed?.data?.name) {\n          expectedNames.add(parsed.data.name);\n        }\n      } catch {\n        // ignore invalid json name parsing\n      }\n    }\n    const matchedByAvatar = characters.find(item => {\n      const avatarKey = options.normalizeAvatarKey(item.avatar ?? '');\n      return avatarKey && !beforeAvatarKeys.has(avatarKey);\n    });\n    const matchedByName = characters.find(item =>\n      Array.from(expectedNames).some(name => options.normalizeNameKey(item.name) === options.normalizeNameKey(name)),\n    );\n    const importedCard = matchedByAvatar ?? matchedByName ?? null;\n    if (importedCard) {\n      options.setLibrary(options.removeFromLibrary(card.id));\n      const rawTags = card.tags?.length\n        ? card.tags\n        : options.extractCardTagsFromData(options.parseLibraryCardData(card));\n      if (rawTags.length) {\n        const cleanedTags = options.updateCharacterTags(importedCard, rawTags);\n        importedCard.tags = cleanedTags;\n      }\n      toastr.success(` ${card.name}`);\n    } else {\n      toastr.warning(`${card.name}`);\n    }\n    options.setCharacters(characters);\n  }\n\n  async function exportLibraryCard(card: CardHubItem) {\n    if (!card.raw || !card.rawType) {\n      toastr.error('');\n      return;\n    }\n    if (card.rawType === 'png') {\n      const blob = await options.dataUrlToBlob(card.raw);\n      options.downloadBlob(blob, `${card.name}.png`);\n      return;\n    }\n    const blob = new Blob([card.raw], { type: 'application/json' });\n    options.downloadBlob(blob, `${card.name}.json`);\n  }\n\n  async function exportCard(card: CardHubItem) {\n    if (card.origin === 'library') {\n      await exportLibraryCard(card);\n      return;\n    }\n    if (!card.avatar) {\n      toastr.error('');\n      return;\n    }\n    const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n    if (!avatarPath) {\n      toastr.error('');\n      return;\n    }\n    const response = await fetch(avatarPath, { cache: 'no-cache' });\n    const blob = await response.blob();\n    options.downloadBlob(blob, `${card.name}.png`);\n  }\n\n  async function exportSelected() {\n    openExportDialog();\n  }\n\n  async function confirmExportSelected() {\n    const list = exportSelectedItems.value;\n    if (!list.length) {\n      toastr.warning('');\n      return;\n    }\n    const tagLabel = options.selectedTags.value.length ? options.selectedTags.value.join('') : '';\n    const statusLabel =\n      options.statusFilter.value === 'all' ? '' : options.statusFilter.value === 'imported' ? '' : '';\n    const searchLabel = options.stateSearch.value.trim() || '';\n    const message =\n      ` ${list.length} \\n` +\n      `${statusLabel}\\n` +\n      `${tagLabel}\\n` +\n      `${searchLabel}\\n` +\n      ``;\n\n    const result = await options.openConfirm({\n      title: '',\n      message,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (result !== 'confirm') {\n      return;\n    }\n    exportDialogOpen.value = false;\n    for (const item of list) {\n      await exportCard(item);\n      await options.sleep(120);\n    }\n    toastr.success(` ${list.length} `);\n  }\n\n  async function handleCardAction(card: CardHubItem) {\n    if (card.origin === 'library') {\n      await importLibraryCard(card);\n    } else {\n      exportCard(card);\n    }\n  }\n\n  async function moveToLibrary(card: CardHubItem) {\n    if (!card.avatar) {\n      return;\n    }\n    const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n    if (!avatarPath) {\n      toastr.error('');\n      return;\n    }\n    const response = await fetch(avatarPath, { cache: 'no-cache' });\n    const blob = await response.blob();\n    const updated = await options.addToLibrary([new File([blob], `${card.name}.png`, { type: 'image/png' })]);\n    options.setLibrary(updated);\n  }\n\n  function getCurrentCharacterId(ctx: any, st: typeof SillyTavern | undefined): string {\n    const value = ctx?.characterId ?? st?.characterId ?? '';\n    return value === undefined || value === null ? '' : String(value);\n  }\n\n  async function waitForCharacterSelection(\n    idx: number,\n    ctx: any,\n    st: typeof SillyTavern | undefined,\n    timeoutMs: number,\n  ): Promise<boolean> {\n    const target = String(idx);\n    const start = Date.now();\n    while (Date.now() - start < timeoutMs) {\n      const current = getCurrentCharacterId(ctx, st);\n      if (current === target) {\n        return true;\n      }\n      await options.sleep(80);\n    }\n    return false;\n  }\n\n  function findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\n    const targetName = options.normalizeNameKey(card.name);\n    const targetAvatar = card.avatar ? options.normalizeAvatarKey(card.avatar) : '';\n    const byAvatar = targetAvatar\n      ? list.findIndex(item => options.normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\n      : -1;\n    if (byAvatar >= 0) {\n      return byAvatar;\n    }\n    const byName = list.findIndex(item => options.normalizeNameKey(String(item.name ?? '')) === targetName);\n    if (byName >= 0) {\n      return byName;\n    }\n    return list.findIndex(item => options.normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\n  }\n\n  async function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\n    if (!card.avatar) {\n      toastr.error('');\n      return false;\n    }\n    let st: typeof SillyTavern | undefined;\n    try {\n      st = window.parent?.SillyTavern;\n    } catch {\n      st = undefined;\n    }\n    st ??= SillyTavern;\n    const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n    const list = ctx?.characters ?? st?.characters ?? [];\n    const targetIdx = findCharacterIndex(list, card);\n    const currentId = getCurrentCharacterId(ctx, st);\n    const deletingActive = targetIdx >= 0 && currentId && String(targetIdx) === String(currentId);\n    if (deletingActive) {\n      if (list.length > 1) {\n        const nextIdx = targetIdx === 0 ? 1 : 0;\n        const selector =\n          (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n          (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n        if (selector) {\n          try {\n            await selector(nextIdx, { switchMenu: false });\n            await waitForCharacterSelection(nextIdx, ctx, st, 3000);\n          } catch (error) {\n            console.warn('[CardHub] ', error);\n          }\n        }\n      } else {\n        toastr.warning('');\n      }\n    }\n    const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\n      | Record<string, string>\n      | undefined;\n    if (!headers || !Object.keys(headers).length) {\n      toastr.error('');\n      return false;\n    }\n    const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n    const response = await fetch('/api/characters/delete', {\n      method: 'POST',\n      headers: { ...headers, 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n      cache: 'no-cache',\n    });\n    if (response.ok) {\n      try {\n        await triggerSlash('/closechat');\n      } catch (error) {\n        console.warn('[CardHub] ', error);\n      }\n      return true;\n    }\n    const detail = await response.text();\n    toastr.error(`${response.status} ${detail || response.statusText}`);\n    return false;\n  }\n\n  async function manageDelete(card: CardHubItem) {\n    if (card.origin === 'library') {\n      const confirmDelete = await options.openConfirm({\n        title: '',\n        message: `${card.name}`,\n        confirmLabel: '',\n        cancelLabel: '',\n      });\n      if (confirmDelete !== 'confirm') {\n        return;\n      }\n      options.setLibrary(options.removeFromLibrary(card.id));\n      options.closeManage();\n      return;\n    }\n\n    const confirmDelete = await options.openConfirm({\n      title: '',\n      message: `${card.name}`,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (confirmDelete !== 'confirm') {\n      return;\n    }\n    const deleteChoice = await options.openConfirm({\n      title: '',\n      message: `${card.name}\\n` + `- \\n` + `- `,\n      confirmLabel: '',\n      altLabel: '',\n      cancelLabel: '',\n    });\n    if (deleteChoice === 'cancel') {\n      return;\n    }\n    if (deleteChoice === 'confirm') {\n      await moveToLibrary(card);\n      const deleted = await deleteFromTavern(card, false);\n      if (!deleted) {\n        return;\n      }\n      options.closeManage();\n      const characters = await options.fetchCharacterSummaries();\n      options.setCharacters(characters);\n      return;\n    }\n    const confirmPermanent = await options.openConfirm({\n      title: '',\n      message: `${card.name}`,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (confirmPermanent !== 'confirm') {\n      return;\n    }\n    const deleted = await deleteFromTavern(card, true);\n    if (!deleted) {\n      return;\n    }\n    options.closeManage();\n    const characters = await options.fetchCharacterSummaries();\n    options.setCharacters(characters);\n  }\n\n  return {\n    importInput,\n    exportDialogOpen,\n    exportSearch,\n    exportStatusFilter,\n    exportTagFilters,\n    exportAllTags,\n    exportVisibleCandidates,\n    exportSelectedItems,\n    exportSelectedIds,\n    openExportDialog,\n    exportSelected,\n    confirmExportSelected,\n    isExportSelected,\n    toggleExportSelection,\n    selectAllExport,\n    clearExportSelection,\n    triggerImport,\n    handleImportFiles,\n    handleCardAction,\n    importLibraryCard,\n    exportCard,\n    exportLibraryCard,\n    manageDelete,\n  };\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, withModifiers as _withModifiers, createTextVNode as _createTextVNode, isRef as _isRef, withKeys as _withKeys, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub \"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-filter-row\" };\nconst _hoisted_6 = { class: \"cardhub-filter-block\" };\nconst _hoisted_7 = { class: \"cardhub-chip-row\" };\nconst _hoisted_8 = { class: \"cardhub-filter-block\" };\nconst _hoisted_9 = { class: \"cardhub-chip-row\" };\nconst _hoisted_10 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = { class: \"cardhub-content\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_15 = {\n    key: 2,\n    class: \"cardhub-grid-wrap\"\n};\nconst _hoisted_16 = { class: \"cardhub-pagination\" };\nconst _hoisted_17 = {\n    key: 0,\n    class: \"cardhub-pagination__actions\"\n};\nconst _hoisted_18 = [\"disabled\"];\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = { class: \"cardhub-pagination__status\" };\nconst _hoisted_21 = { class: \"cardhub-grid\" };\nconst _hoisted_22 = [\"onClick\"];\nconst _hoisted_23 = { class: \"cardhub-card__info\" };\nconst _hoisted_24 = { class: \"cardhub-card__head\" };\nconst _hoisted_25 = { class: \"cardhub-card__name\" };\nconst _hoisted_26 = [\"onClick\"];\nconst _hoisted_27 = { class: \"cardhub-card__meta\" };\nconst _hoisted_28 = {\n    key: 0,\n    class: \"cardhub-card__note\"\n};\nconst _hoisted_29 = { class: \"cardhub-card__tags\" };\nconst _hoisted_30 = [\"onClick\"];\nconst _hoisted_31 = [\"onClick\"];\nconst _hoisted_32 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_33 = [\"onClick\"];\nconst _hoisted_34 = { class: \"cardhub-card__actions\" };\nconst _hoisted_35 = [\"onClick\"];\nconst _hoisted_36 = [\"onClick\"];\nconst _hoisted_37 = {\n    class: \"cardhub-confirm__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\"\n};\nconst _hoisted_38 = { class: \"cardhub-confirm__title\" };\nconst _hoisted_39 = { class: \"cardhub-confirm__message\" };\nconst _hoisted_40 = { class: \"cardhub-confirm__actions\" };\nconst _hoisted_41 = {\n    class: \"cardhub-tag-manager__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_42 = { class: \"cardhub-tag-manager__header\" };\nconst _hoisted_43 = {\n    key: 0,\n    class: \"cardhub-tag-manager__subtitle\"\n};\nconst _hoisted_44 = {\n    key: 1,\n    class: \"cardhub-tag-manager__subtitle\"\n};\nconst _hoisted_45 = { class: \"cardhub-tag-manager__tabs\" };\nconst _hoisted_46 = {\n    key: 0,\n    class: \"cardhub-tag-manager__section\"\n};\nconst _hoisted_47 = { class: \"cardhub-tag-manager__actions\" };\nconst _hoisted_48 = [\"disabled\"];\nconst _hoisted_49 = { class: \"cardhub-tag-manager__list\" };\nconst _hoisted_50 = [\"onClick\"];\nconst _hoisted_51 = {\n    key: 1,\n    class: \"cardhub-tag-manager__section cardhub-tag-manager__batch\"\n};\nconst _hoisted_52 = { class: \"cardhub-batch__filters\" };\nconst _hoisted_53 = { class: \"cardhub-batch__field\" };\nconst _hoisted_54 = {\n    key: 0,\n    class: \"cardhub-batch__suggestions\"\n};\nconst _hoisted_55 = { class: \"cardhub-batch__suggest-row\" };\nconst _hoisted_56 = [\"onClick\"];\nconst _hoisted_57 = { class: \"cardhub-batch__toolbar\" };\nconst _hoisted_58 = { class: \"cardhub-batch__list\" };\nconst _hoisted_59 = [\"checked\", \"onChange\"];\nconst _hoisted_60 = { class: \"cardhub-batch__main\" };\nconst _hoisted_61 = { class: \"cardhub-batch__name\" };\nconst _hoisted_62 = { class: \"cardhub-batch__meta\" };\nconst _hoisted_63 = {\n    key: 0,\n    class: \"cardhub-batch__tags\"\n};\nconst _hoisted_64 = {\n    class: \"cardhub-export__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_65 = { class: \"cardhub-export__header\" };\nconst _hoisted_66 = { class: \"cardhub-export__subtitle\" };\nconst _hoisted_67 = { class: \"cardhub-export__filters\" };\nconst _hoisted_68 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_69 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_70 = [\"onClick\"];\nconst _hoisted_71 = { class: \"cardhub-export__toolbar\" };\nconst _hoisted_72 = { class: \"cardhub-export__list\" };\nconst _hoisted_73 = [\"checked\", \"onChange\"];\nconst _hoisted_74 = { class: \"cardhub-export__main\" };\nconst _hoisted_75 = { class: \"cardhub-export__name\" };\nconst _hoisted_76 = { class: \"cardhub-export__meta\" };\nconst _hoisted_77 = {\n    key: 0,\n    class: \"cardhub-export__tags\"\n};\nconst _hoisted_78 = {\n    class: \"cardhub-theme__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_79 = { class: \"cardhub-theme__grid\" };\nconst _hoisted_80 = { class: \"cardhub-theme__field\" };\nconst _hoisted_81 = { class: \"cardhub-theme__field\" };\nconst _hoisted_82 = { class: \"cardhub-theme__field\" };\nconst _hoisted_83 = { class: \"cardhub-theme__field\" };\nconst _hoisted_84 = { class: \"cardhub-theme__field\" };\nconst _hoisted_85 = { class: \"cardhub-theme__field\" };\nconst _hoisted_86 = { class: \"cardhub-theme__field\" };\nconst _hoisted_87 = { class: \"cardhub-theme__field\" };\nconst _hoisted_88 = { class: \"cardhub-theme__field\" };\nconst _hoisted_89 = { class: \"cardhub-theme__presets\" };\nconst _hoisted_90 = [\"onClick\"];\nimport { computed, nextTick, onMounted, reactive, ref, toRef, watch } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryNote, updateLibraryTags, } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nimport ManageModal from './components/ManageModal.vue';\nimport { useBatchTags } from './composables/useBatchTags';\nimport { useLibraryActions } from './composables/useLibraryActions';\nimport { useTagEditing } from './composables/useTagEditing';\nimport { useTagFilters } from './composables/useTagFilters';\nconst FAVORITES_KEY = 'cardhub_favorites';\nconst LAST_CHAT_CACHE_KEY = 'cardhub_last_chat_cache';\nconst IMPORT_CACHE_KEY = 'cardhub_import_cache';\nconst NOTE_KEY = 'cardhub_notes';\nconst THEME_KEY = 'cardhub_theme';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const statusFilter = ref('all');\n        const pageSize = ref(24);\n        const currentPage = ref(1);\n        const manageCard = ref(null);\n        const confirmState = reactive({\n            open: false,\n            title: '',\n            message: '',\n            confirmLabel: '',\n            cancelLabel: '',\n            altLabel: '',\n            resolve: null,\n        });\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const mergedTagsMap = computed(() => {\n            const map = new Map();\n            allCards.value.forEach(card => {\n                map.set(card.id, getMergedTags(card));\n            });\n            return map;\n        });\n        const { selectedTags, allTags, applyTagFilter, toggleTagFilter, clearTagFilter } = useTagFilters(allCards, getMergedTags);\n        const favoriteIds = ref([]);\n        const favoriteSet = computed(() => new Set(favoriteIds.value));\n        const sortKey = ref('recent');\n        const favoritesOnly = ref(false);\n        const lastChatCache = ref({});\n        const importCache = ref({});\n        const noteMap = ref({});\n        const defaultTheme = {\n            bgStart: '#f6f8fb',\n            bgEnd: '#e6ebf2',\n            surface: '#fdfdfe',\n            surfaceAlt: '#f1f4f9',\n            text: '#1b1e22',\n            textMuted: '#6b7480',\n            accent: '#7fb3e1',\n            accentStrong: '#243a52',\n            border: '#d5dde8',\n        };\n        const themeDialogOpen = ref(false);\n        const themeCurrent = ref({ ...defaultTheme });\n        const themeDraft = reactive({ ...defaultTheme });\n        const themeStyle = computed(() => {\n            const theme = themeDialogOpen.value ? themeDraft : themeCurrent.value;\n            return {\n                '--cardhub-bg-start': theme.bgStart,\n                '--cardhub-bg-end': theme.bgEnd,\n                '--cardhub-surface': theme.surface,\n                '--cardhub-surface-alt': theme.surfaceAlt,\n                '--cardhub-text': theme.text,\n                '--cardhub-text-muted': theme.textMuted,\n                '--cardhub-accent': theme.accent,\n                '--cardhub-accent-strong': theme.accentStrong,\n                '--cardhub-border': theme.border,\n                '--cardhub-surface-rgb': hexToRgb(theme.surface),\n                '--cardhub-surface-alt-rgb': hexToRgb(theme.surfaceAlt),\n                '--cardhub-border-rgb': hexToRgb(theme.border),\n                '--cardhub-accent-rgb': hexToRgb(theme.accent),\n                '--cardhub-accent-strong-rgb': hexToRgb(theme.accentStrong),\n                '--cardhub-accent-text': contrastTextColor(theme.accent),\n                '--cardhub-accent-strong-text': contrastTextColor(theme.accentStrong),\n            };\n        });\n        const themePresets = [\n            {\n                name: '',\n                value: {\n                    bgStart: '#f6f8fb',\n                    bgEnd: '#e6ebf2',\n                    surface: '#fdfdfe',\n                    surfaceAlt: '#f1f4f9',\n                    text: '#1b1e22',\n                    textMuted: '#6b7480',\n                    accent: '#7fb3e1',\n                    accentStrong: '#243a52',\n                    border: '#d5dde8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fdfaf4',\n                    bgEnd: '#f2ebe1',\n                    surface: '#fffefb',\n                    surfaceAlt: '#f7efe6',\n                    text: '#1d1a17',\n                    textMuted: '#7a6f63',\n                    accent: '#e3a981',\n                    accentStrong: '#3f2c22',\n                    border: '#e4d7c8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#14181d',\n                    bgEnd: '#0d1116',\n                    surface: '#1e242b',\n                    surfaceAlt: '#242b34',\n                    text: '#eef2f7',\n                    textMuted: '#b2bdc9',\n                    accent: '#6fa2d1',\n                    accentStrong: '#d7e6f4',\n                    border: '#36414c',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f7f1e7',\n                    bgEnd: '#e6d8c6',\n                    surface: '#fcf6ee',\n                    surfaceAlt: '#f2e4d6',\n                    text: '#2a1f18',\n                    textMuted: '#8a6d5a',\n                    accent: '#c47b52',\n                    accentStrong: '#3e2a22',\n                    border: '#ddc7b4',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fbf1ea',\n                    bgEnd: '#ecd5c8',\n                    surface: '#fff7f1',\n                    surfaceAlt: '#f4e1d6',\n                    text: '#2d2018',\n                    textMuted: '#8b6a5a',\n                    accent: '#d17a4f',\n                    accentStrong: '#4c2d21',\n                    border: '#e3c3b3',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f2fbf7',\n                    bgEnd: '#dcefe7',\n                    surface: '#f9fffd',\n                    surfaceAlt: '#e8f4f0',\n                    text: '#1a2a26',\n                    textMuted: '#5f7a73',\n                    accent: '#60b6a4',\n                    accentStrong: '#1f4c43',\n                    border: '#c5ddd5',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f3f8fb',\n                    bgEnd: '#d9e7f3',\n                    surface: '#f9fcff',\n                    surfaceAlt: '#e9f2f9',\n                    text: '#1b2530',\n                    textMuted: '#5f7388',\n                    accent: '#5da3cf',\n                    accentStrong: '#1f3e57',\n                    border: '#c8d9e7',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#2a2d33',\n                    bgEnd: '#1e2126',\n                    surface: '#333741',\n                    surfaceAlt: '#3b404b',\n                    text: '#f3f5f8',\n                    textMuted: '#c1c7d0',\n                    accent: '#9aa6b2',\n                    accentStrong: '#e0e5ea',\n                    border: '#4b5261',\n                },\n            },\n        ];\n        const filteredCharacters = computed(() => {\n            const list = applyFavoriteFilter(applyStatusFilter(allCards.value));\n            const keyword = state.search.trim().toLowerCase();\n            if (!keyword) {\n                return sortCards(applyTagFilter(list));\n            }\n            return sortCards(applyTagFilter(list).filter(character => {\n                const name = character.name.toLowerCase();\n                if (name.includes(keyword)) {\n                    return true;\n                }\n                const tags = mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n                return tags.some(tag => tag.toLowerCase().includes(keyword));\n            }));\n        });\n        const { tagManagerOpen, tagManagerTab, openTagManager, closeTagManager, batchTagSelectedIds, batchTagSearch, batchTagInput, batchTagSelectedTags, batchTagSelectedSet, batchTagVisibleCandidates, batchTagSuggestions, toggleBatchTagSelection, selectAllBatchTags, clearBatchTagSelection, toggleBatchTagSuggestion, applyBatchTags, } = useBatchTags({\n            allCards,\n            filteredCharacters,\n            allTags,\n            displayTags,\n            applyTagUpdate,\n            openConfirm,\n        });\n        const stateSearch = toRef(state, 'search');\n        const { importInput, exportDialogOpen, exportSearch, exportStatusFilter, exportTagFilters, exportAllTags, exportVisibleCandidates, exportSelectedItems, exportSelectedIds, openExportDialog, exportSelected, confirmExportSelected, isExportSelected, toggleExportSelection, selectAllExport, clearExportSelection, triggerImport, handleImportFiles, handleCardAction, importLibraryCard, exportCard, exportLibraryCard, manageDelete, } = useLibraryActions({\n            allCards,\n            stateSearch,\n            selectedTags,\n            statusFilter,\n            getCharacters: () => state.characters,\n            getLibrary: () => state.library,\n            setLibrary,\n            setCharacters: setCharactersWithNotes,\n            fetchCharacterSummaries,\n            addToLibrary,\n            removeFromLibrary,\n            updateCharacterTags,\n            parseLibraryCardData,\n            extractCardTagsFromData,\n            normalizeNameKey,\n            normalizeAvatarKey,\n            dataUrlToBlob,\n            downloadBlob,\n            openConfirm,\n            closeManage,\n            sleep,\n        });\n        const totalPages = computed(() => {\n            const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n            return total > 0 ? total : 1;\n        });\n        const pagedCharacters = computed(() => {\n            const start = (currentPage.value - 1) * pageSize.value;\n            return filteredCharacters.value.slice(start, start + pageSize.value);\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n        }\n        function displayNote(character) {\n            return character.note?.trim() ?? '';\n        }\n        function applyFavoriteFilter(list) {\n            if (!favoritesOnly.value) {\n                return list;\n            }\n            return list.filter(item => favoriteSet.value.has(item.id));\n        }\n        function getFavoriteList() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[FAVORITES_KEY];\n            return Array.isArray(raw) ? raw.filter(item => typeof item === 'string') : [];\n        }\n        function saveFavoriteList(list) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [FAVORITES_KEY]: list });\n        }\n        function loadLastChatCache() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[LAST_CHAT_CACHE_KEY];\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveLastChatCache(cache) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [LAST_CHAT_CACHE_KEY]: cache });\n        }\n        function loadImportCache() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[IMPORT_CACHE_KEY];\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveImportCache(cache) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [IMPORT_CACHE_KEY]: cache });\n        }\n        function loadNoteMap() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[NOTE_KEY];\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'string' && value.trim().length > 0);\n            return Object.fromEntries(entries);\n        }\n        function saveNoteMap(map) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [NOTE_KEY]: map });\n        }\n        function getChatCacheKey(card) {\n            if (card.origin !== 'tavern') {\n                return null;\n            }\n            if (card.avatar) {\n                return `avatar:${card.avatar}`;\n            }\n            if (card.name) {\n                return `name:${card.name}`;\n            }\n            return null;\n        }\n        function getImportAt(card) {\n            if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                return card.createdAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (importCache.value[key] ?? 0) : 0;\n        }\n        function getLastChatAt(card) {\n            if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                return card.lastChatAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (lastChatCache.value[key] ?? 0) : 0;\n        }\n        function updateLastChatCache(key, timestamp) {\n            const next = { ...lastChatCache.value, [key]: timestamp };\n            lastChatCache.value = next;\n            saveLastChatCache(next);\n        }\n        function updateLastChatCacheForCard(card, timestamp) {\n            if (timestamp <= 0 || card.origin !== 'tavern') {\n                return;\n            }\n            const keys = new Set();\n            if (card.avatar) {\n                keys.add(`avatar:${card.avatar}`);\n            }\n            if (card.name) {\n                keys.add(`name:${card.name}`);\n            }\n            if (!keys.size) {\n                return;\n            }\n            const next = { ...lastChatCache.value };\n            let changed = false;\n            keys.forEach(key => {\n                if ((next[key] ?? 0) < timestamp) {\n                    next[key] = timestamp;\n                    changed = true;\n                }\n            });\n            if (changed) {\n                lastChatCache.value = next;\n                saveLastChatCache(next);\n            }\n        }\n        function updateImportCache(next) {\n            importCache.value = next;\n            saveImportCache(next);\n        }\n        function isFavorite(id) {\n            return favoriteSet.value.has(id);\n        }\n        function toggleFavorite(card) {\n            if (favoriteSet.value.has(card.id)) {\n                favoriteIds.value = favoriteIds.value.filter(item => item !== card.id);\n            }\n            else {\n                favoriteIds.value = [...favoriteIds.value, card.id];\n            }\n            saveFavoriteList(favoriteIds.value);\n        }\n        function sortCards(list) {\n            const withScore = list.map(item => {\n                const tags = mergedTagsMap.value.get(item.id) ?? getMergedTags(item);\n                return {\n                    item,\n                    tagCount: tags.length,\n                };\n            });\n            const byName = (a, b) => a.localeCompare(b, 'zh-CN');\n            return withScore\n                .sort((lhs, rhs) => {\n                const a = lhs.item;\n                const b = rhs.item;\n                if (sortKey.value === 'name') {\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'tags') {\n                    if (rhs.tagCount !== lhs.tagCount) {\n                        return rhs.tagCount - lhs.tagCount;\n                    }\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'imported') {\n                    const aTime = getImportAt(a);\n                    const bTime = getImportAt(b);\n                    if (bTime !== aTime) {\n                        return bTime - aTime;\n                    }\n                    return byName(a.name, b.name);\n                }\n                const aTime = getLastChatAt(a);\n                const bTime = getLastChatAt(b);\n                if (bTime !== aTime) {\n                    return bTime - aTime;\n                }\n                const aCreated = a.createdAt ?? 0;\n                const bCreated = b.createdAt ?? 0;\n                if (bCreated !== aCreated) {\n                    return bCreated - aCreated;\n                }\n                return byName(a.name, b.name);\n            })\n                .map(entry => entry.item);\n        }\n        function isLibraryItem(item) {\n            if (item.origin === 'library' || Boolean(item.rawType)) {\n                return true;\n            }\n            return state.library.some(entry => entry.id === item.id);\n        }\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => !isLibraryItem(item));\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => isLibraryItem(item));\n            }\n            return list;\n        }\n        function hexToRgb(value) {\n            const hex = value.replace('#', '');\n            if (hex.length !== 6) {\n                return '0, 0, 0';\n            }\n            const r = Number.parseInt(hex.slice(0, 2), 16);\n            const g = Number.parseInt(hex.slice(2, 4), 16);\n            const b = Number.parseInt(hex.slice(4, 6), 16);\n            return `${r}, ${g}, ${b}`;\n        }\n        function contrastTextColor(value) {\n            const rgb = hexToRgb(value)\n                .split(',')\n                .map(part => Number(part.trim()));\n            if (rgb.length !== 3) {\n                return '#1b1b1b';\n            }\n            const [r, g, b] = rgb.map(channel => channel / 255);\n            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n            return luminance > 0.6 ? '#1b1b1b' : '#ffffff';\n        }\n        function normalizeTheme(raw) {\n            if (!raw || typeof raw !== 'object') {\n                return { ...defaultTheme };\n            }\n            const data = raw;\n            const pick = (key) => {\n                const value = data[key];\n                return /^#[0-9a-f]{6}$/i.test(value) ? value : defaultTheme[key];\n            };\n            return {\n                bgStart: pick('bgStart'),\n                bgEnd: pick('bgEnd'),\n                surface: pick('surface'),\n                surfaceAlt: pick('surfaceAlt'),\n                text: pick('text'),\n                textMuted: pick('textMuted'),\n                accent: pick('accent'),\n                accentStrong: pick('accentStrong'),\n                border: pick('border'),\n            };\n        }\n        function getCardHubRoot() {\n            try {\n                return (window.parent?.document ?? document).querySelector('.cardhub-root');\n            }\n            catch {\n                return document.querySelector('.cardhub-root');\n            }\n        }\n        let themeFrame = 0;\n        let themeTimer = null;\n        function scheduleThemeApply(theme) {\n            if (themeFrame) {\n                cancelAnimationFrame(themeFrame);\n                themeFrame = 0;\n            }\n            if (themeTimer) {\n                window.clearTimeout(themeTimer);\n            }\n            themeTimer = window.setTimeout(() => {\n                themeTimer = null;\n                themeFrame = requestAnimationFrame(() => {\n                    themeFrame = 0;\n                    applyTheme(theme);\n                });\n            }, 80);\n        }\n        function applyTheme(theme) {\n            const root = getCardHubRoot();\n            if (!root) {\n                return;\n            }\n            root.style.setProperty('--cardhub-bg-start', theme.bgStart);\n            root.style.setProperty('--cardhub-bg-end', theme.bgEnd);\n            root.style.setProperty('--cardhub-surface', theme.surface);\n            root.style.setProperty('--cardhub-surface-alt', theme.surfaceAlt);\n            root.style.setProperty('--cardhub-text', theme.text);\n            root.style.setProperty('--cardhub-text-muted', theme.textMuted);\n            root.style.setProperty('--cardhub-accent', theme.accent);\n            root.style.setProperty('--cardhub-accent-strong', theme.accentStrong);\n            root.style.setProperty('--cardhub-border', theme.border);\n            root.style.setProperty('--cardhub-surface-rgb', hexToRgb(theme.surface));\n            root.style.setProperty('--cardhub-surface-alt-rgb', hexToRgb(theme.surfaceAlt));\n            root.style.setProperty('--cardhub-border-rgb', hexToRgb(theme.border));\n            root.style.setProperty('--cardhub-accent-rgb', hexToRgb(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-rgb', hexToRgb(theme.accentStrong));\n            root.style.setProperty('--cardhub-accent-text', contrastTextColor(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-text', contrastTextColor(theme.accentStrong));\n        }\n        function loadThemeFromGlobal() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            return normalizeTheme(vars?.[THEME_KEY]);\n        }\n        function saveThemeToGlobal(theme) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [THEME_KEY]: theme });\n        }\n        function openThemeDialog() {\n            const current = themeCurrent.value;\n            Object.assign(themeDraft, current);\n            themeDialogOpen.value = true;\n            nextTick(() => scheduleThemeApply(current));\n        }\n        function closeThemeDialog() {\n            themeDialogOpen.value = false;\n            Object.assign(themeDraft, themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n        }\n        function resetThemeDraft() {\n            Object.assign(themeDraft, defaultTheme);\n        }\n        function saveThemeDraft() {\n            themeCurrent.value = { ...themeDraft };\n            saveThemeToGlobal(themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n            themeDialogOpen.value = false;\n        }\n        function applyThemePreset(preset) {\n            Object.assign(themeDraft, preset.value);\n        }\n        function toggleExportTagFilter(tag) {\n            if (exportTagFilters.value.includes(tag)) {\n                exportTagFilters.value = exportTagFilters.value.filter(item => item !== tag);\n            }\n            else {\n                exportTagFilters.value = [...exportTagFilters.value, tag];\n            }\n        }\n        function clearExportTagFilter() {\n            exportTagFilters.value = [];\n        }\n        watch(themeDraft, value => {\n            if (themeDialogOpen.value) {\n                scheduleThemeApply({ ...value });\n            }\n        }, { deep: true });\n        onMounted(() => {\n            const theme = loadThemeFromGlobal();\n            themeCurrent.value = theme;\n            Object.assign(themeDraft, theme);\n            nextTick(() => scheduleThemeApply(theme));\n            favoriteIds.value = getFavoriteList();\n            lastChatCache.value = loadLastChatCache();\n            importCache.value = loadImportCache();\n            noteMap.value = loadNoteMap();\n            void warmRecentChatCache(allCards.value);\n            warmImportCache(allCards.value);\n        });\n        function closeExportDialog() {\n            exportDialogOpen.value = false;\n        }\n        watch([() => state.search, statusFilter, () => selectedTags.value.join('|'), sortKey, favoritesOnly], () => {\n            currentPage.value = 1;\n        });\n        watch([filteredCharacters, totalPages], () => {\n            if (currentPage.value > totalPages.value) {\n                currentPage.value = totalPages.value;\n            }\n            if (currentPage.value < 1) {\n                currentPage.value = 1;\n            }\n        });\n        watch([sortKey, allCards], () => {\n            if (sortKey.value === 'recent') {\n                void warmRecentChatCache(allCards.value);\n            }\n            if (sortKey.value === 'imported') {\n                warmImportCache(allCards.value);\n            }\n        });\n        function prevPage() {\n            if (currentPage.value > 1) {\n                currentPage.value -= 1;\n            }\n        }\n        function nextPage() {\n            if (currentPage.value < totalPages.value) {\n                currentPage.value += 1;\n            }\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function normalizeAvatarKey(value) {\n            let raw = value.trim();\n            if (!raw) {\n                return '';\n            }\n            try {\n                raw = decodeURIComponent(raw);\n            }\n            catch {\n                // ignore\n            }\n            raw = raw.split('?')[0];\n            if (raw.includes('/')) {\n                raw = raw.split('/').pop() ?? raw;\n            }\n            return raw.trim().toLowerCase();\n        }\n        function getNoteStorageKey(card) {\n            if (card.origin !== 'tavern') {\n                return null;\n            }\n            const key = card.tagKey ?? card.avatar ?? card.name;\n            if (!key) {\n                return null;\n            }\n            return `tavern:${key}`;\n        }\n        function applyNotesToCharacters(list) {\n            return list.map(card => {\n                const noteKey = getNoteStorageKey(card);\n                if (!noteKey) {\n                    return { ...card, note: card.note ?? '' };\n                }\n                return { ...card, note: noteMap.value[noteKey] ?? '' };\n            });\n        }\n        function setCharactersWithNotes(list) {\n            setCharacters(applyNotesToCharacters(list));\n        }\n        function openConfirm(options) {\n            if (confirmState.open && confirmState.resolve) {\n                confirmState.resolve('cancel');\n            }\n            confirmState.title = options.title ?? '';\n            confirmState.message = options.message;\n            confirmState.confirmLabel = options.confirmLabel ?? '';\n            confirmState.cancelLabel = options.cancelLabel ?? '';\n            confirmState.altLabel = options.altLabel ?? '';\n            confirmState.open = true;\n            return new Promise(resolve => {\n                confirmState.resolve = resolve;\n            });\n        }\n        function resolveConfirm(result) {\n            if (!confirmState.open) {\n                return;\n            }\n            confirmState.open = false;\n            const resolver = confirmState.resolve;\n            confirmState.resolve = null;\n            if (resolver) {\n                resolver(result);\n            }\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (isLibraryItem(character)) {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags, state.library);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTags(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        const { tagKey, activeTagKey, tagInput, startTagEdit, cancelTagEdit, confirmTag, removeTag } = useTagEditing({\n            getTags: getMergedTags,\n            applyTagUpdate,\n        });\n        function applyNoteUpdate(character, note) {\n            const nextNote = note.trim();\n            if (isLibraryItem(character)) {\n                const updatedLibrary = updateLibraryNote(character.id, nextNote, state.library);\n                setLibrary(updatedLibrary);\n                const updated = updatedLibrary.find(item => item.id === character.id);\n                if (updated) {\n                    manageCard.value = updated;\n                }\n                return;\n            }\n            const key = getNoteStorageKey(character);\n            if (!key) {\n                return;\n            }\n            const nextMap = { ...noteMap.value };\n            if (nextNote) {\n                nextMap[key] = nextNote;\n            }\n            else {\n                delete nextMap[key];\n            }\n            noteMap.value = nextMap;\n            saveNoteMap(nextMap);\n            const updatedCharacters = state.characters.map(card => card.id === character.id ? { ...card, note: nextNote } : card);\n            setCharacters(updatedCharacters);\n            const updated = updatedCharacters.find(card => card.id === character.id);\n            if (updated) {\n                manageCard.value = updated;\n            }\n        }\n        function openManage(card) {\n            manageCard.value = card;\n        }\n        function closeManage() {\n            manageCard.value = null;\n        }\n        function parseLibraryCardData(card) {\n            if (!card.raw || !card.rawType) {\n                return null;\n            }\n            if (card.rawType === 'json') {\n                return parseJsonSafe(card.raw);\n            }\n            if (card.rawType === 'png') {\n                return parsePngCardData(card.raw);\n            }\n            return null;\n        }\n        function parseJsonSafe(raw) {\n            try {\n                return JSON.parse(raw);\n            }\n            catch {\n                return null;\n            }\n        }\n        function parsePngCardData(dataUrl) {\n            const bytes = dataUrlToBytes(dataUrl);\n            if (!bytes) {\n                return null;\n            }\n            const chunks = extractPngTextChunks(bytes);\n            const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n            for (const chunk of chunks) {\n                if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n                    continue;\n                }\n                const parsed = parseCardPayload(chunk.value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function dataUrlToBytes(dataUrl) {\n            const comma = dataUrl.indexOf(',');\n            if (comma < 0) {\n                return null;\n            }\n            const base64 = dataUrl.slice(comma + 1);\n            try {\n                const binary = atob(base64);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return bytes;\n            }\n            catch {\n                return null;\n            }\n        }\n        function extractPngTextChunks(bytes) {\n            if (bytes.length < 8) {\n                return [];\n            }\n            const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n            for (let i = 0; i < signature.length; i += 1) {\n                if (bytes[i] !== signature[i]) {\n                    return [];\n                }\n            }\n            const chunks = [];\n            let offset = 8;\n            while (offset + 8 <= bytes.length) {\n                const length = readUint32BE(bytes, offset);\n                const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n                const dataStart = offset + 8;\n                const dataEnd = dataStart + length;\n                if (dataEnd + 4 > bytes.length) {\n                    break;\n                }\n                const data = bytes.subarray(dataStart, dataEnd);\n                if (type === 'tEXt') {\n                    const entry = parseTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                else if (type === 'iTXt') {\n                    const entry = parseIntlTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                offset = dataEnd + 4;\n            }\n            return chunks;\n        }\n        function parseTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseIntlTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const compressed = data[nullIndex + 1] === 1;\n            let cursor = nullIndex + 2;\n            const langEnd = data.indexOf(0, cursor);\n            if (langEnd < 0) {\n                return null;\n            }\n            cursor = langEnd + 1;\n            const translatedEnd = data.indexOf(0, cursor);\n            if (translatedEnd < 0) {\n                return null;\n            }\n            cursor = translatedEnd + 1;\n            if (compressed) {\n                return null;\n            }\n            const value = bytesToString(data.subarray(cursor)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseCardPayload(value) {\n            const trimmed = value.trim();\n            if (!trimmed) {\n                return null;\n            }\n            const direct = parseJsonSafe(trimmed);\n            if (direct) {\n                return direct;\n            }\n            if (!isLikelyBase64(trimmed)) {\n                return null;\n            }\n            const decoded = decodeBase64Text(trimmed);\n            if (!decoded) {\n                return null;\n            }\n            return parseJsonSafe(decoded);\n        }\n        function decodeBase64Text(value) {\n            try {\n                const binary = atob(value);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return new TextDecoder().decode(bytes);\n            }\n            catch {\n                return null;\n            }\n        }\n        function isLikelyBase64(value) {\n            if (value.length < 16 || value.length % 4 !== 0) {\n                return false;\n            }\n            return /^[A-Za-z0-9+/=]+$/.test(value);\n        }\n        function readUint32BE(bytes, offset) {\n            return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n        }\n        function bytesToString(bytes) {\n            return new TextDecoder().decode(bytes);\n        }\n        function extractCardTagsFromData(data) {\n            const tags = data?.tags ?? data?.data?.tags;\n            if (!Array.isArray(tags)) {\n                return [];\n            }\n            return tags\n                .filter(tag => typeof tag === 'string')\n                .map(tag => tag.trim())\n                .filter(Boolean);\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function formatMaybeTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                const ms = value < 1e12 ? value * 1000 : value;\n                return new Date(ms).toLocaleString('zh-CN', { hour12: false });\n            }\n            if (typeof value === 'string') {\n                const trimmed = value.trim();\n                if (trimmed) {\n                    return trimmed;\n                }\n            }\n            return '';\n        }\n        function parseTimestampFromText(raw) {\n            const text = raw.replace(/\\.jsonl$/i, '').trim();\n            const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:](\\d{1,2})(?:[:](\\d{1,2}))?)?/;\n            const match = text.match(pattern);\n            if (!match) {\n                return null;\n            }\n            const year = Number(match[1]);\n            const month = Number(match[2]);\n            const day = Number(match[3]);\n            const hour = match[4] ? Number(match[4]) : 0;\n            const minute = match[5] ? Number(match[5]) : 0;\n            const second = match[6] ? Number(match[6]) : 0;\n            if (!year || !month || !day) {\n                return null;\n            }\n            const date = new Date(year, month - 1, day, hour, minute, second);\n            const time = date.getTime();\n            return Number.isNaN(time) ? null : time;\n        }\n        function coerceTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                return value < 1e12 ? value * 1000 : value;\n            }\n            if (typeof value === 'string') {\n                const parsed = Date.parse(value);\n                if (!Number.isNaN(parsed)) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function extractChatLatestTimestamp(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const parsed = coerceTimestamp(value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (fallback) {\n                return parseTimestampFromText(fallback);\n            }\n            return null;\n        }\n        function sortChatBrief(list) {\n            return [...list].sort((lhs, rhs) => {\n                const left = extractChatLatestTimestamp(lhs) ?? 0;\n                const right = extractChatLatestTimestamp(rhs) ?? 0;\n                return right - left;\n            });\n        }\n        function extractChatLatestLabel(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const label = formatMaybeTimestamp(value);\n                if (label) {\n                    return label;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (!fallback) {\n                return '';\n            }\n            return fallback.replace(/\\.jsonl$/i, '');\n        }\n        let chatCacheToken = 0;\n        async function warmRecentChatCache(cards) {\n            if (sortKey.value !== 'recent') {\n                return;\n            }\n            const pending = cards.filter(card => {\n                if (card.origin !== 'tavern') {\n                    return false;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    return false;\n                }\n                return getLastChatAt(card) <= 0;\n            });\n            if (!pending.length) {\n                return;\n            }\n            const token = ++chatCacheToken;\n            for (const card of pending) {\n                if (token !== chatCacheToken || sortKey.value !== 'recent') {\n                    return;\n                }\n                if (card.origin !== 'tavern') {\n                    continue;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    continue;\n                }\n                const cached = getLastChatAt(card);\n                let brief = null;\n                try {\n                    brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n                if (Array.isArray(brief) && brief.length) {\n                    const sorted = sortChatBrief(brief);\n                    const timestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n                    if (timestamp > cached) {\n                        updateLastChatCacheForCard(card, timestamp);\n                    }\n                }\n                await sleep(80);\n            }\n        }\n        function warmImportCache(cards) {\n            const next = { ...importCache.value };\n            let changed = false;\n            const now = Date.now();\n            cards.forEach((card, index) => {\n                if (card.origin !== 'tavern') {\n                    return;\n                }\n                if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                    return;\n                }\n                const key = getChatCacheKey(card);\n                if (!key || next[key]) {\n                    return;\n                }\n                next[key] = now - (cards.length - 1 - index) * 1000;\n                changed = true;\n            });\n            if (changed) {\n                updateImportCache(next);\n            }\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharactersWithNotes(characters);\n                setLibrary(loadLibrary());\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }]),\n                style: _normalizeStyle(themeStyle.value)\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[59] || (_cache[59] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-theme-trigger\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: openThemeDialog\n                            }, [...(_cache[57] || (_cache[57] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"fa-solid fa-palette\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: close\n                            }, [...(_cache[58] || (_cache[58] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: _cache[1] || (_cache[1] =\n                                //@ts-ignore\n                                (...args) => (_unref(triggerImport) && _unref(triggerImport)(...args)))\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: _cache[2] || (_cache[2] =\n                                //@ts-ignore\n                                (...args) => (_unref(exportSelected) && _unref(exportSelected)(...args)))\n                        }, \"\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: _cache[3] || (_cache[3] =\n                                //@ts-ignore\n                                (...args) => (_unref(handleImportFiles) && _unref(handleImportFiles)(...args)))\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"div\", _hoisted_6, [\n                                    _cache[60] || (_cache[60] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                            type: \"button\",\n                                            onClick: _cache[4] || (_cache[4] = ($event) => (statusFilter.value = 'all'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[5] || (_cache[5] = ($event) => (statusFilter.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[6] || (_cache[6] = ($event) => (statusFilter.value = 'unimported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': favoritesOnly.value }]),\n                                            type: \"button\",\n                                            onClick: _cache[7] || (_cache[7] = ($event) => (favoritesOnly.value = !favoritesOnly.value))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_8, [\n                                    _cache[61] || (_cache[61] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_9, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'recent' }]),\n                                            type: \"button\",\n                                            onClick: _cache[8] || (_cache[8] = ($event) => (sortKey.value = 'recent'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'name' }]),\n                                            type: \"button\",\n                                            onClick: _cache[9] || (_cache[9] = ($event) => (sortKey.value = 'name'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'tags' }]),\n                                            type: \"button\",\n                                            onClick: _cache[10] || (_cache[10] = ($event) => (sortKey.value = 'tags'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[11] || (_cache[11] = ($event) => (sortKey.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ])\n                            ]),\n                            _cache[62] || (_cache[62] = _createElementVNode(\"div\", { class: \"cardhub-divider\" }, null, -1 /* CACHED */)),\n                            _cache[63] || (_cache[63] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allTags), (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': _unref(selectedTags).includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (_unref(toggleTagFilter)(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_11));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (_unref(selectedTags).length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: _cache[12] || (_cache[12] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(clearTagFilter) && _unref(clearTagFilter)(...args)))\n                                }, \"  \"))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-chip cardhub-chip--more\",\n                                type: \"button\",\n                                onClick: _cache[13] || (_cache[13] = ($event) => (_unref(openTagManager)('filter')))\n                            }, \"  \")\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_12, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \"\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                        _createElementVNode(\"div\", _hoisted_16, [\n                                            (totalPages.value > 1)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value <= 1,\n                                                        onClick: prevPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_18),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value >= totalPages.value,\n                                                        onClick: nextPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_19)\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"span\", _hoisted_20, \" \" + _toDisplayString(currentPage.value) + \" / \" + _toDisplayString(totalPages.value) + \" \", 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_21, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedCharacters.value, (character) => {\n                                                return (_openBlock(), _createElementBlock(\"article\", {\n                                                    key: character.id,\n                                                    class: \"cardhub-card\",\n                                                    onClick: ($event) => (openManage(character))\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                        style: _normalizeStyle(avatarStyle(character))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                    ], 6 /* CLASS, STYLE */),\n                                                    _createElementVNode(\"div\", _hoisted_23, [\n                                                        _createElementVNode(\"div\", _hoisted_24, [\n                                                            _createElementVNode(\"div\", _hoisted_25, _toDisplayString(character.name), 1 /* TEXT */),\n                                                            _createElementVNode(\"button\", {\n                                                                class: _normalizeClass([\"cardhub-fav\", { 'is-active': isFavorite(character.id) }]),\n                                                                type: \"button\",\n                                                                \"aria-label\": \"\",\n                                                                onClick: _withModifiers(($event) => (toggleFavorite(character)), [\"stop\"])\n                                                            }, [...(_cache[64] || (_cache[64] = [\n                                                                    _createElementVNode(\"i\", {\n                                                                        class: \"fa-solid fa-star\",\n                                                                        \"aria-hidden\": \"true\"\n                                                                    }, null, -1 /* CACHED */)\n                                                                ]))], 10 /* CLASS, PROPS */, _hoisted_26)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_27, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" \", 1 /* TEXT */)\n                                                        ]),\n                                                        (displayNote(character))\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_28, _toDisplayString(displayNote(character)), 1 /* TEXT */))\n                                                            : _createCommentVNode(\"v-if\", true),\n                                                        _createElementVNode(\"div\", _hoisted_29, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-tag\",\n                                                                    type: \"button\",\n                                                                    title: \"\",\n                                                                    onClick: _withModifiers(($event) => (_unref(removeTag)(character, tag)), [\"stop\"])\n                                                                }, [\n                                                                    _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                    _cache[65] || (_cache[65] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"\", -1 /* CACHED */))\n                                                                ], 8 /* PROPS */, _hoisted_30));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (_unref(activeTagKey) !== _unref(tagKey)(character))\n                                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: 0,\n                                                                    class: \"cardhub-tag is-add\",\n                                                                    type: \"button\",\n                                                                    onClick: _withModifiers(($event) => (_unref(startTagEdit)(character)), [\"stop\"])\n                                                                }, \" +  \", 8 /* PROPS */, _hoisted_31))\n                                                                : (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: 1,\n                                                                    class: \"cardhub-tag-edit\",\n                                                                    onClick: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onMousedown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onTouchstart: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"]))\n                                                                }, [\n                                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                                        \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event) => (_isRef(tagInput) ? (tagInput).value = $event : null)),\n                                                                        class: \"cardhub-tag-input\",\n                                                                        type: \"text\",\n                                                                        placeholder: \"\",\n                                                                        onKeydown: [\n                                                                            _withKeys(_withModifiers(($event) => (_unref(confirmTag)(character)), [\"prevent\"]), [\"enter\"]),\n                                                                            _cache[15] || (_cache[15] = _withKeys(_withModifiers(\n                                                                            //@ts-ignore\n                                                                            (...args) => (_unref(cancelTagEdit) && _unref(cancelTagEdit)(...args)), [\"prevent\"]), [\"esc\"]))\n                                                                        ],\n                                                                        onBlur: ($event) => (_unref(confirmTag)(character))\n                                                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_32), [\n                                                                        [_vModelText, _unref(tagInput)]\n                                                                    ]),\n                                                                    _createElementVNode(\"button\", {\n                                                                        class: \"cardhub-tag-confirm\",\n                                                                        type: \"button\",\n                                                                        onClick: ($event) => (_unref(confirmTag)(character))\n                                                                    }, \"\", 8 /* PROPS */, _hoisted_33)\n                                                                ], 32 /* NEED_HYDRATION */))\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_34, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action is-secondary\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (_unref(handleCardAction)(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[20] || (_cache[20] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, _toDisplayString(character.origin === 'tavern' ? '' : ''), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_35),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[22] || (_cache[22] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[24] || (_cache[24] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_36)\n                                                    ])\n                                                ], 8 /* PROPS */, _hoisted_22));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                        ])\n                    ])\n                ]),\n                _createVNode(ManageModal, {\n                    card: manageCard.value,\n                    \"display-tags\": displayTags,\n                    \"handle-card-action\": _unref(handleCardAction),\n                    \"manage-delete\": _unref(manageDelete),\n                    \"close-manage\": closeManage,\n                    \"close-root\": close,\n                    \"apply-note-update\": applyNoteUpdate,\n                    \"parse-library-card-data\": parseLibraryCardData,\n                    \"update-last-chat-cache-for-card\": updateLastChatCacheForCard\n                }, null, 8 /* PROPS */, [\"card\", \"handle-card-action\", \"manage-delete\"]),\n                (confirmState.open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-confirm cardhub-modal\",\n                        onClick: _cache[28] || (_cache[28] = _withModifiers(($event) => (resolveConfirm('cancel')), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_37, [\n                            _createElementVNode(\"div\", _hoisted_38, _toDisplayString(confirmState.title), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_39, _toDisplayString(confirmState.message), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_40, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-cancel\",\n                                    type: \"button\",\n                                    onClick: _cache[25] || (_cache[25] = ($event) => (resolveConfirm('cancel')))\n                                }, _toDisplayString(confirmState.cancelLabel), 1 /* TEXT */),\n                                (confirmState.altLabel)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"cardhub-confirm__button is-danger\",\n                                        type: \"button\",\n                                        onClick: _cache[26] || (_cache[26] = ($event) => (resolveConfirm('alt')))\n                                    }, _toDisplayString(confirmState.altLabel), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-confirm\",\n                                    type: \"button\",\n                                    onClick: _cache[27] || (_cache[27] = ($event) => (resolveConfirm('confirm')))\n                                }, _toDisplayString(confirmState.confirmLabel), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(tagManagerOpen))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-tag-manager cardhub-modal\",\n                        onClick: _cache[40] || (_cache[40] = _withModifiers(\n                        //@ts-ignore\n                        (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_41, [\n                            _createElementVNode(\"div\", _hoisted_42, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[66] || (_cache[66] = _createElementVNode(\"div\", { class: \"cardhub-tag-manager__title\" }, \"\", -1 /* CACHED */)),\n                                    (_unref(tagManagerTab) === 'filter')\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_43, \"  \" + _toDisplayString(_unref(selectedTags).length) + \" / \" + _toDisplayString(_unref(allTags).length), 1 /* TEXT */))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_44, \"  \" + _toDisplayString(_unref(batchTagSelectedIds).length) + \" / \" + _toDisplayString(_unref(batchTagVisibleCandidates).length), 1 /* TEXT */))\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: _cache[29] || (_cache[29] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_45, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-tag-manager__tab\", { 'is-active': _unref(tagManagerTab) === 'filter' }]),\n                                    type: \"button\",\n                                    onClick: _cache[30] || (_cache[30] = ($event) => (_unref(openTagManager)('filter')))\n                                }, \"  \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-tag-manager__tab\", { 'is-active': _unref(tagManagerTab) === 'batch' }]),\n                                    type: \"button\",\n                                    onClick: _cache[31] || (_cache[31] = ($event) => (_unref(openTagManager)('batch')))\n                                }, \"  \", 2 /* CLASS */)\n                            ]),\n                            (_unref(tagManagerTab) === 'filter')\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_46, [\n                                    _createElementVNode(\"div\", _hoisted_47, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-tag-manager__btn is-secondary\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedTags).length,\n                                            onClick: _cache[32] || (_cache[32] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(clearTagFilter) && _unref(clearTagFilter)(...args)))\n                                        }, \"  \", 8 /* PROPS */, _hoisted_48),\n                                        _cache[67] || (_cache[67] = _createElementVNode(\"div\", { class: \"cardhub-tag-manager__spacer\" }, null, -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-tag-manager__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: _cache[33] || (_cache[33] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)))\n                                        }, \"\")\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_49, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allTags), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: tag,\n                                                class: _normalizeClass([\"cardhub-tag-manager__chip\", { 'is-active': _unref(selectedTags).includes(tag) }]),\n                                                type: \"button\",\n                                                onClick: ($event) => (_unref(toggleTagFilter)(tag))\n                                            }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_50));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_51, [\n                                    _createElementVNode(\"div\", _hoisted_52, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[34] || (_cache[34] = ($event) => (_isRef(batchTagSearch) ? (batchTagSearch).value = $event : null)),\n                                            class: \"cardhub-batch__search\",\n                                            type: \"search\",\n                                            placeholder: \"\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(batchTagSearch)]\n                                        ]),\n                                        _cache[68] || (_cache[68] = _createElementVNode(\"div\", { class: \"cardhub-batch__hint\" }, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_53, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[35] || (_cache[35] = ($event) => (_isRef(batchTagInput) ? (batchTagInput).value = $event : null)),\n                                            type: \"text\",\n                                            placeholder: \"/\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(batchTagInput)]\n                                        ])\n                                    ]),\n                                    (_unref(batchTagSuggestions).length)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_54, [\n                                            _cache[69] || (_cache[69] = _createElementVNode(\"span\", { class: \"cardhub-batch__suggest-title\" }, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_55, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchTagSuggestions), (tag) => {\n                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: tag,\n                                                        class: _normalizeClass([\"cardhub-batch__chip\", { 'is-active': _unref(batchTagSelectedTags).includes(tag) }]),\n                                                        type: \"button\",\n                                                        onClick: ($event) => (_unref(toggleBatchTagSuggestion)(tag))\n                                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_56));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createElementVNode(\"div\", _hoisted_57, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: _cache[36] || (_cache[36] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(selectAllBatchTags) && _unref(selectAllBatchTags)(...args)))\n                                        }, \"\"),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: _cache[37] || (_cache[37] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(clearBatchTagSelection) && _unref(clearBatchTagSelection)(...args)))\n                                        }, \"\"),\n                                        _cache[70] || (_cache[70] = _createElementVNode(\"div\", { class: \"cardhub-batch__spacer\" }, null, -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-ghost\",\n                                            type: \"button\",\n                                            onClick: _cache[38] || (_cache[38] = ($event) => (_unref(applyBatchTags)('remove')))\n                                        }, \"  \"),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: _cache[39] || (_cache[39] = ($event) => (_unref(applyBatchTags)('add')))\n                                        }, \"\")\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_58, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchTagVisibleCandidates), (item) => {\n                                            return (_openBlock(), _createElementBlock(\"label\", {\n                                                key: item.id,\n                                                class: \"cardhub-batch__item\"\n                                            }, [\n                                                _createElementVNode(\"input\", {\n                                                    class: \"cardhub-batch__checkbox\",\n                                                    type: \"checkbox\",\n                                                    checked: _unref(batchTagSelectedSet).has(item.id),\n                                                    onChange: ($event) => (_unref(toggleBatchTagSelection)(item.id))\n                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_59),\n                                                _createElementVNode(\"div\", _hoisted_60, [\n                                                    _createElementVNode(\"div\", _hoisted_61, _toDisplayString(item.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_62, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                                    ]),\n                                                    (displayTags(item).length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_63, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-batch__tag\"\n                                                                }, _toDisplayString(tag), 1 /* TEXT */));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]))\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(exportDialogOpen))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"cardhub-export cardhub-modal\",\n                        onClick: _withModifiers(closeExportDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_64, [\n                            _createElementVNode(\"div\", _hoisted_65, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[71] || (_cache[71] = _createElementVNode(\"div\", { class: \"cardhub-export__title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_66, \"  \" + _toDisplayString(_unref(exportSelectedItems).length) + \" / \" + _toDisplayString(_unref(exportVisibleCandidates).length), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_67, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[41] || (_cache[41] = ($event) => (_isRef(exportSearch) ? (exportSearch).value = $event : null)),\n                                    class: \"cardhub-export__search\",\n                                    type: \"search\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(exportSearch)]\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_68, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'all' }]),\n                                        type: \"button\",\n                                        onClick: _cache[42] || (_cache[42] = ($event) => (exportStatusFilter.value = 'all'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'imported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[43] || (_cache[43] = ($event) => (exportStatusFilter.value = 'imported'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'unimported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[44] || (_cache[44] = ($event) => (exportStatusFilter.value = 'unimported'))\n                                    }, \"  \", 2 /* CLASS */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_69, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(exportAllTags), (tag) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: tag,\n                                            class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportTagFilters).includes(tag) }]),\n                                            type: \"button\",\n                                            onClick: ($event) => (toggleExportTagFilter(tag))\n                                        }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_70));\n                                    }), 128 /* KEYED_FRAGMENT */)),\n                                    (_unref(exportTagFilters).length)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"cardhub-export__chip cardhub-export__chip--clear\",\n                                            type: \"button\",\n                                            onClick: clearExportTagFilter\n                                        }, \"  \"))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_71, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[45] || (_cache[45] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(selectAllExport) && _unref(selectAllExport)(...args)))\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[46] || (_cache[46] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(clearExportSelection) && _unref(clearExportSelection)(...args)))\n                                }, \"\"),\n                                _cache[72] || (_cache[72] = _createElementVNode(\"div\", { class: \"cardhub-export__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[47] || (_cache[47] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(confirmExportSelected) && _unref(confirmExportSelected)(...args)))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_72, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(exportVisibleCandidates), (item) => {\n                                    return (_openBlock(), _createElementBlock(\"label\", {\n                                        key: item.id,\n                                        class: \"cardhub-export__item\"\n                                    }, [\n                                        _createElementVNode(\"input\", {\n                                            class: \"cardhub-export__checkbox\",\n                                            type: \"checkbox\",\n                                            checked: _unref(isExportSelected)(item.id),\n                                            onChange: ($event) => (_unref(toggleExportSelection)(item.id))\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_73),\n                                        _createElementVNode(\"div\", _hoisted_74, [\n                                            _createElementVNode(\"div\", _hoisted_75, _toDisplayString(item.name), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_76, [\n                                                _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                            ]),\n                                            (displayTags(item).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_77, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                        return (_openBlock(), _createElementBlock(\"span\", {\n                                                            key: tag,\n                                                            class: \"cardhub-export__tag\"\n                                                        }, _toDisplayString(tag), 1 /* TEXT */));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (themeDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"cardhub-theme cardhub-modal\",\n                        onClick: _withModifiers(closeThemeDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_78, [\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__header\" }, [\n                                _cache[73] || (_cache[73] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__title\" }, \"\"),\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__subtitle\" }, \"\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_79, [\n                                _createElementVNode(\"label\", _hoisted_80, [\n                                    _cache[74] || (_cache[74] = _createElementVNode(\"span\", null, \" 1\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[48] || (_cache[48] = ($event) => ((themeDraft.bgStart) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgStart]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_81, [\n                                    _cache[75] || (_cache[75] = _createElementVNode(\"span\", null, \" 2\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[49] || (_cache[49] = ($event) => ((themeDraft.bgEnd) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgEnd]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_82, [\n                                    _cache[76] || (_cache[76] = _createElementVNode(\"span\", null, \"/\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[50] || (_cache[50] = ($event) => ((themeDraft.surface) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surface]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_83, [\n                                    _cache[77] || (_cache[77] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[51] || (_cache[51] = ($event) => ((themeDraft.surfaceAlt) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surfaceAlt]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_84, [\n                                    _cache[78] || (_cache[78] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[52] || (_cache[52] = ($event) => ((themeDraft.text) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.text]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_85, [\n                                    _cache[79] || (_cache[79] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[53] || (_cache[53] = ($event) => ((themeDraft.textMuted) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.textMuted]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_86, [\n                                    _cache[80] || (_cache[80] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[54] || (_cache[54] = ($event) => ((themeDraft.accent) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accent]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_87, [\n                                    _cache[81] || (_cache[81] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[55] || (_cache[55] = ($event) => ((themeDraft.accentStrong) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accentStrong]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_88, [\n                                    _cache[82] || (_cache[82] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[56] || (_cache[56] = ($event) => ((themeDraft.border) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.border]\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_89, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(themePresets, (preset) => {\n                                    return _createElementVNode(\"button\", {\n                                        key: preset.name,\n                                        class: \"cardhub-theme__preset\",\n                                        type: \"button\",\n                                        onClick: ($event) => (applyThemePreset(preset))\n                                    }, _toDisplayString(preset.name), 9 /* TEXT, PROPS */, _hoisted_90);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__actions\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: resetThemeDraft\n                                }, \"\"),\n                                _cache[83] || (_cache[83] = _createElementVNode(\"div\", { class: \"cardhub-theme__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveThemeDraft\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 6 /* CLASS, STYLE */));\n        };\n    }\n});\n","import { computed, ref, type ComputedRef } from 'vue';\nimport type { CardHubItem } from '../../types';\n\nexport function useTagFilters(allCards: ComputedRef<CardHubItem[]>, getTags: (card: CardHubItem) => string[]) {\n  const selectedTags = ref<string[]>([]);\n\n  const allTags = computed(() => {\n    const tagSet = new Set<string>();\n    allCards.value.forEach(card => {\n      getTags(card).forEach(tag => tagSet.add(tag));\n    });\n    selectedTags.value.forEach(tag => tagSet.add(tag));\n    return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n  });\n\n  function applyTagFilter(list: CardHubItem[]): CardHubItem[] {\n    if (!selectedTags.value.length) {\n      return list;\n    }\n    return list.filter(card => selectedTags.value.some(tag => getTags(card).includes(tag)));\n  }\n\n  function toggleTagFilter(tag: string) {\n    if (selectedTags.value.includes(tag)) {\n      selectedTags.value = selectedTags.value.filter(item => item !== tag);\n    } else {\n      selectedTags.value = [...selectedTags.value, tag];\n    }\n  }\n\n  function clearTagFilter() {\n    selectedTags.value = [];\n  }\n\n  return {\n    selectedTags,\n    allTags,\n    applyTagFilter,\n    toggleTagFilter,\n    clearTagFilter,\n  };\n}\n","import { nextTick, ref } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype TagEditingOptions = {\n  getTags: (card: CardHubItem) => string[];\n  applyTagUpdate: (card: CardHubItem, tags: string[]) => void;\n};\n\nexport function useTagEditing(options: TagEditingOptions) {\n  const activeTagKey = ref<string | null>(null);\n  const tagInput = ref('');\n\n  function tagKey(character: CardHubItem): string {\n    return character.id;\n  }\n\n  function startTagEdit(character: CardHubItem) {\n    activeTagKey.value = tagKey(character);\n    tagInput.value = '';\n    nextTick(() => {\n      const input = document.querySelector<HTMLInputElement>('.cardhub-tag-input');\n      input?.focus();\n    });\n  }\n\n  function cancelTagEdit() {\n    activeTagKey.value = null;\n    tagInput.value = '';\n  }\n\n  function confirmTag(character: CardHubItem) {\n    if (activeTagKey.value !== tagKey(character)) {\n      return;\n    }\n    const input = tagInput.value.trim();\n    if (input) {\n      const nextTags = [...options.getTags(character), input];\n      options.applyTagUpdate(character, nextTags);\n    }\n    cancelTagEdit();\n  }\n\n  function removeTag(character: CardHubItem, tag: string) {\n    const nextTags = options.getTags(character).filter(item => item !== tag);\n    options.applyTagUpdate(character, nextTags);\n  }\n\n  return {\n    tagKey,\n    activeTagKey,\n    tagInput,\n    startTagEdit,\n    cancelTagEdit,\n    confirmTag,\n    removeTag,\n  };\n}\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { cardHubState } from '../state/store';\nimport App from '../ui/App.vue';\nimport { cardHubStyles } from './portal.styles';\n\nexport type PortalMount = {\n  app: ReturnType<typeof createApp>;\n  mount: JQuery<HTMLDivElement>;\n  style: JQuery<HTMLElement>;\n};\n\nexport function createPortalMount(): PortalMount {\n  const style = $(`<style>`).attr('data-cardhub-style', getScriptId()).text(cardHubStyles).appendTo('head');\n  const mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  const app = createApp(App);\n\n  app.mount(mount[0]);\n\n  watch(\n    () => cardHubState.open,\n    () => {},\n    { immediate: true },\n  );\n\n  return { app, mount, style };\n}\n\nexport function destroyPortalMount(portal: PortalMount) {\n  portal.app.unmount();\n  portal.mount.remove();\n  portal.style.remove();\n}\n","export const cardHubStyles = `\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.75) 100%\n        );\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow:\n          0 8px 18px rgba(var(--cardhub-accent-rgb), 0.25),\n          inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.82) 100%\n        );\n        color: var(--cardhub-accent-text);\n        box-shadow:\n          0 10px 22px rgba(var(--cardhub-accent-rgb), 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.65);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.75);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 2px;\n        width: 100%;\n        background: linear-gradient(\n          90deg,\n          rgba(var(--cardhub-border-rgb), 0) 0%,\n          rgba(var(--cardhub-border-rgb), 0.7) 50%,\n          rgba(var(--cardhub-border-rgb), 0) 100%\n        );\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        font-weight: 600;\n      }\n\n      .cardhub-section-title::before {\n        content: \"\";\n        width: 10px;\n        height: 10px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-accent-rgb), 0.6);\n        box-shadow:\n          0 0 0 2px rgba(var(--cardhub-accent-rgb), 0.2),\n          0 4px 8px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-border-rgb), 0.18),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.2),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.45);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.55);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.65);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.45);\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.2) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.95) 100%\n        );\n        color: var(--cardhub-accent-strong);\n        box-shadow:\n          0 8px 16px rgba(var(--cardhub-accent-rgb), 0.18),\n          inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.28) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.98) 100%\n        );\n        border-color: rgba(var(--cardhub-accent-rgb), 0.6);\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-filter-block + .cardhub-filter-block {\n        margin-top: 10px;\n        padding-top: 10px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__note {\n        margin-top: 6px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        word-break: break-word;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow:\n          0 10px 22px rgba(43, 32, 24, 0.22),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.35);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow:\n          0 10px 20px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__name {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-note-trigger {\n        border: none;\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-note-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-note-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__overview-action {\n        justify-self: start;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__detail-toggle {\n        justify-self: end;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 2px 0;\n      }\n\n      .cardhub-manage__toggle {\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.6);\n        box-shadow:\n          0 8px 18px rgba(43, 32, 24, 0.22),\n          inset 0 1px 0 rgba(255, 255, 255, 0.25);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 1) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.82) 100%\n        );\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 1);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__panel {\n        width: min(720px, 92vw);\n        max-width: 720px;\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-openings {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100004;\n      }\n\n      .cardhub-worldbook {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100005;\n      }\n\n      .cardhub-worldbook__panel {\n        width: min(720px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-worldbook__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-worldbook__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-worldbook__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-worldbook__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-worldbook__item-title {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__item-disabled {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__item-preview {\n        margin-top: 4px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n        margin-bottom: 6px;\n      }\n\n      .cardhub-openings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-openings__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 10px;\n      }\n\n      .cardhub-openings__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-openings__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-openings__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-openings__item-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-openings__item-preview {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-meta {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 8px;\n      }\n\n      .cardhub-manage__opening-meta-value {\n        color: var(--cardhub-text);\n        font-weight: 600;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-manage__opening-body {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-toggle {\n        margin-top: 6px;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__pager {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        margin-top: 8px;\n      }\n\n      .cardhub-manage__pager-btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__pager-btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-manage__pager-status {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-root .cardhub-modal {\n        position: fixed !important;\n        inset: 0 !important;\n        display: grid !important;\n        place-items: center !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        height: 100dvh !important;\n      }\n\n      .cardhub-root .cardhub-modal__panel {\n        position: fixed !important;\n        left: 50% !important;\n        top: 50% !important;\n        transform: translate(-50%, -50%) !important;\n        margin: 0 !important;\n      }\n\n      .cardhub-note {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-note__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-note__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-note__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-note__input {\n        width: 100%;\n        min-height: 120px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-note__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-note__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-note__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-manage-viewer {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-manage-viewer__panel {\n        width: min(620px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 24px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        position: relative;\n        display: grid;\n        gap: 12px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage-viewer__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-manage-viewer__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-manage-viewer__content {\n        font-size: 13px;\n        line-height: 1.6;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-note__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-note__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100011;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        z-index: 100005;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type='color'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n          line-height: 1.2;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr;\n          gap: 10px;\n          align-items: start;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n          min-width: 0;\n          align-content: start;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__note {\n          font-size: 10px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__detail-toggle,\n        .cardhub-manage__toggle,\n        .cardhub-manage__opening-toggle {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__opening-title {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__opening-body {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__pager {\n          gap: 8px;\n        }\n\n        .cardhub-manage__pager-btn {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__pager-status {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-note__input {\n          min-height: 100px;\n          font-size: 12px;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type='color'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-root .cardhub-modal {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: grid !important;\n          place-items: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root .cardhub-modal__panel {\n          position: fixed !important;\n          left: 50% !important;\n          top: 50% !important;\n          transform: translate(-50%, -50%) !important;\n          margin: 0 !important;\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n      }\n    `;\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport { createPortalMount, destroyPortalMount, type PortalMount } from './portal.mount';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet portal: PortalMount | null = null;\n\nfunction ensureMounted() {\n  if (!portal) {\n    portal = createPortalMount();\n  }\n}\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (portal) {\n        destroyPortalMount(portal);\n      }\n      portal = null;\n    },\n  };\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$existing","$","length","addClass","attr","empty","$anchor","selectors","selector","$target","first","$button","filter","_","el","text","title","getAttribute","test","$container","closest","parent","findRoleManagerAnchor","console","warn","openOnce","createOpenOnce","open","on","event","preventDefault","stopImmediatePropagation","append","bindOpenEvents","off","remove","registerRoleManagerEntry","push","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","html","entryDisposer","data","setTimeout","observer","MutationObserver","rootDocument","window","document","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","target","handler","wrapped","addEventListener","capture","removeEventListener","lastFiredAt","now","Date","async","fetchCharacterSummaries","st","SillyTavern","undefined","ctx","getContext","getCharacters","error","list","characters","idCounts","Map","tagKeyCounts","tagIdToName","Array","isArray","tags","tag","id","name","set","map","character","index","directTags","avatarKey","avatar","createdRaw","create_date","date_added","created","created_at","timestamp","time","createdAt","coerceToTimestamp","stamp","String","tagBaseKey","tagKey","tagCount","get","hasTagKey","Boolean","tagMap","Object","prototype","hasOwnProperty","call","mappedTags","baseId","count","lastChatRaw","last_interaction","last_interaction_time","last_interaction_date","last_chat_time","last_chat_date","last_message_time","last_message_date","update_time","last_modified","origin","lastChatAt","value","Number","isNaN","parsed","parse","uuidv4","replace","c","r","Math","random","toString","LIBRARY_KEY","readLibrary","globalVars","TavernHelper","getVariables","type","globalRaw","entries","scriptVars","script_id","scriptRaw","writeLibrary","vars","replaceVariables","readFileAsDataUrl","file","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","readFileAsText","readAsText","parseJsonSafe","raw","JSON","parseCardPayload","trimmed","trim","direct","isLikelyBase64","decoded","binary","atob","bytes","Uint8Array","i","charCodeAt","TextDecoder","decode","decodeBase64Text","extractCardTagsFromData","dataUrlToBytes","dataUrl","comma","indexOf","base64","slice","bytesToString","readUint32BE","offset","parseTextChunk","nullIndex","key","subarray","parseIntlTextChunk","compressed","cursor","langEnd","translatedEnd","extractPngTextChunks","signature","chunks","dataStart","dataEnd","entry","parsePngCardName","allowedKeys","Set","chunk","has","toLowerCase","parsePngCardTags","parseJsonCardTags","normalizeName","fileName","stableStringify","stringify","item","join","sort","a","b","localeCompare","val","buildFingerprint","rawType","source","hash","hashString","loadLibrary","stored","changed","normalized","note","tagsEdited","rawTags","addToLibrary","files","existingEntries","from","current","fingerprints","fingerprint","ensureFingerprint","add","nextEntries","endsWith","parsedName","parsedTags","importFileName","json","merged","removeFromLibrary","entryId","updated","Vue","cardHubState","reactive","loading","search","lastOpenSource","library","setOpen","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","hasKey","getTagMapEntry","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","tagIds","tagName","existing","crypto","randomUUID","ensureTag","saveSettingsDebounced","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","__name","props","manageCard","manageDetails","manageDetailsHint","openingItems","openingSummary","manageChats","pagedChats","chatPage","chatTotalPages","manageChatHint","openDetail","Function","openOpeningList","openLatestChat","openNewChat","openChat","prevChatPage","nextChatPage","handleCardAction","manageDelete","setup","__props","_ctx","_cache","detail","label","preview","onClick","$event","args","hint","onPointerdown","onMousedown","onTouchstart","msg","role","tabindex","onKeydown","mes","disabled","manageAvatarUrl","manageOverview","displayTags","openNoteDialog","worldbookAvailable","openWorldbookList","src","alt","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","card","closeManage","closeRoot","applyNoteUpdate","parseLibraryCardData","updateLastChatCacheForCard","computed","manageOpenings","ref","manageWorldbookEntries","manageProfile","manageOpeningSummary","manageChatSummary","useFull","getCharAvatarPath","encodeURIComponent","avatarUrl","items","profile","worldName","worldBookName","worldCount","worldBookCount","worldValue","worldHint","chat","chatValue","chatHint","total","latest","details","pushDetail","maxChars","previewDetailText","full","hasMore","description","personality","scenario","creatorNotes","systemPrompt","postHistory","creator","opening","previewOpeningLines","renderOpeningHtml","alternate","hasData","worldbookName","worldbookEntries","worldbookLoadedName","worldbookLoading","worldbookError","worldbookOpen","worldbookPage","worldbookItems","uid","enabled","content","worldbookTotalPages","max","ceil","pagedWorldbookItems","start","worldbookSummary","worldbookSummaryHint","openingPage","openingTotalPages","pagedOpenings","noteDialogOpen","noteDraft","openingListOpen","viewerOpen","viewerTitle","viewerHtml","manageRequestId","getWorldbook","closeWorldbookList","prevWorldbookPage","nextWorldbookPage","closeOpeningList","prevOpeningPage","nextOpeningPage","closeNoteDialog","saveNoteDialog","openDetailViewer","textToHtml","closeViewer","resolveManageData","openings","extractOpeningMessages","extractCardProfile","extractOpeningSummary","extractWorldbookEntries","findIndex","byName","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","RawCharacter","allowAvatar","primary","resolveRecentChats","summary","brief","getChatHistoryBrief","sorted","extractChatLatestTimestamp","sortChatBrief","latestTimestamp","formatChatTitle","formatChatFileLabel","file_name","file_id","normalizeBriefMessage","extractChatLatestLabel","toastr","warning","selectManageCharacter","ensureSelected","triggerSlash","selection","normalizeChatId","opener","openCharacterChat","catch","opened","timeoutMs","chatId","sleep","waitForChatOpen","options","targetName","normalizeNameKey","targetAvatar","normalizeAvatarKey","findCharacterIndex","selectCharacterById","switchMenu","selected","getCurrentCharacterId","waitForCharacterSelection","characterId","ms","toLocaleLowerCase","decodeURIComponent","split","includes","pop","pickString","creatorcomment","creator_notes","system_prompt","post_history_instructions","book","character_book","values","firstCount","alternate_greetings","extensions","maxLines","lines","extractContentLines","chunkText","truncated","contentLines","combined","stripCodeFences","escapeHtml","part","filtered","line","startsWith","size","chat_name","chat_title","last_message_timestamp","pattern","match","year","month","day","hour","minute","second","getTime","parseTimestampFromText","watch","requestId","manageResult","chatsResult","allSettled","manageData","status","chatData","openManage","immediate","ManageOverview","ManageContent","placeholder","innerHTML","useBatchTags","tagManagerOpen","tagManagerTab","batchTagSelectedIds","batchTagSearch","batchTagInput","batchTagSelectedTags","batchTagCandidates","filteredCharacters","batchTagVisibleCandidates","keyword","some","batchTagSelectedSet","batchTagSuggestions","allTags","openTagManager","tab","closeTagManager","toggleBatchTagSelection","selectAllBatchTags","clearBatchTagSelection","toggleBatchTagSuggestion","applyBatchTags","mode","input","parseBatchTags","actionLabel","message","openConfirm","confirmLabel","cancelLabel","cards","ids","allCards","getCardsByIds","currentTags","nextSet","delete","next","currentSet","every","isSameTagSet","applyTagUpdate","success","useLibraryActions","importInput","exportDialogOpen","exportSelectedIds","exportSearch","exportStatusFilter","exportTagFilters","exportCandidates","exportAllTags","tagSet","exportVisibleCandidates","exportSelectedSet","exportSelectedItems","openExportDialog","importLibraryCard","duplicate","findDuplicateCharacterByName","headers","getRequestHeaders","beforeCharacters","beforeAvatarKeys","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","fetch","method","cache","expectedNames","matchedByAvatar","matchedByName","importedCard","cleanedTags","exportLibraryCard","downloadBlob","Blob","exportCard","avatarPath","response","deleteFromTavern","deleteChats","targetIdx","currentId","nextIdx","keys","payload","avatar_url","delete_chats","ok","statusText","exportSelected","confirmExportSelected","tagLabel","selectedTags","statusLabel","statusFilter","searchLabel","stateSearch","isExportSelected","toggleExportSelection","selectAllExport","clearExportSelection","triggerImport","click","handleImportFiles","getLibrary","deleteChoice","altLabel","moveToLibrary","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","FAVORITES_KEY","LAST_CHAT_CACHE_KEY","IMPORT_CACHE_KEY","NOTE_KEY","THEME_KEY","pageSize","currentPage","confirmState","mergedTagsMap","applyTagFilter","toggleTagFilter","clearTagFilter","getTags","useTagFilters","favoriteIds","favoriteSet","sortKey","favoritesOnly","lastChatCache","importCache","noteMap","defaultTheme","bgStart","bgEnd","surface","surfaceAlt","textMuted","accent","accentStrong","border","themeDialogOpen","themeCurrent","themeDraft","themeStyle","theme","hexToRgb","contrastTextColor","themePresets","applyFavoriteFilter","isLibraryItem","applyStatusFilter","sortCards","toRef","setCharactersWithNotes","url","URL","createObjectURL","createElement","href","download","appendChild","revokeObjectURL","totalPages","pagedCharacters","avatarStyle","backgroundImage","displayNote","saveLastChatCache","getChatCacheKey","getImportAt","getLastChatAt","updateImportCache","saveImportCache","toggleFavorite","saveFavoriteList","withScore","lhs","rhs","aTime","bTime","aCreated","bCreated","hex","parseInt","rgb","g","channel","themeFrame","themeTimer","scheduleThemeApply","cancelAnimationFrame","clearTimeout","requestAnimationFrame","root","querySelector","getCardHubRoot","style","setProperty","applyTheme","loadThemeFromGlobal","pick","normalizeTheme","openThemeDialog","assign","nextTick","closeThemeDialog","resetThemeDraft","saveThemeDraft","saveThemeToGlobal","clearExportTagFilter","closeExportDialog","prevPage","nextPage","getNoteStorageKey","noteKey","applyNotesToCharacters","resolveConfirm","resolver","updateLibraryTags","deep","onMounted","getFavoriteList","fromEntries","loadLastChatCache","loadImportCache","loadNoteMap","warmRecentChatCache","warmImportCache","activeTagKey","tagInput","startTagEdit","cancelTagEdit","confirmTag","removeTag","focus","useTagEditing","nextNote","updatedLibrary","updateLibraryNote","nextMap","saveNoteMap","updatedCharacters","parsePngCardData","coerceTimestamp","candidates","left","chatCacheToken","pending","token","cached","refresh","close","ref_key","accept","multiple","onChange","onBlur","ManageModal","checked","preset","createPortalMount","appendTo","mount","app","createApp","App","portal","ensureMounted","createCardHubController","toggle","refreshCharacters","destroy","unmount","destroyPortalMount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}