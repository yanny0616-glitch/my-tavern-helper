{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","webpack://tavern_helper_template/src/角色卡管理插件/ui/App.vue?5a2d","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js","webpack://tavern_helper_template/src/角色卡管理插件/ui/App.vue?2c18","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src/角色卡管理插件/entry/buttons.ts","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/角色卡管理插件/services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src/角色卡管理插件/services/libraryService.ts","src://tavern_helper_template/src/角色卡管理插件/state/store.ts","src://tavern_helper_template/src/角色卡管理插件/services/tagService.ts","src://tavern_helper_template/src/角色卡管理插件/ui/App.vue","src://tavern_helper_template/src/角色卡管理插件/ui/util/common.ts","webpack://tavern_helper_template/src/角色卡管理插件/ui/App.vue?a8e8","src://tavern_helper_template/src/角色卡管理插件/entry/portal.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src/角色卡管理插件/index.ts"],"sourcesContent":["/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.cardhub-root[data-v-937272d2]{position:fixed;inset:0;z-index:9999;font-family:\"ZCOOL XiaoWei\",\"STSong\",\"Songti SC\",\"SimSun\",serif;color:#1b1b1b;display:none}.cardhub-root.open[data-v-937272d2]{display:flex;align-items:center;justify-content:center}.cardhub-backdrop[data-v-937272d2]{position:absolute;inset:0;background:radial-gradient(circle at top,rgba(255,248,236,0.9),rgba(36,30,24,0.85));backdrop-filter:blur(6px)}.cardhub-panel[data-v-937272d2]{position:relative;width:min(980px,94%);max-height:92%;background:linear-gradient(160deg,#fff9f0,#f3e4d4);border-radius:28px;box-shadow:0 30px 90px rgba(0,0,0,0.28);display:flex;flex-direction:column;overflow:hidden;z-index:1}.cardhub-header[data-v-937272d2]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid rgba(86,59,44,0.15)}.cardhub-title__main[data-v-937272d2]{font-size:26px;letter-spacing:2px}.cardhub-title__sub[data-v-937272d2]{font-size:12px;color:#7d5b46;margin-left:10px}.cardhub-actions[data-v-937272d2]{display:flex;gap:10px}.cardhub-close[data-v-937272d2]{border:none;background:rgba(43,32,24,0.12);color:#3b2a20;width:34px;height:34px;border-radius:999px;font-size:20px;line-height:34px;text-align:center;cursor:pointer}.cardhub-close[data-v-937272d2]:hover{background:rgba(43,32,24,0.2)}.cardhub-toolbar[data-v-937272d2]{display:flex;gap:10px;padding:16px 24px;flex-wrap:wrap}.cardhub-search[data-v-937272d2]{flex:1;min-width:180px;border-radius:999px;border:1px solid rgba(86,59,44,0.2);padding:8px 14px;background:#fffaf4}.cardhub-button[data-v-937272d2]{border:none;padding:8px 16px;border-radius:999px;background:#d46b3d;color:#fff;cursor:pointer;font-size:12px}.cardhub-button.is-ghost[data-v-937272d2]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-import-input[data-v-937272d2]{display:none}.cardhub-body[data-v-937272d2]{display:grid;grid-template-columns:minmax(160px,220px) 1fr;gap:0;flex:1;min-height:0}.cardhub-sidebar[data-v-937272d2]{padding:20px;border-right:1px solid rgba(86,59,44,0.15);display:flex;flex-direction:column;gap:12px}.cardhub-chip-row[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-section-title[data-v-937272d2]{font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-chip[data-v-937272d2]{text-align:left;border:none;background:rgba(255,255,255,0.6);border-radius:12px;padding:8px 10px;cursor:pointer;font-size:12px}.cardhub-chip.is-active[data-v-937272d2]{background:#2b2018;color:#fff5ea}.cardhub-placeholder[data-v-937272d2]{font-size:12px;color:#9a7a63}.cardhub-tag-filter[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-tag-filter__chip[data-v-937272d2]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.7);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer}.cardhub-tag-filter__chip.is-active[data-v-937272d2]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-chip--clear[data-v-937272d2]{margin-top:8px}.cardhub-content[data-v-937272d2]{padding:20px;overflow:auto}.cardhub-loading[data-v-937272d2],.cardhub-empty[data-v-937272d2]{padding:40px 0;text-align:center;color:#7d5b46}.cardhub-grid[data-v-937272d2]{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}.cardhub-card[data-v-937272d2]{background:rgba(255,255,255,0.78);border-radius:18px;padding:14px;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;border:1px solid rgba(86,59,44,0.15);cursor:pointer}.cardhub-card__avatar[data-v-937272d2]{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#f4d7c4,#d36a3b);background-size:cover;background-position:center;color:#4a2a1f;display:grid;place-items:center;font-weight:700}.cardhub-card__avatar.has-avatar span[data-v-937272d2]{display:none}.cardhub-card__name[data-v-937272d2]{font-size:14px;font-weight:600}.cardhub-card__meta[data-v-937272d2]{display:flex;gap:8px;font-size:11px;color:#7d5b46}.cardhub-card__tags[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}.cardhub-tag[data-v-937272d2]{border:1px solid rgba(106,63,42,0.3);background:#fff6ea;border-radius:999px;padding:4px 8px;font-size:11px;color:#6a3f2a;cursor:pointer}.cardhub-tag__remove[data-v-937272d2]{margin-left:4px;font-weight:700}.cardhub-tag.is-add[data-v-937272d2]{background:transparent;border-style:dashed}.cardhub-tag-input[data-v-937272d2]{border:1px dashed rgba(106,63,42,0.5);background:#fffaf4;border-radius:999px;padding:4px 10px;font-size:11px;min-width:80px;color:#6a3f2a;outline:none;height:24px;line-height:16px}.cardhub-tag-input[data-v-937272d2]:focus{border-color:rgba(106,63,42,0.85)}.cardhub-card__action[data-v-937272d2]{grid-column:span 2;margin-top:10px;border:none;background:#2b2018;color:#fff5ea;padding:6px 12px;border-radius:12px;font-size:12px;cursor:pointer}.cardhub-card__actions[data-v-937272d2]{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}.cardhub-card__action.is-secondary[data-v-937272d2]{background:#d9c6b6;color:#3b2a20}.cardhub-preview[data-v-937272d2]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100000}.cardhub-preview__panel[data-v-937272d2]{width:min(520px,92vw);background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:20px;position:relative;display:grid;gap:14px}.cardhub-preview__close[data-v-937272d2]{position:absolute;top:14px;right:14px;border:none;width:30px;height:30px;border-radius:999px;background:rgba(43,32,24,0.15);color:#3b2a20;font-size:18px;cursor:pointer}.cardhub-preview__avatar[data-v-937272d2]{width:100%;height:260px;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-preview__avatar img[data-v-937272d2]{width:100%;height:100%;object-fit:contain}.cardhub-preview__info[data-v-937272d2]{display:grid;gap:6px}.cardhub-preview__name[data-v-937272d2]{font-size:20px;font-weight:700}.cardhub-preview__meta[data-v-937272d2]{display:flex;gap:10px;font-size:12px;color:#7d5b46}.cardhub-preview__tags[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-preview__tag[data-v-937272d2]{padding:6px 10px;border-radius:999px;border:1px solid rgba(106,63,42,0.3);background:#fffaf4;font-size:12px;color:#6a3f2a}.cardhub-preview__actions[data-v-937272d2]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-manage[data-v-937272d2]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100001}.cardhub-manage__panel[data-v-937272d2]{width:min(760px,94vw);max-height:88vh;background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:22px;position:relative;display:grid;gap:16px;overflow:auto}.cardhub-manage__top[data-v-937272d2]{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}.cardhub-manage__media[data-v-937272d2]{width:220px;aspect-ratio:3/4;height:auto;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-manage__media img[data-v-937272d2]{width:100%;height:100%;object-fit:cover}.cardhub-manage__summary[data-v-937272d2]{display:grid;gap:6px}.cardhub-manage__section[data-v-937272d2]{display:grid;gap:8px}.cardhub-manage__label[data-v-937272d2]{display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__jump[data-v-937272d2]{border:1px solid rgba(106,63,42,0.35);background:transparent;color:#6a3f2a;border-radius:999px;padding:4px 10px;font-size:11px;cursor:pointer;text-transform:none}.cardhub-manage__jump[data-v-937272d2]:hover{background:rgba(106,63,42,0.1)}.cardhub-manage__content[data-v-937272d2]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap}.cardhub-manage__opening[data-v-937272d2]{padding:6px 0;border-bottom:1px dashed rgba(106,63,42,0.2)}.cardhub-manage__opening[data-v-937272d2]:last-child{border-bottom:none}.cardhub-manage__chat[data-v-937272d2]{display:grid;gap:10px}.cardhub-manage__chat-row[data-v-937272d2]{display:grid;grid-template-columns:minmax(140px,220px) 1fr;gap:12px;font-size:12px;color:#3b2a20;align-items:start;padding:6px 8px;border-radius:10px;cursor:pointer}.cardhub-manage__chat-row[data-v-937272d2]:hover{background:rgba(106,63,42,0.08)}.cardhub-manage__chat-name[data-v-937272d2]{flex:0 0 auto;font-weight:600;color:#6a3f2a;word-break:break-word}.cardhub-manage__chat-text[data-v-937272d2]{color:#3b2a20;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.cardhub-manage__empty[data-v-937272d2]{font-size:12px;color:#9a7a63}.cardhub-manage__actions[data-v-937272d2]{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media (max-width:720px){.cardhub-body[data-v-937272d2]{grid-template-columns:1fr}.cardhub-sidebar[data-v-937272d2]{flex-direction:column;border-right:none;border-bottom:1px solid rgba(86,59,44,0.15);gap:8px}.cardhub-chip-row[data-v-937272d2],.cardhub-tag-filter[data-v-937272d2]{flex-wrap:nowrap;overflow-x:auto;padding-bottom:4px}.cardhub-chip-row[data-v-937272d2]::-webkit-scrollbar,.cardhub-tag-filter[data-v-937272d2]::-webkit-scrollbar{height:6px}.cardhub-chip-row[data-v-937272d2]::-webkit-scrollbar-thumb,.cardhub-tag-filter[data-v-937272d2]::-webkit-scrollbar-thumb{background:rgba(106,63,42,0.2);border-radius:999px}.cardhub-panel[data-v-937272d2]{width:min(98vw,520px);max-height:96vh}.cardhub-header[data-v-937272d2]{flex-direction:row;align-items:center;justify-content:space-between;gap:8px;padding:12px 14px}.cardhub-toolbar[data-v-937272d2]{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;padding:10px 14px 12px}.cardhub-search[data-v-937272d2]{width:100%;grid-column:1/-1}.cardhub-button[data-v-937272d2]{width:100%}.cardhub-button.is-ghost[data-v-937272d2]{grid-column:span 1}.cardhub-tag-filter__chip[data-v-937272d2],.cardhub-tag[data-v-937272d2]{font-size:10px;padding:4px 8px}.cardhub-card[data-v-937272d2]{grid-template-columns:1fr}.cardhub-card__action[data-v-937272d2]{grid-column:auto}.cardhub-manage__panel[data-v-937272d2]{width:min(96vw,560px);max-height:90vh}.cardhub-manage__top[data-v-937272d2]{grid-template-columns:1fr}.cardhub-manage__actions[data-v-937272d2]{grid-template-columns:1fr}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/角色卡管理插件/ui/App.vue\"],\"names\":[],\"mappings\":\"AAo/BA,+BACE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,+DAAoE,CACpE,aAAc,CACd,YACF,CAEA,oCACE,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,mCACE,iBAAkB,CAClB,OAAQ,CACR,mFAA4F,CAC5F,yBACF,CAEA,gCACE,iBAAkB,CAClB,oBAAsB,CACtB,cAAe,CACf,kDAAqD,CACrD,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eAAgB,CAChB,SACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,2CACF,CAEA,sCACE,cAAe,CACf,kBACF,CAEA,qCACE,cAAe,CACf,aAAc,CACd,gBACF,CAEA,kCACE,YAAa,CACb,QACF,CAEA,gCACE,WAAY,CACZ,8BAAkC,CAClC,aAAc,CACd,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,cACF,CAEA,sCACE,6BACF,CAEA,kCACE,YAAa,CACb,QAAS,CACT,iBAAkB,CAClB,cACF,CAEA,iCACE,MAAO,CACP,eAAgB,CAChB,mBAAoB,CACpB,mCAAuC,CACvC,gBAAiB,CACjB,kBACF,CAEA,iCACE,WAAY,CACZ,gBAAiB,CACjB,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,cAAe,CACf,cACF,CAEA,0CACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,uCACE,YACF,CAEA,+BACE,YAAa,CACb,6CAA+C,CAC/C,KAAM,CACN,MAAO,CACP,YACF,CAEA,kCACE,YAAa,CACb,0CAA8C,CAC9C,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,mCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,wCACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,+BACE,eAAgB,CAChB,WAAY,CACZ,gCAAoC,CACpC,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cACF,CAEA,yCACE,kBAAmB,CACnB,aACF,CAEA,sCACE,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,2CACE,qCAAyC,CACzC,gCAAoC,CACpC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cACF,CAEA,qDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,sCACE,cACF,CAEA,kCACE,YAAa,CACb,aACF,CAEA,kEAEE,cAAe,CACf,iBAAkB,CAClB,aACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,yDACF,CAEA,+BACE,iCAAqC,CACrC,kBAAmB,CACnB,YAAa,CACb,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,kBAAmB,CACnB,oCAAwC,CACxC,cACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,kDAAqD,CACrD,qBAAsB,CACtB,0BAA2B,CAC3B,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,uDACE,YACF,CAEA,qCACE,cAAe,CACf,eACF,CAEA,qCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,8BACE,oCAAwC,CACxC,kBAAmB,CACnB,mBAAoB,CACpB,eAAgB,CAChB,cAAe,CACf,aAAc,CACd,cACF,CAEA,sCACE,eAAgB,CAChB,eACF,CAEA,qCACE,sBAAuB,CACvB,mBACF,CAEA,oCACE,qCAAyC,CACzC,kBAAmB,CACnB,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,aAAc,CACd,YAAa,CACb,WAAY,CACZ,gBACF,CAEA,0CACE,iCACF,CAEA,uCACE,kBAAmB,CACnB,eAAgB,CAChB,WAAY,CACZ,kBAAmB,CACnB,aAAc,CACd,gBAAiB,CACjB,kBAAmB,CACnB,cAAe,CACf,cACF,CAEA,wCACE,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,eACF,CAEA,oDACE,kBAAmB,CACnB,aACF,CAEA,kCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,iBAAkB,CAClB,QAAS,CACT,UAAW,CACX,WAAY,CACZ,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,8BAAkC,CAClC,aAAc,CACd,cAAe,CACf,cACF,CAEA,0CACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,8CACE,UAAW,CACX,WAAY,CACZ,kBACF,CAEA,wCACE,YAAa,CACb,OACF,CAEA,wCACE,cAAe,CACf,eACF,CAEA,wCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,wCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,uCACE,gBAAiB,CACjB,mBAAoB,CACpB,oCAAwC,CACxC,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,2CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,iCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,aACF,CAEA,sCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,iBACF,CAEA,wCACE,WAAY,CACZ,gBAAmB,CACnB,WAAY,CACZ,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,4CACE,UAAW,CACX,WAAY,CACZ,gBACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,wCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,uCACE,qCAAyC,CACzC,sBAAuB,CACvB,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mBACF,CAEA,6CACE,8BACF,CAEA,0CACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,0CACE,aAAc,CACd,4CACF,CAEA,qDACE,kBACF,CAEA,uCACE,YAAa,CACb,QACF,CAEA,2CACE,YAAa,CACb,6CAA+C,CAC/C,QAAS,CACT,cAAe,CACf,aAAc,CACd,iBAAkB,CAClB,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,iDACE,+BACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,aAAc,CACd,qBACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,mBAAoB,CACpB,oBAAqB,CACrB,2BAA4B,CAC5B,eACF,CAEA,wCACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CACA,yBAEE,+BACE,yBACF,CAEA,kCACE,qBAAsB,CACtB,iBAAkB,CAClB,2CAA+C,CAC/C,OACF,CAEA,wEAEE,gBAAiB,CACjB,eAAgB,CAChB,kBACF,CAEA,8GAEE,UACF,CAEA,0HAEE,8BAAkC,CAClC,mBACF,CAEA,gCACE,qBAAuB,CACvB,eACF,CAEA,iCACE,kBAAmB,CACnB,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,iBACF,CAEA,kCACE,YAAa,CACb,wCAAyC,CACzC,OAAQ,CACR,sBACF,CAEA,iCACE,UAAW,CACX,gBACF,CAEA,iCACE,UACF,CAEA,0CACE,kBACF,CAEA,yEAEE,cAAe,CACf,eACF,CAEA,+BACE,yBACF,CAEA,uCACE,gBACF,CACA,wCACE,qBAAuB,CACvB,eACF,CAEA,sCACE,yBACF,CAEA,0CACE,yBACF,CACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"cardhub-root\\\" :class=\\\"{ open: state.open }\\\">\\n    <div class=\\\"cardhub-backdrop\\\" @click=\\\"close\\\" />\\n    <section class=\\\"cardhub-panel\\\" role=\\\"dialog\\\" aria-label=\\\"CardHub 角色卡管理器\\\">\\n      <header class=\\\"cardhub-header\\\">\\n        <div class=\\\"cardhub-title\\\">\\n          <span class=\\\"cardhub-title__main\\\">CardHub</span>\\n          <span class=\\\"cardhub-title__sub\\\">角色卡管理器</span>\\n        </div>\\n        <div class=\\\"cardhub-actions\\\">\\n          <button class=\\\"cardhub-close\\\" type=\\\"button\\\" aria-label=\\\"关闭\\\" @click=\\\"close\\\">\\n            <span aria-hidden=\\\"true\\\">×</span>\\n          </button>\\n        </div>\\n      </header>\\n\\n      <div class=\\\"cardhub-toolbar\\\">\\n        <input\\n          v-model=\\\"state.search\\\"\\n          class=\\\"cardhub-search\\\"\\n          type=\\\"search\\\"\\n          placeholder=\\\"搜索角色名或标签\\\"\\n        />\\n        <button class=\\\"cardhub-button\\\" type=\\\"button\\\" @click=\\\"refresh\\\">刷新</button>\\n        <button class=\\\"cardhub-button is-ghost\\\" type=\\\"button\\\" @click=\\\"triggerImport\\\">导入</button>\\n        <button class=\\\"cardhub-button is-ghost\\\" type=\\\"button\\\" @click=\\\"exportSelected\\\">批量导出</button>\\n        <input\\n          ref=\\\"importInput\\\"\\n          class=\\\"cardhub-import-input\\\"\\n          type=\\\"file\\\"\\n          accept=\\\".png,.json\\\"\\n          multiple\\n          @change=\\\"handleImportFiles\\\"\\n        />\\n      </div>\\n\\n      <div class=\\\"cardhub-body\\\">\\n        <div class=\\\"cardhub-sidebar\\\">\\n          <div class=\\\"cardhub-section-title\\\">分类</div>\\n          <div class=\\\"cardhub-chip-row\\\">\\n            <button\\n              class=\\\"cardhub-chip\\\"\\n              :class=\\\"{ 'is-active': statusFilter === 'all' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"statusFilter = 'all'\\\"\\n            >\\n              全部\\n            </button>\\n            <button\\n              class=\\\"cardhub-chip\\\"\\n              :class=\\\"{ 'is-active': statusFilter === 'imported' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"statusFilter = 'imported'\\\"\\n            >\\n              已导入\\n            </button>\\n            <button\\n              class=\\\"cardhub-chip\\\"\\n              :class=\\\"{ 'is-active': statusFilter === 'unimported' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"statusFilter = 'unimported'\\\"\\n            >\\n              未导入\\n            </button>\\n          </div>\\n          <div class=\\\"cardhub-section-title\\\">标签</div>\\n          <div class=\\\"cardhub-tag-filter\\\">\\n            <button\\n              v-for=\\\"tag in allTags\\\"\\n              :key=\\\"tag\\\"\\n              class=\\\"cardhub-tag-filter__chip\\\"\\n              :class=\\\"{ 'is-active': selectedTags.includes(tag) }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"toggleTagFilter(tag)\\\"\\n            >\\n              {{ tag }}\\n            </button>\\n          </div>\\n          <button\\n            v-if=\\\"selectedTags.length\\\"\\n            class=\\\"cardhub-chip cardhub-chip--clear\\\"\\n            type=\\\"button\\\"\\n            @click=\\\"clearTagFilter\\\"\\n          >\\n            清空标签\\n          </button>\\n        </div>\\n\\n        <div class=\\\"cardhub-content\\\">\\n          <div v-if=\\\"state.loading\\\" class=\\\"cardhub-loading\\\">正在读取角色卡...</div>\\n          <div v-else-if=\\\"!filteredCharacters.length\\\" class=\\\"cardhub-empty\\\">\\n            暂无角色卡，或没有匹配的搜索结果。\\n          </div>\\n          <div v-else class=\\\"cardhub-grid\\\">\\n            <article\\n              v-for=\\\"character in filteredCharacters\\\"\\n              :key=\\\"character.id\\\"\\n              class=\\\"cardhub-card\\\"\\n              @click=\\\"openPreview(character)\\\"\\n            >\\n              <div\\n                class=\\\"cardhub-card__avatar\\\"\\n                :class=\\\"{ 'has-avatar': Boolean(avatarUrl(character)) }\\\"\\n                :style=\\\"avatarStyle(character)\\\"\\n              >\\n                <span>{{ character.name.slice(0, 1) || '?' }}</span>\\n              </div>\\n              <div class=\\\"cardhub-card__info\\\">\\n                <div class=\\\"cardhub-card__name\\\">{{ character.name }}</div>\\n                <div class=\\\"cardhub-card__meta\\\">\\n                  <span>{{ character.origin === 'tavern' ? '已导入' : '未导入' }}</span>\\n                  <span>{{ displayTags(character).length }} 标签</span>\\n                </div>\\n                <div class=\\\"cardhub-card__tags\\\">\\n                  <button\\n                    v-for=\\\"tag in displayTags(character)\\\"\\n                    :key=\\\"tag\\\"\\n                    class=\\\"cardhub-tag\\\"\\n                    type=\\\"button\\\"\\n                    title=\\\"点击移除标签\\\"\\n                    @click=\\\"removeTag(character, tag)\\\"\\n                  >\\n                    {{ tag }}\\n                    <span class=\\\"cardhub-tag__remove\\\">×</span>\\n                  </button>\\n                  <button\\n                    v-if=\\\"activeTagKey !== tagKey(character)\\\"\\n                    class=\\\"cardhub-tag is-add\\\"\\n                    type=\\\"button\\\"\\n                    @click=\\\"startTagEdit(character)\\\"\\n                  >\\n                    + 标签\\n                  </button>\\n                  <input\\n                    v-else\\n                    v-model=\\\"tagInput\\\"\\n                    class=\\\"cardhub-tag-input\\\"\\n                    type=\\\"text\\\"\\n                    placeholder=\\\"新标签\\\"\\n                    @keydown.enter.prevent=\\\"confirmTag(character)\\\"\\n                    @keydown.esc.prevent=\\\"cancelTagEdit\\\"\\n                    @blur=\\\"confirmTag(character)\\\"\\n                  />\\n                </div>\\n              </div>\\n              <div class=\\\"cardhub-card__actions\\\">\\n                <button\\n                  class=\\\"cardhub-card__action is-secondary\\\"\\n                  type=\\\"button\\\"\\n                  @click.stop=\\\"handleCardAction(character)\\\"\\n                  @pointerdown.stop\\n                  @mousedown.stop\\n                  @touchstart.stop\\n                >\\n                  {{ character.origin === 'tavern' ? '导出' : '导入' }}\\n                </button>\\n                <button\\n                  class=\\\"cardhub-card__action\\\"\\n                  type=\\\"button\\\"\\n                  @click.stop=\\\"openManage(character)\\\"\\n                  @pointerdown.stop\\n                  @mousedown.stop\\n                  @touchstart.stop\\n                >\\n                  管理\\n                </button>\\n              </div>\\n            </article>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n\\n    <div v-if=\\\"previewCard\\\" class=\\\"cardhub-preview\\\" @click.self=\\\"closePreview\\\">\\n      <div class=\\\"cardhub-preview__panel\\\" role=\\\"dialog\\\" aria-label=\\\"角色卡预览\\\">\\n        <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closePreview\\\">×</button>\\n        <div class=\\\"cardhub-preview__avatar\\\">\\n          <img v-if=\\\"previewAvatarUrl\\\" :src=\\\"previewAvatarUrl\\\" alt=\\\"\\\" />\\n        </div>\\n        <div class=\\\"cardhub-preview__info\\\">\\n          <div class=\\\"cardhub-preview__name\\\">{{ previewCard.name }}</div>\\n          <div class=\\\"cardhub-preview__meta\\\">\\n            <span>{{ previewCard.origin === 'tavern' ? '已导入' : '未导入' }}</span>\\n            <span>{{ displayTags(previewCard).length }} 标签</span>\\n          </div>\\n          <div class=\\\"cardhub-preview__tags\\\">\\n            <span v-for=\\\"tag in displayTags(previewCard)\\\" :key=\\\"tag\\\" class=\\\"cardhub-preview__tag\\\">\\n              {{ tag }}\\n            </span>\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-preview__actions\\\">\\n          <button\\n            class=\\\"cardhub-card__action is-secondary\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"handleCardAction(previewCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            {{ previewCard.origin === 'tavern' ? '导出' : '导入' }}\\n          </button>\\n          <button\\n            class=\\\"cardhub-card__action\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"openManage(previewCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            管理\\n          </button>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"manageCard\\\" class=\\\"cardhub-manage\\\" @click.self=\\\"closeManage\\\">\\n      <div class=\\\"cardhub-manage__panel\\\" role=\\\"dialog\\\" aria-label=\\\"角色管理\\\">\\n        <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closeManage\\\">×</button>\\n        <div class=\\\"cardhub-manage__top\\\">\\n          <div class=\\\"cardhub-manage__summary\\\">\\n            <div class=\\\"cardhub-preview__name\\\">{{ manageCard.name }}</div>\\n            <div class=\\\"cardhub-preview__meta\\\">\\n              <span>{{ manageCard.origin === 'tavern' ? '已导入' : '未导入' }}</span>\\n              <span>{{ displayTags(manageCard).length }} 标签</span>\\n            </div>\\n            <div class=\\\"cardhub-preview__tags\\\">\\n              <span v-for=\\\"tag in displayTags(manageCard)\\\" :key=\\\"tag\\\" class=\\\"cardhub-preview__tag\\\">\\n                {{ tag }}\\n              </span>\\n            </div>\\n          </div>\\n          <div class=\\\"cardhub-manage__media\\\">\\n            <img v-if=\\\"manageAvatarUrl\\\" :src=\\\"manageAvatarUrl\\\" alt=\\\"\\\" />\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-manage__section\\\">\\n          <div class=\\\"cardhub-manage__label\\\">开场白</div>\\n          <div class=\\\"cardhub-manage__content\\\">\\n            <template v-if=\\\"manageOpeningLines.length\\\">\\n              <div v-for=\\\"(opening, index) in manageOpeningLines\\\" :key=\\\"index\\\" class=\\\"cardhub-manage__opening\\\">\\n                {{ opening }}\\n              </div>\\n            </template>\\n            <template v-else>暂无开场白</template>\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-manage__section\\\">\\n          <div class=\\\"cardhub-manage__label\\\">\\n            <span>最近聊天</span>\\n            <button\\n              class=\\\"cardhub-manage__jump\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"openLatestChat\\\"\\n              @pointerdown.stop\\n              @mousedown.stop\\n              @touchstart.stop\\n            >\\n              进入最近聊天\\n            </button>\\n          </div>\\n          <div v-if=\\\"manageChats.length\\\" class=\\\"cardhub-manage__chat\\\">\\n            <div\\n              v-for=\\\"(msg, index) in manageChats\\\"\\n              :key=\\\"index\\\"\\n              class=\\\"cardhub-manage__chat-row\\\"\\n              role=\\\"button\\\"\\n              tabindex=\\\"0\\\"\\n              @click=\\\"openChat(msg)\\\"\\n              @keydown.enter.prevent=\\\"openChat(msg)\\\"\\n            >\\n              <span class=\\\"cardhub-manage__chat-name\\\">{{ msg.name }}</span>\\n              <span class=\\\"cardhub-manage__chat-text\\\">{{ msg.mes }}</span>\\n            </div>\\n          </div>\\n          <div v-else class=\\\"cardhub-manage__empty\\\">暂无聊天记录</div>\\n        </div>\\n        <div class=\\\"cardhub-manage__actions\\\">\\n          <button\\n            class=\\\"cardhub-card__action is-secondary\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"handleCardAction(manageCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            {{ manageCard.origin === 'tavern' ? '导出' : '导入' }}\\n          </button>\\n          <button\\n            class=\\\"cardhub-card__action\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"manageDelete(manageCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            删除\\n          </button>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { computed, nextTick, ref } from 'vue';\\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\\nimport { fetchCharacterSummaries } from '../services/characterSource';\\nimport { regexFromString } from './util/common';\\nimport type { CardHubItem } from '../types';\\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\\n\\nconst selectedTags = ref<string[]>([]);\\nconst activeTagKey = ref<string | null>(null);\\nconst tagInput = ref('');\\nconst statusFilter = ref<'all' | 'imported' | 'unimported'>('all');\\nconst importInput = ref<HTMLInputElement | null>(null);\\nconst previewCard = ref<CardHubItem | null>(null);\\nconst manageCard = ref<CardHubItem | null>(null);\\nconst manageOpenings = ref<string[]>([]);\\nconst manageChats = ref<Array<{ name: string; mes: string; file: string }>>([]);\\nconst manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\\n\\nconst allCards = computed(() => [...state.characters, ...state.library]);\\n\\nconst filteredCharacters = computed(() => {\\n  const list = applyStatusFilter(allCards.value);\\n  const keyword = state.search.trim();\\n  if (!keyword) {\\n    return applyTagFilter(list);\\n  }\\n  const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), 'i');\\n  return applyTagFilter(list).filter(character => {\\n    return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\\n  });\\n});\\n\\nconst allTags = computed(() => {\\n  const tagSet = new Set<string>();\\n  allCards.value.forEach(character => {\\n    getMergedTags(character).forEach(tag => tagSet.add(tag));\\n  });\\n  selectedTags.value.forEach(tag => tagSet.add(tag));\\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\\n});\\n\\nfunction avatarUrl(character: CardHubItem, useFull = false): string | null {\\n  const avatar = character.avatar;\\n  if (!avatar) {\\n    return null;\\n  }\\n  if (/^(data:|https?:|\\\\/)/.test(avatar)) {\\n    return avatar;\\n  }\\n  if (useFull && character.origin === 'tavern') {\\n    return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\\n  }\\n  return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\\n}\\n\\nfunction avatarStyle(character: CardHubItem): Record<string, string> {\\n  const url = avatarUrl(character);\\n  return url ? { backgroundImage: `url(${url})` } : {};\\n}\\n\\nfunction displayTags(character: CardHubItem): string[] {\\n  return getMergedTags(character);\\n}\\n\\nfunction openPreview(card: CardHubItem) {\\n  previewCard.value = card;\\n}\\n\\nfunction closePreview() {\\n  previewCard.value = null;\\n}\\n\\nconst previewAvatarUrl = computed(() => {\\n  if (!previewCard.value) {\\n    return null;\\n  }\\n  return avatarUrl(previewCard.value, true);\\n});\\n\\nconst manageAvatarUrl = computed(() => {\\n  if (!manageCard.value) {\\n    return null;\\n  }\\n  return avatarUrl(manageCard.value, true);\\n});\\n\\nfunction applyStatusFilter(list: CardHubItem[]): CardHubItem[] {\\n  if (statusFilter.value === 'imported') {\\n    return list.filter(item => item.origin === 'tavern');\\n  }\\n  if (statusFilter.value === 'unimported') {\\n    return list.filter(item => item.origin === 'library');\\n  }\\n  return list;\\n}\\n\\nfunction applyTagFilter(list: CardHubItem[]): CardHubItem[] {\\n  if (!selectedTags.value.length) {\\n    return list;\\n  }\\n  return list.filter(character =>\\n    selectedTags.value.some(tag => getMergedTags(character).includes(tag)),\\n  );\\n}\\n\\nfunction toggleTagFilter(tag: string) {\\n  if (selectedTags.value.includes(tag)) {\\n    selectedTags.value = selectedTags.value.filter(item => item !== tag);\\n  } else {\\n    selectedTags.value = [...selectedTags.value, tag];\\n  }\\n}\\n\\nfunction clearTagFilter() {\\n  selectedTags.value = [];\\n}\\n\\n\\nfunction removeTag(character: CardHubItem, tag: string) {\\n  const nextTags = getMergedTags(character).filter(item => item !== tag);\\n  applyTagUpdate(character, nextTags);\\n}\\n\\nfunction tagKey(character: CardHubItem): string {\\n  return character.avatar ? `avatar:${character.avatar}` : `name:${character.name}`;\\n}\\n\\nfunction startTagEdit(character: CardHubItem) {\\n  activeTagKey.value = tagKey(character);\\n  tagInput.value = '';\\n  nextTick(() => {\\n    const input = document.querySelector<HTMLInputElement>('.cardhub-tag-input');\\n    input?.focus();\\n  });\\n}\\n\\nfunction confirmTag(character: CardHubItem) {\\n  if (activeTagKey.value !== tagKey(character)) {\\n    return;\\n  }\\n  const input = tagInput.value.trim();\\n  if (input) {\\n    const nextTags = [...getMergedTags(character), input];\\n    applyTagUpdate(character, nextTags);\\n  }\\n  cancelTagEdit();\\n}\\n\\nfunction cancelTagEdit() {\\n  activeTagKey.value = null;\\n  tagInput.value = '';\\n}\\n\\nfunction applyTagUpdate(character: CardHubItem, nextTags: string[]) {\\n  if (character.origin === 'library') {\\n    const updatedLibrary = updateLibraryTags(character.id, nextTags);\\n    setLibrary(updatedLibrary);\\n  } else {\\n    const next = updateCharacterTags(character, nextTags);\\n    character.tags = next;\\n    setCharacters([...state.characters]);\\n  }\\n}\\n\\nfunction triggerImport() {\\n  importInput.value?.click();\\n}\\n\\nasync function handleImportFiles(event: Event) {\\n  const target = event.target as HTMLInputElement | null;\\n  const files = target?.files;\\n  if (!files || !files.length) {\\n    return;\\n  }\\n  const updated = await addToLibrary(files);\\n  setLibrary(updated);\\n  target.value = '';\\n}\\n\\nfunction exportSelected() {\\n  const list = filteredCharacters.value;\\n  const tagLabel = selectedTags.value.length ? selectedTags.value.join('、') : '无';\\n  const statusLabel =\\n    statusFilter.value === 'all'\\n      ? '全部'\\n      : statusFilter.value === 'imported'\\n        ? '已导入'\\n        : '未导入';\\n  const searchLabel = state.search.trim() || '无';\\n  const message =\\n    `将导出 ${list.length} 张角色卡。\\\\n` +\\n    `筛选状态：${statusLabel}\\\\n` +\\n    `筛选标签：${tagLabel}\\\\n` +\\n    `搜索关键字：${searchLabel}\\\\n` +\\n    `是否继续？`;\\n\\n  if (!window.confirm(message)) {\\n    return;\\n  }\\n  if (!list.length) {\\n    toastr.warning('当前没有可导出的角色卡');\\n    return;\\n  }\\n  list.forEach(item => exportCard(item));\\n}\\n\\nasync function handleCardAction(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    await importLibraryCard(card);\\n  } else {\\n    exportCard(card);\\n  }\\n}\\n\\nasync function importLibraryCard(card: CardHubItem) {\\n  if (!card.raw || !card.rawType) {\\n    toastr.error('缺少导入数据');\\n    return;\\n  }\\n  const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\\n  delete (headers as Record<string, string>)['Content-Type'];\\n\\n  if (card.rawType === 'png') {\\n    const blob = await dataUrlToBlob(card.raw);\\n    await TavernHelper.importRawCharacter(card.name, blob);\\n  } else {\\n    const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\\n    const form = new FormData();\\n    form.append('avatar', file);\\n    form.append('file_type', 'json');\\n    form.append('preserved_name', file.name);\\n    await fetch('/api/characters/import', {\\n      method: 'POST',\\n      headers,\\n      body: form,\\n      cache: 'no-cache',\\n    });\\n  }\\n\\n  setLibrary(removeFromLibrary(card.id));\\n  const characters = await fetchCharacterSummaries();\\n  setCharacters(characters);\\n  toastr.success(`已导入 ${card.name}`);\\n}\\n\\nasync function exportCard(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    await exportLibraryCard(card);\\n    return;\\n  }\\n  if (!card.avatar) {\\n    toastr.error('无法导出：缺少头像信息');\\n    return;\\n  }\\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\\n  if (!avatarPath) {\\n    toastr.error('无法导出：缺少头像信息');\\n    return;\\n  }\\n  const response = await fetch(avatarPath, { cache: 'no-cache' });\\n  const blob = await response.blob();\\n  downloadBlob(blob, `${card.name}.png`);\\n}\\n\\nasync function exportLibraryCard(card: CardHubItem) {\\n  if (!card.raw || !card.rawType) {\\n    toastr.error('无法导出：缺少原始数据');\\n    return;\\n  }\\n  if (card.rawType === 'png') {\\n    const blob = await dataUrlToBlob(card.raw);\\n    downloadBlob(blob, `${card.name}.png`);\\n    return;\\n  }\\n  const blob = new Blob([card.raw], { type: 'application/json' });\\n  downloadBlob(blob, `${card.name}.json`);\\n}\\n\\nasync function openManage(card: CardHubItem) {\\n  manageCard.value = card;\\n  manageOpenings.value = await resolveOpenings(card);\\n  manageChats.value = await resolveRecentChats(card);\\n}\\n\\nfunction closeManage() {\\n  manageCard.value = null;\\n  manageOpenings.value = [];\\n  manageChats.value = [];\\n}\\n\\nasync function resolveOpenings(card: CardHubItem): Promise<string[]> {\\n  if (card.origin !== 'tavern') {\\n    return [];\\n  }\\n  const raw = await getFullCharacterData(card);\\n  const openings = extractOpeningMessages(raw);\\n  if (openings.length) {\\n    return openings;\\n  }\\n  const fallback =\\n    TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true } as any) ??\\n    TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true } as any);\\n  return extractOpeningMessages(fallback);\\n}\\n\\nasync function getFullCharacterData(card: CardHubItem): Promise<SillyTavern.v1CharData | null> {\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  if (ctx?.getCharacters) {\\n    try {\\n      await ctx.getCharacters();\\n    } catch (error) {\\n      console.warn('[CardHub] 刷新角色卡列表失败', error);\\n    }\\n  }\\n  const list = ctx?.characters ?? st?.characters ?? [];\\n  if (!list.length) {\\n    return null;\\n  }\\n  const byAvatar = card.avatar\\n    ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\\n    : -1;\\n  const byName = list.findIndex(item => item.name === card.name);\\n  const idx = byAvatar >= 0 ? byAvatar : byName;\\n  if (idx < 0) {\\n    return null;\\n  }\\n  if (ctx?.unshallowCharacter) {\\n    try {\\n      await ctx.unshallowCharacter(idx);\\n    } catch (error) {\\n      console.warn('[CardHub] 读取角色卡详情失败', error);\\n    }\\n  }\\n  const updatedList = ctx?.characters ?? list;\\n  const data = updatedList[idx] ?? null;\\n  if (data?.first_mes || data?.data?.first_mes) {\\n    return data;\\n  }\\n  if (ctx?.getCharacterCardFields) {\\n    try {\\n      const fields = await ctx.getCharacterCardFields({ chid: idx });\\n      if (fields?.first_mes || fields?.data?.first_mes) {\\n        return fields;\\n      }\\n    } catch (error) {\\n      console.warn('[CardHub] 读取角色卡字段失败', error);\\n    }\\n  }\\n  const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\\n  return fallback ?? data;\\n}\\n\\nfunction extractOpeningMessages(data: any): string[] {\\n  if (!data) {\\n    return [];\\n  }\\n  const list: string[] = [];\\n  const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\\n  if (typeof first === 'string' && first.trim()) {\\n    list.push(first.trim());\\n  }\\n  const alt =\\n    data?.alternate_greetings ??\\n    data?.data?.alternate_greetings ??\\n    data?.extensions?.alternate_greetings ??\\n    data?.data?.extensions?.alternate_greetings;\\n  if (Array.isArray(alt)) {\\n    alt.forEach(item => {\\n      if (typeof item === 'string' && item.trim()) {\\n        list.push(item.trim());\\n      }\\n    });\\n  } else if (typeof alt === 'string' && alt.trim()) {\\n    list.push(alt.trim());\\n  }\\n  return list;\\n}\\n\\nfunction normalizeBriefMessage(value: string): string {\\n  return value\\n    .replace(/<br\\\\s*\\\\/?>/gi, ' ')\\n    .replace(/<[^>]+>/g, ' ')\\n    .replace(/\\\\s+/g, ' ')\\n    .trim();\\n}\\n\\nfunction previewOpenings(openings: string[], maxItems: number): string[] {\\n  return openings\\n    .map(opening => previewOpeningLines(opening, 2).join('\\\\n'))\\n    .filter(preview => preview.trim().length > 0)\\n    .slice(0, maxItems);\\n}\\n\\nfunction previewOpeningLines(text: string, maxLines: number): string[] {\\n  const trimmed = text.replace(/\\\\r/g, '').trim();\\n  if (!trimmed) {\\n    return [];\\n  }\\n  const contentLines = extractContentLines(trimmed);\\n  if (contentLines.length >= maxLines) {\\n    return contentLines.slice(0, maxLines);\\n  }\\n  const normalized = normalizeBriefMessage(trimmed);\\n  if (!normalized) {\\n    return contentLines.slice(0, maxLines);\\n  }\\n  const chunks = chunkText(normalized, 60);\\n  if (!contentLines.length) {\\n    return chunks.slice(0, maxLines);\\n  }\\n  const combined = [...contentLines];\\n  for (const chunk of chunks) {\\n    if (combined.length >= maxLines) {\\n      break;\\n    }\\n    if (combined[0] !== chunk) {\\n      combined.push(chunk);\\n    }\\n  }\\n  return combined.slice(0, maxLines);\\n}\\n\\nfunction extractContentLines(text: string): string[] {\\n  const lines = text\\n    .split('\\\\n')\\n    .map(part => part.trim())\\n    .filter(part => part.length > 0);\\n  const filtered: string[] = [];\\n  for (const line of lines) {\\n    if (line.startsWith('```')) {\\n      continue;\\n    }\\n    if (/^<\\\\/?(html|head|body|meta|title|script|style|!doctype)\\\\b/i.test(line)) {\\n      continue;\\n    }\\n    filtered.push(line);\\n  }\\n  return filtered;\\n}\\n\\nfunction chunkText(text: string, size: number): string[] {\\n  const chunks: string[] = [];\\n  for (let i = 0; i < text.length; i += size) {\\n    const chunk = text.slice(i, i + size).trim();\\n    if (chunk) {\\n      chunks.push(chunk);\\n    }\\n  }\\n  return chunks;\\n}\\n\\nasync function resolveRecentChats(card: CardHubItem): Promise<Array<{ name: string; mes: string; file: string }>> {\\n  if (card.origin !== 'tavern') {\\n    return [];\\n  }\\n  const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\\n  if (!Array.isArray(brief) || !brief.length) {\\n    return [];\\n  }\\n  return brief.slice(0, 3).map((entry: any) => ({\\n    name: entry?.file_name ?? entry?.file_id ?? '聊天记录',\\n    file: String(entry?.file_name ?? entry?.file_id ?? ''),\\n    mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\\n  }));\\n}\\n\\nasync function openLatestChat() {\\n  if (!manageChats.value.length) {\\n    toastr.warning('暂无聊天记录');\\n    return;\\n  }\\n  await openChat(manageChats.value[0]);\\n}\\n\\nasync function openChat(chat: { file: string }) {\\n  const file = chat.file;\\n  if (!file) {\\n    toastr.warning('未找到聊天文件');\\n    return;\\n  }\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  const target = normalizeChatId(file);\\n  const list = ctx?.characters ?? st?.characters ?? [];\\n  const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\\n  const opener =\\n    (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\\n    (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\\n  if (!opener) {\\n    toastr.error('无法打开聊天：缺少接口');\\n    return;\\n  }\\n  if (idx < 0) {\\n    toastr.warning('未找到角色索引，请先手动切到该角色后再试');\\n    return;\\n  }\\n  if (typeof ctx?.getCharacters === 'function') {\\n    try {\\n      await ctx.getCharacters();\\n    } catch (error) {\\n      console.warn('[CardHub] 刷新角色列表失败', error);\\n    }\\n  }\\n  const selector =\\n    (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\\n    (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\\n  if (selector) {\\n    try {\\n      await selector(idx, { switchMenu: false });\\n    } catch (error) {\\n      console.warn('[CardHub] 切换角色失败', error);\\n    }\\n  } else {\\n    toastr.warning('无法切换角色，请先手动切到该角色后再试');\\n    return;\\n  }\\n  try {\\n    void Promise.resolve(opener(target)).catch(error => {\\n      console.warn('[CardHub] 打开聊天失败', error);\\n    });\\n  } catch (error) {\\n    console.warn('[CardHub] 打开聊天失败', error);\\n  }\\n  const opened = await waitForChatOpen(target, ctx, st, 6000);\\n  if (opened) {\\n    closeManage();\\n    closePreview();\\n    close();\\n    return;\\n  }\\n  toastr.warning('未能打开聊天，可能需要先手动切到该角色');\\n}\\n\\nfunction findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\\n  if (card.avatar) {\\n    const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\\n    if (byAvatar >= 0) {\\n      return byAvatar;\\n    }\\n  }\\n  return list.findIndex(item => item.name === card.name);\\n}\\n\\nfunction normalizeChatId(id: string): string {\\n  return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\\n}\\n\\nasync function waitForChatOpen(\\n  file: string,\\n  ctx: any,\\n  st: typeof SillyTavern | undefined,\\n  timeoutMs: number,\\n): Promise<boolean> {\\n  const target = normalizeChatId(file);\\n  const start = Date.now();\\n  while (Date.now() - start < timeoutMs) {\\n    const current = ctx?.chatId ?? st?.chatId;\\n    if (current === target) {\\n      return true;\\n    }\\n    await new Promise(resolve => setTimeout(resolve, 200));\\n  }\\n  return false;\\n}\\n\\nasync function manageDelete(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\\n      return;\\n    }\\n    setLibrary(removeFromLibrary(card.id));\\n    closeManage();\\n    return;\\n  }\\n\\n  if (!window.confirm(`确定要删除「${card.name}」吗？`)) {\\n    return;\\n  }\\n  const moveToLibraryChoice = window.confirm(\\n    `删除「${card.name}」：\\\\n点击“确定”=移到私有库\\\\n点击“取消”=永久删除`,\\n  );\\n  if (moveToLibraryChoice) {\\n    await moveToLibrary(card);\\n    const deleted = await deleteFromTavern(card, false);\\n    if (!deleted) {\\n      return;\\n    }\\n    closeManage();\\n    const characters = await fetchCharacterSummaries();\\n    setCharacters(characters);\\n    return;\\n  }\\n  if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\\n    return;\\n  }\\n  const deleted = await deleteFromTavern(card, true);\\n  if (!deleted) {\\n    return;\\n  }\\n  closeManage();\\n  const characters = await fetchCharacterSummaries();\\n  setCharacters(characters);\\n}\\n\\nasync function moveToLibrary(card: CardHubItem) {\\n  if (!card.avatar) {\\n    return;\\n  }\\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\\n  if (!avatarPath) {\\n    toastr.error('无法导出：缺少头像信息');\\n    return;\\n  }\\n  const response = await fetch(avatarPath, { cache: 'no-cache' });\\n  const blob = await response.blob();\\n  const updated = await addToLibrary([\\n    new File([blob], `${card.name}.png`, { type: 'image/png' }),\\n  ]);\\n  setLibrary(updated);\\n}\\n\\nasync function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\\n  if (!card.avatar) {\\n    toastr.error('删除失败：缺少头像信息');\\n    return false;\\n  }\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\\n    | Record<string, string>\\n    | undefined;\\n  if (!headers || !Object.keys(headers).length) {\\n    toastr.error('删除失败：无法获取请求头');\\n    return false;\\n  }\\n  const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\\n  const response = await fetch('/api/characters/delete', {\\n    method: 'POST',\\n    headers: { ...headers, 'Content-Type': 'application/json' },\\n    body: JSON.stringify(payload),\\n    cache: 'no-cache',\\n  });\\n  if (response.ok) {\\n    return true;\\n  }\\n  const detail = await response.text();\\n  toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\\n  return false;\\n}\\n\\nfunction downloadBlob(blob: Blob, fileName: string) {\\n  const url = URL.createObjectURL(blob);\\n  const a = document.createElement('a');\\n  a.href = url;\\n  a.download = fileName;\\n  document.body.appendChild(a);\\n  a.click();\\n  a.remove();\\n  URL.revokeObjectURL(url);\\n}\\n\\n\\n\\nasync function dataUrlToBlob(dataUrl: string): Promise<Blob> {\\n  const response = await fetch(dataUrl);\\n  return await response.blob();\\n}\\n\\n\\nasync function refresh() {\\n  setLoading(true);\\n  try {\\n    const characters = await fetchCharacterSummaries();\\n    setCharacters(characters);\\n    setLibrary(loadLibrary());\\n  } finally {\\n    setLoading(false);\\n  }\\n}\\n\\nfunction close() {\\n  setOpen(false);\\n}\\n\\n</script>\\n\\n<style scoped>\\n.cardhub-root {\\n  position: fixed;\\n  inset: 0;\\n  z-index: 9999;\\n  font-family: \\\"ZCOOL XiaoWei\\\", \\\"STSong\\\", \\\"Songti SC\\\", \\\"SimSun\\\", serif;\\n  color: #1b1b1b;\\n  display: none;\\n}\\n\\n.cardhub-root.open {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.cardhub-backdrop {\\n  position: absolute;\\n  inset: 0;\\n  background: radial-gradient(circle at top, rgba(255, 248, 236, 0.9), rgba(36, 30, 24, 0.85));\\n  backdrop-filter: blur(6px);\\n}\\n\\n.cardhub-panel {\\n  position: relative;\\n  width: min(980px, 94%);\\n  max-height: 92%;\\n  background: linear-gradient(160deg, #fff9f0, #f3e4d4);\\n  border-radius: 28px;\\n  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n  z-index: 1;\\n}\\n\\n.cardhub-header {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 20px 24px;\\n  border-bottom: 1px solid rgba(86, 59, 44, 0.15);\\n}\\n\\n.cardhub-title__main {\\n  font-size: 26px;\\n  letter-spacing: 2px;\\n}\\n\\n.cardhub-title__sub {\\n  font-size: 12px;\\n  color: #7d5b46;\\n  margin-left: 10px;\\n}\\n\\n.cardhub-actions {\\n  display: flex;\\n  gap: 10px;\\n}\\n\\n.cardhub-close {\\n  border: none;\\n  background: rgba(43, 32, 24, 0.12);\\n  color: #3b2a20;\\n  width: 34px;\\n  height: 34px;\\n  border-radius: 999px;\\n  font-size: 20px;\\n  line-height: 34px;\\n  text-align: center;\\n  cursor: pointer;\\n}\\n\\n.cardhub-close:hover {\\n  background: rgba(43, 32, 24, 0.2);\\n}\\n\\n.cardhub-toolbar {\\n  display: flex;\\n  gap: 10px;\\n  padding: 16px 24px;\\n  flex-wrap: wrap;\\n}\\n\\n.cardhub-search {\\n  flex: 1;\\n  min-width: 180px;\\n  border-radius: 999px;\\n  border: 1px solid rgba(86, 59, 44, 0.2);\\n  padding: 8px 14px;\\n  background: #fffaf4;\\n}\\n\\n.cardhub-button {\\n  border: none;\\n  padding: 8px 16px;\\n  border-radius: 999px;\\n  background: #d46b3d;\\n  color: #fff;\\n  cursor: pointer;\\n  font-size: 12px;\\n}\\n\\n.cardhub-button.is-ghost {\\n  background: transparent;\\n  color: #6a3f2a;\\n  border: 1px solid rgba(106, 63, 42, 0.4);\\n}\\n\\n.cardhub-import-input {\\n  display: none;\\n}\\n\\n.cardhub-body {\\n  display: grid;\\n  grid-template-columns: minmax(160px, 220px) 1fr;\\n  gap: 0;\\n  flex: 1;\\n  min-height: 0;\\n}\\n\\n.cardhub-sidebar {\\n  padding: 20px;\\n  border-right: 1px solid rgba(86, 59, 44, 0.15);\\n  display: flex;\\n  flex-direction: column;\\n  gap: 12px;\\n}\\n\\n.cardhub-chip-row {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-section-title {\\n  font-size: 12px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-chip {\\n  text-align: left;\\n  border: none;\\n  background: rgba(255, 255, 255, 0.6);\\n  border-radius: 12px;\\n  padding: 8px 10px;\\n  cursor: pointer;\\n  font-size: 12px;\\n}\\n\\n.cardhub-chip.is-active {\\n  background: #2b2018;\\n  color: #fff5ea;\\n}\\n\\n.cardhub-placeholder {\\n  font-size: 12px;\\n  color: #9a7a63;\\n}\\n\\n.cardhub-tag-filter {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-tag-filter__chip {\\n  border: 1px solid rgba(106, 63, 42, 0.25);\\n  background: rgba(255, 255, 255, 0.7);\\n  border-radius: 999px;\\n  padding: 6px 10px;\\n  font-size: 12px;\\n  color: #6a3f2a;\\n  cursor: pointer;\\n}\\n\\n.cardhub-tag-filter__chip.is-active {\\n  background: #2b2018;\\n  color: #fff5ea;\\n  border-color: transparent;\\n}\\n\\n.cardhub-chip--clear {\\n  margin-top: 8px;\\n}\\n\\n.cardhub-content {\\n  padding: 20px;\\n  overflow: auto;\\n}\\n\\n.cardhub-loading,\\n.cardhub-empty {\\n  padding: 40px 0;\\n  text-align: center;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-grid {\\n  display: grid;\\n  gap: 14px;\\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\\n}\\n\\n.cardhub-card {\\n  background: rgba(255, 255, 255, 0.78);\\n  border-radius: 18px;\\n  padding: 14px;\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  gap: 12px;\\n  align-items: center;\\n  border: 1px solid rgba(86, 59, 44, 0.15);\\n  cursor: pointer;\\n}\\n\\n.cardhub-card__avatar {\\n  width: 42px;\\n  height: 42px;\\n  border-radius: 12px;\\n  background: linear-gradient(135deg, #f4d7c4, #d36a3b);\\n  background-size: cover;\\n  background-position: center;\\n  color: #4a2a1f;\\n  display: grid;\\n  place-items: center;\\n  font-weight: 700;\\n}\\n\\n.cardhub-card__avatar.has-avatar span {\\n  display: none;\\n}\\n\\n.cardhub-card__name {\\n  font-size: 14px;\\n  font-weight: 600;\\n}\\n\\n.cardhub-card__meta {\\n  display: flex;\\n  gap: 8px;\\n  font-size: 11px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-card__tags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 6px;\\n  margin-top: 8px;\\n  align-items: center;\\n}\\n\\n.cardhub-tag {\\n  border: 1px solid rgba(106, 63, 42, 0.3);\\n  background: #fff6ea;\\n  border-radius: 999px;\\n  padding: 4px 8px;\\n  font-size: 11px;\\n  color: #6a3f2a;\\n  cursor: pointer;\\n}\\n\\n.cardhub-tag__remove {\\n  margin-left: 4px;\\n  font-weight: 700;\\n}\\n\\n.cardhub-tag.is-add {\\n  background: transparent;\\n  border-style: dashed;\\n}\\n\\n.cardhub-tag-input {\\n  border: 1px dashed rgba(106, 63, 42, 0.5);\\n  background: #fffaf4;\\n  border-radius: 999px;\\n  padding: 4px 10px;\\n  font-size: 11px;\\n  min-width: 80px;\\n  color: #6a3f2a;\\n  outline: none;\\n  height: 24px;\\n  line-height: 16px;\\n}\\n\\n.cardhub-tag-input:focus {\\n  border-color: rgba(106, 63, 42, 0.85);\\n}\\n\\n.cardhub-card__action {\\n  grid-column: span 2;\\n  margin-top: 10px;\\n  border: none;\\n  background: #2b2018;\\n  color: #fff5ea;\\n  padding: 6px 12px;\\n  border-radius: 12px;\\n  font-size: 12px;\\n  cursor: pointer;\\n}\\n\\n.cardhub-card__actions {\\n  grid-column: span 2;\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 8px;\\n  margin-top: 10px;\\n}\\n\\n.cardhub-card__action.is-secondary {\\n  background: #d9c6b6;\\n  color: #3b2a20;\\n}\\n\\n.cardhub-preview {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.45);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100000;\\n}\\n\\n.cardhub-preview__panel {\\n  width: min(520px, 92vw);\\n  background: #fff6ea;\\n  border-radius: 26px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 20px;\\n  position: relative;\\n  display: grid;\\n  gap: 14px;\\n}\\n\\n.cardhub-preview__close {\\n  position: absolute;\\n  top: 14px;\\n  right: 14px;\\n  border: none;\\n  width: 30px;\\n  height: 30px;\\n  border-radius: 999px;\\n  background: rgba(43, 32, 24, 0.15);\\n  color: #3b2a20;\\n  font-size: 18px;\\n  cursor: pointer;\\n}\\n\\n.cardhub-preview__avatar {\\n  width: 100%;\\n  height: 260px;\\n  border-radius: 18px;\\n  background: #ead7c4;\\n  display: grid;\\n  place-items: center;\\n  overflow: hidden;\\n}\\n\\n.cardhub-preview__avatar img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: contain;\\n}\\n\\n.cardhub-preview__info {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.cardhub-preview__name {\\n  font-size: 20px;\\n  font-weight: 700;\\n}\\n\\n.cardhub-preview__meta {\\n  display: flex;\\n  gap: 10px;\\n  font-size: 12px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-preview__tags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-preview__tag {\\n  padding: 6px 10px;\\n  border-radius: 999px;\\n  border: 1px solid rgba(106, 63, 42, 0.3);\\n  background: #fffaf4;\\n  font-size: 12px;\\n  color: #6a3f2a;\\n}\\n\\n.cardhub-preview__actions {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 10px;\\n}\\n\\n.cardhub-manage {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.45);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100001;\\n}\\n\\n.cardhub-manage__panel {\\n  width: min(760px, 94vw);\\n  max-height: 88vh;\\n  background: #fff6ea;\\n  border-radius: 26px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 22px;\\n  position: relative;\\n  display: grid;\\n  gap: 16px;\\n  overflow: auto;\\n}\\n\\n.cardhub-manage__top {\\n  display: grid;\\n  grid-template-columns: 1fr auto;\\n  gap: 16px;\\n  align-items: start;\\n}\\n\\n.cardhub-manage__media {\\n  width: 220px;\\n  aspect-ratio: 3 / 4;\\n  height: auto;\\n  border-radius: 18px;\\n  background: #ead7c4;\\n  display: grid;\\n  place-items: center;\\n  overflow: hidden;\\n}\\n\\n.cardhub-manage__media img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n}\\n\\n.cardhub-manage__summary {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.cardhub-manage__section {\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.cardhub-manage__label {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 8px;\\n  font-size: 12px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-manage__jump {\\n  border: 1px solid rgba(106, 63, 42, 0.35);\\n  background: transparent;\\n  color: #6a3f2a;\\n  border-radius: 999px;\\n  padding: 4px 10px;\\n  font-size: 11px;\\n  cursor: pointer;\\n  text-transform: none;\\n}\\n\\n.cardhub-manage__jump:hover {\\n  background: rgba(106, 63, 42, 0.1);\\n}\\n\\n.cardhub-manage__content {\\n  background: #fffaf4;\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  border-radius: 16px;\\n  padding: 12px 14px;\\n  font-size: 12px;\\n  line-height: 1.5;\\n  color: #3b2a20;\\n  white-space: pre-wrap;\\n}\\n\\n.cardhub-manage__opening {\\n  padding: 6px 0;\\n  border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\\n}\\n\\n.cardhub-manage__opening:last-child {\\n  border-bottom: none;\\n}\\n\\n.cardhub-manage__chat {\\n  display: grid;\\n  gap: 10px;\\n}\\n\\n.cardhub-manage__chat-row {\\n  display: grid;\\n  grid-template-columns: minmax(140px, 220px) 1fr;\\n  gap: 12px;\\n  font-size: 12px;\\n  color: #3b2a20;\\n  align-items: start;\\n  padding: 6px 8px;\\n  border-radius: 10px;\\n  cursor: pointer;\\n}\\n\\n.cardhub-manage__chat-row:hover {\\n  background: rgba(106, 63, 42, 0.08);\\n}\\n\\n.cardhub-manage__chat-name {\\n  flex: 0 0 auto;\\n  font-weight: 600;\\n  color: #6a3f2a;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__chat-text {\\n  color: #3b2a20;\\n  line-height: 1.5;\\n  display: -webkit-box;\\n  -webkit-line-clamp: 2;\\n  -webkit-box-orient: vertical;\\n  overflow: hidden;\\n}\\n\\n.cardhub-manage__empty {\\n  font-size: 12px;\\n  color: #9a7a63;\\n}\\n\\n.cardhub-manage__actions {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 10px;\\n}\\n@media (max-width: 720px) {\\n\\n  .cardhub-body {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .cardhub-sidebar {\\n    flex-direction: column;\\n    border-right: none;\\n    border-bottom: 1px solid rgba(86, 59, 44, 0.15);\\n    gap: 8px;\\n  }\\n\\n  .cardhub-chip-row,\\n  .cardhub-tag-filter {\\n    flex-wrap: nowrap;\\n    overflow-x: auto;\\n    padding-bottom: 4px;\\n  }\\n\\n  .cardhub-chip-row::-webkit-scrollbar,\\n  .cardhub-tag-filter::-webkit-scrollbar {\\n    height: 6px;\\n  }\\n\\n  .cardhub-chip-row::-webkit-scrollbar-thumb,\\n  .cardhub-tag-filter::-webkit-scrollbar-thumb {\\n    background: rgba(106, 63, 42, 0.2);\\n    border-radius: 999px;\\n  }\\n\\n  .cardhub-panel {\\n    width: min(98vw, 520px);\\n    max-height: 96vh;\\n  }\\n\\n  .cardhub-header {\\n    flex-direction: row;\\n    align-items: center;\\n    justify-content: space-between;\\n    gap: 8px;\\n    padding: 12px 14px;\\n  }\\n\\n  .cardhub-toolbar {\\n    display: grid;\\n    grid-template-columns: 1fr auto auto auto;\\n    gap: 8px;\\n    padding: 10px 14px 12px;\\n  }\\n\\n  .cardhub-search {\\n    width: 100%;\\n    grid-column: 1 / -1;\\n  }\\n\\n  .cardhub-button {\\n    width: 100%;\\n  }\\n\\n  .cardhub-button.is-ghost {\\n    grid-column: span 1;\\n  }\\n\\n  .cardhub-tag-filter__chip,\\n  .cardhub-tag {\\n    font-size: 10px;\\n    padding: 4px 8px;\\n  }\\n\\n  .cardhub-card {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .cardhub-card__action {\\n    grid-column: auto;\\n  }\\n  .cardhub-manage__panel {\\n    width: min(96vw, 560px);\\n    max-height: 90vh;\\n  }\\n\\n  .cardhub-manage__top {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .cardhub-manage__actions {\\n    grid-template-columns: 1fr;\\n  }\\n}\\n</style>\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcs_7d63b02763e68f083d716dcbb7369b8a/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=937272d2&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"4ccfd6e8\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcs_7d63b02763e68f083d716dcbb7369b8a/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=937272d2&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcs_7d63b02763e68f083d716dcbb7369b8a/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=937272d2&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  if ($(`#${buttonId}`).length) {\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] 未找到角色管理入口挂载点');\n    return null;\n  }\n\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button cardhub-entry-button')\n    .attr('title', '打开 CardHub 角色卡管理器')\n    .text('CardHub')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      controller.open('role');\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], () => controller.open('role'));\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return /角色管理/.test(text) || /角色管理/.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] 未找到左侧魔法棒入口');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .text('角色卡管理器')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        controller.open('magic');\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], () => controller.open('magic'));\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] 读取角色列表失败，将使用缓存数据', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map(character => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar ?? 'null';\n    const mappedIds = ctx?.tagMap?.[avatarKey] ?? [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = Array.from(new Set([...directTags, ...mappedTags]));\n\n    return {\n      id: character.avatar ?? character.name ?? `char-${Math.random()}`,\n      name: character.name ?? '未命名角色',\n      avatar: character.avatar ?? null,\n      tags,\n      origin: 'tavern',\n    };\n  });\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\n\nconst LIBRARY_KEY = 'cardhub_library';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibrary(): StoredLibrary {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  const raw = vars?.[LIBRARY_KEY];\n  if (!raw || typeof raw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((raw as StoredLibrary).entries) ? (raw as StoredLibrary).entries : [];\n  return { entries };\n}\n\nfunction writeLibrary(entries: CardHubItem[]) {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  TavernHelper.replaceVariables(getStorage(), {\n    ...vars,\n    [LIBRARY_KEY]: { entries },\n  });\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nexport function loadLibrary(): CardHubItem[] {\n  return readLibrary().entries;\n}\n\nexport async function addToLibrary(files: FileList | File[]): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return loadLibrary();\n  }\n  const current = loadLibrary();\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      nextEntries.push({\n        id: uuidv4(),\n        name,\n        avatar: dataUrl,\n        tags: [],\n        origin: 'library',\n        rawType: 'png',\n        raw: dataUrl,\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: [],\n        origin: 'library',\n        rawType: 'json',\n        raw: text,\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  writeLibrary(merged);\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[]): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.filter(entry => entry.id !== entryId);\n  writeLibrary(updated);\n  return updated;\n}\n\n\n\n","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setSearch(search: string) {\n  cardHubState.search = search;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library;\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar\n    ? ctx.characters.find(character => character.avatar === target.avatar)\n    : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nexport function getAllTagsFromContext(): string[] {\n  const ctx = getContext();\n  if (!ctx || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  return ctx.tags.map(tag => tag.name).filter(Boolean);\n}\n\nexport function getTagsForAvatar(avatar: string | null | undefined): string[] {\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const avatarKey = avatar ?? 'null';\n  const ids = ctx.tagMap[avatarKey] ?? [];\n  return ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const direct = target.tags ?? [];\n  const mapped = getTagsForAvatar(target.avatar);\n  return Array.from(new Set([...direct, ...mapped]));\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(\n    new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)),\n  );\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const avatarKey = character.avatar ?? 'null';\n  ctx.tagMap![avatarKey] = tagIds;\n\n  ctx.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub 角色卡管理器\"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-chip-row\" };\nconst _hoisted_6 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = { class: \"cardhub-content\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_10 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_11 = {\n    key: 2,\n    class: \"cardhub-grid\"\n};\nconst _hoisted_12 = [\"onClick\"];\nconst _hoisted_13 = { class: \"cardhub-card__info\" };\nconst _hoisted_14 = { class: \"cardhub-card__name\" };\nconst _hoisted_15 = { class: \"cardhub-card__meta\" };\nconst _hoisted_16 = { class: \"cardhub-card__tags\" };\nconst _hoisted_17 = [\"onClick\"];\nconst _hoisted_18 = [\"onClick\"];\nconst _hoisted_19 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_20 = { class: \"cardhub-card__actions\" };\nconst _hoisted_21 = [\"onClick\"];\nconst _hoisted_22 = [\"onClick\"];\nconst _hoisted_23 = {\n    class: \"cardhub-preview__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"角色卡预览\"\n};\nconst _hoisted_24 = { class: \"cardhub-preview__avatar\" };\nconst _hoisted_25 = [\"src\"];\nconst _hoisted_26 = { class: \"cardhub-preview__info\" };\nconst _hoisted_27 = { class: \"cardhub-preview__name\" };\nconst _hoisted_28 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_29 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_30 = { class: \"cardhub-preview__actions\" };\nconst _hoisted_31 = {\n    class: \"cardhub-manage__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"角色管理\"\n};\nconst _hoisted_32 = { class: \"cardhub-manage__top\" };\nconst _hoisted_33 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_34 = { class: \"cardhub-preview__name\" };\nconst _hoisted_35 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_36 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_37 = { class: \"cardhub-manage__media\" };\nconst _hoisted_38 = [\"src\"];\nconst _hoisted_39 = { class: \"cardhub-manage__section\" };\nconst _hoisted_40 = { class: \"cardhub-manage__content\" };\nconst _hoisted_41 = { class: \"cardhub-manage__section\" };\nconst _hoisted_42 = { class: \"cardhub-manage__label\" };\nconst _hoisted_43 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_44 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_45 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_46 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_47 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_48 = { class: \"cardhub-manage__actions\" };\nimport { computed, nextTick, ref } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { regexFromString } from './util/common';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const selectedTags = ref([]);\n        const activeTagKey = ref(null);\n        const tagInput = ref('');\n        const statusFilter = ref('all');\n        const importInput = ref(null);\n        const previewCard = ref(null);\n        const manageCard = ref(null);\n        const manageOpenings = ref([]);\n        const manageChats = ref([]);\n        const manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const filteredCharacters = computed(() => {\n            const list = applyStatusFilter(allCards.value);\n            const keyword = state.search.trim();\n            if (!keyword) {\n                return applyTagFilter(list);\n            }\n            const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), 'i');\n            return applyTagFilter(list).filter(character => {\n                return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\n            });\n        });\n        const allTags = computed(() => {\n            const tagSet = new Set();\n            allCards.value.forEach(character => {\n                getMergedTags(character).forEach(tag => tagSet.add(tag));\n            });\n            selectedTags.value.forEach(tag => tagSet.add(tag));\n            return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return getMergedTags(character);\n        }\n        function openPreview(card) {\n            previewCard.value = card;\n        }\n        function closePreview() {\n            previewCard.value = null;\n        }\n        const previewAvatarUrl = computed(() => {\n            if (!previewCard.value) {\n                return null;\n            }\n            return avatarUrl(previewCard.value, true);\n        });\n        const manageAvatarUrl = computed(() => {\n            if (!manageCard.value) {\n                return null;\n            }\n            return avatarUrl(manageCard.value, true);\n        });\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => item.origin === 'tavern');\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => item.origin === 'library');\n            }\n            return list;\n        }\n        function applyTagFilter(list) {\n            if (!selectedTags.value.length) {\n                return list;\n            }\n            return list.filter(character => selectedTags.value.some(tag => getMergedTags(character).includes(tag)));\n        }\n        function toggleTagFilter(tag) {\n            if (selectedTags.value.includes(tag)) {\n                selectedTags.value = selectedTags.value.filter(item => item !== tag);\n            }\n            else {\n                selectedTags.value = [...selectedTags.value, tag];\n            }\n        }\n        function clearTagFilter() {\n            selectedTags.value = [];\n        }\n        function removeTag(character, tag) {\n            const nextTags = getMergedTags(character).filter(item => item !== tag);\n            applyTagUpdate(character, nextTags);\n        }\n        function tagKey(character) {\n            return character.avatar ? `avatar:${character.avatar}` : `name:${character.name}`;\n        }\n        function startTagEdit(character) {\n            activeTagKey.value = tagKey(character);\n            tagInput.value = '';\n            nextTick(() => {\n                const input = document.querySelector('.cardhub-tag-input');\n                input?.focus();\n            });\n        }\n        function confirmTag(character) {\n            if (activeTagKey.value !== tagKey(character)) {\n                return;\n            }\n            const input = tagInput.value.trim();\n            if (input) {\n                const nextTags = [...getMergedTags(character), input];\n                applyTagUpdate(character, nextTags);\n            }\n            cancelTagEdit();\n        }\n        function cancelTagEdit() {\n            activeTagKey.value = null;\n            tagInput.value = '';\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (character.origin === 'library') {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTags(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        function triggerImport() {\n            importInput.value?.click();\n        }\n        async function handleImportFiles(event) {\n            const target = event.target;\n            const files = target?.files;\n            if (!files || !files.length) {\n                return;\n            }\n            const updated = await addToLibrary(files);\n            setLibrary(updated);\n            target.value = '';\n        }\n        function exportSelected() {\n            const list = filteredCharacters.value;\n            const tagLabel = selectedTags.value.length ? selectedTags.value.join('、') : '无';\n            const statusLabel = statusFilter.value === 'all'\n                ? '全部'\n                : statusFilter.value === 'imported'\n                    ? '已导入'\n                    : '未导入';\n            const searchLabel = state.search.trim() || '无';\n            const message = `将导出 ${list.length} 张角色卡。\\n` +\n                `筛选状态：${statusLabel}\\n` +\n                `筛选标签：${tagLabel}\\n` +\n                `搜索关键字：${searchLabel}\\n` +\n                `是否继续？`;\n            if (!window.confirm(message)) {\n                return;\n            }\n            if (!list.length) {\n                toastr.warning('当前没有可导出的角色卡');\n                return;\n            }\n            list.forEach(item => exportCard(item));\n        }\n        async function handleCardAction(card) {\n            if (card.origin === 'library') {\n                await importLibraryCard(card);\n            }\n            else {\n                exportCard(card);\n            }\n        }\n        async function importLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('缺少导入数据');\n                return;\n            }\n            const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {});\n            delete headers['Content-Type'];\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                await TavernHelper.importRawCharacter(card.name, blob);\n            }\n            else {\n                const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n                const form = new FormData();\n                form.append('avatar', file);\n                form.append('file_type', 'json');\n                form.append('preserved_name', file.name);\n                await fetch('/api/characters/import', {\n                    method: 'POST',\n                    headers,\n                    body: form,\n                    cache: 'no-cache',\n                });\n            }\n            setLibrary(removeFromLibrary(card.id));\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n            toastr.success(`已导入 ${card.name}`);\n        }\n        async function exportCard(card) {\n            if (card.origin === 'library') {\n                await exportLibraryCard(card);\n                return;\n            }\n            if (!card.avatar) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            downloadBlob(blob, `${card.name}.png`);\n        }\n        async function exportLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('无法导出：缺少原始数据');\n                return;\n            }\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                downloadBlob(blob, `${card.name}.png`);\n                return;\n            }\n            const blob = new Blob([card.raw], { type: 'application/json' });\n            downloadBlob(blob, `${card.name}.json`);\n        }\n        async function openManage(card) {\n            manageCard.value = card;\n            manageOpenings.value = await resolveOpenings(card);\n            manageChats.value = await resolveRecentChats(card);\n        }\n        function closeManage() {\n            manageCard.value = null;\n            manageOpenings.value = [];\n            manageChats.value = [];\n        }\n        async function resolveOpenings(card) {\n            if (card.origin !== 'tavern') {\n                return [];\n            }\n            const raw = await getFullCharacterData(card);\n            const openings = extractOpeningMessages(raw);\n            if (openings.length) {\n                return openings;\n            }\n            const fallback = TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            return extractOpeningMessages(fallback);\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色卡列表失败', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar\n                ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\n                : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡详情失败', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡字段失败', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function previewOpenings(openings, maxItems) {\n            return openings\n                .map(opening => previewOpeningLines(opening, 2).join('\\n'))\n                .filter(preview => preview.trim().length > 0)\n                .slice(0, maxItems);\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return [];\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return [];\n            }\n            return brief.slice(0, 3).map((entry) => ({\n                name: entry?.file_name ?? entry?.file_id ?? '聊天记录',\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n            }));\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('暂无聊天记录');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('未找到聊天文件');\n                return;\n            }\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            const target = normalizeChatId(file);\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('无法打开聊天：缺少接口');\n                return;\n            }\n            if (idx < 0) {\n                toastr.warning('未找到角色索引，请先手动切到该角色后再试');\n                return;\n            }\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色列表失败', error);\n                }\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (selector) {\n                try {\n                    await selector(idx, { switchMenu: false });\n                }\n                catch (error) {\n                    console.warn('[CardHub] 切换角色失败', error);\n                }\n            }\n            else {\n                toastr.warning('无法切换角色，请先手动切到该角色后再试');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] 打开聊天失败', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] 打开聊天失败', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                closeManage();\n                closePreview();\n                close();\n                return;\n            }\n            toastr.warning('未能打开聊天，可能需要先手动切到该角色');\n        }\n        function findCharacterIndex(list, card) {\n            if (card.avatar) {\n                const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\n                if (byAvatar >= 0) {\n                    return byAvatar;\n                }\n            }\n            return list.findIndex(item => item.name === card.name);\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await new Promise(resolve => setTimeout(resolve, 200));\n            }\n            return false;\n        }\n        async function manageDelete(card) {\n            if (card.origin === 'library') {\n                if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\n                    return;\n                }\n                setLibrary(removeFromLibrary(card.id));\n                closeManage();\n                return;\n            }\n            if (!window.confirm(`确定要删除「${card.name}」吗？`)) {\n                return;\n            }\n            const moveToLibraryChoice = window.confirm(`删除「${card.name}」：\\n点击“确定”=移到私有库\\n点击“取消”=永久删除`);\n            if (moveToLibraryChoice) {\n                await moveToLibrary(card);\n                const deleted = await deleteFromTavern(card, false);\n                if (!deleted) {\n                    return;\n                }\n                closeManage();\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                return;\n            }\n            if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\n                return;\n            }\n            const deleted = await deleteFromTavern(card, true);\n            if (!deleted) {\n                return;\n            }\n            closeManage();\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n        }\n        async function moveToLibrary(card) {\n            if (!card.avatar) {\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            const updated = await addToLibrary([\n                new File([blob], `${card.name}.png`, { type: 'image/png' }),\n            ]);\n            setLibrary(updated);\n        }\n        async function deleteFromTavern(card, deleteChats) {\n            if (!card.avatar) {\n                toastr.error('删除失败：缺少头像信息');\n                return false;\n            }\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.());\n            if (!headers || !Object.keys(headers).length) {\n                toastr.error('删除失败：无法获取请求头');\n                return false;\n            }\n            const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n            const response = await fetch('/api/characters/delete', {\n                method: 'POST',\n                headers: { ...headers, 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n                cache: 'no-cache',\n            });\n            if (response.ok) {\n                return true;\n            }\n            const detail = await response.text();\n            toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n            return false;\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                setLibrary(loadLibrary());\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }])\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[31] || (_cache[31] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"角色卡管理器\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"关闭\",\n                                onClick: close\n                            }, [...(_cache[30] || (_cache[30] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"×\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"搜索角色名或标签\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"刷新\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: triggerImport\n                        }, \"导入\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: exportSelected\n                        }, \"批量导出\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: handleImportFiles\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[32] || (_cache[32] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"分类\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                    type: \"button\",\n                                    onClick: _cache[1] || (_cache[1] = ($event) => (statusFilter.value = 'all'))\n                                }, \" 全部 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[2] || (_cache[2] = ($event) => (statusFilter.value = 'imported'))\n                                }, \" 已导入 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[3] || (_cache[3] = ($event) => (statusFilter.value = 'unimported'))\n                                }, \" 未导入 \", 2 /* CLASS */)\n                            ]),\n                            _cache[33] || (_cache[33] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"标签\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allTags.value, (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': selectedTags.value.includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (toggleTagFilter(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_7));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (selectedTags.value.length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: clearTagFilter\n                                }, \" 清空标签 \"))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"正在读取角色卡...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \" 暂无角色卡，或没有匹配的搜索结果。 \"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(filteredCharacters.value, (character) => {\n                                            return (_openBlock(), _createElementBlock(\"article\", {\n                                                key: character.id,\n                                                class: \"cardhub-card\",\n                                                onClick: ($event) => (openPreview(character))\n                                            }, [\n                                                _createElementVNode(\"div\", {\n                                                    class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                    style: _normalizeStyle(avatarStyle(character))\n                                                }, [\n                                                    _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                ], 6 /* CLASS, STYLE */),\n                                                _createElementVNode(\"div\", _hoisted_13, [\n                                                    _createElementVNode(\"div\", _hoisted_14, _toDisplayString(character.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_15, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" 标签\", 1 /* TEXT */)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_16, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: tag,\n                                                                class: \"cardhub-tag\",\n                                                                type: \"button\",\n                                                                title: \"点击移除标签\",\n                                                                onClick: ($event) => (removeTag(character, tag))\n                                                            }, [\n                                                                _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                _cache[34] || (_cache[34] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"×\", -1 /* CACHED */))\n                                                            ], 8 /* PROPS */, _hoisted_17));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (activeTagKey.value !== tagKey(character))\n                                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: 0,\n                                                                class: \"cardhub-tag is-add\",\n                                                                type: \"button\",\n                                                                onClick: ($event) => (startTagEdit(character))\n                                                            }, \" + 标签 \", 8 /* PROPS */, _hoisted_18))\n                                                            : _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                                                                key: 1,\n                                                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((tagInput).value = $event)),\n                                                                class: \"cardhub-tag-input\",\n                                                                type: \"text\",\n                                                                placeholder: \"新标签\",\n                                                                onKeydown: [\n                                                                    _withKeys(_withModifiers(($event) => (confirmTag(character)), [\"prevent\"]), [\"enter\"]),\n                                                                    _withKeys(_withModifiers(cancelTagEdit, [\"prevent\"]), [\"esc\"])\n                                                                ],\n                                                                onBlur: ($event) => (confirmTag(character))\n                                                            }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_19)), [\n                                                                [_vModelText, tagInput.value]\n                                                            ])\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_20, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-card__action is-secondary\",\n                                                        type: \"button\",\n                                                        onClick: _withModifiers(($event) => (handleCardAction(character)), [\"stop\"]),\n                                                        onPointerdown: _cache[5] || (_cache[5] = _withModifiers(() => { }, [\"stop\"])),\n                                                        onMousedown: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"])),\n                                                        onTouchstart: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"]))\n                                                    }, _toDisplayString(character.origin === 'tavern' ? '导出' : '导入'), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_21),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-card__action\",\n                                                        type: \"button\",\n                                                        onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                        onPointerdown: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"])),\n                                                        onMousedown: _cache[9] || (_cache[9] = _withModifiers(() => { }, [\"stop\"])),\n                                                        onTouchstart: _cache[10] || (_cache[10] = _withModifiers(() => { }, [\"stop\"]))\n                                                    }, \" 管理 \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_22)\n                                                ])\n                                            ], 8 /* PROPS */, _hoisted_12));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                        ])\n                    ])\n                ]),\n                (previewCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-preview\",\n                        onClick: _withModifiers(closePreview, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_23, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: closePreview\n                            }, \"×\"),\n                            _createElementVNode(\"div\", _hoisted_24, [\n                                (previewAvatarUrl.value)\n                                    ? (_openBlock(), _createElementBlock(\"img\", {\n                                        key: 0,\n                                        src: previewAvatarUrl.value,\n                                        alt: \"\"\n                                    }, null, 8 /* PROPS */, _hoisted_25))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_26, [\n                                _createElementVNode(\"div\", _hoisted_27, _toDisplayString(previewCard.value.name), 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_28, [\n                                    _createElementVNode(\"span\", null, _toDisplayString(previewCard.value.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                    _createElementVNode(\"span\", null, _toDisplayString(displayTags(previewCard.value).length) + \" 标签\", 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_29, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(previewCard.value), (tag) => {\n                                        return (_openBlock(), _createElementBlock(\"span\", {\n                                            key: tag,\n                                            class: \"cardhub-preview__tag\"\n                                        }, _toDisplayString(tag), 1 /* TEXT */));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_30, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-card__action is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[11] || (_cache[11] = _withModifiers(($event) => (handleCardAction(previewCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"]))\n                                }, _toDisplayString(previewCard.value.origin === 'tavern' ? '导出' : '导入'), 33 /* TEXT, NEED_HYDRATION */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-card__action\",\n                                    type: \"button\",\n                                    onClick: _cache[15] || (_cache[15] = _withModifiers(($event) => (openManage(previewCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"]))\n                                }, \" 管理 \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-manage\",\n                        onClick: _withModifiers(closeManage, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_31, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: closeManage\n                            }, \"×\"),\n                            _createElementVNode(\"div\", _hoisted_32, [\n                                _createElementVNode(\"div\", _hoisted_33, [\n                                    _createElementVNode(\"div\", _hoisted_34, _toDisplayString(manageCard.value.name), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_35, [\n                                        _createElementVNode(\"span\", null, _toDisplayString(manageCard.value.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(manageCard.value).length) + \" 标签\", 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_36, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(manageCard.value), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: tag,\n                                                class: \"cardhub-preview__tag\"\n                                            }, _toDisplayString(tag), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_37, [\n                                    (manageAvatarUrl.value)\n                                        ? (_openBlock(), _createElementBlock(\"img\", {\n                                            key: 0,\n                                            src: manageAvatarUrl.value,\n                                            alt: \"\"\n                                        }, null, 8 /* PROPS */, _hoisted_38))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_39, [\n                                _cache[35] || (_cache[35] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"开场白\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_40, [\n                                    (manageOpeningLines.value.length)\n                                        ? (_openBlock(true), _createElementBlock(_Fragment, { key: 0 }, _renderList(manageOpeningLines.value, (opening, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__opening\"\n                                            }, _toDisplayString(opening), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                            _createTextVNode(\"暂无开场白\")\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_41, [\n                                _createElementVNode(\"div\", _hoisted_42, [\n                                    _cache[36] || (_cache[36] = _createElementVNode(\"span\", null, \"最近聊天\", -1 /* CACHED */)),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__jump\",\n                                        type: \"button\",\n                                        onClick: openLatestChat,\n                                        onPointerdown: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"])),\n                                        onMousedown: _cache[20] || (_cache[20] = _withModifiers(() => { }, [\"stop\"])),\n                                        onTouchstart: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"]))\n                                    }, \" 进入最近聊天 \", 32 /* NEED_HYDRATION */)\n                                ]),\n                                (manageChats.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_43, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageChats.value, (msg, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__chat-row\",\n                                                role: \"button\",\n                                                tabindex: \"0\",\n                                                onClick: ($event) => (openChat(msg)),\n                                                onKeydown: _withKeys(_withModifiers(($event) => (openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                            }, [\n                                                _createElementVNode(\"span\", _hoisted_45, _toDisplayString(msg.name), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", _hoisted_46, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                            ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_44));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_47, \"暂无聊天记录\"))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_48, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-card__action is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[22] || (_cache[22] = _withModifiers(($event) => (handleCardAction(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[24] || (_cache[24] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[25] || (_cache[25] = _withModifiers(() => { }, [\"stop\"]))\n                                }, _toDisplayString(manageCard.value.origin === 'tavern' ? '导出' : '导入'), 33 /* TEXT, NEED_HYDRATION */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-card__action\",\n                                    type: \"button\",\n                                    onClick: _cache[26] || (_cache[26] = _withModifiers(($event) => (manageDelete(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[27] || (_cache[27] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[28] || (_cache[28] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[29] || (_cache[29] = _withModifiers(() => { }, [\"stop\"]))\n                                }, \" 删除 \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=937272d2&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-937272d2\"]])\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport App from '../ui/App.vue';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet app: ReturnType<typeof createApp> | null = null;\nlet $mount: JQuery<HTMLDivElement> | null = null;\nlet $style: JQuery<HTMLElement> | null = null;\n\nfunction ensureMounted() {\n  if ($mount) {\n    return;\n  }\n\n  $style = $(`<style>`)\n    .attr('data-cardhub-style', getScriptId())\n    .text(`\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: #1b1b1b;\n        display: none;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: radial-gradient(circle at top, rgba(255, 248, 236, 0.9), rgba(36, 30, 24, 0.85));\n        backdrop-filter: blur(6px);\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n        border-radius: 28px;\n        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: #7d5b46;\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(43, 32, 24, 0.12);\n        color: #3b2a20;\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 10px;\n        padding: 16px 24px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(86, 59, 44, 0.2);\n        padding: 8px 14px;\n        background: #fffaf4;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 8px 16px;\n        border-radius: 999px;\n        background: #d46b3d;\n        color: #fff;\n        cursor: pointer;\n        font-size: 12px;\n      }\n\n      .cardhub-button.is-ghost {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(86, 59, 44, 0.15);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n      }\n\n      .cardhub-chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(106, 63, 42, 0.25);\n        background: rgba(255, 255, 255, 0.7);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: #6a3f2a;\n        cursor: pointer;\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n        border-color: transparent;\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: #7d5b46;\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n      }\n\n      .cardhub-card {\n        background: rgba(255, 255, 255, 0.78);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(86, 59, 44, 0.15);\n        cursor: pointer;\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n        background-size: cover;\n        background-position: center;\n        color: #4a2a1f;\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fff6ea;\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: #6a3f2a;\n        cursor: pointer;\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(106, 63, 42, 0.5);\n        background: #fffaf4;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: #6a3f2a;\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(106, 63, 42, 0.85);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: #2b2018;\n        color: #fff5ea;\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(43, 32, 24, 0.15);\n        color: #3b2a20;\n        font-size: 18px;\n        cursor: pointer;\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fffaf4;\n        font-size: 12px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__jump {\n        border: 1px solid rgba(106, 63, 42, 0.35);\n        background: transparent;\n        color: #6a3f2a;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        text-transform: none;\n      }\n\n      .cardhub-manage__jump:hover {\n        background: rgba(106, 63, 42, 0.1);\n      }\n\n      .cardhub-manage__content {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: #3b2a20;\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(106, 63, 42, 0.08);\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: #6a3f2a;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: #3b2a20;\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n      @media (max-width: 720px) {\n\n        .cardhub-body {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-sidebar {\n          flex-direction: column;\n          border-right: none;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n          gap: 8px;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          padding-bottom: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 6px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.2);\n          border-radius: 999px;\n        }\n\n        .cardhub-panel {\n          width: min(98vw, 520px);\n          max-height: 96vh;\n        }\n\n        .cardhub-header {\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n          gap: 8px;\n          padding: 12px 14px;\n        }\n\n        .cardhub-toolbar {\n          display: grid;\n          grid-template-columns: 1fr auto auto auto;\n          gap: 8px;\n          padding: 10px 14px 12px;\n        }\n\n        .cardhub-search {\n          width: 100%;\n          grid-column: 1 / -1;\n        }\n\n        .cardhub-button {\n          width: 100%;\n        }\n\n        .cardhub-button.is-ghost {\n          grid-column: span 1;\n        }\n\n        .cardhub-tag-filter__chip,\n        .cardhub-tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-card {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-card__action {\n          grid-column: auto;\n        }\n      .cardhub-manage__panel {\n        width: min(96vw, 560px);\n        max-height: 90vh;\n      }\n\n      .cardhub-manage__top {\n        grid-template-columns: 1fr;\n      }\n\n      .cardhub-manage__actions {\n        grid-template-columns: 1fr;\n      }\n      }\n    `)\n    .appendTo('head');\n\n  $mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  app = createApp(App);\n  app.mount($mount[0]);\n\n  watch(() => cardHubState.open, () => {}, { immediate: true });\n}\n\n\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (app) {\n        app.unmount();\n      }\n      if ($mount) {\n        $mount.remove();\n      }\n      if ($style) {\n        $style.remove();\n      }\n      app = null;\n      $mount = null;\n      $style = null;\n    },\n  };\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["listToStyles","parentId","list","styles","newStyles","i","length","item","id","part","css","media","sourceMap","parts","push","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","join","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","module","exports","content","cssMapping","base64","data","concat","sourceMapping","sfc","props","target","__vccOpts","key","val","___CSS_LOADER_EXPORT___","cssWithMappingToString","toString","this","map","needLayer","modules","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","__esModule","default","locals","add","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$","$anchor","selectors","selector","$target","first","$button","_","el","text","title","getAttribute","$container","closest","parent","findRoleManagerAnchor","console","warn","attr","addClass","on","event","preventDefault","stopImmediatePropagation","open","append","bindOpenEvents","off","registerRoleManagerEntry","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","entryDisposer","setTimeout","observer","MutationObserver","rootDocument","window","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","handler","wrapped","addEventListener","capture","removeEventListener","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Vue","async","fetchCharacterSummaries","st","SillyTavern","ctx","getContext","getCharacters","error","characters","tagIdToName","Map","Array","isArray","tags","tag","name","set","character","directTags","avatarKey","avatar","mappedTags","tagMap","from","Set","Math","random","origin","uuidv4","replace","c","LIBRARY_KEY","getStorage","script_id","writeLibrary","entries","vars","TavernHelper","getVariables","replaceVariables","readFileAsDataUrl","file","Promise","resolve","reject","reader","FileReader","onload","String","result","onerror","readAsDataURL","readFileAsText","readAsText","normalizeName","fileName","loadLibrary","raw","readLibrary","addToLibrary","files","current","nextEntries","endsWith","dataUrl","rawType","parsedName","json","parse","merged","removeFromLibrary","entryId","updated","entry","cardHubState","reactive","loading","search","lastOpenSource","library","setOpen","source","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","direct","mapped","getTagsForAvatar","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","trim","tagIds","tagName","existing","crypto","randomUUID","Date","now","ensureTag","saveSettingsDebounced","_hoisted_1","class","role","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","__name","setup","__props","selectedTags","ref","activeTagKey","tagInput","statusFilter","importInput","previewCard","manageCard","manageOpenings","manageChats","manageOpeningLines","computed","previewOpenings","openings","maxItems","opening","maxLines","trimmed","contentLines","lines","split","filtered","line","startsWith","extractContentLines","slice","normalized","normalizeBriefMessage","chunks","size","chunk","chunkText","combined","previewOpeningLines","preview","allCards","filteredCharacters","applyStatusFilter","keyword","applyTagFilter","matcher","input","match","RegExp","escapeRegExp","flags","pull","indexOf","some","allTags","tagSet","sort","b","localeCompare","avatarUrl","useFull","getCharAvatarPath","avatarStyle","url","backgroundImage","displayTags","closePreview","previewAvatarUrl","manageAvatarUrl","includes","clearTagFilter","tagKey","confirmTag","applyTagUpdate","cancelTagEdit","updateLibraryTags","next","triggerImport","click","handleImportFiles","exportSelected","tagLabel","statusLabel","searchLabel","message","confirm","exportCard","toastr","warning","handleCardAction","card","headers","getRequestHeaders","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","fetch","method","cache","success","importLibraryCard","downloadBlob","Blob","exportLibraryCard","avatarPath","response","openManage","findIndex","byName","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","extractOpeningMessages","RawCharacter","allowAvatar","resolveOpenings","brief","getChatHistoryBrief","file_name","file_id","mes","resolveRecentChats","closeManage","alt","alternate_greetings","extensions","openLatestChat","openChat","chat","normalizeChatId","findCharacterIndex","opener","openCharacterChat","selectCharacterById","switchMenu","catch","opened","timeoutMs","start","chatId","waitForChatOpen","close","manageDelete","moveToLibrary","deleteFromTavern","deleteChats","keys","payload","avatar_url","delete_chats","ok","detail","status","statusText","URL","createObjectURL","href","download","revokeObjectURL","refresh","_ctx","_cache","onClick","$event","placeholder","ref_key","accept","multiple","onChange","style","nextTick","focus","onKeydown","onBlur","onPointerdown","onMousedown","onTouchstart","src","msg","tabindex","app","$mount","$style","ensureMounted","appendTo","createApp","App","mount","watch","immediate","createCardHubController","toggle","refreshCharacters","destroy","unmount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}