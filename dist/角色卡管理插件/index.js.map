{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src//entry/buttons.ts","src://tavern_helper_template/src//services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src//services/globalState.ts","src://tavern_helper_template/src//services/storageSettings.ts","src://tavern_helper_template/src//services/libraryStorageIndexedDb.ts","src://tavern_helper_template/src//services/libraryService.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src//state/store.ts","src://tavern_helper_template/src//services/tagService.ts","src://tavern_helper_template/src//ui/components/ManageContent.vue","webpack://tavern_helper_template/src//ui/components/ManageContent.vue?5bac","src://tavern_helper_template/src//ui/components/ManageOverview.vue","webpack://tavern_helper_template/src//ui/components/ManageOverview.vue?ce7d","src://tavern_helper_template/src//ui/components/ManageModal.vue","webpack://tavern_helper_template/src//ui/components/ManageModal.vue?bb46","src://tavern_helper_template/src//ui/composables/useBatchTags.ts","src://tavern_helper_template/src//ui/composables/useLibraryActions.ts","src://tavern_helper_template/src//ui/App.vue","src://tavern_helper_template/src//ui/composables/useTagFilters.ts","src://tavern_helper_template/src//ui/composables/useTagEditing.ts","webpack://tavern_helper_template/src//ui/App.vue?a8e8","src://tavern_helper_template/src//entry/portal.mount.ts","src://tavern_helper_template/src//entry/portal.styles.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src//entry/portal.controller.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  const $existing = $(`#${buttonId}`);\n  if ($existing.length) {\n    $existing\n      .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n      .attr('title', ' CardHub ')\n      .attr('aria-label', ' CardHub ')\n      .empty();\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const openOnce = createOpenOnce(() => controller.open('role'));\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n    .attr('title', ' CardHub ')\n    .attr('aria-label', ' CardHub ')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      openOnce();\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], openOnce);\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return //.test(text) || //.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const openOnce = createOpenOnce(() => controller.open('magic'));\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .html('<i class=\"fa-solid fa-id-badge\" aria-hidden=\"true\"></i><span></span>')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        openOnce();\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], openOnce);\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n\nfunction createOpenOnce(handler: () => void): () => void {\n  let lastFiredAt = 0;\n  return () => {\n    const now = Date.now();\n    if (now - lastFiredAt < 250) {\n      return;\n    }\n    lastFiredAt = now;\n    handler();\n  };\n}\n","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] ', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const idCounts = new Map<string, number>();\n  const tagKeyCounts = new Map<string, number>();\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map((character, index) => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar;\n    const name = character.name ?? '';\n    const createdRaw =\n      (character as any)?.create_date ??\n      (character as any)?.date_added ??\n      (character as any)?.created ??\n      (character as any)?.created_at ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      (character as any)?.data?.create_date ??\n      (character as any)?.data?.date_added ??\n      (character as any)?.data?.created ??\n      (character as any)?.data?.created_at ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n    const createdAt = coerceToTimestamp(createdRaw) ?? 0;\n    const stamp = createdRaw ?? String(index);\n    const tagBaseKey = avatarKey ?? `name:${name}::${stamp}`;\n    let tagKey = tagBaseKey;\n    if (!avatarKey) {\n      const tagCount = tagKeyCounts.get(tagBaseKey) ?? 0;\n      tagKeyCounts.set(tagBaseKey, tagCount + 1);\n      if (tagCount) {\n        tagKey = `${tagBaseKey}::${tagCount}`;\n      }\n    }\n\n    const hasTagKey = Boolean(ctx?.tagMap && Object.prototype.hasOwnProperty.call(ctx.tagMap, tagKey));\n    const mappedIds = hasTagKey ? (ctx!.tagMap![tagKey] ?? []) : [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = hasTagKey ? mappedTags : directTags;\n    const baseId = avatarKey ? `avatar:${avatarKey}` : `name:${name}::${stamp}`;\n    const count = idCounts.get(baseId) ?? 0;\n    idCounts.set(baseId, count + 1);\n    const id = count ? `${baseId}::${count}` : baseId;\n\n    const lastChatRaw =\n      (character as any)?.last_interaction ??\n      (character as any)?.last_interaction_time ??\n      (character as any)?.last_interaction_date ??\n      (character as any)?.last_chat_time ??\n      (character as any)?.last_chat_date ??\n      (character as any)?.last_message_time ??\n      (character as any)?.last_message_date ??\n      (character as any)?.update_time ??\n      (character as any)?.last_modified ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      (character as any)?.data?.last_interaction ??\n      (character as any)?.data?.last_interaction_time ??\n      (character as any)?.data?.last_interaction_date ??\n      (character as any)?.data?.last_chat_time ??\n      (character as any)?.data?.last_chat_date ??\n      (character as any)?.data?.last_message_time ??\n      (character as any)?.data?.last_message_date ??\n      (character as any)?.data?.update_time ??\n      (character as any)?.data?.last_modified ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n\n    return {\n      id,\n      name,\n      avatar: character.avatar ?? null,\n      tags,\n      tagKey,\n      origin: 'tavern',\n      createdAt,\n      lastChatAt: coerceToTimestamp(lastChatRaw) ?? 0,\n    };\n  });\n}\n\nfunction coerceToTimestamp(value: unknown): number | null {\n  if (typeof value === 'number' && !Number.isNaN(value)) {\n    return value < 1e12 ? value * 1000 : value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Date.parse(value);\n    if (!Number.isNaN(parsed)) {\n      return parsed;\n    }\n  }\n  return null;\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}'  >= '${expected}'`, '');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [` ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`   : ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`   : ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import type { StorageSettings } from './storageSettings';\n\nconst GLOBAL_STATE_KEY = 'cardhub_state';\n\ntype CardHubGlobalState = {\n  library?: {\n    entries?: unknown;\n  };\n  theme?: Record<string, string>;\n  favorites?: unknown;\n  lastChatCache?: unknown;\n  importCache?: unknown;\n  notes?: unknown;\n  storageSettings?: StorageSettings;\n  uiSettings?: {\n    pageSize?: number;\n    showNoteSummary?: boolean;\n    exportFormat?: 'png' | 'json';\n    tagRows?: number;\n    avatarSize?: 'sm' | 'md' | 'lg';\n    syncTavernTags?: boolean;\n  };\n};\n\nconst LEGACY_KEYS = {\n  library: 'cardhub_library',\n  theme: 'cardhub_theme',\n  favorites: 'cardhub_favorites',\n  lastChatCache: 'cardhub_last_chat_cache',\n  importCache: 'cardhub_import_cache',\n  notes: 'cardhub_notes',\n  storageSettings: 'cardhub_storage_settings',\n} as const;\n\nfunction normalizeState(raw: unknown): CardHubGlobalState {\n  if (!raw || typeof raw !== 'object') {\n    return {};\n  }\n  return raw as CardHubGlobalState;\n}\n\nfunction readVariables(): Record<string, unknown> {\n  return (TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>) ?? {};\n}\n\nfunction writeVariables(vars: Record<string, unknown>) {\n  TavernHelper.replaceVariables(vars, { type: 'global' });\n}\n\nexport function loadGlobalState(): CardHubGlobalState {\n  const vars = readVariables();\n  const state = normalizeState(vars[GLOBAL_STATE_KEY]);\n  let migrated = false;\n  const nextState: CardHubGlobalState = { ...state };\n\n  if (!nextState.library && vars[LEGACY_KEYS.library] && typeof vars[LEGACY_KEYS.library] === 'object') {\n    nextState.library = vars[LEGACY_KEYS.library] as CardHubGlobalState['library'];\n    migrated = true;\n  }\n  if (!nextState.theme && vars[LEGACY_KEYS.theme]) {\n    nextState.theme = vars[LEGACY_KEYS.theme] as CardHubGlobalState['theme'];\n    migrated = true;\n  }\n  if (!nextState.favorites && vars[LEGACY_KEYS.favorites]) {\n    nextState.favorites = vars[LEGACY_KEYS.favorites];\n    migrated = true;\n  }\n  if (!nextState.lastChatCache && vars[LEGACY_KEYS.lastChatCache]) {\n    nextState.lastChatCache = vars[LEGACY_KEYS.lastChatCache];\n    migrated = true;\n  }\n  if (!nextState.importCache && vars[LEGACY_KEYS.importCache]) {\n    nextState.importCache = vars[LEGACY_KEYS.importCache];\n    migrated = true;\n  }\n  if (!nextState.notes && vars[LEGACY_KEYS.notes]) {\n    nextState.notes = vars[LEGACY_KEYS.notes];\n    migrated = true;\n  }\n  if (!nextState.storageSettings && vars[LEGACY_KEYS.storageSettings]) {\n    nextState.storageSettings = vars[LEGACY_KEYS.storageSettings] as StorageSettings;\n    migrated = true;\n  }\n\n  if (migrated) {\n    const nextVars: Record<string, unknown> = { ...vars, [GLOBAL_STATE_KEY]: nextState };\n    (Object.values(LEGACY_KEYS) as string[]).forEach(key => {\n      delete nextVars[key];\n    });\n    writeVariables(nextVars);\n  }\n\n  return nextState;\n}\n\nexport function saveGlobalState(state: CardHubGlobalState): void {\n  const vars = readVariables();\n  const nextVars: Record<string, unknown> = { ...vars, [GLOBAL_STATE_KEY]: state };\n  (Object.values(LEGACY_KEYS) as string[]).forEach(key => {\n    delete nextVars[key];\n  });\n  writeVariables(nextVars);\n}\n\nexport function updateGlobalState(patch: Partial<CardHubGlobalState>): CardHubGlobalState {\n  const state = loadGlobalState();\n  const next = { ...state, ...patch };\n  saveGlobalState(next);\n  return next;\n}\n","import { loadGlobalState, updateGlobalState } from './globalState';\n\nexport type StorageMode = 'variables' | 'indexeddb';\n\nexport type StorageSettings = {\n  mode: StorageMode;\n};\n\nconst DEFAULT_SETTINGS: StorageSettings = {\n  mode: 'variables',\n};\n\nfunction normalizeSettings(raw: unknown): StorageSettings {\n  if (!raw || typeof raw !== 'object') {\n    return { ...DEFAULT_SETTINGS };\n  }\n  const data = raw as Record<string, unknown>;\n  const modeValue = typeof data.mode === 'string' ? data.mode : DEFAULT_SETTINGS.mode;\n  const mode: StorageMode =\n    modeValue === 'indexeddb' || modeValue === 'variables' ? modeValue : DEFAULT_SETTINGS.mode;\n  return {\n    mode,\n  };\n}\n\nexport function loadStorageSettings(): StorageSettings {\n  const state = loadGlobalState();\n  return normalizeSettings(state?.storageSettings);\n}\n\nexport function saveStorageSettings(settings: StorageSettings): void {\n  updateGlobalState({ storageSettings: settings });\n}\n","import type { CardHubItem } from '../types';\n\nconst DB_NAME = 'cardhub_storage';\nconst DB_VERSION = 2;\nconst STORE_NAME = 'library';\nconst LIBRARY_KEY = 'entries';\n\nlet dbPromise: Promise<IDBDatabase> | null = null;\n\nexport function isIndexedDbAvailable(): boolean {\n  return typeof indexedDB !== 'undefined';\n}\n\nfunction openDb(): Promise<IDBDatabase> {\n  if (dbPromise) {\n    return dbPromise;\n  }\n  dbPromise = new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n    request.onerror = () => reject(request.error);\n    request.onupgradeneeded = () => {\n      const db = request.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME);\n      }\n    };\n    request.onsuccess = () => resolve(request.result);\n  });\n  return dbPromise;\n}\n\nexport async function readLibraryFromIndexedDb(): Promise<CardHubItem[]> {\n  if (!isIndexedDbAvailable()) {\n    return [];\n  }\n  const db = await openDb();\n  return await new Promise<CardHubItem[]>((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(LIBRARY_KEY);\n    request.onerror = () => reject(request.error);\n    request.onsuccess = () => {\n      const result = request.result;\n      resolve(Array.isArray(result) ? (result as CardHubItem[]) : []);\n    };\n  });\n}\n\nexport async function writeLibraryToIndexedDb(entries: CardHubItem[]): Promise<void> {\n  if (!isIndexedDbAvailable()) {\n    return;\n  }\n  const db = await openDb();\n  await new Promise<void>((resolve, reject) => {\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.put(entries, LIBRARY_KEY);\n    request.onerror = () => reject(request.error);\n    request.onsuccess = () => resolve();\n  });\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\nimport { loadStorageSettings, type StorageMode } from './storageSettings';\nimport { loadGlobalState, updateGlobalState } from './globalState';\nimport {\n  isIndexedDbAvailable,\n  readLibraryFromIndexedDb,\n  writeLibraryToIndexedDb,\n} from './libraryStorageIndexedDb';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getScriptStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibraryFromVariables(): StoredLibrary {\n  const state = loadGlobalState();\n  if (state?.library && typeof state.library === 'object') {\n    const entries = Array.isArray((state.library as StoredLibrary).entries)\n      ? ((state.library as StoredLibrary).entries as CardHubItem[])\n      : [];\n    return { entries };\n  }\n\n  const scriptVars = TavernHelper.getVariables(getScriptStorage()) as Record<string, unknown>;\n  const scriptRaw = scriptVars?.['cardhub_library'];\n  if (!scriptRaw || typeof scriptRaw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((scriptRaw as StoredLibrary).entries) ? (scriptRaw as StoredLibrary).entries : [];\n  if (entries.length) {\n    writeLibraryToVariables(entries);\n  }\n  return { entries };\n}\n\nfunction writeLibraryToVariables(entries: CardHubItem[]) {\n  updateGlobalState({ library: { entries } });\n}\n\nasync function readLibraryFromStorage(): Promise<CardHubItem[]> {\n  const settings = loadStorageSettings();\n  if (settings.mode === 'indexeddb') {\n    if (!isIndexedDbAvailable()) {\n      return readLibraryFromVariables().entries;\n    }\n    try {\n      return await readLibraryFromIndexedDb();\n    } catch (error) {\n      console.warn('[CardHub]  IndexedDB ', error);\n      return readLibraryFromVariables().entries;\n    }\n  }\n  return readLibraryFromVariables().entries;\n}\n\nexport async function persistLibrary(entries: CardHubItem[], modeOverride?: StorageMode): Promise<void> {\n  const mode = modeOverride ?? loadStorageSettings().mode;\n  if (mode === 'indexeddb') {\n    if (!isIndexedDbAvailable()) {\n      writeLibraryToVariables(entries);\n      return;\n    }\n    try {\n      await writeLibraryToIndexedDb(entries);\n    } catch (error) {\n      console.warn('[CardHub]  IndexedDB ', error);\n      writeLibraryToVariables(entries);\n    }\n    return;\n  }\n  writeLibraryToVariables(entries);\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction parseJsonSafe(raw: string): any | null {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nfunction decodeBase64Text(value: string): string | null {\n  try {\n    const binary = atob(value);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return new TextDecoder().decode(bytes);\n  } catch {\n    return null;\n  }\n}\n\nfunction isLikelyBase64(value: string): boolean {\n  if (value.length < 16 || value.length % 4 !== 0) {\n    return false;\n  }\n  return /^[A-Za-z0-9+/=]+$/.test(value);\n}\n\nfunction parseCardPayload(value: string): any | null {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n  const direct = parseJsonSafe(trimmed);\n  if (direct) {\n    return direct;\n  }\n  if (!isLikelyBase64(trimmed)) {\n    return null;\n  }\n  const decoded = decodeBase64Text(trimmed);\n  if (!decoded) {\n    return null;\n  }\n  return parseJsonSafe(decoded);\n}\n\nfunction extractCardTagsFromData(data: any): string[] {\n  const tags = data?.tags ?? data?.data?.tags;\n  if (!Array.isArray(tags)) {\n    return [];\n  }\n  return tags\n    .filter(tag => typeof tag === 'string')\n    .map(tag => tag.trim())\n    .filter(Boolean);\n}\n\nfunction dataUrlToBytes(dataUrl: string): Uint8Array | null {\n  const comma = dataUrl.indexOf(',');\n  if (comma < 0) {\n    return null;\n  }\n  const base64 = dataUrl.slice(comma + 1);\n  try {\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n  } catch {\n    return null;\n  }\n}\n\nfunction bytesToString(bytes: Uint8Array): string {\n  return new TextDecoder().decode(bytes);\n}\n\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\n  return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n}\n\nfunction parseTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseIntlTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const compressed = data[nullIndex + 1] === 1;\n  let cursor = nullIndex + 2;\n  const langEnd = data.indexOf(0, cursor);\n  if (langEnd < 0) {\n    return null;\n  }\n  cursor = langEnd + 1;\n  const translatedEnd = data.indexOf(0, cursor);\n  if (translatedEnd < 0) {\n    return null;\n  }\n  cursor = translatedEnd + 1;\n  if (compressed) {\n    return null;\n  }\n  const value = bytesToString(data.subarray(cursor)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction extractPngTextChunks(bytes: Uint8Array): Array<{ key: string; value: string }> {\n  if (bytes.length < 8) {\n    return [];\n  }\n  const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n  for (let i = 0; i < signature.length; i += 1) {\n    if (bytes[i] !== signature[i]) {\n      return [];\n    }\n  }\n  const chunks: Array<{ key: string; value: string }> = [];\n  let offset = 8;\n  while (offset + 8 <= bytes.length) {\n    const length = readUint32BE(bytes, offset);\n    const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n    const dataStart = offset + 8;\n    const dataEnd = dataStart + length;\n    if (dataEnd + 4 > bytes.length) {\n      break;\n    }\n    const data = bytes.subarray(dataStart, dataEnd);\n    if (type === 'tEXt') {\n      const entry = parseTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    } else if (type === 'iTXt') {\n      const entry = parseIntlTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    }\n    offset = dataEnd + 4;\n  }\n  return chunks;\n}\n\nfunction parsePngCardName(dataUrl: string): string | null {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return null;\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    const name = parsed?.name ?? parsed?.data?.name;\n    if (typeof name === 'string' && name.trim()) {\n      return name.trim();\n    }\n  }\n  return null;\n}\n\nfunction parsePngCardTags(dataUrl: string): string[] {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return [];\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    if (parsed) {\n      const tags = extractCardTagsFromData(parsed);\n      if (tags.length) {\n        return tags;\n      }\n    }\n  }\n  return [];\n}\n\nfunction parseJsonCardTags(raw: string): string[] {\n  const parsed = parseJsonSafe(raw);\n  return parsed ? extractCardTagsFromData(parsed) : [];\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nfunction hashString(value: string): string {\n  let hash = 5381;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = (hash * 33) ^ value.charCodeAt(i);\n  }\n  return (hash >>> 0).toString(16);\n}\n\nfunction stableStringify(value: unknown): string {\n  if (value === null || typeof value !== 'object') {\n    return JSON.stringify(value);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(item => stableStringify(item)).join(',')}]`;\n  }\n  const entries = Object.entries(value as Record<string, unknown>).sort(([a], [b]) => a.localeCompare(b));\n  return `{${entries.map(([key, val]) => `${JSON.stringify(key)}:${stableStringify(val)}`).join(',')}}`;\n}\n\nfunction buildFingerprint(rawType: CardHubItem['rawType'], raw: string): string {\n  let source = raw;\n  if (rawType === 'json') {\n    const trimmed = raw.trim();\n    try {\n      source = stableStringify(JSON.parse(trimmed));\n    } catch {\n      source = trimmed;\n    }\n  }\n  return `${rawType}:${hashString(source)}`;\n}\n\nfunction ensureFingerprint(entry: CardHubItem): string | null {\n  if (entry.fingerprint) {\n    return entry.fingerprint;\n  }\n  if (!entry.rawType || !entry.raw) {\n    return null;\n  }\n  const fingerprint = buildFingerprint(entry.rawType, entry.raw);\n  entry.fingerprint = fingerprint;\n  return fingerprint;\n}\n\ntype NormalizeResult = { entries: CardHubItem[]; changed: boolean };\n\nfunction normalizeLibraryEntriesInternal(stored: CardHubItem[]): NormalizeResult {\n  let changed = false;\n  const now = Date.now();\n  const entries = stored.map((entry, index) => {\n    const normalized: CardHubItem = {\n      ...entry,\n      id: entry.id ?? uuidv4(),\n      origin: entry.origin ?? 'library',\n      tags: Array.isArray(entry.tags) ? entry.tags : [],\n      note: typeof entry.note === 'string' ? entry.note : '',\n    };\n    if (!normalized.tagsEdited && !normalized.tags.length && normalized.raw && normalized.rawType) {\n      const rawTags =\n        normalized.rawType === 'png' ? parsePngCardTags(normalized.raw) : parseJsonCardTags(normalized.raw);\n      if (rawTags.length) {\n        normalized.tags = rawTags;\n        changed = true;\n      }\n    }\n    if (typeof normalized.createdAt === 'number') {\n      return normalized;\n    }\n    changed = true;\n    return {\n      ...normalized,\n      createdAt: now - (stored.length - 1 - index) * 1000,\n    };\n  });\n  return { entries, changed };\n}\n\nexport function normalizeLibraryEntries(stored: CardHubItem[]): CardHubItem[] {\n  return normalizeLibraryEntriesInternal(stored).entries;\n}\n\nexport async function loadLibrary(): Promise<CardHubItem[]> {\n  const stored = await readLibraryFromStorage();\n  const { entries, changed } = normalizeLibraryEntriesInternal(stored);\n  if (changed) {\n    void persistLibrary(entries);\n  }\n  return entries;\n}\n\nexport async function addToLibrary(files: FileList | File[], existingEntries?: CardHubItem[]): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return await loadLibrary();\n  }\n  const current =\n    Array.isArray(existingEntries) && existingEntries.length ? existingEntries : await loadLibrary();\n  const fingerprints = new Set<string>();\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n  });\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      const parsedName = parsePngCardName(dataUrl) ?? name;\n      const parsedTags = parsePngCardTags(dataUrl);\n      const fingerprint = buildFingerprint('png', dataUrl);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: dataUrl,\n        tags: parsedTags,\n        origin: 'library',\n        note: '',\n        importFileName: file.name,\n        rawType: 'png',\n        raw: dataUrl,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      const parsedTags = parseJsonCardTags(text);\n      const fingerprint = buildFingerprint('json', text);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: parsedTags,\n        origin: 'library',\n        note: '',\n        importFileName: file.name,\n        rawType: 'json',\n        raw: text,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  void persistLibrary(merged);\n  return merged;\n}\n\nexport function parseLibraryBackup(raw: string): CardHubItem[] | null {\n  const parsed = parseJsonSafe(raw);\n  if (!parsed || typeof parsed !== 'object') {\n    return null;\n  }\n  const entries = (parsed as { entries?: unknown }).entries;\n  if (!Array.isArray(entries)) {\n    return null;\n  }\n  return entries as CardHubItem[];\n}\n\nexport function mergeLibraryEntries(current: CardHubItem[], incoming: CardHubItem[]): CardHubItem[] {\n  const normalizedIncoming = normalizeLibraryEntries(incoming);\n  const fingerprints = new Set<string>();\n  const merged: CardHubItem[] = [];\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n    merged.push(entry);\n  });\n  normalizedIncoming.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint && fingerprints.has(fingerprint)) {\n      return;\n    }\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n    merged.push(entry);\n  });\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[], existingEntries?: CardHubItem[]): CardHubItem[] {\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : [];\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags, tagsEdited: true };\n  });\n  void persistLibrary(updated);\n  return updated;\n}\n\nexport function updateLibraryNote(entryId: string, note: string, existingEntries?: CardHubItem[]): CardHubItem[] {\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : [];\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, note };\n  });\n  void persistLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string, existingEntries?: CardHubItem[]): CardHubItem[] {\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : [];\n  const updated = current.filter(entry => entry.id !== entryId);\n  void persistLibrary(updated);\n  return updated;\n}\n\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library.map(entry => ({\n    ...entry,\n    origin: entry.origin ?? 'library',\n    tags: Array.isArray(entry.tags) ? entry.tags : [],\n    note: typeof entry.note === 'string' ? entry.note : '',\n  }));\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar ? ctx.characters.find(character => character.avatar === target.avatar) : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nfunction getTagMapEntry(tagKey: string | null | undefined): { hasKey: boolean; tags: string[] } {\n  if (!tagKey) {\n    return { hasKey: false, tags: [] };\n  }\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return { hasKey: false, tags: [] };\n  }\n  const hasKey = Object.prototype.hasOwnProperty.call(ctx.tagMap, tagKey);\n  if (!hasKey) {\n    return { hasKey: false, tags: [] };\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const ids = ctx.tagMap[tagKey] ?? [];\n  const tags = ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n  return { hasKey: true, tags };\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const entry = getTagMapEntry(target.tagKey ?? target.avatar);\n  if (entry.hasKey) {\n    return entry.tags;\n  }\n  return target.tags ?? [];\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)));\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const tagKey = target.tagKey ?? character.avatar ?? null;\n  if (tagKey) {\n    ctx.tagMap![tagKey] = tagIds;\n  }\n\n  ctx.saveSettingsDebounced?.();\n  const st = window.parent?.SillyTavern ?? SillyTavern;\n  st?.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = { class: \"cardhub-manage__section\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"cardhub-manage__details\"\n};\nconst _hoisted_3 = { class: \"cardhub-manage__detail-head\" };\nconst _hoisted_4 = { class: \"cardhub-manage__detail-label\" };\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = { class: \"cardhub-manage__detail-content\" };\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_9 = { class: \"cardhub-manage__section\" };\nconst _hoisted_10 = { class: \"cardhub-manage__label\" };\nconst _hoisted_11 = { class: \"cardhub-manage__content\" };\nconst _hoisted_12 = {\n    key: 0,\n    class: \"cardhub-manage__opening-meta\"\n};\nconst _hoisted_13 = { class: \"cardhub-manage__opening-meta-value\" };\nconst _hoisted_14 = {\n    key: 0,\n    class: \"cardhub-manage__opening-meta-hint\"\n};\nconst _hoisted_15 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_16 = {\n    key: 2,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_17 = { class: \"cardhub-manage__section\" };\nconst _hoisted_18 = { class: \"cardhub-manage__label\" };\nconst _hoisted_19 = { class: \"cardhub-manage__jump-row\" };\nconst _hoisted_20 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_21 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_22 = { class: \"cardhub-manage__chat-main\" };\nconst _hoisted_23 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_24 = {\n    key: 0,\n    class: \"cardhub-manage__chat-label\"\n};\nconst _hoisted_25 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_26 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_27 = {\n    key: 2,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_28 = [\"disabled\"];\nconst _hoisted_29 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_30 = [\"disabled\"];\nconst _hoisted_31 = { class: \"cardhub-manage__actions\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageContent',\n    props: {\n        manageCard: {},\n        manageDetails: {},\n        manageDetailsHint: {},\n        openingItems: {},\n        openingSummary: {},\n        manageChats: {},\n        pagedChats: {},\n        chatPage: {},\n        chatTotalPages: {},\n        manageChatHint: {},\n        openDetail: { type: Function },\n        openEdit: { type: Function },\n        openOpeningList: { type: Function },\n        openLatestChat: { type: Function },\n        openNewChat: { type: Function },\n        openChat: { type: Function },\n        prevChatPage: { type: Function },\n        nextChatPage: { type: Function },\n        handleCardAction: { type: Function },\n        manageDelete: { type: Function }\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _cache[19] || (_cache[19] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"\", -1 /* CACHED */)),\n                    (__props.manageDetails.length)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.manageDetails, (detail) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: detail.label,\n                                    class: \"cardhub-manage__detail\"\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_3, [\n                                        _createElementVNode(\"div\", _hoisted_4, _toDisplayString(detail.label), 1 /* TEXT */),\n                                        (detail.editable)\n                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                key: 0,\n                                                class: \"cardhub-manage__detail-edit\",\n                                                type: \"button\",\n                                                onClick: ($event) => (__props.openEdit(detail))\n                                            }, \"  \", 8 /* PROPS */, _hoisted_5))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_6, _toDisplayString(detail.preview), 1 /* TEXT */),\n                                    (detail.hasMore)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"cardhub-manage__detail-toggle\",\n                                            type: \"button\",\n                                            onClick: ($event) => (__props.openDetail(detail))\n                                        }, \"  \", 8 /* PROPS */, _hoisted_7))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_8, _toDisplayString(__props.manageDetailsHint), 1 /* TEXT */))\n                ]),\n                _createElementVNode(\"div\", _hoisted_9, [\n                    _createElementVNode(\"div\", _hoisted_10, [\n                        _cache[20] || (_cache[20] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                        (__props.openingItems.length)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 0,\n                                class: \"cardhub-manage__toggle\",\n                                type: \"button\",\n                                onClick: _cache[0] || (_cache[0] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openOpeningList && __props.openOpeningList(...args)))\n                            }, \" \" + _toDisplayString(__props.openingItems.length) + \" \", 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_11, [\n                        (__props.openingSummary.hasData)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [\n                                _createElementVNode(\"span\", _hoisted_13, _toDisplayString(__props.openingSummary.value), 1 /* TEXT */),\n                                (__props.openingSummary.hint)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_14, _toDisplayString(__props.openingSummary.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                            : _createCommentVNode(\"v-if\", true),\n                        (!__props.openingItems.length)\n                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, \"\"))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_16, \"\"))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_17, [\n                    _createElementVNode(\"div\", _hoisted_18, [\n                        _cache[21] || (_cache[21] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_19, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__btn is-primary\",\n                                type: \"button\",\n                                onClick: _cache[1] || (_cache[1] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openLatestChat && __props.openLatestChat(...args))),\n                                onPointerdown: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"])),\n                                onMousedown: _cache[3] || (_cache[3] = _withModifiers(() => { }, [\"stop\"])),\n                                onTouchstart: _cache[4] || (_cache[4] = _withModifiers(() => { }, [\"stop\"]))\n                            }, \"  \", 32 /* NEED_HYDRATION */),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__btn is-secondary\",\n                                type: \"button\",\n                                onClick: _cache[5] || (_cache[5] =\n                                    //@ts-ignore\n                                    (...args) => (__props.openNewChat && __props.openNewChat(...args))),\n                                onPointerdown: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"])),\n                                onMousedown: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"])),\n                                onTouchstart: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"]))\n                            }, \"  \", 32 /* NEED_HYDRATION */)\n                        ])\n                    ]),\n                    (__props.pagedChats.length)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.pagedChats, (msg, index) => {\n                                return (_openBlock(), _createElementBlock(\"div\", {\n                                    key: index,\n                                    class: \"cardhub-manage__chat-row\",\n                                    role: \"button\",\n                                    tabindex: \"0\",\n                                    onClick: ($event) => (__props.openChat(msg)),\n                                    onKeydown: _withKeys(_withModifiers(($event) => (__props.openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_22, [\n                                        _createElementVNode(\"div\", _hoisted_23, _toDisplayString(msg.name), 1 /* TEXT */),\n                                        (msg.label && msg.label !== msg.name)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_24, _toDisplayString(msg.label), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ]),\n                                    _createElementVNode(\"span\", _hoisted_25, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_21));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]))\n                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_26, _toDisplayString(__props.manageChatHint), 1 /* TEXT */)),\n                    (__props.chatTotalPages > 1)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_27, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__pager-btn\",\n                                type: \"button\",\n                                disabled: __props.chatPage <= 1,\n                                onClick: _cache[9] || (_cache[9] =\n                                    //@ts-ignore\n                                    (...args) => (__props.prevChatPage && __props.prevChatPage(...args)))\n                            }, \"  \", 8 /* PROPS */, _hoisted_28),\n                            _createElementVNode(\"span\", _hoisted_29, _toDisplayString(__props.chatPage) + \" / \" + _toDisplayString(__props.chatTotalPages), 1 /* TEXT */),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-manage__pager-btn\",\n                                type: \"button\",\n                                disabled: __props.chatPage >= __props.chatTotalPages,\n                                onClick: _cache[10] || (_cache[10] =\n                                    //@ts-ignore\n                                    (...args) => (__props.nextChatPage && __props.nextChatPage(...args)))\n                            }, \"  \", 8 /* PROPS */, _hoisted_30)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createElementVNode(\"div\", _hoisted_31, [\n                    _createElementVNode(\"button\", {\n                        class: \"cardhub-manage__btn is-secondary\",\n                        type: \"button\",\n                        onClick: _cache[11] || (_cache[11] = _withModifiers(($event) => (__props.handleCardAction(__props.manageCard)), [\"stop\"])),\n                        onPointerdown: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"])),\n                        onMousedown: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"])),\n                        onTouchstart: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"]))\n                    }, _toDisplayString(__props.manageCard.origin === 'tavern' ? '' : ''), 33 /* TEXT, NEED_HYDRATION */),\n                    _createElementVNode(\"button\", {\n                        class: \"cardhub-manage__btn is-primary\",\n                        type: \"button\",\n                        onClick: _cache[15] || (_cache[15] = _withModifiers(($event) => (__props.manageDelete(__props.manageCard)), [\"stop\"])),\n                        onPointerdown: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"])),\n                        onMousedown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                        onTouchstart: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"]))\n                    }, \"  \", 32 /* NEED_HYDRATION */)\n                ])\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageContent.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageContent.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = { class: \"cardhub-manage__top\" };\nconst _hoisted_2 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_3 = { class: \"cardhub-preview__name\" };\nconst _hoisted_4 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_5 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_6 = { class: \"cardhub-manage__overview\" };\nconst _hoisted_7 = { class: \"cardhub-manage__overview-label\" };\nconst _hoisted_8 = { class: \"cardhub-manage__overview-value\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"cardhub-manage__overview-hint\"\n};\nconst _hoisted_10 = { class: \"cardhub-manage__media\" };\nconst _hoisted_11 = [\"src\"];\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageOverview',\n    props: {\n        manageCard: {},\n        manageAvatarUrl: {},\n        manageOverview: {},\n        displayTags: { type: Function },\n        openNoteDialog: { type: Function },\n        worldbookAvailable: { type: Boolean },\n        openWorldbookList: { type: Function }\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.manageCard.name), 1 /* TEXT */),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-note-trigger\",\n                            type: \"button\",\n                            \"aria-label\": \"\",\n                            onClick: _cache[0] || (_cache[0] =\n                                //@ts-ignore\n                                (...args) => (__props.openNoteDialog && __props.openNoteDialog(...args)))\n                        }, [...(_cache[2] || (_cache[2] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"fa-solid fa-pen\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */)\n                            ]))])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.manageCard.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.displayTags(__props.manageCard).length) + \" \", 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.displayTags(__props.manageCard), (tag) => {\n                            return (_openBlock(), _createElementBlock(\"span\", {\n                                key: tag,\n                                class: \"cardhub-preview__tag\"\n                            }, _toDisplayString(tag), 1 /* TEXT */));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_6, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.manageOverview, (item) => {\n                            return (_openBlock(), _createElementBlock(\"div\", {\n                                key: item.label,\n                                class: \"cardhub-manage__overview-card\"\n                            }, [\n                                _createElementVNode(\"div\", _hoisted_7, _toDisplayString(item.label), 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_8, _toDisplayString(item.value), 1 /* TEXT */),\n                                (item.hint)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, _toDisplayString(item.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (item.label === '' && __props.worldbookAvailable)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 1,\n                                        class: \"cardhub-manage__overview-action\",\n                                        type: \"button\",\n                                        onClick: _cache[1] || (_cache[1] =\n                                            //@ts-ignore\n                                            (...args) => (__props.openWorldbookList && __props.openWorldbookList(...args)))\n                                    }, \"  \"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_10, [\n                    (__props.manageAvatarUrl)\n                        ? (_openBlock(), _createElementBlock(\"img\", {\n                            key: 0,\n                            src: __props.manageAvatarUrl,\n                            alt: \"\"\n                        }, null, 8 /* PROPS */, _hoisted_11))\n                        : _createCommentVNode(\"v-if\", true)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageOverview.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageOverview.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, createVNode as _createVNode, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-manage__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_2 = {\n    class: \"cardhub-note__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_3 = [\"aria-label\"];\nconst _hoisted_4 = { class: \"cardhub-edit__header\" };\nconst _hoisted_5 = { class: \"cardhub-edit__title\" };\nconst _hoisted_6 = { class: \"cardhub-edit__actions\" };\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = {\n    class: \"cardhub-openings__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_9 = { class: \"cardhub-openings__meta\" };\nconst _hoisted_10 = { key: 0 };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"cardhub-openings__list\"\n};\nconst _hoisted_12 = [\"onClick\"];\nconst _hoisted_13 = { class: \"cardhub-openings__item-title\" };\nconst _hoisted_14 = { class: \"cardhub-openings__item-preview\" };\nconst _hoisted_15 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_16 = {\n    key: 2,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_17 = [\"disabled\"];\nconst _hoisted_18 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = {\n    class: \"cardhub-worldbook__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_21 = { class: \"cardhub-worldbook__header\" };\nconst _hoisted_22 = { class: \"cardhub-worldbook__title\" };\nconst _hoisted_23 = { class: \"cardhub-worldbook__meta\" };\nconst _hoisted_24 = { key: 0 };\nconst _hoisted_25 = {\n    key: 0,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_26 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_27 = {\n    key: 2,\n    class: \"cardhub-worldbook__list\"\n};\nconst _hoisted_28 = [\"onClick\"];\nconst _hoisted_29 = { class: \"cardhub-worldbook__item-title\" };\nconst _hoisted_30 = { class: \"cardhub-worldbook__item-index\" };\nconst _hoisted_31 = { class: \"cardhub-worldbook__item-name\" };\nconst _hoisted_32 = {\n    key: 1,\n    class: \"cardhub-worldbook__item-disabled\"\n};\nconst _hoisted_33 = { class: \"cardhub-worldbook__item-preview\" };\nconst _hoisted_34 = {\n    key: 3,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_35 = {\n    key: 4,\n    class: \"cardhub-manage__pager\"\n};\nconst _hoisted_36 = [\"disabled\"];\nconst _hoisted_37 = { class: \"cardhub-manage__pager-status\" };\nconst _hoisted_38 = [\"disabled\"];\nconst _hoisted_39 = [\"aria-label\"];\nconst _hoisted_40 = { class: \"cardhub-manage-viewer__header\" };\nconst _hoisted_41 = { class: \"cardhub-manage-viewer__title\" };\nconst _hoisted_42 = [\"innerHTML\"];\nimport { computed, ref, watch } from 'vue';\nimport ManageContent from './ManageContent.vue';\nimport ManageOverview from './ManageOverview.vue';\nconst worldbookPageSize = 10;\nconst chatPageSize = 6;\nconst openingPageSize = 10;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ManageModal',\n    props: {\n        card: {},\n        displayTags: { type: Function },\n        handleCardAction: { type: Function },\n        manageDelete: { type: Function },\n        closeManage: { type: Function },\n        closeRoot: { type: Function },\n        applyNoteUpdate: { type: Function },\n        parseLibraryCardData: { type: Function },\n        updateLastChatCacheForCard: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const manageCard = computed(() => props.card);\n        const manageOpenings = ref([]);\n        const manageWorldbookEntries = ref([]);\n        const manageProfile = ref(null);\n        const manageOpeningSummary = ref(null);\n        const manageChats = ref([]);\n        const manageChatSummary = ref(null);\n        const manageAvatarUrl = computed(() => (manageCard.value ? avatarUrl(manageCard.value, true) : null));\n        const manageDetailsHint = computed(() => {\n            if (!manageCard.value || manageDetails.value.length) {\n                return '';\n            }\n            if (manageCard.value.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageChatHint = computed(() => {\n            if (manageCard.value?.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageOverview = computed(() => {\n            const items = [];\n            const profile = manageProfile.value;\n            const worldName = profile?.worldBookName?.trim() || '';\n            const worldCount = profile?.worldBookCount;\n            let worldValue = '';\n            let worldHint = '';\n            if (worldName || typeof worldCount === 'number') {\n                worldValue = worldName || '';\n                worldHint = typeof worldCount === 'number' ? `${worldCount} ` : '';\n            }\n            items.push({ label: '', value: worldValue, hint: worldHint });\n            const chat = manageChatSummary.value;\n            let chatValue = '';\n            let chatHint = '';\n            if (chat && chat.total > 0) {\n                chatValue = `${chat.total} `;\n                if (chat.latest) {\n                    chatHint = `${chat.latest}`;\n                }\n            }\n            items.push({ label: '', value: chatValue, hint: chatHint });\n            return items;\n        });\n        const manageDetails = computed(() => {\n            const details = [];\n            const profile = manageProfile.value;\n            const pushDetail = (label, value, maxChars = 240, editable = false, field = '') => {\n                const preview = previewDetailText(value, 3, maxChars);\n                const trimmed = value.trim();\n                if (!preview && !editable) {\n                    return;\n                }\n                const displayPreview = preview || (editable ? '' : '');\n                const hasMore = Boolean(displayPreview) && trimmed.length > displayPreview.replace(/$/, '').length;\n                details.push({\n                    label,\n                    preview: displayPreview,\n                    full: trimmed,\n                    hasMore,\n                    editable,\n                    field,\n                });\n            };\n            if (manageCard.value?.origin === 'library' && manageCard.value.importFileName) {\n                pushDetail('', manageCard.value.importFileName, 120);\n            }\n            if (manageCard.value?.note?.trim()) {\n                pushDetail('', manageCard.value.note.trim(), 200);\n            }\n            const canEdit = manageCard.value?.origin === 'tavern';\n            if (profile) {\n                pushDetail('', profile.description ?? '', 240, Boolean(canEdit && profile.descriptionField), profile.descriptionField ?? '');\n                pushDetail('', profile.personality ?? '');\n                pushDetail('', profile.scenario ?? '');\n                pushDetail('', profile.creatorNotes ?? '', 240, Boolean(canEdit && profile.creatorNotesField), profile.creatorNotesField ?? '');\n                pushDetail('', profile.systemPrompt ?? '', 200);\n                pushDetail('', profile.postHistory ?? '', 200);\n                pushDetail('', profile.creator ?? '', 80);\n            }\n            return details;\n        });\n        const openingItems = computed(() => manageOpenings.value.map((opening, index) => ({\n            id: index,\n            preview: previewOpeningLines(opening, 2).join('\\n'),\n            html: renderOpeningHtml(opening),\n        })));\n        const openingSummary = computed(() => {\n            const opening = manageOpeningSummary.value;\n            const total = opening?.total ?? openingItems.value.length;\n            const alternate = opening?.alternate ?? 0;\n            if (!total) {\n                return { value: '', hint: '', hasData: false };\n            }\n            return {\n                value: ` ${total} `,\n                hint: alternate > 0 ? ` ${alternate} ` : '',\n                hasData: true,\n            };\n        });\n        const worldbookName = computed(() => manageProfile.value?.worldBookName?.trim() || '');\n        const worldbookAvailable = computed(() => Boolean(worldbookName.value || manageWorldbookEntries.value.length));\n        const worldbookEntries = ref([]);\n        const worldbookLoadedName = ref('');\n        const worldbookLoading = ref(false);\n        const worldbookError = ref('');\n        const worldbookOpen = ref(false);\n        const worldbookPage = ref(1);\n        function resolveWorldbookTitle(entry) {\n            const name = pickString(entry?.name, entry?.title, entry?.comment, entry?.annotation, entry?.label);\n            if (name) {\n                return name;\n            }\n            const primary = pickWorldbookKey(entry?.strategy?.keys ??\n                entry?.keys ??\n                entry?.keywords ??\n                entry?.key ??\n                entry?.search?.keys);\n            if (primary) {\n                return primary;\n            }\n            const secondary = pickWorldbookKey(entry?.strategy?.keys_secondary?.keys ??\n                entry?.keys_secondary ??\n                entry?.secondary_keys);\n            if (secondary) {\n                return secondary;\n            }\n            const content = typeof entry?.content === 'string' ? entry.content : '';\n            return pickWorldbookContentTitle(content);\n        }\n        function pickWorldbookKey(keys) {\n            const normalized = normalizeWorldbookKeys(keys);\n            if (!normalized.length) {\n                return '';\n            }\n            for (const key of normalized) {\n                if (typeof key === 'string') {\n                    const trimmed = key.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n                else if (key instanceof RegExp) {\n                    return String(key);\n                }\n            }\n            return '';\n        }\n        function normalizeWorldbookKeys(keys) {\n            if (!keys) {\n                return [];\n            }\n            if (Array.isArray(keys)) {\n                return keys;\n            }\n            if (typeof keys === 'string' || keys instanceof RegExp) {\n                return [keys];\n            }\n            if (typeof keys === 'object') {\n                const inner = keys.keys;\n                if (Array.isArray(inner)) {\n                    return inner;\n                }\n            }\n            return [];\n        }\n        function pickWorldbookContentTitle(content) {\n            if (!content) {\n                return '';\n            }\n            const lines = content.split(/\\r?\\n/);\n            for (const line of lines) {\n                const trimmed = line.trim();\n                if (!trimmed) {\n                    continue;\n                }\n                const cleaned = trimmed.replace(/^<[^>]+>/g, '').trim();\n                if (cleaned) {\n                    return cleaned.length > 32 ? `${cleaned.slice(0, 32)}...` : cleaned;\n                }\n            }\n            return '';\n        }\n        function resolveWorldbookStrategyType(entry) {\n            const raw = entry?.strategy?.type ??\n                entry?.strategy_type ??\n                entry?.strategyType ??\n                entry?.type ??\n                '';\n            if (raw === 'constant' || raw === 'selective' || raw === 'vectorized') {\n                return raw;\n            }\n            if (entry?.vectorized === true ||\n                entry?.use_vectorized === true ||\n                entry?.strategy?.vectorized === true) {\n                return 'vectorized';\n            }\n            const primaryKeys = normalizeWorldbookKeys(entry?.strategy?.keys ?? entry?.keys ?? entry?.key ?? entry?.keywords);\n            const secondaryKeys = normalizeWorldbookKeys(entry?.strategy?.keys_secondary?.keys ?? entry?.keys_secondary ?? entry?.secondary_keys);\n            if (primaryKeys.length || secondaryKeys.length) {\n                return 'selective';\n            }\n            return 'constant';\n        }\n        function formatWorldbookStrategyLabel(type) {\n            if (type === 'constant') {\n                return '';\n            }\n            if (type === 'selective') {\n                return '';\n            }\n            if (type === 'vectorized') {\n                return '';\n            }\n            return '';\n        }\n        const worldbookItems = computed(() => worldbookEntries.value.map((entry, index) => {\n            const title = resolveWorldbookTitle(entry);\n            const strategyType = resolveWorldbookStrategyType(entry);\n            return {\n                uid: entry.uid ?? index,\n                name: entry.name || '',\n                title,\n                indexLabel: ` ${index + 1}`,\n                strategyLabel: formatWorldbookStrategyLabel(strategyType),\n                strategyType,\n                enabled: entry.enabled !== false,\n                preview: previewDetailText(String(entry.content ?? ''), 2, 200) || '',\n                content: String(entry.content ?? ''),\n            };\n        }));\n        const worldbookTotalPages = computed(() => Math.max(1, Math.ceil(worldbookItems.value.length / worldbookPageSize)));\n        const pagedWorldbookItems = computed(() => {\n            const start = (worldbookPage.value - 1) * worldbookPageSize;\n            return worldbookItems.value.slice(start, start + worldbookPageSize);\n        });\n        const worldbookSummary = computed(() => {\n            if (!worldbookAvailable.value) {\n                return '';\n            }\n            if (worldbookLoading.value) {\n                return '';\n            }\n            return ` ${worldbookItems.value.length} `;\n        });\n        const worldbookSummaryHint = computed(() => (worldbookItems.value.length ? worldbookName.value : ''));\n        const chatPage = ref(1);\n        const chatTotalPages = computed(() => Math.max(1, Math.ceil(manageChats.value.length / chatPageSize)));\n        const pagedChats = computed(() => {\n            const start = (chatPage.value - 1) * chatPageSize;\n            return manageChats.value.slice(start, start + chatPageSize);\n        });\n        const openingPage = ref(1);\n        const openingTotalPages = computed(() => Math.max(1, Math.ceil(openingItems.value.length / openingPageSize)));\n        const pagedOpenings = computed(() => {\n            const start = (openingPage.value - 1) * openingPageSize;\n            return openingItems.value.slice(start, start + openingPageSize);\n        });\n        const noteDialogOpen = ref(false);\n        const noteDraft = ref('');\n        const editDialogOpen = ref(false);\n        const editDialogTitle = ref('');\n        const editDraft = ref('');\n        const editField = ref('');\n        const editSaving = ref(false);\n        const openingListOpen = ref(false);\n        const viewerOpen = ref(false);\n        const viewerTitle = ref('');\n        const viewerHtml = ref('');\n        let manageRequestId = 0;\n        watch(manageCard, card => {\n            if (!card) {\n                manageOpenings.value = [];\n                manageWorldbookEntries.value = [];\n                manageProfile.value = null;\n                manageOpeningSummary.value = null;\n                manageChats.value = [];\n                manageChatSummary.value = null;\n                chatPage.value = 1;\n                openingPage.value = 1;\n                noteDialogOpen.value = false;\n                noteDraft.value = '';\n                editDialogOpen.value = false;\n                editDialogTitle.value = '';\n                editDraft.value = '';\n                editField.value = '';\n                editSaving.value = false;\n                openingListOpen.value = false;\n                worldbookOpen.value = false;\n                worldbookEntries.value = [];\n                worldbookLoadedName.value = '';\n                worldbookLoading.value = false;\n                worldbookError.value = '';\n                worldbookPage.value = 1;\n                viewerOpen.value = false;\n                viewerTitle.value = '';\n                viewerHtml.value = '';\n                return;\n            }\n            void openManage(card);\n        }, { immediate: true });\n        function prevChatPage() {\n            if (chatPage.value > 1) {\n                chatPage.value -= 1;\n            }\n        }\n        function nextChatPage() {\n            if (chatPage.value < chatTotalPages.value) {\n                chatPage.value += 1;\n            }\n        }\n        async function openWorldbookList() {\n            const name = worldbookName.value;\n            if (!name && !manageWorldbookEntries.value.length) {\n                return;\n            }\n            worldbookOpen.value = true;\n            worldbookError.value = '';\n            worldbookPage.value = 1;\n            if (manageWorldbookEntries.value.length) {\n                worldbookEntries.value = manageWorldbookEntries.value;\n                worldbookLoadedName.value = name || 'embedded';\n                return;\n            }\n            if (worldbookLoadedName.value === name && worldbookEntries.value.length) {\n                return;\n            }\n            if (typeof getWorldbook !== 'function') {\n                worldbookError.value = '';\n                return;\n            }\n            worldbookLoading.value = true;\n            try {\n                const entries = await getWorldbook(name);\n                worldbookEntries.value = Array.isArray(entries) ? entries : [];\n                worldbookLoadedName.value = name;\n            }\n            catch (error) {\n                worldbookError.value = '';\n                worldbookEntries.value = [];\n                console.warn('[CardHub] ', error);\n            }\n            finally {\n                worldbookLoading.value = false;\n            }\n        }\n        function closeWorldbookList() {\n            worldbookOpen.value = false;\n        }\n        function prevWorldbookPage() {\n            if (worldbookPage.value > 1) {\n                worldbookPage.value -= 1;\n            }\n        }\n        function nextWorldbookPage() {\n            if (worldbookPage.value < worldbookTotalPages.value) {\n                worldbookPage.value += 1;\n            }\n        }\n        function openOpeningList() {\n            if (!openingItems.value.length) {\n                return;\n            }\n            openingPage.value = 1;\n            openingListOpen.value = true;\n        }\n        function closeOpeningList() {\n            openingListOpen.value = false;\n        }\n        function prevOpeningPage() {\n            if (openingPage.value > 1) {\n                openingPage.value -= 1;\n            }\n        }\n        function nextOpeningPage() {\n            if (openingPage.value < openingTotalPages.value) {\n                openingPage.value += 1;\n            }\n        }\n        function openNoteDialog() {\n            if (!manageCard.value) {\n                return;\n            }\n            noteDraft.value = manageCard.value.note ?? '';\n            noteDialogOpen.value = true;\n        }\n        function closeNoteDialog() {\n            noteDialogOpen.value = false;\n        }\n        function saveNoteDialog() {\n            if (!manageCard.value) {\n                return;\n            }\n            props.applyNoteUpdate(manageCard.value, noteDraft.value);\n            noteDialogOpen.value = false;\n        }\n        function openDetailViewer(detail) {\n            viewerTitle.value = detail.label;\n            viewerHtml.value = textToHtml(detail.full || detail.preview);\n            viewerOpen.value = true;\n        }\n        function openOpeningViewer(item) {\n            openingListOpen.value = false;\n            viewerTitle.value = ` ${item.id + 1}`;\n            viewerHtml.value = item.html || textToHtml(item.preview);\n            viewerOpen.value = true;\n        }\n        function openWorldbookEntry(item) {\n            worldbookOpen.value = false;\n            viewerTitle.value = item.title || item.indexLabel || '';\n            viewerHtml.value = textToHtml(item.content);\n            viewerOpen.value = true;\n        }\n        function closeViewer() {\n            viewerOpen.value = false;\n        }\n        async function openManage(card) {\n            const requestId = ++manageRequestId;\n            manageOpenings.value = [];\n            manageWorldbookEntries.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n            chatPage.value = 1;\n            openingPage.value = 1;\n            openingListOpen.value = false;\n            worldbookOpen.value = false;\n            worldbookEntries.value = [];\n            worldbookLoadedName.value = '';\n            worldbookLoading.value = false;\n            worldbookError.value = '';\n            worldbookPage.value = 1;\n            const [manageResult, chatsResult] = await Promise.allSettled([resolveManageData(card), resolveRecentChats(card)]);\n            if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n                return;\n            }\n            const manageData = manageResult.status === 'fulfilled'\n                ? manageResult.value\n                : { openings: [], profile: null, openingSummary: null, worldbookEntries: [] };\n            manageOpenings.value = manageData.openings;\n            manageProfile.value = manageData.profile;\n            manageOpeningSummary.value = manageData.openingSummary;\n            manageWorldbookEntries.value = manageData.worldbookEntries;\n            const chatData = chatsResult.status === 'fulfilled' ? chatsResult.value : { list: [], summary: null };\n            manageChats.value = chatData.list;\n            manageChatSummary.value = chatData.summary;\n        }\n        async function resolveManageData(card) {\n            if (card.origin !== 'tavern') {\n                const data = props.parseLibraryCardData(card);\n                return {\n                    openings: extractOpeningMessages(data),\n                    profile: extractCardProfile(data),\n                    openingSummary: extractOpeningSummary(data),\n                    worldbookEntries: extractWorldbookEntries(data),\n                };\n            }\n            const raw = await getFullCharacterData(card);\n            const fallback = raw ??\n                TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            const primary = raw ?? fallback;\n            let openings = extractOpeningMessages(primary);\n            if (!openings.length && fallback && fallback !== primary) {\n                openings = extractOpeningMessages(fallback);\n            }\n            const openingSummary = extractOpeningSummary(primary ?? fallback);\n            return {\n                openings,\n                profile: extractCardProfile(primary ?? fallback),\n                openingSummary,\n                worldbookEntries: extractWorldbookEntries(primary ?? fallback),\n            };\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return { list: [], summary: null };\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return { list: [], summary: { total: 0, latest: '' } };\n            }\n            const sorted = sortChatBrief(brief);\n            const latestTimestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n            props.updateLastChatCacheForCard(card, latestTimestamp);\n            const list = sorted.map((entry) => ({\n                name: formatChatTitle(entry),\n                label: formatChatFileLabel(entry),\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n            }));\n            const latest = extractChatLatestLabel(sorted[0]);\n            return {\n                list,\n                summary: {\n                    total: brief.length,\n                    latest,\n                },\n            };\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openNewChat() {\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            try {\n                await triggerSlash('/newchat');\n                props.closeManage();\n                props.closeRoot();\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n                toastr.error('');\n            }\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('');\n                return;\n            }\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            const { ctx, st } = selection;\n            const target = normalizeChatId(file);\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] ', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                props.closeManage();\n                props.closeRoot();\n                return;\n            }\n            toastr.warning('');\n        }\n        async function selectManageCharacter(options = {}) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            if (idx < 0) {\n                toastr.warning('');\n                return null;\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (!selector) {\n                toastr.warning('');\n                return null;\n            }\n            try {\n                await selector(idx, { switchMenu: false });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n            if (options.ensureSelected && !selected) {\n                toastr.warning('');\n                return null;\n            }\n            return { ctx, st, idx };\n        }\n        function getCurrentCharacterId(ctx, st) {\n            const value = ctx?.characterId ?? st?.characterId ?? '';\n            return value === undefined || value === null ? '' : String(value);\n        }\n        async function waitForCharacterSelection(idx, ctx, st, timeoutMs) {\n            const target = String(idx);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = getCurrentCharacterId(ctx, st);\n                if (current === target) {\n                    return true;\n                }\n                await sleep(80);\n            }\n            return false;\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await sleep(200);\n            }\n            return false;\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function findCharacterIndex(list, card) {\n            const targetName = normalizeNameKey(card.name);\n            const targetAvatar = card.avatar ? normalizeAvatarKey(card.avatar) : '';\n            const byAvatar = targetAvatar\n                ? list.findIndex(item => normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\n                : -1;\n            if (byAvatar >= 0) {\n                return byAvatar;\n            }\n            const byName = list.findIndex(item => normalizeNameKey(String(item.name ?? '')) === targetName);\n            if (byName >= 0) {\n                return byName;\n            }\n            return list.findIndex(item => normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function normalizeAvatarKey(value) {\n            let raw = value.trim();\n            if (!raw) {\n                return '';\n            }\n            try {\n                raw = decodeURIComponent(raw);\n            }\n            catch {\n                // ignore\n            }\n            raw = raw.split('?')[0];\n            if (raw.includes('/')) {\n                raw = raw.split('/').pop() ?? raw;\n            }\n            return raw.trim().toLowerCase();\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar) : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractCardProfile(data) {\n            if (!data) {\n                return null;\n            }\n            const descriptionField = hasField(data, 'description') ? 'description' : '';\n            const creatorNotesField = resolveCreatorNotesField(data);\n            const profile = {\n                description: pickString(data?.description, data?.data?.description),\n                descriptionField,\n                personality: pickString(data?.personality, data?.data?.personality),\n                scenario: pickString(data?.scenario, data?.data?.scenario),\n                creatorNotes: pickString(data?.creatorcomment, data?.data?.creatorcomment, data?.creator_notes, data?.data?.creator_notes),\n                creatorNotesField,\n                systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n                postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n                creator: pickString(data?.creator, data?.data?.creator),\n            };\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (book) {\n                profile.worldBookName = pickString(book?.name);\n                profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n            }\n            const hasValue = Boolean(profile.description) ||\n                Boolean(profile.personality) ||\n                Boolean(profile.scenario) ||\n                Boolean(profile.creatorNotes) ||\n                Boolean(profile.systemPrompt) ||\n                Boolean(profile.postHistory) ||\n                Boolean(profile.creator) ||\n                Boolean(profile.worldBookName) ||\n                typeof profile.worldBookCount === 'number';\n            return hasValue ? profile : null;\n        }\n        function hasField(data, field) {\n            return data?.[field] !== undefined || data?.data?.[field] !== undefined;\n        }\n        function resolveCreatorNotesField(data) {\n            if (hasField(data, 'creatorcomment')) {\n                return 'creatorcomment';\n            }\n            if (hasField(data, 'creator_notes')) {\n                return 'creator_notes';\n            }\n            return '';\n        }\n        function extractWorldbookEntries(data) {\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (!book || !Array.isArray(book?.entries)) {\n                return [];\n            }\n            return book.entries;\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function isEditableDetail(detail) {\n            return Boolean(detail.editable && detail.field);\n        }\n        function resolveEditFields(field) {\n            if (field === 'creatorcomment' || field === 'creator_notes') {\n                return ['creatorcomment', 'creator_notes'];\n            }\n            return [field];\n        }\n        function extractOpeningSummary(data) {\n            if (!data) {\n                return null;\n            }\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            let alternate = 0;\n            if (Array.isArray(alt)) {\n                alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                alternate = 1;\n            }\n            return {\n                total: firstCount + alternate,\n                alternate,\n            };\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function formatChatTitle(entry) {\n            const label = extractChatLatestLabel(entry);\n            return label || '';\n        }\n        function formatChatFileLabel(entry) {\n            const raw = pickString(entry?.file_name, entry?.file_id);\n            if (!raw) {\n                return '';\n            }\n            return raw.replace(/\\.jsonl$/i, '');\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function previewDetailText(text, maxLines, maxChars) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return '';\n            }\n            const lines = extractContentLines(trimmed);\n            const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n            let preview = source.slice(0, maxLines).join('\\n').trim();\n            if (!preview) {\n                return '';\n            }\n            const truncated = preview.length > maxChars;\n            if (truncated) {\n                preview = preview.slice(0, maxChars).trim();\n            }\n            const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n            if (hasMore && !preview.endsWith('')) {\n                preview = `${preview}`;\n            }\n            return preview;\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function renderOpeningHtml(text) {\n            const trimmed = stripCodeFences(text).trim();\n            if (!trimmed) {\n                return '';\n            }\n            if (/<\\/?[a-z][\\s\\S]*>/i.test(trimmed)) {\n                return trimmed;\n            }\n            return escapeHtml(trimmed).replace(/\\n/g, '<br>');\n        }\n        function escapeHtml(text) {\n            return text\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#39;');\n        }\n        function textToHtml(text) {\n            const trimmed = stripCodeFences(text).trim();\n            if (!trimmed) {\n                return '';\n            }\n            return escapeHtml(trimmed).replace(/\\n/g, '<br>');\n        }\n        function stripCodeFences(text) {\n            return text.replace(/^\\s*```[a-zA-Z0-9_-]*\\s*$/gm, '').replace(/^\\s*```\\s*$/gm, '');\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        function sortChatBrief(list) {\n            return [...list].sort((a, b) => (extractChatLatestTimestamp(b) ?? 0) - (extractChatLatestTimestamp(a) ?? 0));\n        }\n        function extractChatLatestLabel(entry) {\n            return pickString(entry?.chat_name, entry?.chat_title, entry?.name, entry?.file_name, entry?.file_id);\n        }\n        function extractChatLatestTimestamp(entry) {\n            const raw = entry?.last_message_time ??\n                entry?.last_message_date ??\n                entry?.last_message_timestamp ??\n                entry?.last_chat_time ??\n                entry?.last_chat_date ??\n                entry?.last_interaction ??\n                entry?.update_time ??\n                entry?.timestamp ??\n                entry?.time ??\n                null;\n            return coerceToTimestamp(raw) ?? parseTimestampFromText(String(entry?.file_name ?? entry?.file_id ?? ''));\n        }\n        function coerceToTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                return value < 1e12 ? value * 1000 : value;\n            }\n            if (typeof value === 'string') {\n                const parsed = Date.parse(value);\n                if (!Number.isNaN(parsed)) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function parseTimestampFromText(raw) {\n            const text = raw.replace(/\\.jsonl$/i, '').trim();\n            const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:](\\d{1,2})(?:[:](\\d{1,2}))?)?/;\n            const match = text.match(pattern);\n            if (!match) {\n                return null;\n            }\n            const year = Number(match[1]);\n            const month = Number(match[2]);\n            const day = Number(match[3]);\n            const hour = match[4] ? Number(match[4]) : 0;\n            const minute = match[5] ? Number(match[5]) : 0;\n            const second = match[6] ? Number(match[6]) : 0;\n            if (!year || !month || !day) {\n                return null;\n            }\n            const value = new Date(year, month - 1, day, hour, minute, second).getTime();\n            return Number.isNaN(value) ? null : value;\n        }\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function openEditDialog(detail) {\n            if (!manageCard.value || manageCard.value.origin !== 'tavern' || !isEditableDetail(detail)) {\n                return;\n            }\n            editDialogOpen.value = true;\n            editDialogTitle.value = `${detail.label}`;\n            editDraft.value = detail.full ?? '';\n            editField.value = detail.field ?? '';\n        }\n        function closeEditDialog() {\n            editDialogOpen.value = false;\n            editDialogTitle.value = '';\n            editDraft.value = '';\n            editField.value = '';\n            editSaving.value = false;\n        }\n        async function saveEditDialog() {\n            if (!manageCard.value || manageCard.value.origin !== 'tavern' || !editField.value) {\n                return;\n            }\n            if (editSaving.value) {\n                return;\n            }\n            editSaving.value = true;\n            try {\n                const token = await fetchCsrfToken();\n                if (!token) {\n                    toastr.error(' CSRF Token');\n                    return;\n                }\n                const basePayload = {\n                    avatar_url: manageCard.value.avatar ?? '',\n                    ch_name: manageCard.value.name ?? manageCard.value.avatar ?? '',\n                    value: editDraft.value ?? '',\n                };\n                const fields = resolveEditFields(editField.value);\n                for (const field of fields) {\n                    const response = await fetch('/api/characters/edit-attribute', {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            'X-CSRF-Token': token,\n                        },\n                        credentials: 'same-origin',\n                        body: JSON.stringify({ ...basePayload, field }),\n                    });\n                    if (!response.ok) {\n                        const message = await response.text();\n                        throw new Error(message || '');\n                    }\n                }\n                toastr.success('');\n                closeEditDialog();\n                if (manageCard.value) {\n                    void openManage(manageCard.value);\n                }\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n                toastr.error('');\n            }\n            finally {\n                editSaving.value = false;\n            }\n        }\n        async function fetchCsrfToken() {\n            try {\n                const response = await fetch('/csrf-token', { credentials: 'same-origin' });\n                if (!response.ok) {\n                    return '';\n                }\n                const data = await response.json();\n                return typeof data?.token === 'string' ? data.token : '';\n            }\n            catch (error) {\n                console.warn('[CardHub]  CSRF Token ', error);\n                return '';\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-manage cardhub-modal\",\n                        onClick: _cache[1] || (_cache[1] = _withModifiers(\n                        //@ts-ignore\n                        (...args) => (__props.closeManage && __props.closeManage(...args)), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_1, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: _cache[0] || (_cache[0] =\n                                    //@ts-ignore\n                                    (...args) => (__props.closeManage && __props.closeManage(...args)))\n                            }, \"\"),\n                            _createVNode(ManageOverview, {\n                                \"manage-card\": manageCard.value,\n                                \"manage-avatar-url\": manageAvatarUrl.value,\n                                \"manage-overview\": manageOverview.value,\n                                \"display-tags\": __props.displayTags,\n                                \"open-note-dialog\": openNoteDialog,\n                                \"worldbook-available\": worldbookAvailable.value,\n                                \"open-worldbook-list\": openWorldbookList\n                            }, null, 8 /* PROPS */, [\"manage-card\", \"manage-avatar-url\", \"manage-overview\", \"display-tags\", \"worldbook-available\"]),\n                            _createVNode(ManageContent, {\n                                \"manage-card\": manageCard.value,\n                                \"manage-details\": manageDetails.value,\n                                \"manage-details-hint\": manageDetailsHint.value,\n                                \"opening-items\": openingItems.value,\n                                \"opening-summary\": openingSummary.value,\n                                \"manage-chats\": manageChats.value,\n                                \"paged-chats\": pagedChats.value,\n                                \"chat-page\": chatPage.value,\n                                \"chat-total-pages\": chatTotalPages.value,\n                                \"manage-chat-hint\": manageChatHint.value,\n                                \"open-detail\": openDetailViewer,\n                                \"open-edit\": openEditDialog,\n                                \"open-opening-list\": openOpeningList,\n                                \"open-latest-chat\": openLatestChat,\n                                \"open-new-chat\": openNewChat,\n                                \"open-chat\": openChat,\n                                \"prev-chat-page\": prevChatPage,\n                                \"next-chat-page\": nextChatPage,\n                                \"handle-card-action\": __props.handleCardAction,\n                                \"manage-delete\": __props.manageDelete\n                            }, null, 8 /* PROPS */, [\"manage-card\", \"manage-details\", \"manage-details-hint\", \"opening-items\", \"opening-summary\", \"manage-chats\", \"paged-chats\", \"chat-page\", \"chat-total-pages\", \"manage-chat-hint\", \"handle-card-action\", \"manage-delete\"])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (noteDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-note cardhub-modal\",\n                        onClick: _withModifiers(closeNoteDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_2, [\n                            _createElementVNode(\"div\", { class: \"cardhub-note__header\" }, [\n                                _cache[4] || (_cache[4] = _createElementVNode(\"div\", { class: \"cardhub-note__title\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeNoteDialog\n                                }, \"\")\n                            ]),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((noteDraft).value = $event)),\n                                class: \"cardhub-note__input\",\n                                placeholder: \"\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, noteDraft.value]\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-note__actions\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-note__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeNoteDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-note__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveNoteDialog\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (editDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"cardhub-edit cardhub-modal\",\n                        onClick: _withModifiers(closeEditDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"cardhub-edit__panel cardhub-modal__panel\",\n                            role: \"dialog\",\n                            \"aria-label\": editDialogTitle.value\n                        }, [\n                            _createElementVNode(\"div\", _hoisted_4, [\n                                _createElementVNode(\"div\", _hoisted_5, _toDisplayString(editDialogTitle.value), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeEditDialog\n                                }, \"\")\n                            ]),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((editDraft).value = $event)),\n                                class: \"cardhub-edit__input\",\n                                placeholder: \"\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, editDraft.value]\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-edit__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeEditDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-edit__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveEditDialog,\n                                    disabled: editSaving.value\n                                }, _toDisplayString(editSaving.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_7)\n                            ])\n                        ], 8 /* PROPS */, _hoisted_3)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (openingListOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"cardhub-openings cardhub-modal\",\n                        onClick: _withModifiers(closeOpeningList, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            _createElementVNode(\"div\", { class: \"cardhub-openings__header\" }, [\n                                _cache[5] || (_cache[5] = _createElementVNode(\"div\", { class: \"cardhub-openings__title\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeOpeningList\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_9, [\n                                _createElementVNode(\"span\", null, _toDisplayString(openingSummary.value.value), 1 /* TEXT */),\n                                (openingSummary.value.hint)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, _toDisplayString(openingSummary.value.hint), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            (pagedOpenings.value.length)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedOpenings.value, (item) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: item.id,\n                                            class: \"cardhub-openings__item\",\n                                            type: \"button\",\n                                            onClick: ($event) => (openOpeningViewer(item))\n                                        }, [\n                                            _createElementVNode(\"div\", _hoisted_13, \" \" + _toDisplayString(item.id + 1), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_14, _toDisplayString(item.preview), 1 /* TEXT */)\n                                        ], 8 /* PROPS */, _hoisted_12));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, \"\")),\n                            (openingTotalPages.value > 1)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_16, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: openingPage.value <= 1,\n                                        onClick: prevOpeningPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_17),\n                                    _createElementVNode(\"span\", _hoisted_18, _toDisplayString(openingPage.value) + \" / \" + _toDisplayString(openingTotalPages.value), 1 /* TEXT */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: openingPage.value >= openingTotalPages.value,\n                                        onClick: nextOpeningPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_19)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (worldbookOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"cardhub-worldbook cardhub-modal\",\n                        onClick: _withModifiers(closeWorldbookList, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_20, [\n                            _createElementVNode(\"div\", _hoisted_21, [\n                                _createElementVNode(\"div\", _hoisted_22, _toDisplayString(worldbookName.value || ''), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeWorldbookList\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_23, [\n                                _createElementVNode(\"span\", null, _toDisplayString(worldbookSummary.value), 1 /* TEXT */),\n                                (worldbookSummaryHint.value)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_24, _toDisplayString(worldbookSummaryHint.value), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            (worldbookLoading.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, \"...\"))\n                                : (worldbookError.value)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_26, _toDisplayString(worldbookError.value), 1 /* TEXT */))\n                                    : (pagedWorldbookItems.value.length)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_27, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedWorldbookItems.value, (item) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: item.uid,\n                                                    class: \"cardhub-worldbook__item\",\n                                                    type: \"button\",\n                                                    onClick: ($event) => (openWorldbookEntry(item))\n                                                }, [\n                                                    _createElementVNode(\"div\", _hoisted_29, [\n                                                        _createElementVNode(\"span\", _hoisted_30, _toDisplayString(item.indexLabel), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_31, _toDisplayString(item.title || ''), 1 /* TEXT */),\n                                                        (item.strategyLabel)\n                                                            ? (_openBlock(), _createElementBlock(\"span\", {\n                                                                key: 0,\n                                                                class: _normalizeClass([\"cardhub-worldbook__item-strategy\", `is-${item.strategyType}`])\n                                                            }, _toDisplayString(item.strategyLabel), 3 /* TEXT, CLASS */))\n                                                            : _createCommentVNode(\"v-if\", true),\n                                                        (!item.enabled)\n                                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_32, \"\"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_33, _toDisplayString(item.preview), 1 /* TEXT */)\n                                                ], 8 /* PROPS */, _hoisted_28));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_34, \"\")),\n                            (worldbookTotalPages.value > 1)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_35, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: worldbookPage.value <= 1,\n                                        onClick: prevWorldbookPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_36),\n                                    _createElementVNode(\"span\", _hoisted_37, _toDisplayString(worldbookPage.value) + \" / \" + _toDisplayString(worldbookTotalPages.value), 1 /* TEXT */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-manage__pager-btn\",\n                                        type: \"button\",\n                                        disabled: worldbookPage.value >= worldbookTotalPages.value,\n                                        onClick: nextWorldbookPage\n                                    }, \"  \", 8 /* PROPS */, _hoisted_38)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (viewerOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 5,\n                        class: \"cardhub-manage-viewer cardhub-modal\",\n                        onClick: _withModifiers(closeViewer, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"cardhub-manage-viewer__panel cardhub-modal__panel\",\n                            role: \"dialog\",\n                            \"aria-label\": viewerTitle.value\n                        }, [\n                            _createElementVNode(\"div\", _hoisted_40, [\n                                _createElementVNode(\"div\", _hoisted_41, _toDisplayString(viewerTitle.value), 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeViewer\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", {\n                                class: \"cardhub-manage-viewer__content\",\n                                innerHTML: viewerHtml.value\n                            }, null, 8 /* PROPS */, _hoisted_42)\n                        ], 8 /* PROPS */, _hoisted_39)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ManageModal.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ManageModal.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { computed, ref, type ComputedRef } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype ConfirmResult = 'confirm' | 'cancel' | 'alt';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\ntype BatchTagOptions = {\n  allCards: ComputedRef<CardHubItem[]>;\n  filteredCharacters: ComputedRef<CardHubItem[]>;\n  allTags: ComputedRef<string[]>;\n  displayTags: (card: CardHubItem) => string[];\n  applyTagUpdate: (card: CardHubItem, tags: string[]) => void;\n  openConfirm: (options: ConfirmOptions) => Promise<ConfirmResult>;\n};\n\nexport function useBatchTags(options: BatchTagOptions) {\n  const tagManagerOpen = ref(false);\n  const tagManagerTab = ref<'filter' | 'batch'>('filter');\n  const batchTagSelectedIds = ref<string[]>([]);\n  const batchTagSearch = ref('');\n  const batchTagInput = ref('');\n  const batchTagSelectedTags = ref<string[]>([]);\n\n  const batchTagCandidates = computed(() => options.filteredCharacters.value);\n  const batchTagVisibleCandidates = computed(() => {\n    const keyword = batchTagSearch.value.trim().toLowerCase();\n    if (!keyword) {\n      return batchTagCandidates.value;\n    }\n    return batchTagCandidates.value.filter(card => {\n      if (card.name.toLowerCase().includes(keyword)) {\n        return true;\n      }\n      const tags = options.displayTags(card);\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\n    });\n  });\n\n  const batchTagSelectedSet = computed(() => new Set(batchTagSelectedIds.value));\n  const batchTagSuggestions = computed(() => options.allTags.value);\n\n  function openTagManager(tab: 'filter' | 'batch' = 'filter') {\n    if (tab === 'batch') {\n      if (!batchTagVisibleCandidates.value.length) {\n        toastr.warning('');\n        return;\n      }\n      batchTagInput.value = '';\n      batchTagSearch.value = '';\n      batchTagSelectedTags.value = [];\n      batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n    }\n    tagManagerTab.value = tab;\n    tagManagerOpen.value = true;\n  }\n\n  function closeTagManager() {\n    tagManagerOpen.value = false;\n  }\n\n  function toggleBatchTagSelection(id: string) {\n    if (batchTagSelectedSet.value.has(id)) {\n      batchTagSelectedIds.value = batchTagSelectedIds.value.filter(item => item !== id);\n    } else {\n      batchTagSelectedIds.value = [...batchTagSelectedIds.value, id];\n    }\n  }\n\n  function selectAllBatchTags() {\n    batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n  }\n\n  function clearBatchTagSelection() {\n    batchTagSelectedIds.value = [];\n  }\n\n  function parseBatchTags(input: string, selected: string[]): string[] {\n    const items = input\n      .split(/[,\\n;]/)\n      .map(part => part.trim())\n      .filter(Boolean);\n    return Array.from(new Set([...items, ...selected]));\n  }\n\n  function getCardsByIds(ids: string[]): CardHubItem[] {\n    const map = new Map(options.allCards.value.map(card => [card.id, card]));\n    return ids.map(id => map.get(id)).filter(Boolean) as CardHubItem[];\n  }\n\n  function toggleBatchTagSuggestion(tag: string) {\n    if (batchTagSelectedTags.value.includes(tag)) {\n      batchTagSelectedTags.value = batchTagSelectedTags.value.filter(item => item !== tag);\n    } else {\n      batchTagSelectedTags.value = [...batchTagSelectedTags.value, tag];\n    }\n  }\n\n  function isSameTagSet(current: string[], next: string[]): boolean {\n    if (current.length !== next.length) {\n      return false;\n    }\n    const currentSet = new Set(current);\n    return next.every(tag => currentSet.has(tag));\n  }\n\n  async function applyBatchTags(mode: 'add' | 'remove') {\n    if (!batchTagSelectedIds.value.length) {\n      toastr.warning('');\n      return;\n    }\n    const tags = parseBatchTags(batchTagInput.value, batchTagSelectedTags.value);\n    if (!tags.length) {\n      toastr.warning('');\n      return;\n    }\n    const actionLabel = mode === 'add' ? '' : '';\n    const message = `${actionLabel}${tags.join('')}\\n ${batchTagSelectedIds.value.length} `;\n    const result = await options.openConfirm({\n      title: `${actionLabel}`,\n      message,\n      confirmLabel: `${actionLabel}`,\n      cancelLabel: '',\n    });\n    if (result !== 'confirm') {\n      return;\n    }\n    const cards = getCardsByIds(batchTagSelectedIds.value);\n    let changed = 0;\n    cards.forEach(card => {\n      const currentTags = options.displayTags(card);\n      const nextSet = new Set(currentTags);\n      if (mode === 'add') {\n        tags.forEach(tag => nextSet.add(tag));\n      } else {\n        tags.forEach(tag => nextSet.delete(tag));\n      }\n      const nextTags = Array.from(nextSet);\n      if (!isSameTagSet(currentTags, nextTags)) {\n        options.applyTagUpdate(card, nextTags);\n        changed += 1;\n      }\n    });\n    toastr.success(` ${changed} `);\n  }\n\n  return {\n    tagManagerOpen,\n    tagManagerTab,\n    openTagManager,\n    closeTagManager,\n    batchTagSelectedIds,\n    batchTagSearch,\n    batchTagInput,\n    batchTagSelectedTags,\n    batchTagSelectedSet,\n    batchTagVisibleCandidates,\n    batchTagSuggestions,\n    toggleBatchTagSelection,\n    selectAllBatchTags,\n    clearBatchTagSelection,\n    toggleBatchTagSuggestion,\n    applyBatchTags,\n  };\n}\n","import { computed, ref, type ComputedRef, type Ref } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype ConfirmResult = 'confirm' | 'cancel' | 'alt';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\ntype LibraryActionOptions = {\n  allCards: ComputedRef<CardHubItem[]>;\n  stateSearch: Ref<string>;\n  selectedTags: Ref<string[]>;\n  statusFilter: Ref<'all' | 'imported' | 'unimported'>;\n  getCharacters: () => CardHubItem[];\n  getLibrary: () => CardHubItem[];\n  setLibrary: (library: CardHubItem[]) => void;\n  setCharacters: (characters: CardHubItem[]) => void;\n  fetchCharacterSummaries: () => Promise<CardHubItem[]>;\n  addToLibrary: (files: FileList | File[], existingEntries?: CardHubItem[]) => Promise<CardHubItem[]>;\n  parseLibraryBackup: (raw: string) => CardHubItem[] | null;\n  normalizeLibraryEntries: (entries: CardHubItem[]) => CardHubItem[];\n  mergeLibraryEntries: (current: CardHubItem[], incoming: CardHubItem[]) => CardHubItem[];\n  persistLibrary: (entries: CardHubItem[]) => Promise<void>;\n  removeFromLibrary: (entryId: string, existingEntries?: CardHubItem[]) => CardHubItem[];\n  updateCharacterTags: (target: CardHubItem, nextTags: string[]) => string[];\n  parseLibraryCardData: (card: CardHubItem) => any | null;\n  extractCardTagsFromData: (data: any) => string[];\n  normalizeNameKey: (value: string) => string;\n  normalizeAvatarKey: (value: string) => string;\n  dataUrlToBlob: (dataUrl: string) => Promise<Blob>;\n  downloadBlob: (blob: Blob, fileName: string) => void;\n  openConfirm: (options: ConfirmOptions) => Promise<ConfirmResult>;\n  closeManage: () => void;\n  sleep: (ms: number) => Promise<void>;\n  getExportFormat: () => 'png' | 'json';\n};\n\nexport function useLibraryActions(options: LibraryActionOptions) {\n  const importInput = ref<HTMLInputElement | null>(null);\n  const exportDialogOpen = ref(false);\n  const exportSelectedIds = ref<string[]>([]);\n  const exportSearch = ref('');\n  const exportStatusFilter = ref<'all' | 'imported' | 'unimported'>('all');\n  const exportTagFilters = ref<string[]>([]);\n\n  const exportCandidates = computed(() => [...options.allCards.value]);\n  const exportAllTags = computed(() => {\n    const tagSet = new Set<string>();\n    exportCandidates.value.forEach(card => {\n      (card.tags ?? []).forEach(tag => tagSet.add(tag));\n    });\n    exportTagFilters.value.forEach(tag => tagSet.add(tag));\n    return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n  });\n  const exportVisibleCandidates = computed(() => {\n    let list = exportCandidates.value;\n    if (exportStatusFilter.value === 'imported') {\n      list = list.filter(item => item.origin === 'tavern');\n    } else if (exportStatusFilter.value === 'unimported') {\n      list = list.filter(item => item.origin === 'library');\n    }\n    if (exportTagFilters.value.length) {\n      list = list.filter(card => exportTagFilters.value.some(tag => (card.tags ?? []).includes(tag)));\n    }\n    const keyword = exportSearch.value.trim().toLowerCase();\n    if (!keyword) {\n      return list;\n    }\n    return list.filter(card => {\n      if (card.name.toLowerCase().includes(keyword)) {\n        return true;\n      }\n      const tags = card.tags ?? [];\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\n    });\n  });\n  const exportSelectedSet = computed(() => new Set(exportSelectedIds.value));\n  const exportSelectedItems = computed(() =>\n    exportCandidates.value.filter(item => exportSelectedSet.value.has(item.id)),\n  );\n\n  function openExportDialog() {\n    exportDialogOpen.value = true;\n    exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n  }\n\n  function isExportSelected(id: string): boolean {\n    return exportSelectedSet.value.has(id);\n  }\n\n  function toggleExportSelection(id: string) {\n    if (exportSelectedSet.value.has(id)) {\n      exportSelectedIds.value = exportSelectedIds.value.filter(item => item !== id);\n    } else {\n      exportSelectedIds.value = [...exportSelectedIds.value, id];\n    }\n  }\n\n  function selectAllExport() {\n    exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n  }\n\n  function clearExportSelection() {\n    exportSelectedIds.value = [];\n  }\n\n  function triggerImport() {\n    importInput.value?.click();\n  }\n\n  async function handleImportFiles(event: Event) {\n    const target = event.target as HTMLInputElement | null;\n    const files = target?.files;\n    if (!files || !files.length) {\n      return;\n    }\n    if (files.length === 1 && files[0].name.toLowerCase().endsWith('.json')) {\n      try {\n        const text = await files[0].text();\n        const backupEntries = options.parseLibraryBackup(text);\n        if (backupEntries) {\n          const result = await options.openConfirm({\n            title: '',\n            message: '\\n',\n            confirmLabel: '',\n            altLabel: '',\n            cancelLabel: '',\n          });\n          if (result === 'cancel') {\n            target.value = '';\n            return;\n          }\n          const normalized = options.normalizeLibraryEntries(backupEntries);\n          const current = options.getLibrary();\n          const next = result === 'alt' ? options.mergeLibraryEntries(current, normalized) : normalized;\n          options.setLibrary(next);\n          await options.persistLibrary(next);\n          toastr.success(result === 'alt' ? '' : '');\n          target.value = '';\n          return;\n        }\n      } catch (error) {\n        console.warn('[CardHub] ', error);\n      }\n    }\n    const updated = await options.addToLibrary(files, options.getLibrary());\n    options.setLibrary(updated);\n    target.value = '';\n  }\n\n  function findDuplicateCharacterByName(name: string): CardHubItem | null {\n    const target = options.normalizeNameKey(name);\n    if (!target) {\n      return null;\n    }\n    return options.getCharacters().find(item => options.normalizeNameKey(item.name) === target) ?? null;\n  }\n\n  async function importLibraryCard(card: CardHubItem) {\n    if (!card.raw || !card.rawType) {\n      toastr.error('');\n      return;\n    }\n    const duplicate = findDuplicateCharacterByName(card.name);\n    if (duplicate) {\n      toastr.warning(`${duplicate.name}`);\n      return;\n    }\n    const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\n    delete (headers as Record<string, string>)['Content-Type'];\n\n    const beforeCharacters = await options.fetchCharacterSummaries();\n    const beforeAvatarKeys = new Set(\n      beforeCharacters.map(item => options.normalizeAvatarKey(item.avatar ?? '')).filter(Boolean),\n    );\n\n    if (card.rawType === 'png') {\n      const blob = await options.dataUrlToBlob(card.raw);\n      await TavernHelper.importRawCharacter(card.name, blob);\n    } else {\n      const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n      const form = new FormData();\n      form.append('avatar', file);\n      form.append('file_type', 'json');\n      form.append('preserved_name', file.name);\n      await fetch('/api/characters/import', {\n        method: 'POST',\n        headers,\n        body: form,\n        cache: 'no-cache',\n      });\n    }\n\n    const characters = await options.fetchCharacterSummaries();\n    const expectedNames = new Set([card.name]);\n    if (card.rawType === 'json') {\n      try {\n        const parsed = JSON.parse(card.raw) as { name?: string; data?: { name?: string } };\n        if (parsed?.name) {\n          expectedNames.add(parsed.name);\n        }\n        if (parsed?.data?.name) {\n          expectedNames.add(parsed.data.name);\n        }\n      } catch {\n        // ignore invalid json name parsing\n      }\n    }\n    const matchedByAvatar = characters.find(item => {\n      const avatarKey = options.normalizeAvatarKey(item.avatar ?? '');\n      return avatarKey && !beforeAvatarKeys.has(avatarKey);\n    });\n    const matchedByName = characters.find(item =>\n      Array.from(expectedNames).some(name => options.normalizeNameKey(item.name) === options.normalizeNameKey(name)),\n    );\n    const importedCard = matchedByAvatar ?? matchedByName ?? null;\n    if (importedCard) {\n      options.setLibrary(options.removeFromLibrary(card.id, options.getLibrary()));\n      const rawTags = card.tags?.length\n        ? card.tags\n        : options.extractCardTagsFromData(options.parseLibraryCardData(card));\n      if (rawTags.length) {\n        const cleanedTags = options.updateCharacterTags(importedCard, rawTags);\n        importedCard.tags = cleanedTags;\n      }\n      toastr.success(` ${card.name}`);\n    } else {\n      toastr.warning(`${card.name}`);\n    }\n    options.setCharacters(characters);\n  }\n\n  async function exportLibraryCard(card: CardHubItem) {\n    if (!card.raw || !card.rawType) {\n      toastr.error('');\n      return;\n    }\n    if (card.rawType === 'png') {\n      const blob = await options.dataUrlToBlob(card.raw);\n      options.downloadBlob(blob, `${card.name}.png`);\n      return;\n    }\n    const blob = new Blob([card.raw], { type: 'application/json' });\n    options.downloadBlob(blob, `${card.name}.json`);\n  }\n\n  async function exportCard(card: CardHubItem) {\n    if (card.origin === 'library') {\n      await exportLibraryCard(card);\n      return;\n    }\n    if (options.getExportFormat() === 'json') {\n      const raw = TavernHelper.getCharData(card.avatar ?? card.name, true);\n      if (raw) {\n        const blob = new Blob([JSON.stringify(raw, null, 2)], { type: 'application/json' });\n        options.downloadBlob(blob, `${card.name}.json`);\n        return;\n      }\n    }\n    if (!card.avatar) {\n      toastr.error('');\n      return;\n    }\n    const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n    if (!avatarPath) {\n      toastr.error('');\n      return;\n    }\n    const response = await fetch(avatarPath, { cache: 'no-cache' });\n    const blob = await response.blob();\n    options.downloadBlob(blob, `${card.name}.png`);\n  }\n\n  async function exportSelected() {\n    openExportDialog();\n  }\n\n  async function confirmExportSelected() {\n    const list = exportSelectedItems.value;\n    if (!list.length) {\n      toastr.warning('');\n      return;\n    }\n    const tagLabel = options.selectedTags.value.length ? options.selectedTags.value.join('') : '';\n    const statusLabel =\n      options.statusFilter.value === 'all' ? '' : options.statusFilter.value === 'imported' ? '' : '';\n    const searchLabel = options.stateSearch.value.trim() || '';\n    const message =\n      ` ${list.length} \\n` +\n      `${statusLabel}\\n` +\n      `${tagLabel}\\n` +\n      `${searchLabel}\\n` +\n      ``;\n\n    const result = await options.openConfirm({\n      title: '',\n      message,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (result !== 'confirm') {\n      return;\n    }\n    exportDialogOpen.value = false;\n    for (const item of list) {\n      await exportCard(item);\n      await options.sleep(120);\n    }\n    toastr.success(` ${list.length} `);\n  }\n\n  async function handleCardAction(card: CardHubItem) {\n    if (card.origin === 'library') {\n      await importLibraryCard(card);\n    } else {\n      exportCard(card);\n    }\n  }\n\n  async function moveToLibrary(card: CardHubItem) {\n    if (!card.avatar) {\n      return;\n    }\n    const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n    if (!avatarPath) {\n      toastr.error('');\n      return;\n    }\n    const response = await fetch(avatarPath, { cache: 'no-cache' });\n    const blob = await response.blob();\n    const updated = await options.addToLibrary(\n      [new File([blob], `${card.name}.png`, { type: 'image/png' })],\n      options.getLibrary(),\n    );\n    options.setLibrary(updated);\n  }\n\n  function getCurrentCharacterId(ctx: any, st: typeof SillyTavern | undefined): string {\n    const value = ctx?.characterId ?? st?.characterId ?? '';\n    return value === undefined || value === null ? '' : String(value);\n  }\n\n  async function waitForCharacterSelection(\n    idx: number,\n    ctx: any,\n    st: typeof SillyTavern | undefined,\n    timeoutMs: number,\n  ): Promise<boolean> {\n    const target = String(idx);\n    const start = Date.now();\n    while (Date.now() - start < timeoutMs) {\n      const current = getCurrentCharacterId(ctx, st);\n      if (current === target) {\n        return true;\n      }\n      await options.sleep(80);\n    }\n    return false;\n  }\n\n  function findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\n    const targetName = options.normalizeNameKey(card.name);\n    const targetAvatar = card.avatar ? options.normalizeAvatarKey(card.avatar) : '';\n    const byAvatar = targetAvatar\n      ? list.findIndex(item => options.normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\n      : -1;\n    if (byAvatar >= 0) {\n      return byAvatar;\n    }\n    const byName = list.findIndex(item => options.normalizeNameKey(String(item.name ?? '')) === targetName);\n    if (byName >= 0) {\n      return byName;\n    }\n    return list.findIndex(item => options.normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\n  }\n\n  async function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\n    if (!card.avatar) {\n      toastr.error('');\n      return false;\n    }\n    let st: typeof SillyTavern | undefined;\n    try {\n      st = window.parent?.SillyTavern;\n    } catch {\n      st = undefined;\n    }\n    st ??= SillyTavern;\n    const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n    const list = ctx?.characters ?? st?.characters ?? [];\n    const targetIdx = findCharacterIndex(list, card);\n    const currentId = getCurrentCharacterId(ctx, st);\n    const deletingActive = targetIdx >= 0 && currentId && String(targetIdx) === String(currentId);\n    if (deletingActive) {\n      if (list.length > 1) {\n        const nextIdx = targetIdx === 0 ? 1 : 0;\n        const selector =\n          (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n          (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n        if (selector) {\n          try {\n            await selector(nextIdx, { switchMenu: false });\n            await waitForCharacterSelection(nextIdx, ctx, st, 3000);\n          } catch (error) {\n            console.warn('[CardHub] ', error);\n          }\n        }\n      } else {\n        toastr.warning('');\n      }\n    }\n    const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\n      | Record<string, string>\n      | undefined;\n    if (!headers || !Object.keys(headers).length) {\n      toastr.error('');\n      return false;\n    }\n    const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n    const response = await fetch('/api/characters/delete', {\n      method: 'POST',\n      headers: { ...headers, 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n      cache: 'no-cache',\n    });\n    if (response.ok) {\n      try {\n        await triggerSlash('/closechat');\n      } catch (error) {\n        console.warn('[CardHub] ', error);\n      }\n      return true;\n    }\n    const detail = await response.text();\n    toastr.error(`${response.status} ${detail || response.statusText}`);\n    return false;\n  }\n\n  async function manageDelete(card: CardHubItem) {\n    if (card.origin === 'library') {\n      const confirmDelete = await options.openConfirm({\n        title: '',\n        message: `${card.name}`,\n        confirmLabel: '',\n        cancelLabel: '',\n      });\n      if (confirmDelete !== 'confirm') {\n        return;\n      }\n      options.setLibrary(options.removeFromLibrary(card.id, options.getLibrary()));\n      options.closeManage();\n      return;\n    }\n\n    const confirmDelete = await options.openConfirm({\n      title: '',\n      message: `${card.name}`,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (confirmDelete !== 'confirm') {\n      return;\n    }\n    const deleteChoice = await options.openConfirm({\n      title: '',\n      message: `${card.name}\\n` + `- \\n` + `- `,\n      confirmLabel: '',\n      altLabel: '',\n      cancelLabel: '',\n    });\n    if (deleteChoice === 'cancel') {\n      return;\n    }\n    if (deleteChoice === 'confirm') {\n      await moveToLibrary(card);\n      const deleted = await deleteFromTavern(card, false);\n      if (!deleted) {\n        return;\n      }\n      options.closeManage();\n      const characters = await options.fetchCharacterSummaries();\n      options.setCharacters(characters);\n      return;\n    }\n    const confirmPermanent = await options.openConfirm({\n      title: '',\n      message: `${card.name}`,\n      confirmLabel: '',\n      cancelLabel: '',\n    });\n    if (confirmPermanent !== 'confirm') {\n      return;\n    }\n    const deleted = await deleteFromTavern(card, true);\n    if (!deleted) {\n      return;\n    }\n    options.closeManage();\n    const characters = await options.fetchCharacterSummaries();\n    options.setCharacters(characters);\n  }\n\n  return {\n    importInput,\n    exportDialogOpen,\n    exportSearch,\n    exportStatusFilter,\n    exportTagFilters,\n    exportAllTags,\n    exportVisibleCandidates,\n    exportSelectedItems,\n    exportSelectedIds,\n    openExportDialog,\n    exportSelected,\n    confirmExportSelected,\n    isExportSelected,\n    toggleExportSelection,\n    selectAllExport,\n    clearExportSelection,\n    triggerImport,\n    handleImportFiles,\n    handleCardAction,\n    importLibraryCard,\n    exportCard,\n    exportLibraryCard,\n    manageDelete,\n  };\n}\n\n\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, withModifiers as _withModifiers, createTextVNode as _createTextVNode, isRef as _isRef, withKeys as _withKeys, createVNode as _createVNode, vModelRadio as _vModelRadio, vModelSelect as _vModelSelect, vModelCheckbox as _vModelCheckbox } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub \"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-filter-row\" };\nconst _hoisted_6 = { class: \"cardhub-filter-block\" };\nconst _hoisted_7 = { class: \"cardhub-chip-row\" };\nconst _hoisted_8 = { class: \"cardhub-filter-block\" };\nconst _hoisted_9 = { class: \"cardhub-chip-row\" };\nconst _hoisted_10 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = { class: \"cardhub-content\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_15 = {\n    key: 2,\n    class: \"cardhub-grid-wrap\"\n};\nconst _hoisted_16 = { class: \"cardhub-pagination\" };\nconst _hoisted_17 = {\n    key: 0,\n    class: \"cardhub-pagination__actions\"\n};\nconst _hoisted_18 = [\"disabled\"];\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = { class: \"cardhub-pagination__status\" };\nconst _hoisted_21 = { class: \"cardhub-grid\" };\nconst _hoisted_22 = [\"onClick\"];\nconst _hoisted_23 = { class: \"cardhub-card__info\" };\nconst _hoisted_24 = { class: \"cardhub-card__head\" };\nconst _hoisted_25 = { class: \"cardhub-card__name\" };\nconst _hoisted_26 = [\"onClick\"];\nconst _hoisted_27 = { class: \"cardhub-card__meta\" };\nconst _hoisted_28 = {\n    key: 0,\n    class: \"cardhub-card__note\"\n};\nconst _hoisted_29 = { class: \"cardhub-card__tags\" };\nconst _hoisted_30 = [\"onClick\"];\nconst _hoisted_31 = [\"onClick\"];\nconst _hoisted_32 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_33 = [\"onClick\"];\nconst _hoisted_34 = { class: \"cardhub-card__actions\" };\nconst _hoisted_35 = [\"onClick\"];\nconst _hoisted_36 = [\"onClick\"];\nconst _hoisted_37 = {\n    class: \"cardhub-confirm__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\"\n};\nconst _hoisted_38 = { class: \"cardhub-confirm__title\" };\nconst _hoisted_39 = { class: \"cardhub-confirm__message\" };\nconst _hoisted_40 = { class: \"cardhub-confirm__actions\" };\nconst _hoisted_41 = {\n    class: \"cardhub-tag-manager__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_42 = { class: \"cardhub-tag-manager__header\" };\nconst _hoisted_43 = {\n    key: 0,\n    class: \"cardhub-tag-manager__subtitle\"\n};\nconst _hoisted_44 = {\n    key: 1,\n    class: \"cardhub-tag-manager__subtitle\"\n};\nconst _hoisted_45 = { class: \"cardhub-tag-manager__tabs\" };\nconst _hoisted_46 = {\n    key: 0,\n    class: \"cardhub-tag-manager__section\"\n};\nconst _hoisted_47 = { class: \"cardhub-tag-manager__actions\" };\nconst _hoisted_48 = [\"disabled\"];\nconst _hoisted_49 = { class: \"cardhub-tag-manager__list\" };\nconst _hoisted_50 = [\"onClick\"];\nconst _hoisted_51 = {\n    key: 1,\n    class: \"cardhub-tag-manager__section cardhub-tag-manager__batch\"\n};\nconst _hoisted_52 = { class: \"cardhub-batch__filters\" };\nconst _hoisted_53 = { class: \"cardhub-batch__field\" };\nconst _hoisted_54 = {\n    key: 0,\n    class: \"cardhub-batch__suggestions\"\n};\nconst _hoisted_55 = { class: \"cardhub-batch__suggest-row\" };\nconst _hoisted_56 = [\"onClick\"];\nconst _hoisted_57 = { class: \"cardhub-batch__toolbar\" };\nconst _hoisted_58 = { class: \"cardhub-batch__list\" };\nconst _hoisted_59 = [\"checked\", \"onChange\"];\nconst _hoisted_60 = { class: \"cardhub-batch__main\" };\nconst _hoisted_61 = { class: \"cardhub-batch__name\" };\nconst _hoisted_62 = { class: \"cardhub-batch__meta\" };\nconst _hoisted_63 = {\n    key: 0,\n    class: \"cardhub-batch__tags\"\n};\nconst _hoisted_64 = {\n    class: \"cardhub-export__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_65 = { class: \"cardhub-export__header\" };\nconst _hoisted_66 = { class: \"cardhub-export__subtitle\" };\nconst _hoisted_67 = { class: \"cardhub-export__filters\" };\nconst _hoisted_68 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_69 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_70 = [\"onClick\"];\nconst _hoisted_71 = { class: \"cardhub-export__toolbar\" };\nconst _hoisted_72 = { class: \"cardhub-export__list\" };\nconst _hoisted_73 = [\"checked\", \"onChange\"];\nconst _hoisted_74 = { class: \"cardhub-export__main\" };\nconst _hoisted_75 = { class: \"cardhub-export__name\" };\nconst _hoisted_76 = { class: \"cardhub-export__meta\" };\nconst _hoisted_77 = {\n    key: 0,\n    class: \"cardhub-export__tags\"\n};\nconst _hoisted_78 = {\n    class: \"cardhub-settings__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_79 = { class: \"cardhub-settings__section\" };\nconst _hoisted_80 = { class: \"cardhub-settings__hint\" };\nconst _hoisted_81 = { class: \"cardhub-settings__options\" };\nconst _hoisted_82 = [\"disabled\"];\nconst _hoisted_83 = { class: \"cardhub-settings__option-body\" };\nconst _hoisted_84 = {\n    key: 0,\n    class: \"cardhub-settings__option-warn\"\n};\nconst _hoisted_85 = { class: \"cardhub-settings__section\" };\nconst _hoisted_86 = { class: \"cardhub-settings__options cardhub-settings__options--compact\" };\nconst _hoisted_87 = { class: \"cardhub-settings__row\" };\nconst _hoisted_88 = { class: \"cardhub-settings__row cardhub-settings__toggle\" };\nconst _hoisted_89 = { class: \"cardhub-settings__row\" };\nconst _hoisted_90 = { class: \"cardhub-settings__row\" };\nconst _hoisted_91 = { class: \"cardhub-settings__row cardhub-settings__toggle\" };\nconst _hoisted_92 = { class: \"cardhub-settings__section\" };\nconst _hoisted_93 = { class: \"cardhub-settings__options cardhub-settings__options--compact\" };\nconst _hoisted_94 = { class: \"cardhub-settings__row cardhub-settings__radio\" };\nconst _hoisted_95 = { class: \"cardhub-settings__row cardhub-settings__radio\" };\nconst _hoisted_96 = { class: \"cardhub-settings__section\" };\nconst _hoisted_97 = { class: \"cardhub-settings__backup\" };\nconst _hoisted_98 = { class: \"cardhub-settings__actions\" };\nconst _hoisted_99 = [\"disabled\"];\nconst _hoisted_100 = {\n    class: \"cardhub-theme__panel cardhub-modal__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_101 = { class: \"cardhub-theme__grid\" };\nconst _hoisted_102 = { class: \"cardhub-theme__field\" };\nconst _hoisted_103 = { class: \"cardhub-theme__field\" };\nconst _hoisted_104 = { class: \"cardhub-theme__field\" };\nconst _hoisted_105 = { class: \"cardhub-theme__field\" };\nconst _hoisted_106 = { class: \"cardhub-theme__field\" };\nconst _hoisted_107 = { class: \"cardhub-theme__field\" };\nconst _hoisted_108 = { class: \"cardhub-theme__field\" };\nconst _hoisted_109 = { class: \"cardhub-theme__field\" };\nconst _hoisted_110 = { class: \"cardhub-theme__field\" };\nconst _hoisted_111 = { class: \"cardhub-theme__presets\" };\nconst _hoisted_112 = [\"onClick\"];\nimport { computed, nextTick, onMounted, reactive, ref, toRef, watch } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { addToLibrary, loadLibrary, persistLibrary, normalizeLibraryEntries, mergeLibraryEntries, parseLibraryBackup, removeFromLibrary, updateLibraryNote, updateLibraryTags, } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nimport { loadStorageSettings, saveStorageSettings } from '../services/storageSettings';\nimport { loadGlobalState, updateGlobalState } from '../services/globalState';\nimport ManageModal from './components/ManageModal.vue';\nimport { useBatchTags } from './composables/useBatchTags';\nimport { useLibraryActions } from './composables/useLibraryActions';\nimport { useTagEditing } from './composables/useTagEditing';\nimport { useTagFilters } from './composables/useTagFilters';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const statusFilter = ref('all');\n        const pageSize = ref(24);\n        const currentPage = ref(1);\n        const manageCard = ref(null);\n        const confirmState = reactive({\n            open: false,\n            title: '',\n            message: '',\n            confirmLabel: '',\n            cancelLabel: '',\n            altLabel: '',\n            resolve: null,\n        });\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const mergedTagsMap = computed(() => {\n            const map = new Map();\n            allCards.value.forEach(card => {\n                map.set(card.id, resolveMergedTags(card));\n            });\n            return map;\n        });\n        const duplicateIdSet = computed(() => {\n            const duplicates = new Set();\n            const tavernNameSet = new Set();\n            const tavernAvatarSet = new Set();\n            state.characters.forEach(card => {\n                tavernNameSet.add(normalizeNameKey(card.name));\n                if (card.avatar) {\n                    const base = normalizeAvatarBase(card.avatar);\n                    if (base) {\n                        tavernAvatarSet.add(base);\n                    }\n                }\n            });\n            const libraryNameSet = new Set();\n            const libraryFileSet = new Set();\n            state.library.forEach(entry => {\n                libraryNameSet.add(normalizeNameKey(entry.name));\n                if (entry.importFileName) {\n                    const base = normalizeFileBase(entry.importFileName);\n                    if (base) {\n                        libraryFileSet.add(base);\n                    }\n                }\n            });\n            state.characters.forEach(card => {\n                const nameKey = normalizeNameKey(card.name);\n                const avatarBase = card.avatar ? normalizeAvatarBase(card.avatar) : '';\n                if (libraryNameSet.has(nameKey) || (avatarBase && libraryFileSet.has(avatarBase))) {\n                    duplicates.add(card.id);\n                }\n            });\n            state.library.forEach(entry => {\n                const nameKey = normalizeNameKey(entry.name);\n                const fileBase = entry.importFileName ? normalizeFileBase(entry.importFileName) : '';\n                if (tavernNameSet.has(nameKey) || (fileBase && tavernAvatarSet.has(fileBase))) {\n                    duplicates.add(entry.id);\n                }\n            });\n            return duplicates;\n        });\n        const { selectedTags, allTags, applyTagFilter, toggleTagFilter, clearTagFilter } = useTagFilters(allCards, resolveMergedTags);\n        const favoriteIds = ref([]);\n        const favoriteSet = computed(() => new Set(favoriteIds.value));\n        const sortKey = ref('recent');\n        const favoritesOnly = ref(false);\n        const lastChatCache = ref({});\n        const importCache = ref({});\n        const noteMap = ref({});\n        const defaultTheme = {\n            bgStart: '#f6f8fb',\n            bgEnd: '#e6ebf2',\n            surface: '#fdfdfe',\n            surfaceAlt: '#f1f4f9',\n            text: '#1b1e22',\n            textMuted: '#6b7480',\n            accent: '#7fb3e1',\n            accentStrong: '#243a52',\n            border: '#d5dde8',\n        };\n        const themeDialogOpen = ref(false);\n        const themeCurrent = ref({ ...defaultTheme });\n        const themeDraft = reactive({ ...defaultTheme });\n        const themeStyle = computed(() => {\n            const theme = themeDialogOpen.value ? themeDraft : themeCurrent.value;\n            const avatarSize = uiSettingsCurrent.avatarSize;\n            const avatarDesktop = avatarSize === 'sm' ? 36 : avatarSize === 'lg' ? 50 : 42;\n            const avatarMobile = avatarSize === 'sm' ? 34 : avatarSize === 'lg' ? 46 : 40;\n            return {\n                '--cardhub-bg-start': theme.bgStart,\n                '--cardhub-bg-end': theme.bgEnd,\n                '--cardhub-surface': theme.surface,\n                '--cardhub-surface-alt': theme.surfaceAlt,\n                '--cardhub-text': theme.text,\n                '--cardhub-text-muted': theme.textMuted,\n                '--cardhub-accent': theme.accent,\n                '--cardhub-accent-strong': theme.accentStrong,\n                '--cardhub-border': theme.border,\n                '--cardhub-surface-rgb': hexToRgb(theme.surface),\n                '--cardhub-surface-alt-rgb': hexToRgb(theme.surfaceAlt),\n                '--cardhub-border-rgb': hexToRgb(theme.border),\n                '--cardhub-accent-rgb': hexToRgb(theme.accent),\n                '--cardhub-accent-strong-rgb': hexToRgb(theme.accentStrong),\n                '--cardhub-accent-text': contrastTextColor(theme.accent),\n                '--cardhub-accent-strong-text': contrastTextColor(theme.accentStrong),\n                '--cardhub-tag-rows': String(uiSettingsCurrent.tagRows),\n                '--cardhub-avatar-size': `${avatarDesktop}px`,\n                '--cardhub-avatar-size-mobile': `${avatarMobile}px`,\n            };\n        });\n        const settingsDialogOpen = ref(false);\n        const storageModeCurrent = ref('variables');\n        const storageModeDraft = ref('variables');\n        const storageSaveBusy = ref(false);\n        const indexedDbAvailable = ref(true);\n        const storageModeLabels = {\n            variables: '',\n            indexeddb: ' IndexedDB',\n        };\n        const storageModeCurrentLabel = computed(() => storageModeLabels[storageModeCurrent.value]);\n        const storageModeDirty = computed(() => storageModeDraft.value !== storageModeCurrent.value);\n        const defaultUiSettings = {\n            pageSize: 24,\n            showNoteSummary: true,\n            exportFormat: 'png',\n            tagRows: 2,\n            avatarSize: 'md',\n            syncTavernTags: true,\n        };\n        const uiSettingsCurrent = reactive({ ...defaultUiSettings });\n        const uiSettingsDraft = reactive({ ...defaultUiSettings });\n        const uiSettingsDirty = computed(() => uiSettingsDraft.pageSize !== uiSettingsCurrent.pageSize ||\n            uiSettingsDraft.showNoteSummary !== uiSettingsCurrent.showNoteSummary ||\n            uiSettingsDraft.exportFormat !== uiSettingsCurrent.exportFormat ||\n            uiSettingsDraft.tagRows !== uiSettingsCurrent.tagRows ||\n            uiSettingsDraft.avatarSize !== uiSettingsCurrent.avatarSize ||\n            uiSettingsDraft.syncTavernTags !== uiSettingsCurrent.syncTavernTags);\n        const showNoteSummary = computed(() => uiSettingsCurrent.showNoteSummary);\n        const backupImportInput = ref(null);\n        function normalizeUiSettings(raw) {\n            if (!raw || typeof raw !== 'object') {\n                return { ...defaultUiSettings };\n            }\n            const data = raw;\n            const pageSizeValue = Number(data.pageSize);\n            const pageSizeAllowed = [12, 24, 36, 48];\n            const pageSizeNormalized = pageSizeAllowed.includes(pageSizeValue) ? pageSizeValue : defaultUiSettings.pageSize;\n            const showNoteSummaryValue = typeof data.showNoteSummary === 'boolean' ? data.showNoteSummary : defaultUiSettings.showNoteSummary;\n            const exportFormatValue = data.exportFormat === 'json' || data.exportFormat === 'png' ? data.exportFormat : defaultUiSettings.exportFormat;\n            const tagRowsValue = Number(data.tagRows);\n            const tagRowsAllowed = [1, 2, 3, 4];\n            const tagRowsNormalized = tagRowsAllowed.includes(tagRowsValue) ? tagRowsValue : defaultUiSettings.tagRows;\n            const avatarSizeValue = data.avatarSize === 'sm' || data.avatarSize === 'lg' ? data.avatarSize : 'md';\n            const syncTavernTagsValue = typeof data.syncTavernTags === 'boolean' ? data.syncTavernTags : defaultUiSettings.syncTavernTags;\n            return {\n                pageSize: pageSizeNormalized,\n                showNoteSummary: showNoteSummaryValue,\n                exportFormat: exportFormatValue,\n                tagRows: tagRowsNormalized,\n                avatarSize: avatarSizeValue,\n                syncTavernTags: syncTavernTagsValue,\n            };\n        }\n        function syncUiSettings() {\n            const state = loadGlobalState();\n            const normalized = normalizeUiSettings(state?.uiSettings);\n            Object.assign(uiSettingsCurrent, normalized);\n            Object.assign(uiSettingsDraft, normalized);\n            pageSize.value = normalized.pageSize;\n        }\n        function saveUiSettings() {\n            Object.assign(uiSettingsCurrent, uiSettingsDraft);\n            updateGlobalState({ uiSettings: { ...uiSettingsCurrent } });\n            pageSize.value = uiSettingsCurrent.pageSize;\n        }\n        const themePresets = [\n            {\n                name: '',\n                value: {\n                    bgStart: '#f6f8fb',\n                    bgEnd: '#e6ebf2',\n                    surface: '#fdfdfe',\n                    surfaceAlt: '#f1f4f9',\n                    text: '#1b1e22',\n                    textMuted: '#6b7480',\n                    accent: '#7fb3e1',\n                    accentStrong: '#243a52',\n                    border: '#d5dde8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fdfaf4',\n                    bgEnd: '#f2ebe1',\n                    surface: '#fffefb',\n                    surfaceAlt: '#f7efe6',\n                    text: '#1d1a17',\n                    textMuted: '#7a6f63',\n                    accent: '#e3a981',\n                    accentStrong: '#3f2c22',\n                    border: '#e4d7c8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#14181d',\n                    bgEnd: '#0d1116',\n                    surface: '#1e242b',\n                    surfaceAlt: '#242b34',\n                    text: '#eef2f7',\n                    textMuted: '#b2bdc9',\n                    accent: '#6fa2d1',\n                    accentStrong: '#d7e6f4',\n                    border: '#36414c',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f7f1e7',\n                    bgEnd: '#e6d8c6',\n                    surface: '#fcf6ee',\n                    surfaceAlt: '#f2e4d6',\n                    text: '#2a1f18',\n                    textMuted: '#8a6d5a',\n                    accent: '#c47b52',\n                    accentStrong: '#3e2a22',\n                    border: '#ddc7b4',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fbf1ea',\n                    bgEnd: '#ecd5c8',\n                    surface: '#fff7f1',\n                    surfaceAlt: '#f4e1d6',\n                    text: '#2d2018',\n                    textMuted: '#8b6a5a',\n                    accent: '#d17a4f',\n                    accentStrong: '#4c2d21',\n                    border: '#e3c3b3',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f2fbf7',\n                    bgEnd: '#dcefe7',\n                    surface: '#f9fffd',\n                    surfaceAlt: '#e8f4f0',\n                    text: '#1a2a26',\n                    textMuted: '#5f7a73',\n                    accent: '#60b6a4',\n                    accentStrong: '#1f4c43',\n                    border: '#c5ddd5',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f3f8fb',\n                    bgEnd: '#d9e7f3',\n                    surface: '#f9fcff',\n                    surfaceAlt: '#e9f2f9',\n                    text: '#1b2530',\n                    textMuted: '#5f7388',\n                    accent: '#5da3cf',\n                    accentStrong: '#1f3e57',\n                    border: '#c8d9e7',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#2a2d33',\n                    bgEnd: '#1e2126',\n                    surface: '#333741',\n                    surfaceAlt: '#3b404b',\n                    text: '#f3f5f8',\n                    textMuted: '#c1c7d0',\n                    accent: '#9aa6b2',\n                    accentStrong: '#e0e5ea',\n                    border: '#4b5261',\n                },\n            },\n        ];\n        const filteredCharacters = computed(() => {\n            const list = applyFavoriteFilter(applyStatusFilter(allCards.value));\n            const keyword = state.search.trim().toLowerCase();\n            if (!keyword) {\n                return sortCards(applyTagFilter(list));\n            }\n            return sortCards(applyTagFilter(list).filter(character => {\n                const name = character.name.toLowerCase();\n                if (name.includes(keyword)) {\n                    return true;\n                }\n                const tags = mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n                return tags.some(tag => tag.toLowerCase().includes(keyword));\n            }));\n        });\n        const { tagManagerOpen, tagManagerTab, openTagManager, closeTagManager, batchTagSelectedIds, batchTagSearch, batchTagInput, batchTagSelectedTags, batchTagSelectedSet, batchTagVisibleCandidates, batchTagSuggestions, toggleBatchTagSelection, selectAllBatchTags, clearBatchTagSelection, toggleBatchTagSuggestion, applyBatchTags, } = useBatchTags({\n            allCards,\n            filteredCharacters,\n            allTags,\n            displayTags,\n            applyTagUpdate,\n            openConfirm,\n        });\n        const stateSearch = toRef(state, 'search');\n        const { importInput, exportDialogOpen, exportSearch, exportStatusFilter, exportTagFilters, exportAllTags, exportVisibleCandidates, exportSelectedItems, exportSelectedIds, openExportDialog, exportSelected, confirmExportSelected, isExportSelected, toggleExportSelection, selectAllExport, clearExportSelection, triggerImport, handleImportFiles, handleCardAction, importLibraryCard, exportCard, exportLibraryCard, manageDelete, } = useLibraryActions({\n            allCards,\n            stateSearch,\n            selectedTags,\n            statusFilter,\n            getCharacters: () => state.characters,\n            getLibrary: () => state.library,\n            setLibrary,\n            setCharacters: setCharactersWithNotes,\n            fetchCharacterSummaries,\n            addToLibrary,\n            parseLibraryBackup,\n            normalizeLibraryEntries,\n            mergeLibraryEntries,\n            persistLibrary,\n            removeFromLibrary,\n            updateCharacterTags: updateCharacterTagsWithSetting,\n            parseLibraryCardData,\n            extractCardTagsFromData,\n            normalizeNameKey,\n            normalizeAvatarKey,\n            dataUrlToBlob,\n            downloadBlob,\n            openConfirm,\n            closeManage,\n            sleep,\n            getExportFormat: () => uiSettingsCurrent.exportFormat,\n        });\n        const totalPages = computed(() => {\n            const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n            return total > 0 ? total : 1;\n        });\n        const pagedCharacters = computed(() => {\n            const start = (currentPage.value - 1) * pageSize.value;\n            return filteredCharacters.value.slice(start, start + pageSize.value);\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return mergedTagsMap.value.get(character.id) ?? resolveMergedTags(character);\n        }\n        function buildNoteCandidates(card) {\n            const candidates = new Set();\n            if (card.origin !== 'tavern') {\n                return [];\n            }\n            const rawValues = [card.tagKey, card.avatar, card.name].filter(Boolean);\n            rawValues.forEach(value => {\n                const trimmed = value.trim();\n                if (!trimmed) {\n                    return;\n                }\n                candidates.add(`tavern:${trimmed}`);\n                if (trimmed.includes('::')) {\n                    candidates.add(`tavern:${trimmed.split('::')[0]}`);\n                }\n                if (trimmed.startsWith('name:')) {\n                    const namePart = trimmed.slice(5).split('::')[0];\n                    if (namePart) {\n                        candidates.add(`tavern:${namePart}`);\n                    }\n                }\n                const baseName = trimmed.includes('/') ? trimmed.split('/').pop() : trimmed;\n                if (baseName && baseName !== trimmed) {\n                    candidates.add(`tavern:${baseName}`);\n                }\n                try {\n                    const decoded = decodeURIComponent(trimmed);\n                    if (decoded && decoded !== trimmed) {\n                        candidates.add(`tavern:${decoded}`);\n                    }\n                }\n                catch {\n                    // ignore decode errors\n                }\n            });\n            return Array.from(candidates);\n        }\n        function resolveNoteForCard(card) {\n            if (card.origin === 'tavern') {\n                const candidates = buildNoteCandidates(card);\n                for (const key of candidates) {\n                    const note = noteMap.value[key];\n                    if (note && note.trim()) {\n                        return note.trim();\n                    }\n                }\n            }\n            return card.note?.trim() ?? '';\n        }\n        function displayNote(character) {\n            return resolveNoteForCard(character);\n        }\n        function resolveMergedTags(card) {\n            if (card.origin === 'library') {\n                return card.tags ?? [];\n            }\n            if (!uiSettingsCurrent.syncTavernTags) {\n                return card.tags ?? [];\n            }\n            return getMergedTags(card);\n        }\n        function updateCharacterTagsWithSetting(target, nextTags) {\n            if (!uiSettingsCurrent.syncTavernTags) {\n                const cleaned = Array.from(new Set(nextTags.map(tag => tag.trim()).filter(Boolean)));\n                return cleaned;\n            }\n            return updateCharacterTags(target, nextTags);\n        }\n        function applyFavoriteFilter(list) {\n            if (!favoritesOnly.value) {\n                return list;\n            }\n            return list.filter(item => favoriteSet.value.has(item.id));\n        }\n        function getFavoriteList() {\n            const state = loadGlobalState();\n            const raw = state?.favorites;\n            return Array.isArray(raw) ? raw.filter(item => typeof item === 'string') : [];\n        }\n        function saveFavoriteList(list) {\n            updateGlobalState({ favorites: list });\n        }\n        function loadLastChatCache() {\n            const state = loadGlobalState();\n            const raw = state?.lastChatCache;\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveLastChatCache(cache) {\n            updateGlobalState({ lastChatCache: cache });\n        }\n        function loadImportCache() {\n            const state = loadGlobalState();\n            const raw = state?.importCache;\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveImportCache(cache) {\n            updateGlobalState({ importCache: cache });\n        }\n        function loadNoteMap() {\n            const state = loadGlobalState();\n            const raw = state?.notes;\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'string' && value.trim().length > 0);\n            return Object.fromEntries(entries);\n        }\n        function saveNoteMap(map) {\n            updateGlobalState({ notes: map });\n        }\n        function getChatCacheKey(card) {\n            if (card.origin !== 'tavern') {\n                return null;\n            }\n            if (card.avatar) {\n                return `avatar:${card.avatar}`;\n            }\n            if (card.name) {\n                return `name:${card.name}`;\n            }\n            return null;\n        }\n        function getImportAt(card) {\n            if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                return card.createdAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (importCache.value[key] ?? 0) : 0;\n        }\n        function getLastChatAt(card) {\n            if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                return card.lastChatAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (lastChatCache.value[key] ?? 0) : 0;\n        }\n        function updateLastChatCache(key, timestamp) {\n            const next = { ...lastChatCache.value, [key]: timestamp };\n            lastChatCache.value = next;\n            saveLastChatCache(next);\n        }\n        function updateLastChatCacheForCard(card, timestamp) {\n            if (timestamp <= 0 || card.origin !== 'tavern') {\n                return;\n            }\n            const keys = new Set();\n            if (card.avatar) {\n                keys.add(`avatar:${card.avatar}`);\n            }\n            if (card.name) {\n                keys.add(`name:${card.name}`);\n            }\n            if (!keys.size) {\n                return;\n            }\n            const next = { ...lastChatCache.value };\n            let changed = false;\n            keys.forEach(key => {\n                if ((next[key] ?? 0) < timestamp) {\n                    next[key] = timestamp;\n                    changed = true;\n                }\n            });\n            if (changed) {\n                lastChatCache.value = next;\n                saveLastChatCache(next);\n            }\n        }\n        function updateImportCache(next) {\n            importCache.value = next;\n            saveImportCache(next);\n        }\n        function isFavorite(id) {\n            return favoriteSet.value.has(id);\n        }\n        function toggleFavorite(card) {\n            if (favoriteSet.value.has(card.id)) {\n                favoriteIds.value = favoriteIds.value.filter(item => item !== card.id);\n            }\n            else {\n                favoriteIds.value = [...favoriteIds.value, card.id];\n            }\n            saveFavoriteList(favoriteIds.value);\n        }\n        function sortCards(list) {\n            const withScore = list.map(item => {\n                const tags = mergedTagsMap.value.get(item.id) ?? getMergedTags(item);\n                return {\n                    item,\n                    tagCount: tags.length,\n                };\n            });\n            const byName = (a, b) => a.localeCompare(b, 'zh-CN');\n            return withScore\n                .sort((lhs, rhs) => {\n                const a = lhs.item;\n                const b = rhs.item;\n                if (sortKey.value === 'name') {\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'tags') {\n                    if (rhs.tagCount !== lhs.tagCount) {\n                        return rhs.tagCount - lhs.tagCount;\n                    }\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'imported') {\n                    const aTime = getImportAt(a);\n                    const bTime = getImportAt(b);\n                    if (bTime !== aTime) {\n                        return bTime - aTime;\n                    }\n                    return byName(a.name, b.name);\n                }\n                const aTime = getLastChatAt(a);\n                const bTime = getLastChatAt(b);\n                if (bTime !== aTime) {\n                    return bTime - aTime;\n                }\n                const aCreated = a.createdAt ?? 0;\n                const bCreated = b.createdAt ?? 0;\n                if (bCreated !== aCreated) {\n                    return bCreated - aCreated;\n                }\n                return byName(a.name, b.name);\n            })\n                .map(entry => entry.item);\n        }\n        function isLibraryItem(item) {\n            if (item.origin === 'library' || Boolean(item.rawType)) {\n                return true;\n            }\n            return state.library.some(entry => entry.id === item.id);\n        }\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => !isLibraryItem(item));\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => isLibraryItem(item));\n            }\n            if (statusFilter.value === 'duplicate') {\n                return list.filter(item => duplicateIdSet.value.has(item.id));\n            }\n            return list;\n        }\n        function hexToRgb(value) {\n            const hex = value.replace('#', '');\n            if (hex.length !== 6) {\n                return '0, 0, 0';\n            }\n            const r = Number.parseInt(hex.slice(0, 2), 16);\n            const g = Number.parseInt(hex.slice(2, 4), 16);\n            const b = Number.parseInt(hex.slice(4, 6), 16);\n            return `${r}, ${g}, ${b}`;\n        }\n        function contrastTextColor(value) {\n            const rgb = hexToRgb(value)\n                .split(',')\n                .map(part => Number(part.trim()));\n            if (rgb.length !== 3) {\n                return '#1b1b1b';\n            }\n            const [r, g, b] = rgb.map(channel => channel / 255);\n            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n            return luminance > 0.6 ? '#1b1b1b' : '#ffffff';\n        }\n        function normalizeTheme(raw) {\n            if (!raw || typeof raw !== 'object') {\n                return { ...defaultTheme };\n            }\n            const data = raw;\n            const pick = (key) => {\n                const value = data[key];\n                return /^#[0-9a-f]{6}$/i.test(value) ? value : defaultTheme[key];\n            };\n            return {\n                bgStart: pick('bgStart'),\n                bgEnd: pick('bgEnd'),\n                surface: pick('surface'),\n                surfaceAlt: pick('surfaceAlt'),\n                text: pick('text'),\n                textMuted: pick('textMuted'),\n                accent: pick('accent'),\n                accentStrong: pick('accentStrong'),\n                border: pick('border'),\n            };\n        }\n        function getCardHubRoot() {\n            try {\n                return (window.parent?.document ?? document).querySelector('.cardhub-root');\n            }\n            catch {\n                return document.querySelector('.cardhub-root');\n            }\n        }\n        let themeFrame = 0;\n        let themeTimer = null;\n        function scheduleThemeApply(theme) {\n            if (themeFrame) {\n                cancelAnimationFrame(themeFrame);\n                themeFrame = 0;\n            }\n            if (themeTimer) {\n                window.clearTimeout(themeTimer);\n            }\n            themeTimer = window.setTimeout(() => {\n                themeTimer = null;\n                themeFrame = requestAnimationFrame(() => {\n                    themeFrame = 0;\n                    applyTheme(theme);\n                });\n            }, 80);\n        }\n        function applyTheme(theme) {\n            const root = getCardHubRoot();\n            if (!root) {\n                return;\n            }\n            root.style.setProperty('--cardhub-bg-start', theme.bgStart);\n            root.style.setProperty('--cardhub-bg-end', theme.bgEnd);\n            root.style.setProperty('--cardhub-surface', theme.surface);\n            root.style.setProperty('--cardhub-surface-alt', theme.surfaceAlt);\n            root.style.setProperty('--cardhub-text', theme.text);\n            root.style.setProperty('--cardhub-text-muted', theme.textMuted);\n            root.style.setProperty('--cardhub-accent', theme.accent);\n            root.style.setProperty('--cardhub-accent-strong', theme.accentStrong);\n            root.style.setProperty('--cardhub-border', theme.border);\n            root.style.setProperty('--cardhub-surface-rgb', hexToRgb(theme.surface));\n            root.style.setProperty('--cardhub-surface-alt-rgb', hexToRgb(theme.surfaceAlt));\n            root.style.setProperty('--cardhub-border-rgb', hexToRgb(theme.border));\n            root.style.setProperty('--cardhub-accent-rgb', hexToRgb(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-rgb', hexToRgb(theme.accentStrong));\n            root.style.setProperty('--cardhub-accent-text', contrastTextColor(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-text', contrastTextColor(theme.accentStrong));\n        }\n        function loadThemeFromGlobal() {\n            const state = loadGlobalState();\n            return normalizeTheme(state?.theme);\n        }\n        function saveThemeToGlobal(theme) {\n            updateGlobalState({ theme });\n        }\n        function openThemeDialog() {\n            const current = themeCurrent.value;\n            Object.assign(themeDraft, current);\n            themeDialogOpen.value = true;\n            nextTick(() => scheduleThemeApply(current));\n        }\n        function closeThemeDialog() {\n            themeDialogOpen.value = false;\n            Object.assign(themeDraft, themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n        }\n        function resetThemeDraft() {\n            Object.assign(themeDraft, defaultTheme);\n        }\n        function saveThemeDraft() {\n            themeCurrent.value = { ...themeDraft };\n            saveThemeToGlobal(themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n            themeDialogOpen.value = false;\n        }\n        function applyThemePreset(preset) {\n            Object.assign(themeDraft, preset.value);\n        }\n        function syncStorageSettings() {\n            const settings = loadStorageSettings();\n            const normalized = settings.mode === 'indexeddb' || settings.mode === 'variables' ? settings.mode : 'variables';\n            storageModeCurrent.value = normalized;\n            storageModeDraft.value = normalized;\n        }\n        function openSettingsDialog() {\n            syncStorageSettings();\n            syncUiSettings();\n            settingsDialogOpen.value = true;\n        }\n        function closeSettingsDialog() {\n            settingsDialogOpen.value = false;\n            storageModeDraft.value = storageModeCurrent.value;\n            Object.assign(uiSettingsDraft, uiSettingsCurrent);\n        }\n        async function saveSettingsDialog() {\n            if (storageSaveBusy.value || (!storageModeDirty.value && !uiSettingsDirty.value)) {\n                settingsDialogOpen.value = false;\n                return;\n            }\n            storageSaveBusy.value = true;\n            const nextMode = storageModeDraft.value;\n            const prevMode = storageModeCurrent.value;\n            try {\n                if (storageModeDirty.value) {\n                    const currentLibrary = await loadLibrary();\n                    saveStorageSettings({ mode: nextMode });\n                    await persistLibrary(currentLibrary, nextMode);\n                    storageModeCurrent.value = nextMode;\n                    setLibrary(currentLibrary);\n                }\n                if (uiSettingsDirty.value) {\n                    saveUiSettings();\n                }\n                settingsDialogOpen.value = false;\n                toastr.success(storageModeDirty.value ? '' : '');\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n                if (storageModeDirty.value) {\n                    saveStorageSettings({ mode: prevMode });\n                    storageModeCurrent.value = prevMode;\n                    storageModeDraft.value = prevMode;\n                }\n                Object.assign(uiSettingsDraft, uiSettingsCurrent);\n                toastr.error('');\n            }\n            finally {\n                storageSaveBusy.value = false;\n            }\n        }\n        async function exportLibraryBackup() {\n            const entries = await loadLibrary();\n            const blob = new Blob([JSON.stringify({ entries }, null, 2)], { type: 'application/json' });\n            const stamp = new Date().toISOString().slice(0, 10);\n            downloadBlob(blob, `cardhub_library_${stamp}.json`);\n            toastr.success('');\n        }\n        function triggerBackupImport() {\n            backupImportInput.value?.click();\n        }\n        async function handleBackupImport(event) {\n            const target = event.target;\n            const files = target?.files;\n            if (!files || !files.length) {\n                return;\n            }\n            const file = files[0];\n            try {\n                const text = await file.text();\n                const backupEntries = parseLibraryBackup(text);\n                if (!backupEntries) {\n                    toastr.error('');\n                    return;\n                }\n                const result = await openConfirm({\n                    title: '',\n                    message: '',\n                    confirmLabel: '',\n                    altLabel: '',\n                    cancelLabel: '',\n                });\n                if (result === 'cancel') {\n                    return;\n                }\n                const normalized = normalizeLibraryEntries(backupEntries);\n                const current = state.library;\n                const next = result === 'alt' ? mergeLibraryEntries(current, normalized) : normalized;\n                setLibrary(next);\n                await persistLibrary(next);\n                toastr.success(result === 'alt' ? '' : '');\n            }\n            finally {\n                if (target) {\n                    target.value = '';\n                }\n            }\n        }\n        function toggleExportTagFilter(tag) {\n            if (exportTagFilters.value.includes(tag)) {\n                exportTagFilters.value = exportTagFilters.value.filter(item => item !== tag);\n            }\n            else {\n                exportTagFilters.value = [...exportTagFilters.value, tag];\n            }\n        }\n        function clearExportTagFilter() {\n            exportTagFilters.value = [];\n        }\n        watch(themeDraft, value => {\n            if (themeDialogOpen.value) {\n                scheduleThemeApply({ ...value });\n            }\n        }, { deep: true });\n        onMounted(() => {\n            const theme = loadThemeFromGlobal();\n            themeCurrent.value = theme;\n            Object.assign(themeDraft, theme);\n            nextTick(() => scheduleThemeApply(theme));\n            indexedDbAvailable.value = typeof indexedDB !== 'undefined';\n            syncStorageSettings();\n            syncUiSettings();\n            favoriteIds.value = getFavoriteList();\n            lastChatCache.value = loadLastChatCache();\n            importCache.value = loadImportCache();\n            noteMap.value = loadNoteMap();\n            void warmRecentChatCache(allCards.value);\n            warmImportCache(allCards.value);\n        });\n        function closeExportDialog() {\n            exportDialogOpen.value = false;\n        }\n        watch([() => state.search, statusFilter, () => selectedTags.value.join('|'), sortKey, favoritesOnly], () => {\n            currentPage.value = 1;\n        });\n        watch([filteredCharacters, totalPages], () => {\n            if (currentPage.value > totalPages.value) {\n                currentPage.value = totalPages.value;\n            }\n            if (currentPage.value < 1) {\n                currentPage.value = 1;\n            }\n        });\n        watch([sortKey, allCards], () => {\n            if (sortKey.value === 'recent') {\n                void warmRecentChatCache(allCards.value);\n            }\n            if (sortKey.value === 'imported') {\n                warmImportCache(allCards.value);\n            }\n        });\n        function prevPage() {\n            if (currentPage.value > 1) {\n                currentPage.value -= 1;\n            }\n        }\n        function nextPage() {\n            if (currentPage.value < totalPages.value) {\n                currentPage.value += 1;\n            }\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function normalizeAvatarKey(value) {\n            let raw = value.trim();\n            if (!raw) {\n                return '';\n            }\n            try {\n                raw = decodeURIComponent(raw);\n            }\n            catch {\n                // ignore\n            }\n            raw = raw.split('?')[0];\n            if (raw.includes('/')) {\n                raw = raw.split('/').pop() ?? raw;\n            }\n            return raw.trim().toLowerCase();\n        }\n        function normalizeAvatarBase(value) {\n            const raw = normalizeAvatarKey(value);\n            return raw.replace(/\\.(png|webp|jpg|jpeg)$/i, '');\n        }\n        function normalizeFileBase(fileName) {\n            return normalizeNameKey(fileName.replace(/\\.(png|json)$/i, ''));\n        }\n        function getNoteStorageKey(card) {\n            if (card.origin !== 'tavern') {\n                return null;\n            }\n            const key = card.tagKey ?? card.avatar ?? card.name;\n            if (!key) {\n                return null;\n            }\n            return `tavern:${key}`;\n        }\n        function applyNotesToCharacters(list) {\n            return list.map(card => {\n                const note = resolveNoteForCard(card);\n                return { ...card, note };\n            });\n        }\n        function setCharactersWithNotes(list) {\n            setCharacters(applyNotesToCharacters(list));\n        }\n        function openConfirm(options) {\n            if (confirmState.open && confirmState.resolve) {\n                confirmState.resolve('cancel');\n            }\n            confirmState.title = options.title ?? '';\n            confirmState.message = options.message;\n            confirmState.confirmLabel = options.confirmLabel ?? '';\n            confirmState.cancelLabel = options.cancelLabel ?? '';\n            confirmState.altLabel = options.altLabel ?? '';\n            confirmState.open = true;\n            return new Promise(resolve => {\n                confirmState.resolve = resolve;\n            });\n        }\n        function resolveConfirm(result) {\n            if (!confirmState.open) {\n                return;\n            }\n            confirmState.open = false;\n            const resolver = confirmState.resolve;\n            confirmState.resolve = null;\n            if (resolver) {\n                resolver(result);\n            }\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (isLibraryItem(character)) {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags, state.library);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTagsWithSetting(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        const { tagKey, activeTagKey, tagInput, startTagEdit, cancelTagEdit, confirmTag, removeTag } = useTagEditing({\n            getTags: resolveMergedTags,\n            applyTagUpdate,\n        });\n        function applyNoteUpdate(character, note) {\n            const nextNote = note.trim();\n            if (isLibraryItem(character)) {\n                const updatedLibrary = updateLibraryNote(character.id, nextNote, state.library);\n                setLibrary(updatedLibrary);\n                const updated = updatedLibrary.find(item => item.id === character.id);\n                if (updated) {\n                    manageCard.value = updated;\n                }\n                return;\n            }\n            const key = getNoteStorageKey(character);\n            if (!key) {\n                return;\n            }\n            const nextMap = { ...noteMap.value };\n            if (nextNote) {\n                nextMap[key] = nextNote;\n            }\n            else {\n                delete nextMap[key];\n            }\n            noteMap.value = nextMap;\n            saveNoteMap(nextMap);\n            const updatedCharacters = state.characters.map(card => card.id === character.id ? { ...card, note: nextNote } : card);\n            setCharacters(updatedCharacters);\n            const updated = updatedCharacters.find(card => card.id === character.id);\n            if (updated) {\n                manageCard.value = updated;\n            }\n        }\n        function openManage(card) {\n            const note = resolveNoteForCard(card);\n            manageCard.value = note ? { ...card, note } : card;\n        }\n        function closeManage() {\n            manageCard.value = null;\n        }\n        function parseLibraryCardData(card) {\n            if (!card.raw || !card.rawType) {\n                return null;\n            }\n            if (card.rawType === 'json') {\n                return parseJsonSafe(card.raw);\n            }\n            if (card.rawType === 'png') {\n                return parsePngCardData(card.raw);\n            }\n            return null;\n        }\n        function parseJsonSafe(raw) {\n            try {\n                return JSON.parse(raw);\n            }\n            catch {\n                return null;\n            }\n        }\n        function parsePngCardData(dataUrl) {\n            const bytes = dataUrlToBytes(dataUrl);\n            if (!bytes) {\n                return null;\n            }\n            const chunks = extractPngTextChunks(bytes);\n            const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n            for (const chunk of chunks) {\n                if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n                    continue;\n                }\n                const parsed = parseCardPayload(chunk.value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function dataUrlToBytes(dataUrl) {\n            const comma = dataUrl.indexOf(',');\n            if (comma < 0) {\n                return null;\n            }\n            const base64 = dataUrl.slice(comma + 1);\n            try {\n                const binary = atob(base64);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return bytes;\n            }\n            catch {\n                return null;\n            }\n        }\n        function extractPngTextChunks(bytes) {\n            if (bytes.length < 8) {\n                return [];\n            }\n            const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n            for (let i = 0; i < signature.length; i += 1) {\n                if (bytes[i] !== signature[i]) {\n                    return [];\n                }\n            }\n            const chunks = [];\n            let offset = 8;\n            while (offset + 8 <= bytes.length) {\n                const length = readUint32BE(bytes, offset);\n                const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n                const dataStart = offset + 8;\n                const dataEnd = dataStart + length;\n                if (dataEnd + 4 > bytes.length) {\n                    break;\n                }\n                const data = bytes.subarray(dataStart, dataEnd);\n                if (type === 'tEXt') {\n                    const entry = parseTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                else if (type === 'iTXt') {\n                    const entry = parseIntlTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                offset = dataEnd + 4;\n            }\n            return chunks;\n        }\n        function parseTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseIntlTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const compressed = data[nullIndex + 1] === 1;\n            let cursor = nullIndex + 2;\n            const langEnd = data.indexOf(0, cursor);\n            if (langEnd < 0) {\n                return null;\n            }\n            cursor = langEnd + 1;\n            const translatedEnd = data.indexOf(0, cursor);\n            if (translatedEnd < 0) {\n                return null;\n            }\n            cursor = translatedEnd + 1;\n            if (compressed) {\n                return null;\n            }\n            const value = bytesToString(data.subarray(cursor)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseCardPayload(value) {\n            const trimmed = value.trim();\n            if (!trimmed) {\n                return null;\n            }\n            const direct = parseJsonSafe(trimmed);\n            if (direct) {\n                return direct;\n            }\n            if (!isLikelyBase64(trimmed)) {\n                return null;\n            }\n            const decoded = decodeBase64Text(trimmed);\n            if (!decoded) {\n                return null;\n            }\n            return parseJsonSafe(decoded);\n        }\n        function decodeBase64Text(value) {\n            try {\n                const binary = atob(value);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return new TextDecoder().decode(bytes);\n            }\n            catch {\n                return null;\n            }\n        }\n        function isLikelyBase64(value) {\n            if (value.length < 16 || value.length % 4 !== 0) {\n                return false;\n            }\n            return /^[A-Za-z0-9+/=]+$/.test(value);\n        }\n        function readUint32BE(bytes, offset) {\n            return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n        }\n        function bytesToString(bytes) {\n            return new TextDecoder().decode(bytes);\n        }\n        function extractCardTagsFromData(data) {\n            const tags = data?.tags ?? data?.data?.tags;\n            if (!Array.isArray(tags)) {\n                return [];\n            }\n            return tags\n                .filter(tag => typeof tag === 'string')\n                .map(tag => tag.trim())\n                .filter(Boolean);\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function formatMaybeTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                const ms = value < 1e12 ? value * 1000 : value;\n                return new Date(ms).toLocaleString('zh-CN', { hour12: false });\n            }\n            if (typeof value === 'string') {\n                const trimmed = value.trim();\n                if (trimmed) {\n                    return trimmed;\n                }\n            }\n            return '';\n        }\n        function parseTimestampFromText(raw) {\n            const text = raw.replace(/\\.jsonl$/i, '').trim();\n            const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:](\\d{1,2})(?:[:](\\d{1,2}))?)?/;\n            const match = text.match(pattern);\n            if (!match) {\n                return null;\n            }\n            const year = Number(match[1]);\n            const month = Number(match[2]);\n            const day = Number(match[3]);\n            const hour = match[4] ? Number(match[4]) : 0;\n            const minute = match[5] ? Number(match[5]) : 0;\n            const second = match[6] ? Number(match[6]) : 0;\n            if (!year || !month || !day) {\n                return null;\n            }\n            const date = new Date(year, month - 1, day, hour, minute, second);\n            const time = date.getTime();\n            return Number.isNaN(time) ? null : time;\n        }\n        function coerceTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                return value < 1e12 ? value * 1000 : value;\n            }\n            if (typeof value === 'string') {\n                const parsed = Date.parse(value);\n                if (!Number.isNaN(parsed)) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function extractChatLatestTimestamp(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const parsed = coerceTimestamp(value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (fallback) {\n                return parseTimestampFromText(fallback);\n            }\n            return null;\n        }\n        function sortChatBrief(list) {\n            return [...list].sort((lhs, rhs) => {\n                const left = extractChatLatestTimestamp(lhs) ?? 0;\n                const right = extractChatLatestTimestamp(rhs) ?? 0;\n                return right - left;\n            });\n        }\n        function extractChatLatestLabel(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const label = formatMaybeTimestamp(value);\n                if (label) {\n                    return label;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (!fallback) {\n                return '';\n            }\n            return fallback.replace(/\\.jsonl$/i, '');\n        }\n        let chatCacheToken = 0;\n        async function warmRecentChatCache(cards) {\n            if (sortKey.value !== 'recent') {\n                return;\n            }\n            const pending = cards.filter(card => {\n                if (card.origin !== 'tavern') {\n                    return false;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    return false;\n                }\n                return getLastChatAt(card) <= 0;\n            });\n            if (!pending.length) {\n                return;\n            }\n            const token = ++chatCacheToken;\n            for (const card of pending) {\n                if (token !== chatCacheToken || sortKey.value !== 'recent') {\n                    return;\n                }\n                if (card.origin !== 'tavern') {\n                    continue;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    continue;\n                }\n                const cached = getLastChatAt(card);\n                let brief = null;\n                try {\n                    brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n                if (Array.isArray(brief) && brief.length) {\n                    const sorted = sortChatBrief(brief);\n                    const timestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n                    if (timestamp > cached) {\n                        updateLastChatCacheForCard(card, timestamp);\n                    }\n                }\n                await sleep(80);\n            }\n        }\n        function warmImportCache(cards) {\n            const next = { ...importCache.value };\n            let changed = false;\n            const now = Date.now();\n            cards.forEach((card, index) => {\n                if (card.origin !== 'tavern') {\n                    return;\n                }\n                if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                    return;\n                }\n                const key = getChatCacheKey(card);\n                if (!key || next[key]) {\n                    return;\n                }\n                next[key] = now - (cards.length - 1 - index) * 1000;\n                changed = true;\n            });\n            if (changed) {\n                updateImportCache(next);\n            }\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharactersWithNotes(characters);\n                const library = await loadLibrary();\n                setLibrary(library);\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }]),\n                style: _normalizeStyle(themeStyle.value)\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[70] || (_cache[70] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-theme-trigger\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: openThemeDialog\n                            }, [...(_cache[67] || (_cache[67] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"fa-solid fa-palette\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-settings-trigger\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: openSettingsDialog\n                            }, [...(_cache[68] || (_cache[68] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"fa-solid fa-gear\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: close\n                            }, [...(_cache[69] || (_cache[69] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: _cache[1] || (_cache[1] =\n                                //@ts-ignore\n                                (...args) => (_unref(triggerImport) && _unref(triggerImport)(...args)))\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: _cache[2] || (_cache[2] =\n                                //@ts-ignore\n                                (...args) => (_unref(exportSelected) && _unref(exportSelected)(...args)))\n                        }, \"\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: _cache[3] || (_cache[3] =\n                                //@ts-ignore\n                                (...args) => (_unref(handleImportFiles) && _unref(handleImportFiles)(...args)))\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"div\", _hoisted_6, [\n                                    _cache[71] || (_cache[71] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                            type: \"button\",\n                                            onClick: _cache[4] || (_cache[4] = ($event) => (statusFilter.value = 'all'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[5] || (_cache[5] = ($event) => (statusFilter.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[6] || (_cache[6] = ($event) => (statusFilter.value = 'unimported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'duplicate' }]),\n                                            type: \"button\",\n                                            onClick: _cache[7] || (_cache[7] = ($event) => (statusFilter.value = 'duplicate'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': favoritesOnly.value }]),\n                                            type: \"button\",\n                                            onClick: _cache[8] || (_cache[8] = ($event) => (favoritesOnly.value = !favoritesOnly.value))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_8, [\n                                    _cache[72] || (_cache[72] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_9, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'recent' }]),\n                                            type: \"button\",\n                                            onClick: _cache[9] || (_cache[9] = ($event) => (sortKey.value = 'recent'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'name' }]),\n                                            type: \"button\",\n                                            onClick: _cache[10] || (_cache[10] = ($event) => (sortKey.value = 'name'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'tags' }]),\n                                            type: \"button\",\n                                            onClick: _cache[11] || (_cache[11] = ($event) => (sortKey.value = 'tags'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[12] || (_cache[12] = ($event) => (sortKey.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ])\n                            ]),\n                            _cache[73] || (_cache[73] = _createElementVNode(\"div\", { class: \"cardhub-divider\" }, null, -1 /* CACHED */)),\n                            _cache[74] || (_cache[74] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allTags), (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': _unref(selectedTags).includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (_unref(toggleTagFilter)(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_11));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (_unref(selectedTags).length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: _cache[13] || (_cache[13] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(clearTagFilter) && _unref(clearTagFilter)(...args)))\n                                }, \"  \"))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-chip cardhub-chip--more\",\n                                type: \"button\",\n                                onClick: _cache[14] || (_cache[14] = ($event) => (_unref(openTagManager)('filter')))\n                            }, \"  \")\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_12, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \"\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                        _createElementVNode(\"div\", _hoisted_16, [\n                                            (totalPages.value > 1)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value <= 1,\n                                                        onClick: prevPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_18),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value >= totalPages.value,\n                                                        onClick: nextPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_19)\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"span\", _hoisted_20, \" \" + _toDisplayString(currentPage.value) + \" / \" + _toDisplayString(totalPages.value) + \" \", 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_21, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedCharacters.value, (character) => {\n                                                return (_openBlock(), _createElementBlock(\"article\", {\n                                                    key: character.id,\n                                                    class: _normalizeClass([\"cardhub-card\", { 'is-duplicate': duplicateIdSet.value.has(character.id) }]),\n                                                    onClick: ($event) => (openManage(character))\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                        style: _normalizeStyle(avatarStyle(character))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                    ], 6 /* CLASS, STYLE */),\n                                                    _createElementVNode(\"div\", _hoisted_23, [\n                                                        _createElementVNode(\"div\", _hoisted_24, [\n                                                            _createElementVNode(\"div\", _hoisted_25, _toDisplayString(character.name), 1 /* TEXT */),\n                                                            _createElementVNode(\"button\", {\n                                                                class: _normalizeClass([\"cardhub-fav\", { 'is-active': isFavorite(character.id) }]),\n                                                                type: \"button\",\n                                                                \"aria-label\": \"\",\n                                                                onClick: _withModifiers(($event) => (toggleFavorite(character)), [\"stop\"])\n                                                            }, [...(_cache[75] || (_cache[75] = [\n                                                                    _createElementVNode(\"i\", {\n                                                                        class: \"fa-solid fa-star\",\n                                                                        \"aria-hidden\": \"true\"\n                                                                    }, null, -1 /* CACHED */)\n                                                                ]))], 10 /* CLASS, PROPS */, _hoisted_26)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_27, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" \", 1 /* TEXT */)\n                                                        ]),\n                                                        (showNoteSummary.value && displayNote(character))\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_28, _toDisplayString(displayNote(character)), 1 /* TEXT */))\n                                                            : _createCommentVNode(\"v-if\", true),\n                                                        _createElementVNode(\"div\", _hoisted_29, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-tag\",\n                                                                    type: \"button\",\n                                                                    title: \"\",\n                                                                    onClick: _withModifiers(($event) => (_unref(removeTag)(character, tag)), [\"stop\"])\n                                                                }, [\n                                                                    _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                    _cache[76] || (_cache[76] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"\", -1 /* CACHED */))\n                                                                ], 8 /* PROPS */, _hoisted_30));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (_unref(activeTagKey) !== _unref(tagKey)(character))\n                                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: 0,\n                                                                    class: \"cardhub-tag is-add\",\n                                                                    type: \"button\",\n                                                                    onClick: _withModifiers(($event) => (_unref(startTagEdit)(character)), [\"stop\"])\n                                                                }, \" +  \", 8 /* PROPS */, _hoisted_31))\n                                                                : (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: 1,\n                                                                    class: \"cardhub-tag-edit\",\n                                                                    onClick: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onMousedown: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onTouchstart: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"]))\n                                                                }, [\n                                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                                        \"onUpdate:modelValue\": _cache[15] || (_cache[15] = ($event) => (_isRef(tagInput) ? (tagInput).value = $event : null)),\n                                                                        class: \"cardhub-tag-input\",\n                                                                        type: \"text\",\n                                                                        placeholder: \"\",\n                                                                        onKeydown: [\n                                                                            _withKeys(_withModifiers(($event) => (_unref(confirmTag)(character)), [\"prevent\"]), [\"enter\"]),\n                                                                            _cache[16] || (_cache[16] = _withKeys(_withModifiers(\n                                                                            //@ts-ignore\n                                                                            (...args) => (_unref(cancelTagEdit) && _unref(cancelTagEdit)(...args)), [\"prevent\"]), [\"esc\"]))\n                                                                        ],\n                                                                        onBlur: ($event) => (_unref(confirmTag)(character))\n                                                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_32), [\n                                                                        [_vModelText, _unref(tagInput)]\n                                                                    ]),\n                                                                    _createElementVNode(\"button\", {\n                                                                        class: \"cardhub-tag-confirm\",\n                                                                        type: \"button\",\n                                                                        onClick: ($event) => (_unref(confirmTag)(character))\n                                                                    }, \"\", 8 /* PROPS */, _hoisted_33)\n                                                                ], 32 /* NEED_HYDRATION */))\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_34, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action is-secondary\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (_unref(handleCardAction)(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[20] || (_cache[20] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[22] || (_cache[22] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, _toDisplayString(character.origin === 'tavern' ? '' : ''), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_35),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[24] || (_cache[24] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[25] || (_cache[25] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_36)\n                                                    ])\n                                                ], 10 /* CLASS, PROPS */, _hoisted_22));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                        ])\n                    ])\n                ]),\n                _createVNode(ManageModal, {\n                    card: manageCard.value,\n                    \"display-tags\": displayTags,\n                    \"handle-card-action\": _unref(handleCardAction),\n                    \"manage-delete\": _unref(manageDelete),\n                    \"close-manage\": closeManage,\n                    \"close-root\": close,\n                    \"apply-note-update\": applyNoteUpdate,\n                    \"parse-library-card-data\": parseLibraryCardData,\n                    \"update-last-chat-cache-for-card\": updateLastChatCacheForCard\n                }, null, 8 /* PROPS */, [\"card\", \"handle-card-action\", \"manage-delete\"]),\n                (confirmState.open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-confirm cardhub-modal\",\n                        onClick: _cache[29] || (_cache[29] = _withModifiers(($event) => (resolveConfirm('cancel')), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_37, [\n                            _createElementVNode(\"div\", _hoisted_38, _toDisplayString(confirmState.title), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_39, _toDisplayString(confirmState.message), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_40, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-cancel\",\n                                    type: \"button\",\n                                    onClick: _cache[26] || (_cache[26] = ($event) => (resolveConfirm('cancel')))\n                                }, _toDisplayString(confirmState.cancelLabel), 1 /* TEXT */),\n                                (confirmState.altLabel)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"cardhub-confirm__button is-danger\",\n                                        type: \"button\",\n                                        onClick: _cache[27] || (_cache[27] = ($event) => (resolveConfirm('alt')))\n                                    }, _toDisplayString(confirmState.altLabel), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-confirm\",\n                                    type: \"button\",\n                                    onClick: _cache[28] || (_cache[28] = ($event) => (resolveConfirm('confirm')))\n                                }, _toDisplayString(confirmState.confirmLabel), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(tagManagerOpen))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-tag-manager cardhub-modal\",\n                        onClick: _cache[41] || (_cache[41] = _withModifiers(\n                        //@ts-ignore\n                        (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_41, [\n                            _createElementVNode(\"div\", _hoisted_42, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[77] || (_cache[77] = _createElementVNode(\"div\", { class: \"cardhub-tag-manager__title\" }, \"\", -1 /* CACHED */)),\n                                    (_unref(tagManagerTab) === 'filter')\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_43, \"  \" + _toDisplayString(_unref(selectedTags).length) + \" / \" + _toDisplayString(_unref(allTags).length), 1 /* TEXT */))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_44, \"  \" + _toDisplayString(_unref(batchTagSelectedIds).length) + \" / \" + _toDisplayString(_unref(batchTagVisibleCandidates).length), 1 /* TEXT */))\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: _cache[30] || (_cache[30] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_45, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-tag-manager__tab\", { 'is-active': _unref(tagManagerTab) === 'filter' }]),\n                                    type: \"button\",\n                                    onClick: _cache[31] || (_cache[31] = ($event) => (_unref(openTagManager)('filter')))\n                                }, \"  \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-tag-manager__tab\", { 'is-active': _unref(tagManagerTab) === 'batch' }]),\n                                    type: \"button\",\n                                    onClick: _cache[32] || (_cache[32] = ($event) => (_unref(openTagManager)('batch')))\n                                }, \"  \", 2 /* CLASS */)\n                            ]),\n                            (_unref(tagManagerTab) === 'filter')\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_46, [\n                                    _createElementVNode(\"div\", _hoisted_47, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-tag-manager__btn is-secondary\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedTags).length,\n                                            onClick: _cache[33] || (_cache[33] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(clearTagFilter) && _unref(clearTagFilter)(...args)))\n                                        }, \"  \", 8 /* PROPS */, _hoisted_48),\n                                        _cache[78] || (_cache[78] = _createElementVNode(\"div\", { class: \"cardhub-tag-manager__spacer\" }, null, -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-tag-manager__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: _cache[34] || (_cache[34] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(closeTagManager) && _unref(closeTagManager)(...args)))\n                                        }, \"\")\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_49, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(allTags), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: tag,\n                                                class: _normalizeClass([\"cardhub-tag-manager__chip\", { 'is-active': _unref(selectedTags).includes(tag) }]),\n                                                type: \"button\",\n                                                onClick: ($event) => (_unref(toggleTagFilter)(tag))\n                                            }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_50));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_51, [\n                                    _createElementVNode(\"div\", _hoisted_52, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[35] || (_cache[35] = ($event) => (_isRef(batchTagSearch) ? (batchTagSearch).value = $event : null)),\n                                            class: \"cardhub-batch__search\",\n                                            type: \"search\",\n                                            placeholder: \"\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(batchTagSearch)]\n                                        ]),\n                                        _cache[79] || (_cache[79] = _createElementVNode(\"div\", { class: \"cardhub-batch__hint\" }, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_53, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[36] || (_cache[36] = ($event) => (_isRef(batchTagInput) ? (batchTagInput).value = $event : null)),\n                                            type: \"text\",\n                                            placeholder: \"/\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(batchTagInput)]\n                                        ])\n                                    ]),\n                                    (_unref(batchTagSuggestions).length)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_54, [\n                                            _cache[80] || (_cache[80] = _createElementVNode(\"span\", { class: \"cardhub-batch__suggest-title\" }, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_55, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchTagSuggestions), (tag) => {\n                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: tag,\n                                                        class: _normalizeClass([\"cardhub-batch__chip\", { 'is-active': _unref(batchTagSelectedTags).includes(tag) }]),\n                                                        type: \"button\",\n                                                        onClick: ($event) => (_unref(toggleBatchTagSuggestion)(tag))\n                                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_56));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createElementVNode(\"div\", _hoisted_57, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: _cache[37] || (_cache[37] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(selectAllBatchTags) && _unref(selectAllBatchTags)(...args)))\n                                        }, \"\"),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: _cache[38] || (_cache[38] =\n                                                //@ts-ignore\n                                                (...args) => (_unref(clearBatchTagSelection) && _unref(clearBatchTagSelection)(...args)))\n                                        }, \"\"),\n                                        _cache[81] || (_cache[81] = _createElementVNode(\"div\", { class: \"cardhub-batch__spacer\" }, null, -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-ghost\",\n                                            type: \"button\",\n                                            onClick: _cache[39] || (_cache[39] = ($event) => (_unref(applyBatchTags)('remove')))\n                                        }, \"  \"),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-batch__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: _cache[40] || (_cache[40] = ($event) => (_unref(applyBatchTags)('add')))\n                                        }, \"\")\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_58, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchTagVisibleCandidates), (item) => {\n                                            return (_openBlock(), _createElementBlock(\"label\", {\n                                                key: item.id,\n                                                class: \"cardhub-batch__item\"\n                                            }, [\n                                                _createElementVNode(\"input\", {\n                                                    class: \"cardhub-batch__checkbox\",\n                                                    type: \"checkbox\",\n                                                    checked: _unref(batchTagSelectedSet).has(item.id),\n                                                    onChange: ($event) => (_unref(toggleBatchTagSelection)(item.id))\n                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_59),\n                                                _createElementVNode(\"div\", _hoisted_60, [\n                                                    _createElementVNode(\"div\", _hoisted_61, _toDisplayString(item.name), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_62, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                                    ]),\n                                                    (displayTags(item).length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_63, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-batch__tag\"\n                                                                }, _toDisplayString(tag), 1 /* TEXT */));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]))\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(exportDialogOpen))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"cardhub-export cardhub-modal\",\n                        onClick: _withModifiers(closeExportDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_64, [\n                            _createElementVNode(\"div\", _hoisted_65, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[82] || (_cache[82] = _createElementVNode(\"div\", { class: \"cardhub-export__title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_66, \"  \" + _toDisplayString(_unref(exportSelectedItems).length) + \" / \" + _toDisplayString(_unref(exportVisibleCandidates).length), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_67, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[42] || (_cache[42] = ($event) => (_isRef(exportSearch) ? (exportSearch).value = $event : null)),\n                                    class: \"cardhub-export__search\",\n                                    type: \"search\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(exportSearch)]\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_68, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'all' }]),\n                                        type: \"button\",\n                                        onClick: _cache[43] || (_cache[43] = ($event) => (exportStatusFilter.value = 'all'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'imported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[44] || (_cache[44] = ($event) => (exportStatusFilter.value = 'imported'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportStatusFilter) === 'unimported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[45] || (_cache[45] = ($event) => (exportStatusFilter.value = 'unimported'))\n                                    }, \"  \", 2 /* CLASS */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_69, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(exportAllTags), (tag) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: tag,\n                                            class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': _unref(exportTagFilters).includes(tag) }]),\n                                            type: \"button\",\n                                            onClick: ($event) => (toggleExportTagFilter(tag))\n                                        }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_70));\n                                    }), 128 /* KEYED_FRAGMENT */)),\n                                    (_unref(exportTagFilters).length)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"cardhub-export__chip cardhub-export__chip--clear\",\n                                            type: \"button\",\n                                            onClick: clearExportTagFilter\n                                        }, \"  \"))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_71, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[46] || (_cache[46] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(selectAllExport) && _unref(selectAllExport)(...args)))\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[47] || (_cache[47] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(clearExportSelection) && _unref(clearExportSelection)(...args)))\n                                }, \"\"),\n                                _cache[83] || (_cache[83] = _createElementVNode(\"div\", { class: \"cardhub-export__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[48] || (_cache[48] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(confirmExportSelected) && _unref(confirmExportSelected)(...args)))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_72, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(exportVisibleCandidates), (item) => {\n                                    return (_openBlock(), _createElementBlock(\"label\", {\n                                        key: item.id,\n                                        class: \"cardhub-export__item\"\n                                    }, [\n                                        _createElementVNode(\"input\", {\n                                            class: \"cardhub-export__checkbox\",\n                                            type: \"checkbox\",\n                                            checked: _unref(isExportSelected)(item.id),\n                                            onChange: ($event) => (_unref(toggleExportSelection)(item.id))\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_73),\n                                        _createElementVNode(\"div\", _hoisted_74, [\n                                            _createElementVNode(\"div\", _hoisted_75, _toDisplayString(item.name), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_76, [\n                                                _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                            ]),\n                                            (displayTags(item).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_77, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                        return (_openBlock(), _createElementBlock(\"span\", {\n                                                            key: tag,\n                                                            class: \"cardhub-export__tag\"\n                                                        }, _toDisplayString(tag), 1 /* TEXT */));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (settingsDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"cardhub-settings cardhub-modal\",\n                        onClick: _withModifiers(closeSettingsDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_78, [\n                            _createElementVNode(\"div\", { class: \"cardhub-settings__header\" }, [\n                                _cache[84] || (_cache[84] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"cardhub-settings__title\" }, \"\"),\n                                    _createElementVNode(\"div\", { class: \"cardhub-settings__subtitle\" }, \"\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeSettingsDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_79, [\n                                _cache[88] || (_cache[88] = _createElementVNode(\"div\", { class: \"cardhub-settings__label\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_80, \" \" + _toDisplayString(storageModeCurrentLabel.value) + \" \", 1 /* TEXT */),\n                                _createElementVNode(\"div\", _hoisted_81, [\n                                    _createElementVNode(\"label\", {\n                                        class: _normalizeClass([\"cardhub-settings__option\", { 'is-active': storageModeDraft.value === 'variables' }])\n                                    }, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[49] || (_cache[49] = ($event) => ((storageModeDraft).value = $event)),\n                                            type: \"radio\",\n                                            value: \"variables\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelRadio, storageModeDraft.value]\n                                        ]),\n                                        _cache[85] || (_cache[85] = _createElementVNode(\"div\", { class: \"cardhub-settings__option-body\" }, [\n                                            _createElementVNode(\"div\", { class: \"cardhub-settings__option-title\" }, \"\"),\n                                            _createElementVNode(\"div\", { class: \"cardhub-settings__option-desc\" }, \"\")\n                                        ], -1 /* CACHED */))\n                                    ], 2 /* CLASS */),\n                                    _createElementVNode(\"label\", {\n                                        class: _normalizeClass([\"cardhub-settings__option\", { 'is-active': storageModeDraft.value === 'indexeddb', 'is-disabled': !indexedDbAvailable.value }])\n                                    }, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[50] || (_cache[50] = ($event) => ((storageModeDraft).value = $event)),\n                                            type: \"radio\",\n                                            value: \"indexeddb\",\n                                            disabled: !indexedDbAvailable.value\n                                        }, null, 8 /* PROPS */, _hoisted_82), [\n                                            [_vModelRadio, storageModeDraft.value]\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_83, [\n                                            _cache[86] || (_cache[86] = _createElementVNode(\"div\", { class: \"cardhub-settings__option-title\" }, \" IndexedDB\", -1 /* CACHED */)),\n                                            _cache[87] || (_cache[87] = _createElementVNode(\"div\", { class: \"cardhub-settings__option-desc\" }, \"  \", -1 /* CACHED */)),\n                                            (!indexedDbAvailable.value)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_84, \"\"))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ], 2 /* CLASS */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_85, [\n                                _cache[97] || (_cache[97] = _createElementVNode(\"div\", { class: \"cardhub-settings__label\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_86, [\n                                    _createElementVNode(\"label\", _hoisted_87, [\n                                        _cache[90] || (_cache[90] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": _cache[51] || (_cache[51] = ($event) => ((uiSettingsDraft.pageSize) = $event)),\n                                            class: \"cardhub-settings__select\"\n                                        }, [...(_cache[89] || (_cache[89] = [\n                                                _createElementVNode(\"option\", { value: 12 }, \"12\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 24 }, \"24\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 36 }, \"36\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 48 }, \"48\", -1 /* CACHED */)\n                                            ]))], 512 /* NEED_PATCH */), [\n                                            [\n                                                _vModelSelect,\n                                                uiSettingsDraft.pageSize,\n                                                void 0,\n                                                { number: true }\n                                            ]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_88, [\n                                        _cache[91] || (_cache[91] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[52] || (_cache[52] = ($event) => ((uiSettingsDraft.showNoteSummary) = $event)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, uiSettingsDraft.showNoteSummary]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_89, [\n                                        _cache[93] || (_cache[93] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": _cache[53] || (_cache[53] = ($event) => ((uiSettingsDraft.tagRows) = $event)),\n                                            class: \"cardhub-settings__select\"\n                                        }, [...(_cache[92] || (_cache[92] = [\n                                                _createElementVNode(\"option\", { value: 1 }, \"1\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 2 }, \"2\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 3 }, \"3\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: 4 }, \"4\", -1 /* CACHED */)\n                                            ]))], 512 /* NEED_PATCH */), [\n                                            [\n                                                _vModelSelect,\n                                                uiSettingsDraft.tagRows,\n                                                void 0,\n                                                { number: true }\n                                            ]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_90, [\n                                        _cache[95] || (_cache[95] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": _cache[54] || (_cache[54] = ($event) => ((uiSettingsDraft.avatarSize) = $event)),\n                                            class: \"cardhub-settings__select\"\n                                        }, [...(_cache[94] || (_cache[94] = [\n                                                _createElementVNode(\"option\", { value: \"sm\" }, \"\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"md\" }, \"\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"lg\" }, \"\", -1 /* CACHED */)\n                                            ]))], 512 /* NEED_PATCH */), [\n                                            [_vModelSelect, uiSettingsDraft.avatarSize]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_91, [\n                                        _cache[96] || (_cache[96] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[55] || (_cache[55] = ($event) => ((uiSettingsDraft.syncTavernTags) = $event)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, uiSettingsDraft.syncTavernTags]\n                                        ])\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_92, [\n                                _cache[100] || (_cache[100] = _createElementVNode(\"div\", { class: \"cardhub-settings__label\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_93, [\n                                    _createElementVNode(\"label\", _hoisted_94, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[56] || (_cache[56] = ($event) => ((uiSettingsDraft.exportFormat) = $event)),\n                                            type: \"radio\",\n                                            value: \"png\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelRadio, uiSettingsDraft.exportFormat]\n                                        ]),\n                                        _cache[98] || (_cache[98] = _createElementVNode(\"span\", null, \"PNG\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_95, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[57] || (_cache[57] = ($event) => ((uiSettingsDraft.exportFormat) = $event)),\n                                            type: \"radio\",\n                                            value: \"json\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelRadio, uiSettingsDraft.exportFormat]\n                                        ]),\n                                        _cache[99] || (_cache[99] = _createElementVNode(\"span\", null, \"JSON\", -1 /* CACHED */))\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_96, [\n                                _cache[101] || (_cache[101] = _createElementVNode(\"div\", { class: \"cardhub-settings__label\" }, \"\", -1 /* CACHED */)),\n                                _cache[102] || (_cache[102] = _createElementVNode(\"div\", { class: \"cardhub-settings__hint\" }, \" JSON \", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_97, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-settings__btn is-secondary\",\n                                        type: \"button\",\n                                        onClick: exportLibraryBackup\n                                    }, \"  \"),\n                                    _createElementVNode(\"button\", {\n                                        class: \"cardhub-settings__btn is-secondary\",\n                                        type: \"button\",\n                                        onClick: triggerBackupImport\n                                    }, \"  \"),\n                                    _createElementVNode(\"input\", {\n                                        ref_key: \"backupImportInput\",\n                                        ref: backupImportInput,\n                                        class: \"cardhub-import-input\",\n                                        type: \"file\",\n                                        accept: \".json\",\n                                        onChange: handleBackupImport\n                                    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_98, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-settings__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeSettingsDialog\n                                }, \"\"),\n                                _cache[103] || (_cache[103] = _createElementVNode(\"div\", { class: \"cardhub-settings__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-settings__btn is-primary\",\n                                    type: \"button\",\n                                    disabled: (!storageModeDirty.value && !uiSettingsDirty.value) || storageSaveBusy.value,\n                                    onClick: saveSettingsDialog\n                                }, _toDisplayString(storageSaveBusy.value ? '...' : ''), 9 /* TEXT, PROPS */, _hoisted_99)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (themeDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"cardhub-theme cardhub-modal\",\n                        onClick: _withModifiers(closeThemeDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_100, [\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__header\" }, [\n                                _cache[104] || (_cache[104] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__title\" }, \"\"),\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__subtitle\" }, \"\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_101, [\n                                _createElementVNode(\"label\", _hoisted_102, [\n                                    _cache[105] || (_cache[105] = _createElementVNode(\"span\", null, \" 1\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[58] || (_cache[58] = ($event) => ((themeDraft.bgStart) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgStart]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_103, [\n                                    _cache[106] || (_cache[106] = _createElementVNode(\"span\", null, \" 2\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[59] || (_cache[59] = ($event) => ((themeDraft.bgEnd) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgEnd]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_104, [\n                                    _cache[107] || (_cache[107] = _createElementVNode(\"span\", null, \"/\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[60] || (_cache[60] = ($event) => ((themeDraft.surface) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surface]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_105, [\n                                    _cache[108] || (_cache[108] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[61] || (_cache[61] = ($event) => ((themeDraft.surfaceAlt) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surfaceAlt]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_106, [\n                                    _cache[109] || (_cache[109] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[62] || (_cache[62] = ($event) => ((themeDraft.text) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.text]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_107, [\n                                    _cache[110] || (_cache[110] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[63] || (_cache[63] = ($event) => ((themeDraft.textMuted) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.textMuted]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_108, [\n                                    _cache[111] || (_cache[111] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[64] || (_cache[64] = ($event) => ((themeDraft.accent) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accent]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_109, [\n                                    _cache[112] || (_cache[112] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[65] || (_cache[65] = ($event) => ((themeDraft.accentStrong) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accentStrong]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_110, [\n                                    _cache[113] || (_cache[113] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[66] || (_cache[66] = ($event) => ((themeDraft.border) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.border]\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_111, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(themePresets, (preset) => {\n                                    return _createElementVNode(\"button\", {\n                                        key: preset.name,\n                                        class: \"cardhub-theme__preset\",\n                                        type: \"button\",\n                                        onClick: ($event) => (applyThemePreset(preset))\n                                    }, _toDisplayString(preset.name), 9 /* TEXT, PROPS */, _hoisted_112);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__actions\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: resetThemeDraft\n                                }, \"\"),\n                                _cache[114] || (_cache[114] = _createElementVNode(\"div\", { class: \"cardhub-theme__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveThemeDraft\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 6 /* CLASS, STYLE */));\n        };\n    }\n});\n","import { computed, ref, type ComputedRef } from 'vue';\nimport type { CardHubItem } from '../../types';\n\nexport function useTagFilters(allCards: ComputedRef<CardHubItem[]>, getTags: (card: CardHubItem) => string[]) {\n  const selectedTags = ref<string[]>([]);\n\n  const allTags = computed(() => {\n    const tagSet = new Set<string>();\n    allCards.value.forEach(card => {\n      getTags(card).forEach(tag => tagSet.add(tag));\n    });\n    selectedTags.value.forEach(tag => tagSet.add(tag));\n    return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n  });\n\n  function applyTagFilter(list: CardHubItem[]): CardHubItem[] {\n    if (!selectedTags.value.length) {\n      return list;\n    }\n    return list.filter(card => selectedTags.value.some(tag => getTags(card).includes(tag)));\n  }\n\n  function toggleTagFilter(tag: string) {\n    if (selectedTags.value.includes(tag)) {\n      selectedTags.value = selectedTags.value.filter(item => item !== tag);\n    } else {\n      selectedTags.value = [...selectedTags.value, tag];\n    }\n  }\n\n  function clearTagFilter() {\n    selectedTags.value = [];\n  }\n\n  return {\n    selectedTags,\n    allTags,\n    applyTagFilter,\n    toggleTagFilter,\n    clearTagFilter,\n  };\n}\n","import { nextTick, ref } from 'vue';\nimport type { CardHubItem } from '../../types';\n\ntype TagEditingOptions = {\n  getTags: (card: CardHubItem) => string[];\n  applyTagUpdate: (card: CardHubItem, tags: string[]) => void;\n};\n\nexport function useTagEditing(options: TagEditingOptions) {\n  const activeTagKey = ref<string | null>(null);\n  const tagInput = ref('');\n\n  function tagKey(character: CardHubItem): string {\n    return character.id;\n  }\n\n  function startTagEdit(character: CardHubItem) {\n    activeTagKey.value = tagKey(character);\n    tagInput.value = '';\n    nextTick(() => {\n      const input = document.querySelector<HTMLInputElement>('.cardhub-tag-input');\n      input?.focus();\n    });\n  }\n\n  function cancelTagEdit() {\n    activeTagKey.value = null;\n    tagInput.value = '';\n  }\n\n  function confirmTag(character: CardHubItem) {\n    if (activeTagKey.value !== tagKey(character)) {\n      return;\n    }\n    const input = tagInput.value.trim();\n    if (input) {\n      const nextTags = [...options.getTags(character), input];\n      options.applyTagUpdate(character, nextTags);\n    }\n    cancelTagEdit();\n  }\n\n  function removeTag(character: CardHubItem, tag: string) {\n    const nextTags = options.getTags(character).filter(item => item !== tag);\n    options.applyTagUpdate(character, nextTags);\n  }\n\n  return {\n    tagKey,\n    activeTagKey,\n    tagInput,\n    startTagEdit,\n    cancelTagEdit,\n    confirmTag,\n    removeTag,\n  };\n}\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { cardHubState } from '../state/store';\nimport App from '../ui/App.vue';\nimport { cardHubStyles } from './portal.styles';\n\nexport type PortalMount = {\n  app: ReturnType<typeof createApp>;\n  mount: JQuery<HTMLDivElement>;\n  style: JQuery<HTMLElement>;\n};\n\nexport function createPortalMount(): PortalMount {\n  const style = $(`<style>`).attr('data-cardhub-style', getScriptId()).text(cardHubStyles).appendTo('head');\n  const mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  const app = createApp(App);\n\n  app.mount(mount[0]);\n\n  watch(\n    () => cardHubState.open,\n    () => {},\n    { immediate: true },\n  );\n\n  return { app, mount, style };\n}\n\nexport function destroyPortalMount(portal: PortalMount) {\n  portal.app.unmount();\n  portal.mount.remove();\n  portal.style.remove();\n}\n","export const cardHubStyles = `\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-settings-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-settings-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-settings-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.75) 100%\n        );\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow:\n          0 8px 18px rgba(var(--cardhub-accent-rgb), 0.25),\n          inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.82) 100%\n        );\n        color: var(--cardhub-accent-text);\n        box-shadow:\n          0 10px 22px rgba(var(--cardhub-accent-rgb), 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.65);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.75);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-settings__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 2px;\n        width: 100%;\n        background: linear-gradient(\n          90deg,\n          rgba(var(--cardhub-border-rgb), 0) 0%,\n          rgba(var(--cardhub-border-rgb), 0.7) 50%,\n          rgba(var(--cardhub-border-rgb), 0) 100%\n        );\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        font-weight: 600;\n      }\n\n      .cardhub-section-title::before {\n        content: \"\";\n        width: 10px;\n        height: 10px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-accent-rgb), 0.6);\n        box-shadow:\n          0 0 0 2px rgba(var(--cardhub-accent-rgb), 0.2),\n          0 4px 8px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-border-rgb), 0.18),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.2),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.45);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-root {\n        --cardhub-tag-row-height: 28px;\n        --cardhub-tag-row-gap: 6px;\n        --cardhub-tag-row-padding: 20px;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.55);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.65);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.45);\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.2) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.95) 100%\n        );\n        color: var(--cardhub-accent-strong);\n        box-shadow:\n          0 8px 16px rgba(var(--cardhub-accent-rgb), 0.18),\n          inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.28) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.98) 100%\n        );\n        border-color: rgba(var(--cardhub-accent-rgb), 0.6);\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-filter-block + .cardhub-filter-block {\n        margin-top: 10px;\n        padding-top: 10px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card.is-duplicate {\n        border-color: rgba(200, 110, 80, 0.75);\n        box-shadow:\n          0 12px 20px rgba(200, 110, 80, 0.18),\n          inset 0 0 0 1px rgba(200, 110, 80, 0.25);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: var(--cardhub-avatar-size, 42px);\n        height: var(--cardhub-avatar-size, 42px);\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__note {\n        margin-top: 6px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        word-break: break-word;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow:\n          0 10px 22px rgba(43, 32, 24, 0.22),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.35);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow:\n          0 10px 20px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__name {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-note-trigger {\n        border: none;\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-note-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-note-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200100;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__overview-action {\n        justify-self: start;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-head {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-edit {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        margin-top: 2px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-manage__detail-edit:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-manage__detail-edit:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__detail-toggle {\n        justify-self: end;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 2px 0;\n      }\n\n      .cardhub-manage__toggle {\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.6);\n        box-shadow:\n          0 8px 18px rgba(43, 32, 24, 0.22),\n          inset 0 1px 0 rgba(255, 255, 255, 0.25);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 1) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.82) 100%\n        );\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 1);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__panel {\n        width: min(720px, 92vw);\n        max-width: 720px;\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-openings {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200300;\n      }\n\n      .cardhub-worldbook {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200310;\n      }\n\n      .cardhub-worldbook__panel {\n        width: min(720px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-worldbook__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-worldbook__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-worldbook__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-worldbook__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-worldbook__item-title {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        flex-wrap: wrap;\n      }\n\n      .cardhub-worldbook__item-index {\n        font-size: 11px;\n        padding: 2px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.15);\n        color: var(--cardhub-text-muted);\n        white-space: nowrap;\n      }\n\n      .cardhub-worldbook__item-name {\n        font-weight: 600;\n        color: var(--cardhub-text);\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        max-width: 100%;\n      }\n\n      .cardhub-worldbook__item-strategy {\n        font-size: 11px;\n        padding: 2px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.12);\n        color: var(--cardhub-text-muted);\n        white-space: nowrap;\n      }\n\n      .cardhub-worldbook__item-strategy.is-constant {\n        background: rgba(38, 110, 207, 0.16);\n        color: #2d6bd6;\n      }\n\n      .cardhub-worldbook__item-strategy.is-selective {\n        background: rgba(46, 159, 83, 0.16);\n        color: #2f8f54;\n      }\n\n      .cardhub-worldbook__item-strategy.is-vectorized {\n        background: rgba(130, 106, 224, 0.16);\n        color: #6f5bd1;\n      }\n\n      .cardhub-worldbook__item-disabled {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__item-preview {\n        margin-top: 4px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n        margin-bottom: 6px;\n      }\n\n      .cardhub-openings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-openings__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 10px;\n      }\n\n      .cardhub-openings__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-openings__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-openings__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-openings__item-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-openings__item-preview {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-meta {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 8px;\n      }\n\n      .cardhub-manage__opening-meta-value {\n        color: var(--cardhub-text);\n        font-weight: 600;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-manage__opening-body {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-toggle {\n        margin-top: 6px;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__pager {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        margin-top: 8px;\n      }\n\n      .cardhub-manage__pager-btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__pager-btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-manage__pager-status {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200800;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-root .cardhub-modal {\n        position: fixed !important;\n        inset: 0 !important;\n        display: grid !important;\n        place-items: center !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        height: 100dvh !important;\n      }\n\n      .cardhub-root .cardhub-modal__panel {\n        position: fixed !important;\n        left: 50vw !important;\n        top: 50vh !important;\n        transform: translate(-50%, -50%) !important;\n        margin: 0 !important;\n      }\n\n      .cardhub-note {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200900;\n      }\n\n      .cardhub-settings {\n        z-index: 200700;\n      }\n\n      .cardhub-settings__panel {\n        z-index: 200701;\n      }\n\n      .cardhub-note__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-note__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-note__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-note__input {\n        width: 100%;\n        min-height: 120px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-note__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-note__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-note__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-edit {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200900;\n      }\n\n      .cardhub-edit__panel {\n        width: min(540px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-edit__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-edit__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-edit__input {\n        width: 100%;\n        min-height: 140px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-edit__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-edit__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-edit__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-manage-viewer {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200200;\n      }\n\n      .cardhub-manage-viewer__panel {\n        width: min(620px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 24px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        position: relative;\n        display: grid;\n        gap: 12px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage-viewer__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-manage-viewer__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-manage-viewer__content {\n        font-size: 13px;\n        line-height: 1.6;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-note__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-note__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-edit__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-edit__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200400;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200500;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        z-index: 200600;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type='color'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-settings__panel {\n        width: min(560px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-settings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-settings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-settings__section {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-settings__label {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__hint {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.5;\n      }\n\n      .cardhub-settings__options {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-settings__options--compact {\n        gap: 8px;\n      }\n\n      .cardhub-settings__row {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 10px;\n        padding: 8px 10px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-rgb), 0.75);\n        font-size: 12px;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__select {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__toggle input {\n        appearance: none;\n        width: 18px;\n        height: 18px;\n        border-radius: 6px;\n        border: 2px solid rgba(var(--cardhub-accent-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        display: grid;\n        place-items: center;\n        cursor: pointer;\n        transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;\n      }\n\n      .cardhub-settings__toggle input:checked {\n        background: rgba(var(--cardhub-accent-rgb), 0.9);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.9);\n        box-shadow: 0 6px 12px rgba(var(--cardhub-accent-rgb), 0.25);\n      }\n\n      .cardhub-settings__toggle input:checked::after {\n        content: '';\n        width: 8px;\n        height: 8px;\n        border-radius: 4px;\n        background: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-settings__radio {\n        gap: 6px;\n        justify-content: flex-start;\n      }\n\n      .cardhub-settings__option {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: flex-start;\n        padding: 10px 12px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n        cursor: pointer;\n      }\n\n      .cardhub-settings__option.is-active {\n        border-color: rgba(var(--cardhub-accent-rgb), 0.75);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-accent-rgb), 0.4);\n      }\n\n      .cardhub-settings__option.is-disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .cardhub-settings__option input {\n        margin-top: 2px;\n      }\n\n      .cardhub-settings__option-body {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-settings__option-title {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__option-desc {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n      }\n\n      .cardhub-settings__option-warn {\n        font-size: 11px;\n        color: #b94b3b;\n      }\n\n      .cardhub-settings__backup {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-settings__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-settings__spacer {\n        flex: 1;\n      }\n\n      .cardhub-settings__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-settings__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-settings__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-settings__btn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n        box-shadow: none;\n        transform: none;\n      }\n\n      .cardhub-settings__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-settings-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible,\n      .cardhub-settings__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: fixed !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-settings-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n          line-height: 1.2;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr;\n          gap: 10px;\n          align-items: start;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n          min-width: 0;\n          align-content: start;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: wrap;\n          overflow-y: auto;\n          overflow-x: hidden;\n          gap: 6px;\n          padding-bottom: 6px;\n          max-height: calc(\n            (var(--cardhub-tag-row-height, 28px) * var(--cardhub-tag-rows, 2)) +\n              (var(--cardhub-tag-row-gap, 6px) * (var(--cardhub-tag-rows, 2) - 1)) +\n              var(--cardhub-tag-row-padding, 20px)\n          );\n          align-content: flex-start;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-tag-filter::-webkit-scrollbar {\n          width: 4px;\n        }\n\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: var(--cardhub-avatar-size-mobile, 40px);\n          height: var(--cardhub-avatar-size-mobile, 40px);\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__note {\n          font-size: 10px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-edit {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__detail-toggle,\n        .cardhub-manage__toggle,\n        .cardhub-manage__opening-toggle {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__opening-title {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__opening-body {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__pager {\n          gap: 8px;\n        }\n\n        .cardhub-manage__pager-btn {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__pager-status {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-note__input {\n          min-height: 100px;\n          font-size: 12px;\n        }\n\n        .cardhub-edit__input {\n          min-height: 110px;\n          font-size: 12px;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type='color'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-settings__panel {\n          width: min(360px, 92vw);\n          padding: 14px;\n          gap: 12px;\n        }\n\n        .cardhub-settings__label {\n          font-size: 12px;\n        }\n\n        .cardhub-settings__hint {\n          font-size: 11px;\n        }\n\n        .cardhub-settings__option {\n          grid-template-columns: 1fr;\n          gap: 6px;\n        }\n\n        .cardhub-settings__option input {\n          margin: 0;\n        }\n\n        .cardhub-settings__option-title {\n          font-size: 12px;\n        }\n\n        .cardhub-settings__option-desc {\n          font-size: 11px;\n        }\n\n        .cardhub-settings__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-root .cardhub-modal {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: grid !important;\n          place-items: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root .cardhub-modal__panel {\n          position: fixed !important;\n          left: 50vw !important;\n          top: 50vh !important;\n          transform: translate(-50%, -50%) !important;\n          margin: 0 !important;\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n      }\n    `;\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport { createPortalMount, destroyPortalMount, type PortalMount } from './portal.mount';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet portal: PortalMount | null = null;\n\nfunction ensureMounted() {\n  if (!portal) {\n    portal = createPortalMount();\n  }\n}\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    const library = await loadLibrary();\n    setLibrary(library);\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (portal) {\n        destroyPortalMount(portal);\n      }\n      portal = null;\n    },\n  };\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$existing","$","length","addClass","attr","empty","$anchor","selectors","selector","$target","first","$button","filter","_","el","text","title","getAttribute","test","$container","closest","parent","findRoleManagerAnchor","console","warn","openOnce","createOpenOnce","open","on","event","preventDefault","stopImmediatePropagation","append","bindOpenEvents","off","remove","registerRoleManagerEntry","push","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","html","entryDisposer","data","setTimeout","observer","MutationObserver","rootDocument","window","document","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","target","handler","wrapped","addEventListener","capture","removeEventListener","lastFiredAt","now","Date","async","fetchCharacterSummaries","st","SillyTavern","undefined","ctx","getContext","getCharacters","error","list","characters","idCounts","Map","tagKeyCounts","tagIdToName","Array","isArray","tags","tag","id","name","set","map","character","index","directTags","avatarKey","avatar","createdRaw","create_date","date_added","created","created_at","timestamp","time","createdAt","coerceToTimestamp","stamp","String","tagBaseKey","tagKey","tagCount","get","hasTagKey","Boolean","tagMap","Object","prototype","hasOwnProperty","call","mappedTags","baseId","count","lastChatRaw","last_interaction","last_interaction_time","last_interaction_date","last_chat_time","last_chat_date","last_message_time","last_message_date","update_time","last_modified","origin","lastChatAt","value","Number","isNaN","parsed","parse","uuidv4","replace","c","r","Math","random","toString","GLOBAL_STATE_KEY","LEGACY_KEYS","library","theme","favorites","lastChatCache","importCache","notes","storageSettings","readVariables","TavernHelper","getVariables","type","writeVariables","vars","replaceVariables","loadGlobalState","raw","migrated","nextState","nextVars","values","key","updateGlobalState","patch","next","state","saveGlobalState","DEFAULT_SETTINGS","mode","loadStorageSettings","modeValue","normalizeSettings","saveStorageSettings","settings","STORE_NAME","LIBRARY_KEY","dbPromise","isIndexedDbAvailable","indexedDB","openDb","Promise","resolve","reject","request","onerror","onupgradeneeded","db","result","objectStoreNames","contains","createObjectStore","onsuccess","readLibraryFromVariables","entries","scriptVars","script_id","scriptRaw","writeLibraryToVariables","readLibraryFromStorage","transaction","objectStore","readLibraryFromIndexedDb","persistLibrary","modeOverride","put","writeLibraryToIndexedDb","readFileAsDataUrl","file","reader","FileReader","onload","readAsDataURL","readFileAsText","readAsText","parseJsonSafe","JSON","parseCardPayload","trimmed","trim","direct","isLikelyBase64","decoded","binary","atob","bytes","Uint8Array","i","charCodeAt","TextDecoder","decode","decodeBase64Text","extractCardTagsFromData","dataUrlToBytes","dataUrl","comma","indexOf","base64","slice","bytesToString","readUint32BE","offset","parseTextChunk","nullIndex","subarray","parseIntlTextChunk","compressed","cursor","langEnd","translatedEnd","extractPngTextChunks","signature","chunks","dataStart","dataEnd","entry","parsePngCardName","allowedKeys","Set","chunk","has","toLowerCase","parsePngCardTags","parseJsonCardTags","normalizeName","fileName","stableStringify","stringify","item","join","sort","a","b","localeCompare","val","buildFingerprint","rawType","source","hash","hashString","ensureFingerprint","fingerprint","normalizeLibraryEntriesInternal","stored","changed","normalized","note","tagsEdited","rawTags","normalizeLibraryEntries","loadLibrary","addToLibrary","files","existingEntries","from","current","fingerprints","add","nextEntries","endsWith","parsedName","parsedTags","importFileName","json","merged","parseLibraryBackup","mergeLibraryEntries","incoming","normalizedIncoming","removeFromLibrary","entryId","updated","Vue","cardHubState","reactive","loading","search","lastOpenSource","setOpen","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","hasKey","getTagMapEntry","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","tagIds","tagName","existing","crypto","randomUUID","ensureTag","saveSettingsDebounced","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","__name","props","manageCard","manageDetails","manageDetailsHint","openingItems","openingSummary","manageChats","pagedChats","chatPage","chatTotalPages","manageChatHint","openDetail","Function","openEdit","openOpeningList","openLatestChat","openNewChat","openChat","prevChatPage","nextChatPage","handleCardAction","manageDelete","setup","__props","_ctx","_cache","detail","label","onClick","$event","preview","args","hint","onPointerdown","onMousedown","onTouchstart","msg","role","tabindex","onKeydown","mes","disabled","manageAvatarUrl","manageOverview","displayTags","openNoteDialog","worldbookAvailable","openWorldbookList","src","alt","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","card","closeManage","closeRoot","applyNoteUpdate","parseLibraryCardData","updateLastChatCacheForCard","computed","manageOpenings","ref","manageWorldbookEntries","manageProfile","manageOpeningSummary","manageChatSummary","useFull","getCharAvatarPath","encodeURIComponent","avatarUrl","items","profile","worldName","worldBookName","worldCount","worldBookCount","worldValue","worldHint","chat","chatValue","chatHint","total","latest","details","pushDetail","maxChars","editable","field","previewDetailText","displayPreview","hasMore","full","canEdit","description","descriptionField","personality","scenario","creatorNotes","creatorNotesField","systemPrompt","postHistory","creator","opening","previewOpeningLines","renderOpeningHtml","alternate","hasData","worldbookName","worldbookEntries","worldbookLoadedName","worldbookLoading","worldbookError","worldbookOpen","worldbookPage","pickWorldbookKey","keys","normalizeWorldbookKeys","RegExp","inner","worldbookItems","pickString","comment","annotation","primary","strategy","keywords","secondary","keys_secondary","secondary_keys","content","lines","split","line","pickWorldbookContentTitle","resolveWorldbookTitle","strategyType","strategy_type","vectorized","use_vectorized","primaryKeys","secondaryKeys","resolveWorldbookStrategyType","uid","indexLabel","strategyLabel","enabled","worldbookTotalPages","max","ceil","pagedWorldbookItems","start","worldbookSummary","worldbookSummaryHint","openingPage","openingTotalPages","pagedOpenings","noteDialogOpen","noteDraft","editDialogOpen","editDialogTitle","editDraft","editField","editSaving","openingListOpen","viewerOpen","viewerTitle","viewerHtml","manageRequestId","getWorldbook","closeWorldbookList","prevWorldbookPage","nextWorldbookPage","closeOpeningList","prevOpeningPage","nextOpeningPage","closeNoteDialog","saveNoteDialog","openDetailViewer","textToHtml","closeViewer","openManage","requestId","manageResult","chatsResult","allSettled","resolveManageData","resolveRecentChats","manageData","status","openings","chatData","summary","extractOpeningMessages","extractCardProfile","extractOpeningSummary","extractWorldbookEntries","findIndex","byName","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","RawCharacter","allowAvatar","brief","getChatHistoryBrief","sorted","extractChatLatestTimestamp","sortChatBrief","latestTimestamp","formatChatTitle","formatChatFileLabel","file_name","file_id","normalizeBriefMessage","extractChatLatestLabel","toastr","warning","selectManageCharacter","ensureSelected","triggerSlash","selection","normalizeChatId","opener","openCharacterChat","catch","opened","timeoutMs","chatId","sleep","waitForChatOpen","options","targetName","normalizeNameKey","targetAvatar","normalizeAvatarKey","findCharacterIndex","selectCharacterById","switchMenu","selected","getCurrentCharacterId","waitForCharacterSelection","characterId","ms","toLocaleLowerCase","decodeURIComponent","includes","pop","hasField","resolveCreatorNotesField","creatorcomment","creator_notes","system_prompt","post_history_instructions","book","character_book","firstCount","alternate_greetings","extensions","maxLines","extractContentLines","chunkText","truncated","contentLines","combined","stripCodeFences","escapeHtml","part","filtered","startsWith","size","chat_name","chat_title","last_message_timestamp","pattern","match","year","month","day","hour","minute","second","getTime","parseTimestampFromText","openEditDialog","isEditableDetail","closeEditDialog","saveEditDialog","token","response","fetch","credentials","ok","fetchCsrfToken","basePayload","avatar_url","ch_name","method","headers","message","Error","success","watch","immediate","ManageOverview","ManageContent","placeholder","innerHTML","useBatchTags","tagManagerOpen","tagManagerTab","batchTagSelectedIds","batchTagSearch","batchTagInput","batchTagSelectedTags","batchTagCandidates","filteredCharacters","batchTagVisibleCandidates","keyword","some","batchTagSelectedSet","batchTagSuggestions","allTags","openTagManager","tab","closeTagManager","toggleBatchTagSelection","selectAllBatchTags","clearBatchTagSelection","toggleBatchTagSuggestion","applyBatchTags","input","parseBatchTags","actionLabel","openConfirm","confirmLabel","cancelLabel","cards","ids","allCards","getCardsByIds","currentTags","nextSet","delete","currentSet","every","isSameTagSet","applyTagUpdate","useLibraryActions","importInput","exportDialogOpen","exportSelectedIds","exportSearch","exportStatusFilter","exportTagFilters","exportCandidates","exportAllTags","tagSet","exportVisibleCandidates","exportSelectedSet","exportSelectedItems","openExportDialog","importLibraryCard","duplicate","findDuplicateCharacterByName","getRequestHeaders","beforeCharacters","beforeAvatarKeys","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","cache","expectedNames","matchedByAvatar","matchedByName","importedCard","getLibrary","cleanedTags","exportLibraryCard","downloadBlob","Blob","exportCard","getExportFormat","avatarPath","deleteFromTavern","deleteChats","targetIdx","currentId","nextIdx","payload","delete_chats","statusText","exportSelected","confirmExportSelected","tagLabel","selectedTags","statusLabel","statusFilter","searchLabel","stateSearch","isExportSelected","toggleExportSelection","selectAllExport","clearExportSelection","triggerImport","click","handleImportFiles","backupEntries","altLabel","deleteChoice","moveToLibrary","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94","_hoisted_95","_hoisted_96","_hoisted_97","_hoisted_98","_hoisted_99","_hoisted_100","_hoisted_101","_hoisted_102","_hoisted_103","_hoisted_104","_hoisted_105","_hoisted_106","_hoisted_107","_hoisted_108","_hoisted_109","_hoisted_110","_hoisted_111","_hoisted_112","pageSize","currentPage","confirmState","mergedTagsMap","resolveMergedTags","duplicateIdSet","duplicates","tavernNameSet","tavernAvatarSet","base","normalizeAvatarBase","libraryNameSet","libraryFileSet","normalizeFileBase","nameKey","avatarBase","fileBase","applyTagFilter","toggleTagFilter","clearTagFilter","getTags","useTagFilters","favoriteIds","favoriteSet","sortKey","favoritesOnly","noteMap","defaultTheme","bgStart","bgEnd","surface","surfaceAlt","textMuted","accent","accentStrong","border","themeDialogOpen","themeCurrent","themeDraft","themeStyle","avatarSize","uiSettingsCurrent","avatarDesktop","avatarMobile","hexToRgb","contrastTextColor","tagRows","settingsDialogOpen","storageModeCurrent","storageModeDraft","storageSaveBusy","indexedDbAvailable","storageModeLabels","variables","indexeddb","storageModeCurrentLabel","storageModeDirty","defaultUiSettings","showNoteSummary","exportFormat","syncTavernTags","uiSettingsDraft","uiSettingsDirty","backupImportInput","syncUiSettings","pageSizeValue","pageSizeNormalized","showNoteSummaryValue","exportFormatValue","tagRowsValue","normalizeUiSettings","uiSettings","assign","themePresets","applyFavoriteFilter","isLibraryItem","applyStatusFilter","sortCards","toRef","setCharactersWithNotes","updateCharacterTagsWithSetting","totalPages","pagedCharacters","avatarStyle","url","backgroundImage","resolveNoteForCard","candidates","namePart","baseName","buildNoteCandidates","displayNote","saveLastChatCache","getChatCacheKey","getImportAt","getLastChatAt","updateImportCache","toggleFavorite","withScore","lhs","rhs","aTime","bTime","aCreated","bCreated","hex","parseInt","rgb","g","channel","themeFrame","themeTimer","scheduleThemeApply","cancelAnimationFrame","clearTimeout","requestAnimationFrame","root","querySelector","getCardHubRoot","style","setProperty","applyTheme","loadThemeFromGlobal","pick","normalizeTheme","openThemeDialog","nextTick","closeThemeDialog","resetThemeDraft","saveThemeDraft","syncStorageSettings","openSettingsDialog","closeSettingsDialog","saveSettingsDialog","nextMode","prevMode","currentLibrary","exportLibraryBackup","toISOString","triggerBackupImport","handleBackupImport","clearExportTagFilter","closeExportDialog","prevPage","nextPage","applyNotesToCharacters","resolveConfirm","resolver","updateLibraryTags","deep","onMounted","getFavoriteList","fromEntries","loadLastChatCache","loadImportCache","loadNoteMap","warmRecentChatCache","warmImportCache","activeTagKey","tagInput","startTagEdit","cancelTagEdit","confirmTag","removeTag","focus","useTagEditing","nextNote","updatedLibrary","updateLibraryNote","getNoteStorageKey","nextMap","updatedCharacters","parsePngCardData","coerceTimestamp","left","chatCacheToken","pending","cached","URL","createObjectURL","createElement","href","download","appendChild","revokeObjectURL","refresh","close","ref_key","accept","multiple","onChange","onBlur","ManageModal","checked","number","preset","createPortalMount","appendTo","mount","app","createApp","App","portal","ensureMounted","createCardHubController","toggle","refreshCharacters","destroy","unmount","destroyPortalMount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}