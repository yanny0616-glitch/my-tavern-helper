{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js","webpack://tavern_helper_template/src//ui/App.vue?7ddf","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src//ui/App.vue?6083","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src//entry/buttons.ts","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src//services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src//services/libraryService.ts","src://tavern_helper_template/src//state/store.ts","src://tavern_helper_template/src//services/tagService.ts","src://tavern_helper_template/src//ui/App.vue","webpack://tavern_helper_template/src//ui/App.vue?4c01","src://tavern_helper_template/src//entry/portal.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.cardhub-root[data-v-2bd55f74]{position:fixed;inset:0;z-index:9999;font-family:'ZCOOL XiaoWei','STSong','Songti SC','SimSun',serif;color:#1b1b1b;display:none;align-items:center;justify-content:center}.cardhub-root.open[data-v-2bd55f74]{display:flex;align-items:center;justify-content:center}.cardhub-backdrop[data-v-2bd55f74]{position:absolute;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(6px);opacity:0;transition:opacity 180ms ease}.cardhub-root.open .cardhub-backdrop[data-v-2bd55f74]{opacity:1}.cardhub-panel[data-v-2bd55f74]{position:relative;width:min(980px,94%);max-height:92%;background:linear-gradient(160deg,#fff9f0,#f3e4d4);border-radius:28px;box-shadow:0 30px 90px rgba(0,0,0,0.28);display:flex;flex-direction:column;overflow:hidden;z-index:1;opacity:0;transform:translateY(8px) scale(0.985);transition:opacity 180ms ease,transform 180ms ease}.cardhub-root.open .cardhub-panel[data-v-2bd55f74]{opacity:1;transform:translateY(0) scale(1)}.cardhub-header[data-v-2bd55f74]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid rgba(86,59,44,0.15)}.cardhub-title__main[data-v-2bd55f74]{font-size:26px;letter-spacing:2px}.cardhub-title__sub[data-v-2bd55f74]{font-size:12px;color:#7d5b46;margin-left:10px}.cardhub-actions[data-v-2bd55f74]{display:flex;gap:10px}.cardhub-close[data-v-2bd55f74]{border:none;background:rgba(43,32,24,0.12);color:#3b2a20;width:34px;height:34px;border-radius:999px;font-size:20px;line-height:34px;text-align:center;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-close[data-v-2bd55f74]:hover{background:rgba(43,32,24,0.2)}.cardhub-close[data-v-2bd55f74]:active{transform:scale(0.96)}.cardhub-toolbar[data-v-2bd55f74]{display:flex;gap:8px;padding:12px 20px;flex-wrap:wrap}.cardhub-search[data-v-2bd55f74]{flex:1;min-width:180px;border-radius:999px;border:1px solid rgba(86,59,44,0.2);padding:6px 12px;background:#fffaf4}.cardhub-button[data-v-2bd55f74]{border:none;padding:6px 14px;border-radius:999px;background:#d46b3d;color:#fff;cursor:pointer;font-size:12px;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-button[data-v-2bd55f74]:hover{background:#c55f36;box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-button[data-v-2bd55f74]:active{transform:translateY(1px)}.cardhub-button.is-ghost[data-v-2bd55f74]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-button.is-ghost[data-v-2bd55f74]:hover{background:rgba(106,63,42,0.08);border-color:rgba(106,63,42,0.6);box-shadow:none}.cardhub-import-input[data-v-2bd55f74]{display:none}.cardhub-body[data-v-2bd55f74]{display:grid;grid-template-columns:minmax(160px,220px) 1fr;gap:0;flex:1;min-height:0}.cardhub-sidebar[data-v-2bd55f74]{padding:20px;border-right:1px solid rgba(86,59,44,0.15);display:flex;flex-direction:column;gap:12px}.cardhub-chip-row[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-divider[data-v-2bd55f74]{height:1px;width:100%;background:rgba(86,59,44,0.15);margin:8px 0}.cardhub-section-title[data-v-2bd55f74]{font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-chip[data-v-2bd55f74]{text-align:left;border:none;background:rgba(255,255,255,0.6);border-radius:12px;padding:8px 10px;cursor:pointer;font-size:12px;transition:background-color 160ms ease,color 160ms ease,transform 120ms ease}.cardhub-chip.is-active[data-v-2bd55f74]{background:#2b2018;color:#fff5ea}.cardhub-chip[data-v-2bd55f74]:not(.is-active):hover{background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-placeholder[data-v-2bd55f74]{font-size:12px;color:#9a7a63}.cardhub-tag-filter[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-tag-filter__chip[data-v-2bd55f74]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.7);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag-filter__chip.is-active[data-v-2bd55f74]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-tag-filter__chip[data-v-2bd55f74]:not(.is-active):hover{border-color:rgba(106,63,42,0.45);background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-chip--clear[data-v-2bd55f74]{margin-top:8px}.cardhub-content[data-v-2bd55f74]{padding:20px;overflow:auto;flex:1;min-height:0}.cardhub-grid-wrap[data-v-2bd55f74]{display:grid;gap:12px}.cardhub-pagination[data-v-2bd55f74]{display:flex;align-items:center;justify-content:flex-end;gap:10px;flex-wrap:wrap}.cardhub-pagination__status[data-v-2bd55f74]{font-size:12px;color:#7d5b46}.cardhub-pagination__actions[data-v-2bd55f74]{display:flex;gap:8px;align-items:center;margin-right:auto}.cardhub-pagination__button[data-v-2bd55f74]{border:1px solid rgba(106,63,42,0.35);background:rgba(255,255,255,0.85);color:#6a3f2a;border-radius:999px;padding:4px 10px;font-size:11px;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-pagination__button[data-v-2bd55f74]:disabled{opacity:0.4;cursor:default}.cardhub-pagination__button[data-v-2bd55f74]:not(:disabled):hover{background:rgba(255,255,255,1);border-color:rgba(106,63,42,0.6);transform:translateY(-1px)}.cardhub-pagination__button[data-v-2bd55f74]:not(:disabled):active{transform:translateY(0)}.cardhub-loading[data-v-2bd55f74],.cardhub-empty[data-v-2bd55f74]{padding:40px 0;text-align:center;color:#7d5b46}.cardhub-grid[data-v-2bd55f74]{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));justify-items:center}.cardhub-card[data-v-2bd55f74]{background:rgba(255,255,255,0.78);border-radius:18px;padding:14px;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;border:1px solid rgba(86,59,44,0.15);cursor:pointer;transition:transform 140ms ease,box-shadow 180ms ease,border-color 180ms ease;width:100%;max-width:260px}.cardhub-card[data-v-2bd55f74]:hover{transform:translateY(-2px);border-color:rgba(86,59,44,0.25);box-shadow:0 12px 26px rgba(43,32,24,0.16)}.cardhub-card[data-v-2bd55f74]:active{transform:translateY(0)}.cardhub-card__avatar[data-v-2bd55f74]{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#f4d7c4,#d36a3b);background-size:cover;background-position:center;color:#4a2a1f;display:grid;place-items:center;font-weight:700}.cardhub-card__avatar.has-avatar span[data-v-2bd55f74]{display:none}.cardhub-card__name[data-v-2bd55f74]{font-size:14px;font-weight:600}.cardhub-card__meta[data-v-2bd55f74]{display:flex;gap:8px;font-size:11px;color:#7d5b46}.cardhub-card__tags[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}.cardhub-tag[data-v-2bd55f74]{border:1px solid rgba(106,63,42,0.3);background:#fff6ea;border-radius:999px;padding:4px 8px;font-size:11px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag[data-v-2bd55f74]:hover{background:#fffaf4;border-color:rgba(106,63,42,0.5);transform:translateY(-1px)}.cardhub-tag__remove[data-v-2bd55f74]{margin-left:4px;font-weight:700}.cardhub-tag.is-add[data-v-2bd55f74]{background:transparent;border-style:dashed}.cardhub-tag-input[data-v-2bd55f74]{border:1px dashed rgba(106,63,42,0.5);background:#fffaf4;border-radius:999px;padding:4px 10px;font-size:11px;min-width:80px;color:#6a3f2a;outline:none;height:24px;line-height:16px}.cardhub-tag-input[data-v-2bd55f74]:focus{border-color:rgba(106,63,42,0.85)}.cardhub-card__action[data-v-2bd55f74]{grid-column:span 2;margin-top:10px;border:none;background:#2b2018;color:#fff5ea;padding:6px 12px;border-radius:12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-card__actions[data-v-2bd55f74]{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}.cardhub-card__action.is-secondary[data-v-2bd55f74]{background:#d9c6b6;color:#3b2a20}.cardhub-card__action[data-v-2bd55f74]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-card__action[data-v-2bd55f74]:active{transform:translateY(0)}.cardhub-preview[data-v-2bd55f74]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100000}.cardhub-preview__panel[data-v-2bd55f74]{width:min(520px,92vw);background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:20px;position:relative;display:grid;gap:14px}.cardhub-preview__close[data-v-2bd55f74]{position:absolute;top:14px;right:14px;border:none;width:30px;height:30px;border-radius:999px;background:rgba(43,32,24,0.15);color:#3b2a20;font-size:18px;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-preview__close[data-v-2bd55f74]:hover{background:rgba(43,32,24,0.25)}.cardhub-preview__close[data-v-2bd55f74]:active{transform:scale(0.96)}.cardhub-preview__avatar[data-v-2bd55f74]{width:100%;height:260px;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-preview__avatar img[data-v-2bd55f74]{width:100%;height:100%;object-fit:contain}.cardhub-preview__info[data-v-2bd55f74]{display:grid;gap:6px}.cardhub-preview__name[data-v-2bd55f74]{font-size:20px;font-weight:700}.cardhub-preview__meta[data-v-2bd55f74]{display:flex;gap:10px;font-size:12px;color:#7d5b46}.cardhub-preview__tags[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-preview__tag[data-v-2bd55f74]{padding:6px 10px;border-radius:999px;border:1px solid rgba(106,63,42,0.3);background:#fffaf4;font-size:12px;color:#6a3f2a}.cardhub-preview__actions[data-v-2bd55f74]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-manage[data-v-2bd55f74]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100001}.cardhub-manage__panel[data-v-2bd55f74]{width:min(760px,94vw);max-height:88vh;background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:22px;position:relative;display:grid;gap:16px;overflow:auto;overflow-x:hidden}.cardhub-manage__top[data-v-2bd55f74]{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}.cardhub-manage__media[data-v-2bd55f74]{width:220px;aspect-ratio:3/4;height:auto;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-manage__media img[data-v-2bd55f74]{width:100%;height:100%;object-fit:cover}.cardhub-manage__summary[data-v-2bd55f74]{display:grid;gap:6px}.cardhub-manage__overview[data-v-2bd55f74]{display:grid;gap:10px;margin-top:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.cardhub-manage__overview-card[data-v-2bd55f74]{background:rgba(255,255,255,0.7);border:1px solid rgba(106,63,42,0.2);border-radius:14px;padding:10px 12px;display:grid;gap:4px}.cardhub-manage__overview-label[data-v-2bd55f74]{font-size:10px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__overview-value[data-v-2bd55f74]{font-size:13px;font-weight:600;color:#3b2a20}.cardhub-manage__overview-hint[data-v-2bd55f74]{font-size:11px;color:#7d5b46}.cardhub-manage__section[data-v-2bd55f74]{display:grid;gap:8px}.cardhub-manage__details[data-v-2bd55f74]{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.cardhub-manage__detail[data-v-2bd55f74]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;display:grid;gap:6px}.cardhub-manage__detail-label[data-v-2bd55f74]{font-size:11px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__detail-content[data-v-2bd55f74]{font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__label[data-v-2bd55f74]{display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__btn[data-v-2bd55f74]{border:none;border-radius:12px;padding:6px 12px;font-size:12px;cursor:pointer;text-transform:none;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-manage__btn.is-primary[data-v-2bd55f74]{background:#2b2018;color:#fff5ea}.cardhub-manage__btn.is-secondary[data-v-2bd55f74]{background:#d9c6b6;color:#3b2a20}.cardhub-manage__jump-row[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:8px;align-items:center}.cardhub-manage__btn[data-v-2bd55f74]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-manage__btn.is-primary[data-v-2bd55f74]:hover{background:#241a14}.cardhub-manage__btn.is-secondary[data-v-2bd55f74]:hover{background:#d1bca8}.cardhub-manage__btn[data-v-2bd55f74]:active{transform:translateY(0)}.cardhub-manage__content[data-v-2bd55f74]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__opening[data-v-2bd55f74]{padding:6px 0;border-bottom:1px dashed rgba(106,63,42,0.2)}.cardhub-manage__opening[data-v-2bd55f74]:last-child{border-bottom:none}.cardhub-manage__chat[data-v-2bd55f74]{display:grid;gap:10px}.cardhub-manage__chat-row[data-v-2bd55f74]{display:grid;grid-template-columns:minmax(140px,220px) 1fr;gap:12px;font-size:12px;color:#3b2a20;align-items:start;padding:6px 8px;border-radius:10px;cursor:pointer}.cardhub-manage__chat-row[data-v-2bd55f74]:hover{background:rgba(106,63,42,0.08)}.cardhub-manage__chat-main[data-v-2bd55f74]{display:grid;gap:4px}.cardhub-manage__chat-name[data-v-2bd55f74]{flex:0 0 auto;font-weight:600;color:#6a3f2a;word-break:break-word}.cardhub-manage__chat-label[data-v-2bd55f74]{font-size:11px;color:#9a7a63;word-break:break-word}.cardhub-manage__chat-text[data-v-2bd55f74]{color:#3b2a20;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__empty[data-v-2bd55f74]{font-size:12px;color:#9a7a63}.cardhub-manage__actions[data-v-2bd55f74]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-confirm[data-v-2bd55f74]{position:absolute;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100002}.cardhub-confirm__panel[data-v-2bd55f74]{width:min(460px,92vw);background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px}.cardhub-confirm__title[data-v-2bd55f74]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-confirm__message[data-v-2bd55f74]{font-size:13px;line-height:1.5;color:#4a2a1f;white-space:pre-wrap}.cardhub-confirm__actions[data-v-2bd55f74]{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}.cardhub-confirm__button[data-v-2bd55f74]{border:none;border-radius:999px;padding:8px 14px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease,border-color 160ms ease}.cardhub-confirm__button.is-confirm[data-v-2bd55f74]{background:#d46b3d;color:#fff}.cardhub-confirm__button.is-cancel[data-v-2bd55f74]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-confirm__button.is-danger[data-v-2bd55f74]{background:#b6452a;color:#fff}.cardhub-confirm__button[data-v-2bd55f74]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-confirm__button[data-v-2bd55f74]:active{transform:translateY(0)}.cardhub-export[data-v-2bd55f74]{position:absolute;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100003}.cardhub-export__panel[data-v-2bd55f74]{width:min(720px,92vw);max-height:86vh;background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px;overflow:hidden}.cardhub-export__header[data-v-2bd55f74]{display:flex;align-items:center;justify-content:space-between;gap:12px}.cardhub-export__title[data-v-2bd55f74]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-export__subtitle[data-v-2bd55f74]{font-size:12px;color:#7d5b46}.cardhub-export__toolbar[data-v-2bd55f74]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.cardhub-export__spacer[data-v-2bd55f74]{flex:1}.cardhub-export__btn[data-v-2bd55f74]{border:none;border-radius:999px;padding:6px 12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-export__btn.is-primary[data-v-2bd55f74]{background:#d46b3d;color:#fff}.cardhub-export__btn.is-secondary[data-v-2bd55f74]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-export__btn[data-v-2bd55f74]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-export__list[data-v-2bd55f74]{display:grid;gap:8px;overflow:auto;padding-right:4px;max-height:58vh}.cardhub-export__item[data-v-2bd55f74]{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;border:1px solid rgba(106,63,42,0.2);border-radius:14px;padding:10px 12px;background:rgba(255,255,255,0.75);cursor:pointer}.cardhub-export__item[data-v-2bd55f74]:hover{border-color:rgba(106,63,42,0.4)}.cardhub-export__checkbox[data-v-2bd55f74]{width:16px;height:16px}.cardhub-export__main[data-v-2bd55f74]{display:grid;gap:4px}.cardhub-export__name[data-v-2bd55f74]{font-size:13px;font-weight:600;color:#3b2a20}.cardhub-export__meta[data-v-2bd55f74]{display:flex;gap:10px;font-size:11px;color:#7d5b46}.cardhub-export__tags[data-v-2bd55f74]{display:flex;flex-wrap:wrap;gap:6px}.cardhub-export__tag[data-v-2bd55f74]{padding:3px 8px;border-radius:999px;border:1px solid rgba(106,63,42,0.2);background:rgba(255,255,255,0.9);font-size:10px;color:#6a3f2a}.cardhub-button[data-v-2bd55f74]:focus-visible,.cardhub-chip[data-v-2bd55f74]:focus-visible,.cardhub-tag-filter__chip[data-v-2bd55f74]:focus-visible,.cardhub-tag[data-v-2bd55f74]:focus-visible,.cardhub-card__action[data-v-2bd55f74]:focus-visible,.cardhub-pagination__button[data-v-2bd55f74]:focus-visible,.cardhub-manage__btn[data-v-2bd55f74]:focus-visible,.cardhub-close[data-v-2bd55f74]:focus-visible,.cardhub-preview__close[data-v-2bd55f74]:focus-visible,.cardhub-confirm__button[data-v-2bd55f74]:focus-visible,.cardhub-export__btn[data-v-2bd55f74]:focus-visible{outline:2px solid rgba(212,107,61,0.6);outline-offset:2px}@media (max-width:720px){.cardhub-root[data-v-2bd55f74]{position:absolute !important;inset:0 !important;z-index:99999 !important;display:none;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-root.open[data-v-2bd55f74]{display:flex !important}.cardhub-backdrop[data-v-2bd55f74]{position:absolute !important;inset:0 !important;z-index:99998 !important;background:rgba(0,0,0,0.4) !important;backdrop-filter:blur(8px) !important}.cardhub-panel[data-v-2bd55f74]{position:relative !important;width:100% !important;height:100% !important;max-height:100% !important;max-width:none !important;margin:0 !important;border-radius:24px !important;box-shadow:0 12px 48px rgba(0,0,0,0.3),0 2px 8px rgba(0,0,0,0.1) !important;display:flex !important;flex-direction:column !important;z-index:99999 !important;overflow:hidden !important;border:1px solid rgba(255,255,255,0.15) !important}.cardhub-header[data-v-2bd55f74]{flex-shrink:0;padding:14px 16px;border-bottom:1px solid rgba(86,59,44,0.12)}.cardhub-title__main[data-v-2bd55f74]{font-size:20px}.cardhub-title__sub[data-v-2bd55f74]{font-size:11px}.cardhub-close[data-v-2bd55f74]{width:28px;height:28px;font-size:16px;line-height:28px}.cardhub-toolbar[data-v-2bd55f74]{flex-shrink:0;display:flex;flex-wrap:wrap;-moz-column-gap:6px;column-gap:6px;row-gap:8px;padding:10px 14px}.cardhub-search[data-v-2bd55f74]{width:100%;font-size:13px;padding:8px 12px;height:34px}.cardhub-button[data-v-2bd55f74]{flex:0 1 auto;min-width:0;font-size:11px;padding:6px 10px;height:32px;line-height:1}.cardhub-body[data-v-2bd55f74]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:auto}.cardhub-sidebar[data-v-2bd55f74]{flex-shrink:0;border-right:none;border-bottom:1px solid rgba(86,59,44,0.12);padding:10px 14px;max-height:none;overflow:visible}.cardhub-section-title[data-v-2bd55f74]{font-size:10px;margin-bottom:6px}.cardhub-divider[data-v-2bd55f74]{margin:6px 0}.cardhub-chip-row[data-v-2bd55f74],.cardhub-tag-filter[data-v-2bd55f74]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:6px;padding-bottom:4px}.cardhub-chip-row[data-v-2bd55f74]::-webkit-scrollbar,.cardhub-tag-filter[data-v-2bd55f74]::-webkit-scrollbar{height:4px}.cardhub-chip-row[data-v-2bd55f74]::-webkit-scrollbar-thumb,.cardhub-tag-filter[data-v-2bd55f74]::-webkit-scrollbar-thumb{background:rgba(106,63,42,0.15);border-radius:999px}.cardhub-chip[data-v-2bd55f74]{font-size:11px;padding:6px 10px;min-height:30px;line-height:1;white-space:nowrap;flex-shrink:0}.cardhub-tag-filter__chip[data-v-2bd55f74]{font-size:10px;padding:5px 9px;min-height:28px;line-height:1;white-space:nowrap;flex-shrink:0}.cardhub-content[data-v-2bd55f74]{flex:1;min-height:0;overflow:visible;padding:12px}.cardhub-pagination[data-v-2bd55f74]{align-items:flex-start;position:relative;padding-right:72px}.cardhub-pagination__actions[data-v-2bd55f74]{width:100%}.cardhub-pagination__button[data-v-2bd55f74]{flex:1;text-align:center}.cardhub-pagination__status[data-v-2bd55f74]{position:absolute;right:12px;top:10px;font-size:10px;white-space:nowrap}.cardhub-grid[data-v-2bd55f74]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;justify-content:center;justify-items:center}.cardhub-card[data-v-2bd55f74]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:10px;border-radius:14px;min-width:0;width:100%;max-width:none}.cardhub-card__avatar[data-v-2bd55f74]{width:40px;height:40px;flex-shrink:0;border-radius:10px}.cardhub-card__info[data-v-2bd55f74]{flex:1;min-width:0}.cardhub-card__name[data-v-2bd55f74]{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.cardhub-card__meta[data-v-2bd55f74]{font-size:10px;gap:6px}.cardhub-card__tags[data-v-2bd55f74]{margin-top:4px;gap:4px}.cardhub-tag[data-v-2bd55f74]{font-size:9px;padding:3px 6px}.cardhub-card__actions[data-v-2bd55f74]{display:flex;flex-direction:column;gap:4px;flex-shrink:0}.cardhub-card__action[data-v-2bd55f74]{padding:5px 10px;font-size:10px;border-radius:8px}.cardhub-preview[data-v-2bd55f74],.cardhub-manage[data-v-2bd55f74]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-preview__panel[data-v-2bd55f74],.cardhub-manage__panel[data-v-2bd55f74]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important;overflow:auto !important;overflow-x:hidden !important}.cardhub-preview__avatar[data-v-2bd55f74]{height:180px;border-radius:14px}.cardhub-preview__name[data-v-2bd55f74]{font-size:16px}.cardhub-preview__meta[data-v-2bd55f74]{font-size:11px}.cardhub-preview__tag[data-v-2bd55f74]{font-size:10px;padding:4px 8px}.cardhub-preview__actions[data-v-2bd55f74]{gap:8px}.cardhub-manage__top[data-v-2bd55f74]{grid-template-columns:1fr;gap:12px}.cardhub-manage__media[data-v-2bd55f74]{width:120px;margin:0 auto}.cardhub-manage__overview[data-v-2bd55f74]{grid-template-columns:1fr}.cardhub-manage__overview-value[data-v-2bd55f74]{font-size:12px}.cardhub-manage__overview-hint[data-v-2bd55f74]{font-size:10px}.cardhub-manage__label[data-v-2bd55f74]{flex-direction:column;align-items:flex-start;gap:6px;font-size:10px}.cardhub-manage__details[data-v-2bd55f74]{grid-template-columns:1fr}.cardhub-manage__detail-label[data-v-2bd55f74]{font-size:10px}.cardhub-manage__detail-content[data-v-2bd55f74]{font-size:11px;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__btn[data-v-2bd55f74]{width:100%;text-align:center;font-size:10px}.cardhub-manage__jump-row[data-v-2bd55f74]{width:100%}.cardhub-manage__content[data-v-2bd55f74]{font-size:11px;padding:10px;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__chat-row[data-v-2bd55f74]{grid-template-columns:1fr;gap:3px;font-size:11px}.cardhub-manage__chat-label[data-v-2bd55f74]{font-size:10px}.cardhub-manage__chat-text[data-v-2bd55f74]{-webkit-line-clamp:2;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__actions[data-v-2bd55f74]{grid-template-columns:1fr 1fr;gap:8px}.cardhub-export[data-v-2bd55f74]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important}.cardhub-export__panel[data-v-2bd55f74]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important}.cardhub-export__toolbar[data-v-2bd55f74]{gap:6px}.cardhub-export__btn[data-v-2bd55f74]{font-size:11px;padding:6px 10px}.cardhub-export__list[data-v-2bd55f74]{max-height:48vh}.cardhub-export__item[data-v-2bd55f74]{grid-template-columns:auto 1fr;gap:8px;padding:8px 10px}.cardhub-export__name[data-v-2bd55f74]{font-size:12px}.cardhub-export__meta[data-v-2bd55f74]{font-size:10px}.cardhub-export__tag[data-v-2bd55f74]{font-size:9px}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src//ui/App.vue\"],\"names\":[],\"mappings\":\"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C,CAClC,aAAc,CACd,cAAe,CACf,cAAe,CACf,2DAGF,CAEA,+CACE,8BACF,CAEA,gDACE,qBACF,CAEA,0CACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,8CACE,UAAW,CACX,WAAY,CACZ,kBACF,CAEA,wCACE,YAAa,CACb,OACF,CAEA,wCACE,cAAe,CACf,eACF,CAEA,wCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,wCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,uCACE,gBAAiB,CACjB,mBAAoB,CACpB,oCAAwC,CACxC,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,2CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,iCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,aAAc,CACd,iBACF,CAEA,sCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,iBACF,CAEA,wCACE,WAAY,CACZ,gBAAmB,CACnB,WAAY,CACZ,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,4CACE,UAAW,CACX,WAAY,CACZ,gBACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,2CACE,YAAa,CACb,QAAS,CACT,eAAgB,CAChB,wDACF,CAEA,gDACE,gCAAoC,CACpC,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,YAAa,CACb,OACF,CAEA,iDACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,iDACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,gDACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,0CACE,YAAa,CACb,QAAS,CACT,wDACF,CAEA,yCACE,kBAA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\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"cardhub-root\\\" :class=\\\"{ open: state.open }\\\" :style=\\\"themeStyle\\\">\\n    <div class=\\\"cardhub-backdrop\\\" @click=\\\"close\\\" />\\n    <section class=\\\"cardhub-panel\\\" role=\\\"dialog\\\" aria-label=\\\"CardHub \\\">\\n      <header class=\\\"cardhub-header\\\">\\n        <div class=\\\"cardhub-title\\\">\\n          <span class=\\\"cardhub-title__main\\\">CardHub</span>\\n          <span class=\\\"cardhub-title__sub\\\"></span>\\n        </div>\\n        <div class=\\\"cardhub-actions\\\">\\n          <button class=\\\"cardhub-theme-trigger\\\" type=\\\"button\\\" aria-label=\\\"\\\" @click=\\\"openThemeDialog\\\">\\n            <i class=\\\"fa-solid fa-palette\\\" aria-hidden=\\\"true\\\"></i>\\n          </button>\\n          <button class=\\\"cardhub-close\\\" type=\\\"button\\\" aria-label=\\\"\\\" @click=\\\"close\\\">\\n            <span aria-hidden=\\\"true\\\"></span>\\n          </button>\\n        </div>\\n      </header>\\n\\n      <div class=\\\"cardhub-toolbar\\\">\\n        <input v-model=\\\"state.search\\\" class=\\\"cardhub-search\\\" type=\\\"search\\\" placeholder=\\\"\\\" />\\n        <button class=\\\"cardhub-button\\\" type=\\\"button\\\" @click=\\\"refresh\\\"></button>\\n        <button class=\\\"cardhub-button is-ghost\\\" type=\\\"button\\\" @click=\\\"triggerImport\\\"></button>\\n        <button class=\\\"cardhub-button is-ghost\\\" type=\\\"button\\\" @click=\\\"exportSelected\\\"></button>\\n        <button class=\\\"cardhub-button is-ghost\\\" type=\\\"button\\\" @click=\\\"openBatchTagDialog\\\"></button>\\n        <input\\n          ref=\\\"importInput\\\"\\n          class=\\\"cardhub-import-input\\\"\\n          type=\\\"file\\\"\\n          accept=\\\".png,.json\\\"\\n          multiple\\n          @change=\\\"handleImportFiles\\\"\\n        />\\n      </div>\\n\\n      <div class=\\\"cardhub-body\\\">\\n        <div class=\\\"cardhub-sidebar\\\">\\n          <div class=\\\"cardhub-filter-row\\\">\\n            <div class=\\\"cardhub-filter-block\\\">\\n              <div class=\\\"cardhub-section-title\\\"></div>\\n              <div class=\\\"cardhub-chip-row\\\">\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': statusFilter === 'all' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"statusFilter = 'all'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': statusFilter === 'imported' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"statusFilter = 'imported'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': statusFilter === 'unimported' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"statusFilter = 'unimported'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': favoritesOnly }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"favoritesOnly = !favoritesOnly\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"cardhub-filter-block\\\">\\n              <div class=\\\"cardhub-section-title\\\"></div>\\n              <div class=\\\"cardhub-chip-row\\\">\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': sortKey === 'recent' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"sortKey = 'recent'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': sortKey === 'name' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"sortKey = 'name'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': sortKey === 'tags' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"sortKey = 'tags'\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-chip\\\"\\n                  :class=\\\"{ 'is-active': sortKey === 'imported' }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"sortKey = 'imported'\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n            </div>\\n          </div>\\n          <div class=\\\"cardhub-divider\\\" />\\n          <div class=\\\"cardhub-section-title\\\"></div>\\n          <div class=\\\"cardhub-tag-filter\\\">\\n            <button\\n              v-for=\\\"tag in allTags\\\"\\n              :key=\\\"tag\\\"\\n              class=\\\"cardhub-tag-filter__chip\\\"\\n              :class=\\\"{ 'is-active': selectedTags.includes(tag) }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"toggleTagFilter(tag)\\\"\\n            >\\n              {{ tag }}\\n            </button>\\n          </div>\\n          <button\\n            v-if=\\\"selectedTags.length\\\"\\n            class=\\\"cardhub-chip cardhub-chip--clear\\\"\\n            type=\\\"button\\\"\\n            @click=\\\"clearTagFilter\\\"\\n          >\\n            \\n          </button>\\n        </div>\\n\\n        <div class=\\\"cardhub-content\\\">\\n          <div v-if=\\\"state.loading\\\" class=\\\"cardhub-loading\\\">...</div>\\n          <div v-else-if=\\\"!filteredCharacters.length\\\" class=\\\"cardhub-empty\\\"></div>\\n          <div v-else class=\\\"cardhub-grid-wrap\\\">\\n            <div class=\\\"cardhub-pagination\\\">\\n              <div v-if=\\\"totalPages > 1\\\" class=\\\"cardhub-pagination__actions\\\">\\n                <button class=\\\"cardhub-pagination__button\\\" type=\\\"button\\\" :disabled=\\\"currentPage <= 1\\\" @click=\\\"prevPage\\\">\\n                  \\n                </button>\\n                <button\\n                  class=\\\"cardhub-pagination__button\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"currentPage >= totalPages\\\"\\n                  @click=\\\"nextPage\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n              <span class=\\\"cardhub-pagination__status\\\"> {{ currentPage }} / {{ totalPages }} </span>\\n            </div>\\n            <div class=\\\"cardhub-grid\\\">\\n              <article\\n                v-for=\\\"character in pagedCharacters\\\"\\n                :key=\\\"character.id\\\"\\n                class=\\\"cardhub-card\\\"\\n                @click=\\\"openManage(character)\\\"\\n              >\\n                <div\\n                  class=\\\"cardhub-card__avatar\\\"\\n                  :class=\\\"{ 'has-avatar': Boolean(avatarUrl(character)) }\\\"\\n                  :style=\\\"avatarStyle(character)\\\"\\n                >\\n                  <span>{{ character.name.slice(0, 1) || '?' }}</span>\\n                </div>\\n                <div class=\\\"cardhub-card__info\\\">\\n                  <div class=\\\"cardhub-card__head\\\">\\n                    <div class=\\\"cardhub-card__name\\\">{{ character.name }}</div>\\n                    <button\\n                      class=\\\"cardhub-fav\\\"\\n                      :class=\\\"{ 'is-active': isFavorite(character.id) }\\\"\\n                      type=\\\"button\\\"\\n                      aria-label=\\\"\\\"\\n                      @click.stop=\\\"toggleFavorite(character)\\\"\\n                    >\\n                      <i class=\\\"fa-solid fa-star\\\" aria-hidden=\\\"true\\\"></i>\\n                    </button>\\n                  </div>\\n                  <div class=\\\"cardhub-card__meta\\\">\\n                    <span>{{ character.origin === 'tavern' ? '' : '' }}</span>\\n                    <span>{{ displayTags(character).length }} </span>\\n                  </div>\\n                  <div class=\\\"cardhub-card__tags\\\">\\n                    <button\\n                      v-for=\\\"tag in displayTags(character)\\\"\\n                      :key=\\\"tag\\\"\\n                      class=\\\"cardhub-tag\\\"\\n                      type=\\\"button\\\"\\n                      title=\\\"\\\"\\n                      @click.stop=\\\"removeTag(character, tag)\\\"\\n                    >\\n                      {{ tag }}\\n                      <span class=\\\"cardhub-tag__remove\\\"></span>\\n                    </button>\\n                    <button\\n                      v-if=\\\"activeTagKey !== tagKey(character)\\\"\\n                      class=\\\"cardhub-tag is-add\\\"\\n                      type=\\\"button\\\"\\n                      @click.stop=\\\"startTagEdit(character)\\\"\\n                    >\\n                      + \\n                    </button>\\n                    <div v-else class=\\\"cardhub-tag-edit\\\" @click.stop @mousedown.stop @touchstart.stop>\\n                      <input\\n                        v-model=\\\"tagInput\\\"\\n                        class=\\\"cardhub-tag-input\\\"\\n                        type=\\\"text\\\"\\n                        placeholder=\\\"\\\"\\n                        @keydown.enter.prevent=\\\"confirmTag(character)\\\"\\n                        @keydown.esc.prevent=\\\"cancelTagEdit\\\"\\n                        @blur=\\\"confirmTag(character)\\\"\\n                      />\\n                      <button class=\\\"cardhub-tag-confirm\\\" type=\\\"button\\\" @click=\\\"confirmTag(character)\\\"></button>\\n                    </div>\\n                  </div>\\n                </div>\\n                <div class=\\\"cardhub-card__actions\\\">\\n                  <button\\n                    class=\\\"cardhub-card__action is-secondary\\\"\\n                    type=\\\"button\\\"\\n                    @click.stop=\\\"handleCardAction(character)\\\"\\n                    @pointerdown.stop\\n                    @mousedown.stop\\n                    @touchstart.stop\\n                  >\\n                    {{ character.origin === 'tavern' ? '' : '' }}\\n                  </button>\\n                  <button\\n                    class=\\\"cardhub-card__action\\\"\\n                    type=\\\"button\\\"\\n                    @click.stop=\\\"openManage(character)\\\"\\n                    @pointerdown.stop\\n                    @mousedown.stop\\n                    @touchstart.stop\\n                  >\\n                    \\n                  </button>\\n                </div>\\n              </article>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\\n    </section>\\n\\n    <div v-if=\\\"manageCard\\\" class=\\\"cardhub-manage\\\" @click.self=\\\"closeManage\\\">\\n      <div class=\\\"cardhub-manage__panel\\\" role=\\\"dialog\\\" aria-label=\\\"\\\">\\n        <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closeManage\\\"></button>\\n        <div class=\\\"cardhub-manage__top\\\">\\n          <div class=\\\"cardhub-manage__summary\\\">\\n            <div class=\\\"cardhub-preview__name\\\">{{ manageCard.name }}</div>\\n            <div class=\\\"cardhub-preview__meta\\\">\\n              <span>{{ manageCard.origin === 'tavern' ? '' : '' }}</span>\\n              <span>{{ displayTags(manageCard).length }} </span>\\n            </div>\\n            <div class=\\\"cardhub-preview__tags\\\">\\n              <span v-for=\\\"tag in displayTags(manageCard)\\\" :key=\\\"tag\\\" class=\\\"cardhub-preview__tag\\\">\\n                {{ tag }}\\n              </span>\\n            </div>\\n            <div class=\\\"cardhub-manage__overview\\\">\\n              <div v-for=\\\"item in manageOverview\\\" :key=\\\"item.label\\\" class=\\\"cardhub-manage__overview-card\\\">\\n                <div class=\\\"cardhub-manage__overview-label\\\">{{ item.label }}</div>\\n                <div class=\\\"cardhub-manage__overview-value\\\">{{ item.value }}</div>\\n                <div v-if=\\\"item.hint\\\" class=\\\"cardhub-manage__overview-hint\\\">{{ item.hint }}</div>\\n              </div>\\n            </div>\\n          </div>\\n          <div class=\\\"cardhub-manage__media\\\">\\n            <img v-if=\\\"manageAvatarUrl\\\" :src=\\\"manageAvatarUrl\\\" alt=\\\"\\\" />\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-manage__section\\\">\\n          <div class=\\\"cardhub-manage__label\\\"></div>\\n          <div v-if=\\\"manageDetails.length\\\" class=\\\"cardhub-manage__details\\\">\\n            <div v-for=\\\"detail in manageDetails\\\" :key=\\\"detail.label\\\" class=\\\"cardhub-manage__detail\\\">\\n              <div class=\\\"cardhub-manage__detail-label\\\">{{ detail.label }}</div>\\n              <div class=\\\"cardhub-manage__detail-content\\\">{{ detail.value }}</div>\\n            </div>\\n          </div>\\n          <div v-else class=\\\"cardhub-manage__empty\\\">{{ manageDetailsHint }}</div>\\n        </div>\\n        <div class=\\\"cardhub-manage__section\\\">\\n          <div class=\\\"cardhub-manage__label\\\"></div>\\n          <div class=\\\"cardhub-manage__content\\\">\\n            <template v-if=\\\"manageOpeningLines.length\\\">\\n              <div v-for=\\\"(opening, index) in manageOpeningLines\\\" :key=\\\"index\\\" class=\\\"cardhub-manage__opening\\\">\\n                {{ opening }}\\n              </div>\\n            </template>\\n            <template v-else></template>\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-manage__section\\\">\\n          <div class=\\\"cardhub-manage__label\\\">\\n            <span></span>\\n            <div class=\\\"cardhub-manage__jump-row\\\">\\n              <button\\n                class=\\\"cardhub-manage__btn is-primary\\\"\\n                type=\\\"button\\\"\\n                @click=\\\"openLatestChat\\\"\\n                @pointerdown.stop\\n                @mousedown.stop\\n                @touchstart.stop\\n              >\\n                \\n              </button>\\n              <button\\n                class=\\\"cardhub-manage__btn is-secondary\\\"\\n                type=\\\"button\\\"\\n                @click=\\\"openNewChat\\\"\\n                @pointerdown.stop\\n                @mousedown.stop\\n                @touchstart.stop\\n              >\\n                \\n              </button>\\n            </div>\\n          </div>\\n          <div v-if=\\\"manageChats.length\\\" class=\\\"cardhub-manage__chat\\\">\\n            <div\\n              v-for=\\\"(msg, index) in manageChats\\\"\\n              :key=\\\"index\\\"\\n              class=\\\"cardhub-manage__chat-row\\\"\\n              role=\\\"button\\\"\\n              tabindex=\\\"0\\\"\\n              @click=\\\"openChat(msg)\\\"\\n              @keydown.enter.prevent=\\\"openChat(msg)\\\"\\n            >\\n              <div class=\\\"cardhub-manage__chat-main\\\">\\n                <div class=\\\"cardhub-manage__chat-name\\\">{{ msg.name }}</div>\\n                <div v-if=\\\"msg.label && msg.label !== msg.name\\\" class=\\\"cardhub-manage__chat-label\\\">\\n                  {{ msg.label }}\\n                </div>\\n              </div>\\n              <span class=\\\"cardhub-manage__chat-text\\\">{{ msg.mes }}</span>\\n            </div>\\n          </div>\\n          <div v-else class=\\\"cardhub-manage__empty\\\">{{ manageChatHint }}</div>\\n        </div>\\n        <div class=\\\"cardhub-manage__actions\\\">\\n          <button\\n            class=\\\"cardhub-manage__btn is-secondary\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"handleCardAction(manageCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            {{ manageCard.origin === 'tavern' ? '' : '' }}\\n          </button>\\n          <button\\n            class=\\\"cardhub-manage__btn is-primary\\\"\\n            type=\\\"button\\\"\\n            @click.stop=\\\"manageDelete(manageCard)\\\"\\n            @pointerdown.stop\\n            @mousedown.stop\\n            @touchstart.stop\\n          >\\n            \\n          </button>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"confirmState.open\\\" class=\\\"cardhub-confirm\\\" @click.self=\\\"resolveConfirm('cancel')\\\">\\n      <div class=\\\"cardhub-confirm__panel\\\" role=\\\"dialog\\\" aria-modal=\\\"true\\\">\\n        <div class=\\\"cardhub-confirm__title\\\">{{ confirmState.title }}</div>\\n        <div class=\\\"cardhub-confirm__message\\\">{{ confirmState.message }}</div>\\n        <div class=\\\"cardhub-confirm__actions\\\">\\n          <button class=\\\"cardhub-confirm__button is-cancel\\\" type=\\\"button\\\" @click=\\\"resolveConfirm('cancel')\\\">\\n            {{ confirmState.cancelLabel }}\\n          </button>\\n          <button\\n            v-if=\\\"confirmState.altLabel\\\"\\n            class=\\\"cardhub-confirm__button is-danger\\\"\\n            type=\\\"button\\\"\\n            @click=\\\"resolveConfirm('alt')\\\"\\n          >\\n            {{ confirmState.altLabel }}\\n          </button>\\n          <button class=\\\"cardhub-confirm__button is-confirm\\\" type=\\\"button\\\" @click=\\\"resolveConfirm('confirm')\\\">\\n            {{ confirmState.confirmLabel }}\\n          </button>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"exportDialogOpen\\\" class=\\\"cardhub-export\\\" @click.self=\\\"closeExportDialog\\\">\\n      <div class=\\\"cardhub-export__panel\\\" role=\\\"dialog\\\" aria-label=\\\"\\\">\\n        <div class=\\\"cardhub-export__header\\\">\\n          <div>\\n            <div class=\\\"cardhub-export__title\\\"></div>\\n            <div class=\\\"cardhub-export__subtitle\\\">\\n               {{ exportSelectedItems.length }} / {{ exportVisibleCandidates.length }}\\n            </div>\\n          </div>\\n          <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closeExportDialog\\\"></button>\\n        </div>\\n        <div class=\\\"cardhub-export__filters\\\">\\n          <input v-model=\\\"exportSearch\\\" class=\\\"cardhub-export__search\\\" type=\\\"search\\\" placeholder=\\\"\\\" />\\n          <div class=\\\"cardhub-export__filter-row\\\">\\n            <button\\n              class=\\\"cardhub-export__chip\\\"\\n              :class=\\\"{ 'is-active': exportStatusFilter === 'all' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"exportStatusFilter = 'all'\\\"\\n            >\\n              \\n            </button>\\n            <button\\n              class=\\\"cardhub-export__chip\\\"\\n              :class=\\\"{ 'is-active': exportStatusFilter === 'imported' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"exportStatusFilter = 'imported'\\\"\\n            >\\n              \\n            </button>\\n            <button\\n              class=\\\"cardhub-export__chip\\\"\\n              :class=\\\"{ 'is-active': exportStatusFilter === 'unimported' }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"exportStatusFilter = 'unimported'\\\"\\n            >\\n              \\n            </button>\\n          </div>\\n          <div class=\\\"cardhub-export__filter-row\\\">\\n            <button\\n              v-for=\\\"tag in exportAllTags\\\"\\n              :key=\\\"tag\\\"\\n              class=\\\"cardhub-export__chip\\\"\\n              :class=\\\"{ 'is-active': exportTagFilters.includes(tag) }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"toggleExportTagFilter(tag)\\\"\\n            >\\n              {{ tag }}\\n            </button>\\n            <button\\n              v-if=\\\"exportTagFilters.length\\\"\\n              class=\\\"cardhub-export__chip cardhub-export__chip--clear\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"clearExportTagFilter\\\"\\n            >\\n              \\n            </button>\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-export__toolbar\\\">\\n          <button class=\\\"cardhub-export__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"selectAllExport\\\"></button>\\n          <button class=\\\"cardhub-export__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"clearExportSelection\\\"></button>\\n          <div class=\\\"cardhub-export__spacer\\\"></div>\\n          <button class=\\\"cardhub-export__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"closeExportDialog\\\"></button>\\n          <button class=\\\"cardhub-export__btn is-primary\\\" type=\\\"button\\\" @click=\\\"confirmExportSelected\\\"></button>\\n        </div>\\n        <div class=\\\"cardhub-export__list\\\">\\n          <label v-for=\\\"item in exportVisibleCandidates\\\" :key=\\\"item.id\\\" class=\\\"cardhub-export__item\\\">\\n            <input\\n              class=\\\"cardhub-export__checkbox\\\"\\n              type=\\\"checkbox\\\"\\n              :checked=\\\"isExportSelected(item.id)\\\"\\n              @change=\\\"toggleExportSelection(item.id)\\\"\\n            />\\n            <div class=\\\"cardhub-export__main\\\">\\n              <div class=\\\"cardhub-export__name\\\">{{ item.name }}</div>\\n              <div class=\\\"cardhub-export__meta\\\">\\n                <span>{{ item.origin === 'tavern' ? '' : '' }}</span>\\n                <span>{{ displayTags(item).length }} </span>\\n              </div>\\n              <div v-if=\\\"displayTags(item).length\\\" class=\\\"cardhub-export__tags\\\">\\n                <span v-for=\\\"tag in displayTags(item).slice(0, 3)\\\" :key=\\\"tag\\\" class=\\\"cardhub-export__tag\\\">\\n                  {{ tag }}\\n                </span>\\n              </div>\\n            </div>\\n          </label>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"batchTagDialogOpen\\\" class=\\\"cardhub-batch\\\" @click.self=\\\"closeBatchTagDialog\\\">\\n      <div class=\\\"cardhub-batch__panel\\\" role=\\\"dialog\\\" aria-label=\\\"\\\">\\n        <div class=\\\"cardhub-batch__header\\\">\\n          <div>\\n            <div class=\\\"cardhub-batch__title\\\"></div>\\n            <div class=\\\"cardhub-batch__subtitle\\\">\\n               {{ batchTagSelectedIds.length }} / {{ batchTagVisibleCandidates.length }}\\n            </div>\\n          </div>\\n          <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closeBatchTagDialog\\\"></button>\\n        </div>\\n        <div class=\\\"cardhub-batch__filters\\\">\\n          <input v-model=\\\"batchTagSearch\\\" class=\\\"cardhub-batch__search\\\" type=\\\"search\\\" placeholder=\\\"\\\" />\\n          <div class=\\\"cardhub-batch__hint\\\"></div>\\n        </div>\\n        <div class=\\\"cardhub-batch__field\\\">\\n          <input v-model=\\\"batchTagInput\\\" type=\\\"text\\\" placeholder=\\\"/\\\" />\\n        </div>\\n        <div v-if=\\\"batchTagSuggestions.length\\\" class=\\\"cardhub-batch__suggestions\\\">\\n          <span class=\\\"cardhub-batch__suggest-title\\\"></span>\\n          <div class=\\\"cardhub-batch__suggest-row\\\">\\n            <button\\n              v-for=\\\"tag in batchTagSuggestions\\\"\\n              :key=\\\"tag\\\"\\n              class=\\\"cardhub-batch__chip\\\"\\n              :class=\\\"{ 'is-active': batchTagSelectedTags.includes(tag) }\\\"\\n              type=\\\"button\\\"\\n              @click=\\\"toggleBatchTagSuggestion(tag)\\\"\\n            >\\n              {{ tag }}\\n            </button>\\n          </div>\\n        </div>\\n        <div class=\\\"cardhub-batch__toolbar\\\">\\n          <button class=\\\"cardhub-batch__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"selectAllBatchTags\\\"></button>\\n          <button class=\\\"cardhub-batch__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"clearBatchTagSelection\\\"></button>\\n          <div class=\\\"cardhub-batch__spacer\\\"></div>\\n          <button class=\\\"cardhub-batch__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"closeBatchTagDialog\\\"></button>\\n          <button class=\\\"cardhub-batch__btn is-ghost\\\" type=\\\"button\\\" @click=\\\"applyBatchTags('remove')\\\"></button>\\n          <button class=\\\"cardhub-batch__btn is-primary\\\" type=\\\"button\\\" @click=\\\"applyBatchTags('add')\\\"></button>\\n        </div>\\n        <div class=\\\"cardhub-batch__list\\\">\\n          <label v-for=\\\"item in batchTagVisibleCandidates\\\" :key=\\\"item.id\\\" class=\\\"cardhub-batch__item\\\">\\n            <input\\n              class=\\\"cardhub-batch__checkbox\\\"\\n              type=\\\"checkbox\\\"\\n              :checked=\\\"batchTagSelectedSet.has(item.id)\\\"\\n              @change=\\\"toggleBatchTagSelection(item.id)\\\"\\n            />\\n            <div class=\\\"cardhub-batch__main\\\">\\n              <div class=\\\"cardhub-batch__name\\\">{{ item.name }}</div>\\n              <div class=\\\"cardhub-batch__meta\\\">\\n                <span>{{ item.origin === 'tavern' ? '' : '' }}</span>\\n                <span>{{ displayTags(item).length }} </span>\\n              </div>\\n              <div v-if=\\\"displayTags(item).length\\\" class=\\\"cardhub-batch__tags\\\">\\n                <span v-for=\\\"tag in displayTags(item).slice(0, 3)\\\" :key=\\\"tag\\\" class=\\\"cardhub-batch__tag\\\">\\n                  {{ tag }}\\n                </span>\\n              </div>\\n            </div>\\n          </label>\\n        </div>\\n      </div>\\n    </div>\\n\\n    <div v-if=\\\"themeDialogOpen\\\" class=\\\"cardhub-theme\\\" @click.self=\\\"closeThemeDialog\\\">\\n      <div class=\\\"cardhub-theme__panel\\\" role=\\\"dialog\\\" aria-label=\\\"\\\">\\n        <div class=\\\"cardhub-theme__header\\\">\\n          <div>\\n            <div class=\\\"cardhub-theme__title\\\"></div>\\n            <div class=\\\"cardhub-theme__subtitle\\\"></div>\\n          </div>\\n          <button class=\\\"cardhub-preview__close\\\" type=\\\"button\\\" @click=\\\"closeThemeDialog\\\"></button>\\n        </div>\\n        <div class=\\\"cardhub-theme__grid\\\">\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span> 1</span>\\n            <input v-model=\\\"themeDraft.bgStart\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span> 2</span>\\n            <input v-model=\\\"themeDraft.bgEnd\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span>/</span>\\n            <input v-model=\\\"themeDraft.surface\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.surfaceAlt\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.text\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.textMuted\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.accent\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.accentStrong\\\" type=\\\"color\\\" />\\n          </label>\\n          <label class=\\\"cardhub-theme__field\\\">\\n            <span></span>\\n            <input v-model=\\\"themeDraft.border\\\" type=\\\"color\\\" />\\n          </label>\\n        </div>\\n        <div class=\\\"cardhub-theme__presets\\\">\\n          <button\\n            v-for=\\\"preset in themePresets\\\"\\n            :key=\\\"preset.name\\\"\\n            class=\\\"cardhub-theme__preset\\\"\\n            type=\\\"button\\\"\\n            @click=\\\"applyThemePreset(preset)\\\"\\n          >\\n            {{ preset.name }}\\n          </button>\\n        </div>\\n        <div class=\\\"cardhub-theme__actions\\\">\\n          <button class=\\\"cardhub-theme__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"resetThemeDraft\\\"></button>\\n          <div class=\\\"cardhub-theme__spacer\\\"></div>\\n          <button class=\\\"cardhub-theme__btn is-secondary\\\" type=\\\"button\\\" @click=\\\"closeThemeDialog\\\"></button>\\n          <button class=\\\"cardhub-theme__btn is-primary\\\" type=\\\"button\\\" @click=\\\"saveThemeDraft\\\"></button>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { computed, nextTick, onMounted, reactive, ref, watch } from 'vue';\\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\\nimport { fetchCharacterSummaries } from '../services/characterSource';\\nimport type { CardHubItem } from '../types';\\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\\n\\nconst selectedTags = ref<string[]>([]);\\nconst activeTagKey = ref<string | null>(null);\\nconst tagInput = ref('');\\nconst statusFilter = ref<'all' | 'imported' | 'unimported'>('all');\\nconst pageSize = ref(24);\\nconst currentPage = ref(1);\\nconst importInput = ref<HTMLInputElement | null>(null);\\nconst manageCard = ref<CardHubItem | null>(null);\\nconst manageOpenings = ref<string[]>([]);\\ntype ManageChatEntry = {\\n  name: string;\\n  label?: string;\\n  mes: string;\\n  file: string;\\n};\\n\\nconst manageChats = ref<ManageChatEntry[]>([]);\\nconst manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\\nlet manageRequestId = 0;\\ntype ManageDetail = {\\n  label: string;\\n  value: string;\\n};\\ntype ManageProfile = {\\n  description?: string;\\n  personality?: string;\\n  scenario?: string;\\n  creatorNotes?: string;\\n  systemPrompt?: string;\\n  postHistory?: string;\\n  creator?: string;\\n  worldBookName?: string;\\n  worldBookCount?: number;\\n};\\ntype ManageOpeningSummary = {\\n  total: number;\\n  alternate: number;\\n};\\ntype ManageChatSummary = {\\n  total: number;\\n  latest: string;\\n};\\ntype ManageChatData = {\\n  list: ManageChatEntry[];\\n  summary: ManageChatSummary | null;\\n};\\ntype ManageOverviewItem = {\\n  label: string;\\n  value: string;\\n  hint?: string;\\n};\\ntype ManageData = {\\n  openings: string[];\\n  profile: ManageProfile | null;\\n  openingSummary: ManageOpeningSummary | null;\\n};\\ntype ConfirmResult = 'confirm' | 'cancel' | 'alt';\\ntype ConfirmOptions = {\\n  title?: string;\\n  message: string;\\n  confirmLabel?: string;\\n  cancelLabel?: string;\\n  altLabel?: string;\\n};\\n\\nconst confirmState = reactive({\\n  open: false,\\n  title: '',\\n  message: '',\\n  confirmLabel: '',\\n  cancelLabel: '',\\n  altLabel: '',\\n  resolve: null as null | ((result: ConfirmResult) => void),\\n});\\n\\nconst allCards = computed(() => [...state.characters, ...state.library]);\\nconst mergedTagsMap = computed(() => {\\n  const map = new Map<string, string[]>();\\n  allCards.value.forEach(card => {\\n    map.set(card.id, getMergedTags(card));\\n  });\\n  return map;\\n});\\nconst manageProfile = ref<ManageProfile | null>(null);\\nconst manageOpeningSummary = ref<ManageOpeningSummary | null>(null);\\nconst manageChatSummary = ref<ManageChatSummary | null>(null);\\nconst exportDialogOpen = ref(false);\\nconst exportSelectedIds = ref<string[]>([]);\\nconst exportCandidates = computed(() => [...allCards.value]);\\nconst exportSearch = ref('');\\nconst exportStatusFilter = ref<'all' | 'imported' | 'unimported'>('all');\\nconst exportTagFilters = ref<string[]>([]);\\nconst batchTagDialogOpen = ref(false);\\nconst batchTagSelectedIds = ref<string[]>([]);\\nconst batchTagSearch = ref('');\\nconst batchTagInput = ref('');\\nconst batchTagSelectedTags = ref<string[]>([]);\\nconst exportAllTags = computed(() => {\\n  const tagSet = new Set<string>();\\n  exportCandidates.value.forEach(card => {\\n    (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).forEach(tag => tagSet.add(tag));\\n  });\\n  exportTagFilters.value.forEach(tag => tagSet.add(tag));\\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\\n});\\nconst exportVisibleCandidates = computed(() => {\\n  let list = exportCandidates.value;\\n  if (exportStatusFilter.value === 'imported') {\\n    list = list.filter(item => item.origin === 'tavern');\\n  } else if (exportStatusFilter.value === 'unimported') {\\n    list = list.filter(item => item.origin === 'library');\\n  }\\n  if (exportTagFilters.value.length) {\\n    list = list.filter(card =>\\n      exportTagFilters.value.some(tag => (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).includes(tag)),\\n    );\\n  }\\n  const keyword = exportSearch.value.trim().toLowerCase();\\n  if (!keyword) {\\n    return list;\\n  }\\n  return list.filter(card => {\\n    if (card.name.toLowerCase().includes(keyword)) {\\n      return true;\\n    }\\n    const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\\n    return tags.some(tag => tag.toLowerCase().includes(keyword));\\n  });\\n});\\nconst exportSelectedSet = computed(() => new Set(exportSelectedIds.value));\\nconst exportSelectedItems = computed(() => exportCandidates.value.filter(item => exportSelectedSet.value.has(item.id)));\\nconst batchTagCandidates = computed(() => filteredCharacters.value);\\nconst batchTagVisibleCandidates = computed(() => {\\n  const keyword = batchTagSearch.value.trim().toLowerCase();\\n  if (!keyword) {\\n    return batchTagCandidates.value;\\n  }\\n  return batchTagCandidates.value.filter(card => {\\n    if (card.name.toLowerCase().includes(keyword)) {\\n      return true;\\n    }\\n    const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\\n    return tags.some(tag => tag.toLowerCase().includes(keyword));\\n  });\\n});\\nconst batchTagSelectedSet = computed(() => new Set(batchTagSelectedIds.value));\\nconst batchTagSuggestions = computed(() => allTags.value);\\n\\nconst FAVORITES_KEY = 'cardhub_favorites';\\nconst favoriteIds = ref<string[]>([]);\\nconst favoriteSet = computed(() => new Set(favoriteIds.value));\\nconst sortKey = ref<'recent' | 'name' | 'tags' | 'imported'>('recent');\\nconst favoritesOnly = ref(false);\\nconst LAST_CHAT_CACHE_KEY = 'cardhub_last_chat_cache';\\nconst lastChatCache = ref<Record<string, number>>({});\\nconst IMPORT_CACHE_KEY = 'cardhub_import_cache';\\nconst importCache = ref<Record<string, number>>({});\\n\\ntype CardHubTheme = {\\n  bgStart: string;\\n  bgEnd: string;\\n  surface: string;\\n  surfaceAlt: string;\\n  text: string;\\n  textMuted: string;\\n  accent: string;\\n  accentStrong: string;\\n  border: string;\\n};\\n\\nconst THEME_KEY = 'cardhub_theme';\\nconst defaultTheme: CardHubTheme = {\\n  bgStart: '#f6f8fb',\\n  bgEnd: '#e6ebf2',\\n  surface: '#fdfdfe',\\n  surfaceAlt: '#f1f4f9',\\n  text: '#1b1e22',\\n  textMuted: '#6b7480',\\n  accent: '#7fb3e1',\\n  accentStrong: '#243a52',\\n  border: '#d5dde8',\\n};\\n\\nconst themeDialogOpen = ref(false);\\nconst themeCurrent = ref<CardHubTheme>({ ...defaultTheme });\\nconst themeDraft = reactive<CardHubTheme>({ ...defaultTheme });\\nconst themeStyle = computed<Record<string, string>>(() => {\\n  const theme = themeDialogOpen.value ? (themeDraft as CardHubTheme) : themeCurrent.value;\\n  return {\\n    '--cardhub-bg-start': theme.bgStart,\\n    '--cardhub-bg-end': theme.bgEnd,\\n    '--cardhub-surface': theme.surface,\\n    '--cardhub-surface-alt': theme.surfaceAlt,\\n    '--cardhub-text': theme.text,\\n    '--cardhub-text-muted': theme.textMuted,\\n    '--cardhub-accent': theme.accent,\\n    '--cardhub-accent-strong': theme.accentStrong,\\n    '--cardhub-border': theme.border,\\n    '--cardhub-surface-rgb': hexToRgb(theme.surface),\\n    '--cardhub-surface-alt-rgb': hexToRgb(theme.surfaceAlt),\\n    '--cardhub-border-rgb': hexToRgb(theme.border),\\n    '--cardhub-accent-rgb': hexToRgb(theme.accent),\\n    '--cardhub-accent-strong-rgb': hexToRgb(theme.accentStrong),\\n    '--cardhub-accent-text': contrastTextColor(theme.accent),\\n    '--cardhub-accent-strong-text': contrastTextColor(theme.accentStrong),\\n  };\\n});\\nconst themePresets = [\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#f6f8fb',\\n      bgEnd: '#e6ebf2',\\n      surface: '#fdfdfe',\\n      surfaceAlt: '#f1f4f9',\\n      text: '#1b1e22',\\n      textMuted: '#6b7480',\\n      accent: '#7fb3e1',\\n      accentStrong: '#243a52',\\n      border: '#d5dde8',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#fdfaf4',\\n      bgEnd: '#f2ebe1',\\n      surface: '#fffefb',\\n      surfaceAlt: '#f7efe6',\\n      text: '#1d1a17',\\n      textMuted: '#7a6f63',\\n      accent: '#e3a981',\\n      accentStrong: '#3f2c22',\\n      border: '#e4d7c8',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#14181d',\\n      bgEnd: '#0d1116',\\n      surface: '#1e242b',\\n      surfaceAlt: '#242b34',\\n      text: '#eef2f7',\\n      textMuted: '#b2bdc9',\\n      accent: '#6fa2d1',\\n      accentStrong: '#d7e6f4',\\n      border: '#36414c',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#f7f1e7',\\n      bgEnd: '#e6d8c6',\\n      surface: '#fcf6ee',\\n      surfaceAlt: '#f2e4d6',\\n      text: '#2a1f18',\\n      textMuted: '#8a6d5a',\\n      accent: '#c47b52',\\n      accentStrong: '#3e2a22',\\n      border: '#ddc7b4',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#fbf1ea',\\n      bgEnd: '#ecd5c8',\\n      surface: '#fff7f1',\\n      surfaceAlt: '#f4e1d6',\\n      text: '#2d2018',\\n      textMuted: '#8b6a5a',\\n      accent: '#d17a4f',\\n      accentStrong: '#4c2d21',\\n      border: '#e3c3b3',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#f2fbf7',\\n      bgEnd: '#dcefe7',\\n      surface: '#f9fffd',\\n      surfaceAlt: '#e8f4f0',\\n      text: '#1a2a26',\\n      textMuted: '#5f7a73',\\n      accent: '#60b6a4',\\n      accentStrong: '#1f4c43',\\n      border: '#c5ddd5',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#f3f8fb',\\n      bgEnd: '#d9e7f3',\\n      surface: '#f9fcff',\\n      surfaceAlt: '#e9f2f9',\\n      text: '#1b2530',\\n      textMuted: '#5f7388',\\n      accent: '#5da3cf',\\n      accentStrong: '#1f3e57',\\n      border: '#c8d9e7',\\n    },\\n  },\\n  {\\n    name: '',\\n    value: {\\n      bgStart: '#2a2d33',\\n      bgEnd: '#1e2126',\\n      surface: '#333741',\\n      surfaceAlt: '#3b404b',\\n      text: '#f3f5f8',\\n      textMuted: '#c1c7d0',\\n      accent: '#9aa6b2',\\n      accentStrong: '#e0e5ea',\\n      border: '#4b5261',\\n    },\\n  },\\n] as const;\\nconst manageDetails = computed(() => {\\n  const profile = manageProfile.value;\\n  if (!profile) {\\n    return [] as ManageDetail[];\\n  }\\n  const details: ManageDetail[] = [];\\n  const pushDetail = (label: string, value: string, maxChars = 240) => {\\n    const preview = previewDetailText(value, 3, maxChars);\\n    if (preview) {\\n      details.push({ label, value: preview });\\n    }\\n  };\\n  pushDetail('', profile.description ?? '');\\n  pushDetail('', profile.personality ?? '');\\n  pushDetail('', profile.scenario ?? '');\\n  pushDetail('', profile.creatorNotes ?? '');\\n  pushDetail('', profile.systemPrompt ?? '', 200);\\n  pushDetail('', profile.postHistory ?? '', 200);\\n  pushDetail('', profile.creator ?? '', 80);\\n  return details;\\n});\\n\\nconst manageDetailsHint = computed(() => {\\n  if (!manageCard.value || manageDetails.value.length) {\\n    return '';\\n  }\\n  if (manageCard.value.origin === 'library') {\\n    return '';\\n  }\\n  return '';\\n});\\n\\nconst manageChatHint = computed(() => {\\n  if (manageCard.value?.origin === 'library') {\\n    return '';\\n  }\\n  return '';\\n});\\nconst manageOverview = computed(() => {\\n  const items: ManageOverviewItem[] = [];\\n  const profile = manageProfile.value;\\n  const worldName = profile?.worldBookName?.trim() || '';\\n  const worldCount = profile?.worldBookCount;\\n  let worldValue = '';\\n  let worldHint = '';\\n  if (worldName || typeof worldCount === 'number') {\\n    worldValue = worldName || '';\\n    worldHint = typeof worldCount === 'number' ? `${worldCount} ` : '';\\n  }\\n  items.push({ label: '', value: worldValue, hint: worldHint });\\n\\n  const chat = manageChatSummary.value;\\n  let chatValue = '';\\n  let chatHint = '';\\n  if (chat && chat.total > 0) {\\n    chatValue = `${chat.total} `;\\n    if (chat.latest) {\\n      chatHint = `${chat.latest}`;\\n    }\\n  }\\n  items.push({ label: '', value: chatValue, hint: chatHint });\\n\\n  const opening = manageOpeningSummary.value;\\n  let openingValue = '';\\n  let openingHint = '';\\n  if (opening && opening.total > 0) {\\n    openingValue = `${opening.total} `;\\n    openingHint = opening.alternate > 0 ? `${opening.alternate} ` : '';\\n  }\\n  items.push({ label: '', value: openingValue, hint: openingHint });\\n  return items;\\n});\\n\\nconst filteredCharacters = computed(() => {\\n  const list = applyFavoriteFilter(applyStatusFilter(allCards.value));\\n  const keyword = state.search.trim().toLowerCase();\\n  if (!keyword) {\\n    return sortCards(applyTagFilter(list));\\n  }\\n  return sortCards(\\n    applyTagFilter(list).filter(character => {\\n      const name = character.name.toLowerCase();\\n      if (name.includes(keyword)) {\\n        return true;\\n      }\\n      const tags = mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\\n    }),\\n  );\\n});\\n\\nconst totalPages = computed(() => {\\n  const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\\n  return total > 0 ? total : 1;\\n});\\n\\nconst pagedCharacters = computed(() => {\\n  const start = (currentPage.value - 1) * pageSize.value;\\n  return filteredCharacters.value.slice(start, start + pageSize.value);\\n});\\n\\nconst allTags = computed(() => {\\n  const tagSet = new Set<string>();\\n  allCards.value.forEach(character => {\\n    (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).forEach(tag => tagSet.add(tag));\\n  });\\n  selectedTags.value.forEach(tag => tagSet.add(tag));\\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\\n});\\n\\nfunction avatarUrl(character: CardHubItem, useFull = false): string | null {\\n  const avatar = character.avatar;\\n  if (!avatar) {\\n    return null;\\n  }\\n  if (/^(data:|https?:|\\\\/)/.test(avatar)) {\\n    return avatar;\\n  }\\n  if (useFull && character.origin === 'tavern') {\\n    return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\\n  }\\n  return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\\n}\\n\\nfunction avatarStyle(character: CardHubItem): Record<string, string> {\\n  const url = avatarUrl(character);\\n  return url ? { backgroundImage: `url(${url})` } : {};\\n}\\n\\nfunction displayTags(character: CardHubItem): string[] {\\n  return mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\\n}\\n\\nfunction applyFavoriteFilter(list: CardHubItem[]): CardHubItem[] {\\n  if (!favoritesOnly.value) {\\n    return list;\\n  }\\n  return list.filter(item => favoriteSet.value.has(item.id));\\n}\\n\\nfunction getFavoriteList(): string[] {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  const raw = vars?.[FAVORITES_KEY];\\n  return Array.isArray(raw) ? raw.filter(item => typeof item === 'string') : [];\\n}\\n\\nfunction saveFavoriteList(list: string[]) {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [FAVORITES_KEY]: list });\\n}\\n\\nfunction loadLastChatCache(): Record<string, number> {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  const raw = vars?.[LAST_CHAT_CACHE_KEY];\\n  if (!raw || typeof raw !== 'object') {\\n    return {};\\n  }\\n  const entries = Object.entries(raw as Record<string, unknown>).filter(\\n    ([, value]) => typeof value === 'number' && !Number.isNaN(value),\\n  );\\n  return Object.fromEntries(entries) as Record<string, number>;\\n}\\n\\nfunction saveLastChatCache(cache: Record<string, number>) {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [LAST_CHAT_CACHE_KEY]: cache });\\n}\\n\\nfunction loadImportCache(): Record<string, number> {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  const raw = vars?.[IMPORT_CACHE_KEY];\\n  if (!raw || typeof raw !== 'object') {\\n    return {};\\n  }\\n  const entries = Object.entries(raw as Record<string, unknown>).filter(\\n    ([, value]) => typeof value === 'number' && !Number.isNaN(value),\\n  );\\n  return Object.fromEntries(entries) as Record<string, number>;\\n}\\n\\nfunction saveImportCache(cache: Record<string, number>) {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [IMPORT_CACHE_KEY]: cache });\\n}\\n\\nfunction getChatCacheKey(card: CardHubItem): string | null {\\n  if (card.origin !== 'tavern') {\\n    return null;\\n  }\\n  if (card.avatar) {\\n    return `avatar:${card.avatar}`;\\n  }\\n  if (card.name) {\\n    return `name:${card.name}`;\\n  }\\n  return null;\\n}\\n\\nfunction getImportAt(card: CardHubItem): number {\\n  if (typeof card.createdAt === 'number' && card.createdAt > 0) {\\n    return card.createdAt;\\n  }\\n  const key = getChatCacheKey(card);\\n  return key ? (importCache.value[key] ?? 0) : 0;\\n}\\n\\nfunction getLastChatAt(card: CardHubItem): number {\\n  if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\\n    return card.lastChatAt;\\n  }\\n  const key = getChatCacheKey(card);\\n  return key ? (lastChatCache.value[key] ?? 0) : 0;\\n}\\n\\nfunction updateLastChatCache(key: string, timestamp: number) {\\n  const next = { ...lastChatCache.value, [key]: timestamp };\\n  lastChatCache.value = next;\\n  saveLastChatCache(next);\\n}\\n\\nfunction updateLastChatCacheForCard(card: CardHubItem, timestamp: number) {\\n  if (timestamp <= 0 || card.origin !== 'tavern') {\\n    return;\\n  }\\n  const keys = new Set<string>();\\n  if (card.avatar) {\\n    keys.add(`avatar:${card.avatar}`);\\n  }\\n  if (card.name) {\\n    keys.add(`name:${card.name}`);\\n  }\\n  if (!keys.size) {\\n    return;\\n  }\\n  const next = { ...lastChatCache.value };\\n  let changed = false;\\n  keys.forEach(key => {\\n    if ((next[key] ?? 0) < timestamp) {\\n      next[key] = timestamp;\\n      changed = true;\\n    }\\n  });\\n  if (changed) {\\n    lastChatCache.value = next;\\n    saveLastChatCache(next);\\n  }\\n}\\nfunction updateImportCache(next: Record<string, number>) {\\n  importCache.value = next;\\n  saveImportCache(next);\\n}\\n\\nfunction isFavorite(id: string): boolean {\\n  return favoriteSet.value.has(id);\\n}\\n\\nfunction toggleFavorite(card: CardHubItem) {\\n  if (favoriteSet.value.has(card.id)) {\\n    favoriteIds.value = favoriteIds.value.filter(item => item !== card.id);\\n  } else {\\n    favoriteIds.value = [...favoriteIds.value, card.id];\\n  }\\n  saveFavoriteList(favoriteIds.value);\\n}\\n\\nfunction sortCards(list: CardHubItem[]): CardHubItem[] {\\n  const withScore = list.map(item => {\\n    const tags = mergedTagsMap.value.get(item.id) ?? getMergedTags(item);\\n    return {\\n      item,\\n      tagCount: tags.length,\\n    };\\n  });\\n  const byName = (a: string, b: string) => a.localeCompare(b, 'zh-CN');\\n\\n  return withScore\\n    .sort((lhs, rhs) => {\\n      const a = lhs.item;\\n      const b = rhs.item;\\n      if (sortKey.value === 'name') {\\n        return byName(a.name, b.name);\\n      }\\n      if (sortKey.value === 'tags') {\\n        if (rhs.tagCount !== lhs.tagCount) {\\n          return rhs.tagCount - lhs.tagCount;\\n        }\\n        return byName(a.name, b.name);\\n      }\\n      if (sortKey.value === 'imported') {\\n        const aTime = getImportAt(a);\\n        const bTime = getImportAt(b);\\n        if (bTime !== aTime) {\\n          return bTime - aTime;\\n        }\\n        return byName(a.name, b.name);\\n      }\\n      const aTime = getLastChatAt(a);\\n      const bTime = getLastChatAt(b);\\n      if (bTime !== aTime) {\\n        return bTime - aTime;\\n      }\\n      const aCreated = a.createdAt ?? 0;\\n      const bCreated = b.createdAt ?? 0;\\n      if (bCreated !== aCreated) {\\n        return bCreated - aCreated;\\n      }\\n      return byName(a.name, b.name);\\n    })\\n    .map(entry => entry.item);\\n}\\n\\nconst manageAvatarUrl = computed(() => {\\n  if (!manageCard.value) {\\n    return null;\\n  }\\n  return avatarUrl(manageCard.value, true);\\n});\\n\\nfunction applyStatusFilter(list: CardHubItem[]): CardHubItem[] {\\n  if (statusFilter.value === 'imported') {\\n    return list.filter(item => item.origin === 'tavern');\\n  }\\n  if (statusFilter.value === 'unimported') {\\n    return list.filter(item => item.origin === 'library');\\n  }\\n  return list;\\n}\\n\\nfunction applyTagFilter(list: CardHubItem[]): CardHubItem[] {\\n  if (!selectedTags.value.length) {\\n    return list;\\n  }\\n  return list.filter(character =>\\n    selectedTags.value.some(tag => (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).includes(tag)),\\n  );\\n}\\n\\nfunction toggleTagFilter(tag: string) {\\n  if (selectedTags.value.includes(tag)) {\\n    selectedTags.value = selectedTags.value.filter(item => item !== tag);\\n  } else {\\n    selectedTags.value = [...selectedTags.value, tag];\\n  }\\n}\\n\\nfunction clearTagFilter() {\\n  selectedTags.value = [];\\n}\\n\\nfunction hexToRgb(value: string): string {\\n  const hex = value.replace('#', '');\\n  if (hex.length !== 6) {\\n    return '0, 0, 0';\\n  }\\n  const r = Number.parseInt(hex.slice(0, 2), 16);\\n  const g = Number.parseInt(hex.slice(2, 4), 16);\\n  const b = Number.parseInt(hex.slice(4, 6), 16);\\n  return `${r}, ${g}, ${b}`;\\n}\\n\\nfunction contrastTextColor(value: string): string {\\n  const rgb = hexToRgb(value)\\n    .split(',')\\n    .map(part => Number(part.trim()));\\n  if (rgb.length !== 3) {\\n    return '#1b1b1b';\\n  }\\n  const [r, g, b] = rgb.map(channel => channel / 255);\\n  const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\\n  return luminance > 0.6 ? '#1b1b1b' : '#ffffff';\\n}\\n\\nfunction normalizeTheme(raw: unknown): CardHubTheme {\\n  if (!raw || typeof raw !== 'object') {\\n    return { ...defaultTheme };\\n  }\\n  const data = raw as Record<string, string>;\\n  const pick = (key: keyof CardHubTheme) => {\\n    const value = data[key];\\n    return /^#[0-9a-f]{6}$/i.test(value) ? value : defaultTheme[key];\\n  };\\n  return {\\n    bgStart: pick('bgStart'),\\n    bgEnd: pick('bgEnd'),\\n    surface: pick('surface'),\\n    surfaceAlt: pick('surfaceAlt'),\\n    text: pick('text'),\\n    textMuted: pick('textMuted'),\\n    accent: pick('accent'),\\n    accentStrong: pick('accentStrong'),\\n    border: pick('border'),\\n  };\\n}\\n\\nfunction getCardHubRoot(): HTMLElement | null {\\n  try {\\n    return (window.parent?.document ?? document).querySelector<HTMLElement>('.cardhub-root');\\n  } catch {\\n    return document.querySelector<HTMLElement>('.cardhub-root');\\n  }\\n}\\n\\nlet themeFrame = 0;\\nlet themeTimer: number | null = null;\\nfunction scheduleThemeApply(theme: CardHubTheme) {\\n  if (themeFrame) {\\n    cancelAnimationFrame(themeFrame);\\n    themeFrame = 0;\\n  }\\n  if (themeTimer) {\\n    window.clearTimeout(themeTimer);\\n  }\\n  themeTimer = window.setTimeout(() => {\\n    themeTimer = null;\\n    themeFrame = requestAnimationFrame(() => {\\n      themeFrame = 0;\\n      applyTheme(theme);\\n    });\\n  }, 80);\\n}\\n\\nfunction applyTheme(theme: CardHubTheme) {\\n  const root = getCardHubRoot();\\n  if (!root) {\\n    return;\\n  }\\n  root.style.setProperty('--cardhub-bg-start', theme.bgStart);\\n  root.style.setProperty('--cardhub-bg-end', theme.bgEnd);\\n  root.style.setProperty('--cardhub-surface', theme.surface);\\n  root.style.setProperty('--cardhub-surface-alt', theme.surfaceAlt);\\n  root.style.setProperty('--cardhub-text', theme.text);\\n  root.style.setProperty('--cardhub-text-muted', theme.textMuted);\\n  root.style.setProperty('--cardhub-accent', theme.accent);\\n  root.style.setProperty('--cardhub-accent-strong', theme.accentStrong);\\n  root.style.setProperty('--cardhub-border', theme.border);\\n  root.style.setProperty('--cardhub-surface-rgb', hexToRgb(theme.surface));\\n  root.style.setProperty('--cardhub-surface-alt-rgb', hexToRgb(theme.surfaceAlt));\\n  root.style.setProperty('--cardhub-border-rgb', hexToRgb(theme.border));\\n  root.style.setProperty('--cardhub-accent-rgb', hexToRgb(theme.accent));\\n  root.style.setProperty('--cardhub-accent-strong-rgb', hexToRgb(theme.accentStrong));\\n  root.style.setProperty('--cardhub-accent-text', contrastTextColor(theme.accent));\\n  root.style.setProperty('--cardhub-accent-strong-text', contrastTextColor(theme.accentStrong));\\n}\\n\\nfunction loadThemeFromGlobal(): CardHubTheme {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  return normalizeTheme(vars?.[THEME_KEY]);\\n}\\n\\nfunction saveThemeToGlobal(theme: CardHubTheme) {\\n  const vars = TavernHelper.getVariables({ type: 'global' }) as Record<string, unknown>;\\n  TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [THEME_KEY]: theme });\\n}\\n\\nfunction openThemeDialog() {\\n  const current = themeCurrent.value;\\n  Object.assign(themeDraft, current);\\n  themeDialogOpen.value = true;\\n  nextTick(() => scheduleThemeApply(current));\\n}\\n\\nfunction closeThemeDialog() {\\n  themeDialogOpen.value = false;\\n  Object.assign(themeDraft, themeCurrent.value);\\n  scheduleThemeApply(themeCurrent.value);\\n}\\n\\nfunction resetThemeDraft() {\\n  Object.assign(themeDraft, defaultTheme);\\n}\\n\\nfunction saveThemeDraft() {\\n  themeCurrent.value = { ...themeDraft };\\n  saveThemeToGlobal(themeCurrent.value);\\n  scheduleThemeApply(themeCurrent.value);\\n  themeDialogOpen.value = false;\\n}\\n\\nfunction applyThemePreset(preset: { name: string; value: CardHubTheme }) {\\n  Object.assign(themeDraft, preset.value);\\n}\\nfunction toggleExportTagFilter(tag: string) {\\n  if (exportTagFilters.value.includes(tag)) {\\n    exportTagFilters.value = exportTagFilters.value.filter(item => item !== tag);\\n  } else {\\n    exportTagFilters.value = [...exportTagFilters.value, tag];\\n  }\\n}\\n\\nfunction clearExportTagFilter() {\\n  exportTagFilters.value = [];\\n}\\n\\nfunction openExportDialog() {\\n  if (!exportVisibleCandidates.value.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\\n  exportDialogOpen.value = true;\\n}\\n\\nwatch(\\n  themeDraft,\\n  value => {\\n    if (themeDialogOpen.value) {\\n      scheduleThemeApply({ ...(value as CardHubTheme) });\\n    }\\n  },\\n  { deep: true },\\n);\\n\\nonMounted(() => {\\n  const theme = loadThemeFromGlobal();\\n  themeCurrent.value = theme;\\n  Object.assign(themeDraft, theme);\\n  nextTick(() => scheduleThemeApply(theme));\\n  favoriteIds.value = getFavoriteList();\\n  lastChatCache.value = loadLastChatCache();\\n  importCache.value = loadImportCache();\\n  void warmRecentChatCache(allCards.value);\\n  warmImportCache(allCards.value);\\n});\\n\\nfunction closeExportDialog() {\\n  exportDialogOpen.value = false;\\n}\\n\\nfunction openBatchTagDialog() {\\n  if (!batchTagVisibleCandidates.value.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  batchTagInput.value = '';\\n  batchTagSearch.value = '';\\n  batchTagSelectedTags.value = [];\\n  batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\\n  batchTagDialogOpen.value = true;\\n}\\n\\nfunction closeBatchTagDialog() {\\n  batchTagDialogOpen.value = false;\\n}\\n\\nfunction toggleBatchTagSelection(id: string) {\\n  if (batchTagSelectedSet.value.has(id)) {\\n    batchTagSelectedIds.value = batchTagSelectedIds.value.filter(item => item !== id);\\n  } else {\\n    batchTagSelectedIds.value = [...batchTagSelectedIds.value, id];\\n  }\\n}\\n\\nfunction selectAllBatchTags() {\\n  batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\\n}\\n\\nfunction clearBatchTagSelection() {\\n  batchTagSelectedIds.value = [];\\n}\\n\\nfunction parseBatchTags(input: string, selected: string[]): string[] {\\n  const items = input\\n    .split(/[,\\\\n;]/)\\n    .map(part => part.trim())\\n    .filter(Boolean);\\n  return Array.from(new Set([...items, ...selected]));\\n}\\n\\nfunction getCardsByIds(ids: string[]): CardHubItem[] {\\n  const map = new Map(allCards.value.map(card => [card.id, card]));\\n  return ids.map(id => map.get(id)).filter(Boolean) as CardHubItem[];\\n}\\n\\nfunction toggleBatchTagSuggestion(tag: string) {\\n  if (batchTagSelectedTags.value.includes(tag)) {\\n    batchTagSelectedTags.value = batchTagSelectedTags.value.filter(item => item !== tag);\\n  } else {\\n    batchTagSelectedTags.value = [...batchTagSelectedTags.value, tag];\\n  }\\n}\\n\\nfunction isSameTagSet(current: string[], next: string[]): boolean {\\n  if (current.length !== next.length) {\\n    return false;\\n  }\\n  const currentSet = new Set(current);\\n  return next.every(tag => currentSet.has(tag));\\n}\\n\\nasync function applyBatchTags(mode: 'add' | 'remove') {\\n  if (!batchTagSelectedIds.value.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const tags = parseBatchTags(batchTagInput.value, batchTagSelectedTags.value);\\n  if (!tags.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const actionLabel = mode === 'add' ? '' : '';\\n  const message = `${actionLabel}${tags.join('')}\\\\n ${batchTagSelectedIds.value.length} `;\\n  const result = await openConfirm({\\n    title: `${actionLabel}`,\\n    message,\\n    confirmLabel: `${actionLabel}`,\\n    cancelLabel: '',\\n  });\\n  if (result !== 'confirm') {\\n    return;\\n  }\\n  const cards = getCardsByIds(batchTagSelectedIds.value);\\n  let changed = 0;\\n  cards.forEach(card => {\\n    const currentTags = displayTags(card);\\n    const nextSet = new Set(currentTags);\\n    if (mode === 'add') {\\n      tags.forEach(tag => nextSet.add(tag));\\n    } else {\\n      tags.forEach(tag => nextSet.delete(tag));\\n    }\\n    const nextTags = Array.from(nextSet);\\n    if (!isSameTagSet(currentTags, nextTags)) {\\n      applyTagUpdate(card, nextTags);\\n      changed += 1;\\n    }\\n  });\\n  toastr.success(` ${changed} `);\\n}\\n\\nfunction isExportSelected(id: string): boolean {\\n  return exportSelectedSet.value.has(id);\\n}\\n\\nfunction toggleExportSelection(id: string) {\\n  if (exportSelectedSet.value.has(id)) {\\n    exportSelectedIds.value = exportSelectedIds.value.filter(item => item !== id);\\n  } else {\\n    exportSelectedIds.value = [...exportSelectedIds.value, id];\\n  }\\n}\\n\\nfunction selectAllExport() {\\n  exportSelectedIds.value = exportCandidates.value.map(item => item.id);\\n}\\n\\nfunction clearExportSelection() {\\n  exportSelectedIds.value = [];\\n}\\n\\nwatch([() => state.search, statusFilter, () => selectedTags.value.join('|'), sortKey, favoritesOnly], () => {\\n  currentPage.value = 1;\\n});\\n\\nwatch([filteredCharacters, totalPages], () => {\\n  if (currentPage.value > totalPages.value) {\\n    currentPage.value = totalPages.value;\\n  }\\n  if (currentPage.value < 1) {\\n    currentPage.value = 1;\\n  }\\n});\\n\\nwatch([sortKey, allCards], () => {\\n  if (sortKey.value === 'recent') {\\n    void warmRecentChatCache(allCards.value);\\n  }\\n  if (sortKey.value === 'imported') {\\n    warmImportCache(allCards.value);\\n  }\\n});\\n\\nfunction prevPage() {\\n  if (currentPage.value > 1) {\\n    currentPage.value -= 1;\\n  }\\n}\\n\\nfunction nextPage() {\\n  if (currentPage.value < totalPages.value) {\\n    currentPage.value += 1;\\n  }\\n}\\n\\nfunction normalizeNameKey(value: string): string {\\n  return value.trim().toLocaleLowerCase();\\n}\\n\\nfunction normalizeAvatarKey(value: string): string {\\n  let raw = value.trim();\\n  if (!raw) {\\n    return '';\\n  }\\n  try {\\n    raw = decodeURIComponent(raw);\\n  } catch {\\n    // ignore\\n  }\\n  raw = raw.split('?')[0];\\n  if (raw.includes('/')) {\\n    raw = raw.split('/').pop() ?? raw;\\n  }\\n  return raw.trim().toLowerCase();\\n}\\n\\nfunction findDuplicateCharacterByName(name: string): CardHubItem | null {\\n  const target = normalizeNameKey(name);\\n  if (!target) {\\n    return null;\\n  }\\n  return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\\n}\\n\\nfunction openConfirm(options: ConfirmOptions): Promise<ConfirmResult> {\\n  if (confirmState.open && confirmState.resolve) {\\n    confirmState.resolve('cancel');\\n  }\\n  confirmState.title = options.title ?? '';\\n  confirmState.message = options.message;\\n  confirmState.confirmLabel = options.confirmLabel ?? '';\\n  confirmState.cancelLabel = options.cancelLabel ?? '';\\n  confirmState.altLabel = options.altLabel ?? '';\\n  confirmState.open = true;\\n\\n  return new Promise(resolve => {\\n    confirmState.resolve = resolve;\\n  });\\n}\\n\\nfunction resolveConfirm(result: ConfirmResult) {\\n  if (!confirmState.open) {\\n    return;\\n  }\\n  confirmState.open = false;\\n  const resolver = confirmState.resolve;\\n  confirmState.resolve = null;\\n  if (resolver) {\\n    resolver(result);\\n  }\\n}\\n\\nfunction removeTag(character: CardHubItem, tag: string) {\\n  const nextTags = getMergedTags(character).filter(item => item !== tag);\\n  applyTagUpdate(character, nextTags);\\n}\\n\\nfunction tagKey(character: CardHubItem): string {\\n  return character.id;\\n}\\n\\nfunction startTagEdit(character: CardHubItem) {\\n  activeTagKey.value = tagKey(character);\\n  tagInput.value = '';\\n  nextTick(() => {\\n    const input = document.querySelector<HTMLInputElement>('.cardhub-tag-input');\\n    input?.focus();\\n  });\\n}\\n\\nfunction confirmTag(character: CardHubItem) {\\n  if (activeTagKey.value !== tagKey(character)) {\\n    return;\\n  }\\n  const input = tagInput.value.trim();\\n  if (input) {\\n    const nextTags = [...getMergedTags(character), input];\\n    applyTagUpdate(character, nextTags);\\n  }\\n  cancelTagEdit();\\n}\\n\\nfunction cancelTagEdit() {\\n  activeTagKey.value = null;\\n  tagInput.value = '';\\n}\\n\\nfunction applyTagUpdate(character: CardHubItem, nextTags: string[]) {\\n  if (character.origin === 'library') {\\n    const updatedLibrary = updateLibraryTags(character.id, nextTags);\\n    setLibrary(updatedLibrary);\\n  } else {\\n    const next = updateCharacterTags(character, nextTags);\\n    character.tags = next;\\n    setCharacters([...state.characters]);\\n  }\\n}\\n\\nfunction triggerImport() {\\n  importInput.value?.click();\\n}\\n\\nasync function handleImportFiles(event: Event) {\\n  const target = event.target as HTMLInputElement | null;\\n  const files = target?.files;\\n  if (!files || !files.length) {\\n    return;\\n  }\\n  const updated = await addToLibrary(files, state.library);\\n  setLibrary(updated);\\n  target.value = '';\\n}\\n\\nasync function exportSelected() {\\n  openExportDialog();\\n}\\n\\nasync function confirmExportSelected() {\\n  const list = exportSelectedItems.value;\\n  if (!list.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const tagLabel = selectedTags.value.length ? selectedTags.value.join('') : '';\\n  const statusLabel = statusFilter.value === 'all' ? '' : statusFilter.value === 'imported' ? '' : '';\\n  const searchLabel = state.search.trim() || '';\\n  const message =\\n    ` ${list.length} \\\\n` +\\n    `${statusLabel}\\\\n` +\\n    `${tagLabel}\\\\n` +\\n    `${searchLabel}\\\\n` +\\n    ``;\\n\\n  const result = await openConfirm({\\n    title: '',\\n    message,\\n    confirmLabel: '',\\n    cancelLabel: '',\\n  });\\n  if (result !== 'confirm') {\\n    return;\\n  }\\n  exportDialogOpen.value = false;\\n  for (const item of list) {\\n    await exportCard(item);\\n    await sleep(120);\\n  }\\n  toastr.success(` ${list.length} `);\\n}\\n\\nasync function handleCardAction(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    await importLibraryCard(card);\\n  } else {\\n    exportCard(card);\\n  }\\n}\\n\\nasync function importLibraryCard(card: CardHubItem) {\\n  if (!card.raw || !card.rawType) {\\n    toastr.error('');\\n    return;\\n  }\\n  const duplicate = findDuplicateCharacterByName(card.name);\\n  if (duplicate) {\\n    toastr.warning(`${duplicate.name}`);\\n    return;\\n  }\\n  const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\\n  delete (headers as Record<string, string>)['Content-Type'];\\n\\n  if (card.rawType === 'png') {\\n    const blob = await dataUrlToBlob(card.raw);\\n    await TavernHelper.importRawCharacter(card.name, blob);\\n  } else {\\n    const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\\n    const form = new FormData();\\n    form.append('avatar', file);\\n    form.append('file_type', 'json');\\n    form.append('preserved_name', file.name);\\n    await fetch('/api/characters/import', {\\n      method: 'POST',\\n      headers,\\n      body: form,\\n      cache: 'no-cache',\\n    });\\n  }\\n\\n  setLibrary(removeFromLibrary(card.id));\\n  const characters = await fetchCharacterSummaries();\\n  setCharacters(characters);\\n  toastr.success(` ${card.name}`);\\n}\\n\\nasync function exportCard(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    await exportLibraryCard(card);\\n    return;\\n  }\\n  if (!card.avatar) {\\n    toastr.error('');\\n    return;\\n  }\\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\\n  if (!avatarPath) {\\n    toastr.error('');\\n    return;\\n  }\\n  const response = await fetch(avatarPath, { cache: 'no-cache' });\\n  const blob = await response.blob();\\n  downloadBlob(blob, `${card.name}.png`);\\n}\\n\\nasync function exportLibraryCard(card: CardHubItem) {\\n  if (!card.raw || !card.rawType) {\\n    toastr.error('');\\n    return;\\n  }\\n  if (card.rawType === 'png') {\\n    const blob = await dataUrlToBlob(card.raw);\\n    downloadBlob(blob, `${card.name}.png`);\\n    return;\\n  }\\n  const blob = new Blob([card.raw], { type: 'application/json' });\\n  downloadBlob(blob, `${card.name}.json`);\\n}\\n\\nasync function openManage(card: CardHubItem) {\\n  const requestId = ++manageRequestId;\\n  manageCard.value = card;\\n  manageOpenings.value = [];\\n  manageChats.value = [];\\n  manageProfile.value = null;\\n  manageOpeningSummary.value = null;\\n  manageChatSummary.value = null;\\n\\n  const [manageResult, chatsResult] = await Promise.allSettled([resolveManageData(card), resolveRecentChats(card)]);\\n\\n  if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\\n    return;\\n  }\\n\\n  const manageData: ManageData =\\n    manageResult.status === 'fulfilled' ? manageResult.value : { openings: [], profile: null, openingSummary: null };\\n  manageOpenings.value = manageData.openings;\\n  manageProfile.value = manageData.profile;\\n  manageOpeningSummary.value = manageData.openingSummary;\\n\\n  const chatData: ManageChatData = chatsResult.status === 'fulfilled' ? chatsResult.value : { list: [], summary: null };\\n  manageChats.value = chatData.list;\\n  manageChatSummary.value = chatData.summary;\\n}\\n\\nfunction closeManage() {\\n  manageCard.value = null;\\n  manageOpenings.value = [];\\n  manageChats.value = [];\\n  manageProfile.value = null;\\n  manageOpeningSummary.value = null;\\n  manageChatSummary.value = null;\\n}\\n\\nasync function resolveManageData(card: CardHubItem): Promise<ManageData> {\\n  if (card.origin !== 'tavern') {\\n    const data = parseLibraryCardData(card);\\n    return {\\n      openings: extractOpeningMessages(data),\\n      profile: extractCardProfile(data),\\n      openingSummary: extractOpeningSummary(data),\\n    };\\n  }\\n  const raw = await getFullCharacterData(card);\\n  const fallback =\\n    raw ??\\n    TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true } as any) ??\\n    TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true } as any);\\n  const primary = raw ?? fallback;\\n  let openings = extractOpeningMessages(primary);\\n  if (!openings.length && fallback && fallback !== primary) {\\n    openings = extractOpeningMessages(fallback);\\n  }\\n  const openingSummary = extractOpeningSummary(primary ?? fallback);\\n  return {\\n    openings,\\n    profile: extractCardProfile(primary ?? fallback),\\n    openingSummary,\\n  };\\n}\\n\\nfunction parseLibraryCardData(card: CardHubItem): any | null {\\n  if (!card.raw || !card.rawType) {\\n    return null;\\n  }\\n  if (card.rawType === 'json') {\\n    return parseJsonSafe(card.raw);\\n  }\\n  if (card.rawType === 'png') {\\n    return parsePngCardData(card.raw);\\n  }\\n  return null;\\n}\\n\\nfunction parseJsonSafe(raw: string): any | null {\\n  try {\\n    return JSON.parse(raw);\\n  } catch {\\n    return null;\\n  }\\n}\\n\\nfunction parsePngCardData(dataUrl: string): any | null {\\n  const bytes = dataUrlToBytes(dataUrl);\\n  if (!bytes) {\\n    return null;\\n  }\\n  const chunks = extractPngTextChunks(bytes);\\n  const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\\n  for (const chunk of chunks) {\\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\\n      continue;\\n    }\\n    const parsed = parseCardPayload(chunk.value);\\n    if (parsed) {\\n      return parsed;\\n    }\\n  }\\n  return null;\\n}\\n\\nfunction dataUrlToBytes(dataUrl: string): Uint8Array | null {\\n  const comma = dataUrl.indexOf(',');\\n  if (comma < 0) {\\n    return null;\\n  }\\n  const base64 = dataUrl.slice(comma + 1);\\n  try {\\n    const binary = atob(base64);\\n    const bytes = new Uint8Array(binary.length);\\n    for (let i = 0; i < binary.length; i += 1) {\\n      bytes[i] = binary.charCodeAt(i);\\n    }\\n    return bytes;\\n  } catch {\\n    return null;\\n  }\\n}\\n\\nfunction extractPngTextChunks(bytes: Uint8Array): Array<{ key: string; value: string }> {\\n  if (bytes.length < 8) {\\n    return [];\\n  }\\n  const signature = [137, 80, 78, 71, 13, 10, 26, 10];\\n  for (let i = 0; i < signature.length; i += 1) {\\n    if (bytes[i] !== signature[i]) {\\n      return [];\\n    }\\n  }\\n  const chunks: Array<{ key: string; value: string }> = [];\\n  let offset = 8;\\n  while (offset + 8 <= bytes.length) {\\n    const length = readUint32BE(bytes, offset);\\n    const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\\n    const dataStart = offset + 8;\\n    const dataEnd = dataStart + length;\\n    if (dataEnd + 4 > bytes.length) {\\n      break;\\n    }\\n    const data = bytes.subarray(dataStart, dataEnd);\\n    if (type === 'tEXt') {\\n      const entry = parseTextChunk(data);\\n      if (entry) {\\n        chunks.push(entry);\\n      }\\n    } else if (type === 'iTXt') {\\n      const entry = parseIntlTextChunk(data);\\n      if (entry) {\\n        chunks.push(entry);\\n      }\\n    }\\n    offset = dataEnd + 4;\\n  }\\n  return chunks;\\n}\\n\\nfunction parseTextChunk(data: Uint8Array): { key: string; value: string } | null {\\n  const nullIndex = data.indexOf(0);\\n  if (nullIndex < 0) {\\n    return null;\\n  }\\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\\n  const value = bytesToString(data.subarray(nullIndex + 1)).trim();\\n  if (!key || !value) {\\n    return null;\\n  }\\n  return { key, value };\\n}\\n\\nfunction parseIntlTextChunk(data: Uint8Array): { key: string; value: string } | null {\\n  const nullIndex = data.indexOf(0);\\n  if (nullIndex < 0 || nullIndex + 2 >= data.length) {\\n    return null;\\n  }\\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\\n  const compressed = data[nullIndex + 1] === 1;\\n  let cursor = nullIndex + 2;\\n  const langEnd = data.indexOf(0, cursor);\\n  if (langEnd < 0) {\\n    return null;\\n  }\\n  cursor = langEnd + 1;\\n  const translatedEnd = data.indexOf(0, cursor);\\n  if (translatedEnd < 0) {\\n    return null;\\n  }\\n  cursor = translatedEnd + 1;\\n  if (compressed) {\\n    return null;\\n  }\\n  const value = bytesToString(data.subarray(cursor)).trim();\\n  if (!key || !value) {\\n    return null;\\n  }\\n  return { key, value };\\n}\\n\\nfunction parseCardPayload(value: string): any | null {\\n  const trimmed = value.trim();\\n  if (!trimmed) {\\n    return null;\\n  }\\n  const direct = parseJsonSafe(trimmed);\\n  if (direct) {\\n    return direct;\\n  }\\n  if (!isLikelyBase64(trimmed)) {\\n    return null;\\n  }\\n  const decoded = decodeBase64Text(trimmed);\\n  if (!decoded) {\\n    return null;\\n  }\\n  return parseJsonSafe(decoded);\\n}\\n\\nfunction decodeBase64Text(value: string): string | null {\\n  try {\\n    const binary = atob(value);\\n    const bytes = new Uint8Array(binary.length);\\n    for (let i = 0; i < binary.length; i += 1) {\\n      bytes[i] = binary.charCodeAt(i);\\n    }\\n    return new TextDecoder().decode(bytes);\\n  } catch {\\n    return null;\\n  }\\n}\\n\\nfunction isLikelyBase64(value: string): boolean {\\n  if (value.length < 16 || value.length % 4 !== 0) {\\n    return false;\\n  }\\n  return /^[A-Za-z0-9+/=]+$/.test(value);\\n}\\n\\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\\n  return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\\n}\\n\\nfunction bytesToString(bytes: Uint8Array): string {\\n  return new TextDecoder().decode(bytes);\\n}\\n\\nasync function getFullCharacterData(card: CardHubItem): Promise<SillyTavern.v1CharData | null> {\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  if (ctx?.getCharacters) {\\n    try {\\n      await ctx.getCharacters();\\n    } catch (error) {\\n      console.warn('[CardHub] ', error);\\n    }\\n  }\\n  const list = ctx?.characters ?? st?.characters ?? [];\\n  if (!list.length) {\\n    return null;\\n  }\\n  const byAvatar = card.avatar ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar) : -1;\\n  const byName = list.findIndex(item => item.name === card.name);\\n  const idx = byAvatar >= 0 ? byAvatar : byName;\\n  if (idx < 0) {\\n    return null;\\n  }\\n  if (ctx?.unshallowCharacter) {\\n    try {\\n      await ctx.unshallowCharacter(idx);\\n    } catch (error) {\\n      console.warn('[CardHub] ', error);\\n    }\\n  }\\n  const updatedList = ctx?.characters ?? list;\\n  const data = updatedList[idx] ?? null;\\n  if (data?.first_mes || data?.data?.first_mes) {\\n    return data;\\n  }\\n  if (ctx?.getCharacterCardFields) {\\n    try {\\n      const fields = await ctx.getCharacterCardFields({ chid: idx });\\n      if (fields?.first_mes || fields?.data?.first_mes) {\\n        return fields;\\n      }\\n    } catch (error) {\\n      console.warn('[CardHub] ', error);\\n    }\\n  }\\n  const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\\n  return fallback ?? data;\\n}\\n\\nfunction extractCardProfile(data: any): ManageProfile | null {\\n  if (!data) {\\n    return null;\\n  }\\n  const profile: ManageProfile = {\\n    description: pickString(data?.description, data?.data?.description),\\n    personality: pickString(data?.personality, data?.data?.personality),\\n    scenario: pickString(data?.scenario, data?.data?.scenario),\\n    creatorNotes: pickString(\\n      data?.creatorcomment,\\n      data?.data?.creatorcomment,\\n      data?.creator_notes,\\n      data?.data?.creator_notes,\\n    ),\\n    systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\\n    postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\\n    creator: pickString(data?.creator, data?.data?.creator),\\n  };\\n  const book = data?.character_book ?? data?.data?.character_book;\\n  if (book) {\\n    profile.worldBookName = pickString(book?.name);\\n    profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\\n  }\\n  const hasValue =\\n    Boolean(profile.description) ||\\n    Boolean(profile.personality) ||\\n    Boolean(profile.scenario) ||\\n    Boolean(profile.creatorNotes) ||\\n    Boolean(profile.systemPrompt) ||\\n    Boolean(profile.postHistory) ||\\n    Boolean(profile.creator) ||\\n    Boolean(profile.worldBookName) ||\\n    typeof profile.worldBookCount === 'number';\\n  return hasValue ? profile : null;\\n}\\n\\nfunction pickString(...values: unknown[]): string {\\n  for (const value of values) {\\n    if (typeof value === 'string') {\\n      const trimmed = value.trim();\\n      if (trimmed) {\\n        return trimmed;\\n      }\\n    }\\n  }\\n  return '';\\n}\\n\\nfunction extractOpeningSummary(data: any): ManageOpeningSummary | null {\\n  if (!data) {\\n    return null;\\n  }\\n  const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\\n  const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\\n  const alt =\\n    data?.alternate_greetings ??\\n    data?.data?.alternate_greetings ??\\n    data?.extensions?.alternate_greetings ??\\n    data?.data?.extensions?.alternate_greetings;\\n  let alternate = 0;\\n  if (Array.isArray(alt)) {\\n    alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\\n  } else if (typeof alt === 'string' && alt.trim()) {\\n    alternate = 1;\\n  }\\n  return {\\n    total: firstCount + alternate,\\n    alternate,\\n  };\\n}\\n\\nfunction extractOpeningMessages(data: any): string[] {\\n  if (!data) {\\n    return [];\\n  }\\n  const list: string[] = [];\\n  const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\\n  if (typeof first === 'string' && first.trim()) {\\n    list.push(first.trim());\\n  }\\n  const alt =\\n    data?.alternate_greetings ??\\n    data?.data?.alternate_greetings ??\\n    data?.extensions?.alternate_greetings ??\\n    data?.data?.extensions?.alternate_greetings;\\n  if (Array.isArray(alt)) {\\n    alt.forEach(item => {\\n      if (typeof item === 'string' && item.trim()) {\\n        list.push(item.trim());\\n      }\\n    });\\n  } else if (typeof alt === 'string' && alt.trim()) {\\n    list.push(alt.trim());\\n  }\\n  return list;\\n}\\n\\nfunction normalizeBriefMessage(value: string): string {\\n  return value\\n    .replace(/<br\\\\s*\\\\/?>/gi, ' ')\\n    .replace(/<[^>]+>/g, ' ')\\n    .replace(/\\\\s+/g, ' ')\\n    .trim();\\n}\\n\\nfunction formatMaybeTimestamp(value: unknown): string {\\n  if (typeof value === 'number' && !Number.isNaN(value)) {\\n    const ms = value < 1e12 ? value * 1000 : value;\\n    return new Date(ms).toLocaleString('zh-CN', { hour12: false });\\n  }\\n  if (typeof value === 'string') {\\n    const trimmed = value.trim();\\n    if (trimmed) {\\n      return trimmed;\\n    }\\n  }\\n  return '';\\n}\\n\\nfunction parseTimestampFromText(raw: string): number | null {\\n  const text = raw.replace(/\\\\.jsonl$/i, '').trim();\\n  const pattern = /(\\\\d{4})[./-](\\\\d{1,2})[./-](\\\\d{1,2})(?:[ T_@-]*(\\\\d{1,2})[:](\\\\d{1,2})(?:[:](\\\\d{1,2}))?)?/;\\n  const match = text.match(pattern);\\n  if (!match) {\\n    return null;\\n  }\\n  const year = Number(match[1]);\\n  const month = Number(match[2]);\\n  const day = Number(match[3]);\\n  const hour = match[4] ? Number(match[4]) : 0;\\n  const minute = match[5] ? Number(match[5]) : 0;\\n  const second = match[6] ? Number(match[6]) : 0;\\n  if (!year || !month || !day) {\\n    return null;\\n  }\\n  const date = new Date(year, month - 1, day, hour, minute, second);\\n  const time = date.getTime();\\n  return Number.isNaN(time) ? null : time;\\n}\\n\\nfunction coerceTimestamp(value: unknown): number | null {\\n  if (typeof value === 'number' && !Number.isNaN(value)) {\\n    return value < 1e12 ? value * 1000 : value;\\n  }\\n  if (typeof value === 'string') {\\n    const parsed = Date.parse(value);\\n    if (!Number.isNaN(parsed)) {\\n      return parsed;\\n    }\\n  }\\n  return null;\\n}\\n\\nfunction extractChatLatestTimestamp(entry: any): number | null {\\n  const candidates = [\\n    entry?.last_message_time,\\n    entry?.last_message_date,\\n    entry?.update_time,\\n    entry?.last_modified,\\n    entry?.create_date,\\n    entry?.timestamp,\\n    entry?.time,\\n  ];\\n  for (const value of candidates) {\\n    const parsed = coerceTimestamp(value);\\n    if (parsed) {\\n      return parsed;\\n    }\\n  }\\n  const fallback = pickString(entry?.file_name, entry?.file_id);\\n  if (fallback) {\\n    return parseTimestampFromText(fallback);\\n  }\\n  return null;\\n}\\n\\nfunction sortChatBrief(list: any[]): any[] {\\n  return [...list].sort((lhs, rhs) => {\\n    const left = extractChatLatestTimestamp(lhs) ?? 0;\\n    const right = extractChatLatestTimestamp(rhs) ?? 0;\\n    return right - left;\\n  });\\n}\\n\\nfunction extractChatLatestLabel(entry: any): string {\\n  const candidates = [\\n    entry?.last_message_time,\\n    entry?.last_message_date,\\n    entry?.update_time,\\n    entry?.last_modified,\\n    entry?.create_date,\\n    entry?.timestamp,\\n    entry?.time,\\n  ];\\n  for (const value of candidates) {\\n    const label = formatMaybeTimestamp(value);\\n    if (label) {\\n      return label;\\n    }\\n  }\\n  const fallback = pickString(entry?.file_name, entry?.file_id);\\n  if (!fallback) {\\n    return '';\\n  }\\n  return fallback.replace(/\\\\.jsonl$/i, '');\\n}\\n\\nlet chatCacheToken = 0;\\nasync function warmRecentChatCache(cards: CardHubItem[]) {\\n  if (sortKey.value !== 'recent') {\\n    return;\\n  }\\n  const pending = cards.filter(card => {\\n    if (card.origin !== 'tavern') {\\n      return false;\\n    }\\n    if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\\n      return false;\\n    }\\n    return getLastChatAt(card) <= 0;\\n  });\\n  if (!pending.length) {\\n    return;\\n  }\\n  const token = ++chatCacheToken;\\n  for (const card of pending) {\\n    if (token !== chatCacheToken || sortKey.value !== 'recent') {\\n      return;\\n    }\\n    if (card.origin !== 'tavern') {\\n      continue;\\n    }\\n    if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\\n      continue;\\n    }\\n    const cached = getLastChatAt(card);\\n    let brief: unknown = null;\\n    try {\\n      brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\\n    } catch (error) {\\n      console.warn('[CardHub] ', error);\\n    }\\n    if (Array.isArray(brief) && brief.length) {\\n      const sorted = sortChatBrief(brief);\\n      const timestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\\n      if (timestamp > cached) {\\n        updateLastChatCacheForCard(card, timestamp);\\n      }\\n    }\\n    await sleep(80);\\n  }\\n}\\n\\nfunction warmImportCache(cards: CardHubItem[]) {\\n  const next = { ...importCache.value };\\n  let changed = false;\\n  const now = Date.now();\\n  cards.forEach((card, index) => {\\n    if (card.origin !== 'tavern') {\\n      return;\\n    }\\n    if (typeof card.createdAt === 'number' && card.createdAt > 0) {\\n      return;\\n    }\\n    const key = getChatCacheKey(card);\\n    if (!key || next[key]) {\\n      return;\\n    }\\n    next[key] = now - (cards.length - 1 - index) * 1000;\\n    changed = true;\\n  });\\n  if (changed) {\\n    updateImportCache(next);\\n  }\\n}\\n\\nfunction formatChatTitle(entry: any): string {\\n  const label = extractChatLatestLabel(entry);\\n  return label || '';\\n}\\n\\nfunction formatChatFileLabel(entry: any): string {\\n  const raw = pickString(entry?.file_name, entry?.file_id);\\n  if (!raw) {\\n    return '';\\n  }\\n  return raw.replace(/\\\\.jsonl$/i, '');\\n}\\n\\nfunction previewDetailText(text: string, maxLines: number, maxChars: number): string {\\n  const trimmed = text.replace(/\\\\r/g, '').trim();\\n  if (!trimmed) {\\n    return '';\\n  }\\n  const lines = extractContentLines(trimmed);\\n  const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\\n  let preview = source.slice(0, maxLines).join('\\\\n').trim();\\n  if (!preview) {\\n    return '';\\n  }\\n  const truncated = preview.length > maxChars;\\n  if (truncated) {\\n    preview = preview.slice(0, maxChars).trim();\\n  }\\n  const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\\n  if (hasMore && !preview.endsWith('')) {\\n    preview = `${preview}`;\\n  }\\n  return preview;\\n}\\n\\nfunction previewOpenings(openings: string[], maxItems: number): string[] {\\n  return openings\\n    .map(opening => previewOpeningLines(opening, 2).join('\\\\n'))\\n    .filter(preview => preview.trim().length > 0)\\n    .slice(0, maxItems);\\n}\\n\\nfunction previewOpeningLines(text: string, maxLines: number): string[] {\\n  const trimmed = text.replace(/\\\\r/g, '').trim();\\n  if (!trimmed) {\\n    return [];\\n  }\\n  const contentLines = extractContentLines(trimmed);\\n  if (contentLines.length >= maxLines) {\\n    return contentLines.slice(0, maxLines);\\n  }\\n  const normalized = normalizeBriefMessage(trimmed);\\n  if (!normalized) {\\n    return contentLines.slice(0, maxLines);\\n  }\\n  const chunks = chunkText(normalized, 60);\\n  if (!contentLines.length) {\\n    return chunks.slice(0, maxLines);\\n  }\\n  const combined = [...contentLines];\\n  for (const chunk of chunks) {\\n    if (combined.length >= maxLines) {\\n      break;\\n    }\\n    if (combined[0] !== chunk) {\\n      combined.push(chunk);\\n    }\\n  }\\n  return combined.slice(0, maxLines);\\n}\\n\\nfunction extractContentLines(text: string): string[] {\\n  const lines = text\\n    .split('\\\\n')\\n    .map(part => part.trim())\\n    .filter(part => part.length > 0);\\n  const filtered: string[] = [];\\n  for (const line of lines) {\\n    if (line.startsWith('```')) {\\n      continue;\\n    }\\n    if (/^<\\\\/?(html|head|body|meta|title|script|style|!doctype)\\\\b/i.test(line)) {\\n      continue;\\n    }\\n    filtered.push(line);\\n  }\\n  return filtered;\\n}\\n\\nfunction chunkText(text: string, size: number): string[] {\\n  const chunks: string[] = [];\\n  for (let i = 0; i < text.length; i += size) {\\n    const chunk = text.slice(i, i + size).trim();\\n    if (chunk) {\\n      chunks.push(chunk);\\n    }\\n  }\\n  return chunks;\\n}\\n\\nasync function resolveRecentChats(card: CardHubItem): Promise<ManageChatData> {\\n  if (card.origin !== 'tavern') {\\n    return { list: [], summary: null };\\n  }\\n  const brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\\n  if (!Array.isArray(brief) || !brief.length) {\\n    return { list: [], summary: { total: 0, latest: '' } };\\n  }\\n  const sorted = sortChatBrief(brief);\\n  const latestTimestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\\n  updateLastChatCacheForCard(card, latestTimestamp);\\n  const list = sorted.slice(0, 3).map((entry: any) => ({\\n    name: formatChatTitle(entry),\\n    label: formatChatFileLabel(entry),\\n    file: String(entry?.file_name ?? entry?.file_id ?? ''),\\n    mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\\n  }));\\n  const latest = extractChatLatestLabel(sorted[0]);\\n  return {\\n    list,\\n    summary: {\\n      total: brief.length,\\n      latest,\\n    },\\n  };\\n}\\n\\nasync function openLatestChat() {\\n  if (!manageChats.value.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  await openChat(manageChats.value[0]);\\n}\\n\\nasync function openNewChat() {\\n  const selection = await selectManageCharacter({ ensureSelected: true });\\n  if (!selection) {\\n    return;\\n  }\\n  try {\\n    await triggerSlash('/newchat');\\n    closeManage();\\n    close();\\n  } catch (error) {\\n    console.warn('[CardHub] ', error);\\n    toastr.error('');\\n  }\\n}\\n\\nasync function openChat(chat: { file: string }) {\\n  const file = chat.file;\\n  if (!file) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const selection = await selectManageCharacter({ ensureSelected: true });\\n  if (!selection) {\\n    return;\\n  }\\n  const { ctx, st } = selection;\\n  const target = normalizeChatId(file);\\n  const opener =\\n    (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\\n    (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\\n  if (!opener) {\\n    toastr.error('');\\n    return;\\n  }\\n  try {\\n    void Promise.resolve(opener(target)).catch(error => {\\n      console.warn('[CardHub] ', error);\\n    });\\n  } catch (error) {\\n    console.warn('[CardHub] ', error);\\n  }\\n  const opened = await waitForChatOpen(target, ctx, st, 6000);\\n  if (opened) {\\n    closeManage();\\n    close();\\n    return;\\n  }\\n  toastr.warning('');\\n}\\n\\nasync function selectManageCharacter(\\n  options: { ensureSelected?: boolean } = {},\\n): Promise<{ ctx: any; st: typeof SillyTavern | undefined; idx: number } | null> {\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  if (typeof ctx?.getCharacters === 'function') {\\n    try {\\n      await ctx.getCharacters();\\n    } catch (error) {\\n      console.warn('[CardHub] ', error);\\n    }\\n  }\\n  const list = ctx?.characters ?? st?.characters ?? [];\\n  const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\\n  if (idx < 0) {\\n    toastr.warning('');\\n    return null;\\n  }\\n  const selector =\\n    (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\\n    (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\\n  if (!selector) {\\n    toastr.warning('');\\n    return null;\\n  }\\n  try {\\n    await selector(idx, { switchMenu: false });\\n  } catch (error) {\\n    console.warn('[CardHub] ', error);\\n  }\\n  const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\\n  if (options.ensureSelected && !selected) {\\n    toastr.warning('');\\n    return null;\\n  }\\n  return { ctx, st, idx };\\n}\\n\\nasync function waitForCharacterSelection(\\n  idx: number,\\n  ctx: any,\\n  st: typeof SillyTavern | undefined,\\n  timeoutMs: number,\\n): Promise<boolean> {\\n  const target = String(idx);\\n  const start = Date.now();\\n  while (Date.now() - start < timeoutMs) {\\n    const current = getCurrentCharacterId(ctx, st);\\n    if (current === target) {\\n      return true;\\n    }\\n    await sleep(80);\\n  }\\n  return false;\\n}\\n\\nfunction getCurrentCharacterId(ctx: any, st: typeof SillyTavern | undefined): string {\\n  const value = ctx?.characterId ?? st?.characterId ?? '';\\n  return value === undefined || value === null ? '' : String(value);\\n}\\n\\nfunction sleep(ms: number): Promise<void> {\\n  return new Promise(resolve => setTimeout(resolve, ms));\\n}\\n\\nfunction findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\\n  const targetName = normalizeNameKey(card.name);\\n  const targetAvatar = card.avatar ? normalizeAvatarKey(card.avatar) : '';\\n  const byAvatar = targetAvatar\\n    ? list.findIndex(item => normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\\n    : -1;\\n  if (byAvatar >= 0) {\\n    return byAvatar;\\n  }\\n  const byName = list.findIndex(item => normalizeNameKey(String(item.name ?? '')) === targetName);\\n  if (byName >= 0) {\\n    return byName;\\n  }\\n  return list.findIndex(item => normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\\n}\\n\\nfunction normalizeChatId(id: string): string {\\n  return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\\n}\\n\\nasync function waitForChatOpen(\\n  file: string,\\n  ctx: any,\\n  st: typeof SillyTavern | undefined,\\n  timeoutMs: number,\\n): Promise<boolean> {\\n  const target = normalizeChatId(file);\\n  const start = Date.now();\\n  while (Date.now() - start < timeoutMs) {\\n    const current = ctx?.chatId ?? st?.chatId;\\n    if (current === target) {\\n      return true;\\n    }\\n    await new Promise(resolve => setTimeout(resolve, 200));\\n  }\\n  return false;\\n}\\n\\nasync function manageDelete(card: CardHubItem) {\\n  if (card.origin === 'library') {\\n    const confirmDelete = await openConfirm({\\n      title: '',\\n      message: `${card.name}`,\\n      confirmLabel: '',\\n      cancelLabel: '',\\n    });\\n    if (confirmDelete !== 'confirm') {\\n      return;\\n    }\\n    setLibrary(removeFromLibrary(card.id));\\n    closeManage();\\n    return;\\n  }\\n\\n  const confirmDelete = await openConfirm({\\n    title: '',\\n    message: `${card.name}`,\\n    confirmLabel: '',\\n    cancelLabel: '',\\n  });\\n  if (confirmDelete !== 'confirm') {\\n    return;\\n  }\\n  const deleteChoice = await openConfirm({\\n    title: '',\\n    message: `${card.name}\\\\n` + `- \\\\n` + `- `,\\n    confirmLabel: '',\\n    altLabel: '',\\n    cancelLabel: '',\\n  });\\n  if (deleteChoice === 'cancel') {\\n    return;\\n  }\\n  if (deleteChoice === 'confirm') {\\n    await moveToLibrary(card);\\n    const deleted = await deleteFromTavern(card, false);\\n    if (!deleted) {\\n      return;\\n    }\\n    closeManage();\\n    const characters = await fetchCharacterSummaries();\\n    setCharacters(characters);\\n    return;\\n  }\\n  const confirmPermanent = await openConfirm({\\n    title: '',\\n    message: `${card.name}`,\\n    confirmLabel: '',\\n    cancelLabel: '',\\n  });\\n  if (confirmPermanent !== 'confirm') {\\n    return;\\n  }\\n  const deleted = await deleteFromTavern(card, true);\\n  if (!deleted) {\\n    return;\\n  }\\n  closeManage();\\n  const characters = await fetchCharacterSummaries();\\n  setCharacters(characters);\\n}\\n\\nasync function moveToLibrary(card: CardHubItem) {\\n  if (!card.avatar) {\\n    return;\\n  }\\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\\n  if (!avatarPath) {\\n    toastr.error('');\\n    return;\\n  }\\n  const response = await fetch(avatarPath, { cache: 'no-cache' });\\n  const blob = await response.blob();\\n  const updated = await addToLibrary([new File([blob], `${card.name}.png`, { type: 'image/png' })]);\\n  setLibrary(updated);\\n}\\n\\nasync function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\\n  if (!card.avatar) {\\n    toastr.error('');\\n    return false;\\n  }\\n  let st: typeof SillyTavern | undefined;\\n  try {\\n    st = window.parent?.SillyTavern;\\n  } catch {\\n    st = undefined;\\n  }\\n  st ??= SillyTavern;\\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\\n  const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\\n    | Record<string, string>\\n    | undefined;\\n  if (!headers || !Object.keys(headers).length) {\\n    toastr.error('');\\n    return false;\\n  }\\n  const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\\n  const response = await fetch('/api/characters/delete', {\\n    method: 'POST',\\n    headers: { ...headers, 'Content-Type': 'application/json' },\\n    body: JSON.stringify(payload),\\n    cache: 'no-cache',\\n  });\\n  if (response.ok) {\\n    return true;\\n  }\\n  const detail = await response.text();\\n  toastr.error(`${response.status} ${detail || response.statusText}`);\\n  return false;\\n}\\n\\nfunction downloadBlob(blob: Blob, fileName: string) {\\n  const url = URL.createObjectURL(blob);\\n  const a = document.createElement('a');\\n  a.href = url;\\n  a.download = fileName;\\n  document.body.appendChild(a);\\n  a.click();\\n  a.remove();\\n  URL.revokeObjectURL(url);\\n}\\n\\nasync function dataUrlToBlob(dataUrl: string): Promise<Blob> {\\n  const response = await fetch(dataUrl);\\n  return await response.blob();\\n}\\n\\nasync function refresh() {\\n  setLoading(true);\\n  try {\\n    const characters = await fetchCharacterSummaries();\\n    setCharacters(characters);\\n    setLibrary(loadLibrary());\\n  } finally {\\n    setLoading(false);\\n  }\\n}\\n\\nfunction close() {\\n  setOpen(false);\\n}\\n</script>\\n\\n<style scoped>\\n.cardhub-root {\\n  position: fixed;\\n  inset: 0;\\n  z-index: 9999;\\n  font-family: 'ZCOOL XiaoWei', 'STSong', 'Songti SC', 'SimSun', serif;\\n  color: #1b1b1b;\\n  display: none;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.cardhub-root.open {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.cardhub-backdrop {\\n  position: absolute;\\n  inset: 0;\\n  background: rgba(0, 0, 0, 0.4);\\n  backdrop-filter: blur(6px);\\n  opacity: 0;\\n  transition: opacity 180ms ease;\\n}\\n\\n.cardhub-root.open .cardhub-backdrop {\\n  opacity: 1;\\n}\\n\\n.cardhub-panel {\\n  position: relative;\\n  width: min(980px, 94%);\\n  max-height: 92%;\\n  background: linear-gradient(160deg, #fff9f0, #f3e4d4);\\n  border-radius: 28px;\\n  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n  z-index: 1;\\n  opacity: 0;\\n  transform: translateY(8px) scale(0.985);\\n  transition:\\n    opacity 180ms ease,\\n    transform 180ms ease;\\n}\\n\\n.cardhub-root.open .cardhub-panel {\\n  opacity: 1;\\n  transform: translateY(0) scale(1);\\n}\\n\\n.cardhub-header {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 20px 24px;\\n  border-bottom: 1px solid rgba(86, 59, 44, 0.15);\\n}\\n\\n.cardhub-title__main {\\n  font-size: 26px;\\n  letter-spacing: 2px;\\n}\\n\\n.cardhub-title__sub {\\n  font-size: 12px;\\n  color: #7d5b46;\\n  margin-left: 10px;\\n}\\n\\n.cardhub-actions {\\n  display: flex;\\n  gap: 10px;\\n}\\n\\n.cardhub-close {\\n  border: none;\\n  background: rgba(43, 32, 24, 0.12);\\n  color: #3b2a20;\\n  width: 34px;\\n  height: 34px;\\n  border-radius: 999px;\\n  font-size: 20px;\\n  line-height: 34px;\\n  text-align: center;\\n  cursor: pointer;\\n  transition:\\n    background-color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-close:hover {\\n  background: rgba(43, 32, 24, 0.2);\\n}\\n\\n.cardhub-close:active {\\n  transform: scale(0.96);\\n}\\n\\n.cardhub-toolbar {\\n  display: flex;\\n  gap: 8px;\\n  padding: 12px 20px;\\n  flex-wrap: wrap;\\n}\\n\\n.cardhub-search {\\n  flex: 1;\\n  min-width: 180px;\\n  border-radius: 999px;\\n  border: 1px solid rgba(86, 59, 44, 0.2);\\n  padding: 6px 12px;\\n  background: #fffaf4;\\n}\\n\\n.cardhub-button {\\n  border: none;\\n  padding: 6px 14px;\\n  border-radius: 999px;\\n  background: #d46b3d;\\n  color: #fff;\\n  cursor: pointer;\\n  font-size: 12px;\\n  transition:\\n    background-color 160ms ease,\\n    transform 120ms ease,\\n    box-shadow 160ms ease;\\n}\\n\\n.cardhub-button:hover {\\n  background: #c55f36;\\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\\n}\\n\\n.cardhub-button:active {\\n  transform: translateY(1px);\\n}\\n\\n.cardhub-button.is-ghost {\\n  background: transparent;\\n  color: #6a3f2a;\\n  border: 1px solid rgba(106, 63, 42, 0.4);\\n}\\n\\n.cardhub-button.is-ghost:hover {\\n  background: rgba(106, 63, 42, 0.08);\\n  border-color: rgba(106, 63, 42, 0.6);\\n  box-shadow: none;\\n}\\n\\n.cardhub-import-input {\\n  display: none;\\n}\\n\\n.cardhub-body {\\n  display: grid;\\n  grid-template-columns: minmax(160px, 220px) 1fr;\\n  gap: 0;\\n  flex: 1;\\n  min-height: 0;\\n}\\n\\n.cardhub-sidebar {\\n  padding: 20px;\\n  border-right: 1px solid rgba(86, 59, 44, 0.15);\\n  display: flex;\\n  flex-direction: column;\\n  gap: 12px;\\n}\\n\\n.cardhub-chip-row {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-divider {\\n  height: 1px;\\n  width: 100%;\\n  background: rgba(86, 59, 44, 0.15);\\n  margin: 8px 0;\\n}\\n\\n.cardhub-section-title {\\n  font-size: 12px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-chip {\\n  text-align: left;\\n  border: none;\\n  background: rgba(255, 255, 255, 0.6);\\n  border-radius: 12px;\\n  padding: 8px 10px;\\n  cursor: pointer;\\n  font-size: 12px;\\n  transition:\\n    background-color 160ms ease,\\n    color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-chip.is-active {\\n  background: #2b2018;\\n  color: #fff5ea;\\n}\\n\\n.cardhub-chip:not(.is-active):hover {\\n  background: rgba(255, 255, 255, 0.9);\\n  transform: translateY(-1px);\\n}\\n\\n.cardhub-placeholder {\\n  font-size: 12px;\\n  color: #9a7a63;\\n}\\n\\n.cardhub-tag-filter {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-tag-filter__chip {\\n  border: 1px solid rgba(106, 63, 42, 0.25);\\n  background: rgba(255, 255, 255, 0.7);\\n  border-radius: 999px;\\n  padding: 6px 10px;\\n  font-size: 12px;\\n  color: #6a3f2a;\\n  cursor: pointer;\\n  transition:\\n    background-color 160ms ease,\\n    color 160ms ease,\\n    border-color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-tag-filter__chip.is-active {\\n  background: #2b2018;\\n  color: #fff5ea;\\n  border-color: transparent;\\n}\\n\\n.cardhub-tag-filter__chip:not(.is-active):hover {\\n  border-color: rgba(106, 63, 42, 0.45);\\n  background: rgba(255, 255, 255, 0.9);\\n  transform: translateY(-1px);\\n}\\n\\n.cardhub-chip--clear {\\n  margin-top: 8px;\\n}\\n\\n.cardhub-content {\\n  padding: 20px;\\n  overflow: auto;\\n  flex: 1;\\n  min-height: 0;\\n}\\n\\n.cardhub-grid-wrap {\\n  display: grid;\\n  gap: 12px;\\n}\\n\\n.cardhub-pagination {\\n  display: flex;\\n  align-items: center;\\n  justify-content: flex-end;\\n  gap: 10px;\\n  flex-wrap: wrap;\\n}\\n\\n.cardhub-pagination__status {\\n  font-size: 12px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-pagination__actions {\\n  display: flex;\\n  gap: 8px;\\n  align-items: center;\\n  margin-right: auto;\\n}\\n\\n.cardhub-pagination__button {\\n  border: 1px solid rgba(106, 63, 42, 0.35);\\n  background: rgba(255, 255, 255, 0.85);\\n  color: #6a3f2a;\\n  border-radius: 999px;\\n  padding: 4px 10px;\\n  font-size: 11px;\\n  cursor: pointer;\\n  transition:\\n    background-color 160ms ease,\\n    border-color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-pagination__button:disabled {\\n  opacity: 0.4;\\n  cursor: default;\\n}\\n\\n.cardhub-pagination__button:not(:disabled):hover {\\n  background: rgba(255, 255, 255, 1);\\n  border-color: rgba(106, 63, 42, 0.6);\\n  transform: translateY(-1px);\\n}\\n\\n.cardhub-pagination__button:not(:disabled):active {\\n  transform: translateY(0);\\n}\\n\\n.cardhub-loading,\\n.cardhub-empty {\\n  padding: 40px 0;\\n  text-align: center;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-grid {\\n  display: grid;\\n  gap: 14px;\\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\\n  justify-items: center;\\n}\\n\\n.cardhub-card {\\n  background: rgba(255, 255, 255, 0.78);\\n  border-radius: 18px;\\n  padding: 14px;\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  gap: 12px;\\n  align-items: center;\\n  border: 1px solid rgba(86, 59, 44, 0.15);\\n  cursor: pointer;\\n  transition:\\n    transform 140ms ease,\\n    box-shadow 180ms ease,\\n    border-color 180ms ease;\\n  width: 100%;\\n  max-width: 260px;\\n}\\n\\n.cardhub-card:hover {\\n  transform: translateY(-2px);\\n  border-color: rgba(86, 59, 44, 0.25);\\n  box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\\n}\\n\\n.cardhub-card:active {\\n  transform: translateY(0);\\n}\\n\\n.cardhub-card__avatar {\\n  width: 42px;\\n  height: 42px;\\n  border-radius: 12px;\\n  background: linear-gradient(135deg, #f4d7c4, #d36a3b);\\n  background-size: cover;\\n  background-position: center;\\n  color: #4a2a1f;\\n  display: grid;\\n  place-items: center;\\n  font-weight: 700;\\n}\\n\\n.cardhub-card__avatar.has-avatar span {\\n  display: none;\\n}\\n\\n.cardhub-card__name {\\n  font-size: 14px;\\n  font-weight: 600;\\n}\\n\\n.cardhub-card__meta {\\n  display: flex;\\n  gap: 8px;\\n  font-size: 11px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-card__tags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 6px;\\n  margin-top: 8px;\\n  align-items: center;\\n}\\n\\n.cardhub-tag {\\n  border: 1px solid rgba(106, 63, 42, 0.3);\\n  background: #fff6ea;\\n  border-radius: 999px;\\n  padding: 4px 8px;\\n  font-size: 11px;\\n  color: #6a3f2a;\\n  cursor: pointer;\\n  transition:\\n    background-color 160ms ease,\\n    border-color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-tag:hover {\\n  background: #fffaf4;\\n  border-color: rgba(106, 63, 42, 0.5);\\n  transform: translateY(-1px);\\n}\\n\\n.cardhub-tag__remove {\\n  margin-left: 4px;\\n  font-weight: 700;\\n}\\n\\n.cardhub-tag.is-add {\\n  background: transparent;\\n  border-style: dashed;\\n}\\n\\n.cardhub-tag-input {\\n  border: 1px dashed rgba(106, 63, 42, 0.5);\\n  background: #fffaf4;\\n  border-radius: 999px;\\n  padding: 4px 10px;\\n  font-size: 11px;\\n  min-width: 80px;\\n  color: #6a3f2a;\\n  outline: none;\\n  height: 24px;\\n  line-height: 16px;\\n}\\n\\n.cardhub-tag-input:focus {\\n  border-color: rgba(106, 63, 42, 0.85);\\n}\\n\\n.cardhub-card__action {\\n  grid-column: span 2;\\n  margin-top: 10px;\\n  border: none;\\n  background: #2b2018;\\n  color: #fff5ea;\\n  padding: 6px 12px;\\n  border-radius: 12px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  transition:\\n    transform 120ms ease,\\n    box-shadow 160ms ease,\\n    background-color 160ms ease;\\n}\\n\\n.cardhub-card__actions {\\n  grid-column: span 2;\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 8px;\\n  margin-top: 10px;\\n}\\n\\n.cardhub-card__action.is-secondary {\\n  background: #d9c6b6;\\n  color: #3b2a20;\\n}\\n\\n.cardhub-card__action:hover {\\n  transform: translateY(-1px);\\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\\n}\\n\\n.cardhub-card__action:active {\\n  transform: translateY(0);\\n}\\n\\n.cardhub-preview {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.45);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100000;\\n}\\n\\n.cardhub-preview__panel {\\n  width: min(520px, 92vw);\\n  background: #fff6ea;\\n  border-radius: 26px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 20px;\\n  position: relative;\\n  display: grid;\\n  gap: 14px;\\n}\\n\\n.cardhub-preview__close {\\n  position: absolute;\\n  top: 14px;\\n  right: 14px;\\n  border: none;\\n  width: 30px;\\n  height: 30px;\\n  border-radius: 999px;\\n  background: rgba(43, 32, 24, 0.15);\\n  color: #3b2a20;\\n  font-size: 18px;\\n  cursor: pointer;\\n  transition:\\n    background-color 160ms ease,\\n    transform 120ms ease;\\n}\\n\\n.cardhub-preview__close:hover {\\n  background: rgba(43, 32, 24, 0.25);\\n}\\n\\n.cardhub-preview__close:active {\\n  transform: scale(0.96);\\n}\\n\\n.cardhub-preview__avatar {\\n  width: 100%;\\n  height: 260px;\\n  border-radius: 18px;\\n  background: #ead7c4;\\n  display: grid;\\n  place-items: center;\\n  overflow: hidden;\\n}\\n\\n.cardhub-preview__avatar img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: contain;\\n}\\n\\n.cardhub-preview__info {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.cardhub-preview__name {\\n  font-size: 20px;\\n  font-weight: 700;\\n}\\n\\n.cardhub-preview__meta {\\n  display: flex;\\n  gap: 10px;\\n  font-size: 12px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-preview__tags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.cardhub-preview__tag {\\n  padding: 6px 10px;\\n  border-radius: 999px;\\n  border: 1px solid rgba(106, 63, 42, 0.3);\\n  background: #fffaf4;\\n  font-size: 12px;\\n  color: #6a3f2a;\\n}\\n\\n.cardhub-preview__actions {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 10px;\\n}\\n\\n.cardhub-manage {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.45);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100001;\\n}\\n\\n.cardhub-manage__panel {\\n  width: min(760px, 94vw);\\n  max-height: 88vh;\\n  background: #fff6ea;\\n  border-radius: 26px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 22px;\\n  position: relative;\\n  display: grid;\\n  gap: 16px;\\n  overflow: auto;\\n  overflow-x: hidden;\\n}\\n\\n.cardhub-manage__top {\\n  display: grid;\\n  grid-template-columns: 1fr auto;\\n  gap: 16px;\\n  align-items: start;\\n}\\n\\n.cardhub-manage__media {\\n  width: 220px;\\n  aspect-ratio: 3 / 4;\\n  height: auto;\\n  border-radius: 18px;\\n  background: #ead7c4;\\n  display: grid;\\n  place-items: center;\\n  overflow: hidden;\\n}\\n\\n.cardhub-manage__media img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n}\\n\\n.cardhub-manage__summary {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.cardhub-manage__overview {\\n  display: grid;\\n  gap: 10px;\\n  margin-top: 10px;\\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\\n}\\n\\n.cardhub-manage__overview-card {\\n  background: rgba(255, 255, 255, 0.7);\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  border-radius: 14px;\\n  padding: 10px 12px;\\n  display: grid;\\n  gap: 4px;\\n}\\n\\n.cardhub-manage__overview-label {\\n  font-size: 10px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-manage__overview-value {\\n  font-size: 13px;\\n  font-weight: 600;\\n  color: #3b2a20;\\n}\\n\\n.cardhub-manage__overview-hint {\\n  font-size: 11px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-manage__section {\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.cardhub-manage__details {\\n  display: grid;\\n  gap: 12px;\\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\\n}\\n\\n.cardhub-manage__detail {\\n  background: #fffaf4;\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  border-radius: 16px;\\n  padding: 12px 14px;\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.cardhub-manage__detail-label {\\n  font-size: 11px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-manage__detail-content {\\n  font-size: 12px;\\n  line-height: 1.5;\\n  color: #3b2a20;\\n  white-space: pre-wrap;\\n  overflow-wrap: anywhere;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__label {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 8px;\\n  font-size: 12px;\\n  color: #7d5b46;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n}\\n\\n.cardhub-manage__btn {\\n  border: none;\\n  border-radius: 12px;\\n  padding: 6px 12px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  text-transform: none;\\n  transition:\\n    background-color 160ms ease,\\n    transform 120ms ease,\\n    box-shadow 160ms ease;\\n}\\n\\n.cardhub-manage__btn.is-primary {\\n  background: #2b2018;\\n  color: #fff5ea;\\n}\\n\\n.cardhub-manage__btn.is-secondary {\\n  background: #d9c6b6;\\n  color: #3b2a20;\\n}\\n\\n.cardhub-manage__jump-row {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n  align-items: center;\\n}\\n\\n.cardhub-manage__btn:hover {\\n  transform: translateY(-1px);\\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\\n}\\n\\n.cardhub-manage__btn.is-primary:hover {\\n  background: #241a14;\\n}\\n\\n.cardhub-manage__btn.is-secondary:hover {\\n  background: #d1bca8;\\n}\\n\\n.cardhub-manage__btn:active {\\n  transform: translateY(0);\\n}\\n\\n.cardhub-manage__content {\\n  background: #fffaf4;\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  border-radius: 16px;\\n  padding: 12px 14px;\\n  font-size: 12px;\\n  line-height: 1.5;\\n  color: #3b2a20;\\n  white-space: pre-wrap;\\n  overflow-wrap: anywhere;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__opening {\\n  padding: 6px 0;\\n  border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\\n}\\n\\n.cardhub-manage__opening:last-child {\\n  border-bottom: none;\\n}\\n\\n.cardhub-manage__chat {\\n  display: grid;\\n  gap: 10px;\\n}\\n\\n.cardhub-manage__chat-row {\\n  display: grid;\\n  grid-template-columns: minmax(140px, 220px) 1fr;\\n  gap: 12px;\\n  font-size: 12px;\\n  color: #3b2a20;\\n  align-items: start;\\n  padding: 6px 8px;\\n  border-radius: 10px;\\n  cursor: pointer;\\n}\\n\\n.cardhub-manage__chat-row:hover {\\n  background: rgba(106, 63, 42, 0.08);\\n}\\n\\n.cardhub-manage__chat-main {\\n  display: grid;\\n  gap: 4px;\\n}\\n\\n.cardhub-manage__chat-name {\\n  flex: 0 0 auto;\\n  font-weight: 600;\\n  color: #6a3f2a;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__chat-label {\\n  font-size: 11px;\\n  color: #9a7a63;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__chat-text {\\n  color: #3b2a20;\\n  line-height: 1.5;\\n  display: -webkit-box;\\n  -webkit-line-clamp: 2;\\n  -webkit-box-orient: vertical;\\n  overflow: hidden;\\n  overflow-wrap: anywhere;\\n  word-break: break-word;\\n}\\n\\n.cardhub-manage__empty {\\n  font-size: 12px;\\n  color: #9a7a63;\\n}\\n\\n.cardhub-manage__actions {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 10px;\\n}\\n\\n.cardhub-confirm {\\n  position: absolute;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.55);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100002;\\n}\\n\\n.cardhub-confirm__panel {\\n  width: min(460px, 92vw);\\n  background: #fff6ea;\\n  border-radius: 22px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 18px 20px;\\n  display: grid;\\n  gap: 12px;\\n}\\n\\n.cardhub-confirm__title {\\n  font-size: 16px;\\n  font-weight: 600;\\n  color: #2b2018;\\n}\\n\\n.cardhub-confirm__message {\\n  font-size: 13px;\\n  line-height: 1.5;\\n  color: #4a2a1f;\\n  white-space: pre-wrap;\\n}\\n\\n.cardhub-confirm__actions {\\n  display: flex;\\n  gap: 10px;\\n  justify-content: flex-end;\\n  flex-wrap: wrap;\\n}\\n\\n.cardhub-confirm__button {\\n  border: none;\\n  border-radius: 999px;\\n  padding: 8px 14px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  transition:\\n    transform 120ms ease,\\n    box-shadow 160ms ease,\\n    background-color 160ms ease,\\n    border-color 160ms ease;\\n}\\n\\n.cardhub-confirm__button.is-confirm {\\n  background: #d46b3d;\\n  color: #fff;\\n}\\n\\n.cardhub-confirm__button.is-cancel {\\n  background: transparent;\\n  color: #6a3f2a;\\n  border: 1px solid rgba(106, 63, 42, 0.4);\\n}\\n\\n.cardhub-confirm__button.is-danger {\\n  background: #b6452a;\\n  color: #fff;\\n}\\n\\n.cardhub-confirm__button:hover {\\n  transform: translateY(-1px);\\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\\n}\\n\\n.cardhub-confirm__button:active {\\n  transform: translateY(0);\\n}\\n\\n.cardhub-export {\\n  position: absolute;\\n  inset: 0;\\n  background: rgba(24, 16, 10, 0.55);\\n  backdrop-filter: blur(6px);\\n  display: grid;\\n  place-items: center;\\n  z-index: 100003;\\n}\\n\\n.cardhub-export__panel {\\n  width: min(720px, 92vw);\\n  max-height: 86vh;\\n  background: #fff6ea;\\n  border-radius: 22px;\\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\\n  padding: 18px 20px;\\n  display: grid;\\n  gap: 12px;\\n  overflow: hidden;\\n}\\n\\n.cardhub-export__header {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 12px;\\n}\\n\\n.cardhub-export__title {\\n  font-size: 16px;\\n  font-weight: 600;\\n  color: #2b2018;\\n}\\n\\n.cardhub-export__subtitle {\\n  font-size: 12px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-export__toolbar {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n  flex-wrap: wrap;\\n}\\n\\n.cardhub-export__spacer {\\n  flex: 1;\\n}\\n\\n.cardhub-export__btn {\\n  border: none;\\n  border-radius: 999px;\\n  padding: 6px 12px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  transition:\\n    transform 120ms ease,\\n    box-shadow 160ms ease,\\n    background-color 160ms ease;\\n}\\n\\n.cardhub-export__btn.is-primary {\\n  background: #d46b3d;\\n  color: #fff;\\n}\\n\\n.cardhub-export__btn.is-secondary {\\n  background: transparent;\\n  color: #6a3f2a;\\n  border: 1px solid rgba(106, 63, 42, 0.4);\\n}\\n\\n.cardhub-export__btn:hover {\\n  transform: translateY(-1px);\\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\\n}\\n\\n.cardhub-export__list {\\n  display: grid;\\n  gap: 8px;\\n  overflow: auto;\\n  padding-right: 4px;\\n  max-height: 58vh;\\n}\\n\\n.cardhub-export__item {\\n  display: grid;\\n  grid-template-columns: auto 1fr;\\n  gap: 10px;\\n  align-items: center;\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  border-radius: 14px;\\n  padding: 10px 12px;\\n  background: rgba(255, 255, 255, 0.75);\\n  cursor: pointer;\\n}\\n\\n.cardhub-export__item:hover {\\n  border-color: rgba(106, 63, 42, 0.4);\\n}\\n\\n.cardhub-export__checkbox {\\n  width: 16px;\\n  height: 16px;\\n}\\n\\n.cardhub-export__main {\\n  display: grid;\\n  gap: 4px;\\n}\\n\\n.cardhub-export__name {\\n  font-size: 13px;\\n  font-weight: 600;\\n  color: #3b2a20;\\n}\\n\\n.cardhub-export__meta {\\n  display: flex;\\n  gap: 10px;\\n  font-size: 11px;\\n  color: #7d5b46;\\n}\\n\\n.cardhub-export__tags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 6px;\\n}\\n\\n.cardhub-export__tag {\\n  padding: 3px 8px;\\n  border-radius: 999px;\\n  border: 1px solid rgba(106, 63, 42, 0.2);\\n  background: rgba(255, 255, 255, 0.9);\\n  font-size: 10px;\\n  color: #6a3f2a;\\n}\\n\\n.cardhub-button:focus-visible,\\n.cardhub-chip:focus-visible,\\n.cardhub-tag-filter__chip:focus-visible,\\n.cardhub-tag:focus-visible,\\n.cardhub-card__action:focus-visible,\\n.cardhub-pagination__button:focus-visible,\\n.cardhub-manage__btn:focus-visible,\\n.cardhub-close:focus-visible,\\n.cardhub-preview__close:focus-visible,\\n.cardhub-confirm__button:focus-visible,\\n.cardhub-export__btn:focus-visible {\\n  outline: 2px solid rgba(212, 107, 61, 0.6);\\n  outline-offset: 2px;\\n}\\n@media (max-width: 720px) {\\n  .cardhub-root {\\n    position: absolute !important;\\n    inset: 0 !important;\\n    z-index: 99999 !important;\\n    display: none;\\n    align-items: center !important;\\n    justify-content: center !important;\\n    padding: 16px !important;\\n    box-sizing: border-box !important;\\n    overflow-y: auto !important;\\n  }\\n\\n  .cardhub-root.open {\\n    display: flex !important;\\n  }\\n\\n  .cardhub-backdrop {\\n    position: absolute !important;\\n    inset: 0 !important;\\n    z-index: 99998 !important;\\n    background: rgba(0, 0, 0, 0.4) !important;\\n    backdrop-filter: blur(8px) !important;\\n  }\\n\\n  .cardhub-panel {\\n    position: relative !important;\\n    width: 100% !important;\\n    height: 100% !important;\\n    max-height: 100% !important;\\n    max-width: none !important;\\n    margin: 0 !important;\\n    border-radius: 24px !important;\\n    box-shadow:\\n      0 12px 48px rgba(0, 0, 0, 0.3),\\n      0 2px 8px rgba(0, 0, 0, 0.1) !important;\\n    display: flex !important;\\n    flex-direction: column !important;\\n    z-index: 99999 !important;\\n    overflow: hidden !important;\\n    border: 1px solid rgba(255, 255, 255, 0.15) !important;\\n  }\\n\\n  .cardhub-header {\\n    flex-shrink: 0;\\n    padding: 14px 16px;\\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\\n  }\\n\\n  .cardhub-title__main {\\n    font-size: 20px;\\n  }\\n\\n  .cardhub-title__sub {\\n    font-size: 11px;\\n  }\\n\\n  .cardhub-close {\\n    width: 28px;\\n    height: 28px;\\n    font-size: 16px;\\n    line-height: 28px;\\n  }\\n\\n  .cardhub-toolbar {\\n    flex-shrink: 0;\\n    display: flex;\\n    flex-wrap: wrap;\\n    column-gap: 6px;\\n    row-gap: 8px;\\n    padding: 10px 14px;\\n  }\\n\\n  .cardhub-search {\\n    width: 100%;\\n    font-size: 13px;\\n    padding: 8px 12px;\\n    height: 34px;\\n  }\\n\\n  .cardhub-button {\\n    flex: 0 1 auto;\\n    min-width: 0;\\n    font-size: 11px;\\n    padding: 6px 10px;\\n    height: 32px;\\n    line-height: 1;\\n  }\\n\\n  .cardhub-body {\\n    display: flex;\\n    flex-direction: column;\\n    flex: 1;\\n    min-height: 0;\\n    overflow: auto;\\n  }\\n\\n  .cardhub-sidebar {\\n    flex-shrink: 0;\\n    border-right: none;\\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\\n    padding: 10px 14px;\\n    max-height: none;\\n    overflow: visible;\\n  }\\n\\n  .cardhub-section-title {\\n    font-size: 10px;\\n    margin-bottom: 6px;\\n  }\\n\\n  .cardhub-divider {\\n    margin: 6px 0;\\n  }\\n\\n  .cardhub-chip-row,\\n  .cardhub-tag-filter {\\n    display: flex;\\n    flex-wrap: nowrap;\\n    overflow-x: auto;\\n    -webkit-overflow-scrolling: touch;\\n    gap: 6px;\\n    padding-bottom: 4px;\\n  }\\n\\n  .cardhub-chip-row::-webkit-scrollbar,\\n  .cardhub-tag-filter::-webkit-scrollbar {\\n    height: 4px;\\n  }\\n\\n  .cardhub-chip-row::-webkit-scrollbar-thumb,\\n  .cardhub-tag-filter::-webkit-scrollbar-thumb {\\n    background: rgba(106, 63, 42, 0.15);\\n    border-radius: 999px;\\n  }\\n\\n  .cardhub-chip {\\n    font-size: 11px;\\n    padding: 6px 10px;\\n    min-height: 30px;\\n    line-height: 1;\\n    white-space: nowrap;\\n    flex-shrink: 0;\\n  }\\n\\n  .cardhub-tag-filter__chip {\\n    font-size: 10px;\\n    padding: 5px 9px;\\n    min-height: 28px;\\n    line-height: 1;\\n    white-space: nowrap;\\n    flex-shrink: 0;\\n  }\\n\\n  .cardhub-content {\\n    flex: 1;\\n    min-height: 0;\\n    overflow: visible;\\n    padding: 12px;\\n  }\\n\\n  .cardhub-pagination {\\n    align-items: flex-start;\\n    position: relative;\\n    padding-right: 72px;\\n  }\\n\\n  .cardhub-pagination__actions {\\n    width: 100%;\\n  }\\n\\n  .cardhub-pagination__button {\\n    flex: 1;\\n    text-align: center;\\n  }\\n\\n  .cardhub-pagination__status {\\n    position: absolute;\\n    right: 12px;\\n    top: 10px;\\n    font-size: 10px;\\n    white-space: nowrap;\\n  }\\n\\n  .cardhub-grid {\\n    display: grid;\\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\\n    gap: 10px;\\n    justify-content: center;\\n    justify-items: center;\\n  }\\n\\n  .cardhub-card {\\n    display: flex;\\n    flex-direction: row;\\n    align-items: center;\\n    gap: 10px;\\n    padding: 10px;\\n    border-radius: 14px;\\n    min-width: 0;\\n    width: 100%;\\n    max-width: none;\\n  }\\n\\n  .cardhub-card__avatar {\\n    width: 40px;\\n    height: 40px;\\n    flex-shrink: 0;\\n    border-radius: 10px;\\n  }\\n\\n  .cardhub-card__info {\\n    flex: 1;\\n    min-width: 0;\\n  }\\n\\n  .cardhub-card__name {\\n    font-size: 13px;\\n    white-space: nowrap;\\n    overflow: hidden;\\n    text-overflow: ellipsis;\\n  }\\n\\n  .cardhub-card__meta {\\n    font-size: 10px;\\n    gap: 6px;\\n  }\\n\\n  .cardhub-card__tags {\\n    margin-top: 4px;\\n    gap: 4px;\\n  }\\n\\n  .cardhub-tag {\\n    font-size: 9px;\\n    padding: 3px 6px;\\n  }\\n\\n  .cardhub-card__actions {\\n    display: flex;\\n    flex-direction: column;\\n    gap: 4px;\\n    flex-shrink: 0;\\n  }\\n\\n  .cardhub-card__action {\\n    padding: 5px 10px;\\n    font-size: 10px;\\n    border-radius: 8px;\\n  }\\n\\n  .cardhub-preview,\\n  .cardhub-manage {\\n    position: absolute !important;\\n    inset: 0 !important;\\n    display: flex !important;\\n    align-items: center !important;\\n    justify-content: center !important;\\n    padding: 16px !important;\\n    box-sizing: border-box !important;\\n    overflow-y: auto !important;\\n  }\\n\\n  .cardhub-preview__panel,\\n  .cardhub-manage__panel {\\n    width: calc(100vw - 32px) !important;\\n    max-width: 360px !important;\\n    max-height: calc(100vh - 32px) !important;\\n    max-height: calc(100dvh - 32px) !important;\\n    border-radius: 18px !important;\\n    padding: 16px !important;\\n    overflow: auto !important;\\n    overflow-x: hidden !important;\\n  }\\n\\n  .cardhub-preview__avatar {\\n    height: 180px;\\n    border-radius: 14px;\\n  }\\n\\n  .cardhub-preview__name {\\n    font-size: 16px;\\n  }\\n\\n  .cardhub-preview__meta {\\n    font-size: 11px;\\n  }\\n\\n  .cardhub-preview__tag {\\n    font-size: 10px;\\n    padding: 4px 8px;\\n  }\\n\\n  .cardhub-preview__actions {\\n    gap: 8px;\\n  }\\n\\n  .cardhub-manage__top {\\n    grid-template-columns: 1fr;\\n    gap: 12px;\\n  }\\n\\n  .cardhub-manage__media {\\n    width: 120px;\\n    margin: 0 auto;\\n  }\\n\\n  .cardhub-manage__overview {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .cardhub-manage__overview-value {\\n    font-size: 12px;\\n  }\\n\\n  .cardhub-manage__overview-hint {\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-manage__label {\\n    flex-direction: column;\\n    align-items: flex-start;\\n    gap: 6px;\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-manage__details {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .cardhub-manage__detail-label {\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-manage__detail-content {\\n    font-size: 11px;\\n    overflow-wrap: anywhere;\\n    word-break: break-word;\\n  }\\n\\n  .cardhub-manage__btn {\\n    width: 100%;\\n    text-align: center;\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-manage__jump-row {\\n    width: 100%;\\n  }\\n\\n  .cardhub-manage__content {\\n    font-size: 11px;\\n    padding: 10px;\\n    overflow-wrap: anywhere;\\n    word-break: break-word;\\n  }\\n\\n  .cardhub-manage__chat-row {\\n    grid-template-columns: 1fr;\\n    gap: 3px;\\n    font-size: 11px;\\n  }\\n\\n  .cardhub-manage__chat-label {\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-manage__chat-text {\\n    -webkit-line-clamp: 2;\\n    overflow-wrap: anywhere;\\n    word-break: break-word;\\n  }\\n\\n  .cardhub-manage__actions {\\n    grid-template-columns: 1fr 1fr;\\n    gap: 8px;\\n  }\\n\\n  .cardhub-export {\\n    position: absolute !important;\\n    inset: 0 !important;\\n    display: flex !important;\\n    align-items: center !important;\\n    justify-content: center !important;\\n    padding: 16px !important;\\n    box-sizing: border-box !important;\\n  }\\n\\n  .cardhub-export__panel {\\n    width: calc(100vw - 32px) !important;\\n    max-width: 360px !important;\\n    max-height: calc(100vh - 32px) !important;\\n    max-height: calc(100dvh - 32px) !important;\\n    border-radius: 18px !important;\\n    padding: 16px !important;\\n  }\\n\\n  .cardhub-export__toolbar {\\n    gap: 6px;\\n  }\\n\\n  .cardhub-export__btn {\\n    font-size: 11px;\\n    padding: 6px 10px;\\n  }\\n\\n  .cardhub-export__list {\\n    max-height: 48vh;\\n  }\\n\\n  .cardhub-export__item {\\n    grid-template-columns: auto 1fr;\\n    gap: 8px;\\n    padding: 8px 10px;\\n  }\\n\\n  .cardhub-export__name {\\n    font-size: 12px;\\n  }\\n\\n  .cardhub-export__meta {\\n    font-size: 10px;\\n  }\\n\\n  .cardhub-export__tag {\\n    font-size: 9px;\\n  }\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2bd55f74&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"068c6fd4\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2bd55f74&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2bd55f74&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  const $existing = $(`#${buttonId}`);\n  if ($existing.length) {\n    $existing\n      .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n      .attr('title', ' CardHub ')\n      .attr('aria-label', ' CardHub ')\n      .empty();\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const openOnce = createOpenOnce(() => controller.open('role'));\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n    .attr('title', ' CardHub ')\n    .attr('aria-label', ' CardHub ')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      openOnce();\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], openOnce);\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return //.test(text) || //.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] ');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const openOnce = createOpenOnce(() => controller.open('magic'));\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .html('<i class=\"fa-solid fa-id-badge\" aria-hidden=\"true\"></i><span></span>')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        openOnce();\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], openOnce);\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n\nfunction createOpenOnce(handler: () => void): () => void {\n  let lastFiredAt = 0;\n  return () => {\n    const now = Date.now();\n    if (now - lastFiredAt < 250) {\n      return;\n    }\n    lastFiredAt = now;\n    handler();\n  };\n}\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] ', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const idCounts = new Map<string, number>();\n  const tagKeyCounts = new Map<string, number>();\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map((character, index) => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar;\n    const name = character.name ?? '';\n    const createdRaw =\n      character.create_date ??\n      character.date_added ??\n      (character as any)?.created ??\n      (character as any)?.created_at ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      character.data?.create_date ??\n      character.data?.date_added ??\n      (character as any)?.data?.created ??\n      (character as any)?.data?.created_at ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n    const createdAt = coerceToTimestamp(createdRaw) ?? 0;\n    const stamp = createdRaw ?? String(index);\n    const tagBaseKey = avatarKey ?? `name:${name}::${stamp}`;\n    let tagKey = tagBaseKey;\n    if (!avatarKey) {\n      const tagCount = tagKeyCounts.get(tagBaseKey) ?? 0;\n      tagKeyCounts.set(tagBaseKey, tagCount + 1);\n      if (tagCount) {\n        tagKey = `${tagBaseKey}::${tagCount}`;\n      }\n    }\n\n    const mappedIds = ctx?.tagMap?.[tagKey] ?? [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = Array.from(new Set([...directTags, ...mappedTags]));\n    const baseId = avatarKey ? `avatar:${avatarKey}` : `name:${name}::${stamp}`;\n    const count = idCounts.get(baseId) ?? 0;\n    idCounts.set(baseId, count + 1);\n    const id = count ? `${baseId}::${count}` : baseId;\n\n    const lastChatRaw =\n      (character as any)?.last_interaction ??\n      (character as any)?.last_interaction_time ??\n      (character as any)?.last_interaction_date ??\n      (character as any)?.last_chat_time ??\n      (character as any)?.last_chat_date ??\n      (character as any)?.last_message_time ??\n      (character as any)?.last_message_date ??\n      (character as any)?.update_time ??\n      (character as any)?.last_modified ??\n      (character as any)?.timestamp ??\n      (character as any)?.time ??\n      (character as any)?.data?.last_interaction ??\n      (character as any)?.data?.last_interaction_time ??\n      (character as any)?.data?.last_interaction_date ??\n      (character as any)?.data?.last_chat_time ??\n      (character as any)?.data?.last_chat_date ??\n      (character as any)?.data?.last_message_time ??\n      (character as any)?.data?.last_message_date ??\n      (character as any)?.data?.update_time ??\n      (character as any)?.data?.last_modified ??\n      (character as any)?.data?.timestamp ??\n      (character as any)?.data?.time ??\n      null;\n\n    return {\n      id,\n      name,\n      avatar: character.avatar ?? null,\n      tags,\n      tagKey,\n      origin: 'tavern',\n      createdAt,\n      lastChatAt: coerceToTimestamp(lastChatRaw) ?? 0,\n    };\n  });\n}\n\nfunction coerceToTimestamp(value: unknown): number | null {\n  if (typeof value === 'number' && !Number.isNaN(value)) {\n    return value < 1e12 ? value * 1000 : value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Date.parse(value);\n    if (!Number.isNaN(parsed)) {\n      return parsed;\n    }\n  }\n  return null;\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}'  >= '${expected}'`, '');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [` ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`   : ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`   : ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\n\nconst LIBRARY_KEY = 'cardhub_library';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibrary(): StoredLibrary {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  const raw = vars?.[LIBRARY_KEY];\n  if (!raw || typeof raw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((raw as StoredLibrary).entries) ? (raw as StoredLibrary).entries : [];\n  return { entries };\n}\n\nfunction writeLibrary(entries: CardHubItem[]) {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  TavernHelper.replaceVariables(getStorage(), {\n    ...vars,\n    [LIBRARY_KEY]: { entries },\n  });\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nfunction hashString(value: string): string {\n  let hash = 5381;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = (hash * 33) ^ value.charCodeAt(i);\n  }\n  return (hash >>> 0).toString(16);\n}\n\nfunction stableStringify(value: unknown): string {\n  if (value === null || typeof value !== 'object') {\n    return JSON.stringify(value);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(item => stableStringify(item)).join(',')}]`;\n  }\n  const entries = Object.entries(value as Record<string, unknown>).sort(([a], [b]) => a.localeCompare(b));\n  return `{${entries.map(([key, val]) => `${JSON.stringify(key)}:${stableStringify(val)}`).join(',')}}`;\n}\n\nfunction buildFingerprint(rawType: CardHubItem['rawType'], raw: string): string {\n  let source = raw;\n  if (rawType === 'json') {\n    const trimmed = raw.trim();\n    try {\n      source = stableStringify(JSON.parse(trimmed));\n    } catch {\n      source = trimmed;\n    }\n  }\n  return `${rawType}:${hashString(source)}`;\n}\n\nfunction ensureFingerprint(entry: CardHubItem): string | null {\n  if (entry.fingerprint) {\n    return entry.fingerprint;\n  }\n  if (!entry.rawType || !entry.raw) {\n    return null;\n  }\n  const fingerprint = buildFingerprint(entry.rawType, entry.raw);\n  entry.fingerprint = fingerprint;\n  return fingerprint;\n}\n\nexport function loadLibrary(): CardHubItem[] {\n  const stored = readLibrary().entries;\n  let changed = false;\n  const now = Date.now();\n  const entries = stored.map((entry, index) => {\n    if (typeof entry.createdAt === 'number') {\n      return entry;\n    }\n    changed = true;\n    return {\n      ...entry,\n      createdAt: now - (stored.length - 1 - index) * 1000,\n    };\n  });\n  if (changed) {\n    writeLibrary(entries);\n  }\n  return entries;\n}\n\nexport async function addToLibrary(files: FileList | File[], existingEntries?: CardHubItem[]): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return loadLibrary();\n  }\n  const current = Array.isArray(existingEntries) && existingEntries.length ? existingEntries : loadLibrary();\n  const fingerprints = new Set<string>();\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n  });\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      const fingerprint = buildFingerprint('png', dataUrl);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name,\n        avatar: dataUrl,\n        tags: [],\n        origin: 'library',\n        rawType: 'png',\n        raw: dataUrl,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      const fingerprint = buildFingerprint('json', text);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: [],\n        origin: 'library',\n        rawType: 'json',\n        raw: text,\n        fingerprint,\n        createdAt: Date.now(),\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  writeLibrary(merged);\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[]): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.filter(entry => entry.id !== entryId);\n  writeLibrary(updated);\n  return updated;\n}\n","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setSearch(search: string) {\n  cardHubState.search = search;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library;\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar ? ctx.characters.find(character => character.avatar === target.avatar) : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nexport function getAllTagsFromContext(): string[] {\n  const ctx = getContext();\n  if (!ctx || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  return ctx.tags.map(tag => tag.name).filter(Boolean);\n}\n\nexport function getTagsForAvatar(tagKey: string | null | undefined): string[] {\n  if (!tagKey) {\n    return [];\n  }\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const ids = ctx.tagMap[tagKey] ?? [];\n  return ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const direct = target.tags ?? [];\n  const mapped = getTagsForAvatar(target.tagKey ?? target.avatar);\n  return Array.from(new Set([...direct, ...mapped]));\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)));\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const tagKey = target.tagKey ?? character.avatar ?? null;\n  if (tagKey) {\n    ctx.tagMap![tagKey] = tagIds;\n  }\n\n  ctx.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, withModifiers as _withModifiers, createTextVNode as _createTextVNode, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub \"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-filter-row\" };\nconst _hoisted_6 = { class: \"cardhub-filter-block\" };\nconst _hoisted_7 = { class: \"cardhub-chip-row\" };\nconst _hoisted_8 = { class: \"cardhub-filter-block\" };\nconst _hoisted_9 = { class: \"cardhub-chip-row\" };\nconst _hoisted_10 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = { class: \"cardhub-content\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_15 = {\n    key: 2,\n    class: \"cardhub-grid-wrap\"\n};\nconst _hoisted_16 = { class: \"cardhub-pagination\" };\nconst _hoisted_17 = {\n    key: 0,\n    class: \"cardhub-pagination__actions\"\n};\nconst _hoisted_18 = [\"disabled\"];\nconst _hoisted_19 = [\"disabled\"];\nconst _hoisted_20 = { class: \"cardhub-pagination__status\" };\nconst _hoisted_21 = { class: \"cardhub-grid\" };\nconst _hoisted_22 = [\"onClick\"];\nconst _hoisted_23 = { class: \"cardhub-card__info\" };\nconst _hoisted_24 = { class: \"cardhub-card__head\" };\nconst _hoisted_25 = { class: \"cardhub-card__name\" };\nconst _hoisted_26 = [\"onClick\"];\nconst _hoisted_27 = { class: \"cardhub-card__meta\" };\nconst _hoisted_28 = { class: \"cardhub-card__tags\" };\nconst _hoisted_29 = [\"onClick\"];\nconst _hoisted_30 = [\"onClick\"];\nconst _hoisted_31 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_32 = [\"onClick\"];\nconst _hoisted_33 = { class: \"cardhub-card__actions\" };\nconst _hoisted_34 = [\"onClick\"];\nconst _hoisted_35 = [\"onClick\"];\nconst _hoisted_36 = {\n    class: \"cardhub-manage__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_37 = { class: \"cardhub-manage__top\" };\nconst _hoisted_38 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_39 = { class: \"cardhub-preview__name\" };\nconst _hoisted_40 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_41 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_42 = { class: \"cardhub-manage__overview\" };\nconst _hoisted_43 = { class: \"cardhub-manage__overview-label\" };\nconst _hoisted_44 = { class: \"cardhub-manage__overview-value\" };\nconst _hoisted_45 = {\n    key: 0,\n    class: \"cardhub-manage__overview-hint\"\n};\nconst _hoisted_46 = { class: \"cardhub-manage__media\" };\nconst _hoisted_47 = [\"src\"];\nconst _hoisted_48 = { class: \"cardhub-manage__section\" };\nconst _hoisted_49 = {\n    key: 0,\n    class: \"cardhub-manage__details\"\n};\nconst _hoisted_50 = { class: \"cardhub-manage__detail-label\" };\nconst _hoisted_51 = { class: \"cardhub-manage__detail-content\" };\nconst _hoisted_52 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_53 = { class: \"cardhub-manage__section\" };\nconst _hoisted_54 = { class: \"cardhub-manage__content\" };\nconst _hoisted_55 = { class: \"cardhub-manage__section\" };\nconst _hoisted_56 = { class: \"cardhub-manage__label\" };\nconst _hoisted_57 = { class: \"cardhub-manage__jump-row\" };\nconst _hoisted_58 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_59 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_60 = { class: \"cardhub-manage__chat-main\" };\nconst _hoisted_61 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_62 = {\n    key: 0,\n    class: \"cardhub-manage__chat-label\"\n};\nconst _hoisted_63 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_64 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_65 = { class: \"cardhub-manage__actions\" };\nconst _hoisted_66 = {\n    class: \"cardhub-confirm__panel\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\"\n};\nconst _hoisted_67 = { class: \"cardhub-confirm__title\" };\nconst _hoisted_68 = { class: \"cardhub-confirm__message\" };\nconst _hoisted_69 = { class: \"cardhub-confirm__actions\" };\nconst _hoisted_70 = {\n    class: \"cardhub-export__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_71 = { class: \"cardhub-export__header\" };\nconst _hoisted_72 = { class: \"cardhub-export__subtitle\" };\nconst _hoisted_73 = { class: \"cardhub-export__filters\" };\nconst _hoisted_74 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_75 = { class: \"cardhub-export__filter-row\" };\nconst _hoisted_76 = [\"onClick\"];\nconst _hoisted_77 = { class: \"cardhub-export__list\" };\nconst _hoisted_78 = [\"checked\", \"onChange\"];\nconst _hoisted_79 = { class: \"cardhub-export__main\" };\nconst _hoisted_80 = { class: \"cardhub-export__name\" };\nconst _hoisted_81 = { class: \"cardhub-export__meta\" };\nconst _hoisted_82 = {\n    key: 0,\n    class: \"cardhub-export__tags\"\n};\nconst _hoisted_83 = {\n    class: \"cardhub-batch__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_84 = { class: \"cardhub-batch__header\" };\nconst _hoisted_85 = { class: \"cardhub-batch__subtitle\" };\nconst _hoisted_86 = { class: \"cardhub-batch__filters\" };\nconst _hoisted_87 = { class: \"cardhub-batch__field\" };\nconst _hoisted_88 = {\n    key: 0,\n    class: \"cardhub-batch__suggestions\"\n};\nconst _hoisted_89 = { class: \"cardhub-batch__suggest-row\" };\nconst _hoisted_90 = [\"onClick\"];\nconst _hoisted_91 = { class: \"cardhub-batch__toolbar\" };\nconst _hoisted_92 = { class: \"cardhub-batch__list\" };\nconst _hoisted_93 = [\"checked\", \"onChange\"];\nconst _hoisted_94 = { class: \"cardhub-batch__main\" };\nconst _hoisted_95 = { class: \"cardhub-batch__name\" };\nconst _hoisted_96 = { class: \"cardhub-batch__meta\" };\nconst _hoisted_97 = {\n    key: 0,\n    class: \"cardhub-batch__tags\"\n};\nconst _hoisted_98 = {\n    class: \"cardhub-theme__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"\"\n};\nconst _hoisted_99 = { class: \"cardhub-theme__grid\" };\nconst _hoisted_100 = { class: \"cardhub-theme__field\" };\nconst _hoisted_101 = { class: \"cardhub-theme__field\" };\nconst _hoisted_102 = { class: \"cardhub-theme__field\" };\nconst _hoisted_103 = { class: \"cardhub-theme__field\" };\nconst _hoisted_104 = { class: \"cardhub-theme__field\" };\nconst _hoisted_105 = { class: \"cardhub-theme__field\" };\nconst _hoisted_106 = { class: \"cardhub-theme__field\" };\nconst _hoisted_107 = { class: \"cardhub-theme__field\" };\nconst _hoisted_108 = { class: \"cardhub-theme__field\" };\nconst _hoisted_109 = { class: \"cardhub-theme__presets\" };\nconst _hoisted_110 = [\"onClick\"];\nimport { computed, nextTick, onMounted, reactive, ref, watch } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nconst FAVORITES_KEY = 'cardhub_favorites';\nconst LAST_CHAT_CACHE_KEY = 'cardhub_last_chat_cache';\nconst IMPORT_CACHE_KEY = 'cardhub_import_cache';\nconst THEME_KEY = 'cardhub_theme';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const selectedTags = ref([]);\n        const activeTagKey = ref(null);\n        const tagInput = ref('');\n        const statusFilter = ref('all');\n        const pageSize = ref(24);\n        const currentPage = ref(1);\n        const importInput = ref(null);\n        const manageCard = ref(null);\n        const manageOpenings = ref([]);\n        const manageChats = ref([]);\n        const manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\n        let manageRequestId = 0;\n        const confirmState = reactive({\n            open: false,\n            title: '',\n            message: '',\n            confirmLabel: '',\n            cancelLabel: '',\n            altLabel: '',\n            resolve: null,\n        });\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const mergedTagsMap = computed(() => {\n            const map = new Map();\n            allCards.value.forEach(card => {\n                map.set(card.id, getMergedTags(card));\n            });\n            return map;\n        });\n        const manageProfile = ref(null);\n        const manageOpeningSummary = ref(null);\n        const manageChatSummary = ref(null);\n        const exportDialogOpen = ref(false);\n        const exportSelectedIds = ref([]);\n        const exportCandidates = computed(() => [...allCards.value]);\n        const exportSearch = ref('');\n        const exportStatusFilter = ref('all');\n        const exportTagFilters = ref([]);\n        const batchTagDialogOpen = ref(false);\n        const batchTagSelectedIds = ref([]);\n        const batchTagSearch = ref('');\n        const batchTagInput = ref('');\n        const batchTagSelectedTags = ref([]);\n        const exportAllTags = computed(() => {\n            const tagSet = new Set();\n            exportCandidates.value.forEach(card => {\n                (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).forEach(tag => tagSet.add(tag));\n            });\n            exportTagFilters.value.forEach(tag => tagSet.add(tag));\n            return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n        });\n        const exportVisibleCandidates = computed(() => {\n            let list = exportCandidates.value;\n            if (exportStatusFilter.value === 'imported') {\n                list = list.filter(item => item.origin === 'tavern');\n            }\n            else if (exportStatusFilter.value === 'unimported') {\n                list = list.filter(item => item.origin === 'library');\n            }\n            if (exportTagFilters.value.length) {\n                list = list.filter(card => exportTagFilters.value.some(tag => (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).includes(tag)));\n            }\n            const keyword = exportSearch.value.trim().toLowerCase();\n            if (!keyword) {\n                return list;\n            }\n            return list.filter(card => {\n                if (card.name.toLowerCase().includes(keyword)) {\n                    return true;\n                }\n                const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\n                return tags.some(tag => tag.toLowerCase().includes(keyword));\n            });\n        });\n        const exportSelectedSet = computed(() => new Set(exportSelectedIds.value));\n        const exportSelectedItems = computed(() => exportCandidates.value.filter(item => exportSelectedSet.value.has(item.id)));\n        const batchTagCandidates = computed(() => filteredCharacters.value);\n        const batchTagVisibleCandidates = computed(() => {\n            const keyword = batchTagSearch.value.trim().toLowerCase();\n            if (!keyword) {\n                return batchTagCandidates.value;\n            }\n            return batchTagCandidates.value.filter(card => {\n                if (card.name.toLowerCase().includes(keyword)) {\n                    return true;\n                }\n                const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\n                return tags.some(tag => tag.toLowerCase().includes(keyword));\n            });\n        });\n        const batchTagSelectedSet = computed(() => new Set(batchTagSelectedIds.value));\n        const batchTagSuggestions = computed(() => allTags.value);\n        const favoriteIds = ref([]);\n        const favoriteSet = computed(() => new Set(favoriteIds.value));\n        const sortKey = ref('recent');\n        const favoritesOnly = ref(false);\n        const lastChatCache = ref({});\n        const importCache = ref({});\n        const defaultTheme = {\n            bgStart: '#f6f8fb',\n            bgEnd: '#e6ebf2',\n            surface: '#fdfdfe',\n            surfaceAlt: '#f1f4f9',\n            text: '#1b1e22',\n            textMuted: '#6b7480',\n            accent: '#7fb3e1',\n            accentStrong: '#243a52',\n            border: '#d5dde8',\n        };\n        const themeDialogOpen = ref(false);\n        const themeCurrent = ref({ ...defaultTheme });\n        const themeDraft = reactive({ ...defaultTheme });\n        const themeStyle = computed(() => {\n            const theme = themeDialogOpen.value ? themeDraft : themeCurrent.value;\n            return {\n                '--cardhub-bg-start': theme.bgStart,\n                '--cardhub-bg-end': theme.bgEnd,\n                '--cardhub-surface': theme.surface,\n                '--cardhub-surface-alt': theme.surfaceAlt,\n                '--cardhub-text': theme.text,\n                '--cardhub-text-muted': theme.textMuted,\n                '--cardhub-accent': theme.accent,\n                '--cardhub-accent-strong': theme.accentStrong,\n                '--cardhub-border': theme.border,\n                '--cardhub-surface-rgb': hexToRgb(theme.surface),\n                '--cardhub-surface-alt-rgb': hexToRgb(theme.surfaceAlt),\n                '--cardhub-border-rgb': hexToRgb(theme.border),\n                '--cardhub-accent-rgb': hexToRgb(theme.accent),\n                '--cardhub-accent-strong-rgb': hexToRgb(theme.accentStrong),\n                '--cardhub-accent-text': contrastTextColor(theme.accent),\n                '--cardhub-accent-strong-text': contrastTextColor(theme.accentStrong),\n            };\n        });\n        const themePresets = [\n            {\n                name: '',\n                value: {\n                    bgStart: '#f6f8fb',\n                    bgEnd: '#e6ebf2',\n                    surface: '#fdfdfe',\n                    surfaceAlt: '#f1f4f9',\n                    text: '#1b1e22',\n                    textMuted: '#6b7480',\n                    accent: '#7fb3e1',\n                    accentStrong: '#243a52',\n                    border: '#d5dde8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fdfaf4',\n                    bgEnd: '#f2ebe1',\n                    surface: '#fffefb',\n                    surfaceAlt: '#f7efe6',\n                    text: '#1d1a17',\n                    textMuted: '#7a6f63',\n                    accent: '#e3a981',\n                    accentStrong: '#3f2c22',\n                    border: '#e4d7c8',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#14181d',\n                    bgEnd: '#0d1116',\n                    surface: '#1e242b',\n                    surfaceAlt: '#242b34',\n                    text: '#eef2f7',\n                    textMuted: '#b2bdc9',\n                    accent: '#6fa2d1',\n                    accentStrong: '#d7e6f4',\n                    border: '#36414c',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f7f1e7',\n                    bgEnd: '#e6d8c6',\n                    surface: '#fcf6ee',\n                    surfaceAlt: '#f2e4d6',\n                    text: '#2a1f18',\n                    textMuted: '#8a6d5a',\n                    accent: '#c47b52',\n                    accentStrong: '#3e2a22',\n                    border: '#ddc7b4',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#fbf1ea',\n                    bgEnd: '#ecd5c8',\n                    surface: '#fff7f1',\n                    surfaceAlt: '#f4e1d6',\n                    text: '#2d2018',\n                    textMuted: '#8b6a5a',\n                    accent: '#d17a4f',\n                    accentStrong: '#4c2d21',\n                    border: '#e3c3b3',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f2fbf7',\n                    bgEnd: '#dcefe7',\n                    surface: '#f9fffd',\n                    surfaceAlt: '#e8f4f0',\n                    text: '#1a2a26',\n                    textMuted: '#5f7a73',\n                    accent: '#60b6a4',\n                    accentStrong: '#1f4c43',\n                    border: '#c5ddd5',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#f3f8fb',\n                    bgEnd: '#d9e7f3',\n                    surface: '#f9fcff',\n                    surfaceAlt: '#e9f2f9',\n                    text: '#1b2530',\n                    textMuted: '#5f7388',\n                    accent: '#5da3cf',\n                    accentStrong: '#1f3e57',\n                    border: '#c8d9e7',\n                },\n            },\n            {\n                name: '',\n                value: {\n                    bgStart: '#2a2d33',\n                    bgEnd: '#1e2126',\n                    surface: '#333741',\n                    surfaceAlt: '#3b404b',\n                    text: '#f3f5f8',\n                    textMuted: '#c1c7d0',\n                    accent: '#9aa6b2',\n                    accentStrong: '#e0e5ea',\n                    border: '#4b5261',\n                },\n            },\n        ];\n        const manageDetails = computed(() => {\n            const profile = manageProfile.value;\n            if (!profile) {\n                return [];\n            }\n            const details = [];\n            const pushDetail = (label, value, maxChars = 240) => {\n                const preview = previewDetailText(value, 3, maxChars);\n                if (preview) {\n                    details.push({ label, value: preview });\n                }\n            };\n            pushDetail('', profile.description ?? '');\n            pushDetail('', profile.personality ?? '');\n            pushDetail('', profile.scenario ?? '');\n            pushDetail('', profile.creatorNotes ?? '');\n            pushDetail('', profile.systemPrompt ?? '', 200);\n            pushDetail('', profile.postHistory ?? '', 200);\n            pushDetail('', profile.creator ?? '', 80);\n            return details;\n        });\n        const manageDetailsHint = computed(() => {\n            if (!manageCard.value || manageDetails.value.length) {\n                return '';\n            }\n            if (manageCard.value.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageChatHint = computed(() => {\n            if (manageCard.value?.origin === 'library') {\n                return '';\n            }\n            return '';\n        });\n        const manageOverview = computed(() => {\n            const items = [];\n            const profile = manageProfile.value;\n            const worldName = profile?.worldBookName?.trim() || '';\n            const worldCount = profile?.worldBookCount;\n            let worldValue = '';\n            let worldHint = '';\n            if (worldName || typeof worldCount === 'number') {\n                worldValue = worldName || '';\n                worldHint = typeof worldCount === 'number' ? `${worldCount} ` : '';\n            }\n            items.push({ label: '', value: worldValue, hint: worldHint });\n            const chat = manageChatSummary.value;\n            let chatValue = '';\n            let chatHint = '';\n            if (chat && chat.total > 0) {\n                chatValue = `${chat.total} `;\n                if (chat.latest) {\n                    chatHint = `${chat.latest}`;\n                }\n            }\n            items.push({ label: '', value: chatValue, hint: chatHint });\n            const opening = manageOpeningSummary.value;\n            let openingValue = '';\n            let openingHint = '';\n            if (opening && opening.total > 0) {\n                openingValue = `${opening.total} `;\n                openingHint = opening.alternate > 0 ? `${opening.alternate} ` : '';\n            }\n            items.push({ label: '', value: openingValue, hint: openingHint });\n            return items;\n        });\n        const filteredCharacters = computed(() => {\n            const list = applyFavoriteFilter(applyStatusFilter(allCards.value));\n            const keyword = state.search.trim().toLowerCase();\n            if (!keyword) {\n                return sortCards(applyTagFilter(list));\n            }\n            return sortCards(applyTagFilter(list).filter(character => {\n                const name = character.name.toLowerCase();\n                if (name.includes(keyword)) {\n                    return true;\n                }\n                const tags = mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n                return tags.some(tag => tag.toLowerCase().includes(keyword));\n            }));\n        });\n        const totalPages = computed(() => {\n            const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n            return total > 0 ? total : 1;\n        });\n        const pagedCharacters = computed(() => {\n            const start = (currentPage.value - 1) * pageSize.value;\n            return filteredCharacters.value.slice(start, start + pageSize.value);\n        });\n        const allTags = computed(() => {\n            const tagSet = new Set();\n            allCards.value.forEach(character => {\n                (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).forEach(tag => tagSet.add(tag));\n            });\n            selectedTags.value.forEach(tag => tagSet.add(tag));\n            return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n        }\n        function applyFavoriteFilter(list) {\n            if (!favoritesOnly.value) {\n                return list;\n            }\n            return list.filter(item => favoriteSet.value.has(item.id));\n        }\n        function getFavoriteList() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[FAVORITES_KEY];\n            return Array.isArray(raw) ? raw.filter(item => typeof item === 'string') : [];\n        }\n        function saveFavoriteList(list) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [FAVORITES_KEY]: list });\n        }\n        function loadLastChatCache() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[LAST_CHAT_CACHE_KEY];\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveLastChatCache(cache) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [LAST_CHAT_CACHE_KEY]: cache });\n        }\n        function loadImportCache() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            const raw = vars?.[IMPORT_CACHE_KEY];\n            if (!raw || typeof raw !== 'object') {\n                return {};\n            }\n            const entries = Object.entries(raw).filter(([, value]) => typeof value === 'number' && !Number.isNaN(value));\n            return Object.fromEntries(entries);\n        }\n        function saveImportCache(cache) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [IMPORT_CACHE_KEY]: cache });\n        }\n        function getChatCacheKey(card) {\n            if (card.origin !== 'tavern') {\n                return null;\n            }\n            if (card.avatar) {\n                return `avatar:${card.avatar}`;\n            }\n            if (card.name) {\n                return `name:${card.name}`;\n            }\n            return null;\n        }\n        function getImportAt(card) {\n            if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                return card.createdAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (importCache.value[key] ?? 0) : 0;\n        }\n        function getLastChatAt(card) {\n            if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                return card.lastChatAt;\n            }\n            const key = getChatCacheKey(card);\n            return key ? (lastChatCache.value[key] ?? 0) : 0;\n        }\n        function updateLastChatCache(key, timestamp) {\n            const next = { ...lastChatCache.value, [key]: timestamp };\n            lastChatCache.value = next;\n            saveLastChatCache(next);\n        }\n        function updateLastChatCacheForCard(card, timestamp) {\n            if (timestamp <= 0 || card.origin !== 'tavern') {\n                return;\n            }\n            const keys = new Set();\n            if (card.avatar) {\n                keys.add(`avatar:${card.avatar}`);\n            }\n            if (card.name) {\n                keys.add(`name:${card.name}`);\n            }\n            if (!keys.size) {\n                return;\n            }\n            const next = { ...lastChatCache.value };\n            let changed = false;\n            keys.forEach(key => {\n                if ((next[key] ?? 0) < timestamp) {\n                    next[key] = timestamp;\n                    changed = true;\n                }\n            });\n            if (changed) {\n                lastChatCache.value = next;\n                saveLastChatCache(next);\n            }\n        }\n        function updateImportCache(next) {\n            importCache.value = next;\n            saveImportCache(next);\n        }\n        function isFavorite(id) {\n            return favoriteSet.value.has(id);\n        }\n        function toggleFavorite(card) {\n            if (favoriteSet.value.has(card.id)) {\n                favoriteIds.value = favoriteIds.value.filter(item => item !== card.id);\n            }\n            else {\n                favoriteIds.value = [...favoriteIds.value, card.id];\n            }\n            saveFavoriteList(favoriteIds.value);\n        }\n        function sortCards(list) {\n            const withScore = list.map(item => {\n                const tags = mergedTagsMap.value.get(item.id) ?? getMergedTags(item);\n                return {\n                    item,\n                    tagCount: tags.length,\n                };\n            });\n            const byName = (a, b) => a.localeCompare(b, 'zh-CN');\n            return withScore\n                .sort((lhs, rhs) => {\n                const a = lhs.item;\n                const b = rhs.item;\n                if (sortKey.value === 'name') {\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'tags') {\n                    if (rhs.tagCount !== lhs.tagCount) {\n                        return rhs.tagCount - lhs.tagCount;\n                    }\n                    return byName(a.name, b.name);\n                }\n                if (sortKey.value === 'imported') {\n                    const aTime = getImportAt(a);\n                    const bTime = getImportAt(b);\n                    if (bTime !== aTime) {\n                        return bTime - aTime;\n                    }\n                    return byName(a.name, b.name);\n                }\n                const aTime = getLastChatAt(a);\n                const bTime = getLastChatAt(b);\n                if (bTime !== aTime) {\n                    return bTime - aTime;\n                }\n                const aCreated = a.createdAt ?? 0;\n                const bCreated = b.createdAt ?? 0;\n                if (bCreated !== aCreated) {\n                    return bCreated - aCreated;\n                }\n                return byName(a.name, b.name);\n            })\n                .map(entry => entry.item);\n        }\n        const manageAvatarUrl = computed(() => {\n            if (!manageCard.value) {\n                return null;\n            }\n            return avatarUrl(manageCard.value, true);\n        });\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => item.origin === 'tavern');\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => item.origin === 'library');\n            }\n            return list;\n        }\n        function applyTagFilter(list) {\n            if (!selectedTags.value.length) {\n                return list;\n            }\n            return list.filter(character => selectedTags.value.some(tag => (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).includes(tag)));\n        }\n        function toggleTagFilter(tag) {\n            if (selectedTags.value.includes(tag)) {\n                selectedTags.value = selectedTags.value.filter(item => item !== tag);\n            }\n            else {\n                selectedTags.value = [...selectedTags.value, tag];\n            }\n        }\n        function clearTagFilter() {\n            selectedTags.value = [];\n        }\n        function hexToRgb(value) {\n            const hex = value.replace('#', '');\n            if (hex.length !== 6) {\n                return '0, 0, 0';\n            }\n            const r = Number.parseInt(hex.slice(0, 2), 16);\n            const g = Number.parseInt(hex.slice(2, 4), 16);\n            const b = Number.parseInt(hex.slice(4, 6), 16);\n            return `${r}, ${g}, ${b}`;\n        }\n        function contrastTextColor(value) {\n            const rgb = hexToRgb(value)\n                .split(',')\n                .map(part => Number(part.trim()));\n            if (rgb.length !== 3) {\n                return '#1b1b1b';\n            }\n            const [r, g, b] = rgb.map(channel => channel / 255);\n            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n            return luminance > 0.6 ? '#1b1b1b' : '#ffffff';\n        }\n        function normalizeTheme(raw) {\n            if (!raw || typeof raw !== 'object') {\n                return { ...defaultTheme };\n            }\n            const data = raw;\n            const pick = (key) => {\n                const value = data[key];\n                return /^#[0-9a-f]{6}$/i.test(value) ? value : defaultTheme[key];\n            };\n            return {\n                bgStart: pick('bgStart'),\n                bgEnd: pick('bgEnd'),\n                surface: pick('surface'),\n                surfaceAlt: pick('surfaceAlt'),\n                text: pick('text'),\n                textMuted: pick('textMuted'),\n                accent: pick('accent'),\n                accentStrong: pick('accentStrong'),\n                border: pick('border'),\n            };\n        }\n        function getCardHubRoot() {\n            try {\n                return (window.parent?.document ?? document).querySelector('.cardhub-root');\n            }\n            catch {\n                return document.querySelector('.cardhub-root');\n            }\n        }\n        let themeFrame = 0;\n        let themeTimer = null;\n        function scheduleThemeApply(theme) {\n            if (themeFrame) {\n                cancelAnimationFrame(themeFrame);\n                themeFrame = 0;\n            }\n            if (themeTimer) {\n                window.clearTimeout(themeTimer);\n            }\n            themeTimer = window.setTimeout(() => {\n                themeTimer = null;\n                themeFrame = requestAnimationFrame(() => {\n                    themeFrame = 0;\n                    applyTheme(theme);\n                });\n            }, 80);\n        }\n        function applyTheme(theme) {\n            const root = getCardHubRoot();\n            if (!root) {\n                return;\n            }\n            root.style.setProperty('--cardhub-bg-start', theme.bgStart);\n            root.style.setProperty('--cardhub-bg-end', theme.bgEnd);\n            root.style.setProperty('--cardhub-surface', theme.surface);\n            root.style.setProperty('--cardhub-surface-alt', theme.surfaceAlt);\n            root.style.setProperty('--cardhub-text', theme.text);\n            root.style.setProperty('--cardhub-text-muted', theme.textMuted);\n            root.style.setProperty('--cardhub-accent', theme.accent);\n            root.style.setProperty('--cardhub-accent-strong', theme.accentStrong);\n            root.style.setProperty('--cardhub-border', theme.border);\n            root.style.setProperty('--cardhub-surface-rgb', hexToRgb(theme.surface));\n            root.style.setProperty('--cardhub-surface-alt-rgb', hexToRgb(theme.surfaceAlt));\n            root.style.setProperty('--cardhub-border-rgb', hexToRgb(theme.border));\n            root.style.setProperty('--cardhub-accent-rgb', hexToRgb(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-rgb', hexToRgb(theme.accentStrong));\n            root.style.setProperty('--cardhub-accent-text', contrastTextColor(theme.accent));\n            root.style.setProperty('--cardhub-accent-strong-text', contrastTextColor(theme.accentStrong));\n        }\n        function loadThemeFromGlobal() {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            return normalizeTheme(vars?.[THEME_KEY]);\n        }\n        function saveThemeToGlobal(theme) {\n            const vars = TavernHelper.getVariables({ type: 'global' });\n            TavernHelper.replaceVariables({ type: 'global' }, { ...vars, [THEME_KEY]: theme });\n        }\n        function openThemeDialog() {\n            const current = themeCurrent.value;\n            Object.assign(themeDraft, current);\n            themeDialogOpen.value = true;\n            nextTick(() => scheduleThemeApply(current));\n        }\n        function closeThemeDialog() {\n            themeDialogOpen.value = false;\n            Object.assign(themeDraft, themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n        }\n        function resetThemeDraft() {\n            Object.assign(themeDraft, defaultTheme);\n        }\n        function saveThemeDraft() {\n            themeCurrent.value = { ...themeDraft };\n            saveThemeToGlobal(themeCurrent.value);\n            scheduleThemeApply(themeCurrent.value);\n            themeDialogOpen.value = false;\n        }\n        function applyThemePreset(preset) {\n            Object.assign(themeDraft, preset.value);\n        }\n        function toggleExportTagFilter(tag) {\n            if (exportTagFilters.value.includes(tag)) {\n                exportTagFilters.value = exportTagFilters.value.filter(item => item !== tag);\n            }\n            else {\n                exportTagFilters.value = [...exportTagFilters.value, tag];\n            }\n        }\n        function clearExportTagFilter() {\n            exportTagFilters.value = [];\n        }\n        function openExportDialog() {\n            if (!exportVisibleCandidates.value.length) {\n                toastr.warning('');\n                return;\n            }\n            exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n            exportDialogOpen.value = true;\n        }\n        watch(themeDraft, value => {\n            if (themeDialogOpen.value) {\n                scheduleThemeApply({ ...value });\n            }\n        }, { deep: true });\n        onMounted(() => {\n            const theme = loadThemeFromGlobal();\n            themeCurrent.value = theme;\n            Object.assign(themeDraft, theme);\n            nextTick(() => scheduleThemeApply(theme));\n            favoriteIds.value = getFavoriteList();\n            lastChatCache.value = loadLastChatCache();\n            importCache.value = loadImportCache();\n            void warmRecentChatCache(allCards.value);\n            warmImportCache(allCards.value);\n        });\n        function closeExportDialog() {\n            exportDialogOpen.value = false;\n        }\n        function openBatchTagDialog() {\n            if (!batchTagVisibleCandidates.value.length) {\n                toastr.warning('');\n                return;\n            }\n            batchTagInput.value = '';\n            batchTagSearch.value = '';\n            batchTagSelectedTags.value = [];\n            batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n            batchTagDialogOpen.value = true;\n        }\n        function closeBatchTagDialog() {\n            batchTagDialogOpen.value = false;\n        }\n        function toggleBatchTagSelection(id) {\n            if (batchTagSelectedSet.value.has(id)) {\n                batchTagSelectedIds.value = batchTagSelectedIds.value.filter(item => item !== id);\n            }\n            else {\n                batchTagSelectedIds.value = [...batchTagSelectedIds.value, id];\n            }\n        }\n        function selectAllBatchTags() {\n            batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n        }\n        function clearBatchTagSelection() {\n            batchTagSelectedIds.value = [];\n        }\n        function parseBatchTags(input, selected) {\n            const items = input\n                .split(/[,\\n;]/)\n                .map(part => part.trim())\n                .filter(Boolean);\n            return Array.from(new Set([...items, ...selected]));\n        }\n        function getCardsByIds(ids) {\n            const map = new Map(allCards.value.map(card => [card.id, card]));\n            return ids.map(id => map.get(id)).filter(Boolean);\n        }\n        function toggleBatchTagSuggestion(tag) {\n            if (batchTagSelectedTags.value.includes(tag)) {\n                batchTagSelectedTags.value = batchTagSelectedTags.value.filter(item => item !== tag);\n            }\n            else {\n                batchTagSelectedTags.value = [...batchTagSelectedTags.value, tag];\n            }\n        }\n        function isSameTagSet(current, next) {\n            if (current.length !== next.length) {\n                return false;\n            }\n            const currentSet = new Set(current);\n            return next.every(tag => currentSet.has(tag));\n        }\n        async function applyBatchTags(mode) {\n            if (!batchTagSelectedIds.value.length) {\n                toastr.warning('');\n                return;\n            }\n            const tags = parseBatchTags(batchTagInput.value, batchTagSelectedTags.value);\n            if (!tags.length) {\n                toastr.warning('');\n                return;\n            }\n            const actionLabel = mode === 'add' ? '' : '';\n            const message = `${actionLabel}${tags.join('')}\\n ${batchTagSelectedIds.value.length} `;\n            const result = await openConfirm({\n                title: `${actionLabel}`,\n                message,\n                confirmLabel: `${actionLabel}`,\n                cancelLabel: '',\n            });\n            if (result !== 'confirm') {\n                return;\n            }\n            const cards = getCardsByIds(batchTagSelectedIds.value);\n            let changed = 0;\n            cards.forEach(card => {\n                const currentTags = displayTags(card);\n                const nextSet = new Set(currentTags);\n                if (mode === 'add') {\n                    tags.forEach(tag => nextSet.add(tag));\n                }\n                else {\n                    tags.forEach(tag => nextSet.delete(tag));\n                }\n                const nextTags = Array.from(nextSet);\n                if (!isSameTagSet(currentTags, nextTags)) {\n                    applyTagUpdate(card, nextTags);\n                    changed += 1;\n                }\n            });\n            toastr.success(` ${changed} `);\n        }\n        function isExportSelected(id) {\n            return exportSelectedSet.value.has(id);\n        }\n        function toggleExportSelection(id) {\n            if (exportSelectedSet.value.has(id)) {\n                exportSelectedIds.value = exportSelectedIds.value.filter(item => item !== id);\n            }\n            else {\n                exportSelectedIds.value = [...exportSelectedIds.value, id];\n            }\n        }\n        function selectAllExport() {\n            exportSelectedIds.value = exportCandidates.value.map(item => item.id);\n        }\n        function clearExportSelection() {\n            exportSelectedIds.value = [];\n        }\n        watch([() => state.search, statusFilter, () => selectedTags.value.join('|'), sortKey, favoritesOnly], () => {\n            currentPage.value = 1;\n        });\n        watch([filteredCharacters, totalPages], () => {\n            if (currentPage.value > totalPages.value) {\n                currentPage.value = totalPages.value;\n            }\n            if (currentPage.value < 1) {\n                currentPage.value = 1;\n            }\n        });\n        watch([sortKey, allCards], () => {\n            if (sortKey.value === 'recent') {\n                void warmRecentChatCache(allCards.value);\n            }\n            if (sortKey.value === 'imported') {\n                warmImportCache(allCards.value);\n            }\n        });\n        function prevPage() {\n            if (currentPage.value > 1) {\n                currentPage.value -= 1;\n            }\n        }\n        function nextPage() {\n            if (currentPage.value < totalPages.value) {\n                currentPage.value += 1;\n            }\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function normalizeAvatarKey(value) {\n            let raw = value.trim();\n            if (!raw) {\n                return '';\n            }\n            try {\n                raw = decodeURIComponent(raw);\n            }\n            catch {\n                // ignore\n            }\n            raw = raw.split('?')[0];\n            if (raw.includes('/')) {\n                raw = raw.split('/').pop() ?? raw;\n            }\n            return raw.trim().toLowerCase();\n        }\n        function findDuplicateCharacterByName(name) {\n            const target = normalizeNameKey(name);\n            if (!target) {\n                return null;\n            }\n            return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\n        }\n        function openConfirm(options) {\n            if (confirmState.open && confirmState.resolve) {\n                confirmState.resolve('cancel');\n            }\n            confirmState.title = options.title ?? '';\n            confirmState.message = options.message;\n            confirmState.confirmLabel = options.confirmLabel ?? '';\n            confirmState.cancelLabel = options.cancelLabel ?? '';\n            confirmState.altLabel = options.altLabel ?? '';\n            confirmState.open = true;\n            return new Promise(resolve => {\n                confirmState.resolve = resolve;\n            });\n        }\n        function resolveConfirm(result) {\n            if (!confirmState.open) {\n                return;\n            }\n            confirmState.open = false;\n            const resolver = confirmState.resolve;\n            confirmState.resolve = null;\n            if (resolver) {\n                resolver(result);\n            }\n        }\n        function removeTag(character, tag) {\n            const nextTags = getMergedTags(character).filter(item => item !== tag);\n            applyTagUpdate(character, nextTags);\n        }\n        function tagKey(character) {\n            return character.id;\n        }\n        function startTagEdit(character) {\n            activeTagKey.value = tagKey(character);\n            tagInput.value = '';\n            nextTick(() => {\n                const input = document.querySelector('.cardhub-tag-input');\n                input?.focus();\n            });\n        }\n        function confirmTag(character) {\n            if (activeTagKey.value !== tagKey(character)) {\n                return;\n            }\n            const input = tagInput.value.trim();\n            if (input) {\n                const nextTags = [...getMergedTags(character), input];\n                applyTagUpdate(character, nextTags);\n            }\n            cancelTagEdit();\n        }\n        function cancelTagEdit() {\n            activeTagKey.value = null;\n            tagInput.value = '';\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (character.origin === 'library') {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTags(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        function triggerImport() {\n            importInput.value?.click();\n        }\n        async function handleImportFiles(event) {\n            const target = event.target;\n            const files = target?.files;\n            if (!files || !files.length) {\n                return;\n            }\n            const updated = await addToLibrary(files, state.library);\n            setLibrary(updated);\n            target.value = '';\n        }\n        async function exportSelected() {\n            openExportDialog();\n        }\n        async function confirmExportSelected() {\n            const list = exportSelectedItems.value;\n            if (!list.length) {\n                toastr.warning('');\n                return;\n            }\n            const tagLabel = selectedTags.value.length ? selectedTags.value.join('') : '';\n            const statusLabel = statusFilter.value === 'all' ? '' : statusFilter.value === 'imported' ? '' : '';\n            const searchLabel = state.search.trim() || '';\n            const message = ` ${list.length} \\n` +\n                `${statusLabel}\\n` +\n                `${tagLabel}\\n` +\n                `${searchLabel}\\n` +\n                ``;\n            const result = await openConfirm({\n                title: '',\n                message,\n                confirmLabel: '',\n                cancelLabel: '',\n            });\n            if (result !== 'confirm') {\n                return;\n            }\n            exportDialogOpen.value = false;\n            for (const item of list) {\n                await exportCard(item);\n                await sleep(120);\n            }\n            toastr.success(` ${list.length} `);\n        }\n        async function handleCardAction(card) {\n            if (card.origin === 'library') {\n                await importLibraryCard(card);\n            }\n            else {\n                exportCard(card);\n            }\n        }\n        async function importLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('');\n                return;\n            }\n            const duplicate = findDuplicateCharacterByName(card.name);\n            if (duplicate) {\n                toastr.warning(`${duplicate.name}`);\n                return;\n            }\n            const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {});\n            delete headers['Content-Type'];\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                await TavernHelper.importRawCharacter(card.name, blob);\n            }\n            else {\n                const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n                const form = new FormData();\n                form.append('avatar', file);\n                form.append('file_type', 'json');\n                form.append('preserved_name', file.name);\n                await fetch('/api/characters/import', {\n                    method: 'POST',\n                    headers,\n                    body: form,\n                    cache: 'no-cache',\n                });\n            }\n            setLibrary(removeFromLibrary(card.id));\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n            toastr.success(` ${card.name}`);\n        }\n        async function exportCard(card) {\n            if (card.origin === 'library') {\n                await exportLibraryCard(card);\n                return;\n            }\n            if (!card.avatar) {\n                toastr.error('');\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            downloadBlob(blob, `${card.name}.png`);\n        }\n        async function exportLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('');\n                return;\n            }\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                downloadBlob(blob, `${card.name}.png`);\n                return;\n            }\n            const blob = new Blob([card.raw], { type: 'application/json' });\n            downloadBlob(blob, `${card.name}.json`);\n        }\n        async function openManage(card) {\n            const requestId = ++manageRequestId;\n            manageCard.value = card;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n            const [manageResult, chatsResult] = await Promise.allSettled([resolveManageData(card), resolveRecentChats(card)]);\n            if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n                return;\n            }\n            const manageData = manageResult.status === 'fulfilled' ? manageResult.value : { openings: [], profile: null, openingSummary: null };\n            manageOpenings.value = manageData.openings;\n            manageProfile.value = manageData.profile;\n            manageOpeningSummary.value = manageData.openingSummary;\n            const chatData = chatsResult.status === 'fulfilled' ? chatsResult.value : { list: [], summary: null };\n            manageChats.value = chatData.list;\n            manageChatSummary.value = chatData.summary;\n        }\n        function closeManage() {\n            manageCard.value = null;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n        }\n        async function resolveManageData(card) {\n            if (card.origin !== 'tavern') {\n                const data = parseLibraryCardData(card);\n                return {\n                    openings: extractOpeningMessages(data),\n                    profile: extractCardProfile(data),\n                    openingSummary: extractOpeningSummary(data),\n                };\n            }\n            const raw = await getFullCharacterData(card);\n            const fallback = raw ??\n                TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            const primary = raw ?? fallback;\n            let openings = extractOpeningMessages(primary);\n            if (!openings.length && fallback && fallback !== primary) {\n                openings = extractOpeningMessages(fallback);\n            }\n            const openingSummary = extractOpeningSummary(primary ?? fallback);\n            return {\n                openings,\n                profile: extractCardProfile(primary ?? fallback),\n                openingSummary,\n            };\n        }\n        function parseLibraryCardData(card) {\n            if (!card.raw || !card.rawType) {\n                return null;\n            }\n            if (card.rawType === 'json') {\n                return parseJsonSafe(card.raw);\n            }\n            if (card.rawType === 'png') {\n                return parsePngCardData(card.raw);\n            }\n            return null;\n        }\n        function parseJsonSafe(raw) {\n            try {\n                return JSON.parse(raw);\n            }\n            catch {\n                return null;\n            }\n        }\n        function parsePngCardData(dataUrl) {\n            const bytes = dataUrlToBytes(dataUrl);\n            if (!bytes) {\n                return null;\n            }\n            const chunks = extractPngTextChunks(bytes);\n            const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n            for (const chunk of chunks) {\n                if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n                    continue;\n                }\n                const parsed = parseCardPayload(chunk.value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function dataUrlToBytes(dataUrl) {\n            const comma = dataUrl.indexOf(',');\n            if (comma < 0) {\n                return null;\n            }\n            const base64 = dataUrl.slice(comma + 1);\n            try {\n                const binary = atob(base64);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return bytes;\n            }\n            catch {\n                return null;\n            }\n        }\n        function extractPngTextChunks(bytes) {\n            if (bytes.length < 8) {\n                return [];\n            }\n            const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n            for (let i = 0; i < signature.length; i += 1) {\n                if (bytes[i] !== signature[i]) {\n                    return [];\n                }\n            }\n            const chunks = [];\n            let offset = 8;\n            while (offset + 8 <= bytes.length) {\n                const length = readUint32BE(bytes, offset);\n                const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n                const dataStart = offset + 8;\n                const dataEnd = dataStart + length;\n                if (dataEnd + 4 > bytes.length) {\n                    break;\n                }\n                const data = bytes.subarray(dataStart, dataEnd);\n                if (type === 'tEXt') {\n                    const entry = parseTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                else if (type === 'iTXt') {\n                    const entry = parseIntlTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                offset = dataEnd + 4;\n            }\n            return chunks;\n        }\n        function parseTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseIntlTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const compressed = data[nullIndex + 1] === 1;\n            let cursor = nullIndex + 2;\n            const langEnd = data.indexOf(0, cursor);\n            if (langEnd < 0) {\n                return null;\n            }\n            cursor = langEnd + 1;\n            const translatedEnd = data.indexOf(0, cursor);\n            if (translatedEnd < 0) {\n                return null;\n            }\n            cursor = translatedEnd + 1;\n            if (compressed) {\n                return null;\n            }\n            const value = bytesToString(data.subarray(cursor)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseCardPayload(value) {\n            const trimmed = value.trim();\n            if (!trimmed) {\n                return null;\n            }\n            const direct = parseJsonSafe(trimmed);\n            if (direct) {\n                return direct;\n            }\n            if (!isLikelyBase64(trimmed)) {\n                return null;\n            }\n            const decoded = decodeBase64Text(trimmed);\n            if (!decoded) {\n                return null;\n            }\n            return parseJsonSafe(decoded);\n        }\n        function decodeBase64Text(value) {\n            try {\n                const binary = atob(value);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return new TextDecoder().decode(bytes);\n            }\n            catch {\n                return null;\n            }\n        }\n        function isLikelyBase64(value) {\n            if (value.length < 16 || value.length % 4 !== 0) {\n                return false;\n            }\n            return /^[A-Za-z0-9+/=]+$/.test(value);\n        }\n        function readUint32BE(bytes, offset) {\n            return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n        }\n        function bytesToString(bytes) {\n            return new TextDecoder().decode(bytes);\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar) : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractCardProfile(data) {\n            if (!data) {\n                return null;\n            }\n            const profile = {\n                description: pickString(data?.description, data?.data?.description),\n                personality: pickString(data?.personality, data?.data?.personality),\n                scenario: pickString(data?.scenario, data?.data?.scenario),\n                creatorNotes: pickString(data?.creatorcomment, data?.data?.creatorcomment, data?.creator_notes, data?.data?.creator_notes),\n                systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n                postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n                creator: pickString(data?.creator, data?.data?.creator),\n            };\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (book) {\n                profile.worldBookName = pickString(book?.name);\n                profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n            }\n            const hasValue = Boolean(profile.description) ||\n                Boolean(profile.personality) ||\n                Boolean(profile.scenario) ||\n                Boolean(profile.creatorNotes) ||\n                Boolean(profile.systemPrompt) ||\n                Boolean(profile.postHistory) ||\n                Boolean(profile.creator) ||\n                Boolean(profile.worldBookName) ||\n                typeof profile.worldBookCount === 'number';\n            return hasValue ? profile : null;\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function extractOpeningSummary(data) {\n            if (!data) {\n                return null;\n            }\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            let alternate = 0;\n            if (Array.isArray(alt)) {\n                alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                alternate = 1;\n            }\n            return {\n                total: firstCount + alternate,\n                alternate,\n            };\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function formatMaybeTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                const ms = value < 1e12 ? value * 1000 : value;\n                return new Date(ms).toLocaleString('zh-CN', { hour12: false });\n            }\n            if (typeof value === 'string') {\n                const trimmed = value.trim();\n                if (trimmed) {\n                    return trimmed;\n                }\n            }\n            return '';\n        }\n        function parseTimestampFromText(raw) {\n            const text = raw.replace(/\\.jsonl$/i, '').trim();\n            const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:](\\d{1,2})(?:[:](\\d{1,2}))?)?/;\n            const match = text.match(pattern);\n            if (!match) {\n                return null;\n            }\n            const year = Number(match[1]);\n            const month = Number(match[2]);\n            const day = Number(match[3]);\n            const hour = match[4] ? Number(match[4]) : 0;\n            const minute = match[5] ? Number(match[5]) : 0;\n            const second = match[6] ? Number(match[6]) : 0;\n            if (!year || !month || !day) {\n                return null;\n            }\n            const date = new Date(year, month - 1, day, hour, minute, second);\n            const time = date.getTime();\n            return Number.isNaN(time) ? null : time;\n        }\n        function coerceTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                return value < 1e12 ? value * 1000 : value;\n            }\n            if (typeof value === 'string') {\n                const parsed = Date.parse(value);\n                if (!Number.isNaN(parsed)) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function extractChatLatestTimestamp(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const parsed = coerceTimestamp(value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (fallback) {\n                return parseTimestampFromText(fallback);\n            }\n            return null;\n        }\n        function sortChatBrief(list) {\n            return [...list].sort((lhs, rhs) => {\n                const left = extractChatLatestTimestamp(lhs) ?? 0;\n                const right = extractChatLatestTimestamp(rhs) ?? 0;\n                return right - left;\n            });\n        }\n        function extractChatLatestLabel(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const label = formatMaybeTimestamp(value);\n                if (label) {\n                    return label;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (!fallback) {\n                return '';\n            }\n            return fallback.replace(/\\.jsonl$/i, '');\n        }\n        let chatCacheToken = 0;\n        async function warmRecentChatCache(cards) {\n            if (sortKey.value !== 'recent') {\n                return;\n            }\n            const pending = cards.filter(card => {\n                if (card.origin !== 'tavern') {\n                    return false;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    return false;\n                }\n                return getLastChatAt(card) <= 0;\n            });\n            if (!pending.length) {\n                return;\n            }\n            const token = ++chatCacheToken;\n            for (const card of pending) {\n                if (token !== chatCacheToken || sortKey.value !== 'recent') {\n                    return;\n                }\n                if (card.origin !== 'tavern') {\n                    continue;\n                }\n                if (typeof card.lastChatAt === 'number' && card.lastChatAt > 0) {\n                    continue;\n                }\n                const cached = getLastChatAt(card);\n                let brief = null;\n                try {\n                    brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n                if (Array.isArray(brief) && brief.length) {\n                    const sorted = sortChatBrief(brief);\n                    const timestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n                    if (timestamp > cached) {\n                        updateLastChatCacheForCard(card, timestamp);\n                    }\n                }\n                await sleep(80);\n            }\n        }\n        function warmImportCache(cards) {\n            const next = { ...importCache.value };\n            let changed = false;\n            const now = Date.now();\n            cards.forEach((card, index) => {\n                if (card.origin !== 'tavern') {\n                    return;\n                }\n                if (typeof card.createdAt === 'number' && card.createdAt > 0) {\n                    return;\n                }\n                const key = getChatCacheKey(card);\n                if (!key || next[key]) {\n                    return;\n                }\n                next[key] = now - (cards.length - 1 - index) * 1000;\n                changed = true;\n            });\n            if (changed) {\n                updateImportCache(next);\n            }\n        }\n        function formatChatTitle(entry) {\n            const label = extractChatLatestLabel(entry);\n            return label || '';\n        }\n        function formatChatFileLabel(entry) {\n            const raw = pickString(entry?.file_name, entry?.file_id);\n            if (!raw) {\n                return '';\n            }\n            return raw.replace(/\\.jsonl$/i, '');\n        }\n        function previewDetailText(text, maxLines, maxChars) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return '';\n            }\n            const lines = extractContentLines(trimmed);\n            const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n            let preview = source.slice(0, maxLines).join('\\n').trim();\n            if (!preview) {\n                return '';\n            }\n            const truncated = preview.length > maxChars;\n            if (truncated) {\n                preview = preview.slice(0, maxChars).trim();\n            }\n            const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n            if (hasMore && !preview.endsWith('')) {\n                preview = `${preview}`;\n            }\n            return preview;\n        }\n        function previewOpenings(openings, maxItems) {\n            return openings\n                .map(opening => previewOpeningLines(opening, 2).join('\\n'))\n                .filter(preview => preview.trim().length > 0)\n                .slice(0, maxItems);\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return { list: [], summary: null };\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? '', true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return { list: [], summary: { total: 0, latest: '' } };\n            }\n            const sorted = sortChatBrief(brief);\n            const latestTimestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n            updateLastChatCacheForCard(card, latestTimestamp);\n            const list = sorted.slice(0, 3).map((entry) => ({\n                name: formatChatTitle(entry),\n                label: formatChatFileLabel(entry),\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n            }));\n            const latest = extractChatLatestLabel(sorted[0]);\n            return {\n                list,\n                summary: {\n                    total: brief.length,\n                    latest,\n                },\n            };\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openNewChat() {\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            try {\n                await triggerSlash('/newchat');\n                closeManage();\n                close();\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n                toastr.error('');\n            }\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('');\n                return;\n            }\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            const { ctx, st } = selection;\n            const target = normalizeChatId(file);\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] ', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                closeManage();\n                close();\n                return;\n            }\n            toastr.warning('');\n        }\n        async function selectManageCharacter(options = {}) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] ', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            if (idx < 0) {\n                toastr.warning('');\n                return null;\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (!selector) {\n                toastr.warning('');\n                return null;\n            }\n            try {\n                await selector(idx, { switchMenu: false });\n            }\n            catch (error) {\n                console.warn('[CardHub] ', error);\n            }\n            const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n            if (options.ensureSelected && !selected) {\n                toastr.warning('');\n                return null;\n            }\n            return { ctx, st, idx };\n        }\n        async function waitForCharacterSelection(idx, ctx, st, timeoutMs) {\n            const target = String(idx);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = getCurrentCharacterId(ctx, st);\n                if (current === target) {\n                    return true;\n                }\n                await sleep(80);\n            }\n            return false;\n        }\n        function getCurrentCharacterId(ctx, st) {\n            const value = ctx?.characterId ?? st?.characterId ?? '';\n            return value === undefined || value === null ? '' : String(value);\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function findCharacterIndex(list, card) {\n            const targetName = normalizeNameKey(card.name);\n            const targetAvatar = card.avatar ? normalizeAvatarKey(card.avatar) : '';\n            const byAvatar = targetAvatar\n                ? list.findIndex(item => normalizeAvatarKey(String(item.avatar ?? '')) === targetAvatar)\n                : -1;\n            if (byAvatar >= 0) {\n                return byAvatar;\n            }\n            const byName = list.findIndex(item => normalizeNameKey(String(item.name ?? '')) === targetName);\n            if (byName >= 0) {\n                return byName;\n            }\n            return list.findIndex(item => normalizeNameKey(String(item?.data?.name ?? '')) === targetName);\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await new Promise(resolve => setTimeout(resolve, 200));\n            }\n            return false;\n        }\n        async function manageDelete(card) {\n            if (card.origin === 'library') {\n                const confirmDelete = await openConfirm({\n                    title: '',\n                    message: `${card.name}`,\n                    confirmLabel: '',\n                    cancelLabel: '',\n                });\n                if (confirmDelete !== 'confirm') {\n                    return;\n                }\n                setLibrary(removeFromLibrary(card.id));\n                closeManage();\n                return;\n            }\n            const confirmDelete = await openConfirm({\n                title: '',\n                message: `${card.name}`,\n                confirmLabel: '',\n                cancelLabel: '',\n            });\n            if (confirmDelete !== 'confirm') {\n                return;\n            }\n            const deleteChoice = await openConfirm({\n                title: '',\n                message: `${card.name}\\n` + `- \\n` + `- `,\n                confirmLabel: '',\n                altLabel: '',\n                cancelLabel: '',\n            });\n            if (deleteChoice === 'cancel') {\n                return;\n            }\n            if (deleteChoice === 'confirm') {\n                await moveToLibrary(card);\n                const deleted = await deleteFromTavern(card, false);\n                if (!deleted) {\n                    return;\n                }\n                closeManage();\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                return;\n            }\n            const confirmPermanent = await openConfirm({\n                title: '',\n                message: `${card.name}`,\n                confirmLabel: '',\n                cancelLabel: '',\n            });\n            if (confirmPermanent !== 'confirm') {\n                return;\n            }\n            const deleted = await deleteFromTavern(card, true);\n            if (!deleted) {\n                return;\n            }\n            closeManage();\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n        }\n        async function moveToLibrary(card) {\n            if (!card.avatar) {\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            const updated = await addToLibrary([new File([blob], `${card.name}.png`, { type: 'image/png' })]);\n            setLibrary(updated);\n        }\n        async function deleteFromTavern(card, deleteChats) {\n            if (!card.avatar) {\n                toastr.error('');\n                return false;\n            }\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.());\n            if (!headers || !Object.keys(headers).length) {\n                toastr.error('');\n                return false;\n            }\n            const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n            const response = await fetch('/api/characters/delete', {\n                method: 'POST',\n                headers: { ...headers, 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n                cache: 'no-cache',\n            });\n            if (response.ok) {\n                return true;\n            }\n            const detail = await response.text();\n            toastr.error(`${response.status} ${detail || response.statusText}`);\n            return false;\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                setLibrary(loadLibrary());\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }]),\n                style: _normalizeStyle(themeStyle.value)\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[56] || (_cache[56] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-theme-trigger\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: openThemeDialog\n                            }, [...(_cache[54] || (_cache[54] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"fa-solid fa-palette\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"\",\n                                onClick: close\n                            }, [...(_cache[55] || (_cache[55] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: triggerImport\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: exportSelected\n                        }, \"\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: openBatchTagDialog\n                        }, \"\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: handleImportFiles\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"div\", _hoisted_6, [\n                                    _cache[57] || (_cache[57] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                            type: \"button\",\n                                            onClick: _cache[1] || (_cache[1] = ($event) => (statusFilter.value = 'all'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[2] || (_cache[2] = ($event) => (statusFilter.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[3] || (_cache[3] = ($event) => (statusFilter.value = 'unimported'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': favoritesOnly.value }]),\n                                            type: \"button\",\n                                            onClick: _cache[4] || (_cache[4] = ($event) => (favoritesOnly.value = !favoritesOnly.value))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_8, [\n                                    _cache[58] || (_cache[58] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_9, [\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'recent' }]),\n                                            type: \"button\",\n                                            onClick: _cache[5] || (_cache[5] = ($event) => (sortKey.value = 'recent'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'name' }]),\n                                            type: \"button\",\n                                            onClick: _cache[6] || (_cache[6] = ($event) => (sortKey.value = 'name'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'tags' }]),\n                                            type: \"button\",\n                                            onClick: _cache[7] || (_cache[7] = ($event) => (sortKey.value = 'tags'))\n                                        }, \"  \", 2 /* CLASS */),\n                                        _createElementVNode(\"button\", {\n                                            class: _normalizeClass([\"cardhub-chip\", { 'is-active': sortKey.value === 'imported' }]),\n                                            type: \"button\",\n                                            onClick: _cache[8] || (_cache[8] = ($event) => (sortKey.value = 'imported'))\n                                        }, \"  \", 2 /* CLASS */)\n                                    ])\n                                ])\n                            ]),\n                            _cache[59] || (_cache[59] = _createElementVNode(\"div\", { class: \"cardhub-divider\" }, null, -1 /* CACHED */)),\n                            _cache[60] || (_cache[60] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allTags.value, (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': selectedTags.value.includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (toggleTagFilter(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_11));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (selectedTags.value.length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: clearTagFilter\n                                }, \"  \"))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_12, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \"\"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_15, [\n                                        _createElementVNode(\"div\", _hoisted_16, [\n                                            (totalPages.value > 1)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value <= 1,\n                                                        onClick: prevPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_18),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value >= totalPages.value,\n                                                        onClick: nextPage\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_19)\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"span\", _hoisted_20, \" \" + _toDisplayString(currentPage.value) + \" / \" + _toDisplayString(totalPages.value) + \" \", 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_21, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedCharacters.value, (character) => {\n                                                return (_openBlock(), _createElementBlock(\"article\", {\n                                                    key: character.id,\n                                                    class: \"cardhub-card\",\n                                                    onClick: ($event) => (openManage(character))\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                        style: _normalizeStyle(avatarStyle(character))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                    ], 6 /* CLASS, STYLE */),\n                                                    _createElementVNode(\"div\", _hoisted_23, [\n                                                        _createElementVNode(\"div\", _hoisted_24, [\n                                                            _createElementVNode(\"div\", _hoisted_25, _toDisplayString(character.name), 1 /* TEXT */),\n                                                            _createElementVNode(\"button\", {\n                                                                class: _normalizeClass([\"cardhub-fav\", { 'is-active': isFavorite(character.id) }]),\n                                                                type: \"button\",\n                                                                \"aria-label\": \"\",\n                                                                onClick: _withModifiers(($event) => (toggleFavorite(character)), [\"stop\"])\n                                                            }, [...(_cache[61] || (_cache[61] = [\n                                                                    _createElementVNode(\"i\", {\n                                                                        class: \"fa-solid fa-star\",\n                                                                        \"aria-hidden\": \"true\"\n                                                                    }, null, -1 /* CACHED */)\n                                                                ]))], 10 /* CLASS, PROPS */, _hoisted_26)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_27, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" \", 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_28, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-tag\",\n                                                                    type: \"button\",\n                                                                    title: \"\",\n                                                                    onClick: _withModifiers(($event) => (removeTag(character, tag)), [\"stop\"])\n                                                                }, [\n                                                                    _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                    _cache[62] || (_cache[62] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"\", -1 /* CACHED */))\n                                                                ], 8 /* PROPS */, _hoisted_29));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (activeTagKey.value !== tagKey(character))\n                                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: 0,\n                                                                    class: \"cardhub-tag is-add\",\n                                                                    type: \"button\",\n                                                                    onClick: _withModifiers(($event) => (startTagEdit(character)), [\"stop\"])\n                                                                }, \" +  \", 8 /* PROPS */, _hoisted_30))\n                                                                : (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: 1,\n                                                                    class: \"cardhub-tag-edit\",\n                                                                    onClick: _cache[10] || (_cache[10] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onMousedown: _cache[11] || (_cache[11] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onTouchstart: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"]))\n                                                                }, [\n                                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                                        \"onUpdate:modelValue\": _cache[9] || (_cache[9] = ($event) => ((tagInput).value = $event)),\n                                                                        class: \"cardhub-tag-input\",\n                                                                        type: \"text\",\n                                                                        placeholder: \"\",\n                                                                        onKeydown: [\n                                                                            _withKeys(_withModifiers(($event) => (confirmTag(character)), [\"prevent\"]), [\"enter\"]),\n                                                                            _withKeys(_withModifiers(cancelTagEdit, [\"prevent\"]), [\"esc\"])\n                                                                        ],\n                                                                        onBlur: ($event) => (confirmTag(character))\n                                                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_31), [\n                                                                        [_vModelText, tagInput.value]\n                                                                    ]),\n                                                                    _createElementVNode(\"button\", {\n                                                                        class: \"cardhub-tag-confirm\",\n                                                                        type: \"button\",\n                                                                        onClick: ($event) => (confirmTag(character))\n                                                                    }, \"\", 8 /* PROPS */, _hoisted_32)\n                                                                ], 32 /* NEED_HYDRATION */))\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_33, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action is-secondary\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (handleCardAction(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[15] || (_cache[15] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, _toDisplayString(character.origin === 'tavern' ? '' : ''), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_34),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_35)\n                                                    ])\n                                                ], 8 /* PROPS */, _hoisted_22));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                        ])\n                    ])\n                ]),\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-manage\",\n                        onClick: _withModifiers(closeManage, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_36, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: closeManage\n                            }, \"\"),\n                            _createElementVNode(\"div\", _hoisted_37, [\n                                _createElementVNode(\"div\", _hoisted_38, [\n                                    _createElementVNode(\"div\", _hoisted_39, _toDisplayString(manageCard.value.name), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_40, [\n                                        _createElementVNode(\"span\", null, _toDisplayString(manageCard.value.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(manageCard.value).length) + \" \", 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_41, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(manageCard.value), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: tag,\n                                                class: \"cardhub-preview__tag\"\n                                            }, _toDisplayString(tag), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_42, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageOverview.value, (item) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: item.label,\n                                                class: \"cardhub-manage__overview-card\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_43, _toDisplayString(item.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_44, _toDisplayString(item.value), 1 /* TEXT */),\n                                                (item.hint)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_45, _toDisplayString(item.hint), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_46, [\n                                    (manageAvatarUrl.value)\n                                        ? (_openBlock(), _createElementBlock(\"img\", {\n                                            key: 0,\n                                            src: manageAvatarUrl.value,\n                                            alt: \"\"\n                                        }, null, 8 /* PROPS */, _hoisted_47))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_48, [\n                                _cache[63] || (_cache[63] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"\", -1 /* CACHED */)),\n                                (manageDetails.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_49, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageDetails.value, (detail) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: detail.label,\n                                                class: \"cardhub-manage__detail\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_50, _toDisplayString(detail.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_51, _toDisplayString(detail.value), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_52, _toDisplayString(manageDetailsHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_53, [\n                                _cache[64] || (_cache[64] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_54, [\n                                    (manageOpeningLines.value.length)\n                                        ? (_openBlock(true), _createElementBlock(_Fragment, { key: 0 }, _renderList(manageOpeningLines.value, (opening, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__opening\"\n                                            }, _toDisplayString(opening), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                            _createTextVNode(\"\")\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_55, [\n                                _createElementVNode(\"div\", _hoisted_56, [\n                                    _cache[65] || (_cache[65] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_57, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: openLatestChat,\n                                            onPointerdown: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[20] || (_cache[20] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \"  \", 32 /* NEED_HYDRATION */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: openNewChat,\n                                            onPointerdown: _cache[22] || (_cache[22] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[24] || (_cache[24] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \"  \", 32 /* NEED_HYDRATION */)\n                                    ])\n                                ]),\n                                (manageChats.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_58, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageChats.value, (msg, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__chat-row\",\n                                                role: \"button\",\n                                                tabindex: \"0\",\n                                                onClick: ($event) => (openChat(msg)),\n                                                onKeydown: _withKeys(_withModifiers(($event) => (openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_60, [\n                                                    _createElementVNode(\"div\", _hoisted_61, _toDisplayString(msg.name), 1 /* TEXT */),\n                                                    (msg.label && msg.label !== msg.name)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_62, _toDisplayString(msg.label), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ]),\n                                                _createElementVNode(\"span\", _hoisted_63, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                            ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_59));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_64, _toDisplayString(manageChatHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_65, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[25] || (_cache[25] = _withModifiers(($event) => (handleCardAction(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[26] || (_cache[26] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[27] || (_cache[27] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[28] || (_cache[28] = _withModifiers(() => { }, [\"stop\"]))\n                                }, _toDisplayString(manageCard.value.origin === 'tavern' ? '' : ''), 33 /* TEXT, NEED_HYDRATION */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[29] || (_cache[29] = _withModifiers(($event) => (manageDelete(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[30] || (_cache[30] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[31] || (_cache[31] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[32] || (_cache[32] = _withModifiers(() => { }, [\"stop\"]))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (confirmState.open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-confirm\",\n                        onClick: _cache[36] || (_cache[36] = _withModifiers(($event) => (resolveConfirm('cancel')), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_66, [\n                            _createElementVNode(\"div\", _hoisted_67, _toDisplayString(confirmState.title), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_68, _toDisplayString(confirmState.message), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_69, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-cancel\",\n                                    type: \"button\",\n                                    onClick: _cache[33] || (_cache[33] = ($event) => (resolveConfirm('cancel')))\n                                }, _toDisplayString(confirmState.cancelLabel), 1 /* TEXT */),\n                                (confirmState.altLabel)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"cardhub-confirm__button is-danger\",\n                                        type: \"button\",\n                                        onClick: _cache[34] || (_cache[34] = ($event) => (resolveConfirm('alt')))\n                                    }, _toDisplayString(confirmState.altLabel), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-confirm\",\n                                    type: \"button\",\n                                    onClick: _cache[35] || (_cache[35] = ($event) => (resolveConfirm('confirm')))\n                                }, _toDisplayString(confirmState.confirmLabel), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (exportDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"cardhub-export\",\n                        onClick: _withModifiers(closeExportDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_70, [\n                            _createElementVNode(\"div\", _hoisted_71, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[66] || (_cache[66] = _createElementVNode(\"div\", { class: \"cardhub-export__title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_72, \"  \" + _toDisplayString(exportSelectedItems.value.length) + \" / \" + _toDisplayString(exportVisibleCandidates.value.length), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_73, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[37] || (_cache[37] = ($event) => ((exportSearch).value = $event)),\n                                    class: \"cardhub-export__search\",\n                                    type: \"search\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, exportSearch.value]\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_74, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': exportStatusFilter.value === 'all' }]),\n                                        type: \"button\",\n                                        onClick: _cache[38] || (_cache[38] = ($event) => (exportStatusFilter.value = 'all'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': exportStatusFilter.value === 'imported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[39] || (_cache[39] = ($event) => (exportStatusFilter.value = 'imported'))\n                                    }, \"  \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': exportStatusFilter.value === 'unimported' }]),\n                                        type: \"button\",\n                                        onClick: _cache[40] || (_cache[40] = ($event) => (exportStatusFilter.value = 'unimported'))\n                                    }, \"  \", 2 /* CLASS */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_75, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(exportAllTags.value, (tag) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: tag,\n                                            class: _normalizeClass([\"cardhub-export__chip\", { 'is-active': exportTagFilters.value.includes(tag) }]),\n                                            type: \"button\",\n                                            onClick: ($event) => (toggleExportTagFilter(tag))\n                                        }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_76));\n                                    }), 128 /* KEYED_FRAGMENT */)),\n                                    (exportTagFilters.value.length)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"cardhub-export__chip cardhub-export__chip--clear\",\n                                            type: \"button\",\n                                            onClick: clearExportTagFilter\n                                        }, \"  \"))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-export__toolbar\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: selectAllExport\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: clearExportSelection\n                                }, \"\"),\n                                _cache[67] || (_cache[67] = _createElementVNode(\"div\", { class: \"cardhub-export__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeExportDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-export__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: confirmExportSelected\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_77, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(exportVisibleCandidates.value, (item) => {\n                                    return (_openBlock(), _createElementBlock(\"label\", {\n                                        key: item.id,\n                                        class: \"cardhub-export__item\"\n                                    }, [\n                                        _createElementVNode(\"input\", {\n                                            class: \"cardhub-export__checkbox\",\n                                            type: \"checkbox\",\n                                            checked: isExportSelected(item.id),\n                                            onChange: ($event) => (toggleExportSelection(item.id))\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_78),\n                                        _createElementVNode(\"div\", _hoisted_79, [\n                                            _createElementVNode(\"div\", _hoisted_80, _toDisplayString(item.name), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_81, [\n                                                _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                            ]),\n                                            (displayTags(item).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_82, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                        return (_openBlock(), _createElementBlock(\"span\", {\n                                                            key: tag,\n                                                            class: \"cardhub-export__tag\"\n                                                        }, _toDisplayString(tag), 1 /* TEXT */));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (batchTagDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"cardhub-batch\",\n                        onClick: _withModifiers(closeBatchTagDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_83, [\n                            _createElementVNode(\"div\", _hoisted_84, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[68] || (_cache[68] = _createElementVNode(\"div\", { class: \"cardhub-batch__title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_85, \"  \" + _toDisplayString(batchTagSelectedIds.value.length) + \" / \" + _toDisplayString(batchTagVisibleCandidates.value.length), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeBatchTagDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_86, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[41] || (_cache[41] = ($event) => ((batchTagSearch).value = $event)),\n                                    class: \"cardhub-batch__search\",\n                                    type: \"search\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, batchTagSearch.value]\n                                ]),\n                                _cache[69] || (_cache[69] = _createElementVNode(\"div\", { class: \"cardhub-batch__hint\" }, \"\", -1 /* CACHED */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_87, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[42] || (_cache[42] = ($event) => ((batchTagInput).value = $event)),\n                                    type: \"text\",\n                                    placeholder: \"/\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, batchTagInput.value]\n                                ])\n                            ]),\n                            (batchTagSuggestions.value.length)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_88, [\n                                    _cache[70] || (_cache[70] = _createElementVNode(\"span\", { class: \"cardhub-batch__suggest-title\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_89, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(batchTagSuggestions.value, (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: tag,\n                                                class: _normalizeClass([\"cardhub-batch__chip\", { 'is-active': batchTagSelectedTags.value.includes(tag) }]),\n                                                type: \"button\",\n                                                onClick: ($event) => (toggleBatchTagSuggestion(tag))\n                                            }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_90));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createElementVNode(\"div\", _hoisted_91, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-batch__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: selectAllBatchTags\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-batch__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: clearBatchTagSelection\n                                }, \"\"),\n                                _cache[71] || (_cache[71] = _createElementVNode(\"div\", { class: \"cardhub-batch__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-batch__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeBatchTagDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-batch__btn is-ghost\",\n                                    type: \"button\",\n                                    onClick: _cache[43] || (_cache[43] = ($event) => (applyBatchTags('remove')))\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-batch__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[44] || (_cache[44] = ($event) => (applyBatchTags('add')))\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_92, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(batchTagVisibleCandidates.value, (item) => {\n                                    return (_openBlock(), _createElementBlock(\"label\", {\n                                        key: item.id,\n                                        class: \"cardhub-batch__item\"\n                                    }, [\n                                        _createElementVNode(\"input\", {\n                                            class: \"cardhub-batch__checkbox\",\n                                            type: \"checkbox\",\n                                            checked: batchTagSelectedSet.value.has(item.id),\n                                            onChange: ($event) => (toggleBatchTagSelection(item.id))\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_93),\n                                        _createElementVNode(\"div\", _hoisted_94, [\n                                            _createElementVNode(\"div\", _hoisted_95, _toDisplayString(item.name), 1 /* TEXT */),\n                                            _createElementVNode(\"div\", _hoisted_96, [\n                                                _createElementVNode(\"span\", null, _toDisplayString(item.origin === 'tavern' ? '' : ''), 1 /* TEXT */),\n                                                _createElementVNode(\"span\", null, _toDisplayString(displayTags(item).length) + \" \", 1 /* TEXT */)\n                                            ]),\n                                            (displayTags(item).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_97, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(item).slice(0, 3), (tag) => {\n                                                        return (_openBlock(), _createElementBlock(\"span\", {\n                                                            key: tag,\n                                                            class: \"cardhub-batch__tag\"\n                                                        }, _toDisplayString(tag), 1 /* TEXT */));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (themeDialogOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"cardhub-theme\",\n                        onClick: _withModifiers(closeThemeDialog, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_98, [\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__header\" }, [\n                                _cache[72] || (_cache[72] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__title\" }, \"\"),\n                                    _createElementVNode(\"div\", { class: \"cardhub-theme__subtitle\" }, \"\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-preview__close\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\")\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_99, [\n                                _createElementVNode(\"label\", _hoisted_100, [\n                                    _cache[73] || (_cache[73] = _createElementVNode(\"span\", null, \" 1\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[45] || (_cache[45] = ($event) => ((themeDraft.bgStart) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgStart]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_101, [\n                                    _cache[74] || (_cache[74] = _createElementVNode(\"span\", null, \" 2\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[46] || (_cache[46] = ($event) => ((themeDraft.bgEnd) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.bgEnd]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_102, [\n                                    _cache[75] || (_cache[75] = _createElementVNode(\"span\", null, \"/\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[47] || (_cache[47] = ($event) => ((themeDraft.surface) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surface]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_103, [\n                                    _cache[76] || (_cache[76] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[48] || (_cache[48] = ($event) => ((themeDraft.surfaceAlt) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.surfaceAlt]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_104, [\n                                    _cache[77] || (_cache[77] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[49] || (_cache[49] = ($event) => ((themeDraft.text) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.text]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_105, [\n                                    _cache[78] || (_cache[78] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[50] || (_cache[50] = ($event) => ((themeDraft.textMuted) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.textMuted]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_106, [\n                                    _cache[79] || (_cache[79] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[51] || (_cache[51] = ($event) => ((themeDraft.accent) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accent]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_107, [\n                                    _cache[80] || (_cache[80] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[52] || (_cache[52] = ($event) => ((themeDraft.accentStrong) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.accentStrong]\n                                    ])\n                                ]),\n                                _createElementVNode(\"label\", _hoisted_108, [\n                                    _cache[81] || (_cache[81] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[53] || (_cache[53] = ($event) => ((themeDraft.border) = $event)),\n                                        type: \"color\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, themeDraft.border]\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_109, [\n                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(themePresets, (preset) => {\n                                    return _createElementVNode(\"button\", {\n                                        key: preset.name,\n                                        class: \"cardhub-theme__preset\",\n                                        type: \"button\",\n                                        onClick: ($event) => (applyThemePreset(preset))\n                                    }, _toDisplayString(preset.name), 9 /* TEXT, PROPS */, _hoisted_110);\n                                }), 64 /* STABLE_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", { class: \"cardhub-theme__actions\" }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: resetThemeDraft\n                                }, \"\"),\n                                _cache[82] || (_cache[82] = _createElementVNode(\"div\", { class: \"cardhub-theme__spacer\" }, null, -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: closeThemeDialog\n                                }, \"\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-theme__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: saveThemeDraft\n                                }, \"\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 6 /* CLASS, STYLE */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=2bd55f74&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2bd55f74\"]])\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport App from '../ui/App.vue';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet app: ReturnType<typeof createApp> | null = null;\nlet $mount: JQuery<HTMLDivElement> | null = null;\nlet $style: JQuery<HTMLElement> | null = null;\n\nfunction ensureMounted() {\n  if ($mount) {\n    return;\n  }\n\n  $style = $(`<style>`)\n    .attr('data-cardhub-style', getScriptId())\n    .text(\n      `\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow: 0 6px 16px rgba(var(--cardhub-accent-rgb), 0.2);\n      }\n\n      .cardhub-button:hover {\n        background: rgba(var(--cardhub-accent-rgb), 0.85);\n        color: var(--cardhub-accent-text);\n        box-shadow: 0 8px 18px rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.75);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.18);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.95);\n        color: var(--cardhub-text);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: none;\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.95);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-tag {\n        padding: 2px 6px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100010;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-export {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100003;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100004;\n      }\n\n      .cardhub-batch__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 20px;\n        padding: 18px 18px 14px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        box-shadow: var(--cardhub-shadow-strong);\n        overflow: hidden;\n        margin: auto;\n      }\n\n      .cardhub-batch__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .cardhub-batch__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        display: grid;\n        place-items: center;\n        z-index: 100005;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type='color'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-theme__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 6px 10px;\n          min-height: 30px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview,\n        .cardhub-manage {\n          position: absolute !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-preview__panel,\n        .cardhub-manage__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n\n        .cardhub-preview__avatar {\n          height: 180px;\n          border-radius: 14px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-preview__actions {\n          gap: 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-tag {\n          font-size: 9px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export {\n          position: fixed !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n        }\n\n        .cardhub-export__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-batch {\n          position: fixed !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n        }\n\n        .cardhub-batch__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 12px !important;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          background: rgba(24, 16, 10, 0.55) !important;\n          backdrop-filter: blur(10px) !important;\n          -webkit-backdrop-filter: blur(10px) !important;\n        }\n\n        .cardhub-theme__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 12px !important;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type='color'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n      }\n    `,\n    )\n    .appendTo('head');\n\n  $mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  app = createApp(App);\n  app.mount($mount[0]);\n\n  watch(\n    () => cardHubState.open,\n    () => {},\n    { immediate: true },\n  );\n}\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (app) {\n        app.unmount();\n      }\n      if ($mount) {\n        $mount.remove();\n      }\n      if ($style) {\n        $style.remove();\n      }\n      app = null;\n      $mount = null;\n      $style = null;\n    },\n  };\n}\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["module","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","id","_k","push","___CSS_LOADER_EXPORT___","listToStyles","parentId","styles","newStyles","part","css","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","sfc","props","target","__vccOpts","key","val","cssMapping","base64","data","sourceMapping","__esModule","default","locals","add","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$existing","$","addClass","attr","empty","$anchor","selectors","selector","$target","first","$button","_","el","text","title","getAttribute","$container","closest","parent","findRoleManagerAnchor","console","warn","openOnce","createOpenOnce","open","on","event","preventDefault","stopImmediatePropagation","append","bindOpenEvents","off","registerRoleManagerEntry","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","html","entryDisposer","setTimeout","observer","MutationObserver","rootDocument","window","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","handler","wrapped","addEventListener","capture","removeEventListener","lastFiredAt","now","Date","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Vue","async","fetchCharacterSummaries","st","SillyTavern","ctx","getContext","getCharacters","error","characters","idCounts","Map","tagKeyCounts","tagIdToName","Array","isArray","tags","tag","name","set","character","directTags","avatarKey","avatar","createdRaw","create_date","date_added","created","created_at","timestamp","time","createdAt","coerceToTimestamp","stamp","String","tagBaseKey","tagKey","tagCount","mappedTags","tagMap","from","Set","baseId","count","lastChatRaw","last_interaction","last_interaction_time","last_interaction_date","last_chat_time","last_chat_date","last_message_time","last_message_date","update_time","last_modified","origin","lastChatAt","Number","isNaN","parsed","parse","uuidv4","replace","c","Math","random","LIBRARY_KEY","getStorage","script_id","writeLibrary","entries","vars","TavernHelper","getVariables","replaceVariables","readFileAsDataUrl","file","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","readFileAsText","readAsText","normalizeName","fileName","stableStringify","sort","b","localeCompare","buildFingerprint","rawType","raw","source","trimmed","trim","hash","charCodeAt","hashString","loadLibrary","stored","readLibrary","changed","entry","addToLibrary","files","existingEntries","current","fingerprints","fingerprint","ensureFingerprint","nextEntries","endsWith","dataUrl","has","parsedName","json","merged","removeFromLibrary","entryId","updated","cardHubState","reactive","loading","search","lastOpenSource","library","setOpen","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","direct","mapped","getTagsForAvatar","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","tagIds","tagName","existing","crypto","randomUUID","ensureTag","saveSettingsDebounced","_hoisted_1","class","role","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94","_hoisted_95","_hoisted_96","_hoisted_97","_hoisted_98","_hoisted_99","_hoisted_100","_hoisted_101","_hoisted_102","_hoisted_103","_hoisted_104","_hoisted_105","_hoisted_106","_hoisted_107","_hoisted_108","_hoisted_109","_hoisted_110","FAVORITES_KEY","LAST_CHAT_CACHE_KEY","IMPORT_CACHE_KEY","THEME_KEY","__name","setup","__props","selectedTags","ref","activeTagKey","tagInput","statusFilter","pageSize","currentPage","importInput","manageCard","manageOpenings","manageChats","manageOpeningLines","computed","previewOpenings","openings","maxItems","opening","maxLines","contentLines","extractContentLines","slice","normalized","normalizeBriefMessage","chunks","chunkText","combined","chunk","previewOpeningLines","preview","manageRequestId","confirmState","message","confirmLabel","cancelLabel","altLabel","allCards","mergedTagsMap","card","manageProfile","manageOpeningSummary","manageChatSummary","exportDialogOpen","exportSelectedIds","exportCandidates","exportSearch","exportStatusFilter","exportTagFilters","batchTagDialogOpen","batchTagSelectedIds","batchTagSearch","batchTagInput","batchTagSelectedTags","exportAllTags","tagSet","exportVisibleCandidates","some","includes","keyword","exportSelectedSet","exportSelectedItems","batchTagCandidates","filteredCharacters","batchTagVisibleCandidates","batchTagSelectedSet","batchTagSuggestions","allTags","favoriteIds","favoriteSet","sortKey","favoritesOnly","lastChatCache","importCache","defaultTheme","bgStart","bgEnd","surface","surfaceAlt","textMuted","accent","accentStrong","border","themeDialogOpen","themeCurrent","themeDraft","themeStyle","theme","hexToRgb","contrastTextColor","themePresets","manageDetails","profile","details","pushDetail","label","maxChars","lines","truncated","hasMore","previewDetailText","description","personality","scenario","creatorNotes","systemPrompt","postHistory","creator","manageDetailsHint","manageChatHint","manageOverview","items","worldName","worldBookName","worldCount","worldBookCount","worldValue","worldHint","hint","chat","chatValue","chatHint","total","latest","openingValue","openingHint","alternate","applyFavoriteFilter","applyStatusFilter","sortCards","applyTagFilter","totalPages","ceil","pagedCharacters","start","avatarUrl","useFull","getCharAvatarPath","avatarStyle","url","backgroundImage","displayTags","saveLastChatCache","cache","getChatCacheKey","getImportAt","getLastChatAt","updateLastChatCacheForCard","keys","size","next","updateImportCache","saveImportCache","toggleFavorite","saveFavoriteList","withScore","byName","lhs","rhs","aTime","bTime","aCreated","bCreated","manageAvatarUrl","clearTagFilter","hex","parseInt","rgb","split","g","channel","themeFrame","themeTimer","scheduleThemeApply","cancelAnimationFrame","clearTimeout","requestAnimationFrame","root","getCardHubRoot","style","setProperty","applyTheme","loadThemeFromGlobal","pick","normalizeTheme","openThemeDialog","assign","nextTick","closeThemeDialog","resetThemeDraft","saveThemeDraft","saveThemeToGlobal","clearExportTagFilter","closeExportDialog","openBatchTagDialog","toastr","warning","closeBatchTagDialog","selectAllBatchTags","clearBatchTagSelection","applyBatchTags","mode","input","selected","parseBatchTags","actionLabel","openConfirm","cards","ids","getCardsByIds","currentTags","nextSet","delete","currentSet","every","isSameTagSet","applyTagUpdate","success","selectAllExport","clearExportSelection","prevPage","nextPage","normalizeNameKey","toLocaleLowerCase","normalizeAvatarKey","decodeURIComponent","pop","resolveConfirm","resolver","confirmTag","cancelTagEdit","updateLibraryTags","triggerImport","click","handleImportFiles","exportSelected","confirmExportSelected","tagLabel","statusLabel","searchLabel","exportCard","sleep","handleCardAction","duplicate","findDuplicateCharacterByName","headers","getRequestHeaders","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","fetch","method","importLibraryCard","downloadBlob","Blob","exportLibraryCard","avatarPath","response","openManage","requestId","manageResult","chatsResult","allSettled","resolveManageData","resolveRecentChats","manageData","status","openingSummary","chatData","summary","closeManage","parseJsonSafe","bytes","comma","indexOf","binary","atob","Uint8Array","dataUrlToBytes","signature","offset","readUint32BE","bytesToString","subarray","dataStart","dataEnd","parseTextChunk","parseIntlTextChunk","extractPngTextChunks","allowedKeys","parseCardPayload","parsePngCardData","parseLibraryCardData","extractOpeningMessages","extractCardProfile","extractOpeningSummary","findIndex","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","RawCharacter","allowAvatar","primary","nullIndex","compressed","cursor","langEnd","translatedEnd","isLikelyBase64","decoded","TextDecoder","decode","decodeBase64Text","pickString","creatorcomment","creator_notes","system_prompt","post_history_instructions","book","character_book","values","firstCount","alt","alternate_greetings","extensions","formatMaybeTimestamp","toLocaleString","hour12","coerceTimestamp","extractChatLatestTimestamp","candidates","file_name","file_id","match","year","month","day","hour","minute","second","getTime","parseTimestampFromText","sortChatBrief","left","extractChatLatestLabel","watch","deep","onMounted","getFavoriteList","fromEntries","loadLastChatCache","loadImportCache","warmRecentChatCache","warmImportCache","chatCacheToken","pending","token","cached","brief","getChatHistoryBrief","formatChatTitle","formatChatFileLabel","filtered","line","startsWith","sorted","mes","openLatestChat","openChat","openNewChat","selectManageCharacter","ensureSelected","triggerSlash","close","selection","normalizeChatId","opener","openCharacterChat","catch","opened","timeoutMs","chatId","waitForChatOpen","targetName","targetAvatar","findCharacterIndex","selectCharacterById","switchMenu","getCurrentCharacterId","waitForCharacterSelection","characterId","ms","manageDelete","deleteChoice","moveToLibrary","deleteFromTavern","deleteChats","payload","avatar_url","delete_chats","ok","detail","statusText","URL","createObjectURL","href","download","revokeObjectURL","refresh","_ctx","_cache","onClick","$event","placeholder","ref_key","accept","multiple","onChange","disabled","focus","onMousedown","onTouchstart","onKeydown","onBlur","onPointerdown","src","msg","tabindex","checked","preset","app","$mount","$style","ensureMounted","appendTo","createApp","App","mount","immediate","createCardHubController","toggle","refreshCharacters","destroy","unmount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}