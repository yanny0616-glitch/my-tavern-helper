import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';var n={424(n,a,e){function t(n,a){for(var e=[],t={},r=0;r<a.length;r++){var i=a[r],o=i[0],c={id:n+':'+r,css:i[1],media:i[2],sourceMap:i[3]};t[o]?t[o].parts.push(c):e.push(t[o]={id:o,parts:[c]})}return e}e.d(a,{A:()=>b});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var i={},o=r&&(document.head||document.getElementsByTagName('head')[0]),c=null,d=0,s=!1,l=function(){},p=null,u='data-vue-ssr-id',g='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function b(n,a,e,r){s=e,p=r||{};var o=t(n,a);return h(o),function(a){for(var e=[],r=0;r<o.length;r++){var c=o[r];(d=i[c.id]).refs--,e.push(d)}a?h(o=t(n,a)):o=[];for(r=0;r<e.length;r++){var d;if(0===(d=e[r]).refs){for(var s=0;s<d.parts.length;s++)d.parts[s]();delete i[d.id]}}}}function h(n){for(var a=0;a<n.length;a++){var e=n[a],t=i[e.id];if(t){t.refs++;for(var r=0;r<t.parts.length;r++)t.parts[r](e.parts[r]);for(;r<e.parts.length;r++)t.parts.push(A(e.parts[r]));t.parts.length>e.parts.length&&(t.parts.length=e.parts.length)}else{var o=[];for(r=0;r<e.parts.length;r++)o.push(A(e.parts[r]));i[e.id]={id:e.id,refs:1,parts:o}}}}function C(){var n=document.createElement('style');return n.type='text/css',o.appendChild(n),n}function A(n){var a,e,t=document.querySelector('style['+u+'~="'+n.id+'"]');if(t){if(s)return l;t.parentNode.removeChild(t)}if(g){var r=d++;t=c||(c=C()),a=v.bind(null,t,r,!1),e=v.bind(null,t,r,!0)}else t=C(),a=x.bind(null,t),e=function(){t.parentNode.removeChild(t)};return a(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;a(n=t)}else e()}}var f,m=(f=[],function(n,a){return f[n]=a,f.filter(Boolean).join('\n')});function v(n,a,e,t){var r=e?'':t.css;if(n.styleSheet)n.styleSheet.cssText=m(a,r);else{var i=document.createTextNode(r),o=n.childNodes;o[a]&&n.removeChild(o[a]),o.length?n.insertBefore(i,o[a]):n.appendChild(i)}}function x(n,a){var e=a.css,t=a.media,r=a.sourceMap;if(t&&n.setAttribute('media',t),p.ssrId&&n.setAttribute(u,a.id),r&&(e+='\n/*# sourceURL='+r.sources[0]+' */',e+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},492(n){n.exports=function(n){var a=n[1],e=n[3];if(!e)return a;if('function'==typeof btoa){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(t),i='/*# '.concat(r,' */');return[a].concat([i]).join('\n')}return[a].join('\n')}},502(n,a){a.A=(n,a)=>{const e=n.__vccOpts||n;for(const[n,t]of a)e[n]=t;return e}},527(n,a,e){e.r(a),e.d(a,{default:()=>c});var t=e(492),r=e.n(t),i=e(748),o=e.n(i)()(r());o.push([n.id,'.cardhub-root[data-v-937272d2]{position:fixed;inset:0;z-index:9999;font-family:"ZCOOL XiaoWei","STSong","Songti SC","SimSun",serif;color:#1b1b1b;display:none}.cardhub-root.open[data-v-937272d2]{display:flex;align-items:center;justify-content:center}.cardhub-backdrop[data-v-937272d2]{position:absolute;inset:0;background:radial-gradient(circle at top,rgba(255,248,236,0.9),rgba(36,30,24,0.85));backdrop-filter:blur(6px)}.cardhub-panel[data-v-937272d2]{position:relative;width:min(980px,94%);max-height:92%;background:linear-gradient(160deg,#fff9f0,#f3e4d4);border-radius:28px;box-shadow:0 30px 90px rgba(0,0,0,0.28);display:flex;flex-direction:column;overflow:hidden;z-index:1}.cardhub-header[data-v-937272d2]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid rgba(86,59,44,0.15)}.cardhub-title__main[data-v-937272d2]{font-size:26px;letter-spacing:2px}.cardhub-title__sub[data-v-937272d2]{font-size:12px;color:#7d5b46;margin-left:10px}.cardhub-actions[data-v-937272d2]{display:flex;gap:10px}.cardhub-close[data-v-937272d2]{border:none;background:rgba(43,32,24,0.12);color:#3b2a20;width:34px;height:34px;border-radius:999px;font-size:20px;line-height:34px;text-align:center;cursor:pointer}.cardhub-close[data-v-937272d2]:hover{background:rgba(43,32,24,0.2)}.cardhub-toolbar[data-v-937272d2]{display:flex;gap:10px;padding:16px 24px;flex-wrap:wrap}.cardhub-search[data-v-937272d2]{flex:1;min-width:180px;border-radius:999px;border:1px solid rgba(86,59,44,0.2);padding:8px 14px;background:#fffaf4}.cardhub-button[data-v-937272d2]{border:none;padding:8px 16px;border-radius:999px;background:#d46b3d;color:#fff;cursor:pointer;font-size:12px}.cardhub-button.is-ghost[data-v-937272d2]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-import-input[data-v-937272d2]{display:none}.cardhub-body[data-v-937272d2]{display:grid;grid-template-columns:minmax(160px,220px) 1fr;gap:0;flex:1;min-height:0}.cardhub-sidebar[data-v-937272d2]{padding:20px;border-right:1px solid rgba(86,59,44,0.15);display:flex;flex-direction:column;gap:12px}.cardhub-chip-row[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-section-title[data-v-937272d2]{font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-chip[data-v-937272d2]{text-align:left;border:none;background:rgba(255,255,255,0.6);border-radius:12px;padding:8px 10px;cursor:pointer;font-size:12px}.cardhub-chip.is-active[data-v-937272d2]{background:#2b2018;color:#fff5ea}.cardhub-placeholder[data-v-937272d2]{font-size:12px;color:#9a7a63}.cardhub-tag-filter[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-tag-filter__chip[data-v-937272d2]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.7);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer}.cardhub-tag-filter__chip.is-active[data-v-937272d2]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-chip--clear[data-v-937272d2]{margin-top:8px}.cardhub-content[data-v-937272d2]{padding:20px;overflow:auto}.cardhub-loading[data-v-937272d2],.cardhub-empty[data-v-937272d2]{padding:40px 0;text-align:center;color:#7d5b46}.cardhub-grid[data-v-937272d2]{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}.cardhub-card[data-v-937272d2]{background:rgba(255,255,255,0.78);border-radius:18px;padding:14px;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;border:1px solid rgba(86,59,44,0.15);cursor:pointer}.cardhub-card__avatar[data-v-937272d2]{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#f4d7c4,#d36a3b);background-size:cover;background-position:center;color:#4a2a1f;display:grid;place-items:center;font-weight:700}.cardhub-card__avatar.has-avatar span[data-v-937272d2]{display:none}.cardhub-card__name[data-v-937272d2]{font-size:14px;font-weight:600}.cardhub-card__meta[data-v-937272d2]{display:flex;gap:8px;font-size:11px;color:#7d5b46}.cardhub-card__tags[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}.cardhub-tag[data-v-937272d2]{border:1px solid rgba(106,63,42,0.3);background:#fff6ea;border-radius:999px;padding:4px 8px;font-size:11px;color:#6a3f2a;cursor:pointer}.cardhub-tag__remove[data-v-937272d2]{margin-left:4px;font-weight:700}.cardhub-tag.is-add[data-v-937272d2]{background:transparent;border-style:dashed}.cardhub-tag-input[data-v-937272d2]{border:1px dashed rgba(106,63,42,0.5);background:#fffaf4;border-radius:999px;padding:4px 10px;font-size:11px;min-width:80px;color:#6a3f2a;outline:none;height:24px;line-height:16px}.cardhub-tag-input[data-v-937272d2]:focus{border-color:rgba(106,63,42,0.85)}.cardhub-card__action[data-v-937272d2]{grid-column:span 2;margin-top:10px;border:none;background:#2b2018;color:#fff5ea;padding:6px 12px;border-radius:12px;font-size:12px;cursor:pointer}.cardhub-card__actions[data-v-937272d2]{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}.cardhub-card__action.is-secondary[data-v-937272d2]{background:#d9c6b6;color:#3b2a20}.cardhub-preview[data-v-937272d2]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100000}.cardhub-preview__panel[data-v-937272d2]{width:min(520px,92vw);background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:20px;position:relative;display:grid;gap:14px}.cardhub-preview__close[data-v-937272d2]{position:absolute;top:14px;right:14px;border:none;width:30px;height:30px;border-radius:999px;background:rgba(43,32,24,0.15);color:#3b2a20;font-size:18px;cursor:pointer}.cardhub-preview__avatar[data-v-937272d2]{width:100%;height:260px;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-preview__avatar img[data-v-937272d2]{width:100%;height:100%;object-fit:contain}.cardhub-preview__info[data-v-937272d2]{display:grid;gap:6px}.cardhub-preview__name[data-v-937272d2]{font-size:20px;font-weight:700}.cardhub-preview__meta[data-v-937272d2]{display:flex;gap:10px;font-size:12px;color:#7d5b46}.cardhub-preview__tags[data-v-937272d2]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-preview__tag[data-v-937272d2]{padding:6px 10px;border-radius:999px;border:1px solid rgba(106,63,42,0.3);background:#fffaf4;font-size:12px;color:#6a3f2a}.cardhub-preview__actions[data-v-937272d2]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-manage[data-v-937272d2]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100001}.cardhub-manage__panel[data-v-937272d2]{width:min(760px,94vw);max-height:88vh;background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:22px;position:relative;display:grid;gap:16px;overflow:auto}.cardhub-manage__top[data-v-937272d2]{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}.cardhub-manage__media[data-v-937272d2]{width:220px;aspect-ratio:3/4;height:auto;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-manage__media img[data-v-937272d2]{width:100%;height:100%;object-fit:cover}.cardhub-manage__summary[data-v-937272d2]{display:grid;gap:6px}.cardhub-manage__section[data-v-937272d2]{display:grid;gap:8px}.cardhub-manage__label[data-v-937272d2]{display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__jump[data-v-937272d2]{border:1px solid rgba(106,63,42,0.35);background:transparent;color:#6a3f2a;border-radius:999px;padding:4px 10px;font-size:11px;cursor:pointer;text-transform:none}.cardhub-manage__jump[data-v-937272d2]:hover{background:rgba(106,63,42,0.1)}.cardhub-manage__content[data-v-937272d2]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap}.cardhub-manage__opening[data-v-937272d2]{padding:6px 0;border-bottom:1px dashed rgba(106,63,42,0.2)}.cardhub-manage__opening[data-v-937272d2]:last-child{border-bottom:none}.cardhub-manage__chat[data-v-937272d2]{display:grid;gap:10px}.cardhub-manage__chat-row[data-v-937272d2]{display:grid;grid-template-columns:minmax(140px,220px) 1fr;gap:12px;font-size:12px;color:#3b2a20;align-items:start;padding:6px 8px;border-radius:10px;cursor:pointer}.cardhub-manage__chat-row[data-v-937272d2]:hover{background:rgba(106,63,42,0.08)}.cardhub-manage__chat-name[data-v-937272d2]{flex:0 0 auto;font-weight:600;color:#6a3f2a;word-break:break-word}.cardhub-manage__chat-text[data-v-937272d2]{color:#3b2a20;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.cardhub-manage__empty[data-v-937272d2]{font-size:12px;color:#9a7a63}.cardhub-manage__actions[data-v-937272d2]{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media (max-width:720px){.cardhub-body[data-v-937272d2]{grid-template-columns:1fr}.cardhub-sidebar[data-v-937272d2]{flex-direction:column;border-right:none;border-bottom:1px solid rgba(86,59,44,0.15);gap:8px}.cardhub-chip-row[data-v-937272d2],.cardhub-tag-filter[data-v-937272d2]{flex-wrap:nowrap;overflow-x:auto;padding-bottom:4px}.cardhub-chip-row[data-v-937272d2]::-webkit-scrollbar,.cardhub-tag-filter[data-v-937272d2]::-webkit-scrollbar{height:6px}.cardhub-chip-row[data-v-937272d2]::-webkit-scrollbar-thumb,.cardhub-tag-filter[data-v-937272d2]::-webkit-scrollbar-thumb{background:rgba(106,63,42,0.2);border-radius:999px}.cardhub-panel[data-v-937272d2]{width:min(98vw,520px);max-height:96vh}.cardhub-header[data-v-937272d2]{flex-direction:row;align-items:center;justify-content:space-between;gap:8px;padding:12px 14px}.cardhub-toolbar[data-v-937272d2]{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;padding:10px 14px 12px}.cardhub-search[data-v-937272d2]{width:100%;grid-column:1/-1}.cardhub-button[data-v-937272d2]{width:100%}.cardhub-button.is-ghost[data-v-937272d2]{grid-column:span 1}.cardhub-tag-filter__chip[data-v-937272d2],.cardhub-tag[data-v-937272d2]{font-size:10px;padding:4px 8px}.cardhub-card[data-v-937272d2]{grid-template-columns:1fr}.cardhub-card__action[data-v-937272d2]{grid-column:auto}.cardhub-manage__panel[data-v-937272d2]{width:min(96vw,560px);max-height:90vh}.cardhub-manage__top[data-v-937272d2]{grid-template-columns:1fr}.cardhub-manage__actions[data-v-937272d2]{grid-template-columns:1fr}}\n','',{version:3,sources:['webpack://./src/角色卡管理插件/ui/App.vue'],names:[],mappings:'AAo/BA,+BACE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,+DAAoE,CACpE,aAAc,CACd,YACF,CAEA,oCACE,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,mCACE,iBAAkB,CAClB,OAAQ,CACR,mFAA4F,CAC5F,yBACF,CAEA,gCACE,iBAAkB,CAClB,oBAAsB,CACtB,cAAe,CACf,kDAAqD,CACrD,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eAAgB,CAChB,SACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,2CACF,CAEA,sCACE,cAAe,CACf,kBACF,CAEA,qCACE,cAAe,CACf,aAAc,CACd,gBACF,CAEA,kCACE,YAAa,CACb,QACF,CAEA,gCACE,WAAY,CACZ,8BAAkC,CAClC,aAAc,CACd,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,cACF,CAEA,sCACE,6BACF,CAEA,kCACE,YAAa,CACb,QAAS,CACT,iBAAkB,CAClB,cACF,CAEA,iCACE,MAAO,CACP,eAAgB,CAChB,mBAAoB,CACpB,mCAAuC,CACvC,gBAAiB,CACjB,kBACF,CAEA,iCACE,WAAY,CACZ,gBAAiB,CACjB,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,cAAe,CACf,cACF,CAEA,0CACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,uCACE,YACF,CAEA,+BACE,YAAa,CACb,6CAA+C,CAC/C,KAAM,CACN,MAAO,CACP,YACF,CAEA,kCACE,YAAa,CACb,0CAA8C,CAC9C,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,mCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,wCACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,+BACE,eAAgB,CAChB,WAAY,CACZ,gCAAoC,CACpC,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cACF,CAEA,yCACE,kBAAmB,CACnB,aACF,CAEA,sCACE,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,2CACE,qCAAyC,CACzC,gCAAoC,CACpC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cACF,CAEA,qDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,sCACE,cACF,CAEA,kCACE,YAAa,CACb,aACF,CAEA,kEAEE,cAAe,CACf,iBAAkB,CAClB,aACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,yDACF,CAEA,+BACE,iCAAqC,CACrC,kBAAmB,CACnB,YAAa,CACb,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,kBAAmB,CACnB,oCAAwC,CACxC,cACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,kDAAqD,CACrD,qBAAsB,CACtB,0BAA2B,CAC3B,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,uDACE,YACF,CAEA,qCACE,cAAe,CACf,eACF,CAEA,qCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,8BACE,oCAAwC,CACxC,kBAAmB,CACnB,mBAAoB,CACpB,eAAgB,CAChB,cAAe,CACf,aAAc,CACd,cACF,CAEA,sCACE,eAAgB,CAChB,eACF,CAEA,qCACE,sBAAuB,CACvB,mBACF,CAEA,oCACE,qCAAyC,CACzC,kBAAmB,CACnB,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,aAAc,CACd,YAAa,CACb,WAAY,CACZ,gBACF,CAEA,0CACE,iCACF,CAEA,uCACE,kBAAmB,CACnB,eAAgB,CAChB,WAAY,CACZ,kBAAmB,CACnB,aAAc,CACd,gBAAiB,CACjB,kBAAmB,CACnB,cAAe,CACf,cACF,CAEA,wCACE,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,eACF,CAEA,oDACE,kBAAmB,CACnB,aACF,CAEA,kCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,iBAAkB,CAClB,QAAS,CACT,UAAW,CACX,WAAY,CACZ,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,8BAAkC,CAClC,aAAc,CACd,cAAe,CACf,cACF,CAEA,0CACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,8CACE,UAAW,CACX,WAAY,CACZ,kBACF,CAEA,wCACE,YAAa,CACb,OACF,CAEA,wCACE,cAAe,CACf,eACF,CAEA,wCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,wCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,uCACE,gBAAiB,CACjB,mBAAoB,CACpB,oCAAwC,CACxC,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,2CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,iCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,aACF,CAEA,sCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,iBACF,CAEA,wCACE,WAAY,CACZ,gBAAmB,CACnB,WAAY,CACZ,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,4CACE,UAAW,CACX,WAAY,CACZ,gBACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,wCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,uCACE,qCAAyC,CACzC,sBAAuB,CACvB,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mBACF,CAEA,6CACE,8BACF,CAEA,0CACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,0CACE,aAAc,CACd,4CACF,CAEA,qDACE,kBACF,CAEA,uCACE,YAAa,CACb,QACF,CAEA,2CACE,YAAa,CACb,6CAA+C,CAC/C,QAAS,CACT,cAAe,CACf,aAAc,CACd,iBAAkB,CAClB,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,iDACE,+BACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,aAAc,CACd,qBACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,mBAAoB,CACpB,oBAAqB,CACrB,2BAA4B,CAC5B,eACF,CAEA,wCACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CACA,yBAEE,+BACE,yBACF,CAEA,kCACE,qBAAsB,CACtB,iBAAkB,CAClB,2CAA+C,CAC/C,OACF,CAEA,wEAEE,gBAAiB,CACjB,eAAgB,CAChB,kBACF,CAEA,8GAEE,UACF,CAEA,0HAEE,8BAAkC,CAClC,mBACF,CAEA,gCACE,qBAAuB,CACvB,eACF,CAEA,iCACE,kBAAmB,CACnB,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,iBACF,CAEA,kCACE,YAAa,CACb,wCAAyC,CACzC,OAAQ,CACR,sBACF,CAEA,iCACE,UAAW,CACX,gBACF,CAEA,iCACE,UACF,CAEA,0CACE,kBACF,CAEA,yEAEE,cAAe,CACf,eACF,CAEA,+BACE,yBACF,CAEA,uCACE,gBACF,CACA,wCACE,qBAAuB,CACvB,eACF,CAEA,sCACE,yBACF,CAEA,0CACE,yBACF,CACF',sourcesContent:['<template>\n  <div class="cardhub-root" :class="{ open: state.open }">\n    <div class="cardhub-backdrop" @click="close" />\n    <section class="cardhub-panel" role="dialog" aria-label="CardHub 角色卡管理器">\n      <header class="cardhub-header">\n        <div class="cardhub-title">\n          <span class="cardhub-title__main">CardHub</span>\n          <span class="cardhub-title__sub">角色卡管理器</span>\n        </div>\n        <div class="cardhub-actions">\n          <button class="cardhub-close" type="button" aria-label="关闭" @click="close">\n            <span aria-hidden="true">×</span>\n          </button>\n        </div>\n      </header>\n\n      <div class="cardhub-toolbar">\n        <input\n          v-model="state.search"\n          class="cardhub-search"\n          type="search"\n          placeholder="搜索角色名或标签"\n        />\n        <button class="cardhub-button" type="button" @click="refresh">刷新</button>\n        <button class="cardhub-button is-ghost" type="button" @click="triggerImport">导入</button>\n        <button class="cardhub-button is-ghost" type="button" @click="exportSelected">批量导出</button>\n        <input\n          ref="importInput"\n          class="cardhub-import-input"\n          type="file"\n          accept=".png,.json"\n          multiple\n          @change="handleImportFiles"\n        />\n      </div>\n\n      <div class="cardhub-body">\n        <div class="cardhub-sidebar">\n          <div class="cardhub-section-title">分类</div>\n          <div class="cardhub-chip-row">\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'all\' }"\n              type="button"\n              @click="statusFilter = \'all\'"\n            >\n              全部\n            </button>\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'imported\' }"\n              type="button"\n              @click="statusFilter = \'imported\'"\n            >\n              已导入\n            </button>\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'unimported\' }"\n              type="button"\n              @click="statusFilter = \'unimported\'"\n            >\n              未导入\n            </button>\n          </div>\n          <div class="cardhub-section-title">标签</div>\n          <div class="cardhub-tag-filter">\n            <button\n              v-for="tag in allTags"\n              :key="tag"\n              class="cardhub-tag-filter__chip"\n              :class="{ \'is-active\': selectedTags.includes(tag) }"\n              type="button"\n              @click="toggleTagFilter(tag)"\n            >\n              {{ tag }}\n            </button>\n          </div>\n          <button\n            v-if="selectedTags.length"\n            class="cardhub-chip cardhub-chip--clear"\n            type="button"\n            @click="clearTagFilter"\n          >\n            清空标签\n          </button>\n        </div>\n\n        <div class="cardhub-content">\n          <div v-if="state.loading" class="cardhub-loading">正在读取角色卡...</div>\n          <div v-else-if="!filteredCharacters.length" class="cardhub-empty">\n            暂无角色卡，或没有匹配的搜索结果。\n          </div>\n          <div v-else class="cardhub-grid">\n            <article\n              v-for="character in filteredCharacters"\n              :key="character.id"\n              class="cardhub-card"\n              @click="openPreview(character)"\n            >\n              <div\n                class="cardhub-card__avatar"\n                :class="{ \'has-avatar\': Boolean(avatarUrl(character)) }"\n                :style="avatarStyle(character)"\n              >\n                <span>{{ character.name.slice(0, 1) || \'?\' }}</span>\n              </div>\n              <div class="cardhub-card__info">\n                <div class="cardhub-card__name">{{ character.name }}</div>\n                <div class="cardhub-card__meta">\n                  <span>{{ character.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n                  <span>{{ displayTags(character).length }} 标签</span>\n                </div>\n                <div class="cardhub-card__tags">\n                  <button\n                    v-for="tag in displayTags(character)"\n                    :key="tag"\n                    class="cardhub-tag"\n                    type="button"\n                    title="点击移除标签"\n                    @click="removeTag(character, tag)"\n                  >\n                    {{ tag }}\n                    <span class="cardhub-tag__remove">×</span>\n                  </button>\n                  <button\n                    v-if="activeTagKey !== tagKey(character)"\n                    class="cardhub-tag is-add"\n                    type="button"\n                    @click="startTagEdit(character)"\n                  >\n                    + 标签\n                  </button>\n                  <input\n                    v-else\n                    v-model="tagInput"\n                    class="cardhub-tag-input"\n                    type="text"\n                    placeholder="新标签"\n                    @keydown.enter.prevent="confirmTag(character)"\n                    @keydown.esc.prevent="cancelTagEdit"\n                    @blur="confirmTag(character)"\n                  />\n                </div>\n              </div>\n              <div class="cardhub-card__actions">\n                <button\n                  class="cardhub-card__action is-secondary"\n                  type="button"\n                  @click.stop="handleCardAction(character)"\n                  @pointerdown.stop\n                  @mousedown.stop\n                  @touchstart.stop\n                >\n                  {{ character.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n                </button>\n                <button\n                  class="cardhub-card__action"\n                  type="button"\n                  @click.stop="openManage(character)"\n                  @pointerdown.stop\n                  @mousedown.stop\n                  @touchstart.stop\n                >\n                  管理\n                </button>\n              </div>\n            </article>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <div v-if="previewCard" class="cardhub-preview" @click.self="closePreview">\n      <div class="cardhub-preview__panel" role="dialog" aria-label="角色卡预览">\n        <button class="cardhub-preview__close" type="button" @click="closePreview">×</button>\n        <div class="cardhub-preview__avatar">\n          <img v-if="previewAvatarUrl" :src="previewAvatarUrl" alt="" />\n        </div>\n        <div class="cardhub-preview__info">\n          <div class="cardhub-preview__name">{{ previewCard.name }}</div>\n          <div class="cardhub-preview__meta">\n            <span>{{ previewCard.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n            <span>{{ displayTags(previewCard).length }} 标签</span>\n          </div>\n          <div class="cardhub-preview__tags">\n            <span v-for="tag in displayTags(previewCard)" :key="tag" class="cardhub-preview__tag">\n              {{ tag }}\n            </span>\n          </div>\n        </div>\n        <div class="cardhub-preview__actions">\n          <button\n            class="cardhub-card__action is-secondary"\n            type="button"\n            @click.stop="handleCardAction(previewCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            {{ previewCard.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n          </button>\n          <button\n            class="cardhub-card__action"\n            type="button"\n            @click.stop="openManage(previewCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            管理\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="manageCard" class="cardhub-manage" @click.self="closeManage">\n      <div class="cardhub-manage__panel" role="dialog" aria-label="角色管理">\n        <button class="cardhub-preview__close" type="button" @click="closeManage">×</button>\n        <div class="cardhub-manage__top">\n          <div class="cardhub-manage__summary">\n            <div class="cardhub-preview__name">{{ manageCard.name }}</div>\n            <div class="cardhub-preview__meta">\n              <span>{{ manageCard.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n              <span>{{ displayTags(manageCard).length }} 标签</span>\n            </div>\n            <div class="cardhub-preview__tags">\n              <span v-for="tag in displayTags(manageCard)" :key="tag" class="cardhub-preview__tag">\n                {{ tag }}\n              </span>\n            </div>\n          </div>\n          <div class="cardhub-manage__media">\n            <img v-if="manageAvatarUrl" :src="manageAvatarUrl" alt="" />\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">开场白</div>\n          <div class="cardhub-manage__content">\n            <template v-if="manageOpeningLines.length">\n              <div v-for="(opening, index) in manageOpeningLines" :key="index" class="cardhub-manage__opening">\n                {{ opening }}\n              </div>\n            </template>\n            <template v-else>暂无开场白</template>\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">\n            <span>最近聊天</span>\n            <button\n              class="cardhub-manage__jump"\n              type="button"\n              @click="openLatestChat"\n              @pointerdown.stop\n              @mousedown.stop\n              @touchstart.stop\n            >\n              进入最近聊天\n            </button>\n          </div>\n          <div v-if="manageChats.length" class="cardhub-manage__chat">\n            <div\n              v-for="(msg, index) in manageChats"\n              :key="index"\n              class="cardhub-manage__chat-row"\n              role="button"\n              tabindex="0"\n              @click="openChat(msg)"\n              @keydown.enter.prevent="openChat(msg)"\n            >\n              <span class="cardhub-manage__chat-name">{{ msg.name }}</span>\n              <span class="cardhub-manage__chat-text">{{ msg.mes }}</span>\n            </div>\n          </div>\n          <div v-else class="cardhub-manage__empty">暂无聊天记录</div>\n        </div>\n        <div class="cardhub-manage__actions">\n          <button\n            class="cardhub-card__action is-secondary"\n            type="button"\n            @click.stop="handleCardAction(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            {{ manageCard.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n          </button>\n          <button\n            class="cardhub-card__action"\n            type="button"\n            @click.stop="manageDelete(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            删除\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, nextTick, ref } from \'vue\';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from \'../state/store\';\nimport { fetchCharacterSummaries } from \'../services/characterSource\';\nimport { regexFromString } from \'./util/common\';\nimport type { CardHubItem } from \'../types\';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from \'../services/libraryService\';\nimport { getMergedTags, updateCharacterTags } from \'../services/tagService\';\n\nconst selectedTags = ref<string[]>([]);\nconst activeTagKey = ref<string | null>(null);\nconst tagInput = ref(\'\');\nconst statusFilter = ref<\'all\' | \'imported\' | \'unimported\'>(\'all\');\nconst importInput = ref<HTMLInputElement | null>(null);\nconst previewCard = ref<CardHubItem | null>(null);\nconst manageCard = ref<CardHubItem | null>(null);\nconst manageOpenings = ref<string[]>([]);\nconst manageChats = ref<Array<{ name: string; mes: string; file: string }>>([]);\nconst manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\n\nconst allCards = computed(() => [...state.characters, ...state.library]);\n\nconst filteredCharacters = computed(() => {\n  const list = applyStatusFilter(allCards.value);\n  const keyword = state.search.trim();\n  if (!keyword) {\n    return applyTagFilter(list);\n  }\n  const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), \'i\');\n  return applyTagFilter(list).filter(character => {\n    return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\n  });\n});\n\nconst allTags = computed(() => {\n  const tagSet = new Set<string>();\n  allCards.value.forEach(character => {\n    getMergedTags(character).forEach(tag => tagSet.add(tag));\n  });\n  selectedTags.value.forEach(tag => tagSet.add(tag));\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, \'zh-CN\'));\n});\n\nfunction avatarUrl(character: CardHubItem, useFull = false): string | null {\n  const avatar = character.avatar;\n  if (!avatar) {\n    return null;\n  }\n  if (/^(data:|https?:|\\/)/.test(avatar)) {\n    return avatar;\n  }\n  if (useFull && character.origin === \'tavern\') {\n    return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n  }\n  return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n}\n\nfunction avatarStyle(character: CardHubItem): Record<string, string> {\n  const url = avatarUrl(character);\n  return url ? { backgroundImage: `url(${url})` } : {};\n}\n\nfunction displayTags(character: CardHubItem): string[] {\n  return getMergedTags(character);\n}\n\nfunction openPreview(card: CardHubItem) {\n  previewCard.value = card;\n}\n\nfunction closePreview() {\n  previewCard.value = null;\n}\n\nconst previewAvatarUrl = computed(() => {\n  if (!previewCard.value) {\n    return null;\n  }\n  return avatarUrl(previewCard.value, true);\n});\n\nconst manageAvatarUrl = computed(() => {\n  if (!manageCard.value) {\n    return null;\n  }\n  return avatarUrl(manageCard.value, true);\n});\n\nfunction applyStatusFilter(list: CardHubItem[]): CardHubItem[] {\n  if (statusFilter.value === \'imported\') {\n    return list.filter(item => item.origin === \'tavern\');\n  }\n  if (statusFilter.value === \'unimported\') {\n    return list.filter(item => item.origin === \'library\');\n  }\n  return list;\n}\n\nfunction applyTagFilter(list: CardHubItem[]): CardHubItem[] {\n  if (!selectedTags.value.length) {\n    return list;\n  }\n  return list.filter(character =>\n    selectedTags.value.some(tag => getMergedTags(character).includes(tag)),\n  );\n}\n\nfunction toggleTagFilter(tag: string) {\n  if (selectedTags.value.includes(tag)) {\n    selectedTags.value = selectedTags.value.filter(item => item !== tag);\n  } else {\n    selectedTags.value = [...selectedTags.value, tag];\n  }\n}\n\nfunction clearTagFilter() {\n  selectedTags.value = [];\n}\n\n\nfunction removeTag(character: CardHubItem, tag: string) {\n  const nextTags = getMergedTags(character).filter(item => item !== tag);\n  applyTagUpdate(character, nextTags);\n}\n\nfunction tagKey(character: CardHubItem): string {\n  return character.avatar ? `avatar:${character.avatar}` : `name:${character.name}`;\n}\n\nfunction startTagEdit(character: CardHubItem) {\n  activeTagKey.value = tagKey(character);\n  tagInput.value = \'\';\n  nextTick(() => {\n    const input = document.querySelector<HTMLInputElement>(\'.cardhub-tag-input\');\n    input?.focus();\n  });\n}\n\nfunction confirmTag(character: CardHubItem) {\n  if (activeTagKey.value !== tagKey(character)) {\n    return;\n  }\n  const input = tagInput.value.trim();\n  if (input) {\n    const nextTags = [...getMergedTags(character), input];\n    applyTagUpdate(character, nextTags);\n  }\n  cancelTagEdit();\n}\n\nfunction cancelTagEdit() {\n  activeTagKey.value = null;\n  tagInput.value = \'\';\n}\n\nfunction applyTagUpdate(character: CardHubItem, nextTags: string[]) {\n  if (character.origin === \'library\') {\n    const updatedLibrary = updateLibraryTags(character.id, nextTags);\n    setLibrary(updatedLibrary);\n  } else {\n    const next = updateCharacterTags(character, nextTags);\n    character.tags = next;\n    setCharacters([...state.characters]);\n  }\n}\n\nfunction triggerImport() {\n  importInput.value?.click();\n}\n\nasync function handleImportFiles(event: Event) {\n  const target = event.target as HTMLInputElement | null;\n  const files = target?.files;\n  if (!files || !files.length) {\n    return;\n  }\n  const updated = await addToLibrary(files);\n  setLibrary(updated);\n  target.value = \'\';\n}\n\nfunction exportSelected() {\n  const list = filteredCharacters.value;\n  const tagLabel = selectedTags.value.length ? selectedTags.value.join(\'、\') : \'无\';\n  const statusLabel =\n    statusFilter.value === \'all\'\n      ? \'全部\'\n      : statusFilter.value === \'imported\'\n        ? \'已导入\'\n        : \'未导入\';\n  const searchLabel = state.search.trim() || \'无\';\n  const message =\n    `将导出 ${list.length} 张角色卡。\\n` +\n    `筛选状态：${statusLabel}\\n` +\n    `筛选标签：${tagLabel}\\n` +\n    `搜索关键字：${searchLabel}\\n` +\n    `是否继续？`;\n\n  if (!window.confirm(message)) {\n    return;\n  }\n  if (!list.length) {\n    toastr.warning(\'当前没有可导出的角色卡\');\n    return;\n  }\n  list.forEach(item => exportCard(item));\n}\n\nasync function handleCardAction(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await importLibraryCard(card);\n  } else {\n    exportCard(card);\n  }\n}\n\nasync function importLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'缺少导入数据\');\n    return;\n  }\n  const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\n  delete (headers as Record<string, string>)[\'Content-Type\'];\n\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    await TavernHelper.importRawCharacter(card.name, blob);\n  } else {\n    const file = new File([card.raw], `${card.name}.json`, { type: \'application/json\' });\n    const form = new FormData();\n    form.append(\'avatar\', file);\n    form.append(\'file_type\', \'json\');\n    form.append(\'preserved_name\', file.name);\n    await fetch(\'/api/characters/import\', {\n      method: \'POST\',\n      headers,\n      body: form,\n      cache: \'no-cache\',\n    });\n  }\n\n  setLibrary(removeFromLibrary(card.id));\n  const characters = await fetchCharacterSummaries();\n  setCharacters(characters);\n  toastr.success(`已导入 ${card.name}`);\n}\n\nasync function exportCard(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await exportLibraryCard(card);\n    return;\n  }\n  if (!card.avatar) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  downloadBlob(blob, `${card.name}.png`);\n}\n\nasync function exportLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'无法导出：缺少原始数据\');\n    return;\n  }\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    downloadBlob(blob, `${card.name}.png`);\n    return;\n  }\n  const blob = new Blob([card.raw], { type: \'application/json\' });\n  downloadBlob(blob, `${card.name}.json`);\n}\n\nasync function openManage(card: CardHubItem) {\n  manageCard.value = card;\n  manageOpenings.value = await resolveOpenings(card);\n  manageChats.value = await resolveRecentChats(card);\n}\n\nfunction closeManage() {\n  manageCard.value = null;\n  manageOpenings.value = [];\n  manageChats.value = [];\n}\n\nasync function resolveOpenings(card: CardHubItem): Promise<string[]> {\n  if (card.origin !== \'tavern\') {\n    return [];\n  }\n  const raw = await getFullCharacterData(card);\n  const openings = extractOpeningMessages(raw);\n  if (openings.length) {\n    return openings;\n  }\n  const fallback =\n    TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true } as any) ??\n    TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true } as any);\n  return extractOpeningMessages(fallback);\n}\n\nasync function getFullCharacterData(card: CardHubItem): Promise<SillyTavern.v1CharData | null> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  if (ctx?.getCharacters) {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色卡列表失败\', error);\n    }\n  }\n  const list = ctx?.characters ?? st?.characters ?? [];\n  if (!list.length) {\n    return null;\n  }\n  const byAvatar = card.avatar\n    ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\n    : -1;\n  const byName = list.findIndex(item => item.name === card.name);\n  const idx = byAvatar >= 0 ? byAvatar : byName;\n  if (idx < 0) {\n    return null;\n  }\n  if (ctx?.unshallowCharacter) {\n    try {\n      await ctx.unshallowCharacter(idx);\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡详情失败\', error);\n    }\n  }\n  const updatedList = ctx?.characters ?? list;\n  const data = updatedList[idx] ?? null;\n  if (data?.first_mes || data?.data?.first_mes) {\n    return data;\n  }\n  if (ctx?.getCharacterCardFields) {\n    try {\n      const fields = await ctx.getCharacterCardFields({ chid: idx });\n      if (fields?.first_mes || fields?.data?.first_mes) {\n        return fields;\n      }\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡字段失败\', error);\n    }\n  }\n  const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n  return fallback ?? data;\n}\n\nfunction extractOpeningMessages(data: any): string[] {\n  if (!data) {\n    return [];\n  }\n  const list: string[] = [];\n  const first = typeof data?.first_mes === \'string\' ? data.first_mes : data?.data?.first_mes;\n  if (typeof first === \'string\' && first.trim()) {\n    list.push(first.trim());\n  }\n  const alt =\n    data?.alternate_greetings ??\n    data?.data?.alternate_greetings ??\n    data?.extensions?.alternate_greetings ??\n    data?.data?.extensions?.alternate_greetings;\n  if (Array.isArray(alt)) {\n    alt.forEach(item => {\n      if (typeof item === \'string\' && item.trim()) {\n        list.push(item.trim());\n      }\n    });\n  } else if (typeof alt === \'string\' && alt.trim()) {\n    list.push(alt.trim());\n  }\n  return list;\n}\n\nfunction normalizeBriefMessage(value: string): string {\n  return value\n    .replace(/<br\\s*\\/?>/gi, \' \')\n    .replace(/<[^>]+>/g, \' \')\n    .replace(/\\s+/g, \' \')\n    .trim();\n}\n\nfunction previewOpenings(openings: string[], maxItems: number): string[] {\n  return openings\n    .map(opening => previewOpeningLines(opening, 2).join(\'\\n\'))\n    .filter(preview => preview.trim().length > 0)\n    .slice(0, maxItems);\n}\n\nfunction previewOpeningLines(text: string, maxLines: number): string[] {\n  const trimmed = text.replace(/\\r/g, \'\').trim();\n  if (!trimmed) {\n    return [];\n  }\n  const contentLines = extractContentLines(trimmed);\n  if (contentLines.length >= maxLines) {\n    return contentLines.slice(0, maxLines);\n  }\n  const normalized = normalizeBriefMessage(trimmed);\n  if (!normalized) {\n    return contentLines.slice(0, maxLines);\n  }\n  const chunks = chunkText(normalized, 60);\n  if (!contentLines.length) {\n    return chunks.slice(0, maxLines);\n  }\n  const combined = [...contentLines];\n  for (const chunk of chunks) {\n    if (combined.length >= maxLines) {\n      break;\n    }\n    if (combined[0] !== chunk) {\n      combined.push(chunk);\n    }\n  }\n  return combined.slice(0, maxLines);\n}\n\nfunction extractContentLines(text: string): string[] {\n  const lines = text\n    .split(\'\\n\')\n    .map(part => part.trim())\n    .filter(part => part.length > 0);\n  const filtered: string[] = [];\n  for (const line of lines) {\n    if (line.startsWith(\'```\')) {\n      continue;\n    }\n    if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n      continue;\n    }\n    filtered.push(line);\n  }\n  return filtered;\n}\n\nfunction chunkText(text: string, size: number): string[] {\n  const chunks: string[] = [];\n  for (let i = 0; i < text.length; i += size) {\n    const chunk = text.slice(i, i + size).trim();\n    if (chunk) {\n      chunks.push(chunk);\n    }\n  }\n  return chunks;\n}\n\nasync function resolveRecentChats(card: CardHubItem): Promise<Array<{ name: string; mes: string; file: string }>> {\n  if (card.origin !== \'tavern\') {\n    return [];\n  }\n  const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\n  if (!Array.isArray(brief) || !brief.length) {\n    return [];\n  }\n  return brief.slice(0, 3).map((entry: any) => ({\n    name: entry?.file_name ?? entry?.file_id ?? \'聊天记录\',\n    file: String(entry?.file_name ?? entry?.file_id ?? \'\'),\n    mes: normalizeBriefMessage(String(entry?.mes ?? \'\')).slice(0, 120),\n  }));\n}\n\nasync function openLatestChat() {\n  if (!manageChats.value.length) {\n    toastr.warning(\'暂无聊天记录\');\n    return;\n  }\n  await openChat(manageChats.value[0]);\n}\n\nasync function openChat(chat: { file: string }) {\n  const file = chat.file;\n  if (!file) {\n    toastr.warning(\'未找到聊天文件\');\n    return;\n  }\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  const target = normalizeChatId(file);\n  const list = ctx?.characters ?? st?.characters ?? [];\n  const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n  const opener =\n    (ctx && typeof ctx.openCharacterChat === \'function\' ? ctx.openCharacterChat : null) ??\n    (st && typeof st.openCharacterChat === \'function\' ? st.openCharacterChat : null);\n  if (!opener) {\n    toastr.error(\'无法打开聊天：缺少接口\');\n    return;\n  }\n  if (idx < 0) {\n    toastr.warning(\'未找到角色索引，请先手动切到该角色后再试\');\n    return;\n  }\n  if (typeof ctx?.getCharacters === \'function\') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色列表失败\', error);\n    }\n  }\n  const selector =\n    (ctx && typeof ctx.selectCharacterById === \'function\' ? ctx.selectCharacterById : null) ??\n    (st && typeof st.selectCharacterById === \'function\' ? st.selectCharacterById : null);\n  if (selector) {\n    try {\n      await selector(idx, { switchMenu: false });\n    } catch (error) {\n      console.warn(\'[CardHub] 切换角色失败\', error);\n    }\n  } else {\n    toastr.warning(\'无法切换角色，请先手动切到该角色后再试\');\n    return;\n  }\n  try {\n    void Promise.resolve(opener(target)).catch(error => {\n      console.warn(\'[CardHub] 打开聊天失败\', error);\n    });\n  } catch (error) {\n    console.warn(\'[CardHub] 打开聊天失败\', error);\n  }\n  const opened = await waitForChatOpen(target, ctx, st, 6000);\n  if (opened) {\n    closeManage();\n    closePreview();\n    close();\n    return;\n  }\n  toastr.warning(\'未能打开聊天，可能需要先手动切到该角色\');\n}\n\nfunction findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\n  if (card.avatar) {\n    const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\n    if (byAvatar >= 0) {\n      return byAvatar;\n    }\n  }\n  return list.findIndex(item => item.name === card.name);\n}\n\nfunction normalizeChatId(id: string): string {\n  return id.endsWith(\'.jsonl\') ? id : `${id}.jsonl`;\n}\n\nasync function waitForChatOpen(\n  file: string,\n  ctx: any,\n  st: typeof SillyTavern | undefined,\n  timeoutMs: number,\n): Promise<boolean> {\n  const target = normalizeChatId(file);\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const current = ctx?.chatId ?? st?.chatId;\n    if (current === target) {\n      return true;\n    }\n    await new Promise(resolve => setTimeout(resolve, 200));\n  }\n  return false;\n}\n\nasync function manageDelete(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\n      return;\n    }\n    setLibrary(removeFromLibrary(card.id));\n    closeManage();\n    return;\n  }\n\n  if (!window.confirm(`确定要删除「${card.name}」吗？`)) {\n    return;\n  }\n  const moveToLibraryChoice = window.confirm(\n    `删除「${card.name}」：\\n点击“确定”=移到私有库\\n点击“取消”=永久删除`,\n  );\n  if (moveToLibraryChoice) {\n    await moveToLibrary(card);\n    const deleted = await deleteFromTavern(card, false);\n    if (!deleted) {\n      return;\n    }\n    closeManage();\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    return;\n  }\n  if (!window.confirm(`确认永久删除「${card.name}」？此操作不可恢复。`)) {\n    return;\n  }\n  const deleted = await deleteFromTavern(card, true);\n  if (!deleted) {\n    return;\n  }\n  closeManage();\n  const characters = await fetchCharacterSummaries();\n  setCharacters(characters);\n}\n\nasync function moveToLibrary(card: CardHubItem) {\n  if (!card.avatar) {\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  const updated = await addToLibrary([\n    new File([blob], `${card.name}.png`, { type: \'image/png\' }),\n  ]);\n  setLibrary(updated);\n}\n\nasync function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\n  if (!card.avatar) {\n    toastr.error(\'删除失败：缺少头像信息\');\n    return false;\n  }\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\n    | Record<string, string>\n    | undefined;\n  if (!headers || !Object.keys(headers).length) {\n    toastr.error(\'删除失败：无法获取请求头\');\n    return false;\n  }\n  const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n  const response = await fetch(\'/api/characters/delete\', {\n    method: \'POST\',\n    headers: { ...headers, \'Content-Type\': \'application/json\' },\n    body: JSON.stringify(payload),\n    cache: \'no-cache\',\n  });\n  if (response.ok) {\n    return true;\n  }\n  const detail = await response.text();\n  toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n  return false;\n}\n\nfunction downloadBlob(blob: Blob, fileName: string) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = fileName;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\n\n\nasync function dataUrlToBlob(dataUrl: string): Promise<Blob> {\n  const response = await fetch(dataUrl);\n  return await response.blob();\n}\n\n\nasync function refresh() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nfunction close() {\n  setOpen(false);\n}\n\n<\/script>\n\n<style scoped>\n.cardhub-root {\n  position: fixed;\n  inset: 0;\n  z-index: 9999;\n  font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n  color: #1b1b1b;\n  display: none;\n}\n\n.cardhub-root.open {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.cardhub-backdrop {\n  position: absolute;\n  inset: 0;\n  background: radial-gradient(circle at top, rgba(255, 248, 236, 0.9), rgba(36, 30, 24, 0.85));\n  backdrop-filter: blur(6px);\n}\n\n.cardhub-panel {\n  position: relative;\n  width: min(980px, 94%);\n  max-height: 92%;\n  background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n  border-radius: 28px;\n  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  z-index: 1;\n}\n\n.cardhub-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 20px 24px;\n  border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n}\n\n.cardhub-title__main {\n  font-size: 26px;\n  letter-spacing: 2px;\n}\n\n.cardhub-title__sub {\n  font-size: 12px;\n  color: #7d5b46;\n  margin-left: 10px;\n}\n\n.cardhub-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.cardhub-close {\n  border: none;\n  background: rgba(43, 32, 24, 0.12);\n  color: #3b2a20;\n  width: 34px;\n  height: 34px;\n  border-radius: 999px;\n  font-size: 20px;\n  line-height: 34px;\n  text-align: center;\n  cursor: pointer;\n}\n\n.cardhub-close:hover {\n  background: rgba(43, 32, 24, 0.2);\n}\n\n.cardhub-toolbar {\n  display: flex;\n  gap: 10px;\n  padding: 16px 24px;\n  flex-wrap: wrap;\n}\n\n.cardhub-search {\n  flex: 1;\n  min-width: 180px;\n  border-radius: 999px;\n  border: 1px solid rgba(86, 59, 44, 0.2);\n  padding: 8px 14px;\n  background: #fffaf4;\n}\n\n.cardhub-button {\n  border: none;\n  padding: 8px 16px;\n  border-radius: 999px;\n  background: #d46b3d;\n  color: #fff;\n  cursor: pointer;\n  font-size: 12px;\n}\n\n.cardhub-button.is-ghost {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-import-input {\n  display: none;\n}\n\n.cardhub-body {\n  display: grid;\n  grid-template-columns: minmax(160px, 220px) 1fr;\n  gap: 0;\n  flex: 1;\n  min-height: 0;\n}\n\n.cardhub-sidebar {\n  padding: 20px;\n  border-right: 1px solid rgba(86, 59, 44, 0.15);\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.cardhub-chip-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-section-title {\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-chip {\n  text-align: left;\n  border: none;\n  background: rgba(255, 255, 255, 0.6);\n  border-radius: 12px;\n  padding: 8px 10px;\n  cursor: pointer;\n  font-size: 12px;\n}\n\n.cardhub-chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-placeholder {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-tag-filter {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-tag-filter__chip {\n  border: 1px solid rgba(106, 63, 42, 0.25);\n  background: rgba(255, 255, 255, 0.7);\n  border-radius: 999px;\n  padding: 6px 10px;\n  font-size: 12px;\n  color: #6a3f2a;\n  cursor: pointer;\n}\n\n.cardhub-tag-filter__chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n  border-color: transparent;\n}\n\n.cardhub-chip--clear {\n  margin-top: 8px;\n}\n\n.cardhub-content {\n  padding: 20px;\n  overflow: auto;\n}\n\n.cardhub-loading,\n.cardhub-empty {\n  padding: 40px 0;\n  text-align: center;\n  color: #7d5b46;\n}\n\n.cardhub-grid {\n  display: grid;\n  gap: 14px;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n}\n\n.cardhub-card {\n  background: rgba(255, 255, 255, 0.78);\n  border-radius: 18px;\n  padding: 14px;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  gap: 12px;\n  align-items: center;\n  border: 1px solid rgba(86, 59, 44, 0.15);\n  cursor: pointer;\n}\n\n.cardhub-card__avatar {\n  width: 42px;\n  height: 42px;\n  border-radius: 12px;\n  background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n  background-size: cover;\n  background-position: center;\n  color: #4a2a1f;\n  display: grid;\n  place-items: center;\n  font-weight: 700;\n}\n\n.cardhub-card__avatar.has-avatar span {\n  display: none;\n}\n\n.cardhub-card__name {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.cardhub-card__meta {\n  display: flex;\n  gap: 8px;\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-card__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-top: 8px;\n  align-items: center;\n}\n\n.cardhub-tag {\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fff6ea;\n  border-radius: 999px;\n  padding: 4px 8px;\n  font-size: 11px;\n  color: #6a3f2a;\n  cursor: pointer;\n}\n\n.cardhub-tag__remove {\n  margin-left: 4px;\n  font-weight: 700;\n}\n\n.cardhub-tag.is-add {\n  background: transparent;\n  border-style: dashed;\n}\n\n.cardhub-tag-input {\n  border: 1px dashed rgba(106, 63, 42, 0.5);\n  background: #fffaf4;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  min-width: 80px;\n  color: #6a3f2a;\n  outline: none;\n  height: 24px;\n  line-height: 16px;\n}\n\n.cardhub-tag-input:focus {\n  border-color: rgba(106, 63, 42, 0.85);\n}\n\n.cardhub-card__action {\n  grid-column: span 2;\n  margin-top: 10px;\n  border: none;\n  background: #2b2018;\n  color: #fff5ea;\n  padding: 6px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.cardhub-card__actions {\n  grid-column: span 2;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  margin-top: 10px;\n}\n\n.cardhub-card__action.is-secondary {\n  background: #d9c6b6;\n  color: #3b2a20;\n}\n\n.cardhub-preview {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100000;\n}\n\n.cardhub-preview__panel {\n  width: min(520px, 92vw);\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 20px;\n  position: relative;\n  display: grid;\n  gap: 14px;\n}\n\n.cardhub-preview__close {\n  position: absolute;\n  top: 14px;\n  right: 14px;\n  border: none;\n  width: 30px;\n  height: 30px;\n  border-radius: 999px;\n  background: rgba(43, 32, 24, 0.15);\n  color: #3b2a20;\n  font-size: 18px;\n  cursor: pointer;\n}\n\n.cardhub-preview__avatar {\n  width: 100%;\n  height: 260px;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-preview__avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n\n.cardhub-preview__info {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-preview__name {\n  font-size: 20px;\n  font-weight: 700;\n}\n\n.cardhub-preview__meta {\n  display: flex;\n  gap: 10px;\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-preview__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-preview__tag {\n  padding: 6px 10px;\n  border-radius: 999px;\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fffaf4;\n  font-size: 12px;\n  color: #6a3f2a;\n}\n\n.cardhub-preview__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n\n.cardhub-manage {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100001;\n}\n\n.cardhub-manage__panel {\n  width: min(760px, 94vw);\n  max-height: 88vh;\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 22px;\n  position: relative;\n  display: grid;\n  gap: 16px;\n  overflow: auto;\n}\n\n.cardhub-manage__top {\n  display: grid;\n  grid-template-columns: 1fr auto;\n  gap: 16px;\n  align-items: start;\n}\n\n.cardhub-manage__media {\n  width: 220px;\n  aspect-ratio: 3 / 4;\n  height: auto;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-manage__media img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.cardhub-manage__summary {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-manage__section {\n  display: grid;\n  gap: 8px;\n}\n\n.cardhub-manage__label {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__jump {\n  border: 1px solid rgba(106, 63, 42, 0.35);\n  background: transparent;\n  color: #6a3f2a;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  cursor: pointer;\n  text-transform: none;\n}\n\n.cardhub-manage__jump:hover {\n  background: rgba(106, 63, 42, 0.1);\n}\n\n.cardhub-manage__content {\n  background: #fffaf4;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 16px;\n  padding: 12px 14px;\n  font-size: 12px;\n  line-height: 1.5;\n  color: #3b2a20;\n  white-space: pre-wrap;\n}\n\n.cardhub-manage__opening {\n  padding: 6px 0;\n  border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n}\n\n.cardhub-manage__opening:last-child {\n  border-bottom: none;\n}\n\n.cardhub-manage__chat {\n  display: grid;\n  gap: 10px;\n}\n\n.cardhub-manage__chat-row {\n  display: grid;\n  grid-template-columns: minmax(140px, 220px) 1fr;\n  gap: 12px;\n  font-size: 12px;\n  color: #3b2a20;\n  align-items: start;\n  padding: 6px 8px;\n  border-radius: 10px;\n  cursor: pointer;\n}\n\n.cardhub-manage__chat-row:hover {\n  background: rgba(106, 63, 42, 0.08);\n}\n\n.cardhub-manage__chat-name {\n  flex: 0 0 auto;\n  font-weight: 600;\n  color: #6a3f2a;\n  word-break: break-word;\n}\n\n.cardhub-manage__chat-text {\n  color: #3b2a20;\n  line-height: 1.5;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.cardhub-manage__empty {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-manage__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n@media (max-width: 720px) {\n\n  .cardhub-body {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-sidebar {\n    flex-direction: column;\n    border-right: none;\n    border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n    gap: 8px;\n  }\n\n  .cardhub-chip-row,\n  .cardhub-tag-filter {\n    flex-wrap: nowrap;\n    overflow-x: auto;\n    padding-bottom: 4px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar,\n  .cardhub-tag-filter::-webkit-scrollbar {\n    height: 6px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar-thumb,\n  .cardhub-tag-filter::-webkit-scrollbar-thumb {\n    background: rgba(106, 63, 42, 0.2);\n    border-radius: 999px;\n  }\n\n  .cardhub-panel {\n    width: min(98vw, 520px);\n    max-height: 96vh;\n  }\n\n  .cardhub-header {\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n    gap: 8px;\n    padding: 12px 14px;\n  }\n\n  .cardhub-toolbar {\n    display: grid;\n    grid-template-columns: 1fr auto auto auto;\n    gap: 8px;\n    padding: 10px 14px 12px;\n  }\n\n  .cardhub-search {\n    width: 100%;\n    grid-column: 1 / -1;\n  }\n\n  .cardhub-button {\n    width: 100%;\n  }\n\n  .cardhub-button.is-ghost {\n    grid-column: span 1;\n  }\n\n  .cardhub-tag-filter__chip,\n  .cardhub-tag {\n    font-size: 10px;\n    padding: 4px 8px;\n  }\n\n  .cardhub-card {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-card__action {\n    grid-column: auto;\n  }\n  .cardhub-manage__panel {\n    width: min(96vw, 560px);\n    max-height: 90vh;\n  }\n\n  .cardhub-manage__top {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-manage__actions {\n    grid-template-columns: 1fr;\n  }\n}\n</style>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n'],sourceRoot:''}]);const c=o},748(n){n.exports=function(n){var a=[];return a.toString=function(){return this.map(function(a){var e='',t=void 0!==a[5];return a[4]&&(e+='@supports ('.concat(a[4],') {')),a[2]&&(e+='@media '.concat(a[2],' {')),t&&(e+='@layer'.concat(a[5].length>0?' '.concat(a[5]):'',' {')),e+=n(a),t&&(e+='}'),a[2]&&(e+='}'),a[4]&&(e+='}'),e}).join('')},a.i=function(n,e,t,r,i){'string'==typeof n&&(n=[[null,n,void 0]]);var o={};if(t)for(var c=0;c<this.length;c++){var d=this[c][0];null!=d&&(o[d]=!0)}for(var s=0;s<n.length;s++){var l=[].concat(n[s]);t&&o[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]='@layer'.concat(l[5].length>0?' '.concat(l[5]):'',' {').concat(l[1],'}')),l[5]=i),e&&(l[2]?(l[1]='@media '.concat(l[2],' {').concat(l[1],'}'),l[2]=e):l[2]=e),r&&(l[4]?(l[1]='@supports ('.concat(l[4],') {').concat(l[1],'}'),l[4]=r):l[4]=''.concat(r)),a.push(l))}},a}},792(n,a,e){var t=e(527);t.__esModule&&(t=t.default),'string'==typeof t&&(t=[[n.id,t,'']]),t.locals&&(n.exports=t.locals);(0,e(424).A)('4ccfd6e8',t,!1,{ssrId:!0})}},a={};function e(t){var r=a[t];if(void 0!==r)return r.exports;var i=a[t]={id:t,exports:{}};return n[t](i,i.exports,e),i.exports}function t(n){const a=[],e=function(n){const a=`cardhub-entry-${getScriptId()}`;if($(`#${a}`).length)return null;const e=function(){const n=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const a of n){const n=$(a).first();if(n.length)return n}const a=$('button, .menu_button, .nav_button').filter((_,n)=>{const a=$(n).text(),e=n.getAttribute('title')??n.getAttribute('aria-label')??'';return/角色管理/.test(a)||/角色管理/.test(e)}).first();if(a.length){const n=a.closest('nav, header, section, div');return n.length?n:a.parent()}return null}();if(!e)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const t=$('<button>').attr('id',a).attr('type','button').addClass('menu_button cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').text('CardHub').on('click pointerup touchend',a=>{a.preventDefault(),a.stopImmediatePropagation(),n.open('role')});e.append(t);const i=r(t[0],()=>n.open('role'));return()=>{t.off('click'),t.remove(),i()}}(n);e&&a.push(e);const t=function(n){const a=`cardhub-magic-${getScriptId()}`,e=$('#extensionsMenuButton');if(!e.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const t=()=>{const e=$('#extensionsMenu');if(!e||e.find(`#${a}`).length)return;const t=$('<div>').attr('id',a).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').text('角色卡管理器').on('click pointerup touchend',a=>{a.preventDefault(),a.stopImmediatePropagation(),n.open('magic')});e.append(t);const i=r(t[0],()=>n.open('magic'));t.data('cardhub-dispose',i)};e.on('click.cardhub',()=>{setTimeout(t,0)});const i=new MutationObserver(()=>t()),o=window.parent?.document??document;return i.observe(o.body,{childList:!0,subtree:!0}),()=>{i.disconnect(),e.off('click.cardhub'),$(`#${a}`).remove()}}(n);return t&&a.push(t),()=>{a.forEach(n=>n())}}function r(n,a){const e=n=>{n.preventDefault(),n.stopImmediatePropagation(),a()};return n.addEventListener('pointerdown',e,{capture:!0}),n.addEventListener('mousedown',e,{capture:!0}),n.addEventListener('touchstart',e,{capture:!0}),()=>{n.removeEventListener('pointerdown',e,{capture:!0}),n.removeEventListener('mousedown',e,{capture:!0}),n.removeEventListener('touchstart',e,{capture:!0})}}e.n=n=>{var a=n&&n.__esModule?()=>n.default:()=>n;return e.d(a,{a}),a},e.d=(n,a)=>{for(var t in a)e.o(a,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:a[t]})},e.o=(n,a)=>Object.prototype.hasOwnProperty.call(n,a),e.r=n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})};const i=Vue;async function o(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const a='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof a?.getCharacters)try{await a.getCharacters()}catch(n){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',n)}const e=a?.characters??SillyTavern?.characters??[],t=new Map;return Array.isArray(a?.tags)&&a.tags.forEach(n=>{n?.id&&n?.name&&t.set(n.id,n.name)}),e.map(n=>{const e=n.tags??n.data?.tags??[],r=n.avatar??'null',i=(a?.tagMap?.[r]??[]).map(n=>t.get(n)).filter(Boolean),o=Array.from(new Set([...e,...i]));return{id:n.avatar??n.name??`char-${Math.random()}`,name:n.name??'未命名角色',avatar:n.avatar??null,tags:o,origin:'tavern'}})}function c(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(n){const a=16*Math.random()|0;return('x'===n?a:3&a|8).toString(16)})}const d='cardhub_library';function s(){return{type:'script',script_id:getScriptId()}}function l(n){const a=TavernHelper.getVariables(s());TavernHelper.replaceVariables(s(),{...a,[d]:{entries:n}})}function p(n){return new Promise((a,e)=>{const t=new FileReader;t.onload=()=>a(String(t.result||'')),t.onerror=()=>e(t.error),t.readAsDataURL(n)})}function u(n){return new Promise((a,e)=>{const t=new FileReader;t.onload=()=>a(String(t.result||'')),t.onerror=()=>e(t.error),t.readAsText(n)})}function g(n){return n.replace(/\.(png|json)$/i,'')}function b(){return function(){const n=TavernHelper.getVariables(s()),a=n?.[d];return a&&'object'==typeof a?{entries:Array.isArray(a.entries)?a.entries:[]}:{entries:[]}}().entries}async function h(n){const a=Array.from(n);if(!a.length)return b();const e=b(),t=[];for(const n of a){const a=g(n.name);if(n.name.toLowerCase().endsWith('.png')){const e=await p(n);t.push({id:c(),name:a,avatar:e,tags:[],origin:'library',rawType:'png',raw:e})}else if(n.name.toLowerCase().endsWith('.json')){const e=await u(n);let r=a;try{const n=JSON.parse(e);r=n.name??n.data?.name??r}catch{}t.push({id:c(),name:r,avatar:null,tags:[],origin:'library',rawType:'json',raw:e})}}const r=[...e,...t];return l(r),r}function C(n){const a=b().filter(a=>a.id!==n);return l(a),a}const A=(0,i.reactive)({open:!1,loading:!1,search:'',lastOpenSource:'manual',characters:[],library:[]});function f(n,a){A.open=n,a&&(A.lastOpenSource=a)}function m(n){A.loading=n}function v(n){A.characters=n}function x(n){A.library=n}function y(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}return n??=SillyTavern,'function'!=typeof n?.getContext?null:n.getContext()}function w(n){Array.isArray(n.tags)||(n.tags=[]),n.tagMap||(n.tagMap={})}function B(n){if('library'===n.origin)return n.tags??[];const a=n.tags??[],e=function(n){const a=y();if(!a||!a.tagMap||!Array.isArray(a.tags))return[];const e=new Map;a.tags.forEach(n=>{n?.id&&n?.name&&e.set(n.id,n.name)});const t=n??'null';return(a.tagMap[t]??[]).map(n=>e.get(n)).filter(Boolean)}(n.avatar);return Array.from(new Set([...a,...e]))}function k(n,a){const e=y();if(!e)return a;const t=function(n,a){if(!Array.isArray(n.characters))return null;const e=a.avatar?n.characters.find(n=>n.avatar===a.avatar):null;return e||(n.characters.find(n=>n.name===a.name)??null)}(e,n);if(!t)return a;const r=Array.from(new Set(a.map(n=>n.trim().replace(/\s+/g,' ')).filter(Boolean)));t.tags=r,t.data&&(t.data.tags=r),w(e);const i=r.map(n=>function(n,a){w(n);const e=n.tags.find(n=>n.name===a);if(e)return e;const t={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:a};return n.tags.push({id:t.id,name:t.name}),t}(e,n).id),o=t.avatar??'null';return e.tagMap[o]=i,e.saveSettingsDebounced?.(),r}const E={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},T={class:'cardhub-toolbar'},F={class:'cardhub-body'},S={class:'cardhub-sidebar'},N={class:'cardhub-chip-row'},M={class:'cardhub-tag-filter'},L=['onClick'],I={class:'cardhub-content'},H={key:0,class:'cardhub-loading'},V={key:1,class:'cardhub-empty'},j={key:2,class:'cardhub-grid'},O=['onClick'],R={class:'cardhub-card__info'},D={class:'cardhub-card__name'},U={class:'cardhub-card__meta'},Y={class:'cardhub-card__tags'},P=['onClick'],q=['onClick'],W=['onKeydown','onBlur'],Q={class:'cardhub-card__actions'},K=['onClick'],Z=['onClick'],X={class:'cardhub-preview__panel',role:'dialog','aria-label':'角色卡预览'},J={class:'cardhub-preview__avatar'},G=['src'],nn={class:'cardhub-preview__info'},an={class:'cardhub-preview__name'},en={class:'cardhub-preview__meta'},tn={class:'cardhub-preview__tags'},rn={class:'cardhub-preview__actions'},on={class:'cardhub-manage__panel',role:'dialog','aria-label':'角色管理'},cn={class:'cardhub-manage__top'},dn={class:'cardhub-manage__summary'},sn={class:'cardhub-preview__name'},ln={class:'cardhub-preview__meta'},pn={class:'cardhub-preview__tags'},un={class:'cardhub-manage__media'},gn=['src'],bn={class:'cardhub-manage__section'},hn={class:'cardhub-manage__content'},Cn={class:'cardhub-manage__section'},An={class:'cardhub-manage__label'},fn={key:0,class:'cardhub-manage__chat'},mn=['onClick','onKeydown'],vn={class:'cardhub-manage__chat-name'},xn={class:'cardhub-manage__chat-text'},yn={key:1,class:'cardhub-manage__empty'},wn={class:'cardhub-manage__actions'},_n=(0,i.defineComponent)({__name:'App',setup(n){const a=(0,i.ref)([]),e=(0,i.ref)(null),t=(0,i.ref)(''),r=(0,i.ref)('all'),c=(0,i.ref)(null),d=(0,i.ref)(null),s=(0,i.ref)(null),p=(0,i.ref)([]),u=(0,i.ref)([]),g=(0,i.computed)(()=>{return n=p.value,a=3,n.map(n=>function(n,a){const e=n.replace(/\r/g,'').trim();if(!e)return[];const t=function(n){const a=n.split('\n').map(n=>n.trim()).filter(n=>n.length>0),e=[];for(const n of a)n.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(n)||e.push(n);return e}(e);if(t.length>=a)return t.slice(0,a);const r=Pn(e);if(!r)return t.slice(0,a);const i=function(n,a){const e=[];for(let t=0;t<n.length;t+=a){const r=n.slice(t,t+a).trim();r&&e.push(r)}return e}(r,60);if(!t.length)return i.slice(0,a);const o=[...t];for(const n of i){if(o.length>=a)break;o[0]!==n&&o.push(n)}return o.slice(0,a)}(n,2).join('\n')).filter(n=>n.trim().length>0).slice(0,a);var n,a}),y=(0,i.computed)(()=>[...A.characters,...A.library]),w=(0,i.computed)(()=>{const n=function(n){if('imported'===r.value)return n.filter(n=>'tavern'===n.origin);if('unimported'===r.value)return n.filter(n=>'library'===n.origin);return n}(y.value),a=A.search.trim();if(!a)return zn(n);const e=function(n){if(!n)return null;try{const a=n.match(/\/(.+)\/([a-z]*)/i);if(!a)return new RegExp(_.escapeRegExp(n),'i');if(a[2]&&!/^(?!.*?(.).*?\1)[gmixXsuUAJ]+$/.test(a[3]))return new RegExp(n,'i');let e=a[2]??'';return _.pull(e,'g'),-1===e.indexOf('i')&&(e+='i'),new RegExp(a[1],e)}catch{return null}}(a)??new RegExp(_.escapeRegExp(a),'i');return zn(n).filter(n=>e.test(n.name)||n.tags.some(n=>e.test(n)))}),_n=(0,i.computed)(()=>{const n=new Set;return y.value.forEach(a=>{B(a).forEach(a=>n.add(a))}),a.value.forEach(a=>n.add(a)),Array.from(n).sort((n,a)=>n.localeCompare(a,'zh-CN'))});function Bn(n,a=!1){const e=n.avatar;return e?/^(data:|https?:|\/)/.test(e)?e:a&&'tavern'===n.origin?TavernHelper.getCharAvatarPath(e,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(e)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(e)}`:null}function kn(n){const a=Bn(n);return a?{backgroundImage:`url(${a})`}:{}}function En(n){return B(n)}function Tn(){d.value=null}const Fn=(0,i.computed)(()=>d.value?Bn(d.value,!0):null),Sn=(0,i.computed)(()=>s.value?Bn(s.value,!0):null);function zn(n){return a.value.length?n.filter(n=>a.value.some(a=>B(n).includes(a))):n}function Nn(){a.value=[]}function Mn(n){return n.avatar?`avatar:${n.avatar}`:`name:${n.name}`}function Ln(n){if(e.value!==Mn(n))return;const a=t.value.trim();if(a){Hn(n,[...B(n),a])}In()}function In(){e.value=null,t.value=''}function Hn(n,a){if('library'===n.origin){x(function(n,a){const e=b().map(e=>e.id!==n?e:{...e,tags:a});return l(e),e}(n.id,a))}else{const e=k(n,a);n.tags=e,v([...A.characters])}}function Vn(){c.value?.click()}async function jn(n){const a=n.target,e=a?.files;if(!e||!e.length)return;x(await h(e)),a.value=''}function On(){const n=w.value,e=a.value.length?a.value.join('、'):'无',t='all'===r.value?'全部':'imported'===r.value?'已导入':'未导入',i=A.search.trim()||'无',o=`将导出 ${n.length} 张角色卡。\n筛选状态：${t}\n筛选标签：${e}\n搜索关键字：${i}\n是否继续？`;window.confirm(o)&&(n.length?n.forEach(n=>Rn(n)):toastr.warning('当前没有可导出的角色卡'))}async function $n(n){'library'===n.origin?await async function(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const a=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};if(delete a['Content-Type'],'png'===n.rawType){const a=await Jn(n.raw);await TavernHelper.importRawCharacter(n.name,a)}else{const e=new File([n.raw],`${n.name}.json`,{type:'application/json'}),t=new FormData;t.append('avatar',e),t.append('file_type','json'),t.append('preserved_name',e.name),await fetch('/api/characters/import',{method:'POST',headers:a,body:t,cache:'no-cache'})}x(C(n.id));v(await o()),toastr.success(`已导入 ${n.name}`)}(n):Rn(n)}async function Rn(n){if('library'===n.origin)return void await async function(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){return void Xn(await Jn(n.raw),`${n.name}.png`)}const a=new Blob([n.raw],{type:'application/json'});Xn(a,`${n.name}.json`)}(n);if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const e=await fetch(a,{cache:'no-cache'});Xn(await e.blob(),`${n.name}.png`)}async function Dn(n){s.value=n,p.value=await async function(n){if('tavern'!==n.origin)return[];const a=await async function(n){let a;try{a=window.parent?.SillyTavern}catch{a=void 0}a??=SillyTavern;const e='function'==typeof a?.getContext?a.getContext():null;if(e?.getCharacters)try{await e.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色卡列表失败',n)}const t=e?.characters??a?.characters??[];if(!t.length)return null;const r=n.avatar?t.findIndex(a=>a.avatar===n.avatar||a.name===n.avatar):-1,i=t.findIndex(a=>a.name===n.name),o=r>=0?r:i;if(o<0)return null;if(e?.unshallowCharacter)try{await e.unshallowCharacter(o)}catch(n){console.warn('[CardHub] 读取角色卡详情失败',n)}const c=(e?.characters??t)[o]??null;if(c?.first_mes||c?.data?.first_mes)return c;if(e?.getCharacterCardFields)try{const n=await e.getCharacterCardFields({chid:o});if(n?.first_mes||n?.data?.first_mes)return n}catch(n){console.warn('[CardHub] 读取角色卡字段失败',n)}const d=TavernHelper.getCharData(n.avatar??n.name,!0);return d??c}(n),e=Yn(a);if(e.length)return e;const t=TavernHelper.RawCharacter?.find({name:n.avatar??n.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:n.name,allowAvatar:!0});return Yn(t)}(n),u.value=await async function(n){if('tavern'!==n.origin)return[];const a=await TavernHelper.getChatHistoryBrief(n.avatar??n.name,!0);if(!Array.isArray(a)||!a.length)return[];return a.slice(0,3).map(n=>({name:n?.file_name??n?.file_id??'聊天记录',file:String(n?.file_name??n?.file_id??''),mes:Pn(String(n?.mes??'')).slice(0,120)}))}(n)}function Un(){s.value=null,p.value=[],u.value=[]}function Yn(n){if(!n)return[];const a=[],e='string'==typeof n?.first_mes?n.first_mes:n?.data?.first_mes;'string'==typeof e&&e.trim()&&a.push(e.trim());const t=n?.alternate_greetings??n?.data?.alternate_greetings??n?.extensions?.alternate_greetings??n?.data?.extensions?.alternate_greetings;return Array.isArray(t)?t.forEach(n=>{'string'==typeof n&&n.trim()&&a.push(n.trim())}):'string'==typeof t&&t.trim()&&a.push(t.trim()),a}function Pn(n){return n.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}async function qn(){u.value.length?await Wn(u.value[0]):toastr.warning('暂无聊天记录')}async function Wn(n){const a=n.file;if(!a)return void toastr.warning('未找到聊天文件');let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const t='function'==typeof e?.getContext?e.getContext():null,r=Qn(a),i=t?.characters??e?.characters??[],o=s.value&&Array.isArray(i)?function(n,a){if(a.avatar){const e=n.findIndex(n=>n.avatar===a.avatar||n.name===a.avatar);if(e>=0)return e}return n.findIndex(n=>n.name===a.name)}(i,s.value):-1,c=(t&&'function'==typeof t.openCharacterChat?t.openCharacterChat:null)??(e&&'function'==typeof e.openCharacterChat?e.openCharacterChat:null);if(!c)return void toastr.error('无法打开聊天：缺少接口');if(o<0)return void toastr.warning('未找到角色索引，请先手动切到该角色后再试');if('function'==typeof t?.getCharacters)try{await t.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色列表失败',n)}const d=(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null)??(e&&'function'==typeof e.selectCharacterById?e.selectCharacterById:null);if(!d)return void toastr.warning('无法切换角色，请先手动切到该角色后再试');try{await d(o,{switchMenu:!1})}catch(n){console.warn('[CardHub] 切换角色失败',n)}try{Promise.resolve(c(r)).catch(n=>{console.warn('[CardHub] 打开聊天失败',n)})}catch(n){console.warn('[CardHub] 打开聊天失败',n)}const l=await async function(n,a,e,t){const r=Qn(n),i=Date.now();for(;Date.now()-i<t;){if((a?.chatId??e?.chatId)===r)return!0;await new Promise(n=>setTimeout(n,200))}return!1}(r,t,e,6e3);if(l)return Un(),Tn(),void na();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}function Qn(n){return n.endsWith('.jsonl')?n:`${n}.jsonl`}async function Kn(n){if('library'===n.origin){if(!window.confirm(`确认永久删除「${n.name}」？此操作不可恢复。`))return;return x(C(n.id)),void Un()}if(!window.confirm(`确定要删除「${n.name}」吗？`))return;if(window.confirm(`删除「${n.name}」：\n点击“确定”=移到私有库\n点击“取消”=永久删除`)){await async function(n){if(!n.avatar)return;const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const e=await fetch(a,{cache:'no-cache'}),t=await e.blob(),r=await h([new File([t],`${n.name}.png`,{type:'image/png'})]);x(r)}(n);if(!await Zn(n,!1))return;Un();return void v(await o())}if(!window.confirm(`确认永久删除「${n.name}」？此操作不可恢复。`))return;if(!await Zn(n,!0))return;Un();v(await o())}async function Zn(n,a){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const t='function'==typeof e?.getContext?e.getContext():null,r=t?.getRequestHeaders?t.getRequestHeaders():e?.getRequestHeaders?.();if(!r||!Object.keys(r).length)return toastr.error('删除失败：无法获取请求头'),!1;const i={avatar_url:n.avatar,delete_chats:a},o=await fetch('/api/characters/delete',{method:'POST',headers:{...r,'Content-Type':'application/json'},body:JSON.stringify(i),cache:'no-cache'});if(o.ok)return!0;const c=await o.text();return toastr.error(`删除失败：${o.status} ${c||o.statusText}`),!1}function Xn(n,a){const e=URL.createObjectURL(n),t=document.createElement('a');t.href=e,t.download=a,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(e)}async function Jn(n){const a=await fetch(n);return await a.blob()}async function Gn(){m(!0);try{v(await o()),x(b())}finally{m(!1)}}function na(){f(!1)}return(n,o)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{class:(0,i.normalizeClass)(['cardhub-root',{open:(0,i.unref)(A).open}])},[(0,i.createElementVNode)('div',{class:'cardhub-backdrop',onClick:na}),(0,i.createElementVNode)('section',E,[(0,i.createElementVNode)('header',{class:'cardhub-header'},[o[31]||(o[31]=(0,i.createElementVNode)('div',{class:'cardhub-title'},[(0,i.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,i.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,i.createElementVNode)('div',{class:'cardhub-actions'},[(0,i.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:na},[...o[30]||(o[30]=[(0,i.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,i.createElementVNode)('div',T,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':o[0]||(o[0]=n=>(0,i.unref)(A).search=n),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[i.vModelText,(0,i.unref)(A).search]]),(0,i.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:Gn},'刷新'),(0,i.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:Vn},'导入'),(0,i.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:On},'批量导出'),(0,i.createElementVNode)('input',{ref_key:'importInput',ref:c,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:jn},null,544)]),(0,i.createElementVNode)('div',F,[(0,i.createElementVNode)('div',S,[o[32]||(o[32]=(0,i.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,i.createElementVNode)('div',N,[(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'all'===r.value}]),type:'button',onClick:o[1]||(o[1]=n=>r.value='all')},' 全部 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'imported'===r.value}]),type:'button',onClick:o[2]||(o[2]=n=>r.value='imported')},' 已导入 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===r.value}]),type:'button',onClick:o[3]||(o[3]=n=>r.value='unimported')},' 未导入 ',2)]),o[33]||(o[33]=(0,i.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,i.createElementVNode)('div',M,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(_n.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:n,class:(0,i.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':a.value.includes(n)}]),type:'button',onClick:e=>function(n){a.value.includes(n)?a.value=a.value.filter(a=>a!==n):a.value=[...a.value,n]}(n)},(0,i.toDisplayString)(n),11,L))),128))]),a.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:Nn},' 清空标签 ')):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',I,[(0,i.unref)(A).loading?((0,i.openBlock)(),(0,i.createElementBlock)('div',H,'正在读取角色卡...')):w.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',j,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(w.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('article',{key:n.id,class:'cardhub-card',onClick:a=>{return e=n,void(d.value=e);var e}},[(0,i.createElementVNode)('div',{class:(0,i.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(Bn(n))}]),style:(0,i.normalizeStyle)(kn(n))},[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(n.name.slice(0,1)||'?'),1)],6),(0,i.createElementVNode)('div',R,[(0,i.createElementVNode)('div',D,(0,i.toDisplayString)(n.name),1),(0,i.createElementVNode)('div',U,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===n.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(En(n).length)+' 标签',1)]),(0,i.createElementVNode)('div',Y,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(En(n),a=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:a,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:e=>function(n,a){Hn(n,B(n).filter(n=>n!==a))}(n,a)},[(0,i.createTextVNode)((0,i.toDisplayString)(a)+' ',1),o[34]||(o[34]=(0,i.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,P))),128)),e.value!==Mn(n)?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:a=>function(n){e.value=Mn(n),t.value='',(0,i.nextTick)(()=>{const n=document.querySelector('.cardhub-tag-input');n?.focus()})}(n)},' + 标签 ',8,q)):(0,i.withDirectives)(((0,i.openBlock)(),(0,i.createElementBlock)('input',{key:1,'onUpdate:modelValue':o[4]||(o[4]=n=>t.value=n),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,i.withKeys)((0,i.withModifiers)(a=>Ln(n),['prevent']),['enter']),(0,i.withKeys)((0,i.withModifiers)(In,['prevent']),['esc'])],onBlur:a=>Ln(n)},null,40,W)),[[i.vModelText,t.value]])])]),(0,i.createElementVNode)('div',Q,[(0,i.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,i.withModifiers)(a=>$n(n),['stop']),onPointerdown:o[5]||(o[5]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[6]||(o[6]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[7]||(o[7]=(0,i.withModifiers)(()=>{},['stop']))},(0,i.toDisplayString)('tavern'===n.origin?'导出':'导入'),41,K),(0,i.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,i.withModifiers)(a=>Dn(n),['stop']),onPointerdown:o[8]||(o[8]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[9]||(o[9]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[10]||(o[10]=(0,i.withModifiers)(()=>{},['stop']))},' 管理 ',40,Z)])],8,O))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',V,' 暂无角色卡，或没有匹配的搜索结果。 '))])])]),d.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,class:'cardhub-preview',onClick:(0,i.withModifiers)(Tn,['self'])},[(0,i.createElementVNode)('div',X,[(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Tn},'×'),(0,i.createElementVNode)('div',J,[Fn.value?((0,i.openBlock)(),(0,i.createElementBlock)('img',{key:0,src:Fn.value,alt:''},null,8,G)):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('div',nn,[(0,i.createElementVNode)('div',an,(0,i.toDisplayString)(d.value.name),1),(0,i.createElementVNode)('div',en,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===d.value.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(En(d.value).length)+' 标签',1)]),(0,i.createElementVNode)('div',tn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(En(d.value),n=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,class:'cardhub-preview__tag'},(0,i.toDisplayString)(n),1))),128))])]),(0,i.createElementVNode)('div',rn,[(0,i.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:o[11]||(o[11]=(0,i.withModifiers)(n=>$n(d.value),['stop'])),onPointerdown:o[12]||(o[12]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[13]||(o[13]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[14]||(o[14]=(0,i.withModifiers)(()=>{},['stop']))},(0,i.toDisplayString)('tavern'===d.value.origin?'导出':'导入'),33),(0,i.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:o[15]||(o[15]=(0,i.withModifiers)(n=>Dn(d.value),['stop'])),onPointerdown:o[16]||(o[16]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[17]||(o[17]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[18]||(o[18]=(0,i.withModifiers)(()=>{},['stop']))},' 管理 ',32)])])])):(0,i.createCommentVNode)('v-if',!0),s.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,class:'cardhub-manage',onClick:(0,i.withModifiers)(Un,['self'])},[(0,i.createElementVNode)('div',on,[(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Un},'×'),(0,i.createElementVNode)('div',cn,[(0,i.createElementVNode)('div',dn,[(0,i.createElementVNode)('div',sn,(0,i.toDisplayString)(s.value.name),1),(0,i.createElementVNode)('div',ln,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===s.value.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(En(s.value).length)+' 标签',1)]),(0,i.createElementVNode)('div',pn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(En(s.value),n=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,class:'cardhub-preview__tag'},(0,i.toDisplayString)(n),1))),128))])]),(0,i.createElementVNode)('div',un,[Sn.value?((0,i.openBlock)(),(0,i.createElementBlock)('img',{key:0,src:Sn.value,alt:''},null,8,gn)):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createElementVNode)('div',bn,[o[35]||(o[35]=(0,i.createElementVNode)('div',{class:'cardhub-manage__label'},'开场白',-1)),(0,i.createElementVNode)('div',hn,[g.value.length?((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,{key:0},(0,i.renderList)(g.value,(n,a)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:a,class:'cardhub-manage__opening'},(0,i.toDisplayString)(n),1))),128)):((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,{key:1},[(0,i.createTextVNode)('暂无开场白')],64))])]),(0,i.createElementVNode)('div',Cn,[(0,i.createElementVNode)('div',An,[o[36]||(o[36]=(0,i.createElementVNode)('span',null,'最近聊天',-1)),(0,i.createElementVNode)('button',{class:'cardhub-manage__jump',type:'button',onClick:qn,onPointerdown:o[19]||(o[19]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[20]||(o[20]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[21]||(o[21]=(0,i.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32)]),u.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',fn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(u.value,(n,a)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:a,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:a=>Wn(n),onKeydown:(0,i.withKeys)((0,i.withModifiers)(a=>Wn(n),['prevent']),['enter'])},[(0,i.createElementVNode)('span',vn,(0,i.toDisplayString)(n.name),1),(0,i.createElementVNode)('span',xn,(0,i.toDisplayString)(n.mes),1)],40,mn))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',yn,'暂无聊天记录'))]),(0,i.createElementVNode)('div',wn,[(0,i.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:o[22]||(o[22]=(0,i.withModifiers)(n=>$n(s.value),['stop'])),onPointerdown:o[23]||(o[23]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[24]||(o[24]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[25]||(o[25]=(0,i.withModifiers)(()=>{},['stop']))},(0,i.toDisplayString)('tavern'===s.value.origin?'导出':'导入'),33),(0,i.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:o[26]||(o[26]=(0,i.withModifiers)(n=>Kn(s.value),['stop'])),onPointerdown:o[27]||(o[27]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:o[28]||(o[28]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:o[29]||(o[29]=(0,i.withModifiers)(()=>{},['stop']))},' 删除 ',32)])])])):(0,i.createCommentVNode)('v-if',!0)],2))}});e(792);const Bn=(0,e(502).A)(_n,[['__scopeId','data-v-937272d2']]);let kn=null,En=null,Tn=null;function Fn(){En||(Tn=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: #1b1b1b;\n        display: none;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: radial-gradient(circle at top, rgba(255, 248, 236, 0.9), rgba(36, 30, 24, 0.85));\n        backdrop-filter: blur(6px);\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n        border-radius: 28px;\n        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: #7d5b46;\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(43, 32, 24, 0.12);\n        color: #3b2a20;\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 10px;\n        padding: 16px 24px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(86, 59, 44, 0.2);\n        padding: 8px 14px;\n        background: #fffaf4;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 8px 16px;\n        border-radius: 999px;\n        background: #d46b3d;\n        color: #fff;\n        cursor: pointer;\n        font-size: 12px;\n      }\n\n      .cardhub-button.is-ghost {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(86, 59, 44, 0.15);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n      }\n\n      .cardhub-chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(106, 63, 42, 0.25);\n        background: rgba(255, 255, 255, 0.7);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: #6a3f2a;\n        cursor: pointer;\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n        border-color: transparent;\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: #7d5b46;\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n      }\n\n      .cardhub-card {\n        background: rgba(255, 255, 255, 0.78);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(86, 59, 44, 0.15);\n        cursor: pointer;\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n        background-size: cover;\n        background-position: center;\n        color: #4a2a1f;\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fff6ea;\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: #6a3f2a;\n        cursor: pointer;\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(106, 63, 42, 0.5);\n        background: #fffaf4;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: #6a3f2a;\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(106, 63, 42, 0.85);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: #2b2018;\n        color: #fff5ea;\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(43, 32, 24, 0.15);\n        color: #3b2a20;\n        font-size: 18px;\n        cursor: pointer;\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fffaf4;\n        font-size: 12px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__jump {\n        border: 1px solid rgba(106, 63, 42, 0.35);\n        background: transparent;\n        color: #6a3f2a;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        text-transform: none;\n      }\n\n      .cardhub-manage__jump:hover {\n        background: rgba(106, 63, 42, 0.1);\n      }\n\n      .cardhub-manage__content {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: #3b2a20;\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(106, 63, 42, 0.08);\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: #6a3f2a;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: #3b2a20;\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n      @media (max-width: 720px) {\n\n        .cardhub-body {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-sidebar {\n          flex-direction: column;\n          border-right: none;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n          gap: 8px;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          padding-bottom: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 6px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.2);\n          border-radius: 999px;\n        }\n\n        .cardhub-panel {\n          width: min(98vw, 520px);\n          max-height: 96vh;\n        }\n\n        .cardhub-header {\n          flex-direction: row;\n          align-items: center;\n          justify-content: space-between;\n          gap: 8px;\n          padding: 12px 14px;\n        }\n\n        .cardhub-toolbar {\n          display: grid;\n          grid-template-columns: 1fr auto auto auto;\n          gap: 8px;\n          padding: 10px 14px 12px;\n        }\n\n        .cardhub-search {\n          width: 100%;\n          grid-column: 1 / -1;\n        }\n\n        .cardhub-button {\n          width: 100%;\n        }\n\n        .cardhub-button.is-ghost {\n          grid-column: span 1;\n        }\n\n        .cardhub-tag-filter__chip,\n        .cardhub-tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-card {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-card__action {\n          grid-column: auto;\n        }\n      .cardhub-manage__panel {\n        width: min(96vw, 560px);\n        max-height: 90vh;\n      }\n\n      .cardhub-manage__top {\n        grid-template-columns: 1fr;\n      }\n\n      .cardhub-manage__actions {\n        grid-template-columns: 1fr;\n      }\n      }\n    ').appendTo('head'),En=$('<div>').attr('script_id',getScriptId()).addClass('cardhub-mount').appendTo('body'),kn=(0,i.createApp)(Bn),kn.mount(En[0]),(0,i.watch)(()=>A.open,()=>{},{immediate:!0}))}function Sn(){return{open:(n='manual')=>{Fn(),f(!0,n)},close:()=>{f(!1)},toggle:(n='manual')=>{Fn(),f(!A.open,n)},refresh:async()=>{Fn(),await async function(){m(!0);try{v(await o()),x(b())}finally{m(!1)}}()},destroy:()=>{kn&&kn.unmount(),En&&En.remove(),Tn&&Tn.remove(),kn=null,En=null,Tn=null}}}function zn(){const n=Sn(),a=t(n);n.refresh(),$(window).on('pagehide',()=>{a(),n.destroy()})}$(()=>{errorCatched(zn)()});
//# sourceMappingURL=index.js.map