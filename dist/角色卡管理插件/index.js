import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';var n={424(n,e,a){function t(n,e){for(var a=[],t={},r=0;r<e.length;r++){var o=e[r],i=o[0],c={id:n+':'+r,css:o[1],media:o[2],sourceMap:o[3]};t[i]?t[i].parts.push(c):a.push(t[i]={id:i,parts:[c]})}return a}a.d(e,{A:()=>g});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var o={},i=r&&(document.head||document.getElementsByTagName('head')[0]),c=null,d=0,s=!1,l=function(){},u=null,p='data-vue-ssr-id',b='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(n,e,a,r){s=a,u=r||{};var i=t(n,e);return h(i),function(e){for(var a=[],r=0;r<i.length;r++){var c=i[r];(d=o[c.id]).refs--,a.push(d)}e?h(i=t(n,e)):i=[];for(r=0;r<a.length;r++){var d;if(0===(d=a[r]).refs){for(var s=0;s<d.parts.length;s++)d.parts[s]();delete o[d.id]}}}}function h(n){for(var e=0;e<n.length;e++){var a=n[e],t=o[a.id];if(t){t.refs++;for(var r=0;r<t.parts.length;r++)t.parts[r](a.parts[r]);for(;r<a.parts.length;r++)t.parts.push(f(a.parts[r]));t.parts.length>a.parts.length&&(t.parts.length=a.parts.length)}else{var i=[];for(r=0;r<a.parts.length;r++)i.push(f(a.parts[r]));o[a.id]={id:a.id,refs:1,parts:i}}}}function m(){var n=document.createElement('style');return n.type='text/css',i.appendChild(n),n}function f(n){var e,a,t=document.querySelector('style['+p+'~="'+n.id+'"]');if(t){if(s)return l;t.parentNode.removeChild(t)}if(b){var r=d++;t=c||(c=m()),e=x.bind(null,t,r,!1),a=x.bind(null,t,r,!0)}else t=m(),e=v.bind(null,t),a=function(){t.parentNode.removeChild(t)};return e(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;e(n=t)}else a()}}var A,C=(A=[],function(n,e){return A[n]=e,A.filter(Boolean).join('\n')});function x(n,e,a,t){var r=a?'':t.css;if(n.styleSheet)n.styleSheet.cssText=C(e,r);else{var o=document.createTextNode(r),i=n.childNodes;i[e]&&n.removeChild(i[e]),i.length?n.insertBefore(o,i[e]):n.appendChild(o)}}function v(n,e){var a=e.css,t=e.media,r=e.sourceMap;if(t&&n.setAttribute('media',t),u.ssrId&&n.setAttribute(p,e.id),r&&(a+='\n/*# sourceURL='+r.sources[0]+' */',a+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),n.styleSheet)n.styleSheet.cssText=a;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(a))}}},455(n,e){e.A=(n,e)=>{const a=n.__vccOpts||n;for(const[n,t]of e)a[n]=t;return a}},492(n){n.exports=function(n){var e=n[1],a=n[3];if(!a)return e;if('function'==typeof btoa){var t=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(t),o='/*# '.concat(r,' */');return[e].concat([o]).join('\n')}return[e].join('\n')}},509(n,e,a){a.r(e),a.d(e,{default:()=>c});var t=a(492),r=a.n(t),o=a(748),i=a.n(o)()(r());i.push([n.id,'.cardhub-root[data-v-36d13e32]{position:fixed;inset:0;z-index:9999;font-family:\'ZCOOL XiaoWei\',\'STSong\',\'Songti SC\',\'SimSun\',serif;color:#1b1b1b;display:none;align-items:center;justify-content:center}.cardhub-root.open[data-v-36d13e32]{display:flex;align-items:center;justify-content:center}.cardhub-backdrop[data-v-36d13e32]{position:absolute;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(6px);opacity:0;transition:opacity 180ms ease}.cardhub-root.open .cardhub-backdrop[data-v-36d13e32]{opacity:1}.cardhub-panel[data-v-36d13e32]{position:relative;width:min(980px,94%);max-height:92%;background:linear-gradient(160deg,#fff9f0,#f3e4d4);border-radius:28px;box-shadow:0 30px 90px rgba(0,0,0,0.28);display:flex;flex-direction:column;overflow:hidden;z-index:1;opacity:0;transform:translateY(8px) scale(0.985);transition:opacity 180ms ease,transform 180ms ease}.cardhub-root.open .cardhub-panel[data-v-36d13e32]{opacity:1;transform:translateY(0) scale(1)}.cardhub-header[data-v-36d13e32]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid rgba(86,59,44,0.15)}.cardhub-title__main[data-v-36d13e32]{font-size:26px;letter-spacing:2px}.cardhub-title__sub[data-v-36d13e32]{font-size:12px;color:#7d5b46;margin-left:10px}.cardhub-actions[data-v-36d13e32]{display:flex;gap:10px}.cardhub-close[data-v-36d13e32]{border:none;background:rgba(43,32,24,0.12);color:#3b2a20;width:34px;height:34px;border-radius:999px;font-size:20px;line-height:34px;text-align:center;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-close[data-v-36d13e32]:hover{background:rgba(43,32,24,0.2)}.cardhub-close[data-v-36d13e32]:active{transform:scale(0.96)}.cardhub-toolbar[data-v-36d13e32]{display:flex;gap:8px;padding:12px 20px;flex-wrap:wrap}.cardhub-search[data-v-36d13e32]{flex:1;min-width:180px;border-radius:999px;border:1px solid rgba(86,59,44,0.2);padding:6px 12px;background:#fffaf4}.cardhub-button[data-v-36d13e32]{border:none;padding:6px 14px;border-radius:999px;background:#d46b3d;color:#fff;cursor:pointer;font-size:12px;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-button[data-v-36d13e32]:hover{background:#c55f36;box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-button[data-v-36d13e32]:active{transform:translateY(1px)}.cardhub-button.is-ghost[data-v-36d13e32]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-button.is-ghost[data-v-36d13e32]:hover{background:rgba(106,63,42,0.08);border-color:rgba(106,63,42,0.6);box-shadow:none}.cardhub-import-input[data-v-36d13e32]{display:none}.cardhub-body[data-v-36d13e32]{display:grid;grid-template-columns:minmax(160px,220px) 1fr;gap:0;flex:1;min-height:0}.cardhub-sidebar[data-v-36d13e32]{padding:20px;border-right:1px solid rgba(86,59,44,0.15);display:flex;flex-direction:column;gap:12px;overflow:auto;min-height:0}.cardhub-chip-row[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-divider[data-v-36d13e32]{height:1px;width:100%;background:rgba(86,59,44,0.15);margin:8px 0}.cardhub-section-title[data-v-36d13e32]{font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-chip[data-v-36d13e32]{text-align:left;border:none;background:rgba(255,255,255,0.6);border-radius:12px;padding:8px 10px;cursor:pointer;font-size:12px;transition:background-color 160ms ease,color 160ms ease,transform 120ms ease}.cardhub-chip.is-active[data-v-36d13e32]{background:#2b2018;color:#fff5ea}.cardhub-chip[data-v-36d13e32]:not(.is-active):hover{background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-placeholder[data-v-36d13e32]{font-size:12px;color:#9a7a63}.cardhub-tag-filter[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-tag-filter__chip[data-v-36d13e32]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.7);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag-filter__chip.is-active[data-v-36d13e32]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-tag-filter__chip[data-v-36d13e32]:not(.is-active):hover{border-color:rgba(106,63,42,0.45);background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-chip--clear[data-v-36d13e32]{margin-top:8px}.cardhub-chip--more[data-v-36d13e32]{margin-top:4px}.cardhub-content[data-v-36d13e32]{padding:20px;overflow:auto;flex:1;min-height:0}.cardhub-grid-wrap[data-v-36d13e32]{display:grid;gap:12px}.cardhub-pagination[data-v-36d13e32]{display:flex;align-items:center;justify-content:flex-end;gap:10px;flex-wrap:wrap}.cardhub-pagination__status[data-v-36d13e32]{font-size:12px;color:#7d5b46}.cardhub-pagination__actions[data-v-36d13e32]{display:flex;gap:8px;align-items:center;margin-right:auto}.cardhub-pagination__button[data-v-36d13e32]{border:1px solid rgba(106,63,42,0.35);background:rgba(255,255,255,0.85);color:#6a3f2a;border-radius:999px;padding:4px 10px;font-size:11px;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-pagination__button[data-v-36d13e32]:disabled{opacity:0.4;cursor:default}.cardhub-pagination__button[data-v-36d13e32]:not(:disabled):hover{background:rgba(255,255,255,1);border-color:rgba(106,63,42,0.6);transform:translateY(-1px)}.cardhub-pagination__button[data-v-36d13e32]:not(:disabled):active{transform:translateY(0)}.cardhub-loading[data-v-36d13e32],.cardhub-empty[data-v-36d13e32]{padding:40px 0;text-align:center;color:#7d5b46}.cardhub-grid[data-v-36d13e32]{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));justify-items:center}.cardhub-card[data-v-36d13e32]{background:rgba(255,255,255,0.78);border-radius:18px;padding:14px;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;border:1px solid rgba(86,59,44,0.15);cursor:pointer;transition:transform 140ms ease,box-shadow 180ms ease,border-color 180ms ease;width:100%;max-width:260px}.cardhub-card[data-v-36d13e32]:hover{transform:translateY(-2px);border-color:rgba(86,59,44,0.25);box-shadow:0 12px 26px rgba(43,32,24,0.16)}.cardhub-card[data-v-36d13e32]:active{transform:translateY(0)}.cardhub-card__avatar[data-v-36d13e32]{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#f4d7c4,#d36a3b);background-size:cover;background-position:center;color:#4a2a1f;display:grid;place-items:center;font-weight:700}.cardhub-card__avatar.has-avatar span[data-v-36d13e32]{display:none}.cardhub-card__info[data-v-36d13e32]{min-width:0}.cardhub-card__head[data-v-36d13e32]{display:flex;align-items:center;gap:8px}.cardhub-card__name[data-v-36d13e32]{font-size:14px;font-weight:600;min-width:0;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cardhub-card__meta[data-v-36d13e32]{display:flex;gap:8px;font-size:11px;color:#7d5b46}.cardhub-card__tags[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}.cardhub-tag[data-v-36d13e32]{border:1px solid rgba(106,63,42,0.3);background:#fff6ea;border-radius:999px;padding:4px 8px;font-size:11px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag[data-v-36d13e32]:hover{background:#fffaf4;border-color:rgba(106,63,42,0.5);transform:translateY(-1px)}.cardhub-tag__remove[data-v-36d13e32]{margin-left:4px;font-weight:700}.cardhub-tag.is-add[data-v-36d13e32]{background:transparent;border-style:dashed}.cardhub-tag-edit[data-v-36d13e32]{min-width:0;max-width:100%}.cardhub-tag-input[data-v-36d13e32]{border:1px dashed rgba(106,63,42,0.5);background:#fffaf4;border-radius:999px;padding:4px 10px;font-size:11px;min-width:80px;max-width:100%;color:#6a3f2a;outline:none;height:24px;line-height:16px}.cardhub-tag-input[data-v-36d13e32]:focus{border-color:rgba(106,63,42,0.85)}.cardhub-card__action[data-v-36d13e32]{grid-column:span 2;margin-top:10px;border:none;background:#2b2018;color:#fff5ea;padding:6px 12px;border-radius:12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-card__actions[data-v-36d13e32]{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}.cardhub-card__action.is-secondary[data-v-36d13e32]{background:#d9c6b6;color:#3b2a20}.cardhub-card__action[data-v-36d13e32]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-card__action[data-v-36d13e32]:active{transform:translateY(0)}.cardhub-preview[data-v-36d13e32]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100000}.cardhub-preview__panel[data-v-36d13e32]{width:min(520px,92vw);background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:20px;position:relative;display:grid;gap:14px}.cardhub-preview__close[data-v-36d13e32]{position:absolute;top:14px;right:14px;border:none;width:30px;height:30px;border-radius:999px;background:rgba(43,32,24,0.15);color:#3b2a20;font-size:18px;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-preview__close[data-v-36d13e32]:hover{background:rgba(43,32,24,0.25)}.cardhub-preview__close[data-v-36d13e32]:active{transform:scale(0.96)}.cardhub-preview__avatar[data-v-36d13e32]{width:100%;height:260px;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-preview__avatar img[data-v-36d13e32]{width:100%;height:100%;object-fit:contain}.cardhub-preview__info[data-v-36d13e32]{display:grid;gap:6px}.cardhub-preview__name[data-v-36d13e32]{font-size:20px;font-weight:700}.cardhub-preview__meta[data-v-36d13e32]{display:flex;gap:10px;font-size:12px;color:#7d5b46}.cardhub-preview__tags[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-preview__tag[data-v-36d13e32]{padding:6px 10px;border-radius:999px;border:1px solid rgba(106,63,42,0.3);background:#fffaf4;font-size:12px;color:#6a3f2a}.cardhub-preview__actions[data-v-36d13e32]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-manage[data-v-36d13e32]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100001}.cardhub-manage__panel[data-v-36d13e32]{width:min(760px,94vw);max-height:88vh;background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:22px;position:relative;display:grid;gap:16px;overflow:auto;overflow-x:hidden}.cardhub-manage__top[data-v-36d13e32]{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}.cardhub-manage__media[data-v-36d13e32]{width:220px;aspect-ratio:3/4;height:auto;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-manage__media img[data-v-36d13e32]{width:100%;height:100%;object-fit:cover}.cardhub-manage__summary[data-v-36d13e32]{display:grid;gap:6px}.cardhub-manage__overview[data-v-36d13e32]{display:grid;gap:10px;margin-top:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.cardhub-manage__overview-card[data-v-36d13e32]{background:rgba(255,255,255,0.7);border:1px solid rgba(106,63,42,0.2);border-radius:14px;padding:10px 12px;display:grid;gap:4px}.cardhub-manage__overview-label[data-v-36d13e32]{font-size:10px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__overview-value[data-v-36d13e32]{font-size:13px;font-weight:600;color:#3b2a20}.cardhub-manage__overview-hint[data-v-36d13e32]{font-size:11px;color:#7d5b46}.cardhub-manage__section[data-v-36d13e32]{display:grid;gap:8px}.cardhub-manage__details[data-v-36d13e32]{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.cardhub-manage__detail[data-v-36d13e32]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;display:grid;gap:6px}.cardhub-manage__detail-label[data-v-36d13e32]{font-size:11px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__detail-content[data-v-36d13e32]{font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__label[data-v-36d13e32]{display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__btn[data-v-36d13e32]{border:none;border-radius:12px;padding:6px 12px;font-size:12px;cursor:pointer;text-transform:none;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-manage__btn.is-primary[data-v-36d13e32]{background:#2b2018;color:#fff5ea}.cardhub-manage__btn.is-secondary[data-v-36d13e32]{background:#d9c6b6;color:#3b2a20}.cardhub-manage__jump-row[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:8px;align-items:center}.cardhub-manage__btn[data-v-36d13e32]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-manage__btn.is-primary[data-v-36d13e32]:hover{background:#241a14}.cardhub-manage__btn.is-secondary[data-v-36d13e32]:hover{background:#d1bca8}.cardhub-manage__btn[data-v-36d13e32]:active{transform:translateY(0)}.cardhub-manage__content[data-v-36d13e32]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__opening[data-v-36d13e32]{padding:6px 0;border-bottom:1px dashed rgba(106,63,42,0.2)}.cardhub-manage__opening[data-v-36d13e32]:last-child{border-bottom:none}.cardhub-manage__chat[data-v-36d13e32]{display:grid;gap:10px}.cardhub-manage__chat-row[data-v-36d13e32]{display:grid;grid-template-columns:minmax(140px,220px) 1fr;gap:12px;font-size:12px;color:#3b2a20;align-items:start;padding:6px 8px;border-radius:10px;cursor:pointer}.cardhub-manage__chat-row[data-v-36d13e32]:hover{background:rgba(106,63,42,0.08)}.cardhub-manage__chat-main[data-v-36d13e32]{display:grid;gap:4px}.cardhub-manage__chat-name[data-v-36d13e32]{flex:0 0 auto;font-weight:600;color:#6a3f2a;word-break:break-word}.cardhub-manage__chat-label[data-v-36d13e32]{font-size:11px;color:#9a7a63;word-break:break-word}.cardhub-manage__chat-text[data-v-36d13e32]{color:#3b2a20;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__empty[data-v-36d13e32]{font-size:12px;color:#9a7a63}.cardhub-manage__actions[data-v-36d13e32]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-confirm[data-v-36d13e32]{position:fixed;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:200000}.cardhub-confirm__panel[data-v-36d13e32]{width:min(460px,92vw);background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px}.cardhub-confirm__title[data-v-36d13e32]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-confirm__message[data-v-36d13e32]{font-size:13px;line-height:1.5;color:#4a2a1f;white-space:pre-wrap}.cardhub-confirm__actions[data-v-36d13e32]{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}.cardhub-confirm__button[data-v-36d13e32]{border:none;border-radius:999px;padding:8px 14px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease,border-color 160ms ease}.cardhub-confirm__button.is-confirm[data-v-36d13e32]{background:#d46b3d;color:#fff}.cardhub-confirm__button.is-cancel[data-v-36d13e32]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-confirm__button.is-danger[data-v-36d13e32]{background:#b6452a;color:#fff}.cardhub-confirm__button[data-v-36d13e32]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-confirm__button[data-v-36d13e32]:active{transform:translateY(0)}.cardhub-tag-manager[data-v-36d13e32]{position:absolute;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100003}.cardhub-tag-manager__panel[data-v-36d13e32]{width:min(700px,92vw);max-height:82vh;background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px;overflow:hidden;grid-template-rows:auto auto 1fr;position:relative}.cardhub-theme__panel[data-v-36d13e32]{position:relative}.cardhub-tag-manager__header[data-v-36d13e32]{display:flex;align-items:center;justify-content:space-between;gap:12px}.cardhub-tag-manager__title[data-v-36d13e32]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-tag-manager__subtitle[data-v-36d13e32]{font-size:12px;color:#7d5b46}.cardhub-tag-manager__tabs[data-v-36d13e32]{display:flex;gap:8px}.cardhub-tag-manager__tab[data-v-36d13e32]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.8);border-radius:999px;padding:6px 12px;font-size:12px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag-manager__tab.is-active[data-v-36d13e32]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-tag-manager__tab[data-v-36d13e32]:not(.is-active):hover{background:rgba(255,255,255,1);transform:translateY(-1px)}.cardhub-tag-manager__section[data-v-36d13e32]{display:grid;gap:12px;min-height:0}.cardhub-tag-manager__actions[data-v-36d13e32]{display:flex;align-items:center;gap:8px}.cardhub-tag-manager__spacer[data-v-36d13e32]{flex:1}.cardhub-tag-manager__btn[data-v-36d13e32]{border:none;border-radius:999px;padding:6px 12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-tag-manager__btn.is-primary[data-v-36d13e32]{background:#2b2018;color:#fff5ea}.cardhub-tag-manager__btn.is-secondary[data-v-36d13e32]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-tag-manager__btn[data-v-36d13e32]:disabled{opacity:0.5;cursor:default}.cardhub-tag-manager__btn[data-v-36d13e32]:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-tag-manager__list[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:8px;overflow:auto;padding-right:4px}.cardhub-tag-manager__chip[data-v-36d13e32]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.75);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag-manager__chip.is-active[data-v-36d13e32]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-tag-manager__chip[data-v-36d13e32]:hover{transform:translateY(-1px)}.cardhub-tag-manager__batch[data-v-36d13e32]{display:grid;grid-template-rows:auto auto auto auto 1fr;min-height:0}.cardhub-tag-manager__batch .cardhub-batch__list[data-v-36d13e32]{max-height:none;min-height:0;overflow:auto}.cardhub-export[data-v-36d13e32]{position:absolute;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100003}.cardhub-export__panel[data-v-36d13e32]{width:min(720px,92vw);max-height:86vh;background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px;overflow:hidden;position:relative}.cardhub-export__header[data-v-36d13e32]{display:flex;align-items:center;justify-content:space-between;gap:12px}.cardhub-export__title[data-v-36d13e32]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-export__subtitle[data-v-36d13e32]{font-size:12px;color:#7d5b46}.cardhub-export__toolbar[data-v-36d13e32]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.cardhub-export__spacer[data-v-36d13e32]{flex:1}.cardhub-export__btn[data-v-36d13e32]{border:none;border-radius:999px;padding:6px 12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-export__btn.is-primary[data-v-36d13e32]{background:#d46b3d;color:#fff}.cardhub-export__btn.is-secondary[data-v-36d13e32]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-export__btn[data-v-36d13e32]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-export__list[data-v-36d13e32]{display:grid;gap:8px;overflow:auto;padding-right:4px;max-height:58vh}.cardhub-export__item[data-v-36d13e32]{display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center;border:1px solid rgba(106,63,42,0.2);border-radius:14px;padding:10px 12px;background:rgba(255,255,255,0.75);cursor:pointer}.cardhub-export__item[data-v-36d13e32]:hover{border-color:rgba(106,63,42,0.4)}.cardhub-export__checkbox[data-v-36d13e32]{width:16px;height:16px}.cardhub-export__main[data-v-36d13e32]{display:grid;gap:4px}.cardhub-export__name[data-v-36d13e32]{font-size:13px;font-weight:600;color:#3b2a20}.cardhub-export__meta[data-v-36d13e32]{display:flex;gap:10px;font-size:11px;color:#7d5b46}.cardhub-export__tags[data-v-36d13e32]{display:flex;flex-wrap:wrap;gap:6px}.cardhub-export__tag[data-v-36d13e32]{padding:3px 8px;border-radius:999px;border:1px solid rgba(106,63,42,0.2);background:rgba(255,255,255,0.9);font-size:10px;color:#6a3f2a}.cardhub-button[data-v-36d13e32]:focus-visible,.cardhub-chip[data-v-36d13e32]:focus-visible,.cardhub-tag-filter__chip[data-v-36d13e32]:focus-visible,.cardhub-tag[data-v-36d13e32]:focus-visible,.cardhub-card__action[data-v-36d13e32]:focus-visible,.cardhub-pagination__button[data-v-36d13e32]:focus-visible,.cardhub-manage__btn[data-v-36d13e32]:focus-visible,.cardhub-close[data-v-36d13e32]:focus-visible,.cardhub-preview__close[data-v-36d13e32]:focus-visible,.cardhub-confirm__button[data-v-36d13e32]:focus-visible,.cardhub-export__btn[data-v-36d13e32]:focus-visible,.cardhub-tag-manager__btn[data-v-36d13e32]:focus-visible,.cardhub-tag-manager__tab[data-v-36d13e32]:focus-visible{outline:2px solid rgba(212,107,61,0.6);outline-offset:2px}@media (max-width:720px){.cardhub-root[data-v-36d13e32]{position:absolute !important;inset:0 !important;z-index:99999 !important;display:none;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-root.open[data-v-36d13e32]{display:flex !important}.cardhub-backdrop[data-v-36d13e32]{position:absolute !important;inset:0 !important;z-index:99998 !important;background:rgba(0,0,0,0.4) !important;backdrop-filter:blur(8px) !important}.cardhub-panel[data-v-36d13e32]{position:relative !important;width:100% !important;height:100% !important;max-height:100% !important;max-width:none !important;margin:0 !important;border-radius:24px !important;box-shadow:0 12px 48px rgba(0,0,0,0.3),0 2px 8px rgba(0,0,0,0.1) !important;display:flex !important;flex-direction:column !important;z-index:99999 !important;overflow:hidden !important;border:1px solid rgba(255,255,255,0.15) !important}.cardhub-header[data-v-36d13e32]{flex-shrink:0;padding:14px 16px;border-bottom:1px solid rgba(86,59,44,0.12)}.cardhub-title__main[data-v-36d13e32]{font-size:20px}.cardhub-title__sub[data-v-36d13e32]{font-size:11px}.cardhub-close[data-v-36d13e32]{width:28px;height:28px;font-size:16px;line-height:28px}.cardhub-toolbar[data-v-36d13e32]{flex-shrink:0;display:flex;flex-wrap:wrap;-moz-column-gap:6px;column-gap:6px;row-gap:8px;padding:10px 14px}.cardhub-search[data-v-36d13e32]{width:100%;font-size:13px;padding:8px 12px;height:34px}.cardhub-button[data-v-36d13e32]{flex:0 1 auto;min-width:0;font-size:11px;padding:6px 10px;height:32px;line-height:1}.cardhub-body[data-v-36d13e32]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:auto;-webkit-overflow-scrolling:touch;padding-bottom:env(safe-area-inset-bottom);scroll-padding-bottom:env(safe-area-inset-bottom)}.cardhub-sidebar[data-v-36d13e32]{flex-shrink:0;border-right:none;border-bottom:1px solid rgba(86,59,44,0.12);padding:10px 14px;max-height:none;overflow:visible}.cardhub-section-title[data-v-36d13e32]{font-size:10px;margin-bottom:6px}.cardhub-divider[data-v-36d13e32]{margin:6px 0}.cardhub-chip-row[data-v-36d13e32],.cardhub-tag-filter[data-v-36d13e32]{display:flex;flex-wrap:nowrap;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:6px;padding-bottom:4px}.cardhub-chip-row[data-v-36d13e32]::-webkit-scrollbar,.cardhub-tag-filter[data-v-36d13e32]::-webkit-scrollbar{height:4px}.cardhub-chip-row[data-v-36d13e32]::-webkit-scrollbar-thumb,.cardhub-tag-filter[data-v-36d13e32]::-webkit-scrollbar-thumb{background:rgba(106,63,42,0.15);border-radius:999px}.cardhub-chip[data-v-36d13e32]{font-size:11px;padding:6px 10px;min-height:30px;line-height:1;white-space:nowrap;flex-shrink:0}.cardhub-tag-filter__chip[data-v-36d13e32]{font-size:10px;padding:5px 9px;min-height:28px;line-height:1;white-space:nowrap;flex-shrink:0}.cardhub-content[data-v-36d13e32]{flex:1;min-height:0;overflow:visible;padding:12px;padding-bottom:calc(12px + env(safe-area-inset-bottom))}.cardhub-pagination[data-v-36d13e32]{align-items:flex-start;position:relative;padding-right:72px}.cardhub-pagination__actions[data-v-36d13e32]{width:100%}.cardhub-pagination__button[data-v-36d13e32]{flex:1;text-align:center}.cardhub-pagination__status[data-v-36d13e32]{position:absolute;right:12px;top:10px;font-size:10px;white-space:nowrap}.cardhub-grid[data-v-36d13e32]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;justify-content:center;justify-items:center}.cardhub-card[data-v-36d13e32]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:10px;border-radius:14px;min-width:0;width:100%;max-width:none}.cardhub-card__avatar[data-v-36d13e32]{width:40px;height:40px;flex-shrink:0;border-radius:10px}.cardhub-card__info[data-v-36d13e32]{flex:1;min-width:0}.cardhub-card__name[data-v-36d13e32]{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.cardhub-card__meta[data-v-36d13e32]{font-size:10px;gap:6px}.cardhub-card__tags[data-v-36d13e32]{margin-top:4px;gap:4px}.cardhub-tag[data-v-36d13e32]{font-size:9px;padding:3px 6px}.cardhub-card__actions[data-v-36d13e32]{display:flex;flex-direction:column;gap:4px;flex-shrink:0}.cardhub-card__action[data-v-36d13e32]{padding:5px 10px;font-size:10px;border-radius:8px}.cardhub-preview[data-v-36d13e32],.cardhub-manage[data-v-36d13e32]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-preview__panel[data-v-36d13e32],.cardhub-manage__panel[data-v-36d13e32]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important;overflow:auto !important;overflow-x:hidden !important}.cardhub-preview__avatar[data-v-36d13e32]{height:180px;border-radius:14px}.cardhub-preview__name[data-v-36d13e32]{font-size:16px}.cardhub-preview__meta[data-v-36d13e32]{font-size:11px}.cardhub-preview__tag[data-v-36d13e32]{font-size:10px;padding:4px 8px}.cardhub-preview__actions[data-v-36d13e32]{gap:8px}.cardhub-manage__top[data-v-36d13e32]{grid-template-columns:1fr;gap:12px}.cardhub-manage__media[data-v-36d13e32]{width:120px;margin:0 auto}.cardhub-manage__overview[data-v-36d13e32]{grid-template-columns:1fr}.cardhub-manage__overview-value[data-v-36d13e32]{font-size:12px}.cardhub-manage__overview-hint[data-v-36d13e32]{font-size:10px}.cardhub-manage__label[data-v-36d13e32]{flex-direction:column;align-items:flex-start;gap:6px;font-size:10px}.cardhub-manage__details[data-v-36d13e32]{grid-template-columns:1fr}.cardhub-manage__detail-label[data-v-36d13e32]{font-size:10px}.cardhub-manage__detail-content[data-v-36d13e32]{font-size:11px;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__btn[data-v-36d13e32]{width:100%;text-align:center;font-size:10px}.cardhub-manage__jump-row[data-v-36d13e32]{width:100%}.cardhub-manage__content[data-v-36d13e32]{font-size:11px;padding:10px;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__chat-row[data-v-36d13e32]{grid-template-columns:1fr;gap:3px;font-size:11px}.cardhub-manage__chat-label[data-v-36d13e32]{font-size:10px}.cardhub-manage__chat-text[data-v-36d13e32]{-webkit-line-clamp:2;overflow-wrap:anywhere;word-break:break-word}.cardhub-manage__actions[data-v-36d13e32]{grid-template-columns:1fr 1fr;gap:8px}.cardhub-export[data-v-36d13e32]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important}.cardhub-export__panel[data-v-36d13e32]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important}.cardhub-export__toolbar[data-v-36d13e32]{gap:6px}.cardhub-export__btn[data-v-36d13e32]{font-size:11px;padding:6px 10px}.cardhub-export__list[data-v-36d13e32]{max-height:48vh}.cardhub-export__item[data-v-36d13e32]{grid-template-columns:auto 1fr;gap:8px;padding:8px 10px}.cardhub-export__name[data-v-36d13e32]{font-size:12px}.cardhub-export__meta[data-v-36d13e32]{font-size:10px}.cardhub-export__tag[data-v-36d13e32]{font-size:9px}.cardhub-tag-manager[data-v-36d13e32]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important}.cardhub-tag-manager__panel[data-v-36d13e32]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important}.cardhub-tag-manager__tab[data-v-36d13e32]{font-size:11px;padding:5px 10px}.cardhub-tag-manager__btn[data-v-36d13e32]{font-size:11px;padding:6px 10px}.cardhub-tag-manager__chip[data-v-36d13e32]{font-size:10px;padding:5px 9px}}\n','',{version:3,sources:['webpack://./src/角色卡管理插件/ui/App.vue'],names:[],mappings:'AA68FA,+BACE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,+DAAoE,CACpE,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,oCACE,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,mCACE,iBAAkB,CAClB,OAAQ,CACR,0BAA8B,CAC9B,yBAA0B,CAC1B,SAAU,CACV,6BACF,CAEA,sDACE,SACF,CAEA,gCACE,iBAAkB,CAClB,oBAAsB,CACtB,cAAe,CACf,kDAAqD,CACrD,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eAAgB,CAChB,SAAU,CACV,SAAU,CACV,sCAAuC,CACvC,kDAGF,CAEA,mDACE,SAAU,CACV,gCACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,2CACF,CAEA,sCACE,cAAe,CACf,kBACF,CAEA,qCACE,cAAe,CACf,aAAc,CACd,gBACF,CAEA,kCACE,YAAa,CACb,QACF,CAEA,gCACE,WAAY,CACZ,8BAAkC,CAClC,aAAc,CACd,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,2DAGF,CAEA,sCACE,6BACF,CAEA,uCACE,qBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,cACF,CAEA,iCACE,MAAO,CACP,eAAgB,CAChB,mBAAoB,CACpB,mCAAuC,CACvC,gBAAiB,CACjB,kBACF,CAEA,iCACE,WAAY,CACZ,gBAAiB,CACjB,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,cAAe,CACf,cAAe,CACf,iFAIF,CAEA,uCACE,kBAAmB,CACnB,yCACF,CAEA,wCACE,yBACF,CAEA,0CACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,gDACE,+BAAmC,CACnC,gCAAoC,CACpC,eACF,CAEA,uCACE,YACF,CAEA,+BACE,YAAa,CACb,6CAA+C,CAC/C,KAAM,CACN,MAAO,CACP,YACF,CAEA,kCACE,YAAa,CACb,0CAA8C,CAC9C,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,aAAc,CACd,YACF,CAEA,mCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,kCACE,UAAW,CACX,UAAW,CACX,8BAAkC,CAClC,YACF,CAEA,wCACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,+BACE,eAAgB,CAChB,WAAY,CACZ,gCAAoC,CACpC,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,4EAIF,CAEA,yCACE,kBAAmB,CACnB,aACF,CAEA,qDACE,gCAAoC,CACpC,0BACF,CAEA,sCACE,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,2CACE,qCAAyC,CACzC,gCAAoC,CACpC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cAAe,CACf,oGAKF,CAEA,qDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,iEACE,iCAAqC,CACrC,gCAAoC,CACpC,0BACF,CAEA,sCACE,cACF,CAEA,qCACE,cACF,CAEA,kCACE,YAAa,CACb,aAAc,CACd,MAAO,CACP,YACF,CAEA,oCACE,YAAa,CACb,QACF,CAEA,qCACE,YAAa,CACb,kBAAmB,CACnB,wBAAyB,CACzB,QAAS,CACT,cACF,CAEA,6CACE,cAAe,CACf,aACF,CAEA,8CACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,iBACF,CAEA,6CACE,qCAAyC,CACzC,iCAAqC,CACrC,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mFAIF,CAEA,sDACE,WAAY,CACZ,cACF,CAEA,kEACE,8BAAkC,CAClC,gCAAoC,CACpC,0BACF,CAEA,mEACE,uBACF,CAEA,kEAEE,cAAe,CACf,iBAAkB,CAClB,aACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,yDAA4D,CAC5D,oBACF,CAEA,+BACE,iCAAqC,CACrC,kBAAmB,CACnB,YAAa,CACb,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,kBAAmB,CACnB,oCAAwC,CACxC,cAAe,CACf,6EAGyB,CACzB,UAAW,CACX,eACF,CAEA,qCACE,0BAA2B,CAC3B,gCAAoC,CACpC,0CACF,CAEA,sCACE,uBACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,kDAAqD,CACrD,qBAAsB,CACtB,0BAA2B,CAC3B,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,uDACE,YACF,CAEA,qCACE,WACF,CAEA,qCACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,qCACE,cAAe,CACf,eAAgB,CAChB,WAAY,CACZ,MAAO,CACP,eAAgB,CAChB,sBAAuB,CACvB,kBACF,CAEA,qCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,8BACE,oCAAwC,CACxC,kBAAmB,CACnB,mBAAoB,CACpB,eAAgB,CAChB,cAAe,CACf,aAAc,CACd,cAAe,CACf,mFAIF,CAEA,oCACE,kBAAmB,CACnB,gCAAoC,CACpC,0BACF,CAEA,sCACE,eAAgB,CAChB,eACF,CAEA,qCACE,sBAAuB,CACvB,mBACF,CAEA,mCACE,WAAY,CACZ,cACF,CAEA,oCACE,qCAAyC,CACzC,kBAAmB,CACnB,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,cAAe,CACf,aAAc,CACd,YAAa,CACb,WAAY,CACZ,gBACF,CAEA,0CACE,iCACF,CAEA,uCACE,kBAAmB,CACnB,eAAgB,CAChB,WAAY,CACZ,kBAAmB,CACnB,aAAc,CACd,gBAAiB,CACjB,kBAAmB,CACnB,cAAe,CACf,cAAe,CACf,iFAIF,CAEA,wCACE,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,eACF,CAEA,oDACE,kBAAmB,CACnB,aACF,CAEA,6CACE,0BAA2B,CAC3B,yCACF,CAEA,8CACE,uBACF,CAEA,kCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,iBAAkB,CAClB,QAAS,CACT,UAAW,CACX,WAAY,CACZ,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,8BAAkC,CAClC,aAAc,CACd,cAAe,CACf,cAAe,CACf,2DAGF,CAEA,+CACE,8BACF,CAEA,gDACE,qBACF,CAEA,0CACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,8CACE,UAAW,CACX,WAAY,CACZ,kBACF,CAEA,wCACE,YAAa,CACb,OACF,CAEA,wCACE,cAAe,CACf,eACF,CAEA,wCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,wCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,uCACE,gBAAiB,CACjB,mBAAoB,CACpB,oCAAwC,CACxC,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,2CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,iCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,aAAc,CACd,iBACF,CAEA,sCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,iBACF,CAEA,wCACE,WAAY,CACZ,gBAAmB,CACnB,WAAY,CACZ,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,4CACE,UAAW,CACX,WAAY,CACZ,gBACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,2CACE,YAAa,CACb,QAAS,CACT,eAAgB,CAChB,wDACF,CAEA,gDACE,gCAAoC,CACpC,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,YAAa,CACb,OACF,CAEA,iDACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,iDACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,gDACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,0CACE,YAAa,CACb,QAAS,CACT,wDACF,CAEA,yCACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,YAAa,CACb,OACF,CAEA,+CACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,iDACE,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBAAqB,CACrB,sBAAuB,CACvB,qBACF,CAEA,wCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,sCACE,WAAY,CACZ,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mBAAoB,CACpB,iFAIF,CAEA,iDACE,kBAAmB,CACnB,aACF,CAEA,mDACE,kBAAmB,CACnB,aACF,CAEA,2CACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,kBACF,CAEA,4CACE,0BAA2B,CAC3B,yCACF,CAEA,uDACE,kBACF,CAEA,yDACE,kBACF,CAEA,6CACE,uBACF,CAEA,0CACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBAAqB,CACrB,sBAAuB,CACvB,qBACF,CAEA,0CACE,aAAc,CACd,4CACF,CAEA,qDACE,kBACF,CAEA,uCACE,YAAa,CACb,QACF,CAEA,2CACE,YAAa,CACb,6CAA+C,CAC/C,QAAS,CACT,cAAe,CACf,aAAc,CACd,iBAAkB,CAClB,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,iDACE,+BACF,CAEA,4CACE,YAAa,CACb,OACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,aAAc,CACd,qBACF,CAEA,6CACE,cAAe,CACf,aAAc,CACd,qBACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,mBAAoB,CACpB,oBAAqB,CACrB,2BAA4B,CAC5B,eAAgB,CAChB,sBAAuB,CACvB,qBACF,CAEA,wCACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,kCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,2CACE,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,2CACE,YAAa,CACb,QAAS,CACT,wBAAyB,CACzB,cACF,CAEA,0CACE,WAAY,CACZ,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,yGAKF,CAEA,qDACE,kBAAmB,CACnB,UACF,CAEA,oDACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,oDACE,kBAAmB,CACnB,UACF,CAEA,gDACE,0BAA2B,CAC3B,yCACF,CAEA,iDACE,uBACF,CAEA,sCACE,iBAAkB,CAClB,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,6CACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,eAAgB,CAChB,gCAAiC,CACjC,iBACF,CAEA,uCACE,iBACF,CAEA,8CACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,QACF,CAEA,6CACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,gDACE,cAAe,CACf,aACF,CAEA,4CACE,YAAa,CACb,OACF,CAEA,2CACE,qCAAyC,CACzC,gCAAoC,CACpC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cAAe,CACf,mFAIF,CAEA,qDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,iEACE,8BAAkC,CAClC,0BACF,CAEA,+CACE,YAAa,CACb,QAAS,CACT,YACF,CAEA,+CACE,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,8CACE,MACF,CAEA,2CACE,WAAY,CACZ,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,iFAIF,CAEA,sDACE,kBAAmB,CACnB,aACF,CAEA,wDACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,oDACE,WAAY,CACZ,cACF,CAEA,gEACE,0BAA2B,CAC3B,yCACF,CAEA,4CACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,aAAc,CACd,iBACF,CAEA,4CACE,qCAAyC,CACzC,iCAAqC,CACrC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cAAe,CACf,oGAKF,CAEA,sDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,kDACE,0BACF,CAEA,6CACE,YAAa,CACb,0CAA2C,CAC3C,YACF,CAEA,kEACE,eAAgB,CAChB,YAAa,CACb,aACF,CAEA,iCACE,iBAAkB,CAClB,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,eAAgB,CAChB,iBACF,CAEA,yCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,QACF,CAEA,wCACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,2CACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,cACF,CAEA,yCACE,MACF,CAEA,sCACE,WAAY,CACZ,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,iFAIF,CAEA,iDACE,kBAAmB,CACnB,UACF,CAEA,mDACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,4CACE,0BAA2B,CAC3B,yCACF,CAEA,uCACE,YAAa,CACb,OAAQ,CACR,aAAc,CACd,iBAAkB,CAClB,eACF,CAEA,uCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,iCAAqC,CACrC,cACF,CAEA,6CACE,gCACF,CAEA,2CACE,UAAW,CACX,WACF,CAEA,uCACE,YAAa,CACb,OACF,CAEA,uCACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,uCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,uCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,sCACE,eAAgB,CAChB,mBAAoB,CACpB,oCAAwC,CACxC,gCAAoC,CACpC,cAAe,CACf,aACF,CAEA,wqBAaE,sCAA0C,CAC1C,kBACF,CACA,yBACE,+BACE,4BAA6B,CAC7B,kBAAmB,CACnB,wBAAyB,CACzB,YAAa,CACb,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCAAiC,CACjC,0BACF,CAEA,oCACE,uBACF,CAEA,mCACE,4BAA6B,CAC7B,kBAAmB,CACnB,wBAAyB,CACzB,qCAAyC,CACzC,oCACF,CAEA,gCACE,4BAA6B,CAC7B,qBAAsB,CACtB,sBAAuB,CACvB,0BAA2B,CAC3B,yBAA0B,CAC1B,mBAAoB,CACpB,6BAA8B,CAC9B,2EAEyC,CACzC,uBAAwB,CACxB,gCAAiC,CACjC,wBAAyB,CACzB,0BAA2B,CAC3B,kDACF,CAEA,iCACE,aAAc,CACd,iBAAkB,CAClB,2CACF,CAEA,sCACE,cACF,CAEA,qCACE,cACF,CAEA,gCACE,UAAW,CACX,WAAY,CACZ,cAAe,CACf,gBACF,CAEA,kCACE,aAAc,CACd,YAAa,CACb,cAAe,CACf,mBAAe,CAAf,cAAe,CACf,WAAY,CACZ,iBACF,CAEA,iCACE,UAAW,CACX,cAAe,CACf,gBAAiB,CACjB,WACF,CAEA,iCACE,aAAc,CACd,WAAY,CACZ,cAAe,CACf,gBAAiB,CACjB,WAAY,CACZ,aACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,MAAO,CACP,YAAa,CACb,aAAc,CACd,gCAAiC,CACjC,0CAA2C,CAC3C,iDACF,CAEA,kCACE,aAAc,CACd,iBAAkB,CAClB,2CAA+C,CAC/C,iBAAkB,CAClB,eAAgB,CAChB,gBACF,CAEA,wCACE,cAAe,CACf,iBACF,CAEA,kCACE,YACF,CAEA,wEAEE,YAAa,CACb,gBAAiB,CACjB,eAAgB,CAChB,gCAAiC,CACjC,OAAQ,CACR,kBACF,CAEA,8GAEE,UACF,CAEA,0HAEE,+BAAmC,CACnC,mBACF,CAEA,+BACE,cAAe,CACf,gBAAiB,CACjB,eAAgB,CAChB,aAAc,CACd,kBAAmB,CACnB,aACF,CAEA,2CACE,cAAe,CACf,eAAgB,CAChB,eAAgB,CAChB,aAAc,CACd,kBAAmB,CACnB,aACF,CAEA,kCACE,MAAO,CACP,YAAa,CACb,gBAAiB,CACjB,YAAa,CACb,uDACF,CAEA,qCACE,sBAAuB,CACvB,iBAAkB,CAClB,kBACF,CAEA,8CACE,UACF,CAEA,6CACE,MAAO,CACP,iBACF,CAEA,6CACE,iBAAkB,CAClB,UAAW,CACX,QAAS,CACT,cAAe,CACf,kBACF,CAEA,+BACE,YAAa,CACb,wDAA2D,CAC3D,QAAS,CACT,sBAAuB,CACvB,oBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,QAAS,CACT,YAAa,CACb,kBAAmB,CACnB,WAAY,CACZ,UAAW,CACX,cACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,aAAc,CACd,kBACF,CAEA,qCACE,MAAO,CACP,WACF,CAEA,qCACE,cAAe,CACf,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,qCACE,cAAe,CACf,OACF,CAEA,qCACE,cAAe,CACf,OACF,CAEA,8BACE,aAAc,CACd,eACF,CAEA,wCACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,aACF,CAEA,uCACE,gBAAiB,CACjB,cAAe,CACf,iBACF,CAEA,mEAEE,4BAA6B,CAC7B,kBAAmB,CACnB,uBAAwB,CACxB,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCAAiC,CACjC,0BACF,CAEA,iFAEE,mCAAoC,CACpC,0BAA2B,CAC3B,wCAAyC,CACzC,yCAA0C,CAC1C,6BAA8B,CAC9B,uBAAwB,CACxB,wBAAyB,CACzB,4BACF,CAEA,0CACE,YAAa,CACb,kBACF,CAEA,wCACE,cACF,CAEA,wCACE,cACF,CAEA,uCACE,cAAe,CACf,eACF,CAEA,2CACE,OACF,CAEA,sCACE,yBAA0B,CAC1B,QACF,CAEA,wCACE,WAAY,CACZ,aACF,CAEA,2CACE,yBACF,CAEA,iDACE,cACF,CAEA,gDACE,cACF,CAEA,wCACE,qBAAsB,CACtB,sBAAuB,CACvB,OAAQ,CACR,cACF,CAEA,0CACE,yBACF,CAEA,+CACE,cACF,CAEA,iDACE,cAAe,CACf,sBAAuB,CACvB,qBACF,CAEA,sCACE,UAAW,CACX,iBAAkB,CAClB,cACF,CAEA,2CACE,UACF,CAEA,0CACE,cAAe,CACf,YAAa,CACb,sBAAuB,CACvB,qBACF,CAEA,2CACE,yBAA0B,CAC1B,OAAQ,CACR,cACF,CAEA,6CACE,cACF,CAEA,4CACE,oBAAqB,CACrB,sBAAuB,CACvB,qBACF,CAEA,0CACE,6BAA8B,CAC9B,OACF,CAEA,iCACE,4BAA6B,CAC7B,kBAAmB,CACnB,uBAAwB,CACxB,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCACF,CAEA,wCACE,mCAAoC,CACpC,0BAA2B,CAC3B,wCAAyC,CACzC,yCAA0C,CAC1C,6BAA8B,CAC9B,uBACF,CAEA,0CACE,OACF,CAEA,sCACE,cAAe,CACf,gBACF,CAEA,uCACE,eACF,CAEA,uCACE,8BAA+B,CAC/B,OAAQ,CACR,gBACF,CAEA,uCACE,cACF,CAEA,uCACE,cACF,CAEA,sCACE,aACF,CAEA,sCACE,4BAA6B,CAC7B,kBAAmB,CACnB,uBAAwB,CACxB,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCACF,CAEA,6CACE,mCAAoC,CACpC,0BAA2B,CAC3B,wCAAyC,CACzC,yCAA0C,CAC1C,6BAA8B,CAC9B,uBACF,CAEA,2CACE,cAAe,CACf,gBACF,CAEA,2CACE,cAAe,CACf,gBACF,CAEA,4CACE,cAAe,CACf,eACF,CACF',sourcesContent:['<template>\n  <div class="cardhub-root" :class="{ open: state.open }" :style="themeStyle">\n    <div class="cardhub-backdrop" @click="close" />\n    <section class="cardhub-panel" role="dialog" aria-label="CardHub 角色卡管理器">\n      <header class="cardhub-header">\n        <div class="cardhub-title">\n          <span class="cardhub-title__main">CardHub</span>\n          <span class="cardhub-title__sub">角色卡管理器</span>\n        </div>\n        <div class="cardhub-actions">\n          <button class="cardhub-theme-trigger" type="button" aria-label="配色" @click="openThemeDialog">\n            <i class="fa-solid fa-palette" aria-hidden="true"></i>\n          </button>\n          <button class="cardhub-close" type="button" aria-label="关闭" @click="close">\n            <span aria-hidden="true">×</span>\n          </button>\n        </div>\n      </header>\n\n      <div class="cardhub-toolbar">\n        <input v-model="state.search" class="cardhub-search" type="search" placeholder="搜索角色名或标签" />\n        <button class="cardhub-button" type="button" @click="refresh">刷新</button>\n        <button class="cardhub-button is-ghost" type="button" @click="triggerImport">导入</button>\n        <button class="cardhub-button is-ghost" type="button" @click="exportSelected">批量导出</button>\n        <input\n          ref="importInput"\n          class="cardhub-import-input"\n          type="file"\n          accept=".png,.json"\n          multiple\n          @change="handleImportFiles"\n        />\n      </div>\n\n      <div class="cardhub-body">\n        <div class="cardhub-sidebar">\n          <div class="cardhub-filter-row">\n            <div class="cardhub-filter-block">\n              <div class="cardhub-section-title">分类</div>\n              <div class="cardhub-chip-row">\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': statusFilter === \'all\' }"\n                  type="button"\n                  @click="statusFilter = \'all\'"\n                >\n                  全部\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': statusFilter === \'imported\' }"\n                  type="button"\n                  @click="statusFilter = \'imported\'"\n                >\n                  已导入\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': statusFilter === \'unimported\' }"\n                  type="button"\n                  @click="statusFilter = \'unimported\'"\n                >\n                  未导入\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': favoritesOnly }"\n                  type="button"\n                  @click="favoritesOnly = !favoritesOnly"\n                >\n                  收藏\n                </button>\n              </div>\n            </div>\n            <div class="cardhub-filter-block">\n              <div class="cardhub-section-title">排序</div>\n              <div class="cardhub-chip-row">\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': sortKey === \'recent\' }"\n                  type="button"\n                  @click="sortKey = \'recent\'"\n                >\n                  最近聊天\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': sortKey === \'name\' }"\n                  type="button"\n                  @click="sortKey = \'name\'"\n                >\n                  名称\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': sortKey === \'tags\' }"\n                  type="button"\n                  @click="sortKey = \'tags\'"\n                >\n                  标签数量\n                </button>\n                <button\n                  class="cardhub-chip"\n                  :class="{ \'is-active\': sortKey === \'imported\' }"\n                  type="button"\n                  @click="sortKey = \'imported\'"\n                >\n                  导入时间\n                </button>\n              </div>\n            </div>\n          </div>\n          <div class="cardhub-divider" />\n          <div class="cardhub-section-title">标签</div>\n          <div class="cardhub-tag-filter">\n            <button\n              v-for="tag in allTags"\n              :key="tag"\n              class="cardhub-tag-filter__chip"\n              :class="{ \'is-active\': selectedTags.includes(tag) }"\n              type="button"\n              @click="toggleTagFilter(tag)"\n            >\n              {{ tag }}\n            </button>\n          </div>\n          <button\n            v-if="selectedTags.length"\n            class="cardhub-chip cardhub-chip--clear"\n            type="button"\n            @click="clearTagFilter"\n          >\n            清空标签\n          </button>\n          <button class="cardhub-chip cardhub-chip--more" type="button" @click="openTagManager(\'filter\')">\n            标签管理\n          </button>\n        </div>\n\n        <div class="cardhub-content">\n          <div v-if="state.loading" class="cardhub-loading">正在读取角色卡...</div>\n          <div v-else-if="!filteredCharacters.length" class="cardhub-empty">暂无角色卡，或没有匹配的搜索结果。</div>\n          <div v-else class="cardhub-grid-wrap">\n            <div class="cardhub-pagination">\n              <div v-if="totalPages > 1" class="cardhub-pagination__actions">\n                <button class="cardhub-pagination__button" type="button" :disabled="currentPage <= 1" @click="prevPage">\n                  上一页\n                </button>\n                <button\n                  class="cardhub-pagination__button"\n                  type="button"\n                  :disabled="currentPage >= totalPages"\n                  @click="nextPage"\n                >\n                  下一页\n                </button>\n              </div>\n              <span class="cardhub-pagination__status">第 {{ currentPage }} / {{ totalPages }} 页</span>\n            </div>\n            <div class="cardhub-grid">\n              <article\n                v-for="character in pagedCharacters"\n                :key="character.id"\n                class="cardhub-card"\n                @click="openManage(character)"\n              >\n                <div\n                  class="cardhub-card__avatar"\n                  :class="{ \'has-avatar\': Boolean(avatarUrl(character)) }"\n                  :style="avatarStyle(character)"\n                >\n                  <span>{{ character.name.slice(0, 1) || \'?\' }}</span>\n                </div>\n                <div class="cardhub-card__info">\n                  <div class="cardhub-card__head">\n                    <div class="cardhub-card__name">{{ character.name }}</div>\n                    <button\n                      class="cardhub-fav"\n                      :class="{ \'is-active\': isFavorite(character.id) }"\n                      type="button"\n                      aria-label="收藏"\n                      @click.stop="toggleFavorite(character)"\n                    >\n                      <i class="fa-solid fa-star" aria-hidden="true"></i>\n                    </button>\n                  </div>\n                  <div class="cardhub-card__meta">\n                    <span>{{ character.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n                    <span>{{ displayTags(character).length }} 标签</span>\n                  </div>\n                  <div class="cardhub-card__tags">\n                    <button\n                      v-for="tag in displayTags(character)"\n                      :key="tag"\n                      class="cardhub-tag"\n                      type="button"\n                      title="点击移除标签"\n                      @click.stop="removeTag(character, tag)"\n                    >\n                      {{ tag }}\n                      <span class="cardhub-tag__remove">×</span>\n                    </button>\n                    <button\n                      v-if="activeTagKey !== tagKey(character)"\n                      class="cardhub-tag is-add"\n                      type="button"\n                      @click.stop="startTagEdit(character)"\n                    >\n                      + 标签\n                    </button>\n                    <div v-else class="cardhub-tag-edit" @click.stop @mousedown.stop @touchstart.stop>\n                      <input\n                        v-model="tagInput"\n                        class="cardhub-tag-input"\n                        type="text"\n                        placeholder="新标签"\n                        @keydown.enter.prevent="confirmTag(character)"\n                        @keydown.esc.prevent="cancelTagEdit"\n                        @blur="confirmTag(character)"\n                      />\n                      <button class="cardhub-tag-confirm" type="button" @click="confirmTag(character)">✔</button>\n                    </div>\n                  </div>\n                </div>\n                <div class="cardhub-card__actions">\n                  <button\n                    class="cardhub-card__action is-secondary"\n                    type="button"\n                    @click.stop="handleCardAction(character)"\n                    @pointerdown.stop\n                    @mousedown.stop\n                    @touchstart.stop\n                  >\n                    {{ character.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n                  </button>\n                  <button\n                    class="cardhub-card__action"\n                    type="button"\n                    @click.stop="openManage(character)"\n                    @pointerdown.stop\n                    @mousedown.stop\n                    @touchstart.stop\n                  >\n                    管理\n                  </button>\n                </div>\n              </article>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <div v-if="manageCard" class="cardhub-manage" @click.self="closeManage">\n      <div class="cardhub-manage__panel" role="dialog" aria-label="角色管理">\n        <button class="cardhub-preview__close" type="button" @click="closeManage">×</button>\n        <div class="cardhub-manage__top">\n          <div class="cardhub-manage__summary">\n            <div class="cardhub-preview__name">{{ manageCard.name }}</div>\n            <div class="cardhub-preview__meta">\n              <span>{{ manageCard.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n              <span>{{ displayTags(manageCard).length }} 标签</span>\n            </div>\n            <div class="cardhub-preview__tags">\n              <span v-for="tag in displayTags(manageCard)" :key="tag" class="cardhub-preview__tag">\n                {{ tag }}\n              </span>\n            </div>\n            <div class="cardhub-manage__overview">\n              <div v-for="item in manageOverview" :key="item.label" class="cardhub-manage__overview-card">\n                <div class="cardhub-manage__overview-label">{{ item.label }}</div>\n                <div class="cardhub-manage__overview-value">{{ item.value }}</div>\n                <div v-if="item.hint" class="cardhub-manage__overview-hint">{{ item.hint }}</div>\n              </div>\n            </div>\n          </div>\n          <div class="cardhub-manage__media">\n            <img v-if="manageAvatarUrl" :src="manageAvatarUrl" alt="" />\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">角色卡预览</div>\n          <div v-if="manageDetails.length" class="cardhub-manage__details">\n            <div v-for="detail in manageDetails" :key="detail.label" class="cardhub-manage__detail">\n              <div class="cardhub-manage__detail-label">{{ detail.label }}</div>\n              <div class="cardhub-manage__detail-content">{{ detail.value }}</div>\n            </div>\n          </div>\n          <div v-else class="cardhub-manage__empty">{{ manageDetailsHint }}</div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">开场白</div>\n          <div class="cardhub-manage__content">\n            <template v-if="manageOpeningLines.length">\n              <div v-for="(opening, index) in manageOpeningLines" :key="index" class="cardhub-manage__opening">\n                {{ opening }}\n              </div>\n            </template>\n            <template v-else>暂无开场白</template>\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">\n            <span>最近聊天</span>\n            <div class="cardhub-manage__jump-row">\n              <button\n                class="cardhub-manage__btn is-primary"\n                type="button"\n                @click="openLatestChat"\n                @pointerdown.stop\n                @mousedown.stop\n                @touchstart.stop\n              >\n                进入最近聊天\n              </button>\n              <button\n                class="cardhub-manage__btn is-secondary"\n                type="button"\n                @click="openNewChat"\n                @pointerdown.stop\n                @mousedown.stop\n                @touchstart.stop\n              >\n                新聊天\n              </button>\n            </div>\n          </div>\n          <div v-if="manageChats.length" class="cardhub-manage__chat">\n            <div\n              v-for="(msg, index) in manageChats"\n              :key="index"\n              class="cardhub-manage__chat-row"\n              role="button"\n              tabindex="0"\n              @click="openChat(msg)"\n              @keydown.enter.prevent="openChat(msg)"\n            >\n              <div class="cardhub-manage__chat-main">\n                <div class="cardhub-manage__chat-name">{{ msg.name }}</div>\n                <div v-if="msg.label && msg.label !== msg.name" class="cardhub-manage__chat-label">\n                  {{ msg.label }}\n                </div>\n              </div>\n              <span class="cardhub-manage__chat-text">{{ msg.mes }}</span>\n            </div>\n          </div>\n          <div v-else class="cardhub-manage__empty">{{ manageChatHint }}</div>\n        </div>\n        <div class="cardhub-manage__actions">\n          <button\n            class="cardhub-manage__btn is-secondary"\n            type="button"\n            @click.stop="handleCardAction(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            {{ manageCard.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n          </button>\n          <button\n            class="cardhub-manage__btn is-primary"\n            type="button"\n            @click.stop="manageDelete(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            删除\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="confirmState.open" class="cardhub-confirm" @click.self="resolveConfirm(\'cancel\')">\n      <div class="cardhub-confirm__panel" role="dialog" aria-modal="true">\n        <div class="cardhub-confirm__title">{{ confirmState.title }}</div>\n        <div class="cardhub-confirm__message">{{ confirmState.message }}</div>\n        <div class="cardhub-confirm__actions">\n          <button class="cardhub-confirm__button is-cancel" type="button" @click="resolveConfirm(\'cancel\')">\n            {{ confirmState.cancelLabel }}\n          </button>\n          <button\n            v-if="confirmState.altLabel"\n            class="cardhub-confirm__button is-danger"\n            type="button"\n            @click="resolveConfirm(\'alt\')"\n          >\n            {{ confirmState.altLabel }}\n          </button>\n          <button class="cardhub-confirm__button is-confirm" type="button" @click="resolveConfirm(\'confirm\')">\n            {{ confirmState.confirmLabel }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="tagManagerOpen" class="cardhub-tag-manager" @click.self="closeTagManager">\n      <div class="cardhub-tag-manager__panel" role="dialog" aria-label="标签管理">\n        <div class="cardhub-tag-manager__header">\n          <div>\n            <div class="cardhub-tag-manager__title">标签管理</div>\n            <div v-if="tagManagerTab === \'filter\'" class="cardhub-tag-manager__subtitle">\n              已选 {{ selectedTags.length }} / {{ allTags.length }}\n            </div>\n            <div v-else class="cardhub-tag-manager__subtitle">\n              已选 {{ batchTagSelectedIds.length }} / {{ batchTagVisibleCandidates.length }}\n            </div>\n          </div>\n          <button class="cardhub-preview__close" type="button" @click="closeTagManager">×</button>\n        </div>\n        <div class="cardhub-tag-manager__tabs">\n          <button\n            class="cardhub-tag-manager__tab"\n            :class="{ \'is-active\': tagManagerTab === \'filter\' }"\n            type="button"\n            @click="openTagManager(\'filter\')"\n          >\n            标签筛选\n          </button>\n          <button\n            class="cardhub-tag-manager__tab"\n            :class="{ \'is-active\': tagManagerTab === \'batch\' }"\n            type="button"\n            @click="openTagManager(\'batch\')"\n          >\n            批量标签\n          </button>\n        </div>\n        <div v-if="tagManagerTab === \'filter\'" class="cardhub-tag-manager__section">\n          <div class="cardhub-tag-manager__actions">\n            <button\n              class="cardhub-tag-manager__btn is-secondary"\n              type="button"\n              :disabled="!selectedTags.length"\n              @click="clearTagFilter"\n            >\n              清空\n            </button>\n            <div class="cardhub-tag-manager__spacer"></div>\n            <button class="cardhub-tag-manager__btn is-primary" type="button" @click="closeTagManager">完成</button>\n          </div>\n          <div class="cardhub-tag-manager__list">\n            <button\n              v-for="tag in allTags"\n              :key="tag"\n              class="cardhub-tag-manager__chip"\n              :class="{ \'is-active\': selectedTags.includes(tag) }"\n              type="button"\n              @click="toggleTagFilter(tag)"\n            >\n              {{ tag }}\n            </button>\n          </div>\n        </div>\n        <div v-else class="cardhub-tag-manager__section cardhub-tag-manager__batch">\n          <div class="cardhub-batch__filters">\n            <input\n              v-model="batchTagSearch"\n              class="cardhub-batch__search"\n              type="search"\n              placeholder="搜索角色名或标签"\n            />\n            <div class="cardhub-batch__hint">提示：可先在主界面筛选，再切换到批量标签。</div>\n          </div>\n          <div class="cardhub-batch__field">\n            <input v-model="batchTagInput" type="text" placeholder="输入标签，逗号/换行分隔" />\n          </div>\n          <div v-if="batchTagSuggestions.length" class="cardhub-batch__suggestions">\n            <span class="cardhub-batch__suggest-title">已有标签</span>\n            <div class="cardhub-batch__suggest-row">\n              <button\n                v-for="tag in batchTagSuggestions"\n                :key="tag"\n                class="cardhub-batch__chip"\n                :class="{ \'is-active\': batchTagSelectedTags.includes(tag) }"\n                type="button"\n                @click="toggleBatchTagSuggestion(tag)"\n              >\n                {{ tag }}\n              </button>\n            </div>\n          </div>\n          <div class="cardhub-batch__toolbar">\n            <button class="cardhub-batch__btn is-secondary" type="button" @click="selectAllBatchTags">全选</button>\n            <button class="cardhub-batch__btn is-secondary" type="button" @click="clearBatchTagSelection">清空</button>\n            <div class="cardhub-batch__spacer"></div>\n            <button class="cardhub-batch__btn is-ghost" type="button" @click="applyBatchTags(\'remove\')">\n              移除标签\n            </button>\n            <button class="cardhub-batch__btn is-primary" type="button" @click="applyBatchTags(\'add\')">添加标签</button>\n          </div>\n          <div class="cardhub-batch__list">\n            <label v-for="item in batchTagVisibleCandidates" :key="item.id" class="cardhub-batch__item">\n              <input\n                class="cardhub-batch__checkbox"\n                type="checkbox"\n                :checked="batchTagSelectedSet.has(item.id)"\n                @change="toggleBatchTagSelection(item.id)"\n              />\n              <div class="cardhub-batch__main">\n                <div class="cardhub-batch__name">{{ item.name }}</div>\n                <div class="cardhub-batch__meta">\n                  <span>{{ item.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n                  <span>{{ displayTags(item).length }} 标签</span>\n                </div>\n                <div v-if="displayTags(item).length" class="cardhub-batch__tags">\n                  <span v-for="tag in displayTags(item).slice(0, 3)" :key="tag" class="cardhub-batch__tag">\n                    {{ tag }}\n                  </span>\n                </div>\n              </div>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="exportDialogOpen" class="cardhub-export" @click.self="closeExportDialog">\n      <div class="cardhub-export__panel" role="dialog" aria-label="批量导出">\n        <div class="cardhub-export__header">\n          <div>\n            <div class="cardhub-export__title">批量导出</div>\n            <div class="cardhub-export__subtitle">\n              已选 {{ exportSelectedItems.length }} / {{ exportVisibleCandidates.length }}\n            </div>\n          </div>\n          <button class="cardhub-preview__close" type="button" @click="closeExportDialog">×</button>\n        </div>\n        <div class="cardhub-export__filters">\n          <input v-model="exportSearch" class="cardhub-export__search" type="search" placeholder="搜索角色名或标签" />\n          <div class="cardhub-export__filter-row">\n            <button\n              class="cardhub-export__chip"\n              :class="{ \'is-active\': exportStatusFilter === \'all\' }"\n              type="button"\n              @click="exportStatusFilter = \'all\'"\n            >\n              全部\n            </button>\n            <button\n              class="cardhub-export__chip"\n              :class="{ \'is-active\': exportStatusFilter === \'imported\' }"\n              type="button"\n              @click="exportStatusFilter = \'imported\'"\n            >\n              已导入\n            </button>\n            <button\n              class="cardhub-export__chip"\n              :class="{ \'is-active\': exportStatusFilter === \'unimported\' }"\n              type="button"\n              @click="exportStatusFilter = \'unimported\'"\n            >\n              未导入\n            </button>\n          </div>\n          <div class="cardhub-export__filter-row">\n            <button\n              v-for="tag in exportAllTags"\n              :key="tag"\n              class="cardhub-export__chip"\n              :class="{ \'is-active\': exportTagFilters.includes(tag) }"\n              type="button"\n              @click="toggleExportTagFilter(tag)"\n            >\n              {{ tag }}\n            </button>\n            <button\n              v-if="exportTagFilters.length"\n              class="cardhub-export__chip cardhub-export__chip--clear"\n              type="button"\n              @click="clearExportTagFilter"\n            >\n              清空标签\n            </button>\n          </div>\n        </div>\n        <div class="cardhub-export__toolbar">\n          <button class="cardhub-export__btn is-secondary" type="button" @click="selectAllExport">全选</button>\n          <button class="cardhub-export__btn is-secondary" type="button" @click="clearExportSelection">清空</button>\n          <div class="cardhub-export__spacer"></div>\n          <button class="cardhub-export__btn is-secondary" type="button" @click="closeExportDialog">取消</button>\n          <button class="cardhub-export__btn is-primary" type="button" @click="confirmExportSelected">导出已选</button>\n        </div>\n        <div class="cardhub-export__list">\n          <label v-for="item in exportVisibleCandidates" :key="item.id" class="cardhub-export__item">\n            <input\n              class="cardhub-export__checkbox"\n              type="checkbox"\n              :checked="isExportSelected(item.id)"\n              @change="toggleExportSelection(item.id)"\n            />\n            <div class="cardhub-export__main">\n              <div class="cardhub-export__name">{{ item.name }}</div>\n              <div class="cardhub-export__meta">\n                <span>{{ item.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n                <span>{{ displayTags(item).length }} 标签</span>\n              </div>\n              <div v-if="displayTags(item).length" class="cardhub-export__tags">\n                <span v-for="tag in displayTags(item).slice(0, 3)" :key="tag" class="cardhub-export__tag">\n                  {{ tag }}\n                </span>\n              </div>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="themeDialogOpen" class="cardhub-theme" @click.self="closeThemeDialog">\n      <div class="cardhub-theme__panel" role="dialog" aria-label="配色设置">\n        <div class="cardhub-theme__header">\n          <div>\n            <div class="cardhub-theme__title">配色设置</div>\n            <div class="cardhub-theme__subtitle">修改后可直接预览，保存到全局</div>\n          </div>\n          <button class="cardhub-preview__close" type="button" @click="closeThemeDialog">×</button>\n        </div>\n        <div class="cardhub-theme__grid">\n          <label class="cardhub-theme__field">\n            <span>背景渐变 1</span>\n            <input v-model="themeDraft.bgStart" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>背景渐变 2</span>\n            <input v-model="themeDraft.bgEnd" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>卡片/面板底色</span>\n            <input v-model="themeDraft.surface" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>浅色底</span>\n            <input v-model="themeDraft.surfaceAlt" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>主文本</span>\n            <input v-model="themeDraft.text" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>次级文本</span>\n            <input v-model="themeDraft.textMuted" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>强调色</span>\n            <input v-model="themeDraft.accent" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>强调深色</span>\n            <input v-model="themeDraft.accentStrong" type="color" />\n          </label>\n          <label class="cardhub-theme__field">\n            <span>边框</span>\n            <input v-model="themeDraft.border" type="color" />\n          </label>\n        </div>\n        <div class="cardhub-theme__presets">\n          <button\n            v-for="preset in themePresets"\n            :key="preset.name"\n            class="cardhub-theme__preset"\n            type="button"\n            @click="applyThemePreset(preset)"\n          >\n            {{ preset.name }}\n          </button>\n        </div>\n        <div class="cardhub-theme__actions">\n          <button class="cardhub-theme__btn is-secondary" type="button" @click="resetThemeDraft">恢复默认</button>\n          <div class="cardhub-theme__spacer"></div>\n          <button class="cardhub-theme__btn is-secondary" type="button" @click="closeThemeDialog">取消</button>\n          <button class="cardhub-theme__btn is-primary" type="button" @click="saveThemeDraft">保存</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, nextTick, onMounted, reactive, ref, watch } from \'vue\';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from \'../state/store\';\nimport { fetchCharacterSummaries } from \'../services/characterSource\';\nimport type { CardHubItem } from \'../types\';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from \'../services/libraryService\';\nimport { getMergedTags, updateCharacterTags } from \'../services/tagService\';\n\nconst selectedTags = ref<string[]>([]);\nconst tagManagerOpen = ref(false);\nconst tagManagerTab = ref<\'filter\' | \'batch\'>(\'filter\');\nconst activeTagKey = ref<string | null>(null);\nconst tagInput = ref(\'\');\nconst statusFilter = ref<\'all\' | \'imported\' | \'unimported\'>(\'all\');\nconst pageSize = ref(24);\nconst currentPage = ref(1);\nconst importInput = ref<HTMLInputElement | null>(null);\nconst manageCard = ref<CardHubItem | null>(null);\nconst manageOpenings = ref<string[]>([]);\ntype ManageChatEntry = {\n  name: string;\n  label?: string;\n  mes: string;\n  file: string;\n};\n\nconst manageChats = ref<ManageChatEntry[]>([]);\nconst manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\nlet manageRequestId = 0;\ntype ManageDetail = {\n  label: string;\n  value: string;\n};\ntype ManageProfile = {\n  description?: string;\n  personality?: string;\n  scenario?: string;\n  creatorNotes?: string;\n  systemPrompt?: string;\n  postHistory?: string;\n  creator?: string;\n  worldBookName?: string;\n  worldBookCount?: number;\n};\ntype ManageOpeningSummary = {\n  total: number;\n  alternate: number;\n};\ntype ManageChatSummary = {\n  total: number;\n  latest: string;\n};\ntype ManageChatData = {\n  list: ManageChatEntry[];\n  summary: ManageChatSummary | null;\n};\ntype ManageOverviewItem = {\n  label: string;\n  value: string;\n  hint?: string;\n};\ntype ManageData = {\n  openings: string[];\n  profile: ManageProfile | null;\n  openingSummary: ManageOpeningSummary | null;\n};\ntype ConfirmResult = \'confirm\' | \'cancel\' | \'alt\';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\nconst confirmState = reactive({\n  open: false,\n  title: \'\',\n  message: \'\',\n  confirmLabel: \'确定\',\n  cancelLabel: \'取消\',\n  altLabel: \'\',\n  resolve: null as null | ((result: ConfirmResult) => void),\n});\n\nconst allCards = computed(() => [...state.characters, ...state.library]);\nconst mergedTagsMap = computed(() => {\n  const map = new Map<string, string[]>();\n  allCards.value.forEach(card => {\n    map.set(card.id, getMergedTags(card));\n  });\n  return map;\n});\nconst manageProfile = ref<ManageProfile | null>(null);\nconst manageOpeningSummary = ref<ManageOpeningSummary | null>(null);\nconst manageChatSummary = ref<ManageChatSummary | null>(null);\nconst exportDialogOpen = ref(false);\nconst exportSelectedIds = ref<string[]>([]);\nconst exportCandidates = computed(() => [...allCards.value]);\nconst exportSearch = ref(\'\');\nconst exportStatusFilter = ref<\'all\' | \'imported\' | \'unimported\'>(\'all\');\nconst exportTagFilters = ref<string[]>([]);\nconst batchTagSelectedIds = ref<string[]>([]);\nconst batchTagSearch = ref(\'\');\nconst batchTagInput = ref(\'\');\nconst batchTagSelectedTags = ref<string[]>([]);\nconst exportAllTags = computed(() => {\n  const tagSet = new Set<string>();\n  exportCandidates.value.forEach(card => {\n    (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).forEach(tag => tagSet.add(tag));\n  });\n  exportTagFilters.value.forEach(tag => tagSet.add(tag));\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, \'zh-CN\'));\n});\nconst exportVisibleCandidates = computed(() => {\n  let list = exportCandidates.value;\n  if (exportStatusFilter.value === \'imported\') {\n    list = list.filter(item => item.origin === \'tavern\');\n  } else if (exportStatusFilter.value === \'unimported\') {\n    list = list.filter(item => item.origin === \'library\');\n  }\n  if (exportTagFilters.value.length) {\n    list = list.filter(card =>\n      exportTagFilters.value.some(tag => (mergedTagsMap.value.get(card.id) ?? getMergedTags(card)).includes(tag)),\n    );\n  }\n  const keyword = exportSearch.value.trim().toLowerCase();\n  if (!keyword) {\n    return list;\n  }\n  return list.filter(card => {\n    if (card.name.toLowerCase().includes(keyword)) {\n      return true;\n    }\n    const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\n    return tags.some(tag => tag.toLowerCase().includes(keyword));\n  });\n});\nconst exportSelectedSet = computed(() => new Set(exportSelectedIds.value));\nconst exportSelectedItems = computed(() => exportCandidates.value.filter(item => exportSelectedSet.value.has(item.id)));\nconst batchTagCandidates = computed(() => filteredCharacters.value);\nconst batchTagVisibleCandidates = computed(() => {\n  const keyword = batchTagSearch.value.trim().toLowerCase();\n  if (!keyword) {\n    return batchTagCandidates.value;\n  }\n  return batchTagCandidates.value.filter(card => {\n    if (card.name.toLowerCase().includes(keyword)) {\n      return true;\n    }\n    const tags = mergedTagsMap.value.get(card.id) ?? getMergedTags(card);\n    return tags.some(tag => tag.toLowerCase().includes(keyword));\n  });\n});\nconst batchTagSelectedSet = computed(() => new Set(batchTagSelectedIds.value));\nconst batchTagSuggestions = computed(() => allTags.value);\n\nconst FAVORITES_KEY = \'cardhub_favorites\';\nconst favoriteIds = ref<string[]>([]);\nconst favoriteSet = computed(() => new Set(favoriteIds.value));\nconst sortKey = ref<\'recent\' | \'name\' | \'tags\' | \'imported\'>(\'recent\');\nconst favoritesOnly = ref(false);\nconst LAST_CHAT_CACHE_KEY = \'cardhub_last_chat_cache\';\nconst lastChatCache = ref<Record<string, number>>({});\nconst IMPORT_CACHE_KEY = \'cardhub_import_cache\';\nconst importCache = ref<Record<string, number>>({});\n\ntype CardHubTheme = {\n  bgStart: string;\n  bgEnd: string;\n  surface: string;\n  surfaceAlt: string;\n  text: string;\n  textMuted: string;\n  accent: string;\n  accentStrong: string;\n  border: string;\n};\n\nconst THEME_KEY = \'cardhub_theme\';\nconst defaultTheme: CardHubTheme = {\n  bgStart: \'#f6f8fb\',\n  bgEnd: \'#e6ebf2\',\n  surface: \'#fdfdfe\',\n  surfaceAlt: \'#f1f4f9\',\n  text: \'#1b1e22\',\n  textMuted: \'#6b7480\',\n  accent: \'#7fb3e1\',\n  accentStrong: \'#243a52\',\n  border: \'#d5dde8\',\n};\n\nconst themeDialogOpen = ref(false);\nconst themeCurrent = ref<CardHubTheme>({ ...defaultTheme });\nconst themeDraft = reactive<CardHubTheme>({ ...defaultTheme });\nconst themeStyle = computed<Record<string, string>>(() => {\n  const theme = themeDialogOpen.value ? (themeDraft as CardHubTheme) : themeCurrent.value;\n  return {\n    \'--cardhub-bg-start\': theme.bgStart,\n    \'--cardhub-bg-end\': theme.bgEnd,\n    \'--cardhub-surface\': theme.surface,\n    \'--cardhub-surface-alt\': theme.surfaceAlt,\n    \'--cardhub-text\': theme.text,\n    \'--cardhub-text-muted\': theme.textMuted,\n    \'--cardhub-accent\': theme.accent,\n    \'--cardhub-accent-strong\': theme.accentStrong,\n    \'--cardhub-border\': theme.border,\n    \'--cardhub-surface-rgb\': hexToRgb(theme.surface),\n    \'--cardhub-surface-alt-rgb\': hexToRgb(theme.surfaceAlt),\n    \'--cardhub-border-rgb\': hexToRgb(theme.border),\n    \'--cardhub-accent-rgb\': hexToRgb(theme.accent),\n    \'--cardhub-accent-strong-rgb\': hexToRgb(theme.accentStrong),\n    \'--cardhub-accent-text\': contrastTextColor(theme.accent),\n    \'--cardhub-accent-strong-text\': contrastTextColor(theme.accentStrong),\n  };\n});\nconst themePresets = [\n  {\n    name: \'晨雾\',\n    value: {\n      bgStart: \'#f6f8fb\',\n      bgEnd: \'#e6ebf2\',\n      surface: \'#fdfdfe\',\n      surfaceAlt: \'#f1f4f9\',\n      text: \'#1b1e22\',\n      textMuted: \'#6b7480\',\n      accent: \'#7fb3e1\',\n      accentStrong: \'#243a52\',\n      border: \'#d5dde8\',\n    },\n  },\n  {\n    name: \'白天\',\n    value: {\n      bgStart: \'#fdfaf4\',\n      bgEnd: \'#f2ebe1\',\n      surface: \'#fffefb\',\n      surfaceAlt: \'#f7efe6\',\n      text: \'#1d1a17\',\n      textMuted: \'#7a6f63\',\n      accent: \'#e3a981\',\n      accentStrong: \'#3f2c22\',\n      border: \'#e4d7c8\',\n    },\n  },\n  {\n    name: \'夜晚\',\n    value: {\n      bgStart: \'#14181d\',\n      bgEnd: \'#0d1116\',\n      surface: \'#1e242b\',\n      surfaceAlt: \'#242b34\',\n      text: \'#eef2f7\',\n      textMuted: \'#b2bdc9\',\n      accent: \'#6fa2d1\',\n      accentStrong: \'#d7e6f4\',\n      border: \'#36414c\',\n    },\n  },\n  {\n    name: \'茶棕\',\n    value: {\n      bgStart: \'#f7f1e7\',\n      bgEnd: \'#e6d8c6\',\n      surface: \'#fcf6ee\',\n      surfaceAlt: \'#f2e4d6\',\n      text: \'#2a1f18\',\n      textMuted: \'#8a6d5a\',\n      accent: \'#c47b52\',\n      accentStrong: \'#3e2a22\',\n      border: \'#ddc7b4\',\n    },\n  },\n  {\n    name: \'赤陶\',\n    value: {\n      bgStart: \'#fbf1ea\',\n      bgEnd: \'#ecd5c8\',\n      surface: \'#fff7f1\',\n      surfaceAlt: \'#f4e1d6\',\n      text: \'#2d2018\',\n      textMuted: \'#8b6a5a\',\n      accent: \'#d17a4f\',\n      accentStrong: \'#4c2d21\',\n      border: \'#e3c3b3\',\n    },\n  },\n  {\n    name: \'薄荷\',\n    value: {\n      bgStart: \'#f2fbf7\',\n      bgEnd: \'#dcefe7\',\n      surface: \'#f9fffd\',\n      surfaceAlt: \'#e8f4f0\',\n      text: \'#1a2a26\',\n      textMuted: \'#5f7a73\',\n      accent: \'#60b6a4\',\n      accentStrong: \'#1f4c43\',\n      border: \'#c5ddd5\',\n    },\n  },\n  {\n    name: \'海盐\',\n    value: {\n      bgStart: \'#f3f8fb\',\n      bgEnd: \'#d9e7f3\',\n      surface: \'#f9fcff\',\n      surfaceAlt: \'#e9f2f9\',\n      text: \'#1b2530\',\n      textMuted: \'#5f7388\',\n      accent: \'#5da3cf\',\n      accentStrong: \'#1f3e57\',\n      border: \'#c8d9e7\',\n    },\n  },\n  {\n    name: \'石墨\',\n    value: {\n      bgStart: \'#2a2d33\',\n      bgEnd: \'#1e2126\',\n      surface: \'#333741\',\n      surfaceAlt: \'#3b404b\',\n      text: \'#f3f5f8\',\n      textMuted: \'#c1c7d0\',\n      accent: \'#9aa6b2\',\n      accentStrong: \'#e0e5ea\',\n      border: \'#4b5261\',\n    },\n  },\n] as const;\nconst manageDetails = computed(() => {\n  const details: ManageDetail[] = [];\n  const profile = manageProfile.value;\n  if (manageCard.value?.origin === \'library\' && manageCard.value.importFileName) {\n    details.push({ label: \'导入文件名\', value: manageCard.value.importFileName });\n  }\n  const pushDetail = (label: string, value: string, maxChars = 240) => {\n    const preview = previewDetailText(value, 3, maxChars);\n    if (preview) {\n      details.push({ label, value: preview });\n    }\n  };\n  if (profile) {\n    pushDetail(\'角色描述\', profile.description ?? \'\');\n    pushDetail(\'性格\', profile.personality ?? \'\');\n    pushDetail(\'场景\', profile.scenario ?? \'\');\n    pushDetail(\'创作者备注\', profile.creatorNotes ?? \'\');\n    pushDetail(\'系统提示\', profile.systemPrompt ?? \'\', 200);\n    pushDetail(\'历史指令\', profile.postHistory ?? \'\', 200);\n    pushDetail(\'作者\', profile.creator ?? \'\', 80);\n  }\n  return details;\n});\n\nconst manageDetailsHint = computed(() => {\n  if (!manageCard.value || manageDetails.value.length) {\n    return \'\';\n  }\n  if (manageCard.value.origin === \'library\') {\n    return \'未导入卡片暂无可预览内容，可先导入后查看详情。\';\n  }\n  return \'暂无角色卡详情。\';\n});\n\nconst manageChatHint = computed(() => {\n  if (manageCard.value?.origin === \'library\') {\n    return \'未导入卡片暂无聊天记录。\';\n  }\n  return \'暂无聊天记录。\';\n});\nconst manageOverview = computed(() => {\n  const items: ManageOverviewItem[] = [];\n  const profile = manageProfile.value;\n  const worldName = profile?.worldBookName?.trim() || \'\';\n  const worldCount = profile?.worldBookCount;\n  let worldValue = \'未绑定\';\n  let worldHint = \'\';\n  if (worldName || typeof worldCount === \'number\') {\n    worldValue = worldName || \'角色世界书\';\n    worldHint = typeof worldCount === \'number\' ? `${worldCount} 条` : \'\';\n  }\n  items.push({ label: \'世界书\', value: worldValue, hint: worldHint });\n\n  const chat = manageChatSummary.value;\n  let chatValue = \'暂无聊天\';\n  let chatHint = \'\';\n  if (chat && chat.total > 0) {\n    chatValue = `${chat.total} 个聊天`;\n    if (chat.latest) {\n      chatHint = `最近：${chat.latest}`;\n    }\n  }\n  items.push({ label: \'聊天概况\', value: chatValue, hint: chatHint });\n\n  const opening = manageOpeningSummary.value;\n  let openingValue = \'暂无开场白\';\n  let openingHint = \'\';\n  if (opening && opening.total > 0) {\n    openingValue = `${opening.total} 条`;\n    openingHint = opening.alternate > 0 ? `替代：${opening.alternate} 条` : \'无替代\';\n  }\n  items.push({ label: \'开场白\', value: openingValue, hint: openingHint });\n  return items;\n});\n\nconst filteredCharacters = computed(() => {\n  const list = applyFavoriteFilter(applyStatusFilter(allCards.value));\n  const keyword = state.search.trim().toLowerCase();\n  if (!keyword) {\n    return sortCards(applyTagFilter(list));\n  }\n  return sortCards(\n    applyTagFilter(list).filter(character => {\n      const name = character.name.toLowerCase();\n      if (name.includes(keyword)) {\n        return true;\n      }\n      const tags = mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n      return tags.some(tag => tag.toLowerCase().includes(keyword));\n    }),\n  );\n});\n\nconst totalPages = computed(() => {\n  const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n  return total > 0 ? total : 1;\n});\n\nconst pagedCharacters = computed(() => {\n  const start = (currentPage.value - 1) * pageSize.value;\n  return filteredCharacters.value.slice(start, start + pageSize.value);\n});\n\nconst allTags = computed(() => {\n  const tagSet = new Set<string>();\n  allCards.value.forEach(character => {\n    (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).forEach(tag => tagSet.add(tag));\n  });\n  selectedTags.value.forEach(tag => tagSet.add(tag));\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, \'zh-CN\'));\n});\n\nfunction avatarUrl(character: CardHubItem, useFull = false): string | null {\n  const avatar = character.avatar;\n  if (!avatar) {\n    return null;\n  }\n  if (/^(data:|https?:|\\/)/.test(avatar)) {\n    return avatar;\n  }\n  if (useFull && character.origin === \'tavern\') {\n    return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n  }\n  return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n}\n\nfunction avatarStyle(character: CardHubItem): Record<string, string> {\n  const url = avatarUrl(character);\n  return url ? { backgroundImage: `url(${url})` } : {};\n}\n\nfunction displayTags(character: CardHubItem): string[] {\n  return mergedTagsMap.value.get(character.id) ?? getMergedTags(character);\n}\n\nfunction applyFavoriteFilter(list: CardHubItem[]): CardHubItem[] {\n  if (!favoritesOnly.value) {\n    return list;\n  }\n  return list.filter(item => favoriteSet.value.has(item.id));\n}\n\nfunction getFavoriteList(): string[] {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  const raw = vars?.[FAVORITES_KEY];\n  return Array.isArray(raw) ? raw.filter(item => typeof item === \'string\') : [];\n}\n\nfunction saveFavoriteList(list: string[]) {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  TavernHelper.replaceVariables({ type: \'global\' }, { ...vars, [FAVORITES_KEY]: list });\n}\n\nfunction loadLastChatCache(): Record<string, number> {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  const raw = vars?.[LAST_CHAT_CACHE_KEY];\n  if (!raw || typeof raw !== \'object\') {\n    return {};\n  }\n  const entries = Object.entries(raw as Record<string, unknown>).filter(\n    ([, value]) => typeof value === \'number\' && !Number.isNaN(value),\n  );\n  return Object.fromEntries(entries) as Record<string, number>;\n}\n\nfunction saveLastChatCache(cache: Record<string, number>) {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  TavernHelper.replaceVariables({ type: \'global\' }, { ...vars, [LAST_CHAT_CACHE_KEY]: cache });\n}\n\nfunction loadImportCache(): Record<string, number> {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  const raw = vars?.[IMPORT_CACHE_KEY];\n  if (!raw || typeof raw !== \'object\') {\n    return {};\n  }\n  const entries = Object.entries(raw as Record<string, unknown>).filter(\n    ([, value]) => typeof value === \'number\' && !Number.isNaN(value),\n  );\n  return Object.fromEntries(entries) as Record<string, number>;\n}\n\nfunction saveImportCache(cache: Record<string, number>) {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  TavernHelper.replaceVariables({ type: \'global\' }, { ...vars, [IMPORT_CACHE_KEY]: cache });\n}\n\nfunction getChatCacheKey(card: CardHubItem): string | null {\n  if (card.origin !== \'tavern\') {\n    return null;\n  }\n  if (card.avatar) {\n    return `avatar:${card.avatar}`;\n  }\n  if (card.name) {\n    return `name:${card.name}`;\n  }\n  return null;\n}\n\nfunction getImportAt(card: CardHubItem): number {\n  if (typeof card.createdAt === \'number\' && card.createdAt > 0) {\n    return card.createdAt;\n  }\n  const key = getChatCacheKey(card);\n  return key ? (importCache.value[key] ?? 0) : 0;\n}\n\nfunction getLastChatAt(card: CardHubItem): number {\n  if (typeof card.lastChatAt === \'number\' && card.lastChatAt > 0) {\n    return card.lastChatAt;\n  }\n  const key = getChatCacheKey(card);\n  return key ? (lastChatCache.value[key] ?? 0) : 0;\n}\n\nfunction updateLastChatCache(key: string, timestamp: number) {\n  const next = { ...lastChatCache.value, [key]: timestamp };\n  lastChatCache.value = next;\n  saveLastChatCache(next);\n}\n\nfunction updateLastChatCacheForCard(card: CardHubItem, timestamp: number) {\n  if (timestamp <= 0 || card.origin !== \'tavern\') {\n    return;\n  }\n  const keys = new Set<string>();\n  if (card.avatar) {\n    keys.add(`avatar:${card.avatar}`);\n  }\n  if (card.name) {\n    keys.add(`name:${card.name}`);\n  }\n  if (!keys.size) {\n    return;\n  }\n  const next = { ...lastChatCache.value };\n  let changed = false;\n  keys.forEach(key => {\n    if ((next[key] ?? 0) < timestamp) {\n      next[key] = timestamp;\n      changed = true;\n    }\n  });\n  if (changed) {\n    lastChatCache.value = next;\n    saveLastChatCache(next);\n  }\n}\nfunction updateImportCache(next: Record<string, number>) {\n  importCache.value = next;\n  saveImportCache(next);\n}\n\nfunction isFavorite(id: string): boolean {\n  return favoriteSet.value.has(id);\n}\n\nfunction toggleFavorite(card: CardHubItem) {\n  if (favoriteSet.value.has(card.id)) {\n    favoriteIds.value = favoriteIds.value.filter(item => item !== card.id);\n  } else {\n    favoriteIds.value = [...favoriteIds.value, card.id];\n  }\n  saveFavoriteList(favoriteIds.value);\n}\n\nfunction sortCards(list: CardHubItem[]): CardHubItem[] {\n  const withScore = list.map(item => {\n    const tags = mergedTagsMap.value.get(item.id) ?? getMergedTags(item);\n    return {\n      item,\n      tagCount: tags.length,\n    };\n  });\n  const byName = (a: string, b: string) => a.localeCompare(b, \'zh-CN\');\n\n  return withScore\n    .sort((lhs, rhs) => {\n      const a = lhs.item;\n      const b = rhs.item;\n      if (sortKey.value === \'name\') {\n        return byName(a.name, b.name);\n      }\n      if (sortKey.value === \'tags\') {\n        if (rhs.tagCount !== lhs.tagCount) {\n          return rhs.tagCount - lhs.tagCount;\n        }\n        return byName(a.name, b.name);\n      }\n      if (sortKey.value === \'imported\') {\n        const aTime = getImportAt(a);\n        const bTime = getImportAt(b);\n        if (bTime !== aTime) {\n          return bTime - aTime;\n        }\n        return byName(a.name, b.name);\n      }\n      const aTime = getLastChatAt(a);\n      const bTime = getLastChatAt(b);\n      if (bTime !== aTime) {\n        return bTime - aTime;\n      }\n      const aCreated = a.createdAt ?? 0;\n      const bCreated = b.createdAt ?? 0;\n      if (bCreated !== aCreated) {\n        return bCreated - aCreated;\n      }\n      return byName(a.name, b.name);\n    })\n    .map(entry => entry.item);\n}\n\nconst manageAvatarUrl = computed(() => {\n  if (!manageCard.value) {\n    return null;\n  }\n  return avatarUrl(manageCard.value, true);\n});\n\nfunction isLibraryItem(item: CardHubItem): boolean {\n  if (item.origin === \'library\' || Boolean(item.rawType)) {\n    return true;\n  }\n  return state.library.some(entry => entry.id === item.id);\n}\n\nfunction applyStatusFilter(list: CardHubItem[]): CardHubItem[] {\n  if (statusFilter.value === \'imported\') {\n    return list.filter(item => !isLibraryItem(item));\n  }\n  if (statusFilter.value === \'unimported\') {\n    return list.filter(item => isLibraryItem(item));\n  }\n  return list;\n}\n\nfunction applyTagFilter(list: CardHubItem[]): CardHubItem[] {\n  if (!selectedTags.value.length) {\n    return list;\n  }\n  return list.filter(character =>\n    selectedTags.value.some(tag => (mergedTagsMap.value.get(character.id) ?? getMergedTags(character)).includes(tag)),\n  );\n}\n\nfunction toggleTagFilter(tag: string) {\n  if (selectedTags.value.includes(tag)) {\n    selectedTags.value = selectedTags.value.filter(item => item !== tag);\n  } else {\n    selectedTags.value = [...selectedTags.value, tag];\n  }\n}\n\nfunction clearTagFilter() {\n  selectedTags.value = [];\n}\n\nfunction openTagManager(tab: \'filter\' | \'batch\' = \'filter\') {\n  if (tab === \'batch\') {\n    if (!batchTagVisibleCandidates.value.length) {\n      toastr.warning(\'当前没有可操作的角色卡\');\n      return;\n    }\n    batchTagInput.value = \'\';\n    batchTagSearch.value = \'\';\n    batchTagSelectedTags.value = [];\n    batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n  }\n  tagManagerTab.value = tab;\n  tagManagerOpen.value = true;\n}\n\nfunction closeTagManager() {\n  tagManagerOpen.value = false;\n}\n\nfunction hexToRgb(value: string): string {\n  const hex = value.replace(\'#\', \'\');\n  if (hex.length !== 6) {\n    return \'0, 0, 0\';\n  }\n  const r = Number.parseInt(hex.slice(0, 2), 16);\n  const g = Number.parseInt(hex.slice(2, 4), 16);\n  const b = Number.parseInt(hex.slice(4, 6), 16);\n  return `${r}, ${g}, ${b}`;\n}\n\nfunction contrastTextColor(value: string): string {\n  const rgb = hexToRgb(value)\n    .split(\',\')\n    .map(part => Number(part.trim()));\n  if (rgb.length !== 3) {\n    return \'#1b1b1b\';\n  }\n  const [r, g, b] = rgb.map(channel => channel / 255);\n  const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  return luminance > 0.6 ? \'#1b1b1b\' : \'#ffffff\';\n}\n\nfunction normalizeTheme(raw: unknown): CardHubTheme {\n  if (!raw || typeof raw !== \'object\') {\n    return { ...defaultTheme };\n  }\n  const data = raw as Record<string, string>;\n  const pick = (key: keyof CardHubTheme) => {\n    const value = data[key];\n    return /^#[0-9a-f]{6}$/i.test(value) ? value : defaultTheme[key];\n  };\n  return {\n    bgStart: pick(\'bgStart\'),\n    bgEnd: pick(\'bgEnd\'),\n    surface: pick(\'surface\'),\n    surfaceAlt: pick(\'surfaceAlt\'),\n    text: pick(\'text\'),\n    textMuted: pick(\'textMuted\'),\n    accent: pick(\'accent\'),\n    accentStrong: pick(\'accentStrong\'),\n    border: pick(\'border\'),\n  };\n}\n\nfunction getCardHubRoot(): HTMLElement | null {\n  try {\n    return (window.parent?.document ?? document).querySelector<HTMLElement>(\'.cardhub-root\');\n  } catch {\n    return document.querySelector<HTMLElement>(\'.cardhub-root\');\n  }\n}\n\nlet themeFrame = 0;\nlet themeTimer: number | null = null;\nfunction scheduleThemeApply(theme: CardHubTheme) {\n  if (themeFrame) {\n    cancelAnimationFrame(themeFrame);\n    themeFrame = 0;\n  }\n  if (themeTimer) {\n    window.clearTimeout(themeTimer);\n  }\n  themeTimer = window.setTimeout(() => {\n    themeTimer = null;\n    themeFrame = requestAnimationFrame(() => {\n      themeFrame = 0;\n      applyTheme(theme);\n    });\n  }, 80);\n}\n\nfunction applyTheme(theme: CardHubTheme) {\n  const root = getCardHubRoot();\n  if (!root) {\n    return;\n  }\n  root.style.setProperty(\'--cardhub-bg-start\', theme.bgStart);\n  root.style.setProperty(\'--cardhub-bg-end\', theme.bgEnd);\n  root.style.setProperty(\'--cardhub-surface\', theme.surface);\n  root.style.setProperty(\'--cardhub-surface-alt\', theme.surfaceAlt);\n  root.style.setProperty(\'--cardhub-text\', theme.text);\n  root.style.setProperty(\'--cardhub-text-muted\', theme.textMuted);\n  root.style.setProperty(\'--cardhub-accent\', theme.accent);\n  root.style.setProperty(\'--cardhub-accent-strong\', theme.accentStrong);\n  root.style.setProperty(\'--cardhub-border\', theme.border);\n  root.style.setProperty(\'--cardhub-surface-rgb\', hexToRgb(theme.surface));\n  root.style.setProperty(\'--cardhub-surface-alt-rgb\', hexToRgb(theme.surfaceAlt));\n  root.style.setProperty(\'--cardhub-border-rgb\', hexToRgb(theme.border));\n  root.style.setProperty(\'--cardhub-accent-rgb\', hexToRgb(theme.accent));\n  root.style.setProperty(\'--cardhub-accent-strong-rgb\', hexToRgb(theme.accentStrong));\n  root.style.setProperty(\'--cardhub-accent-text\', contrastTextColor(theme.accent));\n  root.style.setProperty(\'--cardhub-accent-strong-text\', contrastTextColor(theme.accentStrong));\n}\n\nfunction loadThemeFromGlobal(): CardHubTheme {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  return normalizeTheme(vars?.[THEME_KEY]);\n}\n\nfunction saveThemeToGlobal(theme: CardHubTheme) {\n  const vars = TavernHelper.getVariables({ type: \'global\' }) as Record<string, unknown>;\n  TavernHelper.replaceVariables({ type: \'global\' }, { ...vars, [THEME_KEY]: theme });\n}\n\nfunction openThemeDialog() {\n  const current = themeCurrent.value;\n  Object.assign(themeDraft, current);\n  themeDialogOpen.value = true;\n  nextTick(() => scheduleThemeApply(current));\n}\n\nfunction closeThemeDialog() {\n  themeDialogOpen.value = false;\n  Object.assign(themeDraft, themeCurrent.value);\n  scheduleThemeApply(themeCurrent.value);\n}\n\nfunction resetThemeDraft() {\n  Object.assign(themeDraft, defaultTheme);\n}\n\nfunction saveThemeDraft() {\n  themeCurrent.value = { ...themeDraft };\n  saveThemeToGlobal(themeCurrent.value);\n  scheduleThemeApply(themeCurrent.value);\n  themeDialogOpen.value = false;\n}\n\nfunction applyThemePreset(preset: { name: string; value: CardHubTheme }) {\n  Object.assign(themeDraft, preset.value);\n}\nfunction toggleExportTagFilter(tag: string) {\n  if (exportTagFilters.value.includes(tag)) {\n    exportTagFilters.value = exportTagFilters.value.filter(item => item !== tag);\n  } else {\n    exportTagFilters.value = [...exportTagFilters.value, tag];\n  }\n}\n\nfunction clearExportTagFilter() {\n  exportTagFilters.value = [];\n}\n\nfunction openExportDialog() {\n  if (!exportVisibleCandidates.value.length) {\n    toastr.warning(\'当前没有可导出的角色卡\');\n    return;\n  }\n  exportSelectedIds.value = exportVisibleCandidates.value.map(item => item.id);\n  exportDialogOpen.value = true;\n}\n\nwatch(\n  themeDraft,\n  value => {\n    if (themeDialogOpen.value) {\n      scheduleThemeApply({ ...(value as CardHubTheme) });\n    }\n  },\n  { deep: true },\n);\n\nonMounted(() => {\n  const theme = loadThemeFromGlobal();\n  themeCurrent.value = theme;\n  Object.assign(themeDraft, theme);\n  nextTick(() => scheduleThemeApply(theme));\n  favoriteIds.value = getFavoriteList();\n  lastChatCache.value = loadLastChatCache();\n  importCache.value = loadImportCache();\n  void warmRecentChatCache(allCards.value);\n  warmImportCache(allCards.value);\n});\n\nfunction closeExportDialog() {\n  exportDialogOpen.value = false;\n}\n\nfunction toggleBatchTagSelection(id: string) {\n  if (batchTagSelectedSet.value.has(id)) {\n    batchTagSelectedIds.value = batchTagSelectedIds.value.filter(item => item !== id);\n  } else {\n    batchTagSelectedIds.value = [...batchTagSelectedIds.value, id];\n  }\n}\n\nfunction selectAllBatchTags() {\n  batchTagSelectedIds.value = batchTagVisibleCandidates.value.map(item => item.id);\n}\n\nfunction clearBatchTagSelection() {\n  batchTagSelectedIds.value = [];\n}\n\nfunction parseBatchTags(input: string, selected: string[]): string[] {\n  const items = input\n    .split(/[,，\\n;；、]/)\n    .map(part => part.trim())\n    .filter(Boolean);\n  return Array.from(new Set([...items, ...selected]));\n}\n\nfunction getCardsByIds(ids: string[]): CardHubItem[] {\n  const map = new Map(allCards.value.map(card => [card.id, card]));\n  return ids.map(id => map.get(id)).filter(Boolean) as CardHubItem[];\n}\n\nfunction toggleBatchTagSuggestion(tag: string) {\n  if (batchTagSelectedTags.value.includes(tag)) {\n    batchTagSelectedTags.value = batchTagSelectedTags.value.filter(item => item !== tag);\n  } else {\n    batchTagSelectedTags.value = [...batchTagSelectedTags.value, tag];\n  }\n}\n\nfunction isSameTagSet(current: string[], next: string[]): boolean {\n  if (current.length !== next.length) {\n    return false;\n  }\n  const currentSet = new Set(current);\n  return next.every(tag => currentSet.has(tag));\n}\n\nasync function applyBatchTags(mode: \'add\' | \'remove\') {\n  if (!batchTagSelectedIds.value.length) {\n    toastr.warning(\'请先选择要操作的角色卡\');\n    return;\n  }\n  const tags = parseBatchTags(batchTagInput.value, batchTagSelectedTags.value);\n  if (!tags.length) {\n    toastr.warning(\'请输入要操作的标签\');\n    return;\n  }\n  const actionLabel = mode === \'add\' ? \'添加\' : \'移除\';\n  const message = `将${actionLabel}标签：${tags.join(\'、\')}\\n应用到 ${batchTagSelectedIds.value.length} 张角色卡，是否继续？`;\n  const result = await openConfirm({\n    title: `批量${actionLabel}标签`,\n    message,\n    confirmLabel: `继续${actionLabel}`,\n    cancelLabel: \'取消\',\n  });\n  if (result !== \'confirm\') {\n    return;\n  }\n  const cards = getCardsByIds(batchTagSelectedIds.value);\n  let changed = 0;\n  cards.forEach(card => {\n    const currentTags = displayTags(card);\n    const nextSet = new Set(currentTags);\n    if (mode === \'add\') {\n      tags.forEach(tag => nextSet.add(tag));\n    } else {\n      tags.forEach(tag => nextSet.delete(tag));\n    }\n    const nextTags = Array.from(nextSet);\n    if (!isSameTagSet(currentTags, nextTags)) {\n      applyTagUpdate(card, nextTags);\n      changed += 1;\n    }\n  });\n  toastr.success(`已处理 ${changed} 张角色卡`);\n}\n\nfunction isExportSelected(id: string): boolean {\n  return exportSelectedSet.value.has(id);\n}\n\nfunction toggleExportSelection(id: string) {\n  if (exportSelectedSet.value.has(id)) {\n    exportSelectedIds.value = exportSelectedIds.value.filter(item => item !== id);\n  } else {\n    exportSelectedIds.value = [...exportSelectedIds.value, id];\n  }\n}\n\nfunction selectAllExport() {\n  exportSelectedIds.value = exportCandidates.value.map(item => item.id);\n}\n\nfunction clearExportSelection() {\n  exportSelectedIds.value = [];\n}\n\nwatch([() => state.search, statusFilter, () => selectedTags.value.join(\'|\'), sortKey, favoritesOnly], () => {\n  currentPage.value = 1;\n});\n\nwatch([filteredCharacters, totalPages], () => {\n  if (currentPage.value > totalPages.value) {\n    currentPage.value = totalPages.value;\n  }\n  if (currentPage.value < 1) {\n    currentPage.value = 1;\n  }\n});\n\nwatch([sortKey, allCards], () => {\n  if (sortKey.value === \'recent\') {\n    void warmRecentChatCache(allCards.value);\n  }\n  if (sortKey.value === \'imported\') {\n    warmImportCache(allCards.value);\n  }\n});\n\nfunction prevPage() {\n  if (currentPage.value > 1) {\n    currentPage.value -= 1;\n  }\n}\n\nfunction nextPage() {\n  if (currentPage.value < totalPages.value) {\n    currentPage.value += 1;\n  }\n}\n\nfunction normalizeNameKey(value: string): string {\n  return value.trim().toLocaleLowerCase();\n}\n\nfunction normalizeAvatarKey(value: string): string {\n  let raw = value.trim();\n  if (!raw) {\n    return \'\';\n  }\n  try {\n    raw = decodeURIComponent(raw);\n  } catch {\n    // ignore\n  }\n  raw = raw.split(\'?\')[0];\n  if (raw.includes(\'/\')) {\n    raw = raw.split(\'/\').pop() ?? raw;\n  }\n  return raw.trim().toLowerCase();\n}\n\nfunction findDuplicateCharacterByName(name: string): CardHubItem | null {\n  const target = normalizeNameKey(name);\n  if (!target) {\n    return null;\n  }\n  return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\n}\n\nfunction openConfirm(options: ConfirmOptions): Promise<ConfirmResult> {\n  if (confirmState.open && confirmState.resolve) {\n    confirmState.resolve(\'cancel\');\n  }\n  confirmState.title = options.title ?? \'确认操作\';\n  confirmState.message = options.message;\n  confirmState.confirmLabel = options.confirmLabel ?? \'确定\';\n  confirmState.cancelLabel = options.cancelLabel ?? \'取消\';\n  confirmState.altLabel = options.altLabel ?? \'\';\n  confirmState.open = true;\n\n  return new Promise(resolve => {\n    confirmState.resolve = resolve;\n  });\n}\n\nfunction resolveConfirm(result: ConfirmResult) {\n  if (!confirmState.open) {\n    return;\n  }\n  confirmState.open = false;\n  const resolver = confirmState.resolve;\n  confirmState.resolve = null;\n  if (resolver) {\n    resolver(result);\n  }\n}\n\nfunction removeTag(character: CardHubItem, tag: string) {\n  const nextTags = getMergedTags(character).filter(item => item !== tag);\n  applyTagUpdate(character, nextTags);\n}\n\nfunction tagKey(character: CardHubItem): string {\n  return character.id;\n}\n\nfunction startTagEdit(character: CardHubItem) {\n  activeTagKey.value = tagKey(character);\n  tagInput.value = \'\';\n  nextTick(() => {\n    const input = document.querySelector<HTMLInputElement>(\'.cardhub-tag-input\');\n    input?.focus();\n  });\n}\n\nfunction confirmTag(character: CardHubItem) {\n  if (activeTagKey.value !== tagKey(character)) {\n    return;\n  }\n  const input = tagInput.value.trim();\n  if (input) {\n    const nextTags = [...getMergedTags(character), input];\n    applyTagUpdate(character, nextTags);\n  }\n  cancelTagEdit();\n}\n\nfunction cancelTagEdit() {\n  activeTagKey.value = null;\n  tagInput.value = \'\';\n}\n\nfunction applyTagUpdate(character: CardHubItem, nextTags: string[]) {\n  if (isLibraryItem(character)) {\n    const updatedLibrary = updateLibraryTags(character.id, nextTags, state.library);\n    setLibrary(updatedLibrary);\n  } else {\n    const next = updateCharacterTags(character, nextTags);\n    character.tags = next;\n    setCharacters([...state.characters]);\n  }\n}\n\nfunction triggerImport() {\n  importInput.value?.click();\n}\n\nasync function handleImportFiles(event: Event) {\n  const target = event.target as HTMLInputElement | null;\n  const files = target?.files;\n  if (!files || !files.length) {\n    return;\n  }\n  const updated = await addToLibrary(files, state.library);\n  setLibrary(updated);\n  target.value = \'\';\n}\n\nasync function exportSelected() {\n  openExportDialog();\n}\n\nasync function confirmExportSelected() {\n  const list = exportSelectedItems.value;\n  if (!list.length) {\n    toastr.warning(\'请选择要导出的角色卡\');\n    return;\n  }\n  const tagLabel = selectedTags.value.length ? selectedTags.value.join(\'、\') : \'无\';\n  const statusLabel = statusFilter.value === \'all\' ? \'全部\' : statusFilter.value === \'imported\' ? \'已导入\' : \'未导入\';\n  const searchLabel = state.search.trim() || \'无\';\n  const message =\n    `将导出 ${list.length} 张角色卡。\\n` +\n    `筛选状态：${statusLabel}\\n` +\n    `筛选标签：${tagLabel}\\n` +\n    `搜索关键字：${searchLabel}\\n` +\n    `是否继续？`;\n\n  const result = await openConfirm({\n    title: \'批量导出\',\n    message,\n    confirmLabel: \'继续导出\',\n    cancelLabel: \'取消\',\n  });\n  if (result !== \'confirm\') {\n    return;\n  }\n  exportDialogOpen.value = false;\n  for (const item of list) {\n    await exportCard(item);\n    await sleep(120);\n  }\n  toastr.success(`批量导出完成，共 ${list.length} 张`);\n}\n\nasync function handleCardAction(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await importLibraryCard(card);\n  } else {\n    exportCard(card);\n  }\n}\n\nasync function importLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'缺少导入数据\');\n    return;\n  }\n  const duplicate = findDuplicateCharacterByName(card.name);\n  if (duplicate) {\n    toastr.warning(`已存在同名角色「${duplicate.name}」，已跳过导入`);\n    return;\n  }\n  const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\n  delete (headers as Record<string, string>)[\'Content-Type\'];\n\n  const beforeCharacters = await fetchCharacterSummaries();\n  const beforeAvatarKeys = new Set(beforeCharacters.map(item => normalizeAvatarKey(item.avatar ?? \'\')).filter(Boolean));\n\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    await TavernHelper.importRawCharacter(card.name, blob);\n  } else {\n    const file = new File([card.raw], `${card.name}.json`, { type: \'application/json\' });\n    const form = new FormData();\n    form.append(\'avatar\', file);\n    form.append(\'file_type\', \'json\');\n    form.append(\'preserved_name\', file.name);\n    await fetch(\'/api/characters/import\', {\n      method: \'POST\',\n      headers,\n      body: form,\n      cache: \'no-cache\',\n    });\n  }\n\n  const characters = await fetchCharacterSummaries();\n  const expectedNames = new Set([card.name]);\n  if (card.rawType === \'json\') {\n    try {\n      const parsed = JSON.parse(card.raw) as { name?: string; data?: { name?: string } };\n      if (parsed?.name) {\n        expectedNames.add(parsed.name);\n      }\n      if (parsed?.data?.name) {\n        expectedNames.add(parsed.data.name);\n      }\n    } catch {\n      // ignore invalid json name parsing\n    }\n  }\n  const matchedByAvatar = characters.find(item => {\n    const avatarKey = normalizeAvatarKey(item.avatar ?? \'\');\n    return avatarKey && !beforeAvatarKeys.has(avatarKey);\n  });\n  const matchedByName = characters.find(item =>\n    Array.from(expectedNames).some(name => normalizeNameKey(item.name) === normalizeNameKey(name)),\n  );\n  const importedCard = matchedByAvatar ?? matchedByName ?? null;\n  if (importedCard) {\n    setLibrary(removeFromLibrary(card.id));\n    const rawTags = card.tags?.length ? card.tags : extractCardTagsFromData(parseLibraryCardData(card));\n    if (rawTags.length) {\n      const cleanedTags = updateCharacterTags(importedCard, rawTags);\n      importedCard.tags = cleanedTags;\n    }\n    toastr.success(`已导入 ${card.name}`);\n  } else {\n    toastr.warning(`导入完成但未在角色列表中找到「${card.name}」，已保留未导入记录`);\n  }\n  setCharacters(characters);\n}\n\nasync function exportCard(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await exportLibraryCard(card);\n    return;\n  }\n  if (!card.avatar) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  downloadBlob(blob, `${card.name}.png`);\n}\n\nasync function exportLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'无法导出：缺少原始数据\');\n    return;\n  }\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    downloadBlob(blob, `${card.name}.png`);\n    return;\n  }\n  const blob = new Blob([card.raw], { type: \'application/json\' });\n  downloadBlob(blob, `${card.name}.json`);\n}\n\nasync function openManage(card: CardHubItem) {\n  const requestId = ++manageRequestId;\n  manageCard.value = card;\n  manageOpenings.value = [];\n  manageChats.value = [];\n  manageProfile.value = null;\n  manageOpeningSummary.value = null;\n  manageChatSummary.value = null;\n\n  const [manageResult, chatsResult] = await Promise.allSettled([resolveManageData(card), resolveRecentChats(card)]);\n\n  if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n    return;\n  }\n\n  const manageData: ManageData =\n    manageResult.status === \'fulfilled\' ? manageResult.value : { openings: [], profile: null, openingSummary: null };\n  manageOpenings.value = manageData.openings;\n  manageProfile.value = manageData.profile;\n  manageOpeningSummary.value = manageData.openingSummary;\n\n  const chatData: ManageChatData = chatsResult.status === \'fulfilled\' ? chatsResult.value : { list: [], summary: null };\n  manageChats.value = chatData.list;\n  manageChatSummary.value = chatData.summary;\n}\n\nfunction closeManage() {\n  manageCard.value = null;\n  manageOpenings.value = [];\n  manageChats.value = [];\n  manageProfile.value = null;\n  manageOpeningSummary.value = null;\n  manageChatSummary.value = null;\n}\n\nasync function resolveManageData(card: CardHubItem): Promise<ManageData> {\n  if (card.origin !== \'tavern\') {\n    const data = parseLibraryCardData(card);\n    return {\n      openings: extractOpeningMessages(data),\n      profile: extractCardProfile(data),\n      openingSummary: extractOpeningSummary(data),\n    };\n  }\n  const raw = await getFullCharacterData(card);\n  const fallback =\n    raw ??\n    TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true } as any) ??\n    TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true } as any);\n  const primary = raw ?? fallback;\n  let openings = extractOpeningMessages(primary);\n  if (!openings.length && fallback && fallback !== primary) {\n    openings = extractOpeningMessages(fallback);\n  }\n  const openingSummary = extractOpeningSummary(primary ?? fallback);\n  return {\n    openings,\n    profile: extractCardProfile(primary ?? fallback),\n    openingSummary,\n  };\n}\n\nfunction parseLibraryCardData(card: CardHubItem): any | null {\n  if (!card.raw || !card.rawType) {\n    return null;\n  }\n  if (card.rawType === \'json\') {\n    return parseJsonSafe(card.raw);\n  }\n  if (card.rawType === \'png\') {\n    return parsePngCardData(card.raw);\n  }\n  return null;\n}\n\nfunction parseJsonSafe(raw: string): any | null {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nfunction parsePngCardData(dataUrl: string): any | null {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return null;\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set([\'chara\', \'character\', \'tavern\', \'tavern_character\', \'card\']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    if (parsed) {\n      return parsed;\n    }\n  }\n  return null;\n}\n\nfunction dataUrlToBytes(dataUrl: string): Uint8Array | null {\n  const comma = dataUrl.indexOf(\',\');\n  if (comma < 0) {\n    return null;\n  }\n  const base64 = dataUrl.slice(comma + 1);\n  try {\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n  } catch {\n    return null;\n  }\n}\n\nfunction extractPngTextChunks(bytes: Uint8Array): Array<{ key: string; value: string }> {\n  if (bytes.length < 8) {\n    return [];\n  }\n  const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n  for (let i = 0; i < signature.length; i += 1) {\n    if (bytes[i] !== signature[i]) {\n      return [];\n    }\n  }\n  const chunks: Array<{ key: string; value: string }> = [];\n  let offset = 8;\n  while (offset + 8 <= bytes.length) {\n    const length = readUint32BE(bytes, offset);\n    const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n    const dataStart = offset + 8;\n    const dataEnd = dataStart + length;\n    if (dataEnd + 4 > bytes.length) {\n      break;\n    }\n    const data = bytes.subarray(dataStart, dataEnd);\n    if (type === \'tEXt\') {\n      const entry = parseTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    } else if (type === \'iTXt\') {\n      const entry = parseIntlTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    }\n    offset = dataEnd + 4;\n  }\n  return chunks;\n}\n\nfunction parseTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseIntlTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const compressed = data[nullIndex + 1] === 1;\n  let cursor = nullIndex + 2;\n  const langEnd = data.indexOf(0, cursor);\n  if (langEnd < 0) {\n    return null;\n  }\n  cursor = langEnd + 1;\n  const translatedEnd = data.indexOf(0, cursor);\n  if (translatedEnd < 0) {\n    return null;\n  }\n  cursor = translatedEnd + 1;\n  if (compressed) {\n    return null;\n  }\n  const value = bytesToString(data.subarray(cursor)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseCardPayload(value: string): any | null {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n  const direct = parseJsonSafe(trimmed);\n  if (direct) {\n    return direct;\n  }\n  if (!isLikelyBase64(trimmed)) {\n    return null;\n  }\n  const decoded = decodeBase64Text(trimmed);\n  if (!decoded) {\n    return null;\n  }\n  return parseJsonSafe(decoded);\n}\n\nfunction decodeBase64Text(value: string): string | null {\n  try {\n    const binary = atob(value);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return new TextDecoder().decode(bytes);\n  } catch {\n    return null;\n  }\n}\n\nfunction isLikelyBase64(value: string): boolean {\n  if (value.length < 16 || value.length % 4 !== 0) {\n    return false;\n  }\n  return /^[A-Za-z0-9+/=]+$/.test(value);\n}\n\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\n  return ((bytes[offset] << 24) | (bytes[offset + 1] << 16) | (bytes[offset + 2] << 8) | bytes[offset + 3]) >>> 0;\n}\n\nfunction bytesToString(bytes: Uint8Array): string {\n  return new TextDecoder().decode(bytes);\n}\n\nasync function getFullCharacterData(card: CardHubItem): Promise<SillyTavern.v1CharData | null> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  if (ctx?.getCharacters) {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色卡列表失败\', error);\n    }\n  }\n  const list = ctx?.characters ?? st?.characters ?? [];\n  if (!list.length) {\n    return null;\n  }\n  const byAvatar = card.avatar ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar) : -1;\n  const byName = list.findIndex(item => item.name === card.name);\n  const idx = byAvatar >= 0 ? byAvatar : byName;\n  if (idx < 0) {\n    return null;\n  }\n  if (ctx?.unshallowCharacter) {\n    try {\n      await ctx.unshallowCharacter(idx);\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡详情失败\', error);\n    }\n  }\n  const updatedList = ctx?.characters ?? list;\n  const data = updatedList[idx] ?? null;\n  if (data?.first_mes || data?.data?.first_mes) {\n    return data;\n  }\n  if (ctx?.getCharacterCardFields) {\n    try {\n      const fields = await ctx.getCharacterCardFields({ chid: idx });\n      if (fields?.first_mes || fields?.data?.first_mes) {\n        return fields;\n      }\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡字段失败\', error);\n    }\n  }\n  const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n  return fallback ?? data;\n}\n\nfunction extractCardProfile(data: any): ManageProfile | null {\n  if (!data) {\n    return null;\n  }\n  const profile: ManageProfile = {\n    description: pickString(data?.description, data?.data?.description),\n    personality: pickString(data?.personality, data?.data?.personality),\n    scenario: pickString(data?.scenario, data?.data?.scenario),\n    creatorNotes: pickString(\n      data?.creatorcomment,\n      data?.data?.creatorcomment,\n      data?.creator_notes,\n      data?.data?.creator_notes,\n    ),\n    systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n    postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n    creator: pickString(data?.creator, data?.data?.creator),\n  };\n  const book = data?.character_book ?? data?.data?.character_book;\n  if (book) {\n    profile.worldBookName = pickString(book?.name);\n    profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n  }\n  const hasValue =\n    Boolean(profile.description) ||\n    Boolean(profile.personality) ||\n    Boolean(profile.scenario) ||\n    Boolean(profile.creatorNotes) ||\n    Boolean(profile.systemPrompt) ||\n    Boolean(profile.postHistory) ||\n    Boolean(profile.creator) ||\n    Boolean(profile.worldBookName) ||\n    typeof profile.worldBookCount === \'number\';\n  return hasValue ? profile : null;\n}\n\nfunction extractCardTagsFromData(data: any): string[] {\n  const tags = data?.tags ?? data?.data?.tags;\n  if (!Array.isArray(tags)) {\n    return [];\n  }\n  return tags\n    .filter(tag => typeof tag === \'string\')\n    .map(tag => tag.trim())\n    .filter(Boolean);\n}\n\nfunction pickString(...values: unknown[]): string {\n  for (const value of values) {\n    if (typeof value === \'string\') {\n      const trimmed = value.trim();\n      if (trimmed) {\n        return trimmed;\n      }\n    }\n  }\n  return \'\';\n}\n\nfunction extractOpeningSummary(data: any): ManageOpeningSummary | null {\n  if (!data) {\n    return null;\n  }\n  const first = typeof data?.first_mes === \'string\' ? data.first_mes : data?.data?.first_mes;\n  const firstCount = typeof first === \'string\' && first.trim() ? 1 : 0;\n  const alt =\n    data?.alternate_greetings ??\n    data?.data?.alternate_greetings ??\n    data?.extensions?.alternate_greetings ??\n    data?.data?.extensions?.alternate_greetings;\n  let alternate = 0;\n  if (Array.isArray(alt)) {\n    alternate = alt.filter(item => typeof item === \'string\' && item.trim()).length;\n  } else if (typeof alt === \'string\' && alt.trim()) {\n    alternate = 1;\n  }\n  return {\n    total: firstCount + alternate,\n    alternate,\n  };\n}\n\nfunction extractOpeningMessages(data: any): string[] {\n  if (!data) {\n    return [];\n  }\n  const list: string[] = [];\n  const first = typeof data?.first_mes === \'string\' ? data.first_mes : data?.data?.first_mes;\n  if (typeof first === \'string\' && first.trim()) {\n    list.push(first.trim());\n  }\n  const alt =\n    data?.alternate_greetings ??\n    data?.data?.alternate_greetings ??\n    data?.extensions?.alternate_greetings ??\n    data?.data?.extensions?.alternate_greetings;\n  if (Array.isArray(alt)) {\n    alt.forEach(item => {\n      if (typeof item === \'string\' && item.trim()) {\n        list.push(item.trim());\n      }\n    });\n  } else if (typeof alt === \'string\' && alt.trim()) {\n    list.push(alt.trim());\n  }\n  return list;\n}\n\nfunction normalizeBriefMessage(value: string): string {\n  return value\n    .replace(/<br\\s*\\/?>/gi, \' \')\n    .replace(/<[^>]+>/g, \' \')\n    .replace(/\\s+/g, \' \')\n    .trim();\n}\n\nfunction formatMaybeTimestamp(value: unknown): string {\n  if (typeof value === \'number\' && !Number.isNaN(value)) {\n    const ms = value < 1e12 ? value * 1000 : value;\n    return new Date(ms).toLocaleString(\'zh-CN\', { hour12: false });\n  }\n  if (typeof value === \'string\') {\n    const trimmed = value.trim();\n    if (trimmed) {\n      return trimmed;\n    }\n  }\n  return \'\';\n}\n\nfunction parseTimestampFromText(raw: string): number | null {\n  const text = raw.replace(/\\.jsonl$/i, \'\').trim();\n  const pattern = /(\\d{4})[./-](\\d{1,2})[./-](\\d{1,2})(?:[ T_@-]*(\\d{1,2})[:：](\\d{1,2})(?:[:：](\\d{1,2}))?)?/;\n  const match = text.match(pattern);\n  if (!match) {\n    return null;\n  }\n  const year = Number(match[1]);\n  const month = Number(match[2]);\n  const day = Number(match[3]);\n  const hour = match[4] ? Number(match[4]) : 0;\n  const minute = match[5] ? Number(match[5]) : 0;\n  const second = match[6] ? Number(match[6]) : 0;\n  if (!year || !month || !day) {\n    return null;\n  }\n  const date = new Date(year, month - 1, day, hour, minute, second);\n  const time = date.getTime();\n  return Number.isNaN(time) ? null : time;\n}\n\nfunction coerceTimestamp(value: unknown): number | null {\n  if (typeof value === \'number\' && !Number.isNaN(value)) {\n    return value < 1e12 ? value * 1000 : value;\n  }\n  if (typeof value === \'string\') {\n    const parsed = Date.parse(value);\n    if (!Number.isNaN(parsed)) {\n      return parsed;\n    }\n  }\n  return null;\n}\n\nfunction extractChatLatestTimestamp(entry: any): number | null {\n  const candidates = [\n    entry?.last_message_time,\n    entry?.last_message_date,\n    entry?.update_time,\n    entry?.last_modified,\n    entry?.create_date,\n    entry?.timestamp,\n    entry?.time,\n  ];\n  for (const value of candidates) {\n    const parsed = coerceTimestamp(value);\n    if (parsed) {\n      return parsed;\n    }\n  }\n  const fallback = pickString(entry?.file_name, entry?.file_id);\n  if (fallback) {\n    return parseTimestampFromText(fallback);\n  }\n  return null;\n}\n\nfunction sortChatBrief(list: any[]): any[] {\n  return [...list].sort((lhs, rhs) => {\n    const left = extractChatLatestTimestamp(lhs) ?? 0;\n    const right = extractChatLatestTimestamp(rhs) ?? 0;\n    return right - left;\n  });\n}\n\nfunction extractChatLatestLabel(entry: any): string {\n  const candidates = [\n    entry?.last_message_time,\n    entry?.last_message_date,\n    entry?.update_time,\n    entry?.last_modified,\n    entry?.create_date,\n    entry?.timestamp,\n    entry?.time,\n  ];\n  for (const value of candidates) {\n    const label = formatMaybeTimestamp(value);\n    if (label) {\n      return label;\n    }\n  }\n  const fallback = pickString(entry?.file_name, entry?.file_id);\n  if (!fallback) {\n    return \'\';\n  }\n  return fallback.replace(/\\.jsonl$/i, \'\');\n}\n\nlet chatCacheToken = 0;\nasync function warmRecentChatCache(cards: CardHubItem[]) {\n  if (sortKey.value !== \'recent\') {\n    return;\n  }\n  const pending = cards.filter(card => {\n    if (card.origin !== \'tavern\') {\n      return false;\n    }\n    if (typeof card.lastChatAt === \'number\' && card.lastChatAt > 0) {\n      return false;\n    }\n    return getLastChatAt(card) <= 0;\n  });\n  if (!pending.length) {\n    return;\n  }\n  const token = ++chatCacheToken;\n  for (const card of pending) {\n    if (token !== chatCacheToken || sortKey.value !== \'recent\') {\n      return;\n    }\n    if (card.origin !== \'tavern\') {\n      continue;\n    }\n    if (typeof card.lastChatAt === \'number\' && card.lastChatAt > 0) {\n      continue;\n    }\n    const cached = getLastChatAt(card);\n    let brief: unknown = null;\n    try {\n      brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? \'\', true);\n    } catch (error) {\n      console.warn(\'[CardHub] 读取聊天简报失败\', error);\n    }\n    if (Array.isArray(brief) && brief.length) {\n      const sorted = sortChatBrief(brief);\n      const timestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n      if (timestamp > cached) {\n        updateLastChatCacheForCard(card, timestamp);\n      }\n    }\n    await sleep(80);\n  }\n}\n\nfunction warmImportCache(cards: CardHubItem[]) {\n  const next = { ...importCache.value };\n  let changed = false;\n  const now = Date.now();\n  cards.forEach((card, index) => {\n    if (card.origin !== \'tavern\') {\n      return;\n    }\n    if (typeof card.createdAt === \'number\' && card.createdAt > 0) {\n      return;\n    }\n    const key = getChatCacheKey(card);\n    if (!key || next[key]) {\n      return;\n    }\n    next[key] = now - (cards.length - 1 - index) * 1000;\n    changed = true;\n  });\n  if (changed) {\n    updateImportCache(next);\n  }\n}\n\nfunction formatChatTitle(entry: any): string {\n  const label = extractChatLatestLabel(entry);\n  return label || \'聊天记录\';\n}\n\nfunction formatChatFileLabel(entry: any): string {\n  const raw = pickString(entry?.file_name, entry?.file_id);\n  if (!raw) {\n    return \'\';\n  }\n  return raw.replace(/\\.jsonl$/i, \'\');\n}\n\nfunction previewDetailText(text: string, maxLines: number, maxChars: number): string {\n  const trimmed = text.replace(/\\r/g, \'\').trim();\n  if (!trimmed) {\n    return \'\';\n  }\n  const lines = extractContentLines(trimmed);\n  const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n  let preview = source.slice(0, maxLines).join(\'\\n\').trim();\n  if (!preview) {\n    return \'\';\n  }\n  const truncated = preview.length > maxChars;\n  if (truncated) {\n    preview = preview.slice(0, maxChars).trim();\n  }\n  const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n  if (hasMore && !preview.endsWith(\'…\')) {\n    preview = `${preview}…`;\n  }\n  return preview;\n}\n\nfunction previewOpenings(openings: string[], maxItems: number): string[] {\n  return openings\n    .map(opening => previewOpeningLines(opening, 2).join(\'\\n\'))\n    .filter(preview => preview.trim().length > 0)\n    .slice(0, maxItems);\n}\n\nfunction previewOpeningLines(text: string, maxLines: number): string[] {\n  const trimmed = text.replace(/\\r/g, \'\').trim();\n  if (!trimmed) {\n    return [];\n  }\n  const contentLines = extractContentLines(trimmed);\n  if (contentLines.length >= maxLines) {\n    return contentLines.slice(0, maxLines);\n  }\n  const normalized = normalizeBriefMessage(trimmed);\n  if (!normalized) {\n    return contentLines.slice(0, maxLines);\n  }\n  const chunks = chunkText(normalized, 60);\n  if (!contentLines.length) {\n    return chunks.slice(0, maxLines);\n  }\n  const combined = [...contentLines];\n  for (const chunk of chunks) {\n    if (combined.length >= maxLines) {\n      break;\n    }\n    if (combined[0] !== chunk) {\n      combined.push(chunk);\n    }\n  }\n  return combined.slice(0, maxLines);\n}\n\nfunction extractContentLines(text: string): string[] {\n  const lines = text\n    .split(\'\\n\')\n    .map(part => part.trim())\n    .filter(part => part.length > 0);\n  const filtered: string[] = [];\n  for (const line of lines) {\n    if (line.startsWith(\'```\')) {\n      continue;\n    }\n    if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n      continue;\n    }\n    filtered.push(line);\n  }\n  return filtered;\n}\n\nfunction chunkText(text: string, size: number): string[] {\n  const chunks: string[] = [];\n  for (let i = 0; i < text.length; i += size) {\n    const chunk = text.slice(i, i + size).trim();\n    if (chunk) {\n      chunks.push(chunk);\n    }\n  }\n  return chunks;\n}\n\nasync function resolveRecentChats(card: CardHubItem): Promise<ManageChatData> {\n  if (card.origin !== \'tavern\') {\n    return { list: [], summary: null };\n  }\n  const brief = await TavernHelper.getChatHistoryBrief(card.name ?? card.avatar ?? \'\', true);\n  if (!Array.isArray(brief) || !brief.length) {\n    return { list: [], summary: { total: 0, latest: \'\' } };\n  }\n  const sorted = sortChatBrief(brief);\n  const latestTimestamp = extractChatLatestTimestamp(sorted[0]) ?? 0;\n  updateLastChatCacheForCard(card, latestTimestamp);\n  const list = sorted.slice(0, 3).map((entry: any) => ({\n    name: formatChatTitle(entry),\n    label: formatChatFileLabel(entry),\n    file: String(entry?.file_name ?? entry?.file_id ?? \'\'),\n    mes: normalizeBriefMessage(String(entry?.mes ?? \'\')).slice(0, 120),\n  }));\n  const latest = extractChatLatestLabel(sorted[0]);\n  return {\n    list,\n    summary: {\n      total: brief.length,\n      latest,\n    },\n  };\n}\n\nasync function openLatestChat() {\n  if (!manageChats.value.length) {\n    toastr.warning(\'暂无聊天记录\');\n    return;\n  }\n  await openChat(manageChats.value[0]);\n}\n\nasync function openNewChat() {\n  const selection = await selectManageCharacter({ ensureSelected: true });\n  if (!selection) {\n    return;\n  }\n  try {\n    await triggerSlash(\'/newchat\');\n    closeManage();\n    close();\n  } catch (error) {\n    console.warn(\'[CardHub] 新聊天失败\', error);\n    toastr.error(\'无法创建新聊天\');\n  }\n}\n\nasync function openChat(chat: { file: string }) {\n  const file = chat.file;\n  if (!file) {\n    toastr.warning(\'未找到聊天文件\');\n    return;\n  }\n  const selection = await selectManageCharacter({ ensureSelected: true });\n  if (!selection) {\n    return;\n  }\n  const { ctx, st } = selection;\n  const target = normalizeChatId(file);\n  const opener =\n    (ctx && typeof ctx.openCharacterChat === \'function\' ? ctx.openCharacterChat : null) ??\n    (st && typeof st.openCharacterChat === \'function\' ? st.openCharacterChat : null);\n  if (!opener) {\n    toastr.error(\'无法打开聊天：缺少接口\');\n    return;\n  }\n  try {\n    void Promise.resolve(opener(target)).catch(error => {\n      console.warn(\'[CardHub] 打开聊天失败\', error);\n    });\n  } catch (error) {\n    console.warn(\'[CardHub] 打开聊天失败\', error);\n  }\n  const opened = await waitForChatOpen(target, ctx, st, 6000);\n  if (opened) {\n    closeManage();\n    close();\n    return;\n  }\n  toastr.warning(\'未能打开聊天，可能需要先手动切到该角色\');\n}\n\nasync function selectManageCharacter(\n  options: { ensureSelected?: boolean } = {},\n): Promise<{ ctx: any; st: typeof SillyTavern | undefined; idx: number } | null> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === \'function\') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色列表失败\', error);\n    }\n  }\n  const list = ctx?.characters ?? st?.characters ?? [];\n  const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n  if (idx < 0) {\n    toastr.warning(\'未找到角色索引，请先手动切到该角色后再试\');\n    return null;\n  }\n  const selector =\n    (ctx && typeof ctx.selectCharacterById === \'function\' ? ctx.selectCharacterById : null) ??\n    (st && typeof st.selectCharacterById === \'function\' ? st.selectCharacterById : null);\n  if (!selector) {\n    toastr.warning(\'无法切换角色，请先手动切到该角色后再试\');\n    return null;\n  }\n  try {\n    await selector(idx, { switchMenu: false });\n  } catch (error) {\n    console.warn(\'[CardHub] 切换角色失败\', error);\n  }\n  const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n  if (options.ensureSelected && !selected) {\n    toastr.warning(\'角色切换未完成，请稍后再试\');\n    return null;\n  }\n  return { ctx, st, idx };\n}\n\nasync function waitForCharacterSelection(\n  idx: number,\n  ctx: any,\n  st: typeof SillyTavern | undefined,\n  timeoutMs: number,\n): Promise<boolean> {\n  const target = String(idx);\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const current = getCurrentCharacterId(ctx, st);\n    if (current === target) {\n      return true;\n    }\n    await sleep(80);\n  }\n  return false;\n}\n\nfunction getCurrentCharacterId(ctx: any, st: typeof SillyTavern | undefined): string {\n  const value = ctx?.characterId ?? st?.characterId ?? \'\';\n  return value === undefined || value === null ? \'\' : String(value);\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\n  const targetName = normalizeNameKey(card.name);\n  const targetAvatar = card.avatar ? normalizeAvatarKey(card.avatar) : \'\';\n  const byAvatar = targetAvatar\n    ? list.findIndex(item => normalizeAvatarKey(String(item.avatar ?? \'\')) === targetAvatar)\n    : -1;\n  if (byAvatar >= 0) {\n    return byAvatar;\n  }\n  const byName = list.findIndex(item => normalizeNameKey(String(item.name ?? \'\')) === targetName);\n  if (byName >= 0) {\n    return byName;\n  }\n  return list.findIndex(item => normalizeNameKey(String(item?.data?.name ?? \'\')) === targetName);\n}\n\nfunction normalizeChatId(id: string): string {\n  return id.endsWith(\'.jsonl\') ? id : `${id}.jsonl`;\n}\n\nasync function waitForChatOpen(\n  file: string,\n  ctx: any,\n  st: typeof SillyTavern | undefined,\n  timeoutMs: number,\n): Promise<boolean> {\n  const target = normalizeChatId(file);\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const current = ctx?.chatId ?? st?.chatId;\n    if (current === target) {\n      return true;\n    }\n    await new Promise(resolve => setTimeout(resolve, 200));\n  }\n  return false;\n}\n\nasync function manageDelete(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    const confirmDelete = await openConfirm({\n      title: \'删除角色\',\n      message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n      confirmLabel: \'删除\',\n      cancelLabel: \'取消\',\n    });\n    if (confirmDelete !== \'confirm\') {\n      return;\n    }\n    setLibrary(removeFromLibrary(card.id));\n    closeManage();\n    return;\n  }\n\n  const confirmDelete = await openConfirm({\n    title: \'删除角色\',\n    message: `确定要删除「${card.name}」吗？`,\n    confirmLabel: \'继续\',\n    cancelLabel: \'取消\',\n  });\n  if (confirmDelete !== \'confirm\') {\n    return;\n  }\n  const deleteChoice = await openConfirm({\n    title: \'删除方式\',\n    message: `删除「${card.name}」：\\n` + `- 移到私有库：可在私有库中找回\\n` + `- 永久删除：不可恢复`,\n    confirmLabel: \'移到私有库\',\n    altLabel: \'永久删除\',\n    cancelLabel: \'取消\',\n  });\n  if (deleteChoice === \'cancel\') {\n    return;\n  }\n  if (deleteChoice === \'confirm\') {\n    await moveToLibrary(card);\n    const deleted = await deleteFromTavern(card, false);\n    if (!deleted) {\n      return;\n    }\n    closeManage();\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    return;\n  }\n  const confirmPermanent = await openConfirm({\n    title: \'永久删除\',\n    message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n    confirmLabel: \'永久删除\',\n    cancelLabel: \'取消\',\n  });\n  if (confirmPermanent !== \'confirm\') {\n    return;\n  }\n  const deleted = await deleteFromTavern(card, true);\n  if (!deleted) {\n    return;\n  }\n  closeManage();\n  const characters = await fetchCharacterSummaries();\n  setCharacters(characters);\n}\n\nasync function moveToLibrary(card: CardHubItem) {\n  if (!card.avatar) {\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  const updated = await addToLibrary([new File([blob], `${card.name}.png`, { type: \'image/png\' })]);\n  setLibrary(updated);\n}\n\nasync function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\n  if (!card.avatar) {\n    toastr.error(\'删除失败：缺少头像信息\');\n    return false;\n  }\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  const list = ctx?.characters ?? st?.characters ?? [];\n  const targetIdx = findCharacterIndex(list, card);\n  const currentId = getCurrentCharacterId(ctx, st);\n  const deletingActive = targetIdx >= 0 && currentId && String(targetIdx) === String(currentId);\n  if (deletingActive) {\n    if (list.length > 1) {\n      const nextIdx = targetIdx === 0 ? 1 : 0;\n      const selector =\n        (ctx && typeof ctx.selectCharacterById === \'function\' ? ctx.selectCharacterById : null) ??\n        (st && typeof st.selectCharacterById === \'function\' ? st.selectCharacterById : null);\n      if (selector) {\n        try {\n          await selector(nextIdx, { switchMenu: false });\n          await waitForCharacterSelection(nextIdx, ctx, st, 3000);\n        } catch (error) {\n          console.warn(\'[CardHub] 删除前切换角色失败\', error);\n        }\n      }\n    } else {\n      toastr.warning(\'当前角色为唯一角色，删除后酒馆可能需要刷新\');\n    }\n  }\n  const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\n    | Record<string, string>\n    | undefined;\n  if (!headers || !Object.keys(headers).length) {\n    toastr.error(\'删除失败：无法获取请求头\');\n    return false;\n  }\n  const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n  const response = await fetch(\'/api/characters/delete\', {\n    method: \'POST\',\n    headers: { ...headers, \'Content-Type\': \'application/json\' },\n    body: JSON.stringify(payload),\n    cache: \'no-cache\',\n  });\n  if (response.ok) {\n    try {\n      await triggerSlash(\'/closechat\');\n    } catch (error) {\n      console.warn(\'[CardHub] 关闭聊天失败\', error);\n    }\n    return true;\n  }\n  const detail = await response.text();\n  toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n  return false;\n}\n\nfunction downloadBlob(blob: Blob, fileName: string) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = fileName;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nasync function dataUrlToBlob(dataUrl: string): Promise<Blob> {\n  const response = await fetch(dataUrl);\n  return await response.blob();\n}\n\nasync function refresh() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nfunction close() {\n  setOpen(false);\n}\n<\/script>\n\n<style scoped>\n.cardhub-root {\n  position: fixed;\n  inset: 0;\n  z-index: 9999;\n  font-family: \'ZCOOL XiaoWei\', \'STSong\', \'Songti SC\', \'SimSun\', serif;\n  color: #1b1b1b;\n  display: none;\n  align-items: center;\n  justify-content: center;\n}\n\n.cardhub-root.open {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.cardhub-backdrop {\n  position: absolute;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(6px);\n  opacity: 0;\n  transition: opacity 180ms ease;\n}\n\n.cardhub-root.open .cardhub-backdrop {\n  opacity: 1;\n}\n\n.cardhub-panel {\n  position: relative;\n  width: min(980px, 94%);\n  max-height: 92%;\n  background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n  border-radius: 28px;\n  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  z-index: 1;\n  opacity: 0;\n  transform: translateY(8px) scale(0.985);\n  transition:\n    opacity 180ms ease,\n    transform 180ms ease;\n}\n\n.cardhub-root.open .cardhub-panel {\n  opacity: 1;\n  transform: translateY(0) scale(1);\n}\n\n.cardhub-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 20px 24px;\n  border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n}\n\n.cardhub-title__main {\n  font-size: 26px;\n  letter-spacing: 2px;\n}\n\n.cardhub-title__sub {\n  font-size: 12px;\n  color: #7d5b46;\n  margin-left: 10px;\n}\n\n.cardhub-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.cardhub-close {\n  border: none;\n  background: rgba(43, 32, 24, 0.12);\n  color: #3b2a20;\n  width: 34px;\n  height: 34px;\n  border-radius: 999px;\n  font-size: 20px;\n  line-height: 34px;\n  text-align: center;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-close:hover {\n  background: rgba(43, 32, 24, 0.2);\n}\n\n.cardhub-close:active {\n  transform: scale(0.96);\n}\n\n.cardhub-toolbar {\n  display: flex;\n  gap: 8px;\n  padding: 12px 20px;\n  flex-wrap: wrap;\n}\n\n.cardhub-search {\n  flex: 1;\n  min-width: 180px;\n  border-radius: 999px;\n  border: 1px solid rgba(86, 59, 44, 0.2);\n  padding: 6px 12px;\n  background: #fffaf4;\n}\n\n.cardhub-button {\n  border: none;\n  padding: 6px 14px;\n  border-radius: 999px;\n  background: #d46b3d;\n  color: #fff;\n  cursor: pointer;\n  font-size: 12px;\n  transition:\n    background-color 160ms ease,\n    transform 120ms ease,\n    box-shadow 160ms ease;\n}\n\n.cardhub-button:hover {\n  background: #c55f36;\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-button:active {\n  transform: translateY(1px);\n}\n\n.cardhub-button.is-ghost {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-button.is-ghost:hover {\n  background: rgba(106, 63, 42, 0.08);\n  border-color: rgba(106, 63, 42, 0.6);\n  box-shadow: none;\n}\n\n.cardhub-import-input {\n  display: none;\n}\n\n.cardhub-body {\n  display: grid;\n  grid-template-columns: minmax(160px, 220px) 1fr;\n  gap: 0;\n  flex: 1;\n  min-height: 0;\n}\n\n.cardhub-sidebar {\n  padding: 20px;\n  border-right: 1px solid rgba(86, 59, 44, 0.15);\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  overflow: auto;\n  min-height: 0;\n}\n\n.cardhub-chip-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-divider {\n  height: 1px;\n  width: 100%;\n  background: rgba(86, 59, 44, 0.15);\n  margin: 8px 0;\n}\n\n.cardhub-section-title {\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-chip {\n  text-align: left;\n  border: none;\n  background: rgba(255, 255, 255, 0.6);\n  border-radius: 12px;\n  padding: 8px 10px;\n  cursor: pointer;\n  font-size: 12px;\n  transition:\n    background-color 160ms ease,\n    color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-chip:not(.is-active):hover {\n  background: rgba(255, 255, 255, 0.9);\n  transform: translateY(-1px);\n}\n\n.cardhub-placeholder {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-tag-filter {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-tag-filter__chip {\n  border: 1px solid rgba(106, 63, 42, 0.25);\n  background: rgba(255, 255, 255, 0.7);\n  border-radius: 999px;\n  padding: 6px 10px;\n  font-size: 12px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    color 160ms ease,\n    border-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-tag-filter__chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n  border-color: transparent;\n}\n\n.cardhub-tag-filter__chip:not(.is-active):hover {\n  border-color: rgba(106, 63, 42, 0.45);\n  background: rgba(255, 255, 255, 0.9);\n  transform: translateY(-1px);\n}\n\n.cardhub-chip--clear {\n  margin-top: 8px;\n}\n\n.cardhub-chip--more {\n  margin-top: 4px;\n}\n\n.cardhub-content {\n  padding: 20px;\n  overflow: auto;\n  flex: 1;\n  min-height: 0;\n}\n\n.cardhub-grid-wrap {\n  display: grid;\n  gap: 12px;\n}\n\n.cardhub-pagination {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n\n.cardhub-pagination__status {\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-pagination__actions {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  margin-right: auto;\n}\n\n.cardhub-pagination__button {\n  border: 1px solid rgba(106, 63, 42, 0.35);\n  background: rgba(255, 255, 255, 0.85);\n  color: #6a3f2a;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    border-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-pagination__button:disabled {\n  opacity: 0.4;\n  cursor: default;\n}\n\n.cardhub-pagination__button:not(:disabled):hover {\n  background: rgba(255, 255, 255, 1);\n  border-color: rgba(106, 63, 42, 0.6);\n  transform: translateY(-1px);\n}\n\n.cardhub-pagination__button:not(:disabled):active {\n  transform: translateY(0);\n}\n\n.cardhub-loading,\n.cardhub-empty {\n  padding: 40px 0;\n  text-align: center;\n  color: #7d5b46;\n}\n\n.cardhub-grid {\n  display: grid;\n  gap: 14px;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  justify-items: center;\n}\n\n.cardhub-card {\n  background: rgba(255, 255, 255, 0.78);\n  border-radius: 18px;\n  padding: 14px;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  gap: 12px;\n  align-items: center;\n  border: 1px solid rgba(86, 59, 44, 0.15);\n  cursor: pointer;\n  transition:\n    transform 140ms ease,\n    box-shadow 180ms ease,\n    border-color 180ms ease;\n  width: 100%;\n  max-width: 260px;\n}\n\n.cardhub-card:hover {\n  transform: translateY(-2px);\n  border-color: rgba(86, 59, 44, 0.25);\n  box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\n}\n\n.cardhub-card:active {\n  transform: translateY(0);\n}\n\n.cardhub-card__avatar {\n  width: 42px;\n  height: 42px;\n  border-radius: 12px;\n  background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n  background-size: cover;\n  background-position: center;\n  color: #4a2a1f;\n  display: grid;\n  place-items: center;\n  font-weight: 700;\n}\n\n.cardhub-card__avatar.has-avatar span {\n  display: none;\n}\n\n.cardhub-card__info {\n  min-width: 0;\n}\n\n.cardhub-card__head {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.cardhub-card__name {\n  font-size: 14px;\n  font-weight: 600;\n  min-width: 0;\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.cardhub-card__meta {\n  display: flex;\n  gap: 8px;\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-card__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-top: 8px;\n  align-items: center;\n}\n\n.cardhub-tag {\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fff6ea;\n  border-radius: 999px;\n  padding: 4px 8px;\n  font-size: 11px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    border-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-tag:hover {\n  background: #fffaf4;\n  border-color: rgba(106, 63, 42, 0.5);\n  transform: translateY(-1px);\n}\n\n.cardhub-tag__remove {\n  margin-left: 4px;\n  font-weight: 700;\n}\n\n.cardhub-tag.is-add {\n  background: transparent;\n  border-style: dashed;\n}\n\n.cardhub-tag-edit {\n  min-width: 0;\n  max-width: 100%;\n}\n\n.cardhub-tag-input {\n  border: 1px dashed rgba(106, 63, 42, 0.5);\n  background: #fffaf4;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  min-width: 80px;\n  max-width: 100%;\n  color: #6a3f2a;\n  outline: none;\n  height: 24px;\n  line-height: 16px;\n}\n\n.cardhub-tag-input:focus {\n  border-color: rgba(106, 63, 42, 0.85);\n}\n\n.cardhub-card__action {\n  grid-column: span 2;\n  margin-top: 10px;\n  border: none;\n  background: #2b2018;\n  color: #fff5ea;\n  padding: 6px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition:\n    transform 120ms ease,\n    box-shadow 160ms ease,\n    background-color 160ms ease;\n}\n\n.cardhub-card__actions {\n  grid-column: span 2;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  margin-top: 10px;\n}\n\n.cardhub-card__action.is-secondary {\n  background: #d9c6b6;\n  color: #3b2a20;\n}\n\n.cardhub-card__action:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n}\n\n.cardhub-card__action:active {\n  transform: translateY(0);\n}\n\n.cardhub-preview {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100000;\n}\n\n.cardhub-preview__panel {\n  width: min(520px, 92vw);\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 20px;\n  position: relative;\n  display: grid;\n  gap: 14px;\n}\n\n.cardhub-preview__close {\n  position: absolute;\n  top: 14px;\n  right: 14px;\n  border: none;\n  width: 30px;\n  height: 30px;\n  border-radius: 999px;\n  background: rgba(43, 32, 24, 0.15);\n  color: #3b2a20;\n  font-size: 18px;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-preview__close:hover {\n  background: rgba(43, 32, 24, 0.25);\n}\n\n.cardhub-preview__close:active {\n  transform: scale(0.96);\n}\n\n.cardhub-preview__avatar {\n  width: 100%;\n  height: 260px;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-preview__avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n\n.cardhub-preview__info {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-preview__name {\n  font-size: 20px;\n  font-weight: 700;\n}\n\n.cardhub-preview__meta {\n  display: flex;\n  gap: 10px;\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-preview__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-preview__tag {\n  padding: 6px 10px;\n  border-radius: 999px;\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fffaf4;\n  font-size: 12px;\n  color: #6a3f2a;\n}\n\n.cardhub-preview__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n\n.cardhub-manage {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100001;\n}\n\n.cardhub-manage__panel {\n  width: min(760px, 94vw);\n  max-height: 88vh;\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 22px;\n  position: relative;\n  display: grid;\n  gap: 16px;\n  overflow: auto;\n  overflow-x: hidden;\n}\n\n.cardhub-manage__top {\n  display: grid;\n  grid-template-columns: 1fr auto;\n  gap: 16px;\n  align-items: start;\n}\n\n.cardhub-manage__media {\n  width: 220px;\n  aspect-ratio: 3 / 4;\n  height: auto;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-manage__media img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.cardhub-manage__summary {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-manage__overview {\n  display: grid;\n  gap: 10px;\n  margin-top: 10px;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n}\n\n.cardhub-manage__overview-card {\n  background: rgba(255, 255, 255, 0.7);\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 14px;\n  padding: 10px 12px;\n  display: grid;\n  gap: 4px;\n}\n\n.cardhub-manage__overview-label {\n  font-size: 10px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__overview-value {\n  font-size: 13px;\n  font-weight: 600;\n  color: #3b2a20;\n}\n\n.cardhub-manage__overview-hint {\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-manage__section {\n  display: grid;\n  gap: 8px;\n}\n\n.cardhub-manage__details {\n  display: grid;\n  gap: 12px;\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n}\n\n.cardhub-manage__detail {\n  background: #fffaf4;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 16px;\n  padding: 12px 14px;\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-manage__detail-label {\n  font-size: 11px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__detail-content {\n  font-size: 12px;\n  line-height: 1.5;\n  color: #3b2a20;\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n  word-break: break-word;\n}\n\n.cardhub-manage__label {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__btn {\n  border: none;\n  border-radius: 12px;\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  text-transform: none;\n  transition:\n    background-color 160ms ease,\n    transform 120ms ease,\n    box-shadow 160ms ease;\n}\n\n.cardhub-manage__btn.is-primary {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-manage__btn.is-secondary {\n  background: #d9c6b6;\n  color: #3b2a20;\n}\n\n.cardhub-manage__jump-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  align-items: center;\n}\n\n.cardhub-manage__btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n}\n\n.cardhub-manage__btn.is-primary:hover {\n  background: #241a14;\n}\n\n.cardhub-manage__btn.is-secondary:hover {\n  background: #d1bca8;\n}\n\n.cardhub-manage__btn:active {\n  transform: translateY(0);\n}\n\n.cardhub-manage__content {\n  background: #fffaf4;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 16px;\n  padding: 12px 14px;\n  font-size: 12px;\n  line-height: 1.5;\n  color: #3b2a20;\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n  word-break: break-word;\n}\n\n.cardhub-manage__opening {\n  padding: 6px 0;\n  border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n}\n\n.cardhub-manage__opening:last-child {\n  border-bottom: none;\n}\n\n.cardhub-manage__chat {\n  display: grid;\n  gap: 10px;\n}\n\n.cardhub-manage__chat-row {\n  display: grid;\n  grid-template-columns: minmax(140px, 220px) 1fr;\n  gap: 12px;\n  font-size: 12px;\n  color: #3b2a20;\n  align-items: start;\n  padding: 6px 8px;\n  border-radius: 10px;\n  cursor: pointer;\n}\n\n.cardhub-manage__chat-row:hover {\n  background: rgba(106, 63, 42, 0.08);\n}\n\n.cardhub-manage__chat-main {\n  display: grid;\n  gap: 4px;\n}\n\n.cardhub-manage__chat-name {\n  flex: 0 0 auto;\n  font-weight: 600;\n  color: #6a3f2a;\n  word-break: break-word;\n}\n\n.cardhub-manage__chat-label {\n  font-size: 11px;\n  color: #9a7a63;\n  word-break: break-word;\n}\n\n.cardhub-manage__chat-text {\n  color: #3b2a20;\n  line-height: 1.5;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  overflow-wrap: anywhere;\n  word-break: break-word;\n}\n\n.cardhub-manage__empty {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-manage__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n\n.cardhub-confirm {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.55);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 200000;\n}\n\n.cardhub-confirm__panel {\n  width: min(460px, 92vw);\n  background: #fff6ea;\n  border-radius: 22px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 18px 20px;\n  display: grid;\n  gap: 12px;\n}\n\n.cardhub-confirm__title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #2b2018;\n}\n\n.cardhub-confirm__message {\n  font-size: 13px;\n  line-height: 1.5;\n  color: #4a2a1f;\n  white-space: pre-wrap;\n}\n\n.cardhub-confirm__actions {\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n  flex-wrap: wrap;\n}\n\n.cardhub-confirm__button {\n  border: none;\n  border-radius: 999px;\n  padding: 8px 14px;\n  font-size: 12px;\n  cursor: pointer;\n  transition:\n    transform 120ms ease,\n    box-shadow 160ms ease,\n    background-color 160ms ease,\n    border-color 160ms ease;\n}\n\n.cardhub-confirm__button.is-confirm {\n  background: #d46b3d;\n  color: #fff;\n}\n\n.cardhub-confirm__button.is-cancel {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-confirm__button.is-danger {\n  background: #b6452a;\n  color: #fff;\n}\n\n.cardhub-confirm__button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-confirm__button:active {\n  transform: translateY(0);\n}\n\n.cardhub-tag-manager {\n  position: absolute;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.55);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100003;\n}\n\n.cardhub-tag-manager__panel {\n  width: min(700px, 92vw);\n  max-height: 82vh;\n  background: #fff6ea;\n  border-radius: 22px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 18px 20px;\n  display: grid;\n  gap: 12px;\n  overflow: hidden;\n  grid-template-rows: auto auto 1fr;\n  position: relative;\n}\n\n.cardhub-theme__panel {\n  position: relative;\n}\n\n.cardhub-tag-manager__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n.cardhub-tag-manager__title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #2b2018;\n}\n\n.cardhub-tag-manager__subtitle {\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-tag-manager__tabs {\n  display: flex;\n  gap: 8px;\n}\n\n.cardhub-tag-manager__tab {\n  border: 1px solid rgba(106, 63, 42, 0.25);\n  background: rgba(255, 255, 255, 0.8);\n  border-radius: 999px;\n  padding: 6px 12px;\n  font-size: 12px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    border-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-tag-manager__tab.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n  border-color: transparent;\n}\n\n.cardhub-tag-manager__tab:not(.is-active):hover {\n  background: rgba(255, 255, 255, 1);\n  transform: translateY(-1px);\n}\n\n.cardhub-tag-manager__section {\n  display: grid;\n  gap: 12px;\n  min-height: 0;\n}\n\n.cardhub-tag-manager__actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.cardhub-tag-manager__spacer {\n  flex: 1;\n}\n\n.cardhub-tag-manager__btn {\n  border: none;\n  border-radius: 999px;\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition:\n    transform 120ms ease,\n    box-shadow 160ms ease,\n    background-color 160ms ease;\n}\n\n.cardhub-tag-manager__btn.is-primary {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-tag-manager__btn.is-secondary {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-tag-manager__btn:disabled {\n  opacity: 0.5;\n  cursor: default;\n}\n\n.cardhub-tag-manager__btn:not(:disabled):hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-tag-manager__list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  overflow: auto;\n  padding-right: 4px;\n}\n\n.cardhub-tag-manager__chip {\n  border: 1px solid rgba(106, 63, 42, 0.25);\n  background: rgba(255, 255, 255, 0.75);\n  border-radius: 999px;\n  padding: 6px 10px;\n  font-size: 12px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition:\n    background-color 160ms ease,\n    color 160ms ease,\n    border-color 160ms ease,\n    transform 120ms ease;\n}\n\n.cardhub-tag-manager__chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n  border-color: transparent;\n}\n\n.cardhub-tag-manager__chip:hover {\n  transform: translateY(-1px);\n}\n\n.cardhub-tag-manager__batch {\n  display: grid;\n  grid-template-rows: auto auto auto auto 1fr;\n  min-height: 0;\n}\n\n.cardhub-tag-manager__batch .cardhub-batch__list {\n  max-height: none;\n  min-height: 0;\n  overflow: auto;\n}\n\n.cardhub-export {\n  position: absolute;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.55);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100003;\n}\n\n.cardhub-export__panel {\n  width: min(720px, 92vw);\n  max-height: 86vh;\n  background: #fff6ea;\n  border-radius: 22px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 18px 20px;\n  display: grid;\n  gap: 12px;\n  overflow: hidden;\n  position: relative;\n}\n\n.cardhub-export__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n.cardhub-export__title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #2b2018;\n}\n\n.cardhub-export__subtitle {\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-export__toolbar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n.cardhub-export__spacer {\n  flex: 1;\n}\n\n.cardhub-export__btn {\n  border: none;\n  border-radius: 999px;\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition:\n    transform 120ms ease,\n    box-shadow 160ms ease,\n    background-color 160ms ease;\n}\n\n.cardhub-export__btn.is-primary {\n  background: #d46b3d;\n  color: #fff;\n}\n\n.cardhub-export__btn.is-secondary {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-export__btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-export__list {\n  display: grid;\n  gap: 8px;\n  overflow: auto;\n  padding-right: 4px;\n  max-height: 58vh;\n}\n\n.cardhub-export__item {\n  display: grid;\n  grid-template-columns: auto 1fr;\n  gap: 10px;\n  align-items: center;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 14px;\n  padding: 10px 12px;\n  background: rgba(255, 255, 255, 0.75);\n  cursor: pointer;\n}\n\n.cardhub-export__item:hover {\n  border-color: rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-export__checkbox {\n  width: 16px;\n  height: 16px;\n}\n\n.cardhub-export__main {\n  display: grid;\n  gap: 4px;\n}\n\n.cardhub-export__name {\n  font-size: 13px;\n  font-weight: 600;\n  color: #3b2a20;\n}\n\n.cardhub-export__meta {\n  display: flex;\n  gap: 10px;\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-export__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n\n.cardhub-export__tag {\n  padding: 3px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  background: rgba(255, 255, 255, 0.9);\n  font-size: 10px;\n  color: #6a3f2a;\n}\n\n.cardhub-button:focus-visible,\n.cardhub-chip:focus-visible,\n.cardhub-tag-filter__chip:focus-visible,\n.cardhub-tag:focus-visible,\n.cardhub-card__action:focus-visible,\n.cardhub-pagination__button:focus-visible,\n.cardhub-manage__btn:focus-visible,\n.cardhub-close:focus-visible,\n.cardhub-preview__close:focus-visible,\n.cardhub-confirm__button:focus-visible,\n.cardhub-export__btn:focus-visible,\n.cardhub-tag-manager__btn:focus-visible,\n.cardhub-tag-manager__tab:focus-visible {\n  outline: 2px solid rgba(212, 107, 61, 0.6);\n  outline-offset: 2px;\n}\n@media (max-width: 720px) {\n  .cardhub-root {\n    position: absolute !important;\n    inset: 0 !important;\n    z-index: 99999 !important;\n    display: none;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n    overflow-y: auto !important;\n  }\n\n  .cardhub-root.open {\n    display: flex !important;\n  }\n\n  .cardhub-backdrop {\n    position: absolute !important;\n    inset: 0 !important;\n    z-index: 99998 !important;\n    background: rgba(0, 0, 0, 0.4) !important;\n    backdrop-filter: blur(8px) !important;\n  }\n\n  .cardhub-panel {\n    position: relative !important;\n    width: 100% !important;\n    height: 100% !important;\n    max-height: 100% !important;\n    max-width: none !important;\n    margin: 0 !important;\n    border-radius: 24px !important;\n    box-shadow:\n      0 12px 48px rgba(0, 0, 0, 0.3),\n      0 2px 8px rgba(0, 0, 0, 0.1) !important;\n    display: flex !important;\n    flex-direction: column !important;\n    z-index: 99999 !important;\n    overflow: hidden !important;\n    border: 1px solid rgba(255, 255, 255, 0.15) !important;\n  }\n\n  .cardhub-header {\n    flex-shrink: 0;\n    padding: 14px 16px;\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n  }\n\n  .cardhub-title__main {\n    font-size: 20px;\n  }\n\n  .cardhub-title__sub {\n    font-size: 11px;\n  }\n\n  .cardhub-close {\n    width: 28px;\n    height: 28px;\n    font-size: 16px;\n    line-height: 28px;\n  }\n\n  .cardhub-toolbar {\n    flex-shrink: 0;\n    display: flex;\n    flex-wrap: wrap;\n    column-gap: 6px;\n    row-gap: 8px;\n    padding: 10px 14px;\n  }\n\n  .cardhub-search {\n    width: 100%;\n    font-size: 13px;\n    padding: 8px 12px;\n    height: 34px;\n  }\n\n  .cardhub-button {\n    flex: 0 1 auto;\n    min-width: 0;\n    font-size: 11px;\n    padding: 6px 10px;\n    height: 32px;\n    line-height: 1;\n  }\n\n  .cardhub-body {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0;\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-bottom: env(safe-area-inset-bottom);\n    scroll-padding-bottom: env(safe-area-inset-bottom);\n  }\n\n  .cardhub-sidebar {\n    flex-shrink: 0;\n    border-right: none;\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n    padding: 10px 14px;\n    max-height: none;\n    overflow: visible;\n  }\n\n  .cardhub-section-title {\n    font-size: 10px;\n    margin-bottom: 6px;\n  }\n\n  .cardhub-divider {\n    margin: 6px 0;\n  }\n\n  .cardhub-chip-row,\n  .cardhub-tag-filter {\n    display: flex;\n    flex-wrap: nowrap;\n    overflow-x: auto;\n    -webkit-overflow-scrolling: touch;\n    gap: 6px;\n    padding-bottom: 4px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar,\n  .cardhub-tag-filter::-webkit-scrollbar {\n    height: 4px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar-thumb,\n  .cardhub-tag-filter::-webkit-scrollbar-thumb {\n    background: rgba(106, 63, 42, 0.15);\n    border-radius: 999px;\n  }\n\n  .cardhub-chip {\n    font-size: 11px;\n    padding: 6px 10px;\n    min-height: 30px;\n    line-height: 1;\n    white-space: nowrap;\n    flex-shrink: 0;\n  }\n\n  .cardhub-tag-filter__chip {\n    font-size: 10px;\n    padding: 5px 9px;\n    min-height: 28px;\n    line-height: 1;\n    white-space: nowrap;\n    flex-shrink: 0;\n  }\n\n  .cardhub-content {\n    flex: 1;\n    min-height: 0;\n    overflow: visible;\n    padding: 12px;\n    padding-bottom: calc(12px + env(safe-area-inset-bottom));\n  }\n\n  .cardhub-pagination {\n    align-items: flex-start;\n    position: relative;\n    padding-right: 72px;\n  }\n\n  .cardhub-pagination__actions {\n    width: 100%;\n  }\n\n  .cardhub-pagination__button {\n    flex: 1;\n    text-align: center;\n  }\n\n  .cardhub-pagination__status {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    font-size: 10px;\n    white-space: nowrap;\n  }\n\n  .cardhub-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n    gap: 10px;\n    justify-content: center;\n    justify-items: center;\n  }\n\n  .cardhub-card {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 10px;\n    padding: 10px;\n    border-radius: 14px;\n    min-width: 0;\n    width: 100%;\n    max-width: none;\n  }\n\n  .cardhub-card__avatar {\n    width: 40px;\n    height: 40px;\n    flex-shrink: 0;\n    border-radius: 10px;\n  }\n\n  .cardhub-card__info {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .cardhub-card__name {\n    font-size: 13px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .cardhub-card__meta {\n    font-size: 10px;\n    gap: 6px;\n  }\n\n  .cardhub-card__tags {\n    margin-top: 4px;\n    gap: 4px;\n  }\n\n  .cardhub-tag {\n    font-size: 9px;\n    padding: 3px 6px;\n  }\n\n  .cardhub-card__actions {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    flex-shrink: 0;\n  }\n\n  .cardhub-card__action {\n    padding: 5px 10px;\n    font-size: 10px;\n    border-radius: 8px;\n  }\n\n  .cardhub-preview,\n  .cardhub-manage {\n    position: absolute !important;\n    inset: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n    overflow-y: auto !important;\n  }\n\n  .cardhub-preview__panel,\n  .cardhub-manage__panel {\n    width: calc(100vw - 32px) !important;\n    max-width: 360px !important;\n    max-height: calc(100vh - 32px) !important;\n    max-height: calc(100dvh - 32px) !important;\n    border-radius: 18px !important;\n    padding: 16px !important;\n    overflow: auto !important;\n    overflow-x: hidden !important;\n  }\n\n  .cardhub-preview__avatar {\n    height: 180px;\n    border-radius: 14px;\n  }\n\n  .cardhub-preview__name {\n    font-size: 16px;\n  }\n\n  .cardhub-preview__meta {\n    font-size: 11px;\n  }\n\n  .cardhub-preview__tag {\n    font-size: 10px;\n    padding: 4px 8px;\n  }\n\n  .cardhub-preview__actions {\n    gap: 8px;\n  }\n\n  .cardhub-manage__top {\n    grid-template-columns: 1fr;\n    gap: 12px;\n  }\n\n  .cardhub-manage__media {\n    width: 120px;\n    margin: 0 auto;\n  }\n\n  .cardhub-manage__overview {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-manage__overview-value {\n    font-size: 12px;\n  }\n\n  .cardhub-manage__overview-hint {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__label {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 10px;\n  }\n\n  .cardhub-manage__details {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-manage__detail-label {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__detail-content {\n    font-size: 11px;\n    overflow-wrap: anywhere;\n    word-break: break-word;\n  }\n\n  .cardhub-manage__btn {\n    width: 100%;\n    text-align: center;\n    font-size: 10px;\n  }\n\n  .cardhub-manage__jump-row {\n    width: 100%;\n  }\n\n  .cardhub-manage__content {\n    font-size: 11px;\n    padding: 10px;\n    overflow-wrap: anywhere;\n    word-break: break-word;\n  }\n\n  .cardhub-manage__chat-row {\n    grid-template-columns: 1fr;\n    gap: 3px;\n    font-size: 11px;\n  }\n\n  .cardhub-manage__chat-label {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__chat-text {\n    -webkit-line-clamp: 2;\n    overflow-wrap: anywhere;\n    word-break: break-word;\n  }\n\n  .cardhub-manage__actions {\n    grid-template-columns: 1fr 1fr;\n    gap: 8px;\n  }\n\n  .cardhub-export {\n    position: absolute !important;\n    inset: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n  }\n\n  .cardhub-export__panel {\n    width: calc(100vw - 32px) !important;\n    max-width: 360px !important;\n    max-height: calc(100vh - 32px) !important;\n    max-height: calc(100dvh - 32px) !important;\n    border-radius: 18px !important;\n    padding: 16px !important;\n  }\n\n  .cardhub-export__toolbar {\n    gap: 6px;\n  }\n\n  .cardhub-export__btn {\n    font-size: 11px;\n    padding: 6px 10px;\n  }\n\n  .cardhub-export__list {\n    max-height: 48vh;\n  }\n\n  .cardhub-export__item {\n    grid-template-columns: auto 1fr;\n    gap: 8px;\n    padding: 8px 10px;\n  }\n\n  .cardhub-export__name {\n    font-size: 12px;\n  }\n\n  .cardhub-export__meta {\n    font-size: 10px;\n  }\n\n  .cardhub-export__tag {\n    font-size: 9px;\n  }\n\n  .cardhub-tag-manager {\n    position: absolute !important;\n    inset: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n  }\n\n  .cardhub-tag-manager__panel {\n    width: calc(100vw - 32px) !important;\n    max-width: 360px !important;\n    max-height: calc(100vh - 32px) !important;\n    max-height: calc(100dvh - 32px) !important;\n    border-radius: 18px !important;\n    padding: 16px !important;\n  }\n\n  .cardhub-tag-manager__tab {\n    font-size: 11px;\n    padding: 5px 10px;\n  }\n\n  .cardhub-tag-manager__btn {\n    font-size: 11px;\n    padding: 6px 10px;\n  }\n\n  .cardhub-tag-manager__chip {\n    font-size: 10px;\n    padding: 5px 9px;\n  }\n}\n</style>\n'],sourceRoot:''}]);const c=i},614(n,e,a){var t=a(509);t.__esModule&&(t=t.default),'string'==typeof t&&(t=[[n.id,t,'']]),t.locals&&(n.exports=t.locals);(0,a(424).A)('2d903e24',t,!1,{ssrId:!0})},748(n){n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var a='',t=void 0!==e[5];return e[4]&&(a+='@supports ('.concat(e[4],') {')),e[2]&&(a+='@media '.concat(e[2],' {')),t&&(a+='@layer'.concat(e[5].length>0?' '.concat(e[5]):'',' {')),a+=n(e),t&&(a+='}'),e[2]&&(a+='}'),e[4]&&(a+='}'),a}).join('')},e.i=function(n,a,t,r,o){'string'==typeof n&&(n=[[null,n,void 0]]);var i={};if(t)for(var c=0;c<this.length;c++){var d=this[c][0];null!=d&&(i[d]=!0)}for(var s=0;s<n.length;s++){var l=[].concat(n[s]);t&&i[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]='@layer'.concat(l[5].length>0?' '.concat(l[5]):'',' {').concat(l[1],'}')),l[5]=o),a&&(l[2]?(l[1]='@media '.concat(l[2],' {').concat(l[1],'}'),l[2]=a):l[2]=a),r&&(l[4]?(l[1]='@supports ('.concat(l[4],') {').concat(l[1],'}'),l[4]=r):l[4]=''.concat(r)),e.push(l))}},e}}},e={};function a(t){var r=e[t];if(void 0!==r)return r.exports;var o=e[t]={id:t,exports:{}};return n[t](o,o.exports,a),o.exports}function t(n){const e=[],a=function(n){const e=`cardhub-entry-${getScriptId()}`,a=$(`#${e}`);if(a.length)return a.addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').empty(),null;const t=function(){const n=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const e of n){const n=$(e).first();if(n.length)return n}const e=$('button, .menu_button, .nav_button').filter((_,n)=>{const e=$(n).text(),a=n.getAttribute('title')??n.getAttribute('aria-label')??'';return/角色管理/.test(e)||/角色管理/.test(a)}).first();if(e.length){const n=e.closest('nav, header, section, div');return n.length?n:e.parent()}return null}();if(!t)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const i=o(()=>n.open('role')),c=$('<button>').attr('id',e).attr('type','button').addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').on('click pointerup touchend',n=>{n.preventDefault(),n.stopImmediatePropagation(),i()});t.append(c);const d=r(c[0],i);return()=>{c.off('click'),c.remove(),d()}}(n);a&&e.push(a);const t=function(n){const e=`cardhub-magic-${getScriptId()}`,a=$('#extensionsMenuButton');if(!a.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const t=()=>{const a=$('#extensionsMenu');if(!a||a.find(`#${e}`).length)return;const t=o(()=>n.open('magic')),i=$('<div>').attr('id',e).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').html('<i class="fa-solid fa-id-badge" aria-hidden="true"></i><span>角色卡管理器</span>').on('click pointerup touchend',n=>{n.preventDefault(),n.stopImmediatePropagation(),t()});a.append(i);const c=r(i[0],t);i.data('cardhub-dispose',c)};a.on('click.cardhub',()=>{setTimeout(t,0)});const i=new MutationObserver(()=>t()),c=window.parent?.document??document;return i.observe(c.body,{childList:!0,subtree:!0}),()=>{i.disconnect(),a.off('click.cardhub'),$(`#${e}`).remove()}}(n);return t&&e.push(t),()=>{e.forEach(n=>n())}}function r(n,e){const a=n=>{n.preventDefault(),n.stopImmediatePropagation(),e()};return n.addEventListener('pointerdown',a,{capture:!0}),n.addEventListener('mousedown',a,{capture:!0}),n.addEventListener('touchstart',a,{capture:!0}),()=>{n.removeEventListener('pointerdown',a,{capture:!0}),n.removeEventListener('mousedown',a,{capture:!0}),n.removeEventListener('touchstart',a,{capture:!0})}}function o(n){let e=0;return()=>{const a=Date.now();a-e<250||(e=a,n())}}a.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return a.d(e,{a:e}),e},a.d=(n,e)=>{for(var t in e)a.o(e,t)&&!a.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},a.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),a.r=n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})};const i=Vue;async function c(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const e='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof e?.getCharacters)try{await e.getCharacters()}catch(n){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',n)}const a=e?.characters??SillyTavern?.characters??[],t=new Map,r=new Map,o=new Map;return Array.isArray(e?.tags)&&e.tags.forEach(n=>{n?.id&&n?.name&&o.set(n.id,n.name)}),a.map((n,a)=>{const i=n.tags??n.data?.tags??[],c=n.avatar,s=n.name??'未命名角色',l=n.create_date??n.date_added??n?.created??n?.created_at??n?.timestamp??n?.time??n.data?.create_date??n.data?.date_added??n?.data?.created??n?.data?.created_at??n?.data?.timestamp??n?.data?.time??null,u=d(l)??0,p=l??String(a),b=c??`name:${s}::${p}`;let g=b;if(!c){const n=r.get(b)??0;r.set(b,n+1),n&&(g=`${b}::${n}`)}const h=Boolean(e?.tagMap&&Object.prototype.hasOwnProperty.call(e.tagMap,g)),m=(h?e.tagMap[g]??[]:[]).map(n=>o.get(n)).filter(Boolean),f=h?m:i,A=c?`avatar:${c}`:`name:${s}::${p}`,C=t.get(A)??0;t.set(A,C+1);const x=C?`${A}::${C}`:A,v=n?.last_interaction??n?.last_interaction_time??n?.last_interaction_date??n?.last_chat_time??n?.last_chat_date??n?.last_message_time??n?.last_message_date??n?.update_time??n?.last_modified??n?.timestamp??n?.time??n?.data?.last_interaction??n?.data?.last_interaction_time??n?.data?.last_interaction_date??n?.data?.last_chat_time??n?.data?.last_chat_date??n?.data?.last_message_time??n?.data?.last_message_date??n?.data?.update_time??n?.data?.last_modified??n?.data?.timestamp??n?.data?.time??null;return{id:x,name:s,avatar:n.avatar??null,tags:f,tagKey:g,origin:'tavern',createdAt:u,lastChatAt:d(v)??0}})}function d(n){if('number'==typeof n&&!Number.isNaN(n))return n<1e12?1e3*n:n;if('string'==typeof n){const e=Date.parse(n);if(!Number.isNaN(e))return e}return null}function s(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(n){const e=16*Math.random()|0;return('x'===n?e:3&e|8).toString(16)})}const l='cardhub_library';function u(){const n=TavernHelper.getVariables({type:'global'}),e=n?.[l];if(e&&'object'==typeof e){return{entries:Array.isArray(e.entries)?e.entries:[]}}const a=TavernHelper.getVariables({type:'script',script_id:getScriptId()}),t=a?.[l];if(!t||'object'!=typeof t)return{entries:[]};const r=Array.isArray(t.entries)?t.entries:[];return r.length&&p(r),{entries:r}}function p(n){const e=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({...e,[l]:{entries:n}},{type:'global'})}function b(n){return new Promise((e,a)=>{const t=new FileReader;t.onload=()=>e(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsDataURL(n)})}function g(n){return new Promise((e,a)=>{const t=new FileReader;t.onload=()=>e(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsText(n)})}function h(n){try{return JSON.parse(n)}catch{return null}}function m(n){const e=n.trim();if(!e)return null;const a=h(e);if(a)return a;if(!function(n){return!(n.length<16||n.length%4!=0)&&/^[A-Za-z0-9+/=]+$/.test(n)}(e))return null;const t=function(n){try{const e=atob(n),a=new Uint8Array(e.length);for(let n=0;n<e.length;n+=1)a[n]=e.charCodeAt(n);return(new TextDecoder).decode(a)}catch{return null}}(e);return t?h(t):null}function f(n){const e=n?.tags??n?.data?.tags;return Array.isArray(e)?e.filter(n=>'string'==typeof n).map(n=>n.trim()).filter(Boolean):[]}function A(n){const e=n.indexOf(',');if(e<0)return null;const a=n.slice(e+1);try{const n=atob(a),e=new Uint8Array(n.length);for(let a=0;a<n.length;a+=1)e[a]=n.charCodeAt(a);return e}catch{return null}}function C(n){return(new TextDecoder).decode(n)}function x(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}function v(n){const e=n.indexOf(0);if(e<0)return null;const a=C(n.subarray(0,e)).trim(),t=C(n.subarray(e+1)).trim();return a&&t?{key:a,value:t}:null}function y(n){const e=n.indexOf(0);if(e<0||e+2>=n.length)return null;const a=C(n.subarray(0,e)).trim(),t=1===n[e+1];let r=e+2;const o=n.indexOf(0,r);if(o<0)return null;r=o+1;const i=n.indexOf(0,r);if(i<0)return null;if(r=i+1,t)return null;const c=C(n.subarray(r)).trim();return a&&c?{key:a,value:c}:null}function w(n){if(n.length<8)return[];const e=[137,80,78,71,13,10,26,10];for(let a=0;a<e.length;a+=1)if(n[a]!==e[a])return[];const a=[];let t=8;for(;t+8<=n.length;){const e=x(n,t),r=C(n.subarray(t+4,t+8)),o=t+8,i=o+e;if(i+4>n.length)break;const c=n.subarray(o,i);if('tEXt'===r){const n=v(c);n&&a.push(n)}else if('iTXt'===r){const n=y(c);n&&a.push(n)}t=i+4}return a}function B(n){const e=A(n);if(!e)return null;const a=w(e),t=new Set(['chara','character','tavern','tavern_character','card']);for(const n of a){if(n.key&&!t.has(n.key.toLowerCase()))continue;const e=m(n.value),a=e?.name??e?.data?.name;if('string'==typeof a&&a.trim())return a.trim()}return null}function k(n){const e=A(n);if(!e)return[];const a=w(e),t=new Set(['chara','character','tavern','tavern_character','card']);for(const n of a){if(n.key&&!t.has(n.key.toLowerCase()))continue;const e=m(n.value);if(e){const n=f(e);if(n.length)return n}}return[]}function E(n){const e=h(n);return e?f(e):[]}function T(n){return n.replace(/\.(png|json)$/i,'')}function S(n){if(null===n||'object'!=typeof n)return JSON.stringify(n);if(Array.isArray(n))return`[${n.map(n=>S(n)).join(',')}]`;return`{${Object.entries(n).sort(([n],[e])=>n.localeCompare(e)).map(([n,e])=>`${JSON.stringify(n)}:${S(e)}`).join(',')}}`}function F(n,e){let a=e;if('json'===n){const n=e.trim();try{a=S(JSON.parse(n))}catch{a=n}}return`${n}:${function(n){let e=5381;for(let a=0;a<n.length;a+=1)e=33*e^n.charCodeAt(a);return(e>>>0).toString(16)}(a)}`}function N(){const n=u().entries;let e=!1;const a=Date.now(),t=n.map((t,r)=>{const o={...t,origin:t.origin??'library',tags:Array.isArray(t.tags)?t.tags:[]};if(!o.tagsEdited&&!o.tags.length&&o.raw&&o.rawType){const n='png'===o.rawType?k(o.raw):E(o.raw);n.length&&(o.tags=n,e=!0)}return'number'==typeof o.createdAt?o:(e=!0,{...o,createdAt:a-1e3*(n.length-1-r)})});return e&&p(t),t}async function V(n,e){const a=Array.from(n);if(!a.length)return N();const t=Array.isArray(e)&&e.length?e:N(),r=new Set;t.forEach(n=>{const e=function(n){if(n.fingerprint)return n.fingerprint;if(!n.rawType||!n.raw)return null;const e=F(n.rawType,n.raw);return n.fingerprint=e,e}(n);e&&r.add(e)});const o=[];for(const n of a){const e=T(n.name);if(n.name.toLowerCase().endsWith('.png')){const a=await b(n),t=B(a)??e,i=k(a),c=F('png',a);if(r.has(c))continue;r.add(c),o.push({id:s(),name:t,avatar:a,tags:i,origin:'library',importFileName:n.name,rawType:'png',raw:a,fingerprint:c,createdAt:Date.now()})}else if(n.name.toLowerCase().endsWith('.json')){const a=await g(n);let t=e;try{const n=JSON.parse(a);t=n.name??n.data?.name??t}catch{}const i=E(a),c=F('json',a);if(r.has(c))continue;r.add(c),o.push({id:s(),name:t,avatar:null,tags:i,origin:'library',importFileName:n.name,rawType:'json',raw:a,fingerprint:c,createdAt:Date.now()})}}const i=[...t,...o];return p(i),i}function D(n){const e=N().filter(e=>e.id!==n);return p(e),e}const M=(0,i.reactive)({open:!1,loading:!1,search:'',lastOpenSource:'manual',characters:[],library:[]});function L(n,e){M.open=n,e&&(M.lastOpenSource=e)}function I(n){M.loading=n}function Y(n){M.characters=n}function O(n){M.library=n.map(n=>({...n,origin:n.origin??'library',tags:Array.isArray(n.tags)?n.tags:[]}))}function j(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}return n??=SillyTavern,'function'!=typeof n?.getContext?null:n.getContext()}function H(n){Array.isArray(n.tags)||(n.tags=[]),n.tagMap||(n.tagMap={})}function P(n){if(!n)return{hasKey:!1,tags:[]};const e=j();if(!e||!e.tagMap||!Array.isArray(e.tags))return{hasKey:!1,tags:[]};if(!Object.prototype.hasOwnProperty.call(e.tagMap,n))return{hasKey:!1,tags:[]};const a=new Map;e.tags.forEach(n=>{n?.id&&n?.name&&a.set(n.id,n.name)});return{hasKey:!0,tags:(e.tagMap[n]??[]).map(n=>a.get(n)).filter(Boolean)}}function R(n){if('library'===n.origin)return n.tags??[];const e=P(n.tagKey??n.avatar);return e.hasKey?e.tags:n.tags??[]}function U(n,e){const a=j();if(!a)return e;const t=function(n,e){if(!Array.isArray(n.characters))return null;const a=e.avatar?n.characters.find(n=>n.avatar===e.avatar):null;return a||(n.characters.find(n=>n.name===e.name)??null)}(a,n);if(!t)return e;const r=Array.from(new Set(e.map(n=>n.trim().replace(/\s+/g,' ')).filter(Boolean)));t.tags=r,t.data&&(t.data.tags=r),H(a);const o=r.map(n=>function(n,e){H(n);const a=n.tags.find(n=>n.name===e);if(a)return a;const t={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:e};return n.tags.push({id:t.id,name:t.name}),t}(a,n).id),i=n.tagKey??t.avatar??null;i&&(a.tagMap[i]=o),a.saveSettingsDebounced?.();const c=window.parent?.SillyTavern??SillyTavern;return c?.saveSettingsDebounced?.(),r}const q={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},K={class:'cardhub-toolbar'},W={class:'cardhub-body'},Q={class:'cardhub-sidebar'},Z={class:'cardhub-filter-row'},X={class:'cardhub-filter-block'},J={class:'cardhub-chip-row'},G={class:'cardhub-filter-block'},nn={class:'cardhub-chip-row'},en={class:'cardhub-tag-filter'},an=['onClick'],tn={class:'cardhub-content'},rn={key:0,class:'cardhub-loading'},on={key:1,class:'cardhub-empty'},cn={key:2,class:'cardhub-grid-wrap'},dn={class:'cardhub-pagination'},sn={key:0,class:'cardhub-pagination__actions'},ln=['disabled'],un=['disabled'],pn={class:'cardhub-pagination__status'},bn={class:'cardhub-grid'},gn=['onClick'],hn={class:'cardhub-card__info'},mn={class:'cardhub-card__head'},fn={class:'cardhub-card__name'},An=['onClick'],Cn={class:'cardhub-card__meta'},xn={class:'cardhub-card__tags'},vn=['onClick'],_n=['onClick'],yn=['onKeydown','onBlur'],wn=['onClick'],Bn={class:'cardhub-card__actions'},kn=['onClick'],En=['onClick'],Tn={class:'cardhub-manage__panel',role:'dialog','aria-label':'角色管理'},Sn={class:'cardhub-manage__top'},zn={class:'cardhub-manage__summary'},Fn={class:'cardhub-preview__name'},Nn={class:'cardhub-preview__meta'},Vn={class:'cardhub-preview__tags'},Dn={class:'cardhub-manage__overview'},Mn={class:'cardhub-manage__overview-label'},Ln={class:'cardhub-manage__overview-value'},In={key:0,class:'cardhub-manage__overview-hint'},Yn={class:'cardhub-manage__media'},On=['src'],jn={class:'cardhub-manage__section'},Hn={key:0,class:'cardhub-manage__details'},Pn={class:'cardhub-manage__detail-label'},$n={class:'cardhub-manage__detail-content'},Rn={key:1,class:'cardhub-manage__empty'},Un={class:'cardhub-manage__section'},qn={class:'cardhub-manage__content'},Kn={class:'cardhub-manage__section'},Wn={class:'cardhub-manage__label'},Qn={class:'cardhub-manage__jump-row'},Zn={key:0,class:'cardhub-manage__chat'},Xn=['onClick','onKeydown'],Jn={class:'cardhub-manage__chat-main'},Gn={class:'cardhub-manage__chat-name'},ne={key:0,class:'cardhub-manage__chat-label'},ee={class:'cardhub-manage__chat-text'},ae={key:1,class:'cardhub-manage__empty'},te={class:'cardhub-manage__actions'},re={class:'cardhub-confirm__panel',role:'dialog','aria-modal':'true'},oe={class:'cardhub-confirm__title'},ie={class:'cardhub-confirm__message'},ce={class:'cardhub-confirm__actions'},de={class:'cardhub-tag-manager__panel',role:'dialog','aria-label':'标签管理'},se={class:'cardhub-tag-manager__header'},le={key:0,class:'cardhub-tag-manager__subtitle'},ue={key:1,class:'cardhub-tag-manager__subtitle'},pe={class:'cardhub-tag-manager__tabs'},be={key:0,class:'cardhub-tag-manager__section'},ge={class:'cardhub-tag-manager__actions'},he=['disabled'],me={class:'cardhub-tag-manager__list'},fe=['onClick'],Ae={key:1,class:'cardhub-tag-manager__section cardhub-tag-manager__batch'},Ce={class:'cardhub-batch__filters'},xe={class:'cardhub-batch__field'},ve={key:0,class:'cardhub-batch__suggestions'},_e={class:'cardhub-batch__suggest-row'},ye=['onClick'],we={class:'cardhub-batch__toolbar'},Be={class:'cardhub-batch__list'},ke=['checked','onChange'],Ee={class:'cardhub-batch__main'},Te={class:'cardhub-batch__name'},Se={class:'cardhub-batch__meta'},ze={key:0,class:'cardhub-batch__tags'},Fe={class:'cardhub-export__panel',role:'dialog','aria-label':'批量导出'},Ne={class:'cardhub-export__header'},Ve={class:'cardhub-export__subtitle'},De={class:'cardhub-export__filters'},Me={class:'cardhub-export__filter-row'},Le={class:'cardhub-export__filter-row'},Ie=['onClick'],Ye={class:'cardhub-export__list'},Oe=['checked','onChange'],je={class:'cardhub-export__main'},He={class:'cardhub-export__name'},Pe={class:'cardhub-export__meta'},$e={key:0,class:'cardhub-export__tags'},Re={class:'cardhub-theme__panel',role:'dialog','aria-label':'配色设置'},Ue={class:'cardhub-theme__grid'},qe={class:'cardhub-theme__field'},Ke={class:'cardhub-theme__field'},We={class:'cardhub-theme__field'},Qe={class:'cardhub-theme__field'},Ze={class:'cardhub-theme__field'},Xe={class:'cardhub-theme__field'},Je={class:'cardhub-theme__field'},Ge={class:'cardhub-theme__field'},na={class:'cardhub-theme__field'},ea={class:'cardhub-theme__presets'},aa=['onClick'],ta='cardhub_favorites',ra='cardhub_last_chat_cache',oa='cardhub_import_cache',ia='cardhub_theme',ca=(0,i.defineComponent)({__name:'App',setup(n){const e=(0,i.ref)([]),a=(0,i.ref)(!1),t=(0,i.ref)('filter'),r=(0,i.ref)(null),o=(0,i.ref)(''),d=(0,i.ref)('all'),s=(0,i.ref)(24),l=(0,i.ref)(1),u=(0,i.ref)(null),b=(0,i.ref)(null),g=(0,i.ref)([]),h=(0,i.ref)([]),m=(0,i.computed)(()=>{return n=g.value,e=3,n.map(n=>function(n,e){const a=n.replace(/\r/g,'').trim();if(!a)return[];const t=rr(a);if(t.length>=e)return t.slice(0,e);const r=Kt(a);if(!r)return t.slice(0,e);const o=or(r,60);if(!t.length)return o.slice(0,e);const i=[...t];for(const n of o){if(i.length>=e)break;i[0]!==n&&i.push(n)}return i.slice(0,e)}(n,2).join('\n')).filter(n=>n.trim().length>0).slice(0,e);var n,e});let f=0;const A=(0,i.reactive)({open:!1,title:'',message:'',confirmLabel:'确定',cancelLabel:'取消',altLabel:'',resolve:null}),C=(0,i.computed)(()=>[...M.characters,...M.library]),x=(0,i.computed)(()=>{const n=new Map;return C.value.forEach(e=>{n.set(e.id,R(e))}),n}),v=(0,i.ref)(null),y=(0,i.ref)(null),w=(0,i.ref)(null),B=(0,i.ref)(!1),k=(0,i.ref)([]),E=(0,i.computed)(()=>[...C.value]),T=(0,i.ref)(''),S=(0,i.ref)('all'),F=(0,i.ref)([]),j=(0,i.ref)([]),H=(0,i.ref)(''),P=(0,i.ref)(''),ca=(0,i.ref)([]),da=(0,i.computed)(()=>{const n=new Set;return E.value.forEach(e=>{(x.value.get(e.id)??R(e)).forEach(e=>n.add(e))}),F.value.forEach(e=>n.add(e)),Array.from(n).sort((n,e)=>n.localeCompare(e,'zh-CN'))}),sa=(0,i.computed)(()=>{let n=E.value;'imported'===S.value?n=n.filter(n=>'tavern'===n.origin):'unimported'===S.value&&(n=n.filter(n=>'library'===n.origin)),F.value.length&&(n=n.filter(n=>F.value.some(e=>(x.value.get(n.id)??R(n)).includes(e))));const e=T.value.trim().toLowerCase();return e?n.filter(n=>{if(n.name.toLowerCase().includes(e))return!0;return(x.value.get(n.id)??R(n)).some(n=>n.toLowerCase().includes(e))}):n}),la=(0,i.computed)(()=>new Set(k.value)),ua=(0,i.computed)(()=>E.value.filter(n=>la.value.has(n.id))),pa=(0,i.computed)(()=>Na.value),ba=(0,i.computed)(()=>{const n=H.value.trim().toLowerCase();return n?pa.value.filter(e=>{if(e.name.toLowerCase().includes(n))return!0;return(x.value.get(e.id)??R(e)).some(e=>e.toLowerCase().includes(n))}):pa.value}),ga=(0,i.computed)(()=>new Set(j.value)),ha=(0,i.computed)(()=>Ma.value),ma=(0,i.ref)([]),fa=(0,i.computed)(()=>new Set(ma.value)),Aa=(0,i.ref)('recent'),Ca=(0,i.ref)(!1),xa=(0,i.ref)({}),va=(0,i.ref)({}),_a={bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'},ya=(0,i.ref)(!1),wa=(0,i.ref)({..._a}),Ba=(0,i.reactive)({..._a}),ka=(0,i.computed)(()=>{const n=ya.value?Ba:wa.value;return{'--cardhub-bg-start':n.bgStart,'--cardhub-bg-end':n.bgEnd,'--cardhub-surface':n.surface,'--cardhub-surface-alt':n.surfaceAlt,'--cardhub-text':n.text,'--cardhub-text-muted':n.textMuted,'--cardhub-accent':n.accent,'--cardhub-accent-strong':n.accentStrong,'--cardhub-border':n.border,'--cardhub-surface-rgb':nt(n.surface),'--cardhub-surface-alt-rgb':nt(n.surfaceAlt),'--cardhub-border-rgb':nt(n.border),'--cardhub-accent-rgb':nt(n.accent),'--cardhub-accent-strong-rgb':nt(n.accentStrong),'--cardhub-accent-text':et(n.accent),'--cardhub-accent-strong-text':et(n.accentStrong)}}),Ea=[{name:'晨雾',value:{bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'}},{name:'白天',value:{bgStart:'#fdfaf4',bgEnd:'#f2ebe1',surface:'#fffefb',surfaceAlt:'#f7efe6',text:'#1d1a17',textMuted:'#7a6f63',accent:'#e3a981',accentStrong:'#3f2c22',border:'#e4d7c8'}},{name:'夜晚',value:{bgStart:'#14181d',bgEnd:'#0d1116',surface:'#1e242b',surfaceAlt:'#242b34',text:'#eef2f7',textMuted:'#b2bdc9',accent:'#6fa2d1',accentStrong:'#d7e6f4',border:'#36414c'}},{name:'茶棕',value:{bgStart:'#f7f1e7',bgEnd:'#e6d8c6',surface:'#fcf6ee',surfaceAlt:'#f2e4d6',text:'#2a1f18',textMuted:'#8a6d5a',accent:'#c47b52',accentStrong:'#3e2a22',border:'#ddc7b4'}},{name:'赤陶',value:{bgStart:'#fbf1ea',bgEnd:'#ecd5c8',surface:'#fff7f1',surfaceAlt:'#f4e1d6',text:'#2d2018',textMuted:'#8b6a5a',accent:'#d17a4f',accentStrong:'#4c2d21',border:'#e3c3b3'}},{name:'薄荷',value:{bgStart:'#f2fbf7',bgEnd:'#dcefe7',surface:'#f9fffd',surfaceAlt:'#e8f4f0',text:'#1a2a26',textMuted:'#5f7a73',accent:'#60b6a4',accentStrong:'#1f4c43',border:'#c5ddd5'}},{name:'海盐',value:{bgStart:'#f3f8fb',bgEnd:'#d9e7f3',surface:'#f9fcff',surfaceAlt:'#e9f2f9',text:'#1b2530',textMuted:'#5f7388',accent:'#5da3cf',accentStrong:'#1f3e57',border:'#c8d9e7'}},{name:'石墨',value:{bgStart:'#2a2d33',bgEnd:'#1e2126',surface:'#333741',surfaceAlt:'#3b404b',text:'#f3f5f8',textMuted:'#c1c7d0',accent:'#9aa6b2',accentStrong:'#e0e5ea',border:'#4b5261'}}],Ta=(0,i.computed)(()=>{const n=[],e=v.value;'library'===b.value?.origin&&b.value.importFileName&&n.push({label:'导入文件名',value:b.value.importFileName});const a=(e,a,t=240)=>{const r=function(n,e,a){const t=n.replace(/\r/g,'').trim();if(!t)return'';const r=rr(t),o=r.length?r:or(Kt(t),60);let i=o.slice(0,e).join('\n').trim();if(!i)return'';const c=i.length>a;c&&(i=i.slice(0,a).trim());const d=c||o.length>e||t.length>i.length;d&&!i.endsWith('…')&&(i=`${i}…`);return i}(a,3,t);r&&n.push({label:e,value:r})};return e&&(a('角色描述',e.description??''),a('性格',e.personality??''),a('场景',e.scenario??''),a('创作者备注',e.creatorNotes??''),a('系统提示',e.systemPrompt??'',200),a('历史指令',e.postHistory??'',200),a('作者',e.creator??'',80)),n}),Sa=(0,i.computed)(()=>!b.value||Ta.value.length?'':'library'===b.value.origin?'未导入卡片暂无可预览内容，可先导入后查看详情。':'暂无角色卡详情。'),za=(0,i.computed)(()=>'library'===b.value?.origin?'未导入卡片暂无聊天记录。':'暂无聊天记录。'),Fa=(0,i.computed)(()=>{const n=[],e=v.value,a=e?.worldBookName?.trim()||'',t=e?.worldBookCount;let r='未绑定',o='';(a||'number'==typeof t)&&(r=a||'角色世界书',o='number'==typeof t?`${t} 条`:''),n.push({label:'世界书',value:r,hint:o});const i=w.value;let c='暂无聊天',d='';i&&i.total>0&&(c=`${i.total} 个聊天`,i.latest&&(d=`最近：${i.latest}`)),n.push({label:'聊天概况',value:c,hint:d});const s=y.value;let l='暂无开场白',u='';return s&&s.total>0&&(l=`${s.total} 条`,u=s.alternate>0?`替代：${s.alternate} 条`:'无替代'),n.push({label:'开场白',value:l,hint:u}),n}),Na=(0,i.computed)(()=>{const n=function(n){if(!Ca.value)return n;return n.filter(n=>fa.value.has(n.id))}(function(n){if('imported'===d.value)return n.filter(n=>!Wa(n));if('unimported'===d.value)return n.filter(n=>Wa(n));return n}(C.value)),e=M.search.trim().toLowerCase();return qa(e?Qa(n).filter(n=>{if(n.name.toLowerCase().includes(e))return!0;return(x.value.get(n.id)??R(n)).some(n=>n.toLowerCase().includes(e))}):Qa(n))}),Va=(0,i.computed)(()=>{const n=Math.ceil(Na.value.length/s.value);return n>0?n:1}),Da=(0,i.computed)(()=>{const n=(l.value-1)*s.value;return Na.value.slice(n,n+s.value)}),Ma=(0,i.computed)(()=>{const n=new Set;return C.value.forEach(e=>{(x.value.get(e.id)??R(e)).forEach(e=>n.add(e))}),e.value.forEach(e=>n.add(e)),Array.from(n).sort((n,e)=>n.localeCompare(e,'zh-CN'))});function La(n,e=!1){const a=n.avatar;return a?/^(data:|https?:|\/)/.test(a)?a:e&&'tavern'===n.origin?TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:null}function Ia(n){const e=La(n);return e?{backgroundImage:`url(${e})`}:{}}function Ya(n){return x.value.get(n.id)??R(n)}function Oa(n){const e=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...e,[ra]:n})}function ja(n){return'tavern'!==n.origin?null:n.avatar?`avatar:${n.avatar}`:n.name?`name:${n.name}`:null}function Ha(n){if('number'==typeof n.createdAt&&n.createdAt>0)return n.createdAt;const e=ja(n);return e?va.value[e]??0:0}function Pa(n){if('number'==typeof n.lastChatAt&&n.lastChatAt>0)return n.lastChatAt;const e=ja(n);return e?xa.value[e]??0:0}function $a(n,e){if(e<=0||'tavern'!==n.origin)return;const a=new Set;if(n.avatar&&a.add(`avatar:${n.avatar}`),n.name&&a.add(`name:${n.name}`),!a.size)return;const t={...xa.value};let r=!1;a.forEach(n=>{(t[n]??0)<e&&(t[n]=e,r=!0)}),r&&(xa.value=t,Oa(t))}function Ra(n){va.value=n,function(n){const e=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...e,[oa]:n})}(n)}function Ua(n){fa.value.has(n.id)?ma.value=ma.value.filter(e=>e!==n.id):ma.value=[...ma.value,n.id],function(n){const e=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...e,[ta]:n})}(ma.value)}function qa(n){const e=n.map(n=>({item:n,tagCount:(x.value.get(n.id)??R(n)).length})),a=(n,e)=>n.localeCompare(e,'zh-CN');return e.sort((n,e)=>{const t=n.item,r=e.item;if('name'===Aa.value)return a(t.name,r.name);if('tags'===Aa.value)return e.tagCount!==n.tagCount?e.tagCount-n.tagCount:a(t.name,r.name);if('imported'===Aa.value){const n=Ha(t),e=Ha(r);return e!==n?e-n:a(t.name,r.name)}const o=Pa(t),i=Pa(r);if(i!==o)return i-o;const c=t.createdAt??0,d=r.createdAt??0;return d!==c?d-c:a(t.name,r.name)}).map(n=>n.item)}const Ka=(0,i.computed)(()=>b.value?La(b.value,!0):null);function Wa(n){return!('library'!==n.origin&&!Boolean(n.rawType))||M.library.some(e=>e.id===n.id)}function Qa(n){return e.value.length?n.filter(n=>e.value.some(e=>(x.value.get(n.id)??R(n)).includes(e))):n}function Za(n){e.value.includes(n)?e.value=e.value.filter(e=>e!==n):e.value=[...e.value,n]}function Xa(){e.value=[]}function Ja(n='filter'){if('batch'===n){if(!ba.value.length)return void toastr.warning('当前没有可操作的角色卡');P.value='',H.value='',ca.value=[],j.value=ba.value.map(n=>n.id)}t.value=n,a.value=!0}function Ga(){a.value=!1}function nt(n){const e=n.replace('#','');if(6!==e.length)return'0, 0, 0';return`${Number.parseInt(e.slice(0,2),16)}, ${Number.parseInt(e.slice(2,4),16)}, ${Number.parseInt(e.slice(4,6),16)}`}function et(n){const e=nt(n).split(',').map(n=>Number(n.trim()));if(3!==e.length)return'#1b1b1b';const[a,t,r]=e.map(n=>n/255);return.2126*a+.7152*t+.0722*r>.6?'#1b1b1b':'#ffffff'}let at=0,tt=null;function rt(n){at&&(cancelAnimationFrame(at),at=0),tt&&window.clearTimeout(tt),tt=window.setTimeout(()=>{tt=null,at=requestAnimationFrame(()=>{at=0,function(n){const e=function(){try{return(window.parent?.document??document).querySelector('.cardhub-root')}catch{return document.querySelector('.cardhub-root')}}();if(!e)return;e.style.setProperty('--cardhub-bg-start',n.bgStart),e.style.setProperty('--cardhub-bg-end',n.bgEnd),e.style.setProperty('--cardhub-surface',n.surface),e.style.setProperty('--cardhub-surface-alt',n.surfaceAlt),e.style.setProperty('--cardhub-text',n.text),e.style.setProperty('--cardhub-text-muted',n.textMuted),e.style.setProperty('--cardhub-accent',n.accent),e.style.setProperty('--cardhub-accent-strong',n.accentStrong),e.style.setProperty('--cardhub-border',n.border),e.style.setProperty('--cardhub-surface-rgb',nt(n.surface)),e.style.setProperty('--cardhub-surface-alt-rgb',nt(n.surfaceAlt)),e.style.setProperty('--cardhub-border-rgb',nt(n.border)),e.style.setProperty('--cardhub-accent-rgb',nt(n.accent)),e.style.setProperty('--cardhub-accent-strong-rgb',nt(n.accentStrong)),e.style.setProperty('--cardhub-accent-text',et(n.accent)),e.style.setProperty('--cardhub-accent-strong-text',et(n.accentStrong))}(n)})},80)}function ot(){const n=TavernHelper.getVariables({type:'global'});return function(n){if(!n||'object'!=typeof n)return{..._a};const e=n,a=n=>{const a=e[n];return/^#[0-9a-f]{6}$/i.test(a)?a:_a[n]};return{bgStart:a('bgStart'),bgEnd:a('bgEnd'),surface:a('surface'),surfaceAlt:a('surfaceAlt'),text:a('text'),textMuted:a('textMuted'),accent:a('accent'),accentStrong:a('accentStrong'),border:a('border')}}(n?.[ia])}function it(){const n=wa.value;Object.assign(Ba,n),ya.value=!0,(0,i.nextTick)(()=>rt(n))}function ct(){ya.value=!1,Object.assign(Ba,wa.value),rt(wa.value)}function dt(){Object.assign(Ba,_a)}function st(){wa.value={...Ba},function(n){const e=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...e,[ia]:n})}(wa.value),rt(wa.value),ya.value=!1}function lt(){F.value=[]}function ut(){B.value=!1}function pt(){j.value=ba.value.map(n=>n.id)}function bt(){j.value=[]}async function gt(n){if(!j.value.length)return void toastr.warning('请先选择要操作的角色卡');const e=function(n,e){const a=n.split(/[,，\n;；、]/).map(n=>n.trim()).filter(Boolean);return Array.from(new Set([...a,...e]))}(P.value,ca.value);if(!e.length)return void toastr.warning('请输入要操作的标签');const a='add'===n?'添加':'移除',t=`将${a}标签：${e.join('、')}\n应用到 ${j.value.length} 张角色卡，是否继续？`;if('confirm'!==await vt({title:`批量${a}标签`,message:t,confirmLabel:`继续${a}`,cancelLabel:'取消'}))return;const r=function(n){const e=new Map(C.value.map(n=>[n.id,n]));return n.map(n=>e.get(n)).filter(Boolean)}(j.value);let o=0;r.forEach(a=>{const t=Ya(a),r=new Set(t);'add'===n?e.forEach(n=>r.add(n)):e.forEach(n=>r.delete(n));const i=Array.from(r);(function(n,e){if(n.length!==e.length)return!1;const a=new Set(n);return e.every(n=>a.has(n))})(t,i)||(kt(a,i),o+=1)}),toastr.success(`已处理 ${o} 张角色卡`)}function ht(){k.value=E.value.map(n=>n.id)}function mt(){k.value=[]}function ft(){l.value>1&&(l.value-=1)}function At(){l.value<Va.value&&(l.value+=1)}function Ct(n){return n.trim().toLocaleLowerCase()}function xt(n){let e=n.trim();if(!e)return'';try{e=decodeURIComponent(e)}catch{}return e=e.split('?')[0],e.includes('/')&&(e=e.split('/').pop()??e),e.trim().toLowerCase()}function vt(n){return A.open&&A.resolve&&A.resolve('cancel'),A.title=n.title??'确认操作',A.message=n.message,A.confirmLabel=n.confirmLabel??'确定',A.cancelLabel=n.cancelLabel??'取消',A.altLabel=n.altLabel??'',A.open=!0,new Promise(n=>{A.resolve=n})}function _t(n){if(!A.open)return;A.open=!1;const e=A.resolve;A.resolve=null,e&&e(n)}function yt(n){return n.id}function wt(n){if(r.value!==yt(n))return;const e=o.value.trim();if(e){kt(n,[...R(n),e])}Bt()}function Bt(){r.value=null,o.value=''}function kt(n,e){if(Wa(n)){O(function(n,e,a){const t=(Array.isArray(a)&&a.length?a:N()).map(a=>a.id!==n?a:{...a,tags:e,tagsEdited:!0});return p(t),t}(n.id,e,M.library))}else{const a=U(n,e);n.tags=a,Y([...M.characters])}}function Et(){u.value?.click()}async function Tt(n){const e=n.target,a=e?.files;if(!a||!a.length)return;O(await V(a,M.library)),e.value=''}async function St(){sa.value.length?(k.value=sa.value.map(n=>n.id),B.value=!0):toastr.warning('当前没有可导出的角色卡')}async function zt(){const n=ua.value;if(!n.length)return void toastr.warning('请选择要导出的角色卡');const a=e.value.length?e.value.join('、'):'无',t='all'===d.value?'全部':'imported'===d.value?'已导入':'未导入',r=M.search.trim()||'无',o=`将导出 ${n.length} 张角色卡。\n筛选状态：${t}\n筛选标签：${a}\n搜索关键字：${r}\n是否继续？`;if('confirm'===await vt({title:'批量导出',message:o,confirmLabel:'继续导出',cancelLabel:'取消'})){B.value=!1;for(const e of n)await Nt(e),await br(120);toastr.success(`批量导出完成，共 ${n.length} 张`)}}async function Ft(n){'library'===n.origin?await async function(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const e=function(n){const e=Ct(n);return e?M.characters.find(n=>Ct(n.name)===e)??null:null}(n.name);if(e)return void toastr.warning(`已存在同名角色「${e.name}」，已跳过导入`);const a=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};delete a['Content-Type'];const t=await c(),r=new Set(t.map(n=>xt(n.avatar??'')).filter(Boolean));if('png'===n.rawType){const e=await Cr(n.raw);await TavernHelper.importRawCharacter(n.name,e)}else{const e=new File([n.raw],`${n.name}.json`,{type:'application/json'}),t=new FormData;t.append('avatar',e),t.append('file_type','json'),t.append('preserved_name',e.name),await fetch('/api/characters/import',{method:'POST',headers:a,body:t,cache:'no-cache'})}const o=await c(),i=new Set([n.name]);if('json'===n.rawType)try{const e=JSON.parse(n.raw);e?.name&&i.add(e.name),e?.data?.name&&i.add(e.data.name)}catch{}const d=o.find(n=>{const e=xt(n.avatar??'');return e&&!r.has(e)}),s=o.find(n=>Array.from(i).some(e=>Ct(n.name)===Ct(e))),l=d??s??null;if(l){O(D(n.id));const e=n.tags?.length?n.tags:function(n){const e=n?.tags??n?.data?.tags;if(!Array.isArray(e))return[];return e.filter(n=>'string'==typeof n).map(n=>n.trim()).filter(Boolean)}(Lt(n));if(e.length){const n=U(l,e);l.tags=n}toastr.success(`已导入 ${n.name}`)}else toastr.warning(`导入完成但未在角色列表中找到「${n.name}」，已保留未导入记录`);Y(o)}(n):Nt(n)}async function Nt(n){if('library'===n.origin)return void await async function(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){return void Ar(await Cr(n.raw),`${n.name}.png`)}const e=new Blob([n.raw],{type:'application/json'});Ar(e,`${n.name}.json`)}(n);if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const e=TavernHelper.getCharAvatarPath(n.avatar);if(!e)return void toastr.error('无法导出：缺少头像信息');const a=await fetch(e,{cache:'no-cache'});Ar(await a.blob(),`${n.name}.png`)}async function Vt(n){const e=++f;b.value=n,g.value=[],h.value=[],v.value=null,y.value=null,w.value=null;const[a,t]=await Promise.allSettled([Mt(n),ir(n)]);if(e!==f||b.value?.id!==n.id)return;const r='fulfilled'===a.status?a.value:{openings:[],profile:null,openingSummary:null};g.value=r.openings,v.value=r.profile,y.value=r.openingSummary;const o='fulfilled'===t.status?t.value:{list:[],summary:null};h.value=o.list,w.value=o.summary}function Dt(){b.value=null,g.value=[],h.value=[],v.value=null,y.value=null,w.value=null}async function Mt(n){if('tavern'!==n.origin){const e=Lt(n);return{openings:qt(e),profile:$t(e),openingSummary:Ut(e)}}const e=await async function(n){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const a='function'==typeof e?.getContext?e.getContext():null;if(a?.getCharacters)try{await a.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色卡列表失败',n)}const t=a?.characters??e?.characters??[];if(!t.length)return null;const r=n.avatar?t.findIndex(e=>e.avatar===n.avatar||e.name===n.avatar):-1,o=t.findIndex(e=>e.name===n.name),i=r>=0?r:o;if(i<0)return null;if(a?.unshallowCharacter)try{await a.unshallowCharacter(i)}catch(n){console.warn('[CardHub] 读取角色卡详情失败',n)}const c=(a?.characters??t)[i]??null;if(c?.first_mes||c?.data?.first_mes)return c;if(a?.getCharacterCardFields)try{const n=await a.getCharacterCardFields({chid:i});if(n?.first_mes||n?.data?.first_mes)return n}catch(n){console.warn('[CardHub] 读取角色卡字段失败',n)}const d=TavernHelper.getCharData(n.avatar??n.name,!0);return d??c}(n),a=e??TavernHelper.RawCharacter?.find({name:n.avatar??n.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:n.name,allowAvatar:!0}),t=e??a;let r=qt(t);!r.length&&a&&a!==t&&(r=qt(a));const o=Ut(t??a);return{openings:r,profile:$t(t??a),openingSummary:o}}function Lt(n){return n.raw&&n.rawType?'json'===n.rawType?It(n.raw):'png'===n.rawType?function(n){const e=function(n){const e=n.indexOf(',');if(e<0)return null;const a=n.slice(e+1);try{const n=atob(a),e=new Uint8Array(n.length);for(let a=0;a<n.length;a+=1)e[a]=n.charCodeAt(a);return e}catch{return null}}(n);if(!e)return null;const a=function(n){if(n.length<8)return[];const e=[137,80,78,71,13,10,26,10];for(let a=0;a<e.length;a+=1)if(n[a]!==e[a])return[];const a=[];let t=8;for(;t+8<=n.length;){const e=Ht(n,t),r=Pt(n.subarray(t+4,t+8)),o=t+8,i=o+e;if(i+4>n.length)break;const c=n.subarray(o,i);if('tEXt'===r){const n=Yt(c);n&&a.push(n)}else if('iTXt'===r){const n=Ot(c);n&&a.push(n)}t=i+4}return a}(e),t=new Set(['chara','character','tavern','tavern_character','card']);for(const n of a){if(n.key&&!t.has(n.key.toLowerCase()))continue;const e=jt(n.value);if(e)return e}return null}(n.raw):null:null}function It(n){try{return JSON.parse(n)}catch{return null}}function Yt(n){const e=n.indexOf(0);if(e<0)return null;const a=Pt(n.subarray(0,e)).trim(),t=Pt(n.subarray(e+1)).trim();return a&&t?{key:a,value:t}:null}function Ot(n){const e=n.indexOf(0);if(e<0||e+2>=n.length)return null;const a=Pt(n.subarray(0,e)).trim(),t=1===n[e+1];let r=e+2;const o=n.indexOf(0,r);if(o<0)return null;r=o+1;const i=n.indexOf(0,r);if(i<0)return null;if(r=i+1,t)return null;const c=Pt(n.subarray(r)).trim();return a&&c?{key:a,value:c}:null}function jt(n){const e=n.trim();if(!e)return null;const a=It(e);if(a)return a;if(!function(n){if(n.length<16||n.length%4!=0)return!1;return/^[A-Za-z0-9+/=]+$/.test(n)}(e))return null;const t=function(n){try{const e=atob(n),a=new Uint8Array(e.length);for(let n=0;n<e.length;n+=1)a[n]=e.charCodeAt(n);return(new TextDecoder).decode(a)}catch{return null}}(e);return t?It(t):null}function Ht(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}function Pt(n){return(new TextDecoder).decode(n)}function $t(n){if(!n)return null;const e={description:Rt(n?.description,n?.data?.description),personality:Rt(n?.personality,n?.data?.personality),scenario:Rt(n?.scenario,n?.data?.scenario),creatorNotes:Rt(n?.creatorcomment,n?.data?.creatorcomment,n?.creator_notes,n?.data?.creator_notes),systemPrompt:Rt(n?.system_prompt,n?.data?.system_prompt),postHistory:Rt(n?.post_history_instructions,n?.data?.post_history_instructions),creator:Rt(n?.creator,n?.data?.creator)},a=n?.character_book??n?.data?.character_book;a&&(e.worldBookName=Rt(a?.name),e.worldBookCount=Array.isArray(a?.entries)?a.entries.length:void 0);return Boolean(e.description)||Boolean(e.personality)||Boolean(e.scenario)||Boolean(e.creatorNotes)||Boolean(e.systemPrompt)||Boolean(e.postHistory)||Boolean(e.creator)||Boolean(e.worldBookName)||'number'==typeof e.worldBookCount?e:null}function Rt(...n){for(const e of n)if('string'==typeof e){const n=e.trim();if(n)return n}return''}function Ut(n){if(!n)return null;const e='string'==typeof n?.first_mes?n.first_mes:n?.data?.first_mes,a='string'==typeof e&&e.trim()?1:0,t=n?.alternate_greetings??n?.data?.alternate_greetings??n?.extensions?.alternate_greetings??n?.data?.extensions?.alternate_greetings;let r=0;return Array.isArray(t)?r=t.filter(n=>'string'==typeof n&&n.trim()).length:'string'==typeof t&&t.trim()&&(r=1),{total:a+r,alternate:r}}function qt(n){if(!n)return[];const e=[],a='string'==typeof n?.first_mes?n.first_mes:n?.data?.first_mes;'string'==typeof a&&a.trim()&&e.push(a.trim());const t=n?.alternate_greetings??n?.data?.alternate_greetings??n?.extensions?.alternate_greetings??n?.data?.extensions?.alternate_greetings;return Array.isArray(t)?t.forEach(n=>{'string'==typeof n&&n.trim()&&e.push(n.trim())}):'string'==typeof t&&t.trim()&&e.push(t.trim()),e}function Kt(n){return n.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}function Wt(n){if('number'==typeof n&&!Number.isNaN(n)){return new Date(n<1e12?1e3*n:n).toLocaleString('zh-CN',{hour12:!1})}if('string'==typeof n){const e=n.trim();if(e)return e}return''}function Qt(n){if('number'==typeof n&&!Number.isNaN(n))return n<1e12?1e3*n:n;if('string'==typeof n){const e=Date.parse(n);if(!Number.isNaN(e))return e}return null}function Zt(n){const e=[n?.last_message_time,n?.last_message_date,n?.update_time,n?.last_modified,n?.create_date,n?.timestamp,n?.time];for(const n of e){const e=Qt(n);if(e)return e}const a=Rt(n?.file_name,n?.file_id);return a?function(n){const e=n.replace(/\.jsonl$/i,'').trim().match(/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/);if(!e)return null;const a=Number(e[1]),t=Number(e[2]),r=Number(e[3]),o=e[4]?Number(e[4]):0,i=e[5]?Number(e[5]):0,c=e[6]?Number(e[6]):0;if(!a||!t||!r)return null;const d=new Date(a,t-1,r,o,i,c).getTime();return Number.isNaN(d)?null:d}(a):null}function Xt(n){return[...n].sort((n,e)=>{const a=Zt(n)??0;return(Zt(e)??0)-a})}function Jt(n){const e=[n?.last_message_time,n?.last_message_date,n?.update_time,n?.last_modified,n?.create_date,n?.timestamp,n?.time];for(const n of e){const e=Wt(n);if(e)return e}const a=Rt(n?.file_name,n?.file_id);return a?a.replace(/\.jsonl$/i,''):''}(0,i.watch)(Ba,n=>{ya.value&&rt({...n})},{deep:!0}),(0,i.onMounted)(()=>{const n=ot();wa.value=n,Object.assign(Ba,n),(0,i.nextTick)(()=>rt(n)),ma.value=function(){const n=TavernHelper.getVariables({type:'global'}),e=n?.[ta];return Array.isArray(e)?e.filter(n=>'string'==typeof n):[]}(),xa.value=function(){const n=TavernHelper.getVariables({type:'global'}),e=n?.[ra];if(!e||'object'!=typeof e)return{};const a=Object.entries(e).filter(([,n])=>'number'==typeof n&&!Number.isNaN(n));return Object.fromEntries(a)}(),va.value=function(){const n=TavernHelper.getVariables({type:'global'}),e=n?.[oa];if(!e||'object'!=typeof e)return{};const a=Object.entries(e).filter(([,n])=>'number'==typeof n&&!Number.isNaN(n));return Object.fromEntries(a)}(),nr(C.value),er(C.value)}),(0,i.watch)([()=>M.search,d,()=>e.value.join('|'),Aa,Ca],()=>{l.value=1}),(0,i.watch)([Na,Va],()=>{l.value>Va.value&&(l.value=Va.value),l.value<1&&(l.value=1)}),(0,i.watch)([Aa,C],()=>{'recent'===Aa.value&&nr(C.value),'imported'===Aa.value&&er(C.value)});let Gt=0;async function nr(n){if('recent'!==Aa.value)return;const e=n.filter(n=>'tavern'===n.origin&&(!('number'==typeof n.lastChatAt&&n.lastChatAt>0)&&Pa(n)<=0));if(!e.length)return;const a=++Gt;for(const n of e){if(a!==Gt||'recent'!==Aa.value)return;if('tavern'!==n.origin)continue;if('number'==typeof n.lastChatAt&&n.lastChatAt>0)continue;const e=Pa(n);let t=null;try{t=await TavernHelper.getChatHistoryBrief(n.name??n.avatar??'',!0)}catch(n){console.warn('[CardHub] 读取聊天简报失败',n)}if(Array.isArray(t)&&t.length){const a=Zt(Xt(t)[0])??0;a>e&&$a(n,a)}await br(80)}}function er(n){const e={...va.value};let a=!1;const t=Date.now();n.forEach((r,o)=>{if('tavern'!==r.origin)return;if('number'==typeof r.createdAt&&r.createdAt>0)return;const i=ja(r);i&&!e[i]&&(e[i]=t-1e3*(n.length-1-o),a=!0)}),a&&Ra(e)}function ar(n){return Jt(n)||'聊天记录'}function tr(n){const e=Rt(n?.file_name,n?.file_id);return e?e.replace(/\.jsonl$/i,''):''}function rr(n){const e=n.split('\n').map(n=>n.trim()).filter(n=>n.length>0),a=[];for(const n of e)n.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(n)||a.push(n);return a}function or(n,e){const a=[];for(let t=0;t<n.length;t+=e){const r=n.slice(t,t+e).trim();r&&a.push(r)}return a}async function ir(n){if('tavern'!==n.origin)return{list:[],summary:null};const e=await TavernHelper.getChatHistoryBrief(n.name??n.avatar??'',!0);if(!Array.isArray(e)||!e.length)return{list:[],summary:{total:0,latest:''}};const a=Xt(e);$a(n,Zt(a[0])??0);const t=a.slice(0,3).map(n=>({name:ar(n),label:tr(n),file:String(n?.file_name??n?.file_id??''),mes:Kt(String(n?.mes??'')).slice(0,120)})),r=Jt(a[0]);return{list:t,summary:{total:e.length,latest:r}}}async function cr(){h.value.length?await sr(h.value[0]):toastr.warning('暂无聊天记录')}async function dr(){if(await lr({ensureSelected:!0}))try{await triggerSlash('/newchat'),Dt(),vr()}catch(n){console.warn('[CardHub] 新聊天失败',n),toastr.error('无法创建新聊天')}}async function sr(n){const e=n.file;if(!e)return void toastr.warning('未找到聊天文件');const a=await lr({ensureSelected:!0});if(!a)return;const{ctx:t,st:r}=a,o=hr(e),i=(t&&'function'==typeof t.openCharacterChat?t.openCharacterChat:null)??(r&&'function'==typeof r.openCharacterChat?r.openCharacterChat:null);if(!i)return void toastr.error('无法打开聊天：缺少接口');try{Promise.resolve(i(o)).catch(n=>{console.warn('[CardHub] 打开聊天失败',n)})}catch(n){console.warn('[CardHub] 打开聊天失败',n)}const c=await async function(n,e,a,t){const r=hr(n),o=Date.now();for(;Date.now()-o<t;){if((e?.chatId??a?.chatId)===r)return!0;await new Promise(n=>setTimeout(n,200))}return!1}(o,t,r,6e3);if(c)return Dt(),void vr();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}async function lr(n={}){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const a='function'==typeof e?.getContext?e.getContext():null;if('function'==typeof a?.getCharacters)try{await a.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色列表失败',n)}const t=a?.characters??e?.characters??[],r=b.value&&Array.isArray(t)?gr(t,b.value):-1;if(r<0)return toastr.warning('未找到角色索引，请先手动切到该角色后再试'),null;const o=(a&&'function'==typeof a.selectCharacterById?a.selectCharacterById:null)??(e&&'function'==typeof e.selectCharacterById?e.selectCharacterById:null);if(!o)return toastr.warning('无法切换角色，请先手动切到该角色后再试'),null;try{await o(r,{switchMenu:!1})}catch(n){console.warn('[CardHub] 切换角色失败',n)}const i=await ur(r,a,e,3e3);return n.ensureSelected&&!i?(toastr.warning('角色切换未完成，请稍后再试'),null):{ctx:a,st:e,idx:r}}async function ur(n,e,a,t){const r=String(n),o=Date.now();for(;Date.now()-o<t;){if(pr(e,a)===r)return!0;await br(80)}return!1}function pr(n,e){const a=n?.characterId??e?.characterId??'';return null==a?'':String(a)}function br(n){return new Promise(e=>setTimeout(e,n))}function gr(n,e){const a=Ct(e.name),t=e.avatar?xt(e.avatar):'',r=t?n.findIndex(n=>xt(String(n.avatar??''))===t):-1;if(r>=0)return r;const o=n.findIndex(n=>Ct(String(n.name??''))===a);return o>=0?o:n.findIndex(n=>Ct(String(n?.data?.name??''))===a)}function hr(n){return n.endsWith('.jsonl')?n:`${n}.jsonl`}async function mr(n){if('library'===n.origin){if('confirm'!==await vt({title:'删除角色',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'删除',cancelLabel:'取消'}))return;return O(D(n.id)),void Dt()}if('confirm'!==await vt({title:'删除角色',message:`确定要删除「${n.name}」吗？`,confirmLabel:'继续',cancelLabel:'取消'}))return;const e=await vt({title:'删除方式',message:`删除「${n.name}」：\n- 移到私有库：可在私有库中找回\n- 永久删除：不可恢复`,confirmLabel:'移到私有库',altLabel:'永久删除',cancelLabel:'取消'});if('cancel'===e)return;if('confirm'===e){await async function(n){if(!n.avatar)return;const e=TavernHelper.getCharAvatarPath(n.avatar);if(!e)return void toastr.error('无法导出：缺少头像信息');const a=await fetch(e,{cache:'no-cache'}),t=await a.blob(),r=await V([new File([t],`${n.name}.png`,{type:'image/png'})]);O(r)}(n);if(!await fr(n,!1))return;Dt();return void Y(await c())}if('confirm'!==await vt({title:'永久删除',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'永久删除',cancelLabel:'取消'}))return;if(!await fr(n,!0))return;Dt();Y(await c())}async function fr(n,e){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let a;try{a=window.parent?.SillyTavern}catch{a=void 0}a??=SillyTavern;const t='function'==typeof a?.getContext?a.getContext():null,r=t?.characters??a?.characters??[],o=gr(r,n),i=pr(t,a);if(o>=0&&i&&String(o)===String(i))if(r.length>1){const n=0===o?1:0,e=(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null)??(a&&'function'==typeof a.selectCharacterById?a.selectCharacterById:null);if(e)try{await e(n,{switchMenu:!1}),await ur(n,t,a,3e3)}catch(n){console.warn('[CardHub] 删除前切换角色失败',n)}}else toastr.warning('当前角色为唯一角色，删除后酒馆可能需要刷新');const c=t?.getRequestHeaders?t.getRequestHeaders():a?.getRequestHeaders?.();if(!c||!Object.keys(c).length)return toastr.error('删除失败：无法获取请求头'),!1;const d={avatar_url:n.avatar,delete_chats:e},s=await fetch('/api/characters/delete',{method:'POST',headers:{...c,'Content-Type':'application/json'},body:JSON.stringify(d),cache:'no-cache'});if(s.ok){try{await triggerSlash('/closechat')}catch(n){console.warn('[CardHub] 关闭聊天失败',n)}return!0}const l=await s.text();return toastr.error(`删除失败：${s.status} ${l||s.statusText}`),!1}function Ar(n,e){const a=URL.createObjectURL(n),t=document.createElement('a');t.href=a,t.download=e,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(a)}async function Cr(n){const e=await fetch(n);return await e.blob()}async function xr(){I(!0);try{Y(await c()),O(N())}finally{I(!1)}}function vr(){L(!1)}return(n,c)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{class:(0,i.normalizeClass)(['cardhub-root',{open:(0,i.unref)(M).open}]),style:(0,i.normalizeStyle)(ka.value)},[(0,i.createElementVNode)('div',{class:'cardhub-backdrop',onClick:vr}),(0,i.createElementVNode)('section',q,[(0,i.createElementVNode)('header',{class:'cardhub-header'},[c[59]||(c[59]=(0,i.createElementVNode)('div',{class:'cardhub-title'},[(0,i.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,i.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,i.createElementVNode)('div',{class:'cardhub-actions'},[(0,i.createElementVNode)('button',{class:'cardhub-theme-trigger',type:'button','aria-label':'配色',onClick:it},[...c[57]||(c[57]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-palette','aria-hidden':'true'},null,-1)])]),(0,i.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:vr},[...c[58]||(c[58]=[(0,i.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,i.createElementVNode)('div',K,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[0]||(c[0]=n=>(0,i.unref)(M).search=n),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[i.vModelText,(0,i.unref)(M).search]]),(0,i.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:xr},'刷新'),(0,i.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:Et},'导入'),(0,i.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:St},'批量导出'),(0,i.createElementVNode)('input',{ref_key:'importInput',ref:u,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:Tt},null,544)]),(0,i.createElementVNode)('div',W,[(0,i.createElementVNode)('div',Q,[(0,i.createElementVNode)('div',Z,[(0,i.createElementVNode)('div',X,[c[60]||(c[60]=(0,i.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,i.createElementVNode)('div',J,[(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'all'===d.value}]),type:'button',onClick:c[1]||(c[1]=n=>d.value='all')},' 全部 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'imported'===d.value}]),type:'button',onClick:c[2]||(c[2]=n=>d.value='imported')},' 已导入 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===d.value}]),type:'button',onClick:c[3]||(c[3]=n=>d.value='unimported')},' 未导入 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':Ca.value}]),type:'button',onClick:c[4]||(c[4]=n=>Ca.value=!Ca.value)},' 收藏 ',2)])]),(0,i.createElementVNode)('div',G,[c[61]||(c[61]=(0,i.createElementVNode)('div',{class:'cardhub-section-title'},'排序',-1)),(0,i.createElementVNode)('div',nn,[(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'recent'===Aa.value}]),type:'button',onClick:c[5]||(c[5]=n=>Aa.value='recent')},' 最近聊天 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'name'===Aa.value}]),type:'button',onClick:c[6]||(c[6]=n=>Aa.value='name')},' 名称 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'tags'===Aa.value}]),type:'button',onClick:c[7]||(c[7]=n=>Aa.value='tags')},' 标签数量 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-chip',{'is-active':'imported'===Aa.value}]),type:'button',onClick:c[8]||(c[8]=n=>Aa.value='imported')},' 导入时间 ',2)])])]),c[62]||(c[62]=(0,i.createElementVNode)('div',{class:'cardhub-divider'},null,-1)),c[63]||(c[63]=(0,i.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,i.createElementVNode)('div',en,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ma.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:n,class:(0,i.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':e.value.includes(n)}]),type:'button',onClick:e=>Za(n)},(0,i.toDisplayString)(n),11,an))),128))]),e.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:Xa},' 清空标签 ')):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{class:'cardhub-chip cardhub-chip--more',type:'button',onClick:c[9]||(c[9]=n=>Ja('filter'))},' 标签管理 ')]),(0,i.createElementVNode)('div',tn,[(0,i.unref)(M).loading?((0,i.openBlock)(),(0,i.createElementBlock)('div',rn,'正在读取角色卡...')):Na.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',cn,[(0,i.createElementVNode)('div',dn,[Va.value>1?((0,i.openBlock)(),(0,i.createElementBlock)('div',sn,[(0,i.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:l.value<=1,onClick:ft},' 上一页 ',8,ln),(0,i.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:l.value>=Va.value,onClick:At},' 下一页 ',8,un)])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('span',pn,'第 '+(0,i.toDisplayString)(l.value)+' / '+(0,i.toDisplayString)(Va.value)+' 页',1)]),(0,i.createElementVNode)('div',bn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Da.value,n=>{return(0,i.openBlock)(),(0,i.createElementBlock)('article',{key:n.id,class:'cardhub-card',onClick:e=>Vt(n)},[(0,i.createElementVNode)('div',{class:(0,i.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(La(n))}]),style:(0,i.normalizeStyle)(Ia(n))},[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(n.name.slice(0,1)||'?'),1)],6),(0,i.createElementVNode)('div',hn,[(0,i.createElementVNode)('div',mn,[(0,i.createElementVNode)('div',fn,(0,i.toDisplayString)(n.name),1),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-fav',{'is-active':(e=n.id,fa.value.has(e))}]),type:'button','aria-label':'收藏',onClick:(0,i.withModifiers)(e=>Ua(n),['stop'])},[...c[64]||(c[64]=[(0,i.createElementVNode)('i',{class:'fa-solid fa-star','aria-hidden':'true'},null,-1)])],10,An)]),(0,i.createElementVNode)('div',Cn,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===n.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(Ya(n).length)+' 标签',1)]),(0,i.createElementVNode)('div',xn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ya(n),e=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:e,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:(0,i.withModifiers)(a=>function(n,e){kt(n,R(n).filter(n=>n!==e))}(n,e),['stop'])},[(0,i.createTextVNode)((0,i.toDisplayString)(e)+' ',1),c[65]||(c[65]=(0,i.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,vn))),128)),r.value!==yt(n)?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:(0,i.withModifiers)(e=>function(n){r.value=yt(n),o.value='',(0,i.nextTick)(()=>{const n=document.querySelector('.cardhub-tag-input');n?.focus()})}(n),['stop'])},' + 标签 ',8,_n)):((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,class:'cardhub-tag-edit',onClick:c[11]||(c[11]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[12]||(c[12]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[13]||(c[13]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[10]||(c[10]=n=>o.value=n),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,i.withKeys)((0,i.withModifiers)(e=>wt(n),['prevent']),['enter']),(0,i.withKeys)((0,i.withModifiers)(Bt,['prevent']),['esc'])],onBlur:e=>wt(n)},null,40,yn),[[i.vModelText,o.value]]),(0,i.createElementVNode)('button',{class:'cardhub-tag-confirm',type:'button',onClick:e=>wt(n)},'✔',8,wn)],32))])]),(0,i.createElementVNode)('div',Bn,[(0,i.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,i.withModifiers)(e=>Ft(n),['stop']),onPointerdown:c[14]||(c[14]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[15]||(c[15]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[16]||(c[16]=(0,i.withModifiers)(()=>{},['stop']))},(0,i.toDisplayString)('tavern'===n.origin?'导出':'导入'),41,kn),(0,i.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,i.withModifiers)(e=>Vt(n),['stop']),onPointerdown:c[17]||(c[17]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[18]||(c[18]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[19]||(c[19]=(0,i.withModifiers)(()=>{},['stop']))},' 管理 ',40,En)])],8,gn);var e}),128))])])):((0,i.openBlock)(),(0,i.createElementBlock)('div',on,'暂无角色卡，或没有匹配的搜索结果。'))])])]),b.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:0,class:'cardhub-manage',onClick:(0,i.withModifiers)(Dt,['self'])},[(0,i.createElementVNode)('div',Tn,[(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Dt},'×'),(0,i.createElementVNode)('div',Sn,[(0,i.createElementVNode)('div',zn,[(0,i.createElementVNode)('div',Fn,(0,i.toDisplayString)(b.value.name),1),(0,i.createElementVNode)('div',Nn,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===b.value.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(Ya(b.value).length)+' 标签',1)]),(0,i.createElementVNode)('div',Vn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ya(b.value),n=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,class:'cardhub-preview__tag'},(0,i.toDisplayString)(n),1))),128))]),(0,i.createElementVNode)('div',Dn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Fa.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:n.label,class:'cardhub-manage__overview-card'},[(0,i.createElementVNode)('div',Mn,(0,i.toDisplayString)(n.label),1),(0,i.createElementVNode)('div',Ln,(0,i.toDisplayString)(n.value),1),n.hint?((0,i.openBlock)(),(0,i.createElementBlock)('div',In,(0,i.toDisplayString)(n.hint),1)):(0,i.createCommentVNode)('v-if',!0)]))),128))])]),(0,i.createElementVNode)('div',Yn,[Ka.value?((0,i.openBlock)(),(0,i.createElementBlock)('img',{key:0,src:Ka.value,alt:''},null,8,On)):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createElementVNode)('div',jn,[c[66]||(c[66]=(0,i.createElementVNode)('div',{class:'cardhub-manage__label'},'角色卡预览',-1)),Ta.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',Hn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ta.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:n.label,class:'cardhub-manage__detail'},[(0,i.createElementVNode)('div',Pn,(0,i.toDisplayString)(n.label),1),(0,i.createElementVNode)('div',$n,(0,i.toDisplayString)(n.value),1)]))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',Rn,(0,i.toDisplayString)(Sa.value),1))]),(0,i.createElementVNode)('div',Un,[c[67]||(c[67]=(0,i.createElementVNode)('div',{class:'cardhub-manage__label'},'开场白',-1)),(0,i.createElementVNode)('div',qn,[m.value.length?((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,{key:0},(0,i.renderList)(m.value,(n,e)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e,class:'cardhub-manage__opening'},(0,i.toDisplayString)(n),1))),128)):((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,{key:1},[(0,i.createTextVNode)('暂无开场白')],64))])]),(0,i.createElementVNode)('div',Kn,[(0,i.createElementVNode)('div',Wn,[c[68]||(c[68]=(0,i.createElementVNode)('span',null,'最近聊天',-1)),(0,i.createElementVNode)('div',Qn,[(0,i.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:cr,onPointerdown:c[20]||(c[20]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[21]||(c[21]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[22]||(c[22]=(0,i.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32),(0,i.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:dr,onPointerdown:c[23]||(c[23]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[24]||(c[24]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[25]||(c[25]=(0,i.withModifiers)(()=>{},['stop']))},' 新聊天 ',32)])]),h.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',Zn,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(h.value,(n,e)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:e,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:e=>sr(n),onKeydown:(0,i.withKeys)((0,i.withModifiers)(e=>sr(n),['prevent']),['enter'])},[(0,i.createElementVNode)('div',Jn,[(0,i.createElementVNode)('div',Gn,(0,i.toDisplayString)(n.name),1),n.label&&n.label!==n.name?((0,i.openBlock)(),(0,i.createElementBlock)('div',ne,(0,i.toDisplayString)(n.label),1)):(0,i.createCommentVNode)('v-if',!0)]),(0,i.createElementVNode)('span',ee,(0,i.toDisplayString)(n.mes),1)],40,Xn))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)('div',ae,(0,i.toDisplayString)(za.value),1))]),(0,i.createElementVNode)('div',te,[(0,i.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:c[26]||(c[26]=(0,i.withModifiers)(n=>Ft(b.value),['stop'])),onPointerdown:c[27]||(c[27]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[28]||(c[28]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[29]||(c[29]=(0,i.withModifiers)(()=>{},['stop']))},(0,i.toDisplayString)('tavern'===b.value.origin?'导出':'导入'),33),(0,i.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:c[30]||(c[30]=(0,i.withModifiers)(n=>mr(b.value),['stop'])),onPointerdown:c[31]||(c[31]=(0,i.withModifiers)(()=>{},['stop'])),onMousedown:c[32]||(c[32]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:c[33]||(c[33]=(0,i.withModifiers)(()=>{},['stop']))},' 删除 ',32)])])])):(0,i.createCommentVNode)('v-if',!0),A.open?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:1,class:'cardhub-confirm',onClick:c[37]||(c[37]=(0,i.withModifiers)(n=>_t('cancel'),['self']))},[(0,i.createElementVNode)('div',re,[(0,i.createElementVNode)('div',oe,(0,i.toDisplayString)(A.title),1),(0,i.createElementVNode)('div',ie,(0,i.toDisplayString)(A.message),1),(0,i.createElementVNode)('div',ce,[(0,i.createElementVNode)('button',{class:'cardhub-confirm__button is-cancel',type:'button',onClick:c[34]||(c[34]=n=>_t('cancel'))},(0,i.toDisplayString)(A.cancelLabel),1),A.altLabel?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-confirm__button is-danger',type:'button',onClick:c[35]||(c[35]=n=>_t('alt'))},(0,i.toDisplayString)(A.altLabel),1)):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('button',{class:'cardhub-confirm__button is-confirm',type:'button',onClick:c[36]||(c[36]=n=>_t('confirm'))},(0,i.toDisplayString)(A.confirmLabel),1)])])])):(0,i.createCommentVNode)('v-if',!0),a.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:2,class:'cardhub-tag-manager',onClick:(0,i.withModifiers)(Ga,['self'])},[(0,i.createElementVNode)('div',de,[(0,i.createElementVNode)('div',se,[(0,i.createElementVNode)('div',null,[c[69]||(c[69]=(0,i.createElementVNode)('div',{class:'cardhub-tag-manager__title'},'标签管理',-1)),'filter'===t.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',le,' 已选 '+(0,i.toDisplayString)(e.value.length)+' / '+(0,i.toDisplayString)(Ma.value.length),1)):((0,i.openBlock)(),(0,i.createElementBlock)('div',ue,' 已选 '+(0,i.toDisplayString)(j.value.length)+' / '+(0,i.toDisplayString)(ba.value.length),1))]),(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Ga},'×')]),(0,i.createElementVNode)('div',pe,[(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'filter'===t.value}]),type:'button',onClick:c[38]||(c[38]=n=>Ja('filter'))},' 标签筛选 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'batch'===t.value}]),type:'button',onClick:c[39]||(c[39]=n=>Ja('batch'))},' 批量标签 ',2)]),'filter'===t.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',be,[(0,i.createElementVNode)('div',ge,[(0,i.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-secondary',type:'button',disabled:!e.value.length,onClick:Xa},' 清空 ',8,he),c[70]||(c[70]=(0,i.createElementVNode)('div',{class:'cardhub-tag-manager__spacer'},null,-1)),(0,i.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-primary',type:'button',onClick:Ga},'完成')]),(0,i.createElementVNode)('div',me,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ma.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:n,class:(0,i.normalizeClass)(['cardhub-tag-manager__chip',{'is-active':e.value.includes(n)}]),type:'button',onClick:e=>Za(n)},(0,i.toDisplayString)(n),11,fe))),128))])])):((0,i.openBlock)(),(0,i.createElementBlock)('div',Ae,[(0,i.createElementVNode)('div',Ce,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[40]||(c[40]=n=>H.value=n),class:'cardhub-batch__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[i.vModelText,H.value]]),c[71]||(c[71]=(0,i.createElementVNode)('div',{class:'cardhub-batch__hint'},'提示：可先在主界面筛选，再切换到批量标签。',-1))]),(0,i.createElementVNode)('div',xe,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[41]||(c[41]=n=>P.value=n),type:'text',placeholder:'输入标签，逗号/换行分隔'},null,512),[[i.vModelText,P.value]])]),ha.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('div',ve,[c[72]||(c[72]=(0,i.createElementVNode)('span',{class:'cardhub-batch__suggest-title'},'已有标签',-1)),(0,i.createElementVNode)('div',_e,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(ha.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:n,class:(0,i.normalizeClass)(['cardhub-batch__chip',{'is-active':ca.value.includes(n)}]),type:'button',onClick:e=>function(n){ca.value.includes(n)?ca.value=ca.value.filter(e=>e!==n):ca.value=[...ca.value,n]}(n)},(0,i.toDisplayString)(n),11,ye))),128))])])):(0,i.createCommentVNode)('v-if',!0),(0,i.createElementVNode)('div',we,[(0,i.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:pt},'全选'),(0,i.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:bt},'清空'),c[73]||(c[73]=(0,i.createElementVNode)('div',{class:'cardhub-batch__spacer'},null,-1)),(0,i.createElementVNode)('button',{class:'cardhub-batch__btn is-ghost',type:'button',onClick:c[42]||(c[42]=n=>gt('remove'))},' 移除标签 '),(0,i.createElementVNode)('button',{class:'cardhub-batch__btn is-primary',type:'button',onClick:c[43]||(c[43]=n=>gt('add'))},'添加标签')]),(0,i.createElementVNode)('div',Be,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(ba.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('label',{key:n.id,class:'cardhub-batch__item'},[(0,i.createElementVNode)('input',{class:'cardhub-batch__checkbox',type:'checkbox',checked:ga.value.has(n.id),onChange:e=>{return a=n.id,void(ga.value.has(a)?j.value=j.value.filter(n=>n!==a):j.value=[...j.value,a]);var a}},null,40,ke),(0,i.createElementVNode)('div',Ee,[(0,i.createElementVNode)('div',Te,(0,i.toDisplayString)(n.name),1),(0,i.createElementVNode)('div',Se,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===n.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(Ya(n).length)+' 标签',1)]),Ya(n).length?((0,i.openBlock)(),(0,i.createElementBlock)('div',ze,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ya(n).slice(0,3),n=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,class:'cardhub-batch__tag'},(0,i.toDisplayString)(n),1))),128))])):(0,i.createCommentVNode)('v-if',!0)])]))),128))])]))])])):(0,i.createCommentVNode)('v-if',!0),B.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:3,class:'cardhub-export',onClick:(0,i.withModifiers)(ut,['self'])},[(0,i.createElementVNode)('div',Fe,[(0,i.createElementVNode)('div',Ne,[(0,i.createElementVNode)('div',null,[c[74]||(c[74]=(0,i.createElementVNode)('div',{class:'cardhub-export__title'},'批量导出',-1)),(0,i.createElementVNode)('div',Ve,' 已选 '+(0,i.toDisplayString)(ua.value.length)+' / '+(0,i.toDisplayString)(sa.value.length),1)]),(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:ut},'×')]),(0,i.createElementVNode)('div',De,[(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[44]||(c[44]=n=>T.value=n),class:'cardhub-export__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[i.vModelText,T.value]]),(0,i.createElementVNode)('div',Me,[(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-export__chip',{'is-active':'all'===S.value}]),type:'button',onClick:c[45]||(c[45]=n=>S.value='all')},' 全部 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-export__chip',{'is-active':'imported'===S.value}]),type:'button',onClick:c[46]||(c[46]=n=>S.value='imported')},' 已导入 ',2),(0,i.createElementVNode)('button',{class:(0,i.normalizeClass)(['cardhub-export__chip',{'is-active':'unimported'===S.value}]),type:'button',onClick:c[47]||(c[47]=n=>S.value='unimported')},' 未导入 ',2)]),(0,i.createElementVNode)('div',Le,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(da.value,n=>((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:n,class:(0,i.normalizeClass)(['cardhub-export__chip',{'is-active':F.value.includes(n)}]),type:'button',onClick:e=>function(n){F.value.includes(n)?F.value=F.value.filter(e=>e!==n):F.value=[...F.value,n]}(n)},(0,i.toDisplayString)(n),11,Ie))),128)),F.value.length?((0,i.openBlock)(),(0,i.createElementBlock)('button',{key:0,class:'cardhub-export__chip cardhub-export__chip--clear',type:'button',onClick:lt},' 清空标签 ')):(0,i.createCommentVNode)('v-if',!0)])]),(0,i.createElementVNode)('div',{class:'cardhub-export__toolbar'},[(0,i.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:ht},'全选'),(0,i.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:mt},'清空'),c[75]||(c[75]=(0,i.createElementVNode)('div',{class:'cardhub-export__spacer'},null,-1)),(0,i.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:ut},'取消'),(0,i.createElementVNode)('button',{class:'cardhub-export__btn is-primary',type:'button',onClick:zt},'导出已选')]),(0,i.createElementVNode)('div',Ye,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(sa.value,n=>{return(0,i.openBlock)(),(0,i.createElementBlock)('label',{key:n.id,class:'cardhub-export__item'},[(0,i.createElementVNode)('input',{class:'cardhub-export__checkbox',type:'checkbox',checked:(e=n.id,la.value.has(e)),onChange:e=>function(n){la.value.has(n)?k.value=k.value.filter(e=>e!==n):k.value=[...k.value,n]}(n.id)},null,40,Oe),(0,i.createElementVNode)('div',je,[(0,i.createElementVNode)('div',He,(0,i.toDisplayString)(n.name),1),(0,i.createElementVNode)('div',Pe,[(0,i.createElementVNode)('span',null,(0,i.toDisplayString)('tavern'===n.origin?'已导入':'未导入'),1),(0,i.createElementVNode)('span',null,(0,i.toDisplayString)(Ya(n).length)+' 标签',1)]),Ya(n).length?((0,i.openBlock)(),(0,i.createElementBlock)('div',$e,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ya(n).slice(0,3),n=>((0,i.openBlock)(),(0,i.createElementBlock)('span',{key:n,class:'cardhub-export__tag'},(0,i.toDisplayString)(n),1))),128))])):(0,i.createCommentVNode)('v-if',!0)])]);var e}),128))])])])):(0,i.createCommentVNode)('v-if',!0),ya.value?((0,i.openBlock)(),(0,i.createElementBlock)('div',{key:4,class:'cardhub-theme',onClick:(0,i.withModifiers)(ct,['self'])},[(0,i.createElementVNode)('div',Re,[(0,i.createElementVNode)('div',{class:'cardhub-theme__header'},[c[76]||(c[76]=(0,i.createElementVNode)('div',null,[(0,i.createElementVNode)('div',{class:'cardhub-theme__title'},'配色设置'),(0,i.createElementVNode)('div',{class:'cardhub-theme__subtitle'},'修改后可直接预览，保存到全局')],-1)),(0,i.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:ct},'×')]),(0,i.createElementVNode)('div',Ue,[(0,i.createElementVNode)('label',qe,[c[77]||(c[77]=(0,i.createElementVNode)('span',null,'背景渐变 1',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[48]||(c[48]=n=>Ba.bgStart=n),type:'color'},null,512),[[i.vModelText,Ba.bgStart]])]),(0,i.createElementVNode)('label',Ke,[c[78]||(c[78]=(0,i.createElementVNode)('span',null,'背景渐变 2',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[49]||(c[49]=n=>Ba.bgEnd=n),type:'color'},null,512),[[i.vModelText,Ba.bgEnd]])]),(0,i.createElementVNode)('label',We,[c[79]||(c[79]=(0,i.createElementVNode)('span',null,'卡片/面板底色',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[50]||(c[50]=n=>Ba.surface=n),type:'color'},null,512),[[i.vModelText,Ba.surface]])]),(0,i.createElementVNode)('label',Qe,[c[80]||(c[80]=(0,i.createElementVNode)('span',null,'浅色底',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[51]||(c[51]=n=>Ba.surfaceAlt=n),type:'color'},null,512),[[i.vModelText,Ba.surfaceAlt]])]),(0,i.createElementVNode)('label',Ze,[c[81]||(c[81]=(0,i.createElementVNode)('span',null,'主文本',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[52]||(c[52]=n=>Ba.text=n),type:'color'},null,512),[[i.vModelText,Ba.text]])]),(0,i.createElementVNode)('label',Xe,[c[82]||(c[82]=(0,i.createElementVNode)('span',null,'次级文本',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[53]||(c[53]=n=>Ba.textMuted=n),type:'color'},null,512),[[i.vModelText,Ba.textMuted]])]),(0,i.createElementVNode)('label',Je,[c[83]||(c[83]=(0,i.createElementVNode)('span',null,'强调色',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[54]||(c[54]=n=>Ba.accent=n),type:'color'},null,512),[[i.vModelText,Ba.accent]])]),(0,i.createElementVNode)('label',Ge,[c[84]||(c[84]=(0,i.createElementVNode)('span',null,'强调深色',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[55]||(c[55]=n=>Ba.accentStrong=n),type:'color'},null,512),[[i.vModelText,Ba.accentStrong]])]),(0,i.createElementVNode)('label',na,[c[85]||(c[85]=(0,i.createElementVNode)('span',null,'边框',-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{'onUpdate:modelValue':c[56]||(c[56]=n=>Ba.border=n),type:'color'},null,512),[[i.vModelText,Ba.border]])])]),(0,i.createElementVNode)('div',ea,[((0,i.openBlock)(),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(Ea,n=>(0,i.createElementVNode)('button',{key:n.name,class:'cardhub-theme__preset',type:'button',onClick:e=>function(n){Object.assign(Ba,n.value)}(n)},(0,i.toDisplayString)(n.name),9,aa)),64))]),(0,i.createElementVNode)('div',{class:'cardhub-theme__actions'},[(0,i.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:dt},'恢复默认'),c[86]||(c[86]=(0,i.createElementVNode)('div',{class:'cardhub-theme__spacer'},null,-1)),(0,i.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:ct},'取消'),(0,i.createElementVNode)('button',{class:'cardhub-theme__btn is-primary',type:'button',onClick:st},'保存')])])])):(0,i.createCommentVNode)('v-if',!0)],6))}});a(614);const da=(0,a(455).A)(ca,[['__scopeId','data-v-36d13e32']]);let sa=null,la=null,ua=null;function pa(){la||(ua=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow: 0 6px 16px rgba(var(--cardhub-accent-rgb), 0.2);\n      }\n\n      .cardhub-button:hover {\n        background: rgba(var(--cardhub-accent-rgb), 0.85);\n        color: var(--cardhub-accent-text);\n        box-shadow: 0 8px 18px rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.75);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.18);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.95);\n        color: var(--cardhub-text);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: none;\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.95);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-tag {\n        padding: 2px 6px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 200000;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-tag-manager {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100011;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: none;\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100003;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100004;\n      }\n\n      .cardhub-batch__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 20px;\n        padding: 18px 18px 14px;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        box-shadow: var(--cardhub-shadow-strong);\n        overflow: hidden;\n        margin: auto;\n      }\n\n      .cardhub-batch__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .cardhub-batch__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        display: grid;\n        place-items: center;\n        z-index: 100005;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type=\'color\'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 6px 10px;\n          min-height: 30px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview,\n        .cardhub-manage {\n          position: absolute !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-preview__panel,\n        .cardhub-manage__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n\n        .cardhub-preview__avatar {\n          height: 180px;\n          border-radius: 14px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-preview__actions {\n          gap: 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-tag {\n          font-size: 9px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export {\n          position: fixed !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n        }\n\n        .cardhub-export__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-tag-manager {\n          position: fixed !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n        }\n\n        .cardhub-tag-manager__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch {\n          position: fixed !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n        }\n\n        .cardhub-batch__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 12px !important;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          background: rgba(24, 16, 10, 0.55) !important;\n          backdrop-filter: blur(10px) !important;\n          -webkit-backdrop-filter: blur(10px) !important;\n        }\n\n        .cardhub-theme__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 12px !important;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type=\'color\'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n      }\n    ').appendTo('head'),la=$('<div>').attr('script_id',getScriptId()).addClass('cardhub-mount').appendTo('body'),sa=(0,i.createApp)(da),sa.mount(la[0]),(0,i.watch)(()=>M.open,()=>{},{immediate:!0}))}function ba(){return{open:(n='manual')=>{pa(),L(!0,n)},close:()=>{L(!1)},toggle:(n='manual')=>{pa(),L(!M.open,n)},refresh:async()=>{pa(),await async function(){I(!0);try{Y(await c()),O(N())}finally{I(!1)}}()},destroy:()=>{sa&&sa.unmount(),la&&la.remove(),ua&&ua.remove(),sa=null,la=null,ua=null}}}function ga(){const n=ba(),e=t(n);n.refresh(),$(window).on('pagehide',()=>{e(),n.destroy()})}$(()=>{errorCatched(ga)()});
//# sourceMappingURL=index.js.map