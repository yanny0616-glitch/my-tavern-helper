import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';function e(e){const t=[],r=function(e){const t=`cardhub-entry-${getScriptId()}`,r=$(`#${t}`);if(r.length)return r.addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').empty(),null;const o=function(){const e=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const n of e){const e=$(n).first();if(e.length)return e}const n=$('button, .menu_button, .nav_button').filter((_,e)=>{const n=$(e).text(),a=e.getAttribute('title')??e.getAttribute('aria-label')??'';return/角色管理/.test(n)||/角色管理/.test(a)}).first();if(n.length){const e=n.closest('nav, header, section, div');return e.length?e:n.parent()}return null}();if(!o)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const c=a(()=>e.open('role')),i=$('<button>').attr('id',t).attr('type','button').addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),c()});o.append(i);const l=n(i[0],c);return()=>{i.off('click'),i.remove(),l()}}(e);r&&t.push(r);const o=function(e){const t=`cardhub-magic-${getScriptId()}`,r=$('#extensionsMenuButton');if(!r.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const o=()=>{const r=$('#extensionsMenu');if(!r||r.find(`#${t}`).length)return;const o=a(()=>e.open('magic')),c=$('<div>').attr('id',t).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').html('<i class="fa-solid fa-id-badge" aria-hidden="true"></i><span>角色卡管理器</span>').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),o()});r.append(c);const i=n(c[0],o);c.data('cardhub-dispose',i)};r.on('click.cardhub',()=>{setTimeout(o,0)});const c=new MutationObserver(()=>o()),i=window.parent?.document??document;return c.observe(i.body,{childList:!0,subtree:!0}),()=>{c.disconnect(),r.off('click.cardhub'),$(`#${t}`).remove()}}(e);return o&&t.push(o),()=>{t.forEach(e=>e())}}function n(e,n){const a=e=>{e.preventDefault(),e.stopImmediatePropagation(),n()};return e.addEventListener('pointerdown',a,{capture:!0}),e.addEventListener('mousedown',a,{capture:!0}),e.addEventListener('touchstart',a,{capture:!0}),()=>{e.removeEventListener('pointerdown',a,{capture:!0}),e.removeEventListener('mousedown',a,{capture:!0}),e.removeEventListener('touchstart',a,{capture:!0})}}function a(e){let n=0;return()=>{const a=Date.now();a-n<250||(n=a,e())}}async function t(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const n='function'==typeof e?.getContext?e.getContext():null;if('function'==typeof n?.getCharacters)try{await n.getCharacters()}catch(e){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',e)}const a=n?.characters??SillyTavern?.characters??[],t=new Map,o=new Map,c=new Map;return Array.isArray(n?.tags)&&n.tags.forEach(e=>{e?.id&&e?.name&&c.set(e.id,e.name)}),a.map((e,a)=>{const i=e.tags??e.data?.tags??[],l=e.avatar,d=e.name??'未命名角色',s=e?.create_date??e?.date_added??e?.created??e?.created_at??e?.timestamp??e?.time??e?.data?.create_date??e?.data?.date_added??e?.data?.created??e?.data?.created_at??e?.data?.timestamp??e?.data?.time??null,u=r(s)??0,b=s??String(a),p=l??`name:${d}::${b}`;let g=p;if(!l){const e=o.get(p)??0;o.set(p,e+1),e&&(g=`${p}::${e}`)}const h=Boolean(n?.tagMap&&Object.prototype.hasOwnProperty.call(n.tagMap,g)),m=(h?n.tagMap[g]??[]:[]).map(e=>c.get(e)).filter(Boolean),f=h?m:i,v=l?`avatar:${l}`:`name:${d}::${b}`,x=t.get(v)??0;t.set(v,x+1);const y=x?`${v}::${x}`:v,w=e?.last_interaction??e?.last_interaction_time??e?.last_interaction_date??e?.last_chat_time??e?.last_chat_date??e?.last_message_time??e?.last_message_date??e?.update_time??e?.last_modified??e?.timestamp??e?.time??e?.data?.last_interaction??e?.data?.last_interaction_time??e?.data?.last_interaction_date??e?.data?.last_chat_time??e?.data?.last_chat_date??e?.data?.last_message_time??e?.data?.last_message_date??e?.data?.update_time??e?.data?.last_modified??e?.data?.timestamp??e?.data?.time??null;return{id:y,name:d,avatar:e.avatar??null,tags:f,tagKey:g,origin:'tavern',createdAt:u,lastChatAt:r(w)??0}})}function r(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function o(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const n=16*Math.random()|0;return('x'===e?n:3&n|8).toString(16)})}const c='cardhub_state',i={library:'cardhub_library',theme:'cardhub_theme',favorites:'cardhub_favorites',lastChatCache:'cardhub_last_chat_cache',importCache:'cardhub_import_cache',notes:'cardhub_notes',storageSettings:'cardhub_storage_settings'};function l(){return TavernHelper.getVariables({type:'global'})??{}}function d(e){TavernHelper.replaceVariables(e,{type:'global'})}function s(){const e=l();var n;let a=!1;const t={...(n=e[c])&&'object'==typeof n?n:{}};if(!t.library&&e[i.library]&&'object'==typeof e[i.library]&&(t.library=e[i.library],a=!0),!t.theme&&e[i.theme]&&(t.theme=e[i.theme],a=!0),!t.favorites&&e[i.favorites]&&(t.favorites=e[i.favorites],a=!0),!t.lastChatCache&&e[i.lastChatCache]&&(t.lastChatCache=e[i.lastChatCache],a=!0),!t.importCache&&e[i.importCache]&&(t.importCache=e[i.importCache],a=!0),!t.notes&&e[i.notes]&&(t.notes=e[i.notes],a=!0),!t.storageSettings&&e[i.storageSettings]&&(t.storageSettings=e[i.storageSettings],a=!0),a){const n={...e,[c]:t};Object.values(i).forEach(e=>{delete n[e]}),d(n)}return t}function u(e){const n={...s(),...e};return function(e){const n={...l(),[c]:e};Object.values(i).forEach(e=>{delete n[e]}),d(n)}(n),n}const b={mode:'variables'};function p(){const e=s();return function(e){if(!e||'object'!=typeof e)return{...b};const n=e,a='string'==typeof n.mode?n.mode:b.mode;return{mode:'indexeddb'===a||'variables'===a?a:b.mode}}(e?.storageSettings)}function g(e){u({storageSettings:e})}const h='library',m='entries';let f=null;function v(){return'undefined'!=typeof indexedDB}function x(){return f||(f=new Promise((e,n)=>{const a=indexedDB.open('cardhub_storage',2);a.onerror=()=>n(a.error),a.onupgradeneeded=()=>{const e=a.result;e.objectStoreNames.contains(h)||e.createObjectStore(h)},a.onsuccess=()=>e(a.result)}),f)}function y(){const e=s();if(e?.library&&'object'==typeof e.library){return{entries:Array.isArray(e.library.entries)?e.library.entries:[]}}const n=TavernHelper.getVariables({type:'script',script_id:getScriptId()}),a=n?.cardhub_library;if(!a||'object'!=typeof a)return{entries:[]};const t=Array.isArray(a.entries)?a.entries:[];return t.length&&w(t),{entries:t}}function w(e){u({library:{entries:e}})}async function k(){if('indexeddb'===p().mode){if(!v())return y().entries;try{return await async function(){if(!v())return[];const e=await x();return await new Promise((n,a)=>{const t=e.transaction(h,'readonly').objectStore(h).get(m);t.onerror=()=>a(t.error),t.onsuccess=()=>{const e=t.result;n(Array.isArray(e)?e:[])}})}()}catch(e){return console.warn('[CardHub] 读取 IndexedDB 失败，已回退到变量存储',e),y().entries}}return y().entries}async function E(e,n){if('indexeddb'!==(n??p().mode))w(e);else{if(!v())return void w(e);try{await async function(e){if(!v())return;const n=await x();await new Promise((a,t)=>{const r=n.transaction(h,'readwrite').objectStore(h).put(e,m);r.onerror=()=>t(r.error),r.onsuccess=()=>a()})}(e)}catch(n){console.warn('[CardHub] 写入 IndexedDB 失败，已回退到变量存储',n),w(e)}}}function N(e){return new Promise((n,a)=>{const t=new FileReader;t.onload=()=>n(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsDataURL(e)})}function C(e){return new Promise((n,a)=>{const t=new FileReader;t.onload=()=>n(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsText(e)})}function V(e){try{return JSON.parse(e)}catch{return null}}function S(e){const n=e.trim();if(!n)return null;const a=V(n);if(a)return a;if(!function(e){return!(e.length<16||e.length%4!=0)&&/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const t=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return t?V(t):null}function B(e){const n=e?.tags??e?.data?.tags;return Array.isArray(n)?n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean):[]}function T(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}function D(e){return(new TextDecoder).decode(e)}function A(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function M(e){const n=e.indexOf(0);if(n<0)return null;const a=D(e.subarray(0,n)).trim(),t=D(e.subarray(n+1)).trim();return a&&t?{key:a,value:t}:null}function L(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=D(e.subarray(0,n)).trim(),t=1===e[n+1];let r=n+2;const o=e.indexOf(0,r);if(o<0)return null;r=o+1;const c=e.indexOf(0,r);if(c<0)return null;if(r=c+1,t)return null;const i=D(e.subarray(r)).trim();return a&&i?{key:a,value:i}:null}function j(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let t=8;for(;t+8<=e.length;){const n=A(e,t),r=D(e.subarray(t+4,t+8)),o=t+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===r){const e=M(i);e&&a.push(e)}else if('iTXt'===r){const e=L(i);e&&a.push(e)}t=c+4}return a}function F(e){const n=T(e);if(!n)return null;const a=j(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=S(e.value),a=n?.name??n?.data?.name;if('string'==typeof a&&a.trim())return a.trim()}return null}function I(e){const n=T(e);if(!n)return[];const a=j(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=S(e.value);if(n){const e=B(n);if(e.length)return e}}return[]}function O(e){const n=V(e);return n?B(n):[]}function P(e){return e.replace(/\.(png|json)$/i,'')}function U(e){if(null===e||'object'!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return`[${e.map(e=>U(e)).join(',')}]`;return`{${Object.entries(e).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${JSON.stringify(e)}:${U(n)}`).join(',')}}`}function H(e,n){let a=n;if('json'===e){const e=n.trim();try{a=U(JSON.parse(e))}catch{a=e}}return`${e}:${function(e){let n=5381;for(let a=0;a<e.length;a+=1)n=33*n^e.charCodeAt(a);return(n>>>0).toString(16)}(a)}`}function R(e){if(e.fingerprint)return e.fingerprint;if(!e.rawType||!e.raw)return null;const n=H(e.rawType,e.raw);return e.fingerprint=n,n}function K(e){let n=!1;const a=Date.now();return{entries:e.map((t,r)=>{const c={...t,id:t.id??o(),origin:t.origin??'library',tags:Array.isArray(t.tags)?t.tags:[],note:'string'==typeof t.note?t.note:''};if(!c.tagsEdited&&!c.tags.length&&c.raw&&c.rawType){const e='png'===c.rawType?I(c.raw):O(c.raw);e.length&&(c.tags=e,n=!0)}return'number'==typeof c.createdAt?c:(n=!0,{...c,createdAt:a-1e3*(e.length-1-r)})}),changed:n}}function Y(e){return K(e).entries}async function J(){const e=await k(),{entries:n,changed:a}=K(e);return a&&E(n),n}async function W(e,n){const a=Array.from(e);if(!a.length)return await J();const t=Array.isArray(n)&&n.length?n:await J(),r=new Set;t.forEach(e=>{const n=R(e);n&&r.add(n)});const c=[];for(const e of a){const n=P(e.name);if(e.name.toLowerCase().endsWith('.png')){const a=await N(e),t=F(a)??n,i=I(a),l=H('png',a);if(r.has(l))continue;r.add(l),c.push({id:o(),name:t,avatar:a,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'png',raw:a,fingerprint:l,createdAt:Date.now()})}else if(e.name.toLowerCase().endsWith('.json')){const a=await C(e);let t=n;try{const e=JSON.parse(a);t=e.name??e.data?.name??t}catch{}const i=O(a),l=H('json',a);if(r.has(l))continue;r.add(l),c.push({id:o(),name:t,avatar:null,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'json',raw:a,fingerprint:l,createdAt:Date.now()})}}const i=[...t,...c];return E(i),i}function q(e){const n=V(e);if(!n||'object'!=typeof n)return null;const a=n.entries;return Array.isArray(a)?a:null}function X(e,n){const a=Y(n),t=new Set,r=[];return e.forEach(e=>{const n=R(e);n&&t.add(n),r.push(e)}),a.forEach(e=>{const n=R(e);n&&t.has(n)||(n&&t.add(n),r.push(e))}),r}function Z(e,n){const a=(Array.isArray(n)&&n.length?n:[]).filter(n=>n.id!==e);return E(a),a}const G=Vue,Q=(0,G.reactive)({open:!1,loading:!1,search:'',lastOpenSource:'manual',characters:[],library:[]});function ee(e,n){Q.open=e,n&&(Q.lastOpenSource=n)}function ne(e){Q.loading=e}function ae(e){Q.characters=e}function te(e){Q.library=e.map(e=>({...e,origin:e.origin??'library',tags:Array.isArray(e.tags)?e.tags:[],note:'string'==typeof e.note?e.note:''}))}function re(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}return e??=SillyTavern,'function'!=typeof e?.getContext?null:e.getContext()}function oe(e){Array.isArray(e.tags)||(e.tags=[]),e.tagMap||(e.tagMap={})}function ce(e){if('library'===e.origin)return e.tags??[];const n=function(e){if(!e)return{hasKey:!1,tags:[]};const n=re();if(!n||!n.tagMap||!Array.isArray(n.tags))return{hasKey:!1,tags:[]};if(!Object.prototype.hasOwnProperty.call(n.tagMap,e))return{hasKey:!1,tags:[]};const a=new Map;return n.tags.forEach(e=>{e?.id&&e?.name&&a.set(e.id,e.name)}),{hasKey:!0,tags:(n.tagMap[e]??[]).map(e=>a.get(e)).filter(Boolean)}}(e.tagKey??e.avatar);return n.hasKey?n.tags:e.tags??[]}function ie(e,n){const a=re();if(!a)return n;const t=function(e,n){if(!Array.isArray(e.characters))return null;const a=n.avatar?e.characters.find(e=>e.avatar===n.avatar):null;return a||(e.characters.find(e=>e.name===n.name)??null)}(a,e);if(!t)return n;const r=Array.from(new Set(n.map(e=>e.trim().replace(/\s+/g,' ')).filter(Boolean)));t.tags=r,t.data&&(t.data.tags=r),oe(a);const o=r.map(e=>function(e,n){oe(e);const a=e.tags.find(e=>e.name===n);if(a)return a;const t={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:n};return e.tags.push({id:t.id,name:t.name}),t}(a,e).id),c=e.tagKey??t.avatar??null;c&&(a.tagMap[c]=o),a.saveSettingsDebounced?.();const i=window.parent?.SillyTavern??SillyTavern;return i?.saveSettingsDebounced?.(),r}const le={class:'cardhub-manage__section'},de={key:0,class:'cardhub-manage__details'},se={class:'cardhub-manage__detail-head'},ue={class:'cardhub-manage__detail-label'},be=['onClick'],pe={class:'cardhub-manage__detail-content'},ge=['onClick'],he={key:1,class:'cardhub-manage__empty'},me={class:'cardhub-manage__section'},fe={class:'cardhub-manage__label'},ve={class:'cardhub-manage__content'},xe={key:0,class:'cardhub-manage__opening-meta'},_e={class:'cardhub-manage__opening-meta-value'},ye={key:0,class:'cardhub-manage__opening-meta-hint'},we={key:1,class:'cardhub-manage__empty'},ke={key:2,class:'cardhub-manage__empty'},Ee={class:'cardhub-manage__section'},Ne={class:'cardhub-manage__label'},Ce={class:'cardhub-manage__jump-row'},Ve={key:0,class:'cardhub-manage__chat'},Se=['onClick','onKeydown'],ze={class:'cardhub-manage__chat-main'},Be={class:'cardhub-manage__chat-name'},Te={key:0,class:'cardhub-manage__chat-label'},De={class:'cardhub-manage__chat-text'},Ae={key:1,class:'cardhub-manage__empty'},Me={key:2,class:'cardhub-manage__pager'},Le=['disabled'],je={class:'cardhub-manage__pager-status'},$e=['disabled'],Fe={class:'cardhub-manage__actions'},Ie=(0,G.defineComponent)({__name:'ManageContent',props:{manageCard:{},manageDetails:{},manageDetailsHint:{},openingItems:{},openingSummary:{},manageChats:{},pagedChats:{},chatPage:{},chatTotalPages:{},manageChatHint:{},openDetail:{type:Function},openEdit:{type:Function},openOpeningList:{type:Function},openLatestChat:{type:Function},openNewChat:{type:Function},openChat:{type:Function},prevChatPage:{type:Function},nextChatPage:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function}},setup:e=>(n,a)=>((0,G.openBlock)(),(0,G.createElementBlock)(G.Fragment,null,[(0,G.createElementVNode)('div',le,[a[19]||(a[19]=(0,G.createElementVNode)('div',{class:'cardhub-manage__label'},'角色卡预览',-1)),e.manageDetails.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',de,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(e.manageDetails,n=>((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:n.label,class:'cardhub-manage__detail'},[(0,G.createElementVNode)('div',se,[(0,G.createElementVNode)('div',ue,(0,G.toDisplayString)(n.label),1),n.editable?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-manage__detail-edit',type:'button',onClick:a=>e.openEdit(n)},' ✎ ',8,be)):(0,G.createCommentVNode)('v-if',!0)]),(0,G.createElementVNode)('div',pe,(0,G.toDisplayString)(n.preview),1),n.hasMore?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-manage__detail-toggle',type:'button',onClick:a=>e.openDetail(n)},' 查看 ',8,ge)):(0,G.createCommentVNode)('v-if',!0)]))),128))])):((0,G.openBlock)(),(0,G.createElementBlock)('div',he,(0,G.toDisplayString)(e.manageDetailsHint),1))]),(0,G.createElementVNode)('div',me,[(0,G.createElementVNode)('div',fe,[a[20]||(a[20]=(0,G.createElementVNode)('span',null,'开场白',-1)),e.openingItems.length?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-manage__toggle',type:'button',onClick:a[0]||(a[0]=(...n)=>e.openOpeningList&&e.openOpeningList(...n))},' 查看列表（'+(0,G.toDisplayString)(e.openingItems.length)+'） ',1)):(0,G.createCommentVNode)('v-if',!0)]),(0,G.createElementVNode)('div',ve,[e.openingSummary.hasData?((0,G.openBlock)(),(0,G.createElementBlock)('div',xe,[(0,G.createElementVNode)('span',_e,(0,G.toDisplayString)(e.openingSummary.value),1),e.openingSummary.hint?((0,G.openBlock)(),(0,G.createElementBlock)('span',ye,(0,G.toDisplayString)(e.openingSummary.hint),1)):(0,G.createCommentVNode)('v-if',!0)])):(0,G.createCommentVNode)('v-if',!0),e.openingItems.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',ke,'点击“查看列表”浏览开场白')):((0,G.openBlock)(),(0,G.createElementBlock)('div',we,'暂无开场白'))])]),(0,G.createElementVNode)('div',Ee,[(0,G.createElementVNode)('div',Ne,[a[21]||(a[21]=(0,G.createElementVNode)('span',null,'最近聊天',-1)),(0,G.createElementVNode)('div',Ce,[(0,G.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:a[1]||(a[1]=(...n)=>e.openLatestChat&&e.openLatestChat(...n)),onPointerdown:a[2]||(a[2]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[3]||(a[3]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[4]||(a[4]=(0,G.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32),(0,G.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:a[5]||(a[5]=(...n)=>e.openNewChat&&e.openNewChat(...n)),onPointerdown:a[6]||(a[6]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[7]||(a[7]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[8]||(a[8]=(0,G.withModifiers)(()=>{},['stop']))},' 新聊天 ',32)])]),e.pagedChats.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',Ve,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(e.pagedChats,(n,a)=>((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:a,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:a=>e.openChat(n),onKeydown:(0,G.withKeys)((0,G.withModifiers)(a=>e.openChat(n),['prevent']),['enter'])},[(0,G.createElementVNode)('div',ze,[(0,G.createElementVNode)('div',Be,(0,G.toDisplayString)(n.name),1),n.label&&n.label!==n.name?((0,G.openBlock)(),(0,G.createElementBlock)('div',Te,(0,G.toDisplayString)(n.label),1)):(0,G.createCommentVNode)('v-if',!0)]),(0,G.createElementVNode)('span',De,(0,G.toDisplayString)(n.mes),1)],40,Se))),128))])):((0,G.openBlock)(),(0,G.createElementBlock)('div',Ae,(0,G.toDisplayString)(e.manageChatHint),1)),e.chatTotalPages>1?((0,G.openBlock)(),(0,G.createElementBlock)('div',Me,[(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage<=1,onClick:a[9]||(a[9]=(...n)=>e.prevChatPage&&e.prevChatPage(...n))},' 上一页 ',8,Le),(0,G.createElementVNode)('span',je,(0,G.toDisplayString)(e.chatPage)+' / '+(0,G.toDisplayString)(e.chatTotalPages),1),(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage>=e.chatTotalPages,onClick:a[10]||(a[10]=(...n)=>e.nextChatPage&&e.nextChatPage(...n))},' 下一页 ',8,$e)])):(0,G.createCommentVNode)('v-if',!0)]),(0,G.createElementVNode)('div',Fe,[(0,G.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:a[11]||(a[11]=(0,G.withModifiers)(n=>e.handleCardAction(e.manageCard),['stop'])),onPointerdown:a[12]||(a[12]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[13]||(a[13]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[14]||(a[14]=(0,G.withModifiers)(()=>{},['stop']))},(0,G.toDisplayString)('tavern'===e.manageCard.origin?'导出':'导入'),33),(0,G.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:a[15]||(a[15]=(0,G.withModifiers)(n=>e.manageDelete(e.manageCard),['stop'])),onPointerdown:a[16]||(a[16]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[17]||(a[17]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[18]||(a[18]=(0,G.withModifiers)(()=>{},['stop']))},' 删除 ',32)])],64))}),Oe={class:'cardhub-manage__top'},Pe={class:'cardhub-manage__summary'},Ue={class:'cardhub-preview__name'},He={class:'cardhub-preview__meta'},Re={class:'cardhub-preview__tags'},Ke={class:'cardhub-manage__overview'},Ye={class:'cardhub-manage__overview-label'},Je={class:'cardhub-manage__overview-value'},We={key:0,class:'cardhub-manage__overview-hint'},qe={class:'cardhub-manage__media'},Xe=['src'],Ze=(0,G.defineComponent)({__name:'ManageOverview',props:{manageCard:{},manageAvatarUrl:{},manageOverview:{},displayTags:{type:Function},openNoteDialog:{type:Function},worldbookAvailable:{type:Boolean},openWorldbookList:{type:Function}},setup:e=>(n,a)=>((0,G.openBlock)(),(0,G.createElementBlock)('div',Oe,[(0,G.createElementVNode)('div',Pe,[(0,G.createElementVNode)('div',Ue,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(e.manageCard.name),1),(0,G.createElementVNode)('button',{class:'cardhub-note-trigger',type:'button','aria-label':'编辑备注',onClick:a[0]||(a[0]=(...n)=>e.openNoteDialog&&e.openNoteDialog(...n))},[...a[2]||(a[2]=[(0,G.createElementVNode)('i',{class:'fa-solid fa-pen','aria-hidden':'true'},null,-1)])])]),(0,G.createElementVNode)('div',He,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)('tavern'===e.manageCard.origin?'已导入':'未导入'),1),(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(e.displayTags(e.manageCard).length)+' 标签',1)]),(0,G.createElementVNode)('div',Re,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(e.displayTags(e.manageCard),e=>((0,G.openBlock)(),(0,G.createElementBlock)('span',{key:e,class:'cardhub-preview__tag'},(0,G.toDisplayString)(e),1))),128))]),(0,G.createElementVNode)('div',Ke,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(e.manageOverview,n=>((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:n.label,class:'cardhub-manage__overview-card'},[(0,G.createElementVNode)('div',Ye,(0,G.toDisplayString)(n.label),1),(0,G.createElementVNode)('div',Je,(0,G.toDisplayString)(n.value),1),n.hint?((0,G.openBlock)(),(0,G.createElementBlock)('div',We,(0,G.toDisplayString)(n.hint),1)):(0,G.createCommentVNode)('v-if',!0),'世界书'===n.label&&e.worldbookAvailable?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:1,class:'cardhub-manage__overview-action',type:'button',onClick:a[1]||(a[1]=(...n)=>e.openWorldbookList&&e.openWorldbookList(...n))},' 查看 ')):(0,G.createCommentVNode)('v-if',!0)]))),128))])]),(0,G.createElementVNode)('div',qe,[e.manageAvatarUrl?((0,G.openBlock)(),(0,G.createElementBlock)('img',{key:0,src:e.manageAvatarUrl,alt:''},null,8,Xe)):(0,G.createCommentVNode)('v-if',!0)])]))}),Ge={class:'cardhub-manage__panel cardhub-modal__panel',role:'dialog','aria-label':'角色管理'},Qe={class:'cardhub-note__panel cardhub-modal__panel',role:'dialog','aria-label':'备注'},en=['aria-label'],nn={class:'cardhub-edit__header'},an={class:'cardhub-edit__title'},tn={class:'cardhub-edit__actions'},rn=['disabled'],on={class:'cardhub-openings__panel cardhub-modal__panel',role:'dialog','aria-label':'开场白列表'},cn={class:'cardhub-openings__meta'},ln={key:0},dn={key:0,class:'cardhub-openings__list'},sn=['onClick'],un={class:'cardhub-openings__item-title'},bn={class:'cardhub-openings__item-preview'},pn={key:1,class:'cardhub-manage__empty'},gn={key:2,class:'cardhub-manage__pager'},hn=['disabled'],mn={class:'cardhub-manage__pager-status'},fn=['disabled'],vn={class:'cardhub-worldbook__panel cardhub-modal__panel',role:'dialog','aria-label':'世界书'},xn={class:'cardhub-worldbook__header'},_n={class:'cardhub-worldbook__title'},yn={class:'cardhub-worldbook__meta'},wn={key:0},kn={key:0,class:'cardhub-manage__empty'},En={key:1,class:'cardhub-manage__empty'},Nn={key:2,class:'cardhub-worldbook__list'},Cn=['onClick'],Vn={class:'cardhub-worldbook__item-title'},Sn={class:'cardhub-worldbook__item-index'},zn={class:'cardhub-worldbook__item-name'},Bn={key:1,class:'cardhub-worldbook__item-disabled'},Tn={class:'cardhub-worldbook__item-preview'},Dn={key:3,class:'cardhub-manage__empty'},An={key:4,class:'cardhub-manage__pager'},Mn=['disabled'],Ln={class:'cardhub-manage__pager-status'},jn=['disabled'],$n=['aria-label'],Fn={class:'cardhub-manage-viewer__header'},In={class:'cardhub-manage-viewer__title'},On=['innerHTML'],Pn=(0,G.defineComponent)({__name:'ManageModal',props:{card:{},displayTags:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function},closeManage:{type:Function},closeRoot:{type:Function},applyNoteUpdate:{type:Function},parseLibraryCardData:{type:Function},updateLastChatCacheForCard:{type:Function}},setup(e){const n=e,a=(0,G.computed)(()=>n.card),t=(0,G.ref)([]),r=(0,G.ref)([]),o=(0,G.ref)(null),c=(0,G.ref)(null),i=(0,G.ref)([]),l=(0,G.ref)(null),d=(0,G.computed)(()=>a.value?function(e,n=!1){const a=e.avatar;if(!a)return null;if(/^(data:|https?:|\/)/.test(a))return a;if(n&&'tavern'===e.origin)return TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`;return`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`}(a.value,!0):null),s=(0,G.computed)(()=>!a.value||p.value.length?'':'library'===a.value.origin?'未导入卡片暂无可预览内容，可先导入后查看详情。':'暂无角色卡详情。'),u=(0,G.computed)(()=>'library'===a.value?.origin?'未导入卡片暂无聊天记录。':'暂无聊天记录。'),b=(0,G.computed)(()=>{const e=[],n=o.value,a=n?.worldBookName?.trim()||'',t=n?.worldBookCount;let r='未绑定',c='';(a||'number'==typeof t)&&(r=a||'角色世界书',c='number'==typeof t?`${t} 条`:''),e.push({label:'世界书',value:r,hint:c});const i=l.value;let d='暂无聊天',s='';return i&&i.total>0&&(d=`${i.total} 个聊天`,i.latest&&(s=`最近：${i.latest}`)),e.push({label:'聊天概况',value:d,hint:s}),e}),p=(0,G.computed)(()=>{const e=[],n=o.value,t=(n,a,t=240,r=!1,o='')=>{const c=Le(a,3,t),i=a.trim();if(!c&&!r)return;const l=c||(r?'（空）':''),d=Boolean(l)&&i.length>l.replace(/…$/,'').length;e.push({label:n,preview:l,full:i,hasMore:d,editable:r,field:o})};'library'===a.value?.origin&&a.value.importFileName&&t('导入文件名',a.value.importFileName,120),a.value?.note?.trim()&&t('备注',a.value.note.trim(),200);const r='tavern'===a.value?.origin;return n&&(t('角色描述',n.description??'',240,Boolean(r&&n.descriptionField),n.descriptionField??''),t('性格',n.personality??''),t('场景',n.scenario??''),t('创作者备注',n.creatorNotes??'',240,Boolean(r&&n.creatorNotesField),n.creatorNotesField??''),t('系统提示',n.systemPrompt??'',200),t('历史指令',n.postHistory??'',200),t('作者',n.creator??'',80)),e}),g=(0,G.computed)(()=>t.value.map((e,n)=>({id:n,preview:je(e,2).join('\n'),html:$e(e)}))),h=(0,G.computed)(()=>{const e=c.value,n=e?.total??g.value.length,a=e?.alternate??0;return n?{value:`共 ${n} 条`,hint:a>0?`替代 ${a} 条`:'无替代',hasData:!0}:{value:'暂无开场白',hint:'',hasData:!1}}),m=(0,G.computed)(()=>o.value?.worldBookName?.trim()||''),f=(0,G.computed)(()=>Boolean(m.value||r.value.length)),v=(0,G.ref)([]),x=(0,G.ref)(''),y=(0,G.ref)(!1),w=(0,G.ref)(''),k=(0,G.ref)(!1),E=(0,G.ref)(1);function N(e){const n=C(e);if(!n.length)return'';for(const e of n)if('string'==typeof e){const n=e.trim();if(n)return n}else if(e instanceof RegExp)return String(e);return''}function C(e){if(!e)return[];if(Array.isArray(e))return e;if('string'==typeof e||e instanceof RegExp)return[e];if('object'==typeof e){const n=e.keys;if(Array.isArray(n))return n}return[]}const V=(0,G.computed)(()=>v.value.map((e,n)=>{const a=function(e){const n=ze(e?.name,e?.title,e?.comment,e?.annotation,e?.label);if(n)return n;const a=N(e?.strategy?.keys??e?.keys??e?.keywords??e?.key??e?.search?.keys);if(a)return a;const t=N(e?.strategy?.keys_secondary?.keys??e?.keys_secondary??e?.secondary_keys);return t||function(e){if(!e)return'';const n=e.split(/\r?\n/);for(const e of n){const n=e.trim();if(!n)continue;const a=n.replace(/^<[^>]+>/g,'').trim();if(a)return a.length>32?`${a.slice(0,32)}...`:a}return''}('string'==typeof e?.content?e.content:'')}(e),t=function(e){const n=e?.strategy?.type??e?.strategy_type??e?.strategyType??e?.type??'';if('constant'===n||'selective'===n||'vectorized'===n)return n;if(!0===e?.vectorized||!0===e?.use_vectorized||!0===e?.strategy?.vectorized)return'vectorized';const a=C(e?.strategy?.keys??e?.keys??e?.key??e?.keywords),t=C(e?.strategy?.keys_secondary?.keys??e?.keys_secondary??e?.secondary_keys);return a.length||t.length?'selective':'constant'}(e);return{uid:e.uid??n,name:e.name||'',title:a,indexLabel:`条目 ${n+1}`,strategyLabel:(r=t,'constant'===r?'蓝灯':'selective'===r?'绿灯':'vectorized'===r?'向量':''),strategyType:t,enabled:!1!==e.enabled,preview:Le(String(e.content??''),2,200)||'（无内容）',content:String(e.content??'')};var r})),S=(0,G.computed)(()=>Math.max(1,Math.ceil(V.value.length/10))),B=(0,G.computed)(()=>{const e=10*(E.value-1);return V.value.slice(e,e+10)}),T=(0,G.computed)(()=>f.value?y.value?'正在读取条目':`共 ${V.value.length} 条`:'未绑定世界书'),D=(0,G.computed)(()=>V.value.length?m.value:''),A=(0,G.ref)(1),M=(0,G.computed)(()=>Math.max(1,Math.ceil(i.value.length/6))),L=(0,G.computed)(()=>{const e=6*(A.value-1);return i.value.slice(e,e+6)}),j=(0,G.ref)(1),F=(0,G.computed)(()=>Math.max(1,Math.ceil(g.value.length/10))),I=(0,G.computed)(()=>{const e=10*(j.value-1);return g.value.slice(e,e+10)}),O=(0,G.ref)(!1),P=(0,G.ref)(''),U=(0,G.ref)(!1),H=(0,G.ref)(''),R=(0,G.ref)(''),K=(0,G.ref)(''),Y=(0,G.ref)(!1),J=(0,G.ref)(!1),W=(0,G.ref)(!1),q=(0,G.ref)(''),X=(0,G.ref)('');let Z=0;function Q(){A.value>1&&(A.value-=1)}function ee(){A.value<M.value&&(A.value+=1)}async function ne(){const e=m.value;if(e||r.value.length){if(k.value=!0,w.value='',E.value=1,r.value.length)return v.value=r.value,void(x.value=e||'embedded');if(x.value!==e||!v.value.length)if('function'==typeof getWorldbook){y.value=!0;try{const n=await getWorldbook(e);v.value=Array.isArray(n)?n:[],x.value=e}catch(e){w.value='读取世界书失败',v.value=[],console.warn('[CardHub] 读取世界书失败',e)}finally{y.value=!1}}else w.value='世界书接口不可用'}}function ae(){k.value=!1}function te(){E.value>1&&(E.value-=1)}function re(){E.value<S.value&&(E.value+=1)}function oe(){g.value.length&&(j.value=1,J.value=!0)}function ce(){J.value=!1}function ie(){j.value>1&&(j.value-=1)}function le(){j.value<F.value&&(j.value+=1)}function de(){a.value&&(P.value=a.value.note??'',O.value=!0)}function se(){O.value=!1}function ue(){a.value&&(n.applyNoteUpdate(a.value,P.value),O.value=!1)}function be(e){q.value=e.label,X.value=Oe(e.full||e.preview),W.value=!0}function pe(){W.value=!1}async function ge(e){const n=++Z;t.value=[],r.value=[],i.value=[],o.value=null,c.value=null,l.value=null,A.value=1,j.value=1,J.value=!1,k.value=!1,v.value=[],x.value='',y.value=!1,w.value='',E.value=1;const[d,s]=await Promise.allSettled([he(e),me(e)]);if(n!==Z||a.value?.id!==e.id)return;const u='fulfilled'===d.status?d.value:{openings:[],profile:null,openingSummary:null,worldbookEntries:[]};t.value=u.openings,o.value=u.profile,c.value=u.openingSummary,r.value=u.worldbookEntries;const b='fulfilled'===s.status?s.value:{list:[],summary:null};i.value=b.list,l.value=b.summary}async function he(e){if('tavern'!==e.origin){const a=n.parseLibraryCardData(e);return{openings:Te(a),profile:Ce(a),openingSummary:Be(a),worldbookEntries:Se(a)}}const a=await async function(e){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const a='function'==typeof n?.getContext?n.getContext():null;if(a?.getCharacters)try{await a.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色卡列表失败',e)}const t=a?.characters??n?.characters??[];if(!t.length)return null;const r=e.avatar?t.findIndex(n=>n.avatar===e.avatar||n.name===e.avatar):-1,o=t.findIndex(n=>n.name===e.name),c=r>=0?r:o;if(c<0)return null;if(a?.unshallowCharacter)try{await a.unshallowCharacter(c)}catch(e){console.warn('[CardHub] 读取角色卡详情失败',e)}const i=(a?.characters??t)[c]??null;if(i?.first_mes||i?.data?.first_mes)return i;if(a?.getCharacterCardFields)try{const e=await a.getCharacterCardFields({chid:c});if(e?.first_mes||e?.data?.first_mes)return e}catch(e){console.warn('[CardHub] 读取角色卡字段失败',e)}const l=TavernHelper.getCharData(e.avatar??e.name,!0);return l??i}(e),t=a??TavernHelper.RawCharacter?.find({name:e.avatar??e.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:e.name,allowAvatar:!0}),r=a??t;let o=Te(r);!o.length&&t&&t!==r&&(o=Te(t));const c=Be(r??t);return{openings:o,profile:Ce(r??t),openingSummary:c,worldbookEntries:Se(r??t)}}async function me(e){if('tavern'!==e.origin)return{list:[],summary:null};const a=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0);if(!Array.isArray(a)||!a.length)return{list:[],summary:{total:0,latest:''}};const t=function(e){return[...e].sort((e,n)=>(Ke(n)??0)-(Ke(e)??0))}(a),r=Ke(t[0])??0;n.updateLastChatCacheForCard(e,r);const o=t.map(e=>({name:De(e),label:Ae(e),file:String(e?.file_name??e?.file_id??''),mes:Me(String(e?.mes??'')).slice(0,120)})),c=Re(t[0]);return{list:o,summary:{total:a.length,latest:c}}}async function fe(){i.value.length?await xe(i.value[0]):toastr.warning('暂无聊天记录')}async function ve(){if(await _e({ensureSelected:!0}))try{await triggerSlash('/newchat'),n.closeManage(),n.closeRoot()}catch(e){console.warn('[CardHub] 新聊天失败',e),toastr.error('无法创建新聊天')}}async function xe(e){const a=e.file;if(!a)return void toastr.warning('未找到聊天文件');const t=await _e({ensureSelected:!0});if(!t)return;const{ctx:r,st:o}=t,c=we(a),i=(r&&'function'==typeof r.openCharacterChat?r.openCharacterChat:null)??(o&&'function'==typeof o.openCharacterChat?o.openCharacterChat:null);if(!i)return void toastr.error('无法打开聊天：缺少接口');try{Promise.resolve(i(c)).catch(e=>{console.warn('[CardHub] 打开聊天失败',e)})}catch(e){console.warn('[CardHub] 打开聊天失败',e)}const l=await async function(e,n,a,t){const r=we(e),o=Date.now();for(;Date.now()-o<t;){if((n?.chatId??a?.chatId)===r)return!0;await ke(200)}return!1}(c,r,o,6e3);if(l)return n.closeManage(),void n.closeRoot();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}async function _e(e={}){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const t='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof t?.getCharacters)try{await t.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色列表失败',e)}const r=t?.characters??n?.characters??[],o=a.value&&Array.isArray(r)?function(e,n){const a=Ee(n.name),t=n.avatar?Ne(n.avatar):'',r=t?e.findIndex(e=>Ne(String(e.avatar??''))===t):-1;if(r>=0)return r;const o=e.findIndex(e=>Ee(String(e.name??''))===a);if(o>=0)return o;return e.findIndex(e=>Ee(String(e?.data?.name??''))===a)}(r,a.value):-1;if(o<0)return toastr.warning('未找到角色索引，请先手动切到该角色后再试'),null;const c=(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null)??(n&&'function'==typeof n.selectCharacterById?n.selectCharacterById:null);if(!c)return toastr.warning('无法切换角色，请先手动切到该角色后再试'),null;try{await c(o,{switchMenu:!1})}catch(e){console.warn('[CardHub] 切换角色失败',e)}const i=await async function(e,n,a,t){const r=String(e),o=Date.now();for(;Date.now()-o<t;){if(ye(n,a)===r)return!0;await ke(80)}return!1}(o,t,n,3e3);return e.ensureSelected&&!i?(toastr.warning('角色切换未完成，请稍后再试'),null):{ctx:t,st:n,idx:o}}function ye(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}function we(e){return e.endsWith('.jsonl')?e:`${e}.jsonl`}function ke(e){return new Promise(n=>setTimeout(n,e))}function Ee(e){return e.trim().toLocaleLowerCase()}function Ne(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}return n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n),n.trim().toLowerCase()}function Ce(e){if(!e)return null;const n=Ve(e,'description')?'description':'',a=function(e){if(Ve(e,'creatorcomment'))return'creatorcomment';if(Ve(e,'creator_notes'))return'creator_notes';return''}(e),t={description:ze(e?.description,e?.data?.description),descriptionField:n,personality:ze(e?.personality,e?.data?.personality),scenario:ze(e?.scenario,e?.data?.scenario),creatorNotes:ze(e?.creatorcomment,e?.data?.creatorcomment,e?.creator_notes,e?.data?.creator_notes),creatorNotesField:a,systemPrompt:ze(e?.system_prompt,e?.data?.system_prompt),postHistory:ze(e?.post_history_instructions,e?.data?.post_history_instructions),creator:ze(e?.creator,e?.data?.creator)},r=e?.character_book??e?.data?.character_book;r&&(t.worldBookName=ze(r?.name),t.worldBookCount=Array.isArray(r?.entries)?r.entries.length:void 0);return Boolean(t.description)||Boolean(t.personality)||Boolean(t.scenario)||Boolean(t.creatorNotes)||Boolean(t.systemPrompt)||Boolean(t.postHistory)||Boolean(t.creator)||Boolean(t.worldBookName)||'number'==typeof t.worldBookCount?t:null}function Ve(e,n){return void 0!==e?.[n]||void 0!==e?.data?.[n]}function Se(e){const n=e?.character_book??e?.data?.character_book;return n&&Array.isArray(n?.entries)?n.entries:[]}function ze(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function Be(e){if(!e)return null;const n='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes,a='string'==typeof n&&n.trim()?1:0,t=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;let r=0;return Array.isArray(t)?r=t.filter(e=>'string'==typeof e&&e.trim()).length:'string'==typeof t&&t.trim()&&(r=1),{total:a+r,alternate:r}}function Te(e){if(!e)return[];const n=[],a='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes;'string'==typeof a&&a.trim()&&n.push(a.trim());const t=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;return Array.isArray(t)?t.forEach(e=>{'string'==typeof e&&e.trim()&&n.push(e.trim())}):'string'==typeof t&&t.trim()&&n.push(t.trim()),n}function De(e){return Re(e)||'聊天记录'}function Ae(e){const n=ze(e?.file_name,e?.file_id);return n?n.replace(/\.jsonl$/i,''):''}function Me(e){return e.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}function Le(e,n,a){const t=e.replace(/\r/g,'').trim();if(!t)return'';const r=Ue(t),o=r.length?r:He(Me(t),60);let c=o.slice(0,n).join('\n').trim();if(!c)return'';const i=c.length>a;i&&(c=c.slice(0,a).trim());return(i||o.length>n||t.length>c.length)&&!c.endsWith('…')&&(c=`${c}…`),c}function je(e,n){const a=e.replace(/\r/g,'').trim();if(!a)return[];const t=Ue(a);if(t.length>=n)return t.slice(0,n);const r=Me(a);if(!r)return t.slice(0,n);const o=He(r,60);if(!t.length)return o.slice(0,n);const c=[...t];for(const e of o){if(c.length>=n)break;c[0]!==e&&c.push(e)}return c.slice(0,n)}function $e(e){const n=Pe(e).trim();return n?/<\/?[a-z][\s\S]*>/i.test(n)?n:Fe(n).replace(/\n/g,'<br>'):''}function Fe(e){return e.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}function Oe(e){const n=Pe(e).trim();return n?Fe(n).replace(/\n/g,'<br>'):''}function Pe(e){return e.replace(/^\s*```[a-zA-Z0-9_-]*\s*$/gm,'').replace(/^\s*```\s*$/gm,'')}function Ue(e){const n=e.split('\n').map(e=>e.trim()).filter(e=>e.length>0),a=[];for(const e of n)e.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(e)||a.push(e);return a}function He(e,n){const a=[];for(let t=0;t<e.length;t+=n){const r=e.slice(t,t+n).trim();r&&a.push(r)}return a}function Re(e){return ze(e?.chat_name,e?.chat_title,e?.name,e?.file_name,e?.file_id)}function Ke(e){return function(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}(e?.last_message_time??e?.last_message_date??e?.last_message_timestamp??e?.last_chat_time??e?.last_chat_date??e?.last_interaction??e?.update_time??e?.timestamp??e?.time??null)??function(e){const n=e.replace(/\.jsonl$/i,'').trim(),a=/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/,t=n.match(a);if(!t)return null;const r=Number(t[1]),o=Number(t[2]),c=Number(t[3]),i=t[4]?Number(t[4]):0,l=t[5]?Number(t[5]):0,d=t[6]?Number(t[6]):0;if(!r||!o||!c)return null;const s=new Date(r,o-1,c,i,l,d).getTime();return Number.isNaN(s)?null:s}(String(e?.file_name??e?.file_id??''))}function Ye(e){a.value&&'tavern'===a.value.origin&&function(e){return Boolean(e.editable&&e.field)}(e)&&(U.value=!0,H.value=`编辑${e.label}`,R.value=e.full??'',K.value=e.field??'')}function Je(){U.value=!1,H.value='',R.value='',K.value='',Y.value=!1}async function We(){if(a.value&&'tavern'===a.value.origin&&K.value&&!Y.value){Y.value=!0;try{const n=await async function(){try{const e=await fetch('/csrf-token',{credentials:'same-origin'});if(!e.ok)return'';const n=await e.json();return'string'==typeof n?.token?n.token:''}catch(e){return console.warn('[CardHub] 获取 CSRF Token 失败',e),''}}();if(!n)return void toastr.error('未获取到 CSRF Token');const t={avatar_url:a.value.avatar??'',ch_name:a.value.name??a.value.avatar??'',value:R.value??''},r='creatorcomment'===(e=K.value)||'creator_notes'===e?['creatorcomment','creator_notes']:[e];for(const e of r){const a=await fetch('/api/characters/edit-attribute',{method:'POST',headers:{'Content-Type':'application/json','X-CSRF-Token':n},credentials:'same-origin',body:JSON.stringify({...t,field:e})});if(!a.ok){const e=await a.text();throw new Error(e||'保存失败')}}toastr.success('已保存角色卡字段'),Je(),a.value&&ge(a.value)}catch(e){console.warn('[CardHub] 编辑角色卡字段失败',e),toastr.error('保存失败，请稍后再试')}finally{Y.value=!1}var e}}return(0,G.watch)(a,e=>{if(!e)return t.value=[],r.value=[],o.value=null,c.value=null,i.value=[],l.value=null,A.value=1,j.value=1,O.value=!1,P.value='',U.value=!1,H.value='',R.value='',K.value='',Y.value=!1,J.value=!1,k.value=!1,v.value=[],x.value='',y.value=!1,w.value='',E.value=1,W.value=!1,q.value='',void(X.value='');ge(e)},{immediate:!0}),(n,t)=>((0,G.openBlock)(),(0,G.createElementBlock)(G.Fragment,null,[a.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:0,class:'cardhub-manage cardhub-modal',onClick:t[1]||(t[1]=(0,G.withModifiers)((...n)=>e.closeManage&&e.closeManage(...n),['self']))},[(0,G.createElementVNode)('div',Ge,[(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:t[0]||(t[0]=(...n)=>e.closeManage&&e.closeManage(...n))},'×'),(0,G.createVNode)(Ze,{'manage-card':a.value,'manage-avatar-url':d.value,'manage-overview':b.value,'display-tags':e.displayTags,'open-note-dialog':de,'worldbook-available':f.value,'open-worldbook-list':ne},null,8,['manage-card','manage-avatar-url','manage-overview','display-tags','worldbook-available']),(0,G.createVNode)(Ie,{'manage-card':a.value,'manage-details':p.value,'manage-details-hint':s.value,'opening-items':g.value,'opening-summary':h.value,'manage-chats':i.value,'paged-chats':L.value,'chat-page':A.value,'chat-total-pages':M.value,'manage-chat-hint':u.value,'open-detail':be,'open-edit':Ye,'open-opening-list':oe,'open-latest-chat':fe,'open-new-chat':ve,'open-chat':xe,'prev-chat-page':Q,'next-chat-page':ee,'handle-card-action':e.handleCardAction,'manage-delete':e.manageDelete},null,8,['manage-card','manage-details','manage-details-hint','opening-items','opening-summary','manage-chats','paged-chats','chat-page','chat-total-pages','manage-chat-hint','handle-card-action','manage-delete'])])])):(0,G.createCommentVNode)('v-if',!0),O.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:1,class:'cardhub-note cardhub-modal',onClick:(0,G.withModifiers)(se,['self'])},[(0,G.createElementVNode)('div',Qe,[(0,G.createElementVNode)('div',{class:'cardhub-note__header'},[t[4]||(t[4]=(0,G.createElementVNode)('div',{class:'cardhub-note__title'},'备注',-1)),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:se},'×')]),(0,G.withDirectives)((0,G.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>P.value=e),class:'cardhub-note__input',placeholder:'填写备注内容'},null,512),[[G.vModelText,P.value]]),(0,G.createElementVNode)('div',{class:'cardhub-note__actions'},[(0,G.createElementVNode)('button',{class:'cardhub-note__btn is-secondary',type:'button',onClick:se},'取消'),(0,G.createElementVNode)('button',{class:'cardhub-note__btn is-primary',type:'button',onClick:ue},'保存')])])])):(0,G.createCommentVNode)('v-if',!0),U.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:2,class:'cardhub-edit cardhub-modal',onClick:(0,G.withModifiers)(Je,['self'])},[(0,G.createElementVNode)('div',{class:'cardhub-edit__panel cardhub-modal__panel',role:'dialog','aria-label':H.value},[(0,G.createElementVNode)('div',nn,[(0,G.createElementVNode)('div',an,(0,G.toDisplayString)(H.value),1),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Je},'×')]),(0,G.withDirectives)((0,G.createElementVNode)('textarea',{'onUpdate:modelValue':t[3]||(t[3]=e=>R.value=e),class:'cardhub-edit__input',placeholder:'填写内容'},null,512),[[G.vModelText,R.value]]),(0,G.createElementVNode)('div',tn,[(0,G.createElementVNode)('button',{class:'cardhub-edit__btn is-secondary',type:'button',onClick:Je},'取消'),(0,G.createElementVNode)('button',{class:'cardhub-edit__btn is-primary',type:'button',onClick:We,disabled:Y.value},(0,G.toDisplayString)(Y.value?'保存中...':'保存'),9,rn)])],8,en)])):(0,G.createCommentVNode)('v-if',!0),J.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:3,class:'cardhub-openings cardhub-modal',onClick:(0,G.withModifiers)(ce,['self'])},[(0,G.createElementVNode)('div',on,[(0,G.createElementVNode)('div',{class:'cardhub-openings__header'},[t[5]||(t[5]=(0,G.createElementVNode)('div',{class:'cardhub-openings__title'},'开场白列表',-1)),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:ce},'×')]),(0,G.createElementVNode)('div',cn,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(h.value.value),1),h.value.hint?((0,G.openBlock)(),(0,G.createElementBlock)('span',ln,(0,G.toDisplayString)(h.value.hint),1)):(0,G.createCommentVNode)('v-if',!0)]),I.value.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',dn,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(I.value,e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e.id,class:'cardhub-openings__item',type:'button',onClick:n=>function(e){J.value=!1,q.value=`开场白 ${e.id+1}`,X.value=e.html||Oe(e.preview),W.value=!0}(e)},[(0,G.createElementVNode)('div',un,'开场白 '+(0,G.toDisplayString)(e.id+1),1),(0,G.createElementVNode)('div',bn,(0,G.toDisplayString)(e.preview),1)],8,sn))),128))])):((0,G.openBlock)(),(0,G.createElementBlock)('div',pn,'暂无开场白')),F.value>1?((0,G.openBlock)(),(0,G.createElementBlock)('div',gn,[(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:j.value<=1,onClick:ie},' 上一页 ',8,hn),(0,G.createElementVNode)('span',mn,(0,G.toDisplayString)(j.value)+' / '+(0,G.toDisplayString)(F.value),1),(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:j.value>=F.value,onClick:le},' 下一页 ',8,fn)])):(0,G.createCommentVNode)('v-if',!0)])])):(0,G.createCommentVNode)('v-if',!0),k.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:4,class:'cardhub-worldbook cardhub-modal',onClick:(0,G.withModifiers)(ae,['self'])},[(0,G.createElementVNode)('div',vn,[(0,G.createElementVNode)('div',xn,[(0,G.createElementVNode)('div',_n,(0,G.toDisplayString)(m.value||'世界书'),1),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:ae},'×')]),(0,G.createElementVNode)('div',yn,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(T.value),1),D.value?((0,G.openBlock)(),(0,G.createElementBlock)('span',wn,(0,G.toDisplayString)(D.value),1)):(0,G.createCommentVNode)('v-if',!0)]),y.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',kn,'加载中...')):w.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',En,(0,G.toDisplayString)(w.value),1)):B.value.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',Nn,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(B.value,e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e.uid,class:'cardhub-worldbook__item',type:'button',onClick:n=>function(e){k.value=!1,q.value=e.title||e.indexLabel||'世界书条目',X.value=Oe(e.content),W.value=!0}(e)},[(0,G.createElementVNode)('div',Vn,[(0,G.createElementVNode)('span',Sn,(0,G.toDisplayString)(e.indexLabel),1),(0,G.createElementVNode)('span',zn,(0,G.toDisplayString)(e.title||'未命名条目'),1),e.strategyLabel?((0,G.openBlock)(),(0,G.createElementBlock)('span',{key:0,class:(0,G.normalizeClass)(['cardhub-worldbook__item-strategy',`is-${e.strategyType}`])},(0,G.toDisplayString)(e.strategyLabel),3)):(0,G.createCommentVNode)('v-if',!0),e.enabled?(0,G.createCommentVNode)('v-if',!0):((0,G.openBlock)(),(0,G.createElementBlock)('span',Bn,'已禁用'))]),(0,G.createElementVNode)('div',Tn,(0,G.toDisplayString)(e.preview),1)],8,Cn))),128))])):((0,G.openBlock)(),(0,G.createElementBlock)('div',Dn,'暂无条目')),S.value>1?((0,G.openBlock)(),(0,G.createElementBlock)('div',An,[(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:E.value<=1,onClick:te},' 上一页 ',8,Mn),(0,G.createElementVNode)('span',Ln,(0,G.toDisplayString)(E.value)+' / '+(0,G.toDisplayString)(S.value),1),(0,G.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:E.value>=S.value,onClick:re},' 下一页 ',8,jn)])):(0,G.createCommentVNode)('v-if',!0)])])):(0,G.createCommentVNode)('v-if',!0),W.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:5,class:'cardhub-manage-viewer cardhub-modal',onClick:(0,G.withModifiers)(pe,['self'])},[(0,G.createElementVNode)('div',{class:'cardhub-manage-viewer__panel cardhub-modal__panel',role:'dialog','aria-label':q.value},[(0,G.createElementVNode)('div',Fn,[(0,G.createElementVNode)('div',In,(0,G.toDisplayString)(q.value),1),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:pe},'×')]),(0,G.createElementVNode)('div',{class:'cardhub-manage-viewer__content',innerHTML:X.value},null,8,On)],8,$n)])):(0,G.createCommentVNode)('v-if',!0)],64))}});function Un(e){const n=(0,G.ref)(!1),a=(0,G.ref)('filter'),t=(0,G.ref)([]),r=(0,G.ref)(''),o=(0,G.ref)(''),c=(0,G.ref)([]),i=(0,G.computed)(()=>e.filteredCharacters.value),l=(0,G.computed)(()=>{const n=r.value.trim().toLowerCase();return n?i.value.filter(a=>{if(a.name.toLowerCase().includes(n))return!0;return e.displayTags(a).some(e=>e.toLowerCase().includes(n))}):i.value}),d=(0,G.computed)(()=>new Set(t.value)),s=(0,G.computed)(()=>e.allTags.value);return{tagManagerOpen:n,tagManagerTab:a,openTagManager:function(e='filter'){if('batch'===e){if(!l.value.length)return void toastr.warning('当前没有可操作的角色卡');o.value='',r.value='',c.value=[],t.value=l.value.map(e=>e.id)}a.value=e,n.value=!0},closeTagManager:function(){n.value=!1},batchTagSelectedIds:t,batchTagSearch:r,batchTagInput:o,batchTagSelectedTags:c,batchTagSelectedSet:d,batchTagVisibleCandidates:l,batchTagSuggestions:s,toggleBatchTagSelection:function(e){d.value.has(e)?t.value=t.value.filter(n=>n!==e):t.value=[...t.value,e]},selectAllBatchTags:function(){t.value=l.value.map(e=>e.id)},clearBatchTagSelection:function(){t.value=[]},toggleBatchTagSuggestion:function(e){c.value.includes(e)?c.value=c.value.filter(n=>n!==e):c.value=[...c.value,e]},applyBatchTags:async function(n){if(!t.value.length)return void toastr.warning('请先选择要操作的角色卡');const a=function(e,n){const a=e.split(/[,，\n;；、]/).map(e=>e.trim()).filter(Boolean);return Array.from(new Set([...a,...n]))}(o.value,c.value);if(!a.length)return void toastr.warning('请输入要操作的标签');const r='add'===n?'添加':'移除',i=`将${r}标签：${a.join('、')}\n应用到 ${t.value.length} 张角色卡，是否继续？`;if('confirm'!==await e.openConfirm({title:`批量${r}标签`,message:i,confirmLabel:`继续${r}`,cancelLabel:'取消'}))return;const l=function(n){const a=new Map(e.allCards.value.map(e=>[e.id,e]));return n.map(e=>a.get(e)).filter(Boolean)}(t.value);let d=0;l.forEach(t=>{const r=e.displayTags(t),o=new Set(r);'add'===n?a.forEach(e=>o.add(e)):a.forEach(e=>o.delete(e));const c=Array.from(o);(function(e,n){if(e.length!==n.length)return!1;const a=new Set(e);return n.every(e=>a.has(e))})(r,c)||(e.applyTagUpdate(t,c),d+=1)}),toastr.success(`已处理 ${d} 张角色卡`)}}}function Hn(e){const n=(0,G.ref)(null),a=(0,G.ref)(!1),t=(0,G.ref)([]),r=(0,G.ref)(''),o=(0,G.ref)('all'),c=(0,G.ref)([]),i=(0,G.computed)(()=>[...e.allCards.value]),l=(0,G.computed)(()=>{const e=new Set;return i.value.forEach(n=>{(n.tags??[]).forEach(n=>e.add(n))}),c.value.forEach(n=>e.add(n)),Array.from(e).sort((e,n)=>e.localeCompare(n,'zh-CN'))}),d=(0,G.computed)(()=>{let e=i.value;'imported'===o.value?e=e.filter(e=>'tavern'===e.origin):'unimported'===o.value&&(e=e.filter(e=>'library'===e.origin)),c.value.length&&(e=e.filter(e=>c.value.some(n=>(e.tags??[]).includes(n))));const n=r.value.trim().toLowerCase();return n?e.filter(e=>{if(e.name.toLowerCase().includes(n))return!0;return(e.tags??[]).some(e=>e.toLowerCase().includes(n))}):e}),s=(0,G.computed)(()=>new Set(t.value)),u=(0,G.computed)(()=>i.value.filter(e=>s.value.has(e.id)));function b(){a.value=!0,t.value=d.value.map(e=>e.id)}async function p(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const a=function(n){const a=e.normalizeNameKey(n);return a?e.getCharacters().find(n=>e.normalizeNameKey(n.name)===a)??null:null}(n.name);if(a)return void toastr.warning(`已存在同名角色「${a.name}」，已跳过导入`);const t=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};delete t['Content-Type'];const r=await e.fetchCharacterSummaries(),o=new Set(r.map(n=>e.normalizeAvatarKey(n.avatar??'')).filter(Boolean));if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);await TavernHelper.importRawCharacter(n.name,a)}else{const e=new File([n.raw],`${n.name}.json`,{type:'application/json'}),a=new FormData;a.append('avatar',e),a.append('file_type','json'),a.append('preserved_name',e.name),await fetch('/api/characters/import',{method:'POST',headers:t,body:a,cache:'no-cache'})}const c=await e.fetchCharacterSummaries(),i=new Set([n.name]);if('json'===n.rawType)try{const e=JSON.parse(n.raw);e?.name&&i.add(e.name),e?.data?.name&&i.add(e.data.name)}catch{}const l=c.find(n=>{const a=e.normalizeAvatarKey(n.avatar??'');return a&&!o.has(a)}),d=c.find(n=>Array.from(i).some(a=>e.normalizeNameKey(n.name)===e.normalizeNameKey(a))),s=l??d??null;if(s){e.setLibrary(e.removeFromLibrary(n.id,e.getLibrary()));const a=n.tags?.length?n.tags:e.extractCardTagsFromData(e.parseLibraryCardData(n));if(a.length){const n=e.updateCharacterTags(s,a);s.tags=n}toastr.success(`已导入 ${n.name}`)}else toastr.warning(`导入完成但未在角色列表中找到「${n.name}」，已保留未导入记录`);e.setCharacters(c)}async function g(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);return void e.downloadBlob(a,`${n.name}.png`)}const a=new Blob([n.raw],{type:'application/json'});e.downloadBlob(a,`${n.name}.json`)}async function h(n){if('library'===n.origin)return void await g(n);if('json'===e.getExportFormat()){const a=TavernHelper.getCharData(n.avatar??n.name,!0);if(a){const t=new Blob([JSON.stringify(a,null,2)],{type:'application/json'});return void e.downloadBlob(t,`${n.name}.json`)}}if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const t=await fetch(a,{cache:'no-cache'}),r=await t.blob();e.downloadBlob(r,`${n.name}.png`)}function m(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}async function f(n,a){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let t;try{t=window.parent?.SillyTavern}catch{t=void 0}t??=SillyTavern;const r='function'==typeof t?.getContext?t.getContext():null,o=r?.characters??t?.characters??[],c=function(n,a){const t=e.normalizeNameKey(a.name),r=a.avatar?e.normalizeAvatarKey(a.avatar):'',o=r?n.findIndex(n=>e.normalizeAvatarKey(String(n.avatar??''))===r):-1;if(o>=0)return o;const c=n.findIndex(n=>e.normalizeNameKey(String(n.name??''))===t);return c>=0?c:n.findIndex(n=>e.normalizeNameKey(String(n?.data?.name??''))===t)}(o,n),i=m(r,t);if(c>=0&&i&&String(c)===String(i))if(o.length>1){const n=0===c?1:0,a=(r&&'function'==typeof r.selectCharacterById?r.selectCharacterById:null)??(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null);if(a)try{await a(n,{switchMenu:!1}),await async function(n,a,t,r){const o=String(n),c=Date.now();for(;Date.now()-c<r;){if(m(a,t)===o)return!0;await e.sleep(80)}return!1}(n,r,t,3e3)}catch(e){console.warn('[CardHub] 删除前切换角色失败',e)}}else toastr.warning('当前角色为唯一角色，删除后酒馆可能需要刷新');const l=r?.getRequestHeaders?r.getRequestHeaders():t?.getRequestHeaders?.();if(!l||!Object.keys(l).length)return toastr.error('删除失败：无法获取请求头'),!1;const d={avatar_url:n.avatar,delete_chats:a},s=await fetch('/api/characters/delete',{method:'POST',headers:{...l,'Content-Type':'application/json'},body:JSON.stringify(d),cache:'no-cache'});if(s.ok){try{await triggerSlash('/closechat')}catch(e){console.warn('[CardHub] 关闭聊天失败',e)}return!0}const u=await s.text();return toastr.error(`删除失败：${s.status} ${u||s.statusText}`),!1}return{importInput:n,exportDialogOpen:a,exportSearch:r,exportStatusFilter:o,exportTagFilters:c,exportAllTags:l,exportVisibleCandidates:d,exportSelectedItems:u,exportSelectedIds:t,openExportDialog:b,exportSelected:async function(){b()},confirmExportSelected:async function(){const n=u.value;if(!n.length)return void toastr.warning('请选择要导出的角色卡');const t=e.selectedTags.value.length?e.selectedTags.value.join('、'):'无',r='all'===e.statusFilter.value?'全部':'imported'===e.statusFilter.value?'已导入':'未导入',o=e.stateSearch.value.trim()||'无',c=`将导出 ${n.length} 张角色卡。\n筛选状态：${r}\n筛选标签：${t}\n搜索关键字：${o}\n是否继续？`;if('confirm'===await e.openConfirm({title:'批量导出',message:c,confirmLabel:'继续导出',cancelLabel:'取消'})){a.value=!1;for(const a of n)await h(a),await e.sleep(120);toastr.success(`批量导出完成，共 ${n.length} 张`)}},isExportSelected:function(e){return s.value.has(e)},toggleExportSelection:function(e){s.value.has(e)?t.value=t.value.filter(n=>n!==e):t.value=[...t.value,e]},selectAllExport:function(){t.value=d.value.map(e=>e.id)},clearExportSelection:function(){t.value=[]},triggerImport:function(){n.value?.click()},handleImportFiles:async function(n){const a=n.target,t=a?.files;if(!t||!t.length)return;if(1===t.length&&t[0].name.toLowerCase().endsWith('.json'))try{const n=await t[0].text(),r=e.parseLibraryBackup(n);if(r){const n=await e.openConfirm({title:'导入私有库备份',message:'检测到私有库备份文件。\n选择“覆盖”会替换现有私有库，选择“合并”会追加进去。',confirmLabel:'覆盖',altLabel:'合并',cancelLabel:'取消'});if('cancel'===n)return void(a.value='');const t=e.normalizeLibraryEntries(r),o=e.getLibrary(),c='alt'===n?e.mergeLibraryEntries(o,t):t;return e.setLibrary(c),await e.persistLibrary(c),toastr.success('alt'===n?'已合并私有库备份':'已导入私有库备份'),void(a.value='')}}catch(e){console.warn('[CardHub] 读取备份失败',e)}const r=await e.addToLibrary(t,e.getLibrary());e.setLibrary(r),a.value=''},handleCardAction:async function(e){'library'===e.origin?await p(e):h(e)},importLibraryCard:p,exportCard:h,exportLibraryCard:g,manageDelete:async function(n){if('library'===n.origin){if('confirm'!==await e.openConfirm({title:'删除角色',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'删除',cancelLabel:'取消'}))return;return e.setLibrary(e.removeFromLibrary(n.id,e.getLibrary())),void e.closeManage()}if('confirm'!==await e.openConfirm({title:'删除角色',message:`确定要删除「${n.name}」吗？`,confirmLabel:'继续',cancelLabel:'取消'}))return;const a=await e.openConfirm({title:'删除方式',message:`删除「${n.name}」：\n- 移到私有库：可在私有库中找回\n- 永久删除：不可恢复`,confirmLabel:'移到私有库',altLabel:'永久删除',cancelLabel:'取消'});if('cancel'===a)return;if('confirm'===a){await async function(n){if(!n.avatar)return;const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const t=await fetch(a,{cache:'no-cache'}),r=await t.blob(),o=await e.addToLibrary([new File([r],`${n.name}.png`,{type:'image/png'})],e.getLibrary());e.setLibrary(o)}(n);if(!await f(n,!1))return;e.closeManage();const a=await e.fetchCharacterSummaries();return void e.setCharacters(a)}if('confirm'!==await e.openConfirm({title:'永久删除',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'永久删除',cancelLabel:'取消'}))return;if(!await f(n,!0))return;e.closeManage();const t=await e.fetchCharacterSummaries();e.setCharacters(t)}}}const Rn={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},Kn={class:'cardhub-toolbar'},Yn={class:'cardhub-body'},Jn={class:'cardhub-sidebar'},Wn={class:'cardhub-filter-row'},qn={class:'cardhub-filter-block'},Xn={class:'cardhub-chip-row'},Zn={class:'cardhub-filter-block'},Gn={class:'cardhub-chip-row'},Qn={class:'cardhub-tag-filter'},ea=['onClick'],na={class:'cardhub-content'},aa={key:0,class:'cardhub-loading'},ta={key:1,class:'cardhub-empty'},ra={key:2,class:'cardhub-grid-wrap'},oa={class:'cardhub-pagination'},ca={key:0,class:'cardhub-pagination__actions'},ia=['disabled'],la=['disabled'],da={class:'cardhub-pagination__status'},sa={class:'cardhub-grid'},ua=['onClick'],ba={class:'cardhub-card__info'},pa={class:'cardhub-card__head'},ga={class:'cardhub-card__name'},ha=['onClick'],ma={class:'cardhub-card__meta'},fa={key:0,class:'cardhub-card__note'},va={class:'cardhub-card__tags'},xa=['onClick'],_a=['onClick'],ya=['onKeydown','onBlur'],wa=['onClick'],ka={class:'cardhub-card__actions'},Ea=['onClick'],Na=['onClick'],Ca={class:'cardhub-confirm__panel cardhub-modal__panel',role:'dialog','aria-modal':'true'},Va={class:'cardhub-confirm__title'},Sa={class:'cardhub-confirm__message'},za={class:'cardhub-confirm__actions'},Ba={class:'cardhub-tag-manager__panel cardhub-modal__panel',role:'dialog','aria-label':'标签管理'},Ta={class:'cardhub-tag-manager__header'},Da={key:0,class:'cardhub-tag-manager__subtitle'},Aa={key:1,class:'cardhub-tag-manager__subtitle'},Ma={class:'cardhub-tag-manager__tabs'},La={key:0,class:'cardhub-tag-manager__section'},ja={class:'cardhub-tag-manager__actions'},$a=['disabled'],Fa={class:'cardhub-tag-manager__list'},Ia=['onClick'],Oa={key:1,class:'cardhub-tag-manager__section cardhub-tag-manager__batch'},Pa={class:'cardhub-batch__filters'},Ua={class:'cardhub-batch__field'},Ha={key:0,class:'cardhub-batch__suggestions'},Ra={class:'cardhub-batch__suggest-row'},Ka=['onClick'],Ya={class:'cardhub-batch__toolbar'},Ja={class:'cardhub-batch__list'},Wa=['checked','onChange'],qa={class:'cardhub-batch__main'},Xa={class:'cardhub-batch__name'},Za={class:'cardhub-batch__meta'},Ga={key:0,class:'cardhub-batch__tags'},Qa={class:'cardhub-export__panel cardhub-modal__panel',role:'dialog','aria-label':'批量导出'},et={class:'cardhub-export__header'},nt={class:'cardhub-export__subtitle'},at={class:'cardhub-export__filters'},tt={class:'cardhub-export__filter-row'},rt={class:'cardhub-export__filter-row'},ot=['onClick'],ct={class:'cardhub-export__toolbar'},it={class:'cardhub-export__list'},lt=['checked','onChange'],dt={class:'cardhub-export__main'},st={class:'cardhub-export__name'},ut={class:'cardhub-export__meta'},bt={key:0,class:'cardhub-export__tags'},pt={class:'cardhub-settings__panel cardhub-modal__panel',role:'dialog','aria-label':'设置'},gt={class:'cardhub-settings__section'},ht={class:'cardhub-settings__hint'},mt={class:'cardhub-settings__options'},ft=['disabled'],vt={class:'cardhub-settings__option-body'},xt={key:0,class:'cardhub-settings__option-warn'},_t={class:'cardhub-settings__section'},yt={class:'cardhub-settings__options cardhub-settings__options--compact'},wt={class:'cardhub-settings__row'},kt={class:'cardhub-settings__row cardhub-settings__toggle'},Et={class:'cardhub-settings__row'},Nt={class:'cardhub-settings__row'},Ct={class:'cardhub-settings__row cardhub-settings__toggle'},Vt={class:'cardhub-settings__section'},St={class:'cardhub-settings__options cardhub-settings__options--compact'},zt={class:'cardhub-settings__row cardhub-settings__radio'},Bt={class:'cardhub-settings__row cardhub-settings__radio'},Tt={class:'cardhub-settings__section'},Dt={class:'cardhub-settings__backup'},At={class:'cardhub-settings__actions'},Mt=['disabled'],Lt={class:'cardhub-theme__panel cardhub-modal__panel',role:'dialog','aria-label':'配色设置'},jt={class:'cardhub-theme__grid'},$t={class:'cardhub-theme__field'},Ft={class:'cardhub-theme__field'},It={class:'cardhub-theme__field'},Ot={class:'cardhub-theme__field'},Pt={class:'cardhub-theme__field'},Ut={class:'cardhub-theme__field'},Ht={class:'cardhub-theme__field'},Rt={class:'cardhub-theme__field'},Kt={class:'cardhub-theme__field'},Yt={class:'cardhub-theme__presets'},Jt=['onClick'],Wt=(0,G.defineComponent)({__name:'App',setup(e){const n=(0,G.ref)('all'),a=(0,G.ref)(24),r=(0,G.ref)(1),o=(0,G.ref)(null),c=(0,G.reactive)({open:!1,title:'',message:'',confirmLabel:'确定',cancelLabel:'取消',altLabel:'',resolve:null}),i=(0,G.computed)(()=>[...Q.characters,...Q.library]),l=(0,G.computed)(()=>{const e=new Map;return i.value.forEach(n=>{e.set(n.id,on(n))}),e}),d=(0,G.computed)(()=>{const e=new Set,n=new Set,a=new Set;Q.characters.forEach(e=>{if(n.add(Fn(e.name)),e.avatar){const n=On(e.avatar);n&&a.add(n)}});const t=new Set,r=new Set;return Q.library.forEach(e=>{if(t.add(Fn(e.name)),e.importFileName){const n=Wt(e.importFileName);n&&r.add(n)}}),Q.characters.forEach(n=>{const a=Fn(n.name),o=n.avatar?On(n.avatar):'';(t.has(a)||o&&r.has(o))&&e.add(n.id)}),Q.library.forEach(t=>{const r=Fn(t.name),o=t.importFileName?Wt(t.importFileName):'';(n.has(r)||o&&a.has(o))&&e.add(t.id)}),e}),{selectedTags:b,allTags:h,applyTagFilter:m,toggleTagFilter:f,clearTagFilter:v}=function(e,n){const a=(0,G.ref)([]),t=(0,G.computed)(()=>{const t=new Set;return e.value.forEach(e=>{n(e).forEach(e=>t.add(e))}),a.value.forEach(e=>t.add(e)),Array.from(t).sort((e,n)=>e.localeCompare(n,'zh-CN'))});return{selectedTags:a,allTags:t,applyTagFilter:function(e){return a.value.length?e.filter(e=>a.value.some(a=>n(e).includes(a))):e},toggleTagFilter:function(e){a.value.includes(e)?a.value=a.value.filter(n=>n!==e):a.value=[...a.value,e]},clearTagFilter:function(){a.value=[]}}}(i,on),x=(0,G.ref)([]),y=(0,G.computed)(()=>new Set(x.value)),w=(0,G.ref)('recent'),k=(0,G.ref)(!1),N=(0,G.ref)({}),C=(0,G.ref)({}),V=(0,G.ref)({}),S={bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'},B=(0,G.ref)(!1),T=(0,G.ref)({...S}),D=(0,G.reactive)({...S}),A=(0,G.computed)(()=>{const e=B.value?D:T.value,n=R.avatarSize,a='sm'===n?36:'lg'===n?50:42,t='sm'===n?34:'lg'===n?46:40;return{'--cardhub-bg-start':e.bgStart,'--cardhub-bg-end':e.bgEnd,'--cardhub-surface':e.surface,'--cardhub-surface-alt':e.surfaceAlt,'--cardhub-text':e.text,'--cardhub-text-muted':e.textMuted,'--cardhub-accent':e.accent,'--cardhub-accent-strong':e.accentStrong,'--cardhub-border':e.border,'--cardhub-surface-rgb':fn(e.surface),'--cardhub-surface-alt-rgb':fn(e.surfaceAlt),'--cardhub-border-rgb':fn(e.border),'--cardhub-accent-rgb':fn(e.accent),'--cardhub-accent-strong-rgb':fn(e.accentStrong),'--cardhub-accent-text':vn(e.accent),'--cardhub-accent-strong-text':vn(e.accentStrong),'--cardhub-tag-rows':String(R.tagRows),'--cardhub-avatar-size':`${a}px`,'--cardhub-avatar-size-mobile':`${t}px`}}),M=(0,G.ref)(!1),L=(0,G.ref)('variables'),j=(0,G.ref)('variables'),F=(0,G.ref)(!1),I=(0,G.ref)(!0),O={variables:'酒馆助手变量',indexeddb:'浏览器 IndexedDB'},P=(0,G.computed)(()=>O[L.value]),U=(0,G.computed)(()=>j.value!==L.value),H={pageSize:24,showNoteSummary:!0,exportFormat:'png',tagRows:2,avatarSize:'md',syncTavernTags:!0},R=(0,G.reactive)({...H}),K=(0,G.reactive)({...H}),re=(0,G.computed)(()=>K.pageSize!==R.pageSize||K.showNoteSummary!==R.showNoteSummary||K.exportFormat!==R.exportFormat||K.tagRows!==R.tagRows||K.avatarSize!==R.avatarSize||K.syncTavernTags!==R.syncTavernTags),oe=(0,G.computed)(()=>R.showNoteSummary),le=(0,G.ref)(null);function de(){const e=s(),n=function(e){if(!e||'object'!=typeof e)return{...H};const n=e,a=Number(n.pageSize),t=[12,24,36,48].includes(a)?a:H.pageSize,r='boolean'==typeof n.showNoteSummary?n.showNoteSummary:H.showNoteSummary,o='json'===n.exportFormat||'png'===n.exportFormat?n.exportFormat:H.exportFormat,c=Number(n.tagRows);return{pageSize:t,showNoteSummary:r,exportFormat:o,tagRows:[1,2,3,4].includes(c)?c:H.tagRows,avatarSize:'sm'===n.avatarSize||'lg'===n.avatarSize?n.avatarSize:'md',syncTavernTags:'boolean'==typeof n.syncTavernTags?n.syncTavernTags:H.syncTavernTags}}(e?.uiSettings);Object.assign(R,n),Object.assign(K,n),a.value=n.pageSize}const se=[{name:'晨雾',value:{bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'}},{name:'白天',value:{bgStart:'#fdfaf4',bgEnd:'#f2ebe1',surface:'#fffefb',surfaceAlt:'#f7efe6',text:'#1d1a17',textMuted:'#7a6f63',accent:'#e3a981',accentStrong:'#3f2c22',border:'#e4d7c8'}},{name:'夜晚',value:{bgStart:'#14181d',bgEnd:'#0d1116',surface:'#1e242b',surfaceAlt:'#242b34',text:'#eef2f7',textMuted:'#b2bdc9',accent:'#6fa2d1',accentStrong:'#d7e6f4',border:'#36414c'}},{name:'茶棕',value:{bgStart:'#f7f1e7',bgEnd:'#e6d8c6',surface:'#fcf6ee',surfaceAlt:'#f2e4d6',text:'#2a1f18',textMuted:'#8a6d5a',accent:'#c47b52',accentStrong:'#3e2a22',border:'#ddc7b4'}},{name:'赤陶',value:{bgStart:'#fbf1ea',bgEnd:'#ecd5c8',surface:'#fff7f1',surfaceAlt:'#f4e1d6',text:'#2d2018',textMuted:'#8b6a5a',accent:'#d17a4f',accentStrong:'#4c2d21',border:'#e3c3b3'}},{name:'薄荷',value:{bgStart:'#f2fbf7',bgEnd:'#dcefe7',surface:'#f9fffd',surfaceAlt:'#e8f4f0',text:'#1a2a26',textMuted:'#5f7a73',accent:'#60b6a4',accentStrong:'#1f4c43',border:'#c5ddd5'}},{name:'海盐',value:{bgStart:'#f3f8fb',bgEnd:'#d9e7f3',surface:'#f9fcff',surfaceAlt:'#e9f2f9',text:'#1b2530',textMuted:'#5f7388',accent:'#5da3cf',accentStrong:'#1f3e57',border:'#c8d9e7'}},{name:'石墨',value:{bgStart:'#2a2d33',bgEnd:'#1e2126',surface:'#333741',surfaceAlt:'#3b404b',text:'#f3f5f8',textMuted:'#c1c7d0',accent:'#9aa6b2',accentStrong:'#e0e5ea',border:'#4b5261'}}],ue=(0,G.computed)(()=>{const e=function(e){if(!k.value)return e;return e.filter(e=>y.value.has(e.id))}(function(e){if('imported'===n.value)return e.filter(e=>!mn(e));if('unimported'===n.value)return e.filter(e=>mn(e));if('duplicate'===n.value)return e.filter(e=>d.value.has(e.id));return e}(i.value)),a=Q.search.trim().toLowerCase();return hn(a?m(e).filter(e=>{if(e.name.toLowerCase().includes(a))return!0;return(l.value.get(e.id)??ce(e)).some(e=>e.toLowerCase().includes(a))}):m(e))}),{tagManagerOpen:be,tagManagerTab:pe,openTagManager:ge,closeTagManager:he,batchTagSelectedIds:me,batchTagSearch:fe,batchTagInput:ve,batchTagSelectedTags:xe,batchTagSelectedSet:_e,batchTagVisibleCandidates:ye,batchTagSuggestions:we,toggleBatchTagSelection:ke,selectAllBatchTags:Ee,clearBatchTagSelection:Ne,toggleBatchTagSuggestion:Ce,applyBatchTags:Ve}=Un({allCards:i,filteredCharacters:ue,allTags:h,displayTags:an,applyTagUpdate:Gt,openConfirm:Xt}),Se=(0,G.toRef)(Q,'search'),{importInput:ze,exportDialogOpen:Be,exportSearch:Te,exportStatusFilter:De,exportTagFilters:Ae,exportAllTags:Me,exportVisibleCandidates:Le,exportSelectedItems:je,exportSelectedIds:$e,openExportDialog:Fe,exportSelected:Ie,confirmExportSelected:Oe,isExportSelected:Pe,toggleExportSelection:Ue,selectAllExport:He,clearExportSelection:Re,triggerImport:Ke,handleImportFiles:Ye,handleCardAction:Je,importLibraryCard:We,exportCard:qe,exportLibraryCard:Xe,manageDelete:Ze}=Hn({allCards:i,stateSearch:Se,selectedTags:b,statusFilter:n,getCharacters:()=>Q.characters,getLibrary:()=>Q.library,setLibrary:te,setCharacters:qt,fetchCharacterSummaries:t,addToLibrary:W,parseLibraryBackup:q,normalizeLibraryEntries:Y,mergeLibraryEntries:X,persistLibrary:E,removeFromLibrary:Z,updateCharacterTags:cn,parseLibraryCardData:dr,extractCardTagsFromData:function(e){const n=e?.tags??e?.data?.tags;if(!Array.isArray(n))return[];return n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean)},normalizeNameKey:Fn,normalizeAvatarKey:In,dataUrlToBlob:async function(e){const n=await fetch(e);return await n.blob()},downloadBlob:Er,openConfirm:Xt,closeManage:lr,sleep:kr,getExportFormat:()=>R.exportFormat}),Ge=(0,G.computed)(()=>{const e=Math.ceil(ue.value.length/a.value);return e>0?e:1}),Qe=(0,G.computed)(()=>{const e=(r.value-1)*a.value;return ue.value.slice(e,e+a.value)});function en(e,n=!1){const a=e.avatar;return a?/^(data:|https?:|\/)/.test(a)?a:n&&'tavern'===e.origin?TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:null}function nn(e){const n=en(e);return n?{backgroundImage:`url(${n})`}:{}}function an(e){return l.value.get(e.id)??on(e)}function tn(e){if('tavern'===e.origin){const n=function(e){const n=new Set;return'tavern'!==e.origin?[]:([e.tagKey,e.avatar,e.name].filter(Boolean).forEach(e=>{const a=e.trim();if(!a)return;if(n.add(`tavern:${a}`),a.includes('::')&&n.add(`tavern:${a.split('::')[0]}`),a.startsWith('name:')){const e=a.slice(5).split('::')[0];e&&n.add(`tavern:${e}`)}const t=a.includes('/')?a.split('/').pop():a;t&&t!==a&&n.add(`tavern:${t}`);try{const e=decodeURIComponent(a);e&&e!==a&&n.add(`tavern:${e}`)}catch{}}),Array.from(n))}(e);for(const e of n){const n=V.value[e];if(n&&n.trim())return n.trim()}}return e.note?.trim()??''}function rn(e){return tn(e)}function on(e){return'library'===e.origin?e.tags??[]:R.syncTavernTags?ce(e):e.tags??[]}function cn(e,n){if(!R.syncTavernTags){return Array.from(new Set(n.map(e=>e.trim()).filter(Boolean)))}return ie(e,n)}function ln(e){u({lastChatCache:e})}function dn(e){return'tavern'!==e.origin?null:e.avatar?`avatar:${e.avatar}`:e.name?`name:${e.name}`:null}function sn(e){if('number'==typeof e.createdAt&&e.createdAt>0)return e.createdAt;const n=dn(e);return n?C.value[n]??0:0}function un(e){if('number'==typeof e.lastChatAt&&e.lastChatAt>0)return e.lastChatAt;const n=dn(e);return n?N.value[n]??0:0}function bn(e,n){if(n<=0||'tavern'!==e.origin)return;const a=new Set;if(e.avatar&&a.add(`avatar:${e.avatar}`),e.name&&a.add(`name:${e.name}`),!a.size)return;const t={...N.value};let r=!1;a.forEach(e=>{(t[e]??0)<n&&(t[e]=n,r=!0)}),r&&(N.value=t,ln(t))}function pn(e){C.value=e,u({importCache:e})}function gn(e){y.value.has(e.id)?x.value=x.value.filter(n=>n!==e.id):x.value=[...x.value,e.id],u({favorites:x.value})}function hn(e){const n=e.map(e=>({item:e,tagCount:(l.value.get(e.id)??ce(e)).length})),a=(e,n)=>e.localeCompare(n,'zh-CN');return n.sort((e,n)=>{const t=e.item,r=n.item;if('name'===w.value)return a(t.name,r.name);if('tags'===w.value)return n.tagCount!==e.tagCount?n.tagCount-e.tagCount:a(t.name,r.name);if('imported'===w.value){const e=sn(t),n=sn(r);return n!==e?n-e:a(t.name,r.name)}const o=un(t),c=un(r);if(c!==o)return c-o;const i=t.createdAt??0,l=r.createdAt??0;return l!==i?l-i:a(t.name,r.name)}).map(e=>e.item)}function mn(e){return!('library'!==e.origin&&!Boolean(e.rawType))||Q.library.some(n=>n.id===e.id)}function fn(e){const n=e.replace('#','');if(6!==n.length)return'0, 0, 0';return`${Number.parseInt(n.slice(0,2),16)}, ${Number.parseInt(n.slice(2,4),16)}, ${Number.parseInt(n.slice(4,6),16)}`}function vn(e){const n=fn(e).split(',').map(e=>Number(e.trim()));if(3!==n.length)return'#1b1b1b';const[a,t,r]=n.map(e=>e/255);return.2126*a+.7152*t+.0722*r>.6?'#1b1b1b':'#ffffff'}let xn=0,_n=null;function yn(e){xn&&(cancelAnimationFrame(xn),xn=0),_n&&window.clearTimeout(_n),_n=window.setTimeout(()=>{_n=null,xn=requestAnimationFrame(()=>{xn=0,function(e){const n=function(){try{return(window.parent?.document??document).querySelector('.cardhub-root')}catch{return document.querySelector('.cardhub-root')}}();if(!n)return;n.style.setProperty('--cardhub-bg-start',e.bgStart),n.style.setProperty('--cardhub-bg-end',e.bgEnd),n.style.setProperty('--cardhub-surface',e.surface),n.style.setProperty('--cardhub-surface-alt',e.surfaceAlt),n.style.setProperty('--cardhub-text',e.text),n.style.setProperty('--cardhub-text-muted',e.textMuted),n.style.setProperty('--cardhub-accent',e.accent),n.style.setProperty('--cardhub-accent-strong',e.accentStrong),n.style.setProperty('--cardhub-border',e.border),n.style.setProperty('--cardhub-surface-rgb',fn(e.surface)),n.style.setProperty('--cardhub-surface-alt-rgb',fn(e.surfaceAlt)),n.style.setProperty('--cardhub-border-rgb',fn(e.border)),n.style.setProperty('--cardhub-accent-rgb',fn(e.accent)),n.style.setProperty('--cardhub-accent-strong-rgb',fn(e.accentStrong)),n.style.setProperty('--cardhub-accent-text',vn(e.accent)),n.style.setProperty('--cardhub-accent-strong-text',vn(e.accentStrong))}(e)})},80)}function wn(){const e=s();return function(e){if(!e||'object'!=typeof e)return{...S};const n=e,a=e=>{const a=n[e];return/^#[0-9a-f]{6}$/i.test(a)?a:S[e]};return{bgStart:a('bgStart'),bgEnd:a('bgEnd'),surface:a('surface'),surfaceAlt:a('surfaceAlt'),text:a('text'),textMuted:a('textMuted'),accent:a('accent'),accentStrong:a('accentStrong'),border:a('border')}}(e?.theme)}function kn(){const e=T.value;Object.assign(D,e),B.value=!0,(0,G.nextTick)(()=>yn(e))}function En(){B.value=!1,Object.assign(D,T.value),yn(T.value)}function Nn(){Object.assign(D,S)}function Cn(){T.value={...D},u({theme:T.value}),yn(T.value),B.value=!1}function Vn(){const e=p(),n='indexeddb'===e.mode||'variables'===e.mode?e.mode:'variables';L.value=n,j.value=n}function Sn(){Vn(),de(),M.value=!0}function zn(){M.value=!1,j.value=L.value,Object.assign(K,R)}async function Bn(){if(F.value||!U.value&&!re.value)return void(M.value=!1);F.value=!0;const e=j.value,n=L.value;try{if(U.value){const n=await J();g({mode:e}),await E(n,e),L.value=e,te(n)}re.value&&(Object.assign(R,K),u({uiSettings:{...R}}),a.value=R.pageSize),M.value=!1,toastr.success(U.value?'已切换私有库存储位置':'已保存设置')}catch(e){console.warn('[CardHub] 切换私有库存储失败',e),U.value&&(g({mode:n}),L.value=n,j.value=n),Object.assign(K,R),toastr.error('切换存储失败，请稍后重试')}finally{F.value=!1}}async function Tn(){const e=await J();Er(new Blob([JSON.stringify({entries:e},null,2)],{type:'application/json'}),`cardhub_library_${(new Date).toISOString().slice(0,10)}.json`),toastr.success('已导出私有库备份')}function Dn(){le.value?.click()}async function An(e){const n=e.target,a=n?.files;if(!a||!a.length)return;const t=a[0];try{const e=q(await t.text());if(!e)return void toastr.error('不是有效的私有库备份文件');const n=await Xt({title:'导入私有库备份',message:'选择“覆盖”会替换现有私有库，选择“合并”会追加进去。',confirmLabel:'覆盖',altLabel:'合并',cancelLabel:'取消'});if('cancel'===n)return;const a=Y(e),r=Q.library,o='alt'===n?X(r,a):a;te(o),await E(o),toastr.success('alt'===n?'已合并私有库备份':'已导入私有库备份')}finally{n&&(n.value='')}}function Mn(){Ae.value=[]}function Ln(){Be.value=!1}function jn(){r.value>1&&(r.value-=1)}function $n(){r.value<Ge.value&&(r.value+=1)}function Fn(e){return e.trim().toLocaleLowerCase()}function In(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}return n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n),n.trim().toLowerCase()}function On(e){return In(e).replace(/\.(png|webp|jpg|jpeg)$/i,'')}function Wt(e){return Fn(e.replace(/\.(png|json)$/i,''))}function qt(e){ae(function(e){return e.map(e=>{const n=tn(e);return{...e,note:n}})}(e))}function Xt(e){return c.open&&c.resolve&&c.resolve('cancel'),c.title=e.title??'确认操作',c.message=e.message,c.confirmLabel=e.confirmLabel??'确定',c.cancelLabel=e.cancelLabel??'取消',c.altLabel=e.altLabel??'',c.open=!0,new Promise(e=>{c.resolve=e})}function Zt(e){if(!c.open)return;c.open=!1;const n=c.resolve;c.resolve=null,n&&n(e)}function Gt(e,n){if(mn(e)){te(function(e,n,a){const t=(Array.isArray(a)&&a.length?a:[]).map(a=>a.id!==e?a:{...a,tags:n,tagsEdited:!0});return E(t),t}(e.id,n,Q.library))}else{const a=cn(e,n);e.tags=a,ae([...Q.characters])}}(0,G.watch)(D,e=>{B.value&&yn({...e})},{deep:!0}),(0,G.onMounted)(()=>{const e=wn();T.value=e,Object.assign(D,e),(0,G.nextTick)(()=>yn(e)),I.value='undefined'!=typeof indexedDB,Vn(),de(),x.value=function(){const e=s(),n=e?.favorites;return Array.isArray(n)?n.filter(e=>'string'==typeof e):[]}(),N.value=function(){const e=s(),n=e?.lastChatCache;if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),C.value=function(){const e=s(),n=e?.importCache;if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),V.value=function(){const e=s(),n=e?.notes;if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'string'==typeof e&&e.trim().length>0);return Object.fromEntries(a)}(),yr(i.value),wr(i.value)}),(0,G.watch)([()=>Q.search,n,()=>b.value.join('|'),w,k],()=>{r.value=1}),(0,G.watch)([ue,Ge],()=>{r.value>Ge.value&&(r.value=Ge.value),r.value<1&&(r.value=1)}),(0,G.watch)([w,i],()=>{'recent'===w.value&&yr(i.value),'imported'===w.value&&wr(i.value)});const{tagKey:Qt,activeTagKey:er,tagInput:nr,startTagEdit:ar,cancelTagEdit:tr,confirmTag:rr,removeTag:or}=function(e){const n=(0,G.ref)(null),a=(0,G.ref)('');function t(e){return e.id}function r(){n.value=null,a.value=''}return{tagKey:t,activeTagKey:n,tagInput:a,startTagEdit:function(e){n.value=t(e),a.value='',(0,G.nextTick)(()=>{const e=document.querySelector('.cardhub-tag-input');e?.focus()})},cancelTagEdit:r,confirmTag:function(o){if(n.value!==t(o))return;const c=a.value.trim();if(c){const n=[...e.getTags(o),c];e.applyTagUpdate(o,n)}r()},removeTag:function(n,a){const t=e.getTags(n).filter(e=>e!==a);e.applyTagUpdate(n,t)}}}({getTags:on,applyTagUpdate:Gt});function cr(e,n){const a=n.trim();if(mn(e)){const n=function(e,n,a){const t=(Array.isArray(a)&&a.length?a:[]).map(a=>a.id!==e?a:{...a,note:n});return E(t),t}(e.id,a,Q.library);te(n);const t=n.find(n=>n.id===e.id);return void(t&&(o.value=t))}const t=function(e){if('tavern'!==e.origin)return null;const n=e.tagKey??e.avatar??e.name;return n?`tavern:${n}`:null}(e);if(!t)return;const r={...V.value};a?r[t]=a:delete r[t],V.value=r,u({notes:r});const c=Q.characters.map(n=>n.id===e.id?{...n,note:a}:n);ae(c);const i=c.find(n=>n.id===e.id);i&&(o.value=i)}function ir(e){const n=tn(e);o.value=n?{...e,note:n}:e}function lr(){o.value=null}function dr(e){return e.raw&&e.rawType?'json'===e.rawType?sr(e.raw):'png'===e.rawType?function(e){const n=function(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}(e);if(!n)return null;const a=function(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let t=8;for(;t+8<=e.length;){const n=gr(e,t),r=hr(e.subarray(t+4,t+8)),o=t+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===r){const e=ur(i);e&&a.push(e)}else if('iTXt'===r){const e=br(i);e&&a.push(e)}t=c+4}return a}(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=pr(e.value);if(n)return n}return null}(e.raw):null:null}function sr(e){try{return JSON.parse(e)}catch{return null}}function ur(e){const n=e.indexOf(0);if(n<0)return null;const a=hr(e.subarray(0,n)).trim(),t=hr(e.subarray(n+1)).trim();return a&&t?{key:a,value:t}:null}function br(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=hr(e.subarray(0,n)).trim(),t=1===e[n+1];let r=n+2;const o=e.indexOf(0,r);if(o<0)return null;r=o+1;const c=e.indexOf(0,r);if(c<0)return null;if(r=c+1,t)return null;const i=hr(e.subarray(r)).trim();return a&&i?{key:a,value:i}:null}function pr(e){const n=e.trim();if(!n)return null;const a=sr(n);if(a)return a;if(!function(e){if(e.length<16||e.length%4!=0)return!1;return/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const t=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return t?sr(t):null}function gr(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function hr(e){return(new TextDecoder).decode(e)}function mr(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function fr(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function vr(e){const n=[e?.last_message_time,e?.last_message_date,e?.update_time,e?.last_modified,e?.create_date,e?.timestamp,e?.time];for(const e of n){const n=fr(e);if(n)return n}const a=mr(e?.file_name,e?.file_id);return a?function(e){const n=e.replace(/\.jsonl$/i,'').trim().match(/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/);if(!n)return null;const a=Number(n[1]),t=Number(n[2]),r=Number(n[3]),o=n[4]?Number(n[4]):0,c=n[5]?Number(n[5]):0,i=n[6]?Number(n[6]):0;if(!a||!t||!r)return null;const l=new Date(a,t-1,r,o,c,i).getTime();return Number.isNaN(l)?null:l}(a):null}function xr(e){return[...e].sort((e,n)=>{const a=vr(e)??0;return(vr(n)??0)-a})}let _r=0;async function yr(e){if('recent'!==w.value)return;const n=e.filter(e=>'tavern'===e.origin&&(!('number'==typeof e.lastChatAt&&e.lastChatAt>0)&&un(e)<=0));if(!n.length)return;const a=++_r;for(const e of n){if(a!==_r||'recent'!==w.value)return;if('tavern'!==e.origin)continue;if('number'==typeof e.lastChatAt&&e.lastChatAt>0)continue;const n=un(e);let t=null;try{t=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0)}catch(e){console.warn('[CardHub] 读取聊天简报失败',e)}if(Array.isArray(t)&&t.length){const a=vr(xr(t)[0])??0;a>n&&bn(e,a)}await kr(80)}}function wr(e){const n={...C.value};let a=!1;const t=Date.now();e.forEach((r,o)=>{if('tavern'!==r.origin)return;if('number'==typeof r.createdAt&&r.createdAt>0)return;const c=dn(r);c&&!n[c]&&(n[c]=t-1e3*(e.length-1-o),a=!0)}),a&&pn(n)}function kr(e){return new Promise(n=>setTimeout(n,e))}function Er(e,n){const a=URL.createObjectURL(e),t=document.createElement('a');t.href=a,t.download=n,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(a)}async function Nr(){ne(!0);try{qt(await t());te(await J())}finally{ne(!1)}}function Cr(){ee(!1)}return(e,a)=>((0,G.openBlock)(),(0,G.createElementBlock)('div',{class:(0,G.normalizeClass)(['cardhub-root',{open:(0,G.unref)(Q).open}]),style:(0,G.normalizeStyle)(A.value)},[(0,G.createElementVNode)('div',{class:'cardhub-backdrop',onClick:Cr}),(0,G.createElementVNode)('section',Rn,[(0,G.createElementVNode)('header',{class:'cardhub-header'},[a[70]||(a[70]=(0,G.createElementVNode)('div',{class:'cardhub-title'},[(0,G.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,G.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,G.createElementVNode)('div',{class:'cardhub-actions'},[(0,G.createElementVNode)('button',{class:'cardhub-theme-trigger',type:'button','aria-label':'配色',onClick:kn},[...a[67]||(a[67]=[(0,G.createElementVNode)('i',{class:'fa-solid fa-palette','aria-hidden':'true'},null,-1)])]),(0,G.createElementVNode)('button',{class:'cardhub-settings-trigger',type:'button','aria-label':'设置',onClick:Sn},[...a[68]||(a[68]=[(0,G.createElementVNode)('i',{class:'fa-solid fa-gear','aria-hidden':'true'},null,-1)])]),(0,G.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:Cr},[...a[69]||(a[69]=[(0,G.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,G.createElementVNode)('div',Kn,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>(0,G.unref)(Q).search=e),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[G.vModelText,(0,G.unref)(Q).search]]),(0,G.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:Nr},'刷新'),(0,G.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[1]||(a[1]=(...e)=>(0,G.unref)(Ke)&&(0,G.unref)(Ke)(...e))},'导入'),(0,G.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[2]||(a[2]=(...e)=>(0,G.unref)(Ie)&&(0,G.unref)(Ie)(...e))},'批量导出'),(0,G.createElementVNode)('input',{ref_key:'importInput',ref:ze,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:a[3]||(a[3]=(...e)=>(0,G.unref)(Ye)&&(0,G.unref)(Ye)(...e))},null,544)]),(0,G.createElementVNode)('div',Yn,[(0,G.createElementVNode)('div',Jn,[(0,G.createElementVNode)('div',Wn,[(0,G.createElementVNode)('div',qn,[a[71]||(a[71]=(0,G.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,G.createElementVNode)('div',Xn,[(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'all'===n.value}]),type:'button',onClick:a[4]||(a[4]=e=>n.value='all')},' 全部 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'imported'===n.value}]),type:'button',onClick:a[5]||(a[5]=e=>n.value='imported')},' 已导入 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===n.value}]),type:'button',onClick:a[6]||(a[6]=e=>n.value='unimported')},' 未导入 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'duplicate'===n.value}]),type:'button',onClick:a[7]||(a[7]=e=>n.value='duplicate')},' 重复 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':k.value}]),type:'button',onClick:a[8]||(a[8]=e=>k.value=!k.value)},' 收藏 ',2)])]),(0,G.createElementVNode)('div',Zn,[a[72]||(a[72]=(0,G.createElementVNode)('div',{class:'cardhub-section-title'},'排序',-1)),(0,G.createElementVNode)('div',Gn,[(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'recent'===w.value}]),type:'button',onClick:a[9]||(a[9]=e=>w.value='recent')},' 最近聊天 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'name'===w.value}]),type:'button',onClick:a[10]||(a[10]=e=>w.value='name')},' 名称 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'tags'===w.value}]),type:'button',onClick:a[11]||(a[11]=e=>w.value='tags')},' 标签数量 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-chip',{'is-active':'imported'===w.value}]),type:'button',onClick:a[12]||(a[12]=e=>w.value='imported')},' 导入时间 ',2)])])]),a[73]||(a[73]=(0,G.createElementVNode)('div',{class:'cardhub-divider'},null,-1)),a[74]||(a[74]=(0,G.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,G.createElementVNode)('div',Qn,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(h),e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e,class:(0,G.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':(0,G.unref)(b).includes(e)}]),type:'button',onClick:n=>(0,G.unref)(f)(e)},(0,G.toDisplayString)(e),11,ea))),128))]),(0,G.unref)(b).length?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:a[13]||(a[13]=(...e)=>(0,G.unref)(v)&&(0,G.unref)(v)(...e))},' 清空标签 ')):(0,G.createCommentVNode)('v-if',!0),(0,G.createElementVNode)('button',{class:'cardhub-chip cardhub-chip--more',type:'button',onClick:a[14]||(a[14]=e=>(0,G.unref)(ge)('filter'))},' 标签管理 ')]),(0,G.createElementVNode)('div',na,[(0,G.unref)(Q).loading?((0,G.openBlock)(),(0,G.createElementBlock)('div',aa,'正在读取角色卡...')):ue.value.length?((0,G.openBlock)(),(0,G.createElementBlock)('div',ra,[(0,G.createElementVNode)('div',oa,[Ge.value>1?((0,G.openBlock)(),(0,G.createElementBlock)('div',ca,[(0,G.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:r.value<=1,onClick:jn},' 上一页 ',8,ia),(0,G.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:r.value>=Ge.value,onClick:$n},' 下一页 ',8,la)])):(0,G.createCommentVNode)('v-if',!0),(0,G.createElementVNode)('span',da,'第 '+(0,G.toDisplayString)(r.value)+' / '+(0,G.toDisplayString)(Ge.value)+' 页',1)]),(0,G.createElementVNode)('div',sa,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(Qe.value,e=>{return(0,G.openBlock)(),(0,G.createElementBlock)('article',{key:e.id,class:(0,G.normalizeClass)(['cardhub-card',{'is-duplicate':d.value.has(e.id)}]),onClick:n=>ir(e)},[(0,G.createElementVNode)('div',{class:(0,G.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(en(e))}]),style:(0,G.normalizeStyle)(nn(e))},[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(e.name.slice(0,1)||'?'),1)],6),(0,G.createElementVNode)('div',ba,[(0,G.createElementVNode)('div',pa,[(0,G.createElementVNode)('div',ga,(0,G.toDisplayString)(e.name),1),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-fav',{'is-active':(n=e.id,y.value.has(n))}]),type:'button','aria-label':'收藏',onClick:(0,G.withModifiers)(n=>gn(e),['stop'])},[...a[75]||(a[75]=[(0,G.createElementVNode)('i',{class:'fa-solid fa-star','aria-hidden':'true'},null,-1)])],10,ha)]),(0,G.createElementVNode)('div',ma,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(an(e).length)+' 标签',1)]),oe.value&&rn(e)?((0,G.openBlock)(),(0,G.createElementBlock)('div',fa,(0,G.toDisplayString)(rn(e)),1)):(0,G.createCommentVNode)('v-if',!0),(0,G.createElementVNode)('div',va,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(an(e),n=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:n,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:(0,G.withModifiers)(a=>(0,G.unref)(or)(e,n),['stop'])},[(0,G.createTextVNode)((0,G.toDisplayString)(n)+' ',1),a[76]||(a[76]=(0,G.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,xa))),128)),(0,G.unref)(er)!==(0,G.unref)(Qt)(e)?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:(0,G.withModifiers)(n=>(0,G.unref)(ar)(e),['stop'])},' + 标签 ',8,_a)):((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:1,class:'cardhub-tag-edit',onClick:a[17]||(a[17]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[18]||(a[18]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[19]||(a[19]=(0,G.withModifiers)(()=>{},['stop']))},[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[15]||(a[15]=e=>(0,G.isRef)(nr)?nr.value=e:null),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,G.withKeys)((0,G.withModifiers)(n=>(0,G.unref)(rr)(e),['prevent']),['enter']),a[16]||(a[16]=(0,G.withKeys)((0,G.withModifiers)((...e)=>(0,G.unref)(tr)&&(0,G.unref)(tr)(...e),['prevent']),['esc']))],onBlur:n=>(0,G.unref)(rr)(e)},null,40,ya),[[G.vModelText,(0,G.unref)(nr)]]),(0,G.createElementVNode)('button',{class:'cardhub-tag-confirm',type:'button',onClick:n=>(0,G.unref)(rr)(e)},'✔',8,wa)],32))])]),(0,G.createElementVNode)('div',ka,[(0,G.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,G.withModifiers)(n=>(0,G.unref)(Je)(e),['stop']),onPointerdown:a[20]||(a[20]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[21]||(a[21]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[22]||(a[22]=(0,G.withModifiers)(()=>{},['stop']))},(0,G.toDisplayString)('tavern'===e.origin?'导出':'导入'),41,Ea),(0,G.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,G.withModifiers)(n=>ir(e),['stop']),onPointerdown:a[23]||(a[23]=(0,G.withModifiers)(()=>{},['stop'])),onMousedown:a[24]||(a[24]=(0,G.withModifiers)(()=>{},['stop'])),onTouchstart:a[25]||(a[25]=(0,G.withModifiers)(()=>{},['stop']))},' 管理 ',40,Na)])],10,ua);var n}),128))])])):((0,G.openBlock)(),(0,G.createElementBlock)('div',ta,'暂无角色卡，或没有匹配的搜索结果。'))])])]),(0,G.createVNode)(Pn,{card:o.value,'display-tags':an,'handle-card-action':(0,G.unref)(Je),'manage-delete':(0,G.unref)(Ze),'close-manage':lr,'close-root':Cr,'apply-note-update':cr,'parse-library-card-data':dr,'update-last-chat-cache-for-card':bn},null,8,['card','handle-card-action','manage-delete']),c.open?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:0,class:'cardhub-confirm cardhub-modal',onClick:a[29]||(a[29]=(0,G.withModifiers)(e=>Zt('cancel'),['self']))},[(0,G.createElementVNode)('div',Ca,[(0,G.createElementVNode)('div',Va,(0,G.toDisplayString)(c.title),1),(0,G.createElementVNode)('div',Sa,(0,G.toDisplayString)(c.message),1),(0,G.createElementVNode)('div',za,[(0,G.createElementVNode)('button',{class:'cardhub-confirm__button is-cancel',type:'button',onClick:a[26]||(a[26]=e=>Zt('cancel'))},(0,G.toDisplayString)(c.cancelLabel),1),c.altLabel?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-confirm__button is-danger',type:'button',onClick:a[27]||(a[27]=e=>Zt('alt'))},(0,G.toDisplayString)(c.altLabel),1)):(0,G.createCommentVNode)('v-if',!0),(0,G.createElementVNode)('button',{class:'cardhub-confirm__button is-confirm',type:'button',onClick:a[28]||(a[28]=e=>Zt('confirm'))},(0,G.toDisplayString)(c.confirmLabel),1)])])])):(0,G.createCommentVNode)('v-if',!0),(0,G.unref)(be)?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:1,class:'cardhub-tag-manager cardhub-modal',onClick:a[41]||(a[41]=(0,G.withModifiers)((...e)=>(0,G.unref)(he)&&(0,G.unref)(he)(...e),['self']))},[(0,G.createElementVNode)('div',Ba,[(0,G.createElementVNode)('div',Ta,[(0,G.createElementVNode)('div',null,[a[77]||(a[77]=(0,G.createElementVNode)('div',{class:'cardhub-tag-manager__title'},'标签管理',-1)),'filter'===(0,G.unref)(pe)?((0,G.openBlock)(),(0,G.createElementBlock)('div',Da,' 已选 '+(0,G.toDisplayString)((0,G.unref)(b).length)+' / '+(0,G.toDisplayString)((0,G.unref)(h).length),1)):((0,G.openBlock)(),(0,G.createElementBlock)('div',Aa,' 已选 '+(0,G.toDisplayString)((0,G.unref)(me).length)+' / '+(0,G.toDisplayString)((0,G.unref)(ye).length),1))]),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:a[30]||(a[30]=(...e)=>(0,G.unref)(he)&&(0,G.unref)(he)(...e))},'×')]),(0,G.createElementVNode)('div',Ma,[(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'filter'===(0,G.unref)(pe)}]),type:'button',onClick:a[31]||(a[31]=e=>(0,G.unref)(ge)('filter'))},' 标签筛选 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'batch'===(0,G.unref)(pe)}]),type:'button',onClick:a[32]||(a[32]=e=>(0,G.unref)(ge)('batch'))},' 批量标签 ',2)]),'filter'===(0,G.unref)(pe)?((0,G.openBlock)(),(0,G.createElementBlock)('div',La,[(0,G.createElementVNode)('div',ja,[(0,G.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-secondary',type:'button',disabled:!(0,G.unref)(b).length,onClick:a[33]||(a[33]=(...e)=>(0,G.unref)(v)&&(0,G.unref)(v)(...e))},' 清空 ',8,$a),a[78]||(a[78]=(0,G.createElementVNode)('div',{class:'cardhub-tag-manager__spacer'},null,-1)),(0,G.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-primary',type:'button',onClick:a[34]||(a[34]=(...e)=>(0,G.unref)(he)&&(0,G.unref)(he)(...e))},'完成')]),(0,G.createElementVNode)('div',Fa,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(h),e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e,class:(0,G.normalizeClass)(['cardhub-tag-manager__chip',{'is-active':(0,G.unref)(b).includes(e)}]),type:'button',onClick:n=>(0,G.unref)(f)(e)},(0,G.toDisplayString)(e),11,Ia))),128))])])):((0,G.openBlock)(),(0,G.createElementBlock)('div',Oa,[(0,G.createElementVNode)('div',Pa,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[35]||(a[35]=e=>(0,G.isRef)(fe)?fe.value=e:null),class:'cardhub-batch__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[G.vModelText,(0,G.unref)(fe)]]),a[79]||(a[79]=(0,G.createElementVNode)('div',{class:'cardhub-batch__hint'},'提示：可先在主界面筛选，再切换到批量标签。',-1))]),(0,G.createElementVNode)('div',Ua,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[36]||(a[36]=e=>(0,G.isRef)(ve)?ve.value=e:null),type:'text',placeholder:'输入标签，逗号/换行分隔'},null,512),[[G.vModelText,(0,G.unref)(ve)]])]),(0,G.unref)(we).length?((0,G.openBlock)(),(0,G.createElementBlock)('div',Ha,[a[80]||(a[80]=(0,G.createElementVNode)('span',{class:'cardhub-batch__suggest-title'},'已有标签',-1)),(0,G.createElementVNode)('div',Ra,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(we),e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e,class:(0,G.normalizeClass)(['cardhub-batch__chip',{'is-active':(0,G.unref)(xe).includes(e)}]),type:'button',onClick:n=>(0,G.unref)(Ce)(e)},(0,G.toDisplayString)(e),11,Ka))),128))])])):(0,G.createCommentVNode)('v-if',!0),(0,G.createElementVNode)('div',Ya,[(0,G.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[37]||(a[37]=(...e)=>(0,G.unref)(Ee)&&(0,G.unref)(Ee)(...e))},'全选'),(0,G.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[38]||(a[38]=(...e)=>(0,G.unref)(Ne)&&(0,G.unref)(Ne)(...e))},'清空'),a[81]||(a[81]=(0,G.createElementVNode)('div',{class:'cardhub-batch__spacer'},null,-1)),(0,G.createElementVNode)('button',{class:'cardhub-batch__btn is-ghost',type:'button',onClick:a[39]||(a[39]=e=>(0,G.unref)(Ve)('remove'))},' 移除标签 '),(0,G.createElementVNode)('button',{class:'cardhub-batch__btn is-primary',type:'button',onClick:a[40]||(a[40]=e=>(0,G.unref)(Ve)('add'))},'添加标签')]),(0,G.createElementVNode)('div',Ja,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(ye),e=>((0,G.openBlock)(),(0,G.createElementBlock)('label',{key:e.id,class:'cardhub-batch__item'},[(0,G.createElementVNode)('input',{class:'cardhub-batch__checkbox',type:'checkbox',checked:(0,G.unref)(_e).has(e.id),onChange:n=>(0,G.unref)(ke)(e.id)},null,40,Wa),(0,G.createElementVNode)('div',qa,[(0,G.createElementVNode)('div',Xa,(0,G.toDisplayString)(e.name),1),(0,G.createElementVNode)('div',Za,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(an(e).length)+' 标签',1)]),an(e).length?((0,G.openBlock)(),(0,G.createElementBlock)('div',Ga,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(an(e).slice(0,3),e=>((0,G.openBlock)(),(0,G.createElementBlock)('span',{key:e,class:'cardhub-batch__tag'},(0,G.toDisplayString)(e),1))),128))])):(0,G.createCommentVNode)('v-if',!0)])]))),128))])]))])])):(0,G.createCommentVNode)('v-if',!0),(0,G.unref)(Be)?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:2,class:'cardhub-export cardhub-modal',onClick:(0,G.withModifiers)(Ln,['self'])},[(0,G.createElementVNode)('div',Qa,[(0,G.createElementVNode)('div',et,[(0,G.createElementVNode)('div',null,[a[82]||(a[82]=(0,G.createElementVNode)('div',{class:'cardhub-export__title'},'批量导出',-1)),(0,G.createElementVNode)('div',nt,' 已选 '+(0,G.toDisplayString)((0,G.unref)(je).length)+' / '+(0,G.toDisplayString)((0,G.unref)(Le).length),1)]),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Ln},'×')]),(0,G.createElementVNode)('div',at,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[42]||(a[42]=e=>(0,G.isRef)(Te)?Te.value=e:null),class:'cardhub-export__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[G.vModelText,(0,G.unref)(Te)]]),(0,G.createElementVNode)('div',tt,[(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-export__chip',{'is-active':'all'===(0,G.unref)(De)}]),type:'button',onClick:a[43]||(a[43]=e=>De.value='all')},' 全部 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-export__chip',{'is-active':'imported'===(0,G.unref)(De)}]),type:'button',onClick:a[44]||(a[44]=e=>De.value='imported')},' 已导入 ',2),(0,G.createElementVNode)('button',{class:(0,G.normalizeClass)(['cardhub-export__chip',{'is-active':'unimported'===(0,G.unref)(De)}]),type:'button',onClick:a[45]||(a[45]=e=>De.value='unimported')},' 未导入 ',2)]),(0,G.createElementVNode)('div',rt,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(Me),e=>((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:e,class:(0,G.normalizeClass)(['cardhub-export__chip',{'is-active':(0,G.unref)(Ae).includes(e)}]),type:'button',onClick:n=>function(e){Ae.value.includes(e)?Ae.value=Ae.value.filter(n=>n!==e):Ae.value=[...Ae.value,e]}(e)},(0,G.toDisplayString)(e),11,ot))),128)),(0,G.unref)(Ae).length?((0,G.openBlock)(),(0,G.createElementBlock)('button',{key:0,class:'cardhub-export__chip cardhub-export__chip--clear',type:'button',onClick:Mn},' 清空标签 ')):(0,G.createCommentVNode)('v-if',!0)])]),(0,G.createElementVNode)('div',ct,[(0,G.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[46]||(a[46]=(...e)=>(0,G.unref)(He)&&(0,G.unref)(He)(...e))},'全选'),(0,G.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[47]||(a[47]=(...e)=>(0,G.unref)(Re)&&(0,G.unref)(Re)(...e))},'清空'),a[83]||(a[83]=(0,G.createElementVNode)('div',{class:'cardhub-export__spacer'},null,-1)),(0,G.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:Ln},'取消'),(0,G.createElementVNode)('button',{class:'cardhub-export__btn is-primary',type:'button',onClick:a[48]||(a[48]=(...e)=>(0,G.unref)(Oe)&&(0,G.unref)(Oe)(...e))},'导出已选')]),(0,G.createElementVNode)('div',it,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)((0,G.unref)(Le),e=>((0,G.openBlock)(),(0,G.createElementBlock)('label',{key:e.id,class:'cardhub-export__item'},[(0,G.createElementVNode)('input',{class:'cardhub-export__checkbox',type:'checkbox',checked:(0,G.unref)(Pe)(e.id),onChange:n=>(0,G.unref)(Ue)(e.id)},null,40,lt),(0,G.createElementVNode)('div',dt,[(0,G.createElementVNode)('div',st,(0,G.toDisplayString)(e.name),1),(0,G.createElementVNode)('div',ut,[(0,G.createElementVNode)('span',null,(0,G.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,G.createElementVNode)('span',null,(0,G.toDisplayString)(an(e).length)+' 标签',1)]),an(e).length?((0,G.openBlock)(),(0,G.createElementBlock)('div',bt,[((0,G.openBlock)(!0),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(an(e).slice(0,3),e=>((0,G.openBlock)(),(0,G.createElementBlock)('span',{key:e,class:'cardhub-export__tag'},(0,G.toDisplayString)(e),1))),128))])):(0,G.createCommentVNode)('v-if',!0)])]))),128))])])])):(0,G.createCommentVNode)('v-if',!0),M.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:3,class:'cardhub-settings cardhub-modal',onClick:(0,G.withModifiers)(zn,['self'])},[(0,G.createElementVNode)('div',pt,[(0,G.createElementVNode)('div',{class:'cardhub-settings__header'},[a[84]||(a[84]=(0,G.createElementVNode)('div',null,[(0,G.createElementVNode)('div',{class:'cardhub-settings__title'},'设置'),(0,G.createElementVNode)('div',{class:'cardhub-settings__subtitle'},'用于调整私有库在本地的存储方式')],-1)),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:zn},'×')]),(0,G.createElementVNode)('div',gt,[a[88]||(a[88]=(0,G.createElementVNode)('div',{class:'cardhub-settings__label'},'私有库存储位置',-1)),(0,G.createElementVNode)('div',ht,' 当前：'+(0,G.toDisplayString)(P.value)+'。切换后会迁移现有私有库数据，仅影响未导入角色卡。 ',1),(0,G.createElementVNode)('div',mt,[(0,G.createElementVNode)('label',{class:(0,G.normalizeClass)(['cardhub-settings__option',{'is-active':'variables'===j.value}])},[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[49]||(a[49]=e=>j.value=e),type:'radio',value:'variables'},null,512),[[G.vModelRadio,j.value]]),a[85]||(a[85]=(0,G.createElementVNode)('div',{class:'cardhub-settings__option-body'},[(0,G.createElementVNode)('div',{class:'cardhub-settings__option-title'},'酒馆助手变量'),(0,G.createElementVNode)('div',{class:'cardhub-settings__option-desc'},'无需额外权限，但数据量大时会变慢。')],-1))],2),(0,G.createElementVNode)('label',{class:(0,G.normalizeClass)(['cardhub-settings__option',{'is-active':'indexeddb'===j.value,'is-disabled':!I.value}])},[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[50]||(a[50]=e=>j.value=e),type:'radio',value:'indexeddb',disabled:!I.value},null,8,ft),[[G.vModelRadio,j.value]]),(0,G.createElementVNode)('div',vt,[a[86]||(a[86]=(0,G.createElementVNode)('div',{class:'cardhub-settings__option-title'},'浏览器 IndexedDB',-1)),a[87]||(a[87]=(0,G.createElementVNode)('div',{class:'cardhub-settings__option-desc'},'适合大体积私有库，但仅在当前浏览器生效，换设备会丢失。',-1)),I.value?(0,G.createCommentVNode)('v-if',!0):((0,G.openBlock)(),(0,G.createElementBlock)('div',xt,'当前浏览器不支持。'))])],2)])]),(0,G.createElementVNode)('div',_t,[a[97]||(a[97]=(0,G.createElementVNode)('div',{class:'cardhub-settings__label'},'列表显示',-1)),(0,G.createElementVNode)('div',yt,[(0,G.createElementVNode)('label',wt,[a[90]||(a[90]=(0,G.createElementVNode)('span',null,'每页数量',-1)),(0,G.withDirectives)((0,G.createElementVNode)('select',{'onUpdate:modelValue':a[51]||(a[51]=e=>K.pageSize=e),class:'cardhub-settings__select'},[...a[89]||(a[89]=[(0,G.createElementVNode)('option',{value:12},'12',-1),(0,G.createElementVNode)('option',{value:24},'24',-1),(0,G.createElementVNode)('option',{value:36},'36',-1),(0,G.createElementVNode)('option',{value:48},'48',-1)])],512),[[G.vModelSelect,K.pageSize,void 0,{number:!0}]])]),(0,G.createElementVNode)('label',kt,[a[91]||(a[91]=(0,G.createElementVNode)('span',null,'显示备注摘要',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[52]||(a[52]=e=>K.showNoteSummary=e),type:'checkbox'},null,512),[[G.vModelCheckbox,K.showNoteSummary]])]),(0,G.createElementVNode)('label',Et,[a[93]||(a[93]=(0,G.createElementVNode)('span',null,'标签默认行数',-1)),(0,G.withDirectives)((0,G.createElementVNode)('select',{'onUpdate:modelValue':a[53]||(a[53]=e=>K.tagRows=e),class:'cardhub-settings__select'},[...a[92]||(a[92]=[(0,G.createElementVNode)('option',{value:1},'1',-1),(0,G.createElementVNode)('option',{value:2},'2',-1),(0,G.createElementVNode)('option',{value:3},'3',-1),(0,G.createElementVNode)('option',{value:4},'4',-1)])],512),[[G.vModelSelect,K.tagRows,void 0,{number:!0}]])]),(0,G.createElementVNode)('label',Nt,[a[95]||(a[95]=(0,G.createElementVNode)('span',null,'头像大小',-1)),(0,G.withDirectives)((0,G.createElementVNode)('select',{'onUpdate:modelValue':a[54]||(a[54]=e=>K.avatarSize=e),class:'cardhub-settings__select'},[...a[94]||(a[94]=[(0,G.createElementVNode)('option',{value:'sm'},'小',-1),(0,G.createElementVNode)('option',{value:'md'},'中',-1),(0,G.createElementVNode)('option',{value:'lg'},'大',-1)])],512),[[G.vModelSelect,K.avatarSize]])]),(0,G.createElementVNode)('label',Ct,[a[96]||(a[96]=(0,G.createElementVNode)('span',null,'同步酒馆标签',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[55]||(a[55]=e=>K.syncTavernTags=e),type:'checkbox'},null,512),[[G.vModelCheckbox,K.syncTavernTags]])])])]),(0,G.createElementVNode)('div',Vt,[a[100]||(a[100]=(0,G.createElementVNode)('div',{class:'cardhub-settings__label'},'导出默认格式',-1)),(0,G.createElementVNode)('div',St,[(0,G.createElementVNode)('label',zt,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[56]||(a[56]=e=>K.exportFormat=e),type:'radio',value:'png'},null,512),[[G.vModelRadio,K.exportFormat]]),a[98]||(a[98]=(0,G.createElementVNode)('span',null,'PNG',-1))]),(0,G.createElementVNode)('label',Bt,[(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[57]||(a[57]=e=>K.exportFormat=e),type:'radio',value:'json'},null,512),[[G.vModelRadio,K.exportFormat]]),a[99]||(a[99]=(0,G.createElementVNode)('span',null,'JSON',-1))])])]),(0,G.createElementVNode)('div',Tt,[a[101]||(a[101]=(0,G.createElementVNode)('div',{class:'cardhub-settings__label'},'私有库备份',-1)),a[102]||(a[102]=(0,G.createElementVNode)('div',{class:'cardhub-settings__hint'},'导出当前私有库为 JSON 文件，便于手动备份或迁移。',-1)),(0,G.createElementVNode)('div',Dt,[(0,G.createElementVNode)('button',{class:'cardhub-settings__btn is-secondary',type:'button',onClick:Tn},' 导出私有库 '),(0,G.createElementVNode)('button',{class:'cardhub-settings__btn is-secondary',type:'button',onClick:Dn},' 导入私有库 '),(0,G.createElementVNode)('input',{ref_key:'backupImportInput',ref:le,class:'cardhub-import-input',type:'file',accept:'.json',onChange:An},null,544)])]),(0,G.createElementVNode)('div',At,[(0,G.createElementVNode)('button',{class:'cardhub-settings__btn is-secondary',type:'button',onClick:zn},'取消'),a[103]||(a[103]=(0,G.createElementVNode)('div',{class:'cardhub-settings__spacer'},null,-1)),(0,G.createElementVNode)('button',{class:'cardhub-settings__btn is-primary',type:'button',disabled:!U.value&&!re.value||F.value,onClick:Bn},(0,G.toDisplayString)(F.value?'保存中...':'保存'),9,Mt)])])])):(0,G.createCommentVNode)('v-if',!0),B.value?((0,G.openBlock)(),(0,G.createElementBlock)('div',{key:4,class:'cardhub-theme cardhub-modal',onClick:(0,G.withModifiers)(En,['self'])},[(0,G.createElementVNode)('div',Lt,[(0,G.createElementVNode)('div',{class:'cardhub-theme__header'},[a[104]||(a[104]=(0,G.createElementVNode)('div',null,[(0,G.createElementVNode)('div',{class:'cardhub-theme__title'},'配色设置'),(0,G.createElementVNode)('div',{class:'cardhub-theme__subtitle'},'修改后可直接预览，保存到全局')],-1)),(0,G.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:En},'×')]),(0,G.createElementVNode)('div',jt,[(0,G.createElementVNode)('label',$t,[a[105]||(a[105]=(0,G.createElementVNode)('span',null,'背景渐变 1',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[58]||(a[58]=e=>D.bgStart=e),type:'color'},null,512),[[G.vModelText,D.bgStart]])]),(0,G.createElementVNode)('label',Ft,[a[106]||(a[106]=(0,G.createElementVNode)('span',null,'背景渐变 2',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[59]||(a[59]=e=>D.bgEnd=e),type:'color'},null,512),[[G.vModelText,D.bgEnd]])]),(0,G.createElementVNode)('label',It,[a[107]||(a[107]=(0,G.createElementVNode)('span',null,'卡片/面板底色',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[60]||(a[60]=e=>D.surface=e),type:'color'},null,512),[[G.vModelText,D.surface]])]),(0,G.createElementVNode)('label',Ot,[a[108]||(a[108]=(0,G.createElementVNode)('span',null,'浅色底',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[61]||(a[61]=e=>D.surfaceAlt=e),type:'color'},null,512),[[G.vModelText,D.surfaceAlt]])]),(0,G.createElementVNode)('label',Pt,[a[109]||(a[109]=(0,G.createElementVNode)('span',null,'主文本',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[62]||(a[62]=e=>D.text=e),type:'color'},null,512),[[G.vModelText,D.text]])]),(0,G.createElementVNode)('label',Ut,[a[110]||(a[110]=(0,G.createElementVNode)('span',null,'次级文本',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[63]||(a[63]=e=>D.textMuted=e),type:'color'},null,512),[[G.vModelText,D.textMuted]])]),(0,G.createElementVNode)('label',Ht,[a[111]||(a[111]=(0,G.createElementVNode)('span',null,'强调色',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[64]||(a[64]=e=>D.accent=e),type:'color'},null,512),[[G.vModelText,D.accent]])]),(0,G.createElementVNode)('label',Rt,[a[112]||(a[112]=(0,G.createElementVNode)('span',null,'强调深色',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[65]||(a[65]=e=>D.accentStrong=e),type:'color'},null,512),[[G.vModelText,D.accentStrong]])]),(0,G.createElementVNode)('label',Kt,[a[113]||(a[113]=(0,G.createElementVNode)('span',null,'边框',-1)),(0,G.withDirectives)((0,G.createElementVNode)('input',{'onUpdate:modelValue':a[66]||(a[66]=e=>D.border=e),type:'color'},null,512),[[G.vModelText,D.border]])])]),(0,G.createElementVNode)('div',Yt,[((0,G.openBlock)(),(0,G.createElementBlock)(G.Fragment,null,(0,G.renderList)(se,e=>(0,G.createElementVNode)('button',{key:e.name,class:'cardhub-theme__preset',type:'button',onClick:n=>function(e){Object.assign(D,e.value)}(e)},(0,G.toDisplayString)(e.name),9,Jt)),64))]),(0,G.createElementVNode)('div',{class:'cardhub-theme__actions'},[(0,G.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:Nn},'恢复默认'),a[114]||(a[114]=(0,G.createElementVNode)('div',{class:'cardhub-theme__spacer'},null,-1)),(0,G.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:En},'取消'),(0,G.createElementVNode)('button',{class:'cardhub-theme__btn is-primary',type:'button',onClick:Cn},'保存')])])])):(0,G.createCommentVNode)('v-if',!0)],6))}}),qt=Wt;function Xt(){const e=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-settings-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-settings-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-settings-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.75) 100%\n        );\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow:\n          0 8px 18px rgba(var(--cardhub-accent-rgb), 0.25),\n          inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.82) 100%\n        );\n        color: var(--cardhub-accent-text);\n        box-shadow:\n          0 10px 22px rgba(var(--cardhub-accent-rgb), 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.65);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.75);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-settings__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 2px;\n        width: 100%;\n        background: linear-gradient(\n          90deg,\n          rgba(var(--cardhub-border-rgb), 0) 0%,\n          rgba(var(--cardhub-border-rgb), 0.7) 50%,\n          rgba(var(--cardhub-border-rgb), 0) 100%\n        );\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        font-weight: 600;\n      }\n\n      .cardhub-section-title::before {\n        content: "";\n        width: 10px;\n        height: 10px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-accent-rgb), 0.6);\n        box-shadow:\n          0 0 0 2px rgba(var(--cardhub-accent-rgb), 0.2),\n          0 4px 8px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-border-rgb), 0.18),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.2),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.45);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-root {\n        --cardhub-tag-row-height: 28px;\n        --cardhub-tag-row-gap: 6px;\n        --cardhub-tag-row-padding: 20px;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.55);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.65);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.45);\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.2) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.95) 100%\n        );\n        color: var(--cardhub-accent-strong);\n        box-shadow:\n          0 8px 16px rgba(var(--cardhub-accent-rgb), 0.18),\n          inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.28) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.98) 100%\n        );\n        border-color: rgba(var(--cardhub-accent-rgb), 0.6);\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-filter-block + .cardhub-filter-block {\n        margin-top: 10px;\n        padding-top: 10px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card.is-duplicate {\n        border-color: rgba(200, 110, 80, 0.75);\n        box-shadow:\n          0 12px 20px rgba(200, 110, 80, 0.18),\n          inset 0 0 0 1px rgba(200, 110, 80, 0.25);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: var(--cardhub-avatar-size, 42px);\n        height: var(--cardhub-avatar-size, 42px);\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__note {\n        margin-top: 6px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        word-break: break-word;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow:\n          0 10px 22px rgba(43, 32, 24, 0.22),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.35);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow:\n          0 10px 20px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__name {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-note-trigger {\n        border: none;\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-note-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-note-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200100;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__overview-action {\n        justify-self: start;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-head {\n        display: flex;\n        align-items: flex-start;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-edit {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        margin-top: 2px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-manage__detail-edit:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-manage__detail-edit:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__detail-toggle {\n        justify-self: end;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 2px 0;\n      }\n\n      .cardhub-manage__toggle {\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.6);\n        box-shadow:\n          0 8px 18px rgba(43, 32, 24, 0.22),\n          inset 0 1px 0 rgba(255, 255, 255, 0.25);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 1) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.82) 100%\n        );\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 1);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__panel {\n        width: min(720px, 92vw);\n        max-width: 720px;\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-openings {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200300;\n      }\n\n      .cardhub-worldbook {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200310;\n      }\n\n      .cardhub-worldbook__panel {\n        width: min(720px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-worldbook__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-worldbook__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-worldbook__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-worldbook__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-worldbook__item-title {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        flex-wrap: wrap;\n      }\n\n      .cardhub-worldbook__item-index {\n        font-size: 11px;\n        padding: 2px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.15);\n        color: var(--cardhub-text-muted);\n        white-space: nowrap;\n      }\n\n      .cardhub-worldbook__item-name {\n        font-weight: 600;\n        color: var(--cardhub-text);\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        max-width: 100%;\n      }\n\n      .cardhub-worldbook__item-strategy {\n        font-size: 11px;\n        padding: 2px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.12);\n        color: var(--cardhub-text-muted);\n        white-space: nowrap;\n      }\n\n      .cardhub-worldbook__item-strategy.is-constant {\n        background: rgba(38, 110, 207, 0.16);\n        color: #2d6bd6;\n      }\n\n      .cardhub-worldbook__item-strategy.is-selective {\n        background: rgba(46, 159, 83, 0.16);\n        color: #2f8f54;\n      }\n\n      .cardhub-worldbook__item-strategy.is-vectorized {\n        background: rgba(130, 106, 224, 0.16);\n        color: #6f5bd1;\n      }\n\n      .cardhub-worldbook__item-disabled {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__item-preview {\n        margin-top: 4px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n        margin-bottom: 6px;\n      }\n\n      .cardhub-openings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-openings__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 10px;\n      }\n\n      .cardhub-openings__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-openings__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-openings__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-openings__item-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-openings__item-preview {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-meta {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 8px;\n      }\n\n      .cardhub-manage__opening-meta-value {\n        color: var(--cardhub-text);\n        font-weight: 600;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-manage__opening-body {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-toggle {\n        margin-top: 6px;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__pager {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        margin-top: 8px;\n      }\n\n      .cardhub-manage__pager-btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__pager-btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-manage__pager-status {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200800;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-root .cardhub-modal {\n        position: fixed !important;\n        inset: 0 !important;\n        display: grid !important;\n        place-items: center !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        height: 100dvh !important;\n      }\n\n      .cardhub-root .cardhub-modal__panel {\n        position: fixed !important;\n        left: 50vw !important;\n        top: 50vh !important;\n        transform: translate(-50%, -50%) !important;\n        margin: 0 !important;\n      }\n\n      .cardhub-note {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200900;\n      }\n\n      .cardhub-settings {\n        z-index: 200700;\n      }\n\n      .cardhub-settings__panel {\n        z-index: 200701;\n      }\n\n      .cardhub-note__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-note__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-note__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-note__input {\n        width: 100%;\n        min-height: 120px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-note__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-note__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-note__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-edit {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200900;\n      }\n\n      .cardhub-edit__panel {\n        width: min(540px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-edit__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-edit__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-edit__input {\n        width: 100%;\n        min-height: 140px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-edit__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-edit__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-edit__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-manage-viewer {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 200200;\n      }\n\n      .cardhub-manage-viewer__panel {\n        width: min(620px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 24px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        position: relative;\n        display: grid;\n        gap: 12px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage-viewer__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-manage-viewer__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-manage-viewer__content {\n        font-size: 13px;\n        line-height: 1.6;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-note__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-note__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-edit__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-edit__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200400;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200500;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        z-index: 200600;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type=\'color\'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-settings__panel {\n        width: min(560px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-settings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-settings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-settings__section {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-settings__label {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__hint {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.5;\n      }\n\n      .cardhub-settings__options {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-settings__options--compact {\n        gap: 8px;\n      }\n\n      .cardhub-settings__row {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 10px;\n        padding: 8px 10px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-rgb), 0.75);\n        font-size: 12px;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__select {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__toggle input {\n        appearance: none;\n        width: 18px;\n        height: 18px;\n        border-radius: 6px;\n        border: 2px solid rgba(var(--cardhub-accent-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        display: grid;\n        place-items: center;\n        cursor: pointer;\n        transition: background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;\n      }\n\n      .cardhub-settings__toggle input:checked {\n        background: rgba(var(--cardhub-accent-rgb), 0.9);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.9);\n        box-shadow: 0 6px 12px rgba(var(--cardhub-accent-rgb), 0.25);\n      }\n\n      .cardhub-settings__toggle input:checked::after {\n        content: \'\';\n        width: 8px;\n        height: 8px;\n        border-radius: 4px;\n        background: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-settings__radio {\n        gap: 6px;\n        justify-content: flex-start;\n      }\n\n      .cardhub-settings__option {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: flex-start;\n        padding: 10px 12px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n        cursor: pointer;\n      }\n\n      .cardhub-settings__option.is-active {\n        border-color: rgba(var(--cardhub-accent-rgb), 0.75);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-accent-rgb), 0.4);\n      }\n\n      .cardhub-settings__option.is-disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .cardhub-settings__option input {\n        margin-top: 2px;\n      }\n\n      .cardhub-settings__option-body {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-settings__option-title {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-settings__option-desc {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n      }\n\n      .cardhub-settings__option-warn {\n        font-size: 11px;\n        color: #b94b3b;\n      }\n\n      .cardhub-settings__backup {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-settings__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-settings__spacer {\n        flex: 1;\n      }\n\n      .cardhub-settings__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-settings__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-settings__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-settings__btn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n        box-shadow: none;\n        transform: none;\n      }\n\n      .cardhub-settings__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-settings-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible,\n      .cardhub-settings__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: fixed !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-settings-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n          line-height: 1.2;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr;\n          gap: 10px;\n          align-items: start;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n          min-width: 0;\n          align-content: start;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: wrap;\n          overflow-y: auto;\n          overflow-x: hidden;\n          gap: 6px;\n          padding-bottom: 6px;\n          max-height: calc(\n            (var(--cardhub-tag-row-height, 28px) * var(--cardhub-tag-rows, 2)) +\n              (var(--cardhub-tag-row-gap, 6px) * (var(--cardhub-tag-rows, 2) - 1)) +\n              var(--cardhub-tag-row-padding, 20px)\n          );\n          align-content: flex-start;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-tag-filter::-webkit-scrollbar {\n          width: 4px;\n        }\n\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: var(--cardhub-avatar-size-mobile, 40px);\n          height: var(--cardhub-avatar-size-mobile, 40px);\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__note {\n          font-size: 10px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-edit {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__detail-toggle,\n        .cardhub-manage__toggle,\n        .cardhub-manage__opening-toggle {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__opening-title {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__opening-body {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__pager {\n          gap: 8px;\n        }\n\n        .cardhub-manage__pager-btn {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__pager-status {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-note__input {\n          min-height: 100px;\n          font-size: 12px;\n        }\n\n        .cardhub-edit__input {\n          min-height: 110px;\n          font-size: 12px;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type=\'color\'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-settings__panel {\n          width: min(360px, 92vw);\n          padding: 14px;\n          gap: 12px;\n        }\n\n        .cardhub-settings__label {\n          font-size: 12px;\n        }\n\n        .cardhub-settings__hint {\n          font-size: 11px;\n        }\n\n        .cardhub-settings__option {\n          grid-template-columns: 1fr;\n          gap: 6px;\n        }\n\n        .cardhub-settings__option input {\n          margin: 0;\n        }\n\n        .cardhub-settings__option-title {\n          font-size: 12px;\n        }\n\n        .cardhub-settings__option-desc {\n          font-size: 11px;\n        }\n\n        .cardhub-settings__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-root .cardhub-modal {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: grid !important;\n          place-items: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root .cardhub-modal__panel {\n          position: fixed !important;\n          left: 50vw !important;\n          top: 50vh !important;\n          transform: translate(-50%, -50%) !important;\n          margin: 0 !important;\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n      }\n    ').appendTo('head'),n=$('<div>').attr('script_id',getScriptId()).addClass('cardhub-mount').appendTo('body'),a=(0,G.createApp)(qt);return a.mount(n[0]),(0,G.watch)(()=>Q.open,()=>{},{immediate:!0}),{app:a,mount:n,style:e}}let Zt=null;function Gt(){Zt||(Zt=Xt())}function Qt(){return{open:(e='manual')=>{Gt(),ee(!0,e)},close:()=>{ee(!1)},toggle:(e='manual')=>{Gt(),ee(!Q.open,e)},refresh:async()=>{Gt(),await async function(){ne(!0);try{ae(await t()),te(await J())}finally{ne(!1)}}()},destroy:()=>{Zt&&function(e){e.app.unmount(),e.mount.remove(),e.style.remove()}(Zt),Zt=null}}}function er(){const n=Qt(),a=e(n);n.refresh(),$(window).on('pagehide',()=>{a(),n.destroy()})}$(()=>{errorCatched(er)()});
//# sourceMappingURL=index.js.map