import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';function e(e){const r=[],t=function(e){const r=`cardhub-entry-${getScriptId()}`,t=$(`#${r}`);if(t.length)return t.addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').empty(),null;const o=function(){const e=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const n of e){const e=$(n).first();if(e.length)return e}const n=$('button, .menu_button, .nav_button').filter((_,e)=>{const n=$(e).text(),a=e.getAttribute('title')??e.getAttribute('aria-label')??'';return/角色管理/.test(n)||/角色管理/.test(a)}).first();if(n.length){const e=n.closest('nav, header, section, div');return e.length?e:n.parent()}return null}();if(!o)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const c=a(()=>e.open('role')),i=$('<button>').attr('id',r).attr('type','button').addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),c()});o.append(i);const l=n(i[0],c);return()=>{i.off('click'),i.remove(),l()}}(e);t&&r.push(t);const o=function(e){const r=`cardhub-magic-${getScriptId()}`,t=$('#extensionsMenuButton');if(!t.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const o=()=>{const t=$('#extensionsMenu');if(!t||t.find(`#${r}`).length)return;const o=a(()=>e.open('magic')),c=$('<div>').attr('id',r).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').html('<i class="fa-solid fa-id-badge" aria-hidden="true"></i><span>角色卡管理器</span>').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),o()});t.append(c);const i=n(c[0],o);c.data('cardhub-dispose',i)};t.on('click.cardhub',()=>{setTimeout(o,0)});const c=new MutationObserver(()=>o()),i=window.parent?.document??document;return c.observe(i.body,{childList:!0,subtree:!0}),()=>{c.disconnect(),t.off('click.cardhub'),$(`#${r}`).remove()}}(e);return o&&r.push(o),()=>{r.forEach(e=>e())}}function n(e,n){const a=e=>{e.preventDefault(),e.stopImmediatePropagation(),n()};return e.addEventListener('pointerdown',a,{capture:!0}),e.addEventListener('mousedown',a,{capture:!0}),e.addEventListener('touchstart',a,{capture:!0}),()=>{e.removeEventListener('pointerdown',a,{capture:!0}),e.removeEventListener('mousedown',a,{capture:!0}),e.removeEventListener('touchstart',a,{capture:!0})}}function a(e){let n=0;return()=>{const a=Date.now();a-n<250||(n=a,e())}}async function r(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const n='function'==typeof e?.getContext?e.getContext():null;if('function'==typeof n?.getCharacters)try{await n.getCharacters()}catch(e){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',e)}const a=n?.characters??SillyTavern?.characters??[],r=new Map,o=new Map,c=new Map;return Array.isArray(n?.tags)&&n.tags.forEach(e=>{e?.id&&e?.name&&c.set(e.id,e.name)}),a.map((e,a)=>{const i=e.tags??e.data?.tags??[],l=e.avatar,d=e.name??'未命名角色',s=e.create_date??e.date_added??e?.created??e?.created_at??e?.timestamp??e?.time??e.data?.create_date??e.data?.date_added??e?.data?.created??e?.data?.created_at??e?.data?.timestamp??e?.data?.time??null,u=t(s)??0,b=s??String(a),p=l??`name:${d}::${b}`;let g=p;if(!l){const e=o.get(p)??0;o.set(p,e+1),e&&(g=`${p}::${e}`)}const h=Boolean(n?.tagMap&&Object.prototype.hasOwnProperty.call(n.tagMap,g)),m=(h?n.tagMap[g]??[]:[]).map(e=>c.get(e)).filter(Boolean),f=h?m:i,v=l?`avatar:${l}`:`name:${d}::${b}`,x=r.get(v)??0;r.set(v,x+1);const y=x?`${v}::${x}`:v,w=e?.last_interaction??e?.last_interaction_time??e?.last_interaction_date??e?.last_chat_time??e?.last_chat_date??e?.last_message_time??e?.last_message_date??e?.update_time??e?.last_modified??e?.timestamp??e?.time??e?.data?.last_interaction??e?.data?.last_interaction_time??e?.data?.last_interaction_date??e?.data?.last_chat_time??e?.data?.last_chat_date??e?.data?.last_message_time??e?.data?.last_message_date??e?.data?.update_time??e?.data?.last_modified??e?.data?.timestamp??e?.data?.time??null;return{id:y,name:d,avatar:e.avatar??null,tags:f,tagKey:g,origin:'tavern',createdAt:u,lastChatAt:t(w)??0}})}function t(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function o(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const n=16*Math.random()|0;return('x'===e?n:3&n|8).toString(16)})}const c='cardhub_library';function i(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[c];if(n&&'object'==typeof n){return{entries:Array.isArray(n.entries)?n.entries:[]}}const a=TavernHelper.getVariables({type:'script',script_id:getScriptId()}),r=a?.[c];if(!r||'object'!=typeof r)return{entries:[]};const t=Array.isArray(r.entries)?r.entries:[];return t.length&&l(t),{entries:t}}function l(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({...n,[c]:{entries:e}},{type:'global'})}function d(e){return new Promise((n,a)=>{const r=new FileReader;r.onload=()=>n(String(r.result||'')),r.onerror=()=>a(r.error),r.readAsDataURL(e)})}function s(e){return new Promise((n,a)=>{const r=new FileReader;r.onload=()=>n(String(r.result||'')),r.onerror=()=>a(r.error),r.readAsText(e)})}function u(e){try{return JSON.parse(e)}catch{return null}}function b(e){const n=e.trim();if(!n)return null;const a=u(n);if(a)return a;if(!function(e){return!(e.length<16||e.length%4!=0)&&/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const r=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return r?u(r):null}function p(e){const n=e?.tags??e?.data?.tags;return Array.isArray(n)?n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean):[]}function g(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}function h(e){return(new TextDecoder).decode(e)}function m(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function f(e){const n=e.indexOf(0);if(n<0)return null;const a=h(e.subarray(0,n)).trim(),r=h(e.subarray(n+1)).trim();return a&&r?{key:a,value:r}:null}function v(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=h(e.subarray(0,n)).trim(),r=1===e[n+1];let t=n+2;const o=e.indexOf(0,t);if(o<0)return null;t=o+1;const c=e.indexOf(0,t);if(c<0)return null;if(t=c+1,r)return null;const i=h(e.subarray(t)).trim();return a&&i?{key:a,value:i}:null}function x(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let r=8;for(;r+8<=e.length;){const n=m(e,r),t=h(e.subarray(r+4,r+8)),o=r+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===t){const e=f(i);e&&a.push(e)}else if('iTXt'===t){const e=v(i);e&&a.push(e)}r=c+4}return a}function y(e){const n=g(e);if(!n)return null;const a=x(n),r=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!r.has(e.key.toLowerCase()))continue;const n=b(e.value),a=n?.name??n?.data?.name;if('string'==typeof a&&a.trim())return a.trim()}return null}function w(e){const n=g(e);if(!n)return[];const a=x(n),r=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!r.has(e.key.toLowerCase()))continue;const n=b(e.value);if(n){const e=p(n);if(e.length)return e}}return[]}function k(e){const n=u(e);return n?p(n):[]}function E(e){return e.replace(/\.(png|json)$/i,'')}function C(e){if(null===e||'object'!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return`[${e.map(e=>C(e)).join(',')}]`;return`{${Object.entries(e).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${JSON.stringify(e)}:${C(n)}`).join(',')}}`}function N(e,n){let a=n;if('json'===e){const e=n.trim();try{a=C(JSON.parse(e))}catch{a=e}}return`${e}:${function(e){let n=5381;for(let a=0;a<e.length;a+=1)n=33*n^e.charCodeAt(a);return(n>>>0).toString(16)}(a)}`}function V(){const e=i().entries;let n=!1;const a=Date.now(),r=e.map((r,t)=>{const o={...r,origin:r.origin??'library',tags:Array.isArray(r.tags)?r.tags:[],note:'string'==typeof r.note?r.note:''};if(!o.tagsEdited&&!o.tags.length&&o.raw&&o.rawType){const e='png'===o.rawType?w(o.raw):k(o.raw);e.length&&(o.tags=e,n=!0)}return'number'==typeof o.createdAt?o:(n=!0,{...o,createdAt:a-1e3*(e.length-1-t)})});return n&&l(r),r}async function S(e,n){const a=Array.from(e);if(!a.length)return V();const r=Array.isArray(n)&&n.length?n:V(),t=new Set;r.forEach(e=>{const n=function(e){if(e.fingerprint)return e.fingerprint;if(!e.rawType||!e.raw)return null;const n=N(e.rawType,e.raw);return e.fingerprint=n,n}(e);n&&t.add(n)});const c=[];for(const e of a){const n=E(e.name);if(e.name.toLowerCase().endsWith('.png')){const a=await d(e),r=y(a)??n,i=w(a),l=N('png',a);if(t.has(l))continue;t.add(l),c.push({id:o(),name:r,avatar:a,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'png',raw:a,fingerprint:l,createdAt:Date.now()})}else if(e.name.toLowerCase().endsWith('.json')){const a=await s(e);let r=n;try{const e=JSON.parse(a);r=e.name??e.data?.name??r}catch{}const i=k(a),l=N('json',a);if(t.has(l))continue;t.add(l),c.push({id:o(),name:r,avatar:null,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'json',raw:a,fingerprint:l,createdAt:Date.now()})}}const i=[...r,...c];return l(i),i}function B(e){const n=V().filter(n=>n.id!==e);return l(n),n}const T=Vue,D=(0,T.reactive)({open:!1,loading:!1,search:'',lastOpenSource:'manual',characters:[],library:[]});function A(e,n){D.open=e,n&&(D.lastOpenSource=n)}function M(e){D.loading=e}function L(e){D.characters=e}function j(e){D.library=e.map(e=>({...e,origin:e.origin??'library',tags:Array.isArray(e.tags)?e.tags:[],note:'string'==typeof e.note?e.note:''}))}function F(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}return e??=SillyTavern,'function'!=typeof e?.getContext?null:e.getContext()}function H(e){Array.isArray(e.tags)||(e.tags=[]),e.tagMap||(e.tagMap={})}function I(e){if('library'===e.origin)return e.tags??[];const n=function(e){if(!e)return{hasKey:!1,tags:[]};const n=F();if(!n||!n.tagMap||!Array.isArray(n.tags))return{hasKey:!1,tags:[]};if(!Object.prototype.hasOwnProperty.call(n.tagMap,e))return{hasKey:!1,tags:[]};const a=new Map;return n.tags.forEach(e=>{e?.id&&e?.name&&a.set(e.id,e.name)}),{hasKey:!0,tags:(n.tagMap[e]??[]).map(e=>a.get(e)).filter(Boolean)}}(e.tagKey??e.avatar);return n.hasKey?n.tags:e.tags??[]}function P(e,n){const a=F();if(!a)return n;const r=function(e,n){if(!Array.isArray(e.characters))return null;const a=n.avatar?e.characters.find(e=>e.avatar===n.avatar):null;return a||(e.characters.find(e=>e.name===n.name)??null)}(a,e);if(!r)return n;const t=Array.from(new Set(n.map(e=>e.trim().replace(/\s+/g,' ')).filter(Boolean)));r.tags=t,r.data&&(r.data.tags=t),H(a);const o=t.map(e=>function(e,n){H(e);const a=e.tags.find(e=>e.name===n);if(a)return a;const r={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:n};return e.tags.push({id:r.id,name:r.name}),r}(a,e).id),c=e.tagKey??r.avatar??null;c&&(a.tagMap[c]=o),a.saveSettingsDebounced?.();const i=window.parent?.SillyTavern??SillyTavern;return i?.saveSettingsDebounced?.(),t}const O={class:'cardhub-manage__section'},U={key:0,class:'cardhub-manage__details'},K={class:'cardhub-manage__detail-label'},R={class:'cardhub-manage__detail-content'},Y=['onClick'],W={key:1,class:'cardhub-manage__empty'},q={class:'cardhub-manage__section'},J={class:'cardhub-manage__label'},X={class:'cardhub-manage__content'},Z={key:0,class:'cardhub-manage__opening-meta'},G={class:'cardhub-manage__opening-meta-value'},Q={key:0,class:'cardhub-manage__opening-meta-hint'},ee={key:1,class:'cardhub-manage__empty'},ne={key:2,class:'cardhub-manage__empty'},ae={class:'cardhub-manage__section'},re={class:'cardhub-manage__label'},te={class:'cardhub-manage__jump-row'},oe={key:0,class:'cardhub-manage__chat'},ce=['onClick','onKeydown'],ie={class:'cardhub-manage__chat-main'},le={class:'cardhub-manage__chat-name'},de={key:0,class:'cardhub-manage__chat-label'},se={class:'cardhub-manage__chat-text'},ue={key:1,class:'cardhub-manage__empty'},be={key:2,class:'cardhub-manage__pager'},pe=['disabled'],ge={class:'cardhub-manage__pager-status'},he=['disabled'],me={class:'cardhub-manage__actions'},fe=(0,T.defineComponent)({__name:'ManageContent',props:{manageCard:{},manageDetails:{},manageDetailsHint:{},openingItems:{},openingSummary:{},manageChats:{},pagedChats:{},chatPage:{},chatTotalPages:{},manageChatHint:{},openDetail:{type:Function},openOpeningList:{type:Function},openLatestChat:{type:Function},openNewChat:{type:Function},openChat:{type:Function},prevChatPage:{type:Function},nextChatPage:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function}},setup:e=>(n,a)=>((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,[(0,T.createElementVNode)('div',O,[a[19]||(a[19]=(0,T.createElementVNode)('div',{class:'cardhub-manage__label'},'角色卡预览',-1)),e.manageDetails.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',U,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.manageDetails,n=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:n.label,class:'cardhub-manage__detail'},[(0,T.createElementVNode)('div',K,(0,T.toDisplayString)(n.label),1),(0,T.createElementVNode)('div',R,(0,T.toDisplayString)(n.preview),1),n.hasMore?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-manage__detail-toggle',type:'button',onClick:a=>e.openDetail(n)},' 查看 ',8,Y)):(0,T.createCommentVNode)('v-if',!0)]))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',W,(0,T.toDisplayString)(e.manageDetailsHint),1))]),(0,T.createElementVNode)('div',q,[(0,T.createElementVNode)('div',J,[a[20]||(a[20]=(0,T.createElementVNode)('span',null,'开场白',-1)),e.openingItems.length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-manage__toggle',type:'button',onClick:a[0]||(a[0]=(...n)=>e.openOpeningList&&e.openOpeningList(...n))},' 查看列表（'+(0,T.toDisplayString)(e.openingItems.length)+'） ',1)):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('div',X,[e.openingSummary.hasData?((0,T.openBlock)(),(0,T.createElementBlock)('div',Z,[(0,T.createElementVNode)('span',G,(0,T.toDisplayString)(e.openingSummary.value),1),e.openingSummary.hint?((0,T.openBlock)(),(0,T.createElementBlock)('span',Q,(0,T.toDisplayString)(e.openingSummary.hint),1)):(0,T.createCommentVNode)('v-if',!0)])):(0,T.createCommentVNode)('v-if',!0),e.openingItems.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',ne,'点击“查看列表”浏览开场白')):((0,T.openBlock)(),(0,T.createElementBlock)('div',ee,'暂无开场白'))])]),(0,T.createElementVNode)('div',ae,[(0,T.createElementVNode)('div',re,[a[21]||(a[21]=(0,T.createElementVNode)('span',null,'最近聊天',-1)),(0,T.createElementVNode)('div',te,[(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:a[1]||(a[1]=(...n)=>e.openLatestChat&&e.openLatestChat(...n)),onPointerdown:a[2]||(a[2]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[3]||(a[3]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[4]||(a[4]=(0,T.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32),(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:a[5]||(a[5]=(...n)=>e.openNewChat&&e.openNewChat(...n)),onPointerdown:a[6]||(a[6]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[7]||(a[7]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[8]||(a[8]=(0,T.withModifiers)(()=>{},['stop']))},' 新聊天 ',32)])]),e.pagedChats.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',oe,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.pagedChats,(n,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:a,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:a=>e.openChat(n),onKeydown:(0,T.withKeys)((0,T.withModifiers)(a=>e.openChat(n),['prevent']),['enter'])},[(0,T.createElementVNode)('div',ie,[(0,T.createElementVNode)('div',le,(0,T.toDisplayString)(n.name),1),n.label&&n.label!==n.name?((0,T.openBlock)(),(0,T.createElementBlock)('div',de,(0,T.toDisplayString)(n.label),1)):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('span',se,(0,T.toDisplayString)(n.mes),1)],40,ce))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',ue,(0,T.toDisplayString)(e.manageChatHint),1)),e.chatTotalPages>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',be,[(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage<=1,onClick:a[9]||(a[9]=(...n)=>e.prevChatPage&&e.prevChatPage(...n))},' 上一页 ',8,pe),(0,T.createElementVNode)('span',ge,(0,T.toDisplayString)(e.chatPage)+' / '+(0,T.toDisplayString)(e.chatTotalPages),1),(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage>=e.chatTotalPages,onClick:a[10]||(a[10]=(...n)=>e.nextChatPage&&e.nextChatPage(...n))},' 下一页 ',8,he)])):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('div',me,[(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:a[11]||(a[11]=(0,T.withModifiers)(n=>e.handleCardAction(e.manageCard),['stop'])),onPointerdown:a[12]||(a[12]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[13]||(a[13]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[14]||(a[14]=(0,T.withModifiers)(()=>{},['stop']))},(0,T.toDisplayString)('tavern'===e.manageCard.origin?'导出':'导入'),33),(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:a[15]||(a[15]=(0,T.withModifiers)(n=>e.manageDelete(e.manageCard),['stop'])),onPointerdown:a[16]||(a[16]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[17]||(a[17]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[18]||(a[18]=(0,T.withModifiers)(()=>{},['stop']))},' 删除 ',32)])],64))}),ve={class:'cardhub-manage__top'},xe={class:'cardhub-manage__summary'},_e={class:'cardhub-preview__name'},ye={class:'cardhub-preview__meta'},we={class:'cardhub-preview__tags'},ke={class:'cardhub-manage__overview'},Ee={class:'cardhub-manage__overview-label'},Ce={class:'cardhub-manage__overview-value'},Ne={key:0,class:'cardhub-manage__overview-hint'},Ve={class:'cardhub-manage__media'},Se=['src'],Be=(0,T.defineComponent)({__name:'ManageOverview',props:{manageCard:{},manageAvatarUrl:{},manageOverview:{},displayTags:{type:Function},openNoteDialog:{type:Function},worldbookAvailable:{type:Boolean},openWorldbookList:{type:Function}},setup:e=>(n,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',ve,[(0,T.createElementVNode)('div',xe,[(0,T.createElementVNode)('div',_e,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.manageCard.name),1),(0,T.createElementVNode)('button',{class:'cardhub-note-trigger',type:'button','aria-label':'编辑备注',onClick:a[0]||(a[0]=(...n)=>e.openNoteDialog&&e.openNoteDialog(...n))},[...a[2]||(a[2]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-pen','aria-hidden':'true'},null,-1)])])]),(0,T.createElementVNode)('div',ye,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.manageCard.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.displayTags(e.manageCard).length)+' 标签',1)]),(0,T.createElementVNode)('div',we,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.displayTags(e.manageCard),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-preview__tag'},(0,T.toDisplayString)(e),1))),128))]),(0,T.createElementVNode)('div',ke,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.manageOverview,n=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:n.label,class:'cardhub-manage__overview-card'},[(0,T.createElementVNode)('div',Ee,(0,T.toDisplayString)(n.label),1),(0,T.createElementVNode)('div',Ce,(0,T.toDisplayString)(n.value),1),n.hint?((0,T.openBlock)(),(0,T.createElementBlock)('div',Ne,(0,T.toDisplayString)(n.hint),1)):(0,T.createCommentVNode)('v-if',!0),'世界书'===n.label&&e.worldbookAvailable?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:1,class:'cardhub-manage__overview-action',type:'button',onClick:a[1]||(a[1]=(...n)=>e.openWorldbookList&&e.openWorldbookList(...n))},' 查看 ')):(0,T.createCommentVNode)('v-if',!0)]))),128))])]),(0,T.createElementVNode)('div',Ve,[e.manageAvatarUrl?((0,T.openBlock)(),(0,T.createElementBlock)('img',{key:0,src:e.manageAvatarUrl,alt:''},null,8,Se)):(0,T.createCommentVNode)('v-if',!0)])]))}),ze={class:'cardhub-manage__panel cardhub-modal__panel',role:'dialog','aria-label':'角色管理'},Te={class:'cardhub-note__panel cardhub-modal__panel',role:'dialog','aria-label':'备注'},De={class:'cardhub-openings__panel cardhub-modal__panel',role:'dialog','aria-label':'开场白列表'},Ae={class:'cardhub-openings__meta'},Me={key:0},Le={key:0,class:'cardhub-openings__list'},$e=['onClick'],je={class:'cardhub-openings__item-title'},Fe={class:'cardhub-openings__item-preview'},He={key:1,class:'cardhub-manage__empty'},Ie={key:2,class:'cardhub-manage__pager'},Pe=['disabled'],Oe={class:'cardhub-manage__pager-status'},Ue=['disabled'],Ke={class:'cardhub-worldbook__panel cardhub-modal__panel',role:'dialog','aria-label':'世界书'},Re={class:'cardhub-worldbook__header'},Ye={class:'cardhub-worldbook__title'},We={class:'cardhub-worldbook__meta'},qe={key:0},Je={key:0,class:'cardhub-manage__empty'},Xe={key:1,class:'cardhub-manage__empty'},Ze={key:2,class:'cardhub-worldbook__list'},Ge=['onClick'],Qe={class:'cardhub-worldbook__item-title'},en={key:0,class:'cardhub-worldbook__item-disabled'},nn={class:'cardhub-worldbook__item-preview'},an={key:3,class:'cardhub-manage__empty'},rn={key:4,class:'cardhub-manage__pager'},tn=['disabled'],on={class:'cardhub-manage__pager-status'},cn=['disabled'],ln=['aria-label'],dn={class:'cardhub-manage-viewer__header'},sn={class:'cardhub-manage-viewer__title'},un=['innerHTML'],bn=(0,T.defineComponent)({__name:'ManageModal',props:{card:{},displayTags:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function},closeManage:{type:Function},closeRoot:{type:Function},applyNoteUpdate:{type:Function},parseLibraryCardData:{type:Function},updateLastChatCacheForCard:{type:Function}},setup(e){const n=e,a=(0,T.computed)(()=>n.card),r=(0,T.ref)([]),t=(0,T.ref)([]),o=(0,T.ref)(null),c=(0,T.ref)(null),i=(0,T.ref)([]),l=(0,T.ref)(null),d=(0,T.computed)(()=>a.value?function(e,n=!1){const a=e.avatar;if(!a)return null;if(/^(data:|https?:|\/)/.test(a))return a;if(n&&'tavern'===e.origin)return TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`;return`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`}(a.value,!0):null),s=(0,T.computed)(()=>!a.value||p.value.length?'':'library'===a.value.origin?'未导入卡片暂无可预览内容，可先导入后查看详情。':'暂无角色卡详情。'),u=(0,T.computed)(()=>'library'===a.value?.origin?'未导入卡片暂无聊天记录。':'暂无聊天记录。'),b=(0,T.computed)(()=>{const e=[],n=o.value,a=n?.worldBookName?.trim()||'',r=n?.worldBookCount;let t='未绑定',c='';(a||'number'==typeof r)&&(t=a||'角色世界书',c='number'==typeof r?`${r} 条`:''),e.push({label:'世界书',value:t,hint:c});const i=l.value;let d='暂无聊天',s='';return i&&i.total>0&&(d=`${i.total} 个聊天`,i.latest&&(s=`最近：${i.latest}`)),e.push({label:'聊天概况',value:d,hint:s}),e}),p=(0,T.computed)(()=>{const e=[],n=o.value,r=(n,a,r=240)=>{const t=Ve(a,3,r);t&&e.push({label:n,preview:t,full:a.trim(),hasMore:t!==a.trim()})};return'library'===a.value?.origin&&a.value.importFileName&&r('导入文件名',a.value.importFileName,120),a.value?.note?.trim()&&r('备注',a.value.note.trim(),200),n&&(r('角色描述',n.description??''),r('性格',n.personality??''),r('场景',n.scenario??''),r('创作者备注',n.creatorNotes??''),r('系统提示',n.systemPrompt??'',200),r('历史指令',n.postHistory??'',200),r('作者',n.creator??'',80)),e}),g=(0,T.computed)(()=>r.value.map((e,n)=>({id:n,preview:Se(e,2).join('\n'),html:bn(e)}))),h=(0,T.computed)(()=>{const e=c.value,n=e?.total??g.value.length,a=e?.alternate??0;return n?{value:`共 ${n} 条`,hint:a>0?`替代 ${a} 条`:'无替代',hasData:!0}:{value:'暂无开场白',hint:'',hasData:!1}}),m=(0,T.computed)(()=>o.value?.worldBookName?.trim()||''),f=(0,T.computed)(()=>Boolean(m.value||t.value.length)),v=(0,T.ref)([]),x=(0,T.ref)(''),y=(0,T.ref)(!1),w=(0,T.ref)(''),k=(0,T.ref)(!1),E=(0,T.ref)(1),C=(0,T.computed)(()=>v.value.map((e,n)=>({uid:e.uid??n,name:e.name||`条目 ${n+1}`,enabled:!1!==e.enabled,preview:Ve(String(e.content??''),2,200)||'（无内容）',content:String(e.content??'')}))),N=(0,T.computed)(()=>Math.max(1,Math.ceil(C.value.length/10))),V=(0,T.computed)(()=>{const e=10*(E.value-1);return C.value.slice(e,e+10)}),S=(0,T.computed)(()=>f.value?y.value?'正在读取条目':`共 ${C.value.length} 条`:'未绑定世界书'),B=(0,T.computed)(()=>C.value.length?m.value:''),D=(0,T.ref)(1),A=(0,T.computed)(()=>Math.max(1,Math.ceil(i.value.length/6))),M=(0,T.computed)(()=>{const e=6*(D.value-1);return i.value.slice(e,e+6)}),L=(0,T.ref)(1),j=(0,T.computed)(()=>Math.max(1,Math.ceil(g.value.length/10))),F=(0,T.computed)(()=>{const e=10*(L.value-1);return g.value.slice(e,e+10)}),H=(0,T.ref)(!1),I=(0,T.ref)(''),P=(0,T.ref)(!1),O=(0,T.ref)(!1),U=(0,T.ref)(''),K=(0,T.ref)('');let R=0;function Y(){D.value>1&&(D.value-=1)}function W(){D.value<A.value&&(D.value+=1)}async function q(){const e=m.value;if(e||t.value.length){if(k.value=!0,w.value='',E.value=1,t.value.length)return v.value=t.value,void(x.value=e||'embedded');if(x.value!==e||!v.value.length)if('function'==typeof getWorldbook){y.value=!0;try{const n=await getWorldbook(e);v.value=Array.isArray(n)?n:[],x.value=e}catch(e){w.value='读取世界书失败',v.value=[],console.warn('[CardHub] 读取世界书失败',e)}finally{y.value=!1}}else w.value='世界书接口不可用'}}function J(){k.value=!1}function X(){E.value>1&&(E.value-=1)}function Z(){E.value<N.value&&(E.value+=1)}function G(){g.value.length&&(L.value=1,P.value=!0)}function Q(){P.value=!1}function ee(){L.value>1&&(L.value-=1)}function ne(){L.value<j.value&&(L.value+=1)}function ae(){a.value&&(I.value=a.value.note??'',H.value=!0)}function re(){H.value=!1}function te(){a.value&&(n.applyNoteUpdate(a.value,I.value),H.value=!1)}function oe(e){U.value=e.label,K.value=gn(e.full||e.preview),O.value=!0}function ce(){O.value=!1}async function ie(e){if('tavern'!==e.origin){const a=n.parseLibraryCardData(e);return{openings:ke(a),profile:xe(a),openingSummary:we(a),worldbookEntries:_e(a)}}const a=await async function(e){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const a='function'==typeof n?.getContext?n.getContext():null;if(a?.getCharacters)try{await a.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色卡列表失败',e)}const r=a?.characters??n?.characters??[];if(!r.length)return null;const t=e.avatar?r.findIndex(n=>n.avatar===e.avatar||n.name===e.avatar):-1,o=r.findIndex(n=>n.name===e.name),c=t>=0?t:o;if(c<0)return null;if(a?.unshallowCharacter)try{await a.unshallowCharacter(c)}catch(e){console.warn('[CardHub] 读取角色卡详情失败',e)}const i=(a?.characters??r)[c]??null;if(i?.first_mes||i?.data?.first_mes)return i;if(a?.getCharacterCardFields)try{const e=await a.getCharacterCardFields({chid:c});if(e?.first_mes||e?.data?.first_mes)return e}catch(e){console.warn('[CardHub] 读取角色卡字段失败',e)}const l=TavernHelper.getCharData(e.avatar??e.name,!0);return l??i}(e),r=a??TavernHelper.RawCharacter?.find({name:e.avatar??e.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:e.name,allowAvatar:!0}),t=a??r;let o=ke(t);!o.length&&r&&r!==t&&(o=ke(r));const c=we(t??r);return{openings:o,profile:xe(t??r),openingSummary:c,worldbookEntries:_e(t??r)}}async function le(e){if('tavern'!==e.origin)return{list:[],summary:null};const a=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0);if(!Array.isArray(a)||!a.length)return{list:[],summary:{total:0,latest:''}};const r=function(e){return[...e].sort((e,n)=>(xn(n)??0)-(xn(e)??0))}(a),t=xn(r[0])??0;n.updateLastChatCacheForCard(e,t);const o=r.map(e=>({name:Ee(e),label:Ce(e),file:String(e?.file_name??e?.file_id??''),mes:Ne(String(e?.mes??'')).slice(0,120)})),c=vn(r[0]);return{list:o,summary:{total:a.length,latest:c}}}async function de(){i.value.length?await ue(i.value[0]):toastr.warning('暂无聊天记录')}async function se(){if(await be({ensureSelected:!0}))try{await triggerSlash('/newchat'),n.closeManage(),n.closeRoot()}catch(e){console.warn('[CardHub] 新聊天失败',e),toastr.error('无法创建新聊天')}}async function ue(e){const a=e.file;if(!a)return void toastr.warning('未找到聊天文件');const r=await be({ensureSelected:!0});if(!r)return;const{ctx:t,st:o}=r,c=ge(a),i=(t&&'function'==typeof t.openCharacterChat?t.openCharacterChat:null)??(o&&'function'==typeof o.openCharacterChat?o.openCharacterChat:null);if(!i)return void toastr.error('无法打开聊天：缺少接口');try{Promise.resolve(i(c)).catch(e=>{console.warn('[CardHub] 打开聊天失败',e)})}catch(e){console.warn('[CardHub] 打开聊天失败',e)}const l=await async function(e,n,a,r){const t=ge(e),o=Date.now();for(;Date.now()-o<r;){if((n?.chatId??a?.chatId)===t)return!0;await he(200)}return!1}(c,t,o,6e3);if(l)return n.closeManage(),void n.closeRoot();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}async function be(e={}){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const r='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof r?.getCharacters)try{await r.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色列表失败',e)}const t=r?.characters??n?.characters??[],o=a.value&&Array.isArray(t)?function(e,n){const a=me(n.name),r=n.avatar?ve(n.avatar):'',t=r?e.findIndex(e=>ve(String(e.avatar??''))===r):-1;if(t>=0)return t;const o=e.findIndex(e=>me(String(e.name??''))===a);if(o>=0)return o;return e.findIndex(e=>me(String(e?.data?.name??''))===a)}(t,a.value):-1;if(o<0)return toastr.warning('未找到角色索引，请先手动切到该角色后再试'),null;const c=(r&&'function'==typeof r.selectCharacterById?r.selectCharacterById:null)??(n&&'function'==typeof n.selectCharacterById?n.selectCharacterById:null);if(!c)return toastr.warning('无法切换角色，请先手动切到该角色后再试'),null;try{await c(o,{switchMenu:!1})}catch(e){console.warn('[CardHub] 切换角色失败',e)}const i=await async function(e,n,a,r){const t=String(e),o=Date.now();for(;Date.now()-o<r;){if(pe(n,a)===t)return!0;await he(80)}return!1}(o,r,n,3e3);return e.ensureSelected&&!i?(toastr.warning('角色切换未完成，请稍后再试'),null):{ctx:r,st:n,idx:o}}function pe(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}function ge(e){return e.endsWith('.jsonl')?e:`${e}.jsonl`}function he(e){return new Promise(n=>setTimeout(n,e))}function me(e){return e.trim().toLocaleLowerCase()}function ve(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}return n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n),n.trim().toLowerCase()}function xe(e){if(!e)return null;const n={description:ye(e?.description,e?.data?.description),personality:ye(e?.personality,e?.data?.personality),scenario:ye(e?.scenario,e?.data?.scenario),creatorNotes:ye(e?.creatorcomment,e?.data?.creatorcomment,e?.creator_notes,e?.data?.creator_notes),systemPrompt:ye(e?.system_prompt,e?.data?.system_prompt),postHistory:ye(e?.post_history_instructions,e?.data?.post_history_instructions),creator:ye(e?.creator,e?.data?.creator)},a=e?.character_book??e?.data?.character_book;a&&(n.worldBookName=ye(a?.name),n.worldBookCount=Array.isArray(a?.entries)?a.entries.length:void 0);return Boolean(n.description)||Boolean(n.personality)||Boolean(n.scenario)||Boolean(n.creatorNotes)||Boolean(n.systemPrompt)||Boolean(n.postHistory)||Boolean(n.creator)||Boolean(n.worldBookName)||'number'==typeof n.worldBookCount?n:null}function _e(e){const n=e?.character_book??e?.data?.character_book;return n&&Array.isArray(n?.entries)?n.entries:[]}function ye(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function we(e){if(!e)return null;const n='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes,a='string'==typeof n&&n.trim()?1:0,r=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;let t=0;return Array.isArray(r)?t=r.filter(e=>'string'==typeof e&&e.trim()).length:'string'==typeof r&&r.trim()&&(t=1),{total:a+t,alternate:t}}function ke(e){if(!e)return[];const n=[],a='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes;'string'==typeof a&&a.trim()&&n.push(a.trim());const r=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;return Array.isArray(r)?r.forEach(e=>{'string'==typeof e&&e.trim()&&n.push(e.trim())}):'string'==typeof r&&r.trim()&&n.push(r.trim()),n}function Ee(e){return vn(e)||'聊天记录'}function Ce(e){const n=ye(e?.file_name,e?.file_id);return n?n.replace(/\.jsonl$/i,''):''}function Ne(e){return e.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}function Ve(e,n,a){const r=e.replace(/\r/g,'').trim();if(!r)return'';const t=mn(r),o=t.length?t:fn(Ne(r),60);let c=o.slice(0,n).join('\n').trim();if(!c)return'';const i=c.length>a;i&&(c=c.slice(0,a).trim());return(i||o.length>n||r.length>c.length)&&!c.endsWith('…')&&(c=`${c}…`),c}function Se(e,n){const a=e.replace(/\r/g,'').trim();if(!a)return[];const r=mn(a);if(r.length>=n)return r.slice(0,n);const t=Ne(a);if(!t)return r.slice(0,n);const o=fn(t,60);if(!r.length)return o.slice(0,n);const c=[...r];for(const e of o){if(c.length>=n)break;c[0]!==e&&c.push(e)}return c.slice(0,n)}function bn(e){const n=hn(e).trim();return n?/<\/?[a-z][\s\S]*>/i.test(n)?n:pn(n).replace(/\n/g,'<br>'):''}function pn(e){return e.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}function gn(e){const n=hn(e).trim();return n?pn(n).replace(/\n/g,'<br>'):''}function hn(e){return e.replace(/^\s*```[a-zA-Z0-9_-]*\s*$/gm,'').replace(/^\s*```\s*$/gm,'')}function mn(e){const n=e.split('\n').map(e=>e.trim()).filter(e=>e.length>0),a=[];for(const e of n)e.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(e)||a.push(e);return a}function fn(e,n){const a=[];for(let r=0;r<e.length;r+=n){const t=e.slice(r,r+n).trim();t&&a.push(t)}return a}function vn(e){return ye(e?.chat_name,e?.chat_title,e?.name,e?.file_name,e?.file_id)}function xn(e){return function(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}(e?.last_message_time??e?.last_message_date??e?.last_message_timestamp??e?.last_chat_time??e?.last_chat_date??e?.last_interaction??e?.update_time??e?.timestamp??e?.time??null)??function(e){const n=e.replace(/\.jsonl$/i,'').trim(),a=/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/,r=n.match(a);if(!r)return null;const t=Number(r[1]),o=Number(r[2]),c=Number(r[3]),i=r[4]?Number(r[4]):0,l=r[5]?Number(r[5]):0,d=r[6]?Number(r[6]):0;if(!t||!o||!c)return null;const s=new Date(t,o-1,c,i,l,d).getTime();return Number.isNaN(s)?null:s}(String(e?.file_name??e?.file_id??''))}return(0,T.watch)(a,e=>{if(!e)return r.value=[],t.value=[],o.value=null,c.value=null,i.value=[],l.value=null,D.value=1,L.value=1,H.value=!1,I.value='',P.value=!1,k.value=!1,v.value=[],x.value='',y.value=!1,w.value='',E.value=1,O.value=!1,U.value='',void(K.value='');!async function(e){const n=++R;r.value=[],t.value=[],i.value=[],o.value=null,c.value=null,l.value=null,D.value=1,L.value=1,P.value=!1,k.value=!1,v.value=[],x.value='',y.value=!1,w.value='',E.value=1;const[d,s]=await Promise.allSettled([ie(e),le(e)]);if(n!==R||a.value?.id!==e.id)return;const u='fulfilled'===d.status?d.value:{openings:[],profile:null,openingSummary:null,worldbookEntries:[]};r.value=u.openings,o.value=u.profile,c.value=u.openingSummary,t.value=u.worldbookEntries;const b='fulfilled'===s.status?s.value:{list:[],summary:null};i.value=b.list,l.value=b.summary}(e)},{immediate:!0}),(n,r)=>((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,[a.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:0,class:'cardhub-manage cardhub-modal',onClick:r[1]||(r[1]=(0,T.withModifiers)((...n)=>e.closeManage&&e.closeManage(...n),['self']))},[(0,T.createElementVNode)('div',ze,[(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:r[0]||(r[0]=(...n)=>e.closeManage&&e.closeManage(...n))},'×'),(0,T.createVNode)(Be,{'manage-card':a.value,'manage-avatar-url':d.value,'manage-overview':b.value,'display-tags':e.displayTags,'open-note-dialog':ae,'worldbook-available':f.value,'open-worldbook-list':q},null,8,['manage-card','manage-avatar-url','manage-overview','display-tags','worldbook-available']),(0,T.createVNode)(fe,{'manage-card':a.value,'manage-details':p.value,'manage-details-hint':s.value,'opening-items':g.value,'opening-summary':h.value,'manage-chats':i.value,'paged-chats':M.value,'chat-page':D.value,'chat-total-pages':A.value,'manage-chat-hint':u.value,'open-detail':oe,'open-opening-list':G,'open-latest-chat':de,'open-new-chat':se,'open-chat':ue,'prev-chat-page':Y,'next-chat-page':W,'handle-card-action':e.handleCardAction,'manage-delete':e.manageDelete},null,8,['manage-card','manage-details','manage-details-hint','opening-items','opening-summary','manage-chats','paged-chats','chat-page','chat-total-pages','manage-chat-hint','handle-card-action','manage-delete'])])])):(0,T.createCommentVNode)('v-if',!0),H.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-note cardhub-modal',onClick:(0,T.withModifiers)(re,['self'])},[(0,T.createElementVNode)('div',Te,[(0,T.createElementVNode)('div',{class:'cardhub-note__header'},[r[3]||(r[3]=(0,T.createElementVNode)('div',{class:'cardhub-note__title'},'备注',-1)),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:re},'×')]),(0,T.withDirectives)((0,T.createElementVNode)('textarea',{'onUpdate:modelValue':r[2]||(r[2]=e=>I.value=e),class:'cardhub-note__input',placeholder:'填写备注内容'},null,512),[[T.vModelText,I.value]]),(0,T.createElementVNode)('div',{class:'cardhub-note__actions'},[(0,T.createElementVNode)('button',{class:'cardhub-note__btn is-secondary',type:'button',onClick:re},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-note__btn is-primary',type:'button',onClick:te},'保存')])])])):(0,T.createCommentVNode)('v-if',!0),P.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:2,class:'cardhub-openings cardhub-modal',onClick:(0,T.withModifiers)(Q,['self'])},[(0,T.createElementVNode)('div',De,[(0,T.createElementVNode)('div',{class:'cardhub-openings__header'},[r[4]||(r[4]=(0,T.createElementVNode)('div',{class:'cardhub-openings__title'},'开场白列表',-1)),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Q},'×')]),(0,T.createElementVNode)('div',Ae,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(h.value.value),1),h.value.hint?((0,T.openBlock)(),(0,T.createElementBlock)('span',Me,(0,T.toDisplayString)(h.value.hint),1)):(0,T.createCommentVNode)('v-if',!0)]),F.value.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Le,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(F.value,e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e.id,class:'cardhub-openings__item',type:'button',onClick:n=>function(e){P.value=!1,U.value=`开场白 ${e.id+1}`,K.value=e.html||gn(e.preview),O.value=!0}(e)},[(0,T.createElementVNode)('div',je,'开场白 '+(0,T.toDisplayString)(e.id+1),1),(0,T.createElementVNode)('div',Fe,(0,T.toDisplayString)(e.preview),1)],8,$e))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',He,'暂无开场白')),j.value>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',Ie,[(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:L.value<=1,onClick:ee},' 上一页 ',8,Pe),(0,T.createElementVNode)('span',Oe,(0,T.toDisplayString)(L.value)+' / '+(0,T.toDisplayString)(j.value),1),(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:L.value>=j.value,onClick:ne},' 下一页 ',8,Ue)])):(0,T.createCommentVNode)('v-if',!0)])])):(0,T.createCommentVNode)('v-if',!0),k.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:3,class:'cardhub-worldbook cardhub-modal',onClick:(0,T.withModifiers)(J,['self'])},[(0,T.createElementVNode)('div',Ke,[(0,T.createElementVNode)('div',Re,[(0,T.createElementVNode)('div',Ye,(0,T.toDisplayString)(m.value||'世界书'),1),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:J},'×')]),(0,T.createElementVNode)('div',We,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(S.value),1),B.value?((0,T.openBlock)(),(0,T.createElementBlock)('span',qe,(0,T.toDisplayString)(B.value),1)):(0,T.createCommentVNode)('v-if',!0)]),y.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',Je,'加载中...')):w.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',Xe,(0,T.toDisplayString)(w.value),1)):V.value.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Ze,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(V.value,e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e.uid,class:'cardhub-worldbook__item',type:'button',onClick:n=>function(e){k.value=!1,U.value=e.name||'世界书条目',K.value=gn(e.content),O.value=!0}(e)},[(0,T.createElementVNode)('div',Qe,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.name),1),e.enabled?(0,T.createCommentVNode)('v-if',!0):((0,T.openBlock)(),(0,T.createElementBlock)('span',en,'已禁用'))]),(0,T.createElementVNode)('div',nn,(0,T.toDisplayString)(e.preview),1)],8,Ge))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',an,'暂无条目')),N.value>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',rn,[(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:E.value<=1,onClick:X},' 上一页 ',8,tn),(0,T.createElementVNode)('span',on,(0,T.toDisplayString)(E.value)+' / '+(0,T.toDisplayString)(N.value),1),(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:E.value>=N.value,onClick:Z},' 下一页 ',8,cn)])):(0,T.createCommentVNode)('v-if',!0)])])):(0,T.createCommentVNode)('v-if',!0),O.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:4,class:'cardhub-manage-viewer cardhub-modal',onClick:(0,T.withModifiers)(ce,['self'])},[(0,T.createElementVNode)('div',{class:'cardhub-manage-viewer__panel cardhub-modal__panel',role:'dialog','aria-label':U.value},[(0,T.createElementVNode)('div',dn,[(0,T.createElementVNode)('div',sn,(0,T.toDisplayString)(U.value),1),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:ce},'×')]),(0,T.createElementVNode)('div',{class:'cardhub-manage-viewer__content',innerHTML:K.value},null,8,un)],8,ln)])):(0,T.createCommentVNode)('v-if',!0)],64))}});function pn(e){const n=(0,T.ref)(!1),a=(0,T.ref)('filter'),r=(0,T.ref)([]),t=(0,T.ref)(''),o=(0,T.ref)(''),c=(0,T.ref)([]),i=(0,T.computed)(()=>e.filteredCharacters.value),l=(0,T.computed)(()=>{const n=t.value.trim().toLowerCase();return n?i.value.filter(a=>{if(a.name.toLowerCase().includes(n))return!0;return e.displayTags(a).some(e=>e.toLowerCase().includes(n))}):i.value}),d=(0,T.computed)(()=>new Set(r.value)),s=(0,T.computed)(()=>e.allTags.value);return{tagManagerOpen:n,tagManagerTab:a,openTagManager:function(e='filter'){if('batch'===e){if(!l.value.length)return void toastr.warning('当前没有可操作的角色卡');o.value='',t.value='',c.value=[],r.value=l.value.map(e=>e.id)}a.value=e,n.value=!0},closeTagManager:function(){n.value=!1},batchTagSelectedIds:r,batchTagSearch:t,batchTagInput:o,batchTagSelectedTags:c,batchTagSelectedSet:d,batchTagVisibleCandidates:l,batchTagSuggestions:s,toggleBatchTagSelection:function(e){d.value.has(e)?r.value=r.value.filter(n=>n!==e):r.value=[...r.value,e]},selectAllBatchTags:function(){r.value=l.value.map(e=>e.id)},clearBatchTagSelection:function(){r.value=[]},toggleBatchTagSuggestion:function(e){c.value.includes(e)?c.value=c.value.filter(n=>n!==e):c.value=[...c.value,e]},applyBatchTags:async function(n){if(!r.value.length)return void toastr.warning('请先选择要操作的角色卡');const a=function(e,n){const a=e.split(/[,，\n;；、]/).map(e=>e.trim()).filter(Boolean);return Array.from(new Set([...a,...n]))}(o.value,c.value);if(!a.length)return void toastr.warning('请输入要操作的标签');const t='add'===n?'添加':'移除',i=`将${t}标签：${a.join('、')}\n应用到 ${r.value.length} 张角色卡，是否继续？`;if('confirm'!==await e.openConfirm({title:`批量${t}标签`,message:i,confirmLabel:`继续${t}`,cancelLabel:'取消'}))return;const l=function(n){const a=new Map(e.allCards.value.map(e=>[e.id,e]));return n.map(e=>a.get(e)).filter(Boolean)}(r.value);let d=0;l.forEach(r=>{const t=e.displayTags(r),o=new Set(t);'add'===n?a.forEach(e=>o.add(e)):a.forEach(e=>o.delete(e));const c=Array.from(o);(function(e,n){if(e.length!==n.length)return!1;const a=new Set(e);return n.every(e=>a.has(e))})(t,c)||(e.applyTagUpdate(r,c),d+=1)}),toastr.success(`已处理 ${d} 张角色卡`)}}}function gn(e){const n=(0,T.ref)(null),a=(0,T.ref)(!1),r=(0,T.ref)([]),t=(0,T.ref)(''),o=(0,T.ref)('all'),c=(0,T.ref)([]),i=(0,T.computed)(()=>[...e.allCards.value]),l=(0,T.computed)(()=>{const e=new Set;return i.value.forEach(n=>{(n.tags??[]).forEach(n=>e.add(n))}),c.value.forEach(n=>e.add(n)),Array.from(e).sort((e,n)=>e.localeCompare(n,'zh-CN'))}),d=(0,T.computed)(()=>{let e=i.value;'imported'===o.value?e=e.filter(e=>'tavern'===e.origin):'unimported'===o.value&&(e=e.filter(e=>'library'===e.origin)),c.value.length&&(e=e.filter(e=>c.value.some(n=>(e.tags??[]).includes(n))));const n=t.value.trim().toLowerCase();return n?e.filter(e=>{if(e.name.toLowerCase().includes(n))return!0;return(e.tags??[]).some(e=>e.toLowerCase().includes(n))}):e}),s=(0,T.computed)(()=>new Set(r.value)),u=(0,T.computed)(()=>i.value.filter(e=>s.value.has(e.id)));function b(){a.value=!0,r.value=d.value.map(e=>e.id)}async function p(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const a=function(n){const a=e.normalizeNameKey(n);return a?e.getCharacters().find(n=>e.normalizeNameKey(n.name)===a)??null:null}(n.name);if(a)return void toastr.warning(`已存在同名角色「${a.name}」，已跳过导入`);const r=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};delete r['Content-Type'];const t=await e.fetchCharacterSummaries(),o=new Set(t.map(n=>e.normalizeAvatarKey(n.avatar??'')).filter(Boolean));if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);await TavernHelper.importRawCharacter(n.name,a)}else{const e=new File([n.raw],`${n.name}.json`,{type:'application/json'}),a=new FormData;a.append('avatar',e),a.append('file_type','json'),a.append('preserved_name',e.name),await fetch('/api/characters/import',{method:'POST',headers:r,body:a,cache:'no-cache'})}const c=await e.fetchCharacterSummaries(),i=new Set([n.name]);if('json'===n.rawType)try{const e=JSON.parse(n.raw);e?.name&&i.add(e.name),e?.data?.name&&i.add(e.data.name)}catch{}const l=c.find(n=>{const a=e.normalizeAvatarKey(n.avatar??'');return a&&!o.has(a)}),d=c.find(n=>Array.from(i).some(a=>e.normalizeNameKey(n.name)===e.normalizeNameKey(a))),s=l??d??null;if(s){e.setLibrary(e.removeFromLibrary(n.id));const a=n.tags?.length?n.tags:e.extractCardTagsFromData(e.parseLibraryCardData(n));if(a.length){const n=e.updateCharacterTags(s,a);s.tags=n}toastr.success(`已导入 ${n.name}`)}else toastr.warning(`导入完成但未在角色列表中找到「${n.name}」，已保留未导入记录`);e.setCharacters(c)}async function g(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);return void e.downloadBlob(a,`${n.name}.png`)}const a=new Blob([n.raw],{type:'application/json'});e.downloadBlob(a,`${n.name}.json`)}async function h(n){if('library'===n.origin)return void await g(n);if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const r=await fetch(a,{cache:'no-cache'}),t=await r.blob();e.downloadBlob(t,`${n.name}.png`)}function m(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}async function f(n,a){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let r;try{r=window.parent?.SillyTavern}catch{r=void 0}r??=SillyTavern;const t='function'==typeof r?.getContext?r.getContext():null,o=t?.characters??r?.characters??[],c=function(n,a){const r=e.normalizeNameKey(a.name),t=a.avatar?e.normalizeAvatarKey(a.avatar):'',o=t?n.findIndex(n=>e.normalizeAvatarKey(String(n.avatar??''))===t):-1;if(o>=0)return o;const c=n.findIndex(n=>e.normalizeNameKey(String(n.name??''))===r);return c>=0?c:n.findIndex(n=>e.normalizeNameKey(String(n?.data?.name??''))===r)}(o,n),i=m(t,r);if(c>=0&&i&&String(c)===String(i))if(o.length>1){const n=0===c?1:0,a=(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null)??(r&&'function'==typeof r.selectCharacterById?r.selectCharacterById:null);if(a)try{await a(n,{switchMenu:!1}),await async function(n,a,r,t){const o=String(n),c=Date.now();for(;Date.now()-c<t;){if(m(a,r)===o)return!0;await e.sleep(80)}return!1}(n,t,r,3e3)}catch(e){console.warn('[CardHub] 删除前切换角色失败',e)}}else toastr.warning('当前角色为唯一角色，删除后酒馆可能需要刷新');const l=t?.getRequestHeaders?t.getRequestHeaders():r?.getRequestHeaders?.();if(!l||!Object.keys(l).length)return toastr.error('删除失败：无法获取请求头'),!1;const d={avatar_url:n.avatar,delete_chats:a},s=await fetch('/api/characters/delete',{method:'POST',headers:{...l,'Content-Type':'application/json'},body:JSON.stringify(d),cache:'no-cache'});if(s.ok){try{await triggerSlash('/closechat')}catch(e){console.warn('[CardHub] 关闭聊天失败',e)}return!0}const u=await s.text();return toastr.error(`删除失败：${s.status} ${u||s.statusText}`),!1}return{importInput:n,exportDialogOpen:a,exportSearch:t,exportStatusFilter:o,exportTagFilters:c,exportAllTags:l,exportVisibleCandidates:d,exportSelectedItems:u,exportSelectedIds:r,openExportDialog:b,exportSelected:async function(){b()},confirmExportSelected:async function(){const n=u.value;if(!n.length)return void toastr.warning('请选择要导出的角色卡');const r=e.selectedTags.value.length?e.selectedTags.value.join('、'):'无',t='all'===e.statusFilter.value?'全部':'imported'===e.statusFilter.value?'已导入':'未导入',o=e.stateSearch.value.trim()||'无',c=`将导出 ${n.length} 张角色卡。\n筛选状态：${t}\n筛选标签：${r}\n搜索关键字：${o}\n是否继续？`;if('confirm'===await e.openConfirm({title:'批量导出',message:c,confirmLabel:'继续导出',cancelLabel:'取消'})){a.value=!1;for(const a of n)await h(a),await e.sleep(120);toastr.success(`批量导出完成，共 ${n.length} 张`)}},isExportSelected:function(e){return s.value.has(e)},toggleExportSelection:function(e){s.value.has(e)?r.value=r.value.filter(n=>n!==e):r.value=[...r.value,e]},selectAllExport:function(){r.value=d.value.map(e=>e.id)},clearExportSelection:function(){r.value=[]},triggerImport:function(){n.value?.click()},handleImportFiles:async function(n){const a=n.target,r=a?.files;if(!r||!r.length)return;const t=await e.addToLibrary(r,e.getLibrary());e.setLibrary(t),a.value=''},handleCardAction:async function(e){'library'===e.origin?await p(e):h(e)},importLibraryCard:p,exportCard:h,exportLibraryCard:g,manageDelete:async function(n){if('library'===n.origin){if('confirm'!==await e.openConfirm({title:'删除角色',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'删除',cancelLabel:'取消'}))return;return e.setLibrary(e.removeFromLibrary(n.id)),void e.closeManage()}if('confirm'!==await e.openConfirm({title:'删除角色',message:`确定要删除「${n.name}」吗？`,confirmLabel:'继续',cancelLabel:'取消'}))return;const a=await e.openConfirm({title:'删除方式',message:`删除「${n.name}」：\n- 移到私有库：可在私有库中找回\n- 永久删除：不可恢复`,confirmLabel:'移到私有库',altLabel:'永久删除',cancelLabel:'取消'});if('cancel'===a)return;if('confirm'===a){await async function(n){if(!n.avatar)return;const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const r=await fetch(a,{cache:'no-cache'}),t=await r.blob(),o=await e.addToLibrary([new File([t],`${n.name}.png`,{type:'image/png'})]);e.setLibrary(o)}(n);if(!await f(n,!1))return;e.closeManage();const a=await e.fetchCharacterSummaries();return void e.setCharacters(a)}if('confirm'!==await e.openConfirm({title:'永久删除',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'永久删除',cancelLabel:'取消'}))return;if(!await f(n,!0))return;e.closeManage();const r=await e.fetchCharacterSummaries();e.setCharacters(r)}}}const hn={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},mn={class:'cardhub-toolbar'},fn={class:'cardhub-body'},vn={class:'cardhub-sidebar'},xn={class:'cardhub-filter-row'},_n={class:'cardhub-filter-block'},yn={class:'cardhub-chip-row'},wn={class:'cardhub-filter-block'},kn={class:'cardhub-chip-row'},En={class:'cardhub-tag-filter'},Cn=['onClick'],Nn={class:'cardhub-content'},Vn={key:0,class:'cardhub-loading'},Sn={key:1,class:'cardhub-empty'},Bn={key:2,class:'cardhub-grid-wrap'},zn={class:'cardhub-pagination'},Tn={key:0,class:'cardhub-pagination__actions'},Dn=['disabled'],An=['disabled'],Mn={class:'cardhub-pagination__status'},Ln={class:'cardhub-grid'},$n=['onClick'],jn={class:'cardhub-card__info'},Fn={class:'cardhub-card__head'},Hn={class:'cardhub-card__name'},In=['onClick'],Pn={class:'cardhub-card__meta'},On={key:0,class:'cardhub-card__note'},Un={class:'cardhub-card__tags'},Kn=['onClick'],Rn=['onClick'],Yn=['onKeydown','onBlur'],Wn=['onClick'],qn={class:'cardhub-card__actions'},Jn=['onClick'],Xn=['onClick'],Zn={class:'cardhub-confirm__panel cardhub-modal__panel',role:'dialog','aria-modal':'true'},Gn={class:'cardhub-confirm__title'},Qn={class:'cardhub-confirm__message'},ea={class:'cardhub-confirm__actions'},na={class:'cardhub-tag-manager__panel cardhub-modal__panel',role:'dialog','aria-label':'标签管理'},aa={class:'cardhub-tag-manager__header'},ra={key:0,class:'cardhub-tag-manager__subtitle'},ta={key:1,class:'cardhub-tag-manager__subtitle'},oa={class:'cardhub-tag-manager__tabs'},ca={key:0,class:'cardhub-tag-manager__section'},ia={class:'cardhub-tag-manager__actions'},la=['disabled'],da={class:'cardhub-tag-manager__list'},sa=['onClick'],ua={key:1,class:'cardhub-tag-manager__section cardhub-tag-manager__batch'},ba={class:'cardhub-batch__filters'},pa={class:'cardhub-batch__field'},ga={key:0,class:'cardhub-batch__suggestions'},ha={class:'cardhub-batch__suggest-row'},ma=['onClick'],fa={class:'cardhub-batch__toolbar'},va={class:'cardhub-batch__list'},xa=['checked','onChange'],_a={class:'cardhub-batch__main'},ya={class:'cardhub-batch__name'},wa={class:'cardhub-batch__meta'},ka={key:0,class:'cardhub-batch__tags'},Ea={class:'cardhub-export__panel cardhub-modal__panel',role:'dialog','aria-label':'批量导出'},Ca={class:'cardhub-export__header'},Na={class:'cardhub-export__subtitle'},Va={class:'cardhub-export__filters'},Sa={class:'cardhub-export__filter-row'},Ba={class:'cardhub-export__filter-row'},za=['onClick'],Ta={class:'cardhub-export__toolbar'},Da={class:'cardhub-export__list'},Aa=['checked','onChange'],Ma={class:'cardhub-export__main'},La={class:'cardhub-export__name'},$a={class:'cardhub-export__meta'},ja={key:0,class:'cardhub-export__tags'},Fa={class:'cardhub-theme__panel cardhub-modal__panel',role:'dialog','aria-label':'配色设置'},Ha={class:'cardhub-theme__grid'},Ia={class:'cardhub-theme__field'},Pa={class:'cardhub-theme__field'},Oa={class:'cardhub-theme__field'},Ua={class:'cardhub-theme__field'},Ka={class:'cardhub-theme__field'},Ra={class:'cardhub-theme__field'},Ya={class:'cardhub-theme__field'},Wa={class:'cardhub-theme__field'},qa={class:'cardhub-theme__field'},Ja={class:'cardhub-theme__presets'},Xa=['onClick'],Za='cardhub_favorites',Ga='cardhub_last_chat_cache',Qa='cardhub_import_cache',er='cardhub_notes',nr='cardhub_theme',ar=(0,T.defineComponent)({__name:'App',setup(e){const n=(0,T.ref)('all'),a=(0,T.ref)(24),t=(0,T.ref)(1),o=(0,T.ref)(null),c=(0,T.reactive)({open:!1,title:'',message:'',confirmLabel:'确定',cancelLabel:'取消',altLabel:'',resolve:null}),i=(0,T.computed)(()=>[...D.characters,...D.library]),d=(0,T.computed)(()=>{const e=new Map;return i.value.forEach(n=>{e.set(n.id,I(n))}),e}),{selectedTags:s,allTags:u,applyTagFilter:b,toggleTagFilter:p,clearTagFilter:g}=function(e,n){const a=(0,T.ref)([]),r=(0,T.computed)(()=>{const r=new Set;return e.value.forEach(e=>{n(e).forEach(e=>r.add(e))}),a.value.forEach(e=>r.add(e)),Array.from(r).sort((e,n)=>e.localeCompare(n,'zh-CN'))});return{selectedTags:a,allTags:r,applyTagFilter:function(e){return a.value.length?e.filter(e=>a.value.some(a=>n(e).includes(a))):e},toggleTagFilter:function(e){a.value.includes(e)?a.value=a.value.filter(n=>n!==e):a.value=[...a.value,e]},clearTagFilter:function(){a.value=[]}}}(i,I),h=(0,T.ref)([]),m=(0,T.computed)(()=>new Set(h.value)),f=(0,T.ref)('recent'),v=(0,T.ref)(!1),x=(0,T.ref)({}),y=(0,T.ref)({}),w=(0,T.ref)({}),k={bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'},E=(0,T.ref)(!1),C=(0,T.ref)({...k}),N=(0,T.reactive)({...k}),F=(0,T.computed)(()=>{const e=E.value?N:C.value;return{'--cardhub-bg-start':e.bgStart,'--cardhub-bg-end':e.bgEnd,'--cardhub-surface':e.surface,'--cardhub-surface-alt':e.surfaceAlt,'--cardhub-text':e.text,'--cardhub-text-muted':e.textMuted,'--cardhub-accent':e.accent,'--cardhub-accent-strong':e.accentStrong,'--cardhub-border':e.border,'--cardhub-surface-rgb':Ke(e.surface),'--cardhub-surface-alt-rgb':Ke(e.surfaceAlt),'--cardhub-border-rgb':Ke(e.border),'--cardhub-accent-rgb':Ke(e.accent),'--cardhub-accent-strong-rgb':Ke(e.accentStrong),'--cardhub-accent-text':Re(e.accent),'--cardhub-accent-strong-text':Re(e.accentStrong)}}),H=[{name:'晨雾',value:{bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'}},{name:'白天',value:{bgStart:'#fdfaf4',bgEnd:'#f2ebe1',surface:'#fffefb',surfaceAlt:'#f7efe6',text:'#1d1a17',textMuted:'#7a6f63',accent:'#e3a981',accentStrong:'#3f2c22',border:'#e4d7c8'}},{name:'夜晚',value:{bgStart:'#14181d',bgEnd:'#0d1116',surface:'#1e242b',surfaceAlt:'#242b34',text:'#eef2f7',textMuted:'#b2bdc9',accent:'#6fa2d1',accentStrong:'#d7e6f4',border:'#36414c'}},{name:'茶棕',value:{bgStart:'#f7f1e7',bgEnd:'#e6d8c6',surface:'#fcf6ee',surfaceAlt:'#f2e4d6',text:'#2a1f18',textMuted:'#8a6d5a',accent:'#c47b52',accentStrong:'#3e2a22',border:'#ddc7b4'}},{name:'赤陶',value:{bgStart:'#fbf1ea',bgEnd:'#ecd5c8',surface:'#fff7f1',surfaceAlt:'#f4e1d6',text:'#2d2018',textMuted:'#8b6a5a',accent:'#d17a4f',accentStrong:'#4c2d21',border:'#e3c3b3'}},{name:'薄荷',value:{bgStart:'#f2fbf7',bgEnd:'#dcefe7',surface:'#f9fffd',surfaceAlt:'#e8f4f0',text:'#1a2a26',textMuted:'#5f7a73',accent:'#60b6a4',accentStrong:'#1f4c43',border:'#c5ddd5'}},{name:'海盐',value:{bgStart:'#f3f8fb',bgEnd:'#d9e7f3',surface:'#f9fcff',surfaceAlt:'#e9f2f9',text:'#1b2530',textMuted:'#5f7388',accent:'#5da3cf',accentStrong:'#1f3e57',border:'#c8d9e7'}},{name:'石墨',value:{bgStart:'#2a2d33',bgEnd:'#1e2126',surface:'#333741',surfaceAlt:'#3b404b',text:'#f3f5f8',textMuted:'#c1c7d0',accent:'#9aa6b2',accentStrong:'#e0e5ea',border:'#4b5261'}}],O=(0,T.computed)(()=>{const e=function(e){if(!v.value)return e;return e.filter(e=>m.value.has(e.id))}(function(e){if('imported'===n.value)return e.filter(e=>!Ue(e));if('unimported'===n.value)return e.filter(e=>Ue(e));return e}(i.value)),a=D.search.trim().toLowerCase();return Oe(a?b(e).filter(e=>{if(e.name.toLowerCase().includes(a))return!0;return(d.value.get(e.id)??I(e)).some(e=>e.toLowerCase().includes(a))}):b(e))}),{tagManagerOpen:U,tagManagerTab:K,openTagManager:R,closeTagManager:Y,batchTagSelectedIds:W,batchTagSearch:q,batchTagInput:J,batchTagSelectedTags:X,batchTagSelectedSet:Z,batchTagVisibleCandidates:G,batchTagSuggestions:Q,toggleBatchTagSelection:ee,selectAllBatchTags:ne,clearBatchTagSelection:ae,toggleBatchTagSuggestion:re,applyBatchTags:te}=pn({allCards:i,filteredCharacters:O,allTags:u,displayTags:Ae,applyTagUpdate:dn,openConfirm:cn}),oe=(0,T.toRef)(D,'search'),{importInput:ce,exportDialogOpen:ie,exportSearch:le,exportStatusFilter:de,exportTagFilters:se,exportAllTags:ue,exportVisibleCandidates:be,exportSelectedItems:pe,exportSelectedIds:ge,openExportDialog:he,exportSelected:me,confirmExportSelected:fe,isExportSelected:ve,toggleExportSelection:xe,selectAllExport:_e,clearExportSelection:ye,triggerImport:we,handleImportFiles:ke,handleCardAction:Ee,importLibraryCard:Ce,exportCard:Ne,exportLibraryCard:Ve,manageDelete:Se}=gn({allCards:i,stateSearch:oe,selectedTags:s,statusFilter:n,getCharacters:()=>D.characters,getLibrary:()=>D.library,setLibrary:j,setCharacters:on,fetchCharacterSummaries:r,addToLibrary:S,removeFromLibrary:B,updateCharacterTags:P,parseLibraryCardData:sr,extractCardTagsFromData:function(e){const n=e?.tags??e?.data?.tags;if(!Array.isArray(n))return[];return n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean)},normalizeNameKey:function(e){return e.trim().toLocaleLowerCase()},normalizeAvatarKey:function(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n);return n.trim().toLowerCase()},dataUrlToBlob:async function(e){const n=await fetch(e);return await n.blob()},downloadBlob:function(e,n){const a=URL.createObjectURL(e),r=document.createElement('a');r.href=a,r.download=n,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)},openConfirm:cn,closeManage:dr,sleep:Er}),Be=(0,T.computed)(()=>{const e=Math.ceil(O.value.length/a.value);return e>0?e:1}),ze=(0,T.computed)(()=>{const e=(t.value-1)*a.value;return O.value.slice(e,e+a.value)});function Te(e,n=!1){const a=e.avatar;return a?/^(data:|https?:|\/)/.test(a)?a:n&&'tavern'===e.origin?TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:null}function De(e){const n=Te(e);return n?{backgroundImage:`url(${n})`}:{}}function Ae(e){return d.value.get(e.id)??I(e)}function Me(e){return e.note?.trim()??''}function Le(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Ga]:e})}function $e(e){return'tavern'!==e.origin?null:e.avatar?`avatar:${e.avatar}`:e.name?`name:${e.name}`:null}function je(e){if('number'==typeof e.createdAt&&e.createdAt>0)return e.createdAt;const n=$e(e);return n?y.value[n]??0:0}function Fe(e){if('number'==typeof e.lastChatAt&&e.lastChatAt>0)return e.lastChatAt;const n=$e(e);return n?x.value[n]??0:0}function He(e,n){if(n<=0||'tavern'!==e.origin)return;const a=new Set;if(e.avatar&&a.add(`avatar:${e.avatar}`),e.name&&a.add(`name:${e.name}`),!a.size)return;const r={...x.value};let t=!1;a.forEach(e=>{(r[e]??0)<n&&(r[e]=n,t=!0)}),t&&(x.value=r,Le(r))}function Ie(e){y.value=e,function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Qa]:e})}(e)}function Pe(e){m.value.has(e.id)?h.value=h.value.filter(n=>n!==e.id):h.value=[...h.value,e.id],function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Za]:e})}(h.value)}function Oe(e){const n=e.map(e=>({item:e,tagCount:(d.value.get(e.id)??I(e)).length})),a=(e,n)=>e.localeCompare(n,'zh-CN');return n.sort((e,n)=>{const r=e.item,t=n.item;if('name'===f.value)return a(r.name,t.name);if('tags'===f.value)return n.tagCount!==e.tagCount?n.tagCount-e.tagCount:a(r.name,t.name);if('imported'===f.value){const e=je(r),n=je(t);return n!==e?n-e:a(r.name,t.name)}const o=Fe(r),c=Fe(t);if(c!==o)return c-o;const i=r.createdAt??0,l=t.createdAt??0;return l!==i?l-i:a(r.name,t.name)}).map(e=>e.item)}function Ue(e){return!('library'!==e.origin&&!Boolean(e.rawType))||D.library.some(n=>n.id===e.id)}function Ke(e){const n=e.replace('#','');if(6!==n.length)return'0, 0, 0';return`${Number.parseInt(n.slice(0,2),16)}, ${Number.parseInt(n.slice(2,4),16)}, ${Number.parseInt(n.slice(4,6),16)}`}function Re(e){const n=Ke(e).split(',').map(e=>Number(e.trim()));if(3!==n.length)return'#1b1b1b';const[a,r,t]=n.map(e=>e/255);return.2126*a+.7152*r+.0722*t>.6?'#1b1b1b':'#ffffff'}let Ye=0,We=null;function qe(e){Ye&&(cancelAnimationFrame(Ye),Ye=0),We&&window.clearTimeout(We),We=window.setTimeout(()=>{We=null,Ye=requestAnimationFrame(()=>{Ye=0,function(e){const n=function(){try{return(window.parent?.document??document).querySelector('.cardhub-root')}catch{return document.querySelector('.cardhub-root')}}();if(!n)return;n.style.setProperty('--cardhub-bg-start',e.bgStart),n.style.setProperty('--cardhub-bg-end',e.bgEnd),n.style.setProperty('--cardhub-surface',e.surface),n.style.setProperty('--cardhub-surface-alt',e.surfaceAlt),n.style.setProperty('--cardhub-text',e.text),n.style.setProperty('--cardhub-text-muted',e.textMuted),n.style.setProperty('--cardhub-accent',e.accent),n.style.setProperty('--cardhub-accent-strong',e.accentStrong),n.style.setProperty('--cardhub-border',e.border),n.style.setProperty('--cardhub-surface-rgb',Ke(e.surface)),n.style.setProperty('--cardhub-surface-alt-rgb',Ke(e.surfaceAlt)),n.style.setProperty('--cardhub-border-rgb',Ke(e.border)),n.style.setProperty('--cardhub-accent-rgb',Ke(e.accent)),n.style.setProperty('--cardhub-accent-strong-rgb',Ke(e.accentStrong)),n.style.setProperty('--cardhub-accent-text',Re(e.accent)),n.style.setProperty('--cardhub-accent-strong-text',Re(e.accentStrong))}(e)})},80)}function Je(){const e=TavernHelper.getVariables({type:'global'});return function(e){if(!e||'object'!=typeof e)return{...k};const n=e,a=e=>{const a=n[e];return/^#[0-9a-f]{6}$/i.test(a)?a:k[e]};return{bgStart:a('bgStart'),bgEnd:a('bgEnd'),surface:a('surface'),surfaceAlt:a('surfaceAlt'),text:a('text'),textMuted:a('textMuted'),accent:a('accent'),accentStrong:a('accentStrong'),border:a('border')}}(e?.[nr])}function Xe(){const e=C.value;Object.assign(N,e),E.value=!0,(0,T.nextTick)(()=>qe(e))}function Ze(){E.value=!1,Object.assign(N,C.value),qe(C.value)}function Ge(){Object.assign(N,k)}function Qe(){C.value={...N},function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[nr]:e})}(C.value),qe(C.value),E.value=!1}function en(){se.value=[]}function nn(){ie.value=!1}function an(){t.value>1&&(t.value-=1)}function rn(){t.value<Be.value&&(t.value+=1)}function tn(e){if('tavern'!==e.origin)return null;const n=e.tagKey??e.avatar??e.name;return n?`tavern:${n}`:null}function on(e){L(function(e){return e.map(e=>{const n=tn(e);return n?{...e,note:w.value[n]??''}:{...e,note:e.note??''}})}(e))}function cn(e){return c.open&&c.resolve&&c.resolve('cancel'),c.title=e.title??'确认操作',c.message=e.message,c.confirmLabel=e.confirmLabel??'确定',c.cancelLabel=e.cancelLabel??'取消',c.altLabel=e.altLabel??'',c.open=!0,new Promise(e=>{c.resolve=e})}function ln(e){if(!c.open)return;c.open=!1;const n=c.resolve;c.resolve=null,n&&n(e)}function dn(e,n){if(Ue(e)){j(function(e,n,a){const r=(Array.isArray(a)&&a.length?a:V()).map(a=>a.id!==e?a:{...a,tags:n,tagsEdited:!0});return l(r),r}(e.id,n,D.library))}else{const a=P(e,n);e.tags=a,L([...D.characters])}}(0,T.watch)(N,e=>{E.value&&qe({...e})},{deep:!0}),(0,T.onMounted)(()=>{const e=Je();C.value=e,Object.assign(N,e),(0,T.nextTick)(()=>qe(e)),h.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[Za];return Array.isArray(n)?n.filter(e=>'string'==typeof e):[]}(),x.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[Ga];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),y.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[Qa];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),w.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[er];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'string'==typeof e&&e.trim().length>0);return Object.fromEntries(a)}(),wr(i.value),kr(i.value)}),(0,T.watch)([()=>D.search,n,()=>s.value.join('|'),f,v],()=>{t.value=1}),(0,T.watch)([O,Be],()=>{t.value>Be.value&&(t.value=Be.value),t.value<1&&(t.value=1)}),(0,T.watch)([f,i],()=>{'recent'===f.value&&wr(i.value),'imported'===f.value&&kr(i.value)});const{tagKey:sn,activeTagKey:un,tagInput:ar,startTagEdit:rr,cancelTagEdit:tr,confirmTag:or,removeTag:cr}=function(e){const n=(0,T.ref)(null),a=(0,T.ref)('');function r(e){return e.id}function t(){n.value=null,a.value=''}return{tagKey:r,activeTagKey:n,tagInput:a,startTagEdit:function(e){n.value=r(e),a.value='',(0,T.nextTick)(()=>{const e=document.querySelector('.cardhub-tag-input');e?.focus()})},cancelTagEdit:t,confirmTag:function(o){if(n.value!==r(o))return;const c=a.value.trim();if(c){const n=[...e.getTags(o),c];e.applyTagUpdate(o,n)}t()},removeTag:function(n,a){const r=e.getTags(n).filter(e=>e!==a);e.applyTagUpdate(n,r)}}}({getTags:I,applyTagUpdate:dn});function ir(e,n){const a=n.trim();if(Ue(e)){const n=function(e,n,a){const r=(Array.isArray(a)&&a.length?a:V()).map(a=>a.id!==e?a:{...a,note:n});return l(r),r}(e.id,a,D.library);j(n);const r=n.find(n=>n.id===e.id);return void(r&&(o.value=r))}const r=tn(e);if(!r)return;const t={...w.value};a?t[r]=a:delete t[r],w.value=t,function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[er]:e})}(t);const c=D.characters.map(n=>n.id===e.id?{...n,note:a}:n);L(c);const i=c.find(n=>n.id===e.id);i&&(o.value=i)}function lr(e){o.value=e}function dr(){o.value=null}function sr(e){return e.raw&&e.rawType?'json'===e.rawType?ur(e.raw):'png'===e.rawType?function(e){const n=function(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}(e);if(!n)return null;const a=function(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let r=8;for(;r+8<=e.length;){const n=hr(e,r),t=mr(e.subarray(r+4,r+8)),o=r+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===t){const e=br(i);e&&a.push(e)}else if('iTXt'===t){const e=pr(i);e&&a.push(e)}r=c+4}return a}(n),r=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!r.has(e.key.toLowerCase()))continue;const n=gr(e.value);if(n)return n}return null}(e.raw):null:null}function ur(e){try{return JSON.parse(e)}catch{return null}}function br(e){const n=e.indexOf(0);if(n<0)return null;const a=mr(e.subarray(0,n)).trim(),r=mr(e.subarray(n+1)).trim();return a&&r?{key:a,value:r}:null}function pr(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=mr(e.subarray(0,n)).trim(),r=1===e[n+1];let t=n+2;const o=e.indexOf(0,t);if(o<0)return null;t=o+1;const c=e.indexOf(0,t);if(c<0)return null;if(t=c+1,r)return null;const i=mr(e.subarray(t)).trim();return a&&i?{key:a,value:i}:null}function gr(e){const n=e.trim();if(!n)return null;const a=ur(n);if(a)return a;if(!function(e){if(e.length<16||e.length%4!=0)return!1;return/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const r=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return r?ur(r):null}function hr(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function mr(e){return(new TextDecoder).decode(e)}function fr(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function vr(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function xr(e){const n=[e?.last_message_time,e?.last_message_date,e?.update_time,e?.last_modified,e?.create_date,e?.timestamp,e?.time];for(const e of n){const n=vr(e);if(n)return n}const a=fr(e?.file_name,e?.file_id);return a?function(e){const n=e.replace(/\.jsonl$/i,'').trim().match(/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/);if(!n)return null;const a=Number(n[1]),r=Number(n[2]),t=Number(n[3]),o=n[4]?Number(n[4]):0,c=n[5]?Number(n[5]):0,i=n[6]?Number(n[6]):0;if(!a||!r||!t)return null;const l=new Date(a,r-1,t,o,c,i).getTime();return Number.isNaN(l)?null:l}(a):null}function _r(e){return[...e].sort((e,n)=>{const a=xr(e)??0;return(xr(n)??0)-a})}let yr=0;async function wr(e){if('recent'!==f.value)return;const n=e.filter(e=>'tavern'===e.origin&&(!('number'==typeof e.lastChatAt&&e.lastChatAt>0)&&Fe(e)<=0));if(!n.length)return;const a=++yr;for(const e of n){if(a!==yr||'recent'!==f.value)return;if('tavern'!==e.origin)continue;if('number'==typeof e.lastChatAt&&e.lastChatAt>0)continue;const n=Fe(e);let r=null;try{r=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0)}catch(e){console.warn('[CardHub] 读取聊天简报失败',e)}if(Array.isArray(r)&&r.length){const a=xr(_r(r)[0])??0;a>n&&He(e,a)}await Er(80)}}function kr(e){const n={...y.value};let a=!1;const r=Date.now();e.forEach((t,o)=>{if('tavern'!==t.origin)return;if('number'==typeof t.createdAt&&t.createdAt>0)return;const c=$e(t);c&&!n[c]&&(n[c]=r-1e3*(e.length-1-o),a=!0)}),a&&Ie(n)}function Er(e){return new Promise(n=>setTimeout(n,e))}async function Cr(){M(!0);try{on(await r()),j(V())}finally{M(!1)}}function Nr(){A(!1)}return(e,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{class:(0,T.normalizeClass)(['cardhub-root',{open:(0,T.unref)(D).open}]),style:(0,T.normalizeStyle)(F.value)},[(0,T.createElementVNode)('div',{class:'cardhub-backdrop',onClick:Nr}),(0,T.createElementVNode)('section',hn,[(0,T.createElementVNode)('header',{class:'cardhub-header'},[a[59]||(a[59]=(0,T.createElementVNode)('div',{class:'cardhub-title'},[(0,T.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,T.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,T.createElementVNode)('div',{class:'cardhub-actions'},[(0,T.createElementVNode)('button',{class:'cardhub-theme-trigger',type:'button','aria-label':'配色',onClick:Xe},[...a[57]||(a[57]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-palette','aria-hidden':'true'},null,-1)])]),(0,T.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:Nr},[...a[58]||(a[58]=[(0,T.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,T.createElementVNode)('div',mn,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>(0,T.unref)(D).search=e),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(D).search]]),(0,T.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:Cr},'刷新'),(0,T.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[1]||(a[1]=(...e)=>(0,T.unref)(we)&&(0,T.unref)(we)(...e))},'导入'),(0,T.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[2]||(a[2]=(...e)=>(0,T.unref)(me)&&(0,T.unref)(me)(...e))},'批量导出'),(0,T.createElementVNode)('input',{ref_key:'importInput',ref:ce,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:a[3]||(a[3]=(...e)=>(0,T.unref)(ke)&&(0,T.unref)(ke)(...e))},null,544)]),(0,T.createElementVNode)('div',fn,[(0,T.createElementVNode)('div',vn,[(0,T.createElementVNode)('div',xn,[(0,T.createElementVNode)('div',_n,[a[60]||(a[60]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,T.createElementVNode)('div',yn,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'all'===n.value}]),type:'button',onClick:a[4]||(a[4]=e=>n.value='all')},' 全部 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'imported'===n.value}]),type:'button',onClick:a[5]||(a[5]=e=>n.value='imported')},' 已导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===n.value}]),type:'button',onClick:a[6]||(a[6]=e=>n.value='unimported')},' 未导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':v.value}]),type:'button',onClick:a[7]||(a[7]=e=>v.value=!v.value)},' 收藏 ',2)])]),(0,T.createElementVNode)('div',wn,[a[61]||(a[61]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'排序',-1)),(0,T.createElementVNode)('div',kn,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'recent'===f.value}]),type:'button',onClick:a[8]||(a[8]=e=>f.value='recent')},' 最近聊天 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'name'===f.value}]),type:'button',onClick:a[9]||(a[9]=e=>f.value='name')},' 名称 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'tags'===f.value}]),type:'button',onClick:a[10]||(a[10]=e=>f.value='tags')},' 标签数量 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'imported'===f.value}]),type:'button',onClick:a[11]||(a[11]=e=>f.value='imported')},' 导入时间 ',2)])])]),a[62]||(a[62]=(0,T.createElementVNode)('div',{class:'cardhub-divider'},null,-1)),a[63]||(a[63]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,T.createElementVNode)('div',En,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(u),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':(0,T.unref)(s).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(p)(e)},(0,T.toDisplayString)(e),11,Cn))),128))]),(0,T.unref)(s).length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:a[12]||(a[12]=(...e)=>(0,T.unref)(g)&&(0,T.unref)(g)(...e))},' 清空标签 ')):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('button',{class:'cardhub-chip cardhub-chip--more',type:'button',onClick:a[13]||(a[13]=e=>(0,T.unref)(R)('filter'))},' 标签管理 ')]),(0,T.createElementVNode)('div',Nn,[(0,T.unref)(D).loading?((0,T.openBlock)(),(0,T.createElementBlock)('div',Vn,'正在读取角色卡...')):O.value.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Bn,[(0,T.createElementVNode)('div',zn,[Be.value>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',Tn,[(0,T.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:t.value<=1,onClick:an},' 上一页 ',8,Dn),(0,T.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:t.value>=Be.value,onClick:rn},' 下一页 ',8,An)])):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('span',Mn,'第 '+(0,T.toDisplayString)(t.value)+' / '+(0,T.toDisplayString)(Be.value)+' 页',1)]),(0,T.createElementVNode)('div',Ln,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(ze.value,e=>{return(0,T.openBlock)(),(0,T.createElementBlock)('article',{key:e.id,class:'cardhub-card',onClick:n=>lr(e)},[(0,T.createElementVNode)('div',{class:(0,T.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(Te(e))}]),style:(0,T.normalizeStyle)(De(e))},[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.name.slice(0,1)||'?'),1)],6),(0,T.createElementVNode)('div',jn,[(0,T.createElementVNode)('div',Fn,[(0,T.createElementVNode)('div',Hn,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-fav',{'is-active':(n=e.id,m.value.has(n))}]),type:'button','aria-label':'收藏',onClick:(0,T.withModifiers)(n=>Pe(e),['stop'])},[...a[64]||(a[64]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-star','aria-hidden':'true'},null,-1)])],10,In)]),(0,T.createElementVNode)('div',Pn,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(Ae(e).length)+' 标签',1)]),Me(e)?((0,T.openBlock)(),(0,T.createElementBlock)('div',On,(0,T.toDisplayString)(Me(e)),1)):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('div',Un,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(Ae(e),n=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:n,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:(0,T.withModifiers)(a=>(0,T.unref)(cr)(e,n),['stop'])},[(0,T.createTextVNode)((0,T.toDisplayString)(n)+' ',1),a[65]||(a[65]=(0,T.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,Kn))),128)),(0,T.unref)(un)!==(0,T.unref)(sn)(e)?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:(0,T.withModifiers)(n=>(0,T.unref)(rr)(e),['stop'])},' + 标签 ',8,Rn)):((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-tag-edit',onClick:a[16]||(a[16]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[17]||(a[17]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[18]||(a[18]=(0,T.withModifiers)(()=>{},['stop']))},[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[14]||(a[14]=e=>(0,T.isRef)(ar)?ar.value=e:null),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,T.withKeys)((0,T.withModifiers)(n=>(0,T.unref)(or)(e),['prevent']),['enter']),a[15]||(a[15]=(0,T.withKeys)((0,T.withModifiers)((...e)=>(0,T.unref)(tr)&&(0,T.unref)(tr)(...e),['prevent']),['esc']))],onBlur:n=>(0,T.unref)(or)(e)},null,40,Yn),[[T.vModelText,(0,T.unref)(ar)]]),(0,T.createElementVNode)('button',{class:'cardhub-tag-confirm',type:'button',onClick:n=>(0,T.unref)(or)(e)},'✔',8,Wn)],32))])]),(0,T.createElementVNode)('div',qn,[(0,T.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,T.withModifiers)(n=>(0,T.unref)(Ee)(e),['stop']),onPointerdown:a[19]||(a[19]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[20]||(a[20]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[21]||(a[21]=(0,T.withModifiers)(()=>{},['stop']))},(0,T.toDisplayString)('tavern'===e.origin?'导出':'导入'),41,Jn),(0,T.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,T.withModifiers)(n=>lr(e),['stop']),onPointerdown:a[22]||(a[22]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[23]||(a[23]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[24]||(a[24]=(0,T.withModifiers)(()=>{},['stop']))},' 管理 ',40,Xn)])],8,$n);var n}),128))])])):((0,T.openBlock)(),(0,T.createElementBlock)('div',Sn,'暂无角色卡，或没有匹配的搜索结果。'))])])]),(0,T.createVNode)(bn,{card:o.value,'display-tags':Ae,'handle-card-action':(0,T.unref)(Ee),'manage-delete':(0,T.unref)(Se),'close-manage':dr,'close-root':Nr,'apply-note-update':ir,'parse-library-card-data':sr,'update-last-chat-cache-for-card':He},null,8,['card','handle-card-action','manage-delete']),c.open?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:0,class:'cardhub-confirm cardhub-modal',onClick:a[28]||(a[28]=(0,T.withModifiers)(e=>ln('cancel'),['self']))},[(0,T.createElementVNode)('div',Zn,[(0,T.createElementVNode)('div',Gn,(0,T.toDisplayString)(c.title),1),(0,T.createElementVNode)('div',Qn,(0,T.toDisplayString)(c.message),1),(0,T.createElementVNode)('div',ea,[(0,T.createElementVNode)('button',{class:'cardhub-confirm__button is-cancel',type:'button',onClick:a[25]||(a[25]=e=>ln('cancel'))},(0,T.toDisplayString)(c.cancelLabel),1),c.altLabel?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-confirm__button is-danger',type:'button',onClick:a[26]||(a[26]=e=>ln('alt'))},(0,T.toDisplayString)(c.altLabel),1)):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('button',{class:'cardhub-confirm__button is-confirm',type:'button',onClick:a[27]||(a[27]=e=>ln('confirm'))},(0,T.toDisplayString)(c.confirmLabel),1)])])])):(0,T.createCommentVNode)('v-if',!0),(0,T.unref)(U)?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-tag-manager cardhub-modal',onClick:a[40]||(a[40]=(0,T.withModifiers)((...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e),['self']))},[(0,T.createElementVNode)('div',na,[(0,T.createElementVNode)('div',aa,[(0,T.createElementVNode)('div',null,[a[66]||(a[66]=(0,T.createElementVNode)('div',{class:'cardhub-tag-manager__title'},'标签管理',-1)),'filter'===(0,T.unref)(K)?((0,T.openBlock)(),(0,T.createElementBlock)('div',ra,' 已选 '+(0,T.toDisplayString)((0,T.unref)(s).length)+' / '+(0,T.toDisplayString)((0,T.unref)(u).length),1)):((0,T.openBlock)(),(0,T.createElementBlock)('div',ta,' 已选 '+(0,T.toDisplayString)((0,T.unref)(W).length)+' / '+(0,T.toDisplayString)((0,T.unref)(G).length),1))]),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:a[29]||(a[29]=(...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e))},'×')]),(0,T.createElementVNode)('div',oa,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'filter'===(0,T.unref)(K)}]),type:'button',onClick:a[30]||(a[30]=e=>(0,T.unref)(R)('filter'))},' 标签筛选 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'batch'===(0,T.unref)(K)}]),type:'button',onClick:a[31]||(a[31]=e=>(0,T.unref)(R)('batch'))},' 批量标签 ',2)]),'filter'===(0,T.unref)(K)?((0,T.openBlock)(),(0,T.createElementBlock)('div',ca,[(0,T.createElementVNode)('div',ia,[(0,T.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-secondary',type:'button',disabled:!(0,T.unref)(s).length,onClick:a[32]||(a[32]=(...e)=>(0,T.unref)(g)&&(0,T.unref)(g)(...e))},' 清空 ',8,la),a[67]||(a[67]=(0,T.createElementVNode)('div',{class:'cardhub-tag-manager__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-primary',type:'button',onClick:a[33]||(a[33]=(...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e))},'完成')]),(0,T.createElementVNode)('div',da,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(u),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-tag-manager__chip',{'is-active':(0,T.unref)(s).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(p)(e)},(0,T.toDisplayString)(e),11,sa))),128))])])):((0,T.openBlock)(),(0,T.createElementBlock)('div',ua,[(0,T.createElementVNode)('div',ba,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[34]||(a[34]=e=>(0,T.isRef)(q)?q.value=e:null),class:'cardhub-batch__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(q)]]),a[68]||(a[68]=(0,T.createElementVNode)('div',{class:'cardhub-batch__hint'},'提示：可先在主界面筛选，再切换到批量标签。',-1))]),(0,T.createElementVNode)('div',pa,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[35]||(a[35]=e=>(0,T.isRef)(J)?J.value=e:null),type:'text',placeholder:'输入标签，逗号/换行分隔'},null,512),[[T.vModelText,(0,T.unref)(J)]])]),(0,T.unref)(Q).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',ga,[a[69]||(a[69]=(0,T.createElementVNode)('span',{class:'cardhub-batch__suggest-title'},'已有标签',-1)),(0,T.createElementVNode)('div',ha,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(Q),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-batch__chip',{'is-active':(0,T.unref)(X).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(re)(e)},(0,T.toDisplayString)(e),11,ma))),128))])])):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('div',fa,[(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[36]||(a[36]=(...e)=>(0,T.unref)(ne)&&(0,T.unref)(ne)(...e))},'全选'),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[37]||(a[37]=(...e)=>(0,T.unref)(ae)&&(0,T.unref)(ae)(...e))},'清空'),a[70]||(a[70]=(0,T.createElementVNode)('div',{class:'cardhub-batch__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-ghost',type:'button',onClick:a[38]||(a[38]=e=>(0,T.unref)(te)('remove'))},' 移除标签 '),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-primary',type:'button',onClick:a[39]||(a[39]=e=>(0,T.unref)(te)('add'))},'添加标签')]),(0,T.createElementVNode)('div',va,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(G),e=>((0,T.openBlock)(),(0,T.createElementBlock)('label',{key:e.id,class:'cardhub-batch__item'},[(0,T.createElementVNode)('input',{class:'cardhub-batch__checkbox',type:'checkbox',checked:(0,T.unref)(Z).has(e.id),onChange:n=>(0,T.unref)(ee)(e.id)},null,40,xa),(0,T.createElementVNode)('div',_a,[(0,T.createElementVNode)('div',ya,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('div',wa,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(Ae(e).length)+' 标签',1)]),Ae(e).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',ka,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(Ae(e).slice(0,3),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-batch__tag'},(0,T.toDisplayString)(e),1))),128))])):(0,T.createCommentVNode)('v-if',!0)])]))),128))])]))])])):(0,T.createCommentVNode)('v-if',!0),(0,T.unref)(ie)?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:2,class:'cardhub-export cardhub-modal',onClick:(0,T.withModifiers)(nn,['self'])},[(0,T.createElementVNode)('div',Ea,[(0,T.createElementVNode)('div',Ca,[(0,T.createElementVNode)('div',null,[a[71]||(a[71]=(0,T.createElementVNode)('div',{class:'cardhub-export__title'},'批量导出',-1)),(0,T.createElementVNode)('div',Na,' 已选 '+(0,T.toDisplayString)((0,T.unref)(pe).length)+' / '+(0,T.toDisplayString)((0,T.unref)(be).length),1)]),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:nn},'×')]),(0,T.createElementVNode)('div',Va,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[41]||(a[41]=e=>(0,T.isRef)(le)?le.value=e:null),class:'cardhub-export__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(le)]]),(0,T.createElementVNode)('div',Sa,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'all'===(0,T.unref)(de)}]),type:'button',onClick:a[42]||(a[42]=e=>de.value='all')},' 全部 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'imported'===(0,T.unref)(de)}]),type:'button',onClick:a[43]||(a[43]=e=>de.value='imported')},' 已导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'unimported'===(0,T.unref)(de)}]),type:'button',onClick:a[44]||(a[44]=e=>de.value='unimported')},' 未导入 ',2)]),(0,T.createElementVNode)('div',Ba,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(ue),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':(0,T.unref)(se).includes(e)}]),type:'button',onClick:n=>function(e){se.value.includes(e)?se.value=se.value.filter(n=>n!==e):se.value=[...se.value,e]}(e)},(0,T.toDisplayString)(e),11,za))),128)),(0,T.unref)(se).length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-export__chip cardhub-export__chip--clear',type:'button',onClick:en},' 清空标签 ')):(0,T.createCommentVNode)('v-if',!0)])]),(0,T.createElementVNode)('div',Ta,[(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[45]||(a[45]=(...e)=>(0,T.unref)(_e)&&(0,T.unref)(_e)(...e))},'全选'),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[46]||(a[46]=(...e)=>(0,T.unref)(ye)&&(0,T.unref)(ye)(...e))},'清空'),a[72]||(a[72]=(0,T.createElementVNode)('div',{class:'cardhub-export__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:nn},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-primary',type:'button',onClick:a[47]||(a[47]=(...e)=>(0,T.unref)(fe)&&(0,T.unref)(fe)(...e))},'导出已选')]),(0,T.createElementVNode)('div',Da,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(be),e=>((0,T.openBlock)(),(0,T.createElementBlock)('label',{key:e.id,class:'cardhub-export__item'},[(0,T.createElementVNode)('input',{class:'cardhub-export__checkbox',type:'checkbox',checked:(0,T.unref)(ve)(e.id),onChange:n=>(0,T.unref)(xe)(e.id)},null,40,Aa),(0,T.createElementVNode)('div',Ma,[(0,T.createElementVNode)('div',La,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('div',$a,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(Ae(e).length)+' 标签',1)]),Ae(e).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',ja,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(Ae(e).slice(0,3),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-export__tag'},(0,T.toDisplayString)(e),1))),128))])):(0,T.createCommentVNode)('v-if',!0)])]))),128))])])])):(0,T.createCommentVNode)('v-if',!0),E.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:3,class:'cardhub-theme cardhub-modal',onClick:(0,T.withModifiers)(Ze,['self'])},[(0,T.createElementVNode)('div',Fa,[(0,T.createElementVNode)('div',{class:'cardhub-theme__header'},[a[73]||(a[73]=(0,T.createElementVNode)('div',null,[(0,T.createElementVNode)('div',{class:'cardhub-theme__title'},'配色设置'),(0,T.createElementVNode)('div',{class:'cardhub-theme__subtitle'},'修改后可直接预览，保存到全局')],-1)),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Ze},'×')]),(0,T.createElementVNode)('div',Ha,[(0,T.createElementVNode)('label',Ia,[a[74]||(a[74]=(0,T.createElementVNode)('span',null,'背景渐变 1',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[48]||(a[48]=e=>N.bgStart=e),type:'color'},null,512),[[T.vModelText,N.bgStart]])]),(0,T.createElementVNode)('label',Pa,[a[75]||(a[75]=(0,T.createElementVNode)('span',null,'背景渐变 2',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[49]||(a[49]=e=>N.bgEnd=e),type:'color'},null,512),[[T.vModelText,N.bgEnd]])]),(0,T.createElementVNode)('label',Oa,[a[76]||(a[76]=(0,T.createElementVNode)('span',null,'卡片/面板底色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[50]||(a[50]=e=>N.surface=e),type:'color'},null,512),[[T.vModelText,N.surface]])]),(0,T.createElementVNode)('label',Ua,[a[77]||(a[77]=(0,T.createElementVNode)('span',null,'浅色底',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[51]||(a[51]=e=>N.surfaceAlt=e),type:'color'},null,512),[[T.vModelText,N.surfaceAlt]])]),(0,T.createElementVNode)('label',Ka,[a[78]||(a[78]=(0,T.createElementVNode)('span',null,'主文本',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[52]||(a[52]=e=>N.text=e),type:'color'},null,512),[[T.vModelText,N.text]])]),(0,T.createElementVNode)('label',Ra,[a[79]||(a[79]=(0,T.createElementVNode)('span',null,'次级文本',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[53]||(a[53]=e=>N.textMuted=e),type:'color'},null,512),[[T.vModelText,N.textMuted]])]),(0,T.createElementVNode)('label',Ya,[a[80]||(a[80]=(0,T.createElementVNode)('span',null,'强调色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[54]||(a[54]=e=>N.accent=e),type:'color'},null,512),[[T.vModelText,N.accent]])]),(0,T.createElementVNode)('label',Wa,[a[81]||(a[81]=(0,T.createElementVNode)('span',null,'强调深色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[55]||(a[55]=e=>N.accentStrong=e),type:'color'},null,512),[[T.vModelText,N.accentStrong]])]),(0,T.createElementVNode)('label',qa,[a[82]||(a[82]=(0,T.createElementVNode)('span',null,'边框',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[56]||(a[56]=e=>N.border=e),type:'color'},null,512),[[T.vModelText,N.border]])])]),(0,T.createElementVNode)('div',Ja,[((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(H,e=>(0,T.createElementVNode)('button',{key:e.name,class:'cardhub-theme__preset',type:'button',onClick:n=>function(e){Object.assign(N,e.value)}(e)},(0,T.toDisplayString)(e.name),9,Xa)),64))]),(0,T.createElementVNode)('div',{class:'cardhub-theme__actions'},[(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:Ge},'恢复默认'),a[83]||(a[83]=(0,T.createElementVNode)('div',{class:'cardhub-theme__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:Ze},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-primary',type:'button',onClick:Qe},'保存')])])])):(0,T.createCommentVNode)('v-if',!0)],6))}}),rr=ar;function tr(){const e=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.75) 100%\n        );\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow:\n          0 8px 18px rgba(var(--cardhub-accent-rgb), 0.25),\n          inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.82) 100%\n        );\n        color: var(--cardhub-accent-text);\n        box-shadow:\n          0 10px 22px rgba(var(--cardhub-accent-rgb), 0.3),\n          inset 0 1px 0 rgba(255, 255, 255, 0.65);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.92);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.75);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 2px;\n        width: 100%;\n        background: linear-gradient(\n          90deg,\n          rgba(var(--cardhub-border-rgb), 0) 0%,\n          rgba(var(--cardhub-border-rgb), 0.7) 50%,\n          rgba(var(--cardhub-border-rgb), 0) 100%\n        );\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        font-weight: 600;\n      }\n\n      .cardhub-section-title::before {\n        content: "";\n        width: 10px;\n        height: 10px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-accent-rgb), 0.6);\n        box-shadow:\n          0 0 0 2px rgba(var(--cardhub-accent-rgb), 0.2),\n          0 4px 8px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-border-rgb), 0.18),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.2),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.45);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        padding: 10px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.55);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.65);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n        border: 1px solid rgba(var(--cardhub-accent-rgb), 0.45);\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.2) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.95) 100%\n        );\n        color: var(--cardhub-accent-strong);\n        box-shadow:\n          0 8px 16px rgba(var(--cardhub-accent-rgb), 0.18),\n          inset 0 1px 0 rgba(255, 255, 255, 0.6);\n      }\n\n      .cardhub-chip--more:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.28) 0%,\n          rgba(var(--cardhub-surface-alt-rgb), 0.98) 100%\n        );\n        border-color: rgba(var(--cardhub-accent-rgb), 0.6);\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n        padding: 10px 12px;\n        border-radius: 16px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        box-shadow: 0 10px 18px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-filter-block + .cardhub-filter-block {\n        margin-top: 10px;\n        padding-top: 10px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__note {\n        margin-top: 6px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        word-break: break-word;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow:\n          0 10px 22px rgba(43, 32, 24, 0.22),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.35);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow:\n          0 10px 20px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__name {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-note-trigger {\n        border: none;\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-note-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-note-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__overview-action {\n        justify-self: start;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__detail-toggle {\n        justify-self: end;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 2px 0;\n      }\n\n      .cardhub-manage__toggle {\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.6);\n        box-shadow:\n          0 8px 18px rgba(43, 32, 24, 0.22),\n          inset 0 1px 0 rgba(255, 255, 255, 0.25);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 1) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.82) 100%\n        );\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 1);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__panel {\n        width: min(720px, 92vw);\n        max-width: 720px;\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-openings {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100004;\n      }\n\n      .cardhub-worldbook {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100005;\n      }\n\n      .cardhub-worldbook__panel {\n        width: min(720px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 10px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-worldbook__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-worldbook__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-worldbook__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-worldbook__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-worldbook__item-title {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-worldbook__item-disabled {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-worldbook__item-preview {\n        margin-top: 4px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-openings__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n        margin-bottom: 6px;\n      }\n\n      .cardhub-openings__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-openings__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 10px;\n      }\n\n      .cardhub-openings__list {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-openings__item {\n        text-align: left;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 14px;\n        padding: 10px 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-openings__item:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-openings__item-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-openings__item-preview {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-meta {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 8px;\n      }\n\n      .cardhub-manage__opening-meta-value {\n        color: var(--cardhub-text);\n        font-weight: 600;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-manage__opening-body {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-toggle {\n        margin-top: 6px;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__pager {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        margin-top: 8px;\n      }\n\n      .cardhub-manage__pager-btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__pager-btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-manage__pager-status {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-root .cardhub-modal {\n        position: fixed !important;\n        inset: 0 !important;\n        display: grid !important;\n        place-items: center !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        height: 100dvh !important;\n      }\n\n      .cardhub-root .cardhub-modal__panel {\n        position: fixed !important;\n        left: 50% !important;\n        top: 50% !important;\n        transform: translate(-50%, -50%) !important;\n        margin: 0 !important;\n      }\n\n      .cardhub-note {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-note__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-note__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-note__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-note__input {\n        width: 100%;\n        min-height: 120px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-note__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-note__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-note__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-manage-viewer {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-manage-viewer__panel {\n        width: min(620px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 24px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        position: relative;\n        display: grid;\n        gap: 12px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage-viewer__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-manage-viewer__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-manage-viewer__content {\n        font-size: 13px;\n        line-height: 1.6;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-note__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-note__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100011;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-strong-rgb), 0.98) 0%,\n          rgba(var(--cardhub-accent-strong-rgb), 0.78) 100%\n        );\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.55);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        z-index: 100005;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type=\'color\'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: linear-gradient(\n          135deg,\n          rgba(var(--cardhub-accent-rgb), 0.95) 0%,\n          rgba(var(--cardhub-accent-rgb), 0.72) 100%\n        );\n        color: var(--cardhub-accent-text);\n        border-color: rgba(var(--cardhub-accent-rgb), 0.55);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n          line-height: 1.2;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr;\n          gap: 10px;\n          align-items: start;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n          min-width: 0;\n          align-content: start;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__note {\n          font-size: 10px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__detail-toggle,\n        .cardhub-manage__toggle,\n        .cardhub-manage__opening-toggle {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__opening-title {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__opening-body {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__pager {\n          gap: 8px;\n        }\n\n        .cardhub-manage__pager-btn {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__pager-status {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-note__input {\n          min-height: 100px;\n          font-size: 12px;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type=\'color\'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-root .cardhub-modal {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: grid !important;\n          place-items: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root .cardhub-modal__panel {\n          position: fixed !important;\n          left: 50% !important;\n          top: 50% !important;\n          transform: translate(-50%, -50%) !important;\n          margin: 0 !important;\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n      }\n    ').appendTo('head'),n=$('<div>').attr('script_id',getScriptId()).addClass('cardhub-mount').appendTo('body'),a=(0,T.createApp)(rr);return a.mount(n[0]),(0,T.watch)(()=>D.open,()=>{},{immediate:!0}),{app:a,mount:n,style:e}}let or=null;function cr(){or||(or=tr())}function ir(){return{open:(e='manual')=>{cr(),A(!0,e)},close:()=>{A(!1)},toggle:(e='manual')=>{cr(),A(!D.open,e)},refresh:async()=>{cr(),await async function(){M(!0);try{L(await r()),j(V())}finally{M(!1)}}()},destroy:()=>{or&&function(e){e.app.unmount(),e.mount.remove(),e.style.remove()}(or),or=null}}}function lr(){const n=ir(),a=e(n);n.refresh(),$(window).on('pagehide',()=>{a(),n.destroy()})}$(()=>{errorCatched(lr)()});
//# sourceMappingURL=index.js.map