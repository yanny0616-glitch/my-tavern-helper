import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';function e(e){const t=[],r=function(e){const t=`cardhub-entry-${getScriptId()}`,r=$(`#${t}`);if(r.length)return r.addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').empty(),null;const o=function(){const e=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const n of e){const e=$(n).first();if(e.length)return e}const n=$('button, .menu_button, .nav_button').filter((_,e)=>{const n=$(e).text(),a=e.getAttribute('title')??e.getAttribute('aria-label')??'';return/角色管理/.test(n)||/角色管理/.test(a)}).first();if(n.length){const e=n.closest('nav, header, section, div');return e.length?e:n.parent()}return null}();if(!o)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const c=a(()=>e.open('role')),i=$('<button>').attr('id',t).attr('type','button').addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),c()});o.append(i);const l=n(i[0],c);return()=>{i.off('click'),i.remove(),l()}}(e);r&&t.push(r);const o=function(e){const t=`cardhub-magic-${getScriptId()}`,r=$('#extensionsMenuButton');if(!r.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const o=()=>{const r=$('#extensionsMenu');if(!r||r.find(`#${t}`).length)return;const o=a(()=>e.open('magic')),c=$('<div>').attr('id',t).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').html('<i class="fa-solid fa-id-badge" aria-hidden="true"></i><span>角色卡管理器</span>').on('click pointerup touchend',e=>{e.preventDefault(),e.stopImmediatePropagation(),o()});r.append(c);const i=n(c[0],o);c.data('cardhub-dispose',i)};r.on('click.cardhub',()=>{setTimeout(o,0)});const c=new MutationObserver(()=>o()),i=window.parent?.document??document;return c.observe(i.body,{childList:!0,subtree:!0}),()=>{c.disconnect(),r.off('click.cardhub'),$(`#${t}`).remove()}}(e);return o&&t.push(o),()=>{t.forEach(e=>e())}}function n(e,n){const a=e=>{e.preventDefault(),e.stopImmediatePropagation(),n()};return e.addEventListener('pointerdown',a,{capture:!0}),e.addEventListener('mousedown',a,{capture:!0}),e.addEventListener('touchstart',a,{capture:!0}),()=>{e.removeEventListener('pointerdown',a,{capture:!0}),e.removeEventListener('mousedown',a,{capture:!0}),e.removeEventListener('touchstart',a,{capture:!0})}}function a(e){let n=0;return()=>{const a=Date.now();a-n<250||(n=a,e())}}async function t(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const n='function'==typeof e?.getContext?e.getContext():null;if('function'==typeof n?.getCharacters)try{await n.getCharacters()}catch(e){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',e)}const a=n?.characters??SillyTavern?.characters??[],t=new Map,o=new Map,c=new Map;return Array.isArray(n?.tags)&&n.tags.forEach(e=>{e?.id&&e?.name&&c.set(e.id,e.name)}),a.map((e,a)=>{const i=e.tags??e.data?.tags??[],l=e.avatar,d=e.name??'未命名角色',s=e.create_date??e.date_added??e?.created??e?.created_at??e?.timestamp??e?.time??e.data?.create_date??e.data?.date_added??e?.data?.created??e?.data?.created_at??e?.data?.timestamp??e?.data?.time??null,u=r(s)??0,p=s??String(a),b=l??`name:${d}::${p}`;let h=b;if(!l){const e=o.get(b)??0;o.set(b,e+1),e&&(h=`${b}::${e}`)}const g=Boolean(n?.tagMap&&Object.prototype.hasOwnProperty.call(n.tagMap,h)),m=(g?n.tagMap[h]??[]:[]).map(e=>c.get(e)).filter(Boolean),f=g?m:i,v=l?`avatar:${l}`:`name:${d}::${p}`,x=t.get(v)??0;t.set(v,x+1);const y=x?`${v}::${x}`:v,w=e?.last_interaction??e?.last_interaction_time??e?.last_interaction_date??e?.last_chat_time??e?.last_chat_date??e?.last_message_time??e?.last_message_date??e?.update_time??e?.last_modified??e?.timestamp??e?.time??e?.data?.last_interaction??e?.data?.last_interaction_time??e?.data?.last_interaction_date??e?.data?.last_chat_time??e?.data?.last_chat_date??e?.data?.last_message_time??e?.data?.last_message_date??e?.data?.update_time??e?.data?.last_modified??e?.data?.timestamp??e?.data?.time??null;return{id:y,name:d,avatar:e.avatar??null,tags:f,tagKey:h,origin:'tavern',createdAt:u,lastChatAt:r(w)??0}})}function r(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function o(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const n=16*Math.random()|0;return('x'===e?n:3&n|8).toString(16)})}const c='cardhub_library';function i(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[c];if(n&&'object'==typeof n){return{entries:Array.isArray(n.entries)?n.entries:[]}}const a=TavernHelper.getVariables({type:'script',script_id:getScriptId()}),t=a?.[c];if(!t||'object'!=typeof t)return{entries:[]};const r=Array.isArray(t.entries)?t.entries:[];return r.length&&l(r),{entries:r}}function l(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({...n,[c]:{entries:e}},{type:'global'})}function d(e){return new Promise((n,a)=>{const t=new FileReader;t.onload=()=>n(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsDataURL(e)})}function s(e){return new Promise((n,a)=>{const t=new FileReader;t.onload=()=>n(String(t.result||'')),t.onerror=()=>a(t.error),t.readAsText(e)})}function u(e){try{return JSON.parse(e)}catch{return null}}function p(e){const n=e.trim();if(!n)return null;const a=u(n);if(a)return a;if(!function(e){return!(e.length<16||e.length%4!=0)&&/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const t=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return t?u(t):null}function b(e){const n=e?.tags??e?.data?.tags;return Array.isArray(n)?n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean):[]}function h(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}function g(e){return(new TextDecoder).decode(e)}function m(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function f(e){const n=e.indexOf(0);if(n<0)return null;const a=g(e.subarray(0,n)).trim(),t=g(e.subarray(n+1)).trim();return a&&t?{key:a,value:t}:null}function v(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=g(e.subarray(0,n)).trim(),t=1===e[n+1];let r=n+2;const o=e.indexOf(0,r);if(o<0)return null;r=o+1;const c=e.indexOf(0,r);if(c<0)return null;if(r=c+1,t)return null;const i=g(e.subarray(r)).trim();return a&&i?{key:a,value:i}:null}function x(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let t=8;for(;t+8<=e.length;){const n=m(e,t),r=g(e.subarray(t+4,t+8)),o=t+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===r){const e=f(i);e&&a.push(e)}else if('iTXt'===r){const e=v(i);e&&a.push(e)}t=c+4}return a}function y(e){const n=h(e);if(!n)return null;const a=x(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=p(e.value),a=n?.name??n?.data?.name;if('string'==typeof a&&a.trim())return a.trim()}return null}function w(e){const n=h(e);if(!n)return[];const a=x(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=p(e.value);if(n){const e=b(n);if(e.length)return e}}return[]}function k(e){const n=u(e);return n?b(n):[]}function C(e){return e.replace(/\.(png|json)$/i,'')}function E(e){if(null===e||'object'!=typeof e)return JSON.stringify(e);if(Array.isArray(e))return`[${e.map(e=>E(e)).join(',')}]`;return`{${Object.entries(e).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>`${JSON.stringify(e)}:${E(n)}`).join(',')}}`}function N(e,n){let a=n;if('json'===e){const e=n.trim();try{a=E(JSON.parse(e))}catch{a=e}}return`${e}:${function(e){let n=5381;for(let a=0;a<e.length;a+=1)n=33*n^e.charCodeAt(a);return(n>>>0).toString(16)}(a)}`}function V(){const e=i().entries;let n=!1;const a=Date.now(),t=e.map((t,r)=>{const o={...t,origin:t.origin??'library',tags:Array.isArray(t.tags)?t.tags:[],note:'string'==typeof t.note?t.note:''};if(!o.tagsEdited&&!o.tags.length&&o.raw&&o.rawType){const e='png'===o.rawType?w(o.raw):k(o.raw);e.length&&(o.tags=e,n=!0)}return'number'==typeof o.createdAt?o:(n=!0,{...o,createdAt:a-1e3*(e.length-1-r)})});return n&&l(t),t}async function S(e,n){const a=Array.from(e);if(!a.length)return V();const t=Array.isArray(n)&&n.length?n:V(),r=new Set;t.forEach(e=>{const n=function(e){if(e.fingerprint)return e.fingerprint;if(!e.rawType||!e.raw)return null;const n=N(e.rawType,e.raw);return e.fingerprint=n,n}(e);n&&r.add(n)});const c=[];for(const e of a){const n=C(e.name);if(e.name.toLowerCase().endsWith('.png')){const a=await d(e),t=y(a)??n,i=w(a),l=N('png',a);if(r.has(l))continue;r.add(l),c.push({id:o(),name:t,avatar:a,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'png',raw:a,fingerprint:l,createdAt:Date.now()})}else if(e.name.toLowerCase().endsWith('.json')){const a=await s(e);let t=n;try{const e=JSON.parse(a);t=e.name??e.data?.name??t}catch{}const i=k(a),l=N('json',a);if(r.has(l))continue;r.add(l),c.push({id:o(),name:t,avatar:null,tags:i,origin:'library',note:'',importFileName:e.name,rawType:'json',raw:a,fingerprint:l,createdAt:Date.now()})}}const i=[...t,...c];return l(i),i}function B(e){const n=V().filter(n=>n.id!==e);return l(n),n}const T=Vue,A=(0,T.reactive)({open:!1,loading:!1,lastOpenSource:'manual',characters:[],library:[]});function D(e,n){A.open=e,n&&(A.lastOpenSource=n)}function M(e){A.loading=e}function L(e){A.characters=e}function j(e){A.library=e.map(e=>({...e,origin:e.origin??'library',tags:Array.isArray(e.tags)?e.tags:[],note:'string'==typeof e.note?e.note:''}))}function F(){let e;try{e=window.parent?.SillyTavern}catch{e=void 0}return e??=SillyTavern,'function'!=typeof e?.getContext?null:e.getContext()}function H(e){Array.isArray(e.tags)||(e.tags=[]),e.tagMap||(e.tagMap={})}function I(e){if('library'===e.origin)return e.tags??[];const n=function(e){if(!e)return{hasKey:!1,tags:[]};const n=F();if(!n||!n.tagMap||!Array.isArray(n.tags))return{hasKey:!1,tags:[]};if(!Object.prototype.hasOwnProperty.call(n.tagMap,e))return{hasKey:!1,tags:[]};const a=new Map;return n.tags.forEach(e=>{e?.id&&e?.name&&a.set(e.id,e.name)}),{hasKey:!0,tags:(n.tagMap[e]??[]).map(e=>a.get(e)).filter(Boolean)}}(e.tagKey??e.avatar);return n.hasKey?n.tags:e.tags??[]}function P(e,n){const a=F();if(!a)return n;const t=function(e,n){if(!Array.isArray(e.characters))return null;const a=n.avatar?e.characters.find(e=>e.avatar===n.avatar):null;return a||(e.characters.find(e=>e.name===n.name)??null)}(a,e);if(!t)return n;const r=Array.from(new Set(n.map(e=>e.trim().replace(/\s+/g,' ')).filter(Boolean)));t.tags=r,t.data&&(t.data.tags=r),H(a);const o=r.map(e=>function(e,n){H(e);const a=e.tags.find(e=>e.name===n);if(a)return a;const t={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:n};return e.tags.push({id:t.id,name:t.name}),t}(a,e).id),c=e.tagKey??t.avatar??null;c&&(a.tagMap[c]=o),a.saveSettingsDebounced?.();const i=window.parent?.SillyTavern??SillyTavern;return i?.saveSettingsDebounced?.(),r}const O={class:'cardhub-manage__section'},U={key:0,class:'cardhub-manage__details'},K={class:'cardhub-manage__detail-label'},R={class:'cardhub-manage__detail-content'},Y=['onClick'],q={key:1,class:'cardhub-manage__empty'},J={class:'cardhub-manage__section'},W={class:'cardhub-manage__label'},X={class:'cardhub-manage__content'},Z={key:0,class:'cardhub-manage__empty'},G={key:1},Q={class:'cardhub-manage__opening-title'},ee={class:'cardhub-manage__opening-body'},ne=['onClick'],ae={class:'cardhub-manage__section'},te={class:'cardhub-manage__label'},re={class:'cardhub-manage__jump-row'},oe={key:0,class:'cardhub-manage__chat'},ce=['onClick','onKeydown'],ie={class:'cardhub-manage__chat-main'},le={class:'cardhub-manage__chat-name'},de={key:0,class:'cardhub-manage__chat-label'},se={class:'cardhub-manage__chat-text'},ue={key:1,class:'cardhub-manage__empty'},pe={key:2,class:'cardhub-manage__pager'},be=['disabled'],he={class:'cardhub-manage__pager-status'},ge=['disabled'],me={class:'cardhub-manage__actions'},fe=(0,T.defineComponent)({__name:'ManageContent',props:{manageCard:{},manageDetails:{},manageDetailsHint:{},openingItems:{},manageChats:{},pagedChats:{},chatPage:{},chatTotalPages:{},manageChatHint:{},openDetail:{type:Function},openOpening:{type:Function},openLatestChat:{type:Function},openNewChat:{type:Function},openChat:{type:Function},prevChatPage:{type:Function},nextChatPage:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function}},setup(e){const n=e,a=(0,T.ref)(!1);function t(){a.value=!a.value}return(0,T.watch)(()=>[n.manageDetails,n.openingItems],()=>{a.value=!1}),(n,r)=>((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,[(0,T.createElementVNode)('div',O,[r[18]||(r[18]=(0,T.createElementVNode)('div',{class:'cardhub-manage__label'},'角色卡预览',-1)),e.manageDetails.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',U,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.manageDetails,n=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:n.label,class:'cardhub-manage__detail'},[(0,T.createElementVNode)('div',K,(0,T.toDisplayString)(n.label),1),(0,T.createElementVNode)('div',R,(0,T.toDisplayString)(n.preview),1),n.hasMore?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-manage__detail-toggle',type:'button',onClick:a=>e.openDetail(n)},' 查看 ',8,Y)):(0,T.createCommentVNode)('v-if',!0)]))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',q,(0,T.toDisplayString)(e.manageDetailsHint),1))]),(0,T.createElementVNode)('div',J,[(0,T.createElementVNode)('div',W,[r[19]||(r[19]=(0,T.createElementVNode)('span',null,'开场白',-1)),e.openingItems.length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-manage__toggle',type:'button',onClick:t},(0,T.toDisplayString)(a.value?'收起列表':`展开列表（${e.openingItems.length}）`),1)):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('div',X,[e.openingItems.length?((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,{key:0},[a.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',G,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.openingItems,n=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:n.id,class:'cardhub-manage__opening'},[(0,T.createElementVNode)('div',Q,'开场白 '+(0,T.toDisplayString)(n.id+1),1),(0,T.createElementVNode)('div',ee,(0,T.toDisplayString)(n.preview),1),(0,T.createElementVNode)('button',{class:'cardhub-manage__opening-toggle',type:'button',onClick:a=>e.openOpening(n)},'查看',8,ne)]))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',Z,'点击“展开列表”查看开场白'))],64)):((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,{key:1},[(0,T.createTextVNode)('暂无开场白')],64))])]),(0,T.createElementVNode)('div',ae,[(0,T.createElementVNode)('div',te,[r[20]||(r[20]=(0,T.createElementVNode)('span',null,'最近聊天',-1)),(0,T.createElementVNode)('div',re,[(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:r[0]||(r[0]=(...n)=>e.openLatestChat&&e.openLatestChat(...n)),onPointerdown:r[1]||(r[1]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:r[2]||(r[2]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:r[3]||(r[3]=(0,T.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32),(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:r[4]||(r[4]=(...n)=>e.openNewChat&&e.openNewChat(...n)),onPointerdown:r[5]||(r[5]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:r[6]||(r[6]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:r[7]||(r[7]=(0,T.withModifiers)(()=>{},['stop']))},' 新聊天 ',32)])]),e.pagedChats.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',oe,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.pagedChats,(n,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:a,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:a=>e.openChat(n),onKeydown:(0,T.withKeys)((0,T.withModifiers)(a=>e.openChat(n),['prevent']),['enter'])},[(0,T.createElementVNode)('div',ie,[(0,T.createElementVNode)('div',le,(0,T.toDisplayString)(n.name),1),n.label&&n.label!==n.name?((0,T.openBlock)(),(0,T.createElementBlock)('div',de,(0,T.toDisplayString)(n.label),1)):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('span',se,(0,T.toDisplayString)(n.mes),1)],40,ce))),128))])):((0,T.openBlock)(),(0,T.createElementBlock)('div',ue,(0,T.toDisplayString)(e.manageChatHint),1)),e.chatTotalPages>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',pe,[(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage<=1,onClick:r[8]||(r[8]=(...n)=>e.prevChatPage&&e.prevChatPage(...n))},' 上一页 ',8,be),(0,T.createElementVNode)('span',he,(0,T.toDisplayString)(e.chatPage)+' / '+(0,T.toDisplayString)(e.chatTotalPages),1),(0,T.createElementVNode)('button',{class:'cardhub-manage__pager-btn',type:'button',disabled:e.chatPage>=e.chatTotalPages,onClick:r[9]||(r[9]=(...n)=>e.nextChatPage&&e.nextChatPage(...n))},' 下一页 ',8,ge)])):(0,T.createCommentVNode)('v-if',!0)]),(0,T.createElementVNode)('div',me,[(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:r[10]||(r[10]=(0,T.withModifiers)(n=>e.handleCardAction(e.manageCard),['stop'])),onPointerdown:r[11]||(r[11]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:r[12]||(r[12]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:r[13]||(r[13]=(0,T.withModifiers)(()=>{},['stop']))},(0,T.toDisplayString)('tavern'===e.manageCard.origin?'导出':'导入'),33),(0,T.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:r[14]||(r[14]=(0,T.withModifiers)(n=>e.manageDelete(e.manageCard),['stop'])),onPointerdown:r[15]||(r[15]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:r[16]||(r[16]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:r[17]||(r[17]=(0,T.withModifiers)(()=>{},['stop']))},' 删除 ',32)])],64))}}),ve={class:'cardhub-manage__top'},xe={class:'cardhub-manage__summary'},_e={class:'cardhub-preview__name'},ye={class:'cardhub-preview__meta'},we={class:'cardhub-preview__tags'},ke={class:'cardhub-manage__overview'},Ce={class:'cardhub-manage__overview-label'},Ee={class:'cardhub-manage__overview-value'},Ne={key:0,class:'cardhub-manage__overview-hint'},Ve={class:'cardhub-manage__media'},Se=['src'],Be=(0,T.defineComponent)({__name:'ManageOverview',props:{manageCard:{},manageAvatarUrl:{},manageOverview:{},displayTags:{type:Function},openNoteDialog:{type:Function}},setup:e=>(n,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',ve,[(0,T.createElementVNode)('div',xe,[(0,T.createElementVNode)('div',_e,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.manageCard.name),1),(0,T.createElementVNode)('button',{class:'cardhub-note-trigger',type:'button','aria-label':'编辑备注',onClick:a[0]||(a[0]=(...n)=>e.openNoteDialog&&e.openNoteDialog(...n))},[...a[1]||(a[1]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-pen','aria-hidden':'true'},null,-1)])])]),(0,T.createElementVNode)('div',ye,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.manageCard.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.displayTags(e.manageCard).length)+' 标签',1)]),(0,T.createElementVNode)('div',we,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.displayTags(e.manageCard),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-preview__tag'},(0,T.toDisplayString)(e),1))),128))]),(0,T.createElementVNode)('div',ke,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(e.manageOverview,e=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:e.label,class:'cardhub-manage__overview-card'},[(0,T.createElementVNode)('div',Ce,(0,T.toDisplayString)(e.label),1),(0,T.createElementVNode)('div',Ee,(0,T.toDisplayString)(e.value),1),e.hint?((0,T.openBlock)(),(0,T.createElementBlock)('div',Ne,(0,T.toDisplayString)(e.hint),1)):(0,T.createCommentVNode)('v-if',!0)]))),128))])]),(0,T.createElementVNode)('div',Ve,[e.manageAvatarUrl?((0,T.openBlock)(),(0,T.createElementBlock)('img',{key:0,src:e.manageAvatarUrl,alt:''},null,8,Se)):(0,T.createCommentVNode)('v-if',!0)])]))}),Te={class:'cardhub-manage__panel cardhub-modal__panel',role:'dialog','aria-label':'角色管理'},ze={class:'cardhub-note__panel cardhub-modal__panel',role:'dialog','aria-label':'备注'},Ae=['aria-label'],De={class:'cardhub-manage-viewer__header'},Me={class:'cardhub-manage-viewer__title'},Le=['innerHTML'],$e=(0,T.defineComponent)({__name:'ManageModal',props:{card:{},displayTags:{type:Function},handleCardAction:{type:Function},manageDelete:{type:Function},closeManage:{type:Function},closeRoot:{type:Function},applyNoteUpdate:{type:Function},parseLibraryCardData:{type:Function},updateLastChatCacheForCard:{type:Function}},setup(e){const n=e,a=(0,T.computed)(()=>n.card),t=(0,T.ref)([]),r=(0,T.ref)(null),o=(0,T.ref)(null),c=(0,T.ref)([]),i=(0,T.ref)(null),l=(0,T.computed)(()=>a.value?function(e,n=!1){const a=e.avatar;if(!a)return null;if(/^(data:|https?:|\/)/.test(a))return a;if(n&&'tavern'===e.origin)return TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`;return`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`}(a.value,!0):null),d=(0,T.computed)(()=>!a.value||p.value.length?'':'library'===a.value.origin?'未导入卡片暂无可预览内容，可先导入后查看详情。':'暂无角色卡详情。'),s=(0,T.computed)(()=>'library'===a.value?.origin?'未导入卡片暂无聊天记录。':'暂无聊天记录。'),u=(0,T.computed)(()=>{const e=[],n=r.value,a=n?.worldBookName?.trim()||'',t=n?.worldBookCount;let c='未绑定',l='';(a||'number'==typeof t)&&(c=a||'角色世界书',l='number'==typeof t?`${t} 条`:''),e.push({label:'世界书',value:c,hint:l});const d=i.value;let s='暂无聊天',u='';d&&d.total>0&&(s=`${d.total} 个聊天`,d.latest&&(u=`最近：${d.latest}`)),e.push({label:'聊天概况',value:s,hint:u});const p=o.value;let b='暂无开场白',h='';return p&&p.total>0&&(b=`${p.total} 条`,h=p.alternate>0?`替代：${p.alternate} 条`:'无替代'),e.push({label:'开场白',value:b,hint:h}),e}),p=(0,T.computed)(()=>{const e=[],n=r.value,t=(n,a,t=240)=>{const r=function(e,n,a){const t=e.replace(/\r/g,'').trim();if(!t)return'';const r=re(t),o=r.length?r:oe(G(t),60);let c=o.slice(0,n).join('\n').trim();if(!c)return'';const i=c.length>a;i&&(c=c.slice(0,a).trim());const l=i||o.length>n||t.length>c.length;l&&!c.endsWith('…')&&(c=`${c}…`);return c}(a,3,t);r&&e.push({label:n,preview:r,full:a.trim(),hasMore:r!==a.trim()})};return'library'===a.value?.origin&&a.value.importFileName&&t('导入文件名',a.value.importFileName,120),a.value?.note?.trim()&&t('备注',a.value.note.trim(),200),n&&(t('角色描述',n.description??''),t('性格',n.personality??''),t('场景',n.scenario??''),t('创作者备注',n.creatorNotes??''),t('系统提示',n.systemPrompt??'',200),t('历史指令',n.postHistory??'',200),t('作者',n.creator??'',80)),e}),b=(0,T.computed)(()=>t.value.map((e,n)=>({id:n,preview:Q(e,2).join('\n'),html:ee(e)}))),h=(0,T.ref)(1),g=(0,T.computed)(()=>Math.max(1,Math.ceil(c.value.length/6))),m=(0,T.computed)(()=>{const e=6*(h.value-1);return c.value.slice(e,e+6)}),f=(0,T.ref)(!1),v=(0,T.ref)(''),x=(0,T.ref)(!1),y=(0,T.ref)(''),w=(0,T.ref)('');let k=0;function C(){h.value>1&&(h.value-=1)}function E(){h.value<g.value&&(h.value+=1)}function N(){a.value&&(v.value=a.value.note??'',f.value=!0)}function V(){f.value=!1}function S(){a.value&&(n.applyNoteUpdate(a.value,v.value),f.value=!1)}function B(e){y.value=e.label,w.value=ae(e.full||e.preview),x.value=!0}function A(e){y.value=`开场白 ${e.id+1}`,w.value=e.html||ae(e.preview),x.value=!0}function D(){x.value=!1}async function M(e){if('tavern'!==e.origin){const a=n.parseLibraryCardData(e);return{openings:W(a),profile:Y(a),openingSummary:J(a)}}const a=await async function(e){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const a='function'==typeof n?.getContext?n.getContext():null;if(a?.getCharacters)try{await a.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色卡列表失败',e)}const t=a?.characters??n?.characters??[];if(!t.length)return null;const r=e.avatar?t.findIndex(n=>n.avatar===e.avatar||n.name===e.avatar):-1,o=t.findIndex(n=>n.name===e.name),c=r>=0?r:o;if(c<0)return null;if(a?.unshallowCharacter)try{await a.unshallowCharacter(c)}catch(e){console.warn('[CardHub] 读取角色卡详情失败',e)}const i=(a?.characters??t)[c]??null;if(i?.first_mes||i?.data?.first_mes)return i;if(a?.getCharacterCardFields)try{const e=await a.getCharacterCardFields({chid:c});if(e?.first_mes||e?.data?.first_mes)return e}catch(e){console.warn('[CardHub] 读取角色卡字段失败',e)}const l=TavernHelper.getCharData(e.avatar??e.name,!0);return l??i}(e),t=a??TavernHelper.RawCharacter?.find({name:e.avatar??e.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:e.name,allowAvatar:!0}),r=a??t;let o=W(r);!o.length&&t&&t!==r&&(o=W(t));const c=J(r??t);return{openings:o,profile:Y(r??t),openingSummary:c}}async function L(e){if('tavern'!==e.origin)return{list:[],summary:null};const a=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0);if(!Array.isArray(a)||!a.length)return{list:[],summary:{total:0,latest:''}};const t=function(e){return[...e].sort((e,n)=>(ie(n)??0)-(ie(e)??0))}(a),r=ie(t[0])??0;n.updateLastChatCacheForCard(e,r);const o=t.map(e=>({name:X(e),label:Z(e),file:String(e?.file_name??e?.file_id??''),mes:G(String(e?.mes??'')).slice(0,120)})),c=ce(t[0]);return{list:o,summary:{total:a.length,latest:c}}}async function j(){c.value.length?await H(c.value[0]):toastr.warning('暂无聊天记录')}async function F(){if(await I({ensureSelected:!0}))try{await triggerSlash('/newchat'),n.closeManage(),n.closeRoot()}catch(e){console.warn('[CardHub] 新聊天失败',e),toastr.error('无法创建新聊天')}}async function H(e){const a=e.file;if(!a)return void toastr.warning('未找到聊天文件');const t=await I({ensureSelected:!0});if(!t)return;const{ctx:r,st:o}=t,c=O(a),i=(r&&'function'==typeof r.openCharacterChat?r.openCharacterChat:null)??(o&&'function'==typeof o.openCharacterChat?o.openCharacterChat:null);if(!i)return void toastr.error('无法打开聊天：缺少接口');try{Promise.resolve(i(c)).catch(e=>{console.warn('[CardHub] 打开聊天失败',e)})}catch(e){console.warn('[CardHub] 打开聊天失败',e)}const l=await async function(e,n,a,t){const r=O(e),o=Date.now();for(;Date.now()-o<t;){if((n?.chatId??a?.chatId)===r)return!0;await U(200)}return!1}(c,r,o,6e3);if(l)return n.closeManage(),void n.closeRoot();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}async function I(e={}){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const t='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof t?.getCharacters)try{await t.getCharacters()}catch(e){console.warn('[CardHub] 刷新角色列表失败',e)}const r=t?.characters??n?.characters??[],o=a.value&&Array.isArray(r)?function(e,n){const a=K(n.name),t=n.avatar?R(n.avatar):'',r=t?e.findIndex(e=>R(String(e.avatar??''))===t):-1;if(r>=0)return r;const o=e.findIndex(e=>K(String(e.name??''))===a);if(o>=0)return o;return e.findIndex(e=>K(String(e?.data?.name??''))===a)}(r,a.value):-1;if(o<0)return toastr.warning('未找到角色索引，请先手动切到该角色后再试'),null;const c=(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null)??(n&&'function'==typeof n.selectCharacterById?n.selectCharacterById:null);if(!c)return toastr.warning('无法切换角色，请先手动切到该角色后再试'),null;try{await c(o,{switchMenu:!1})}catch(e){console.warn('[CardHub] 切换角色失败',e)}const i=await async function(e,n,a,t){const r=String(e),o=Date.now();for(;Date.now()-o<t;){if(P(n,a)===r)return!0;await U(80)}return!1}(o,t,n,3e3);return e.ensureSelected&&!i?(toastr.warning('角色切换未完成，请稍后再试'),null):{ctx:t,st:n,idx:o}}function P(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}function O(e){return e.endsWith('.jsonl')?e:`${e}.jsonl`}function U(e){return new Promise(n=>setTimeout(n,e))}function K(e){return e.trim().toLocaleLowerCase()}function R(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}return n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n),n.trim().toLowerCase()}function Y(e){if(!e)return null;const n={description:q(e?.description,e?.data?.description),personality:q(e?.personality,e?.data?.personality),scenario:q(e?.scenario,e?.data?.scenario),creatorNotes:q(e?.creatorcomment,e?.data?.creatorcomment,e?.creator_notes,e?.data?.creator_notes),systemPrompt:q(e?.system_prompt,e?.data?.system_prompt),postHistory:q(e?.post_history_instructions,e?.data?.post_history_instructions),creator:q(e?.creator,e?.data?.creator)},a=e?.character_book??e?.data?.character_book;a&&(n.worldBookName=q(a?.name),n.worldBookCount=Array.isArray(a?.entries)?a.entries.length:void 0);return Boolean(n.description)||Boolean(n.personality)||Boolean(n.scenario)||Boolean(n.creatorNotes)||Boolean(n.systemPrompt)||Boolean(n.postHistory)||Boolean(n.creator)||Boolean(n.worldBookName)||'number'==typeof n.worldBookCount?n:null}function q(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function J(e){if(!e)return null;const n='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes,a='string'==typeof n&&n.trim()?1:0,t=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;let r=0;return Array.isArray(t)?r=t.filter(e=>'string'==typeof e&&e.trim()).length:'string'==typeof t&&t.trim()&&(r=1),{total:a+r,alternate:r}}function W(e){if(!e)return[];const n=[],a='string'==typeof e?.first_mes?e.first_mes:e?.data?.first_mes;'string'==typeof a&&a.trim()&&n.push(a.trim());const t=e?.alternate_greetings??e?.data?.alternate_greetings??e?.extensions?.alternate_greetings??e?.data?.extensions?.alternate_greetings;return Array.isArray(t)?t.forEach(e=>{'string'==typeof e&&e.trim()&&n.push(e.trim())}):'string'==typeof t&&t.trim()&&n.push(t.trim()),n}function X(e){return ce(e)||'聊天记录'}function Z(e){const n=q(e?.file_name,e?.file_id);return n?n.replace(/\.jsonl$/i,''):''}function G(e){return e.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}function Q(e,n){const a=e.replace(/\r/g,'').trim();if(!a)return[];const t=re(a);if(t.length>=n)return t.slice(0,n);const r=G(a);if(!r)return t.slice(0,n);const o=oe(r,60);if(!t.length)return o.slice(0,n);const c=[...t];for(const e of o){if(c.length>=n)break;c[0]!==e&&c.push(e)}return c.slice(0,n)}function ee(e){const n=te(e).trim();return n?/<\/?[a-z][\s\S]*>/i.test(n)?n:ne(n).replace(/\n/g,'<br>'):''}function ne(e){return e.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}function ae(e){const n=te(e).trim();return n?ne(n).replace(/\n/g,'<br>'):''}function te(e){return e.replace(/^\s*```[a-zA-Z0-9_-]*\s*$/gm,'').replace(/^\s*```\s*$/gm,'')}function re(e){const n=e.split('\n').map(e=>e.trim()).filter(e=>e.length>0),a=[];for(const e of n)e.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(e)||a.push(e);return a}function oe(e,n){const a=[];for(let t=0;t<e.length;t+=n){const r=e.slice(t,t+n).trim();r&&a.push(r)}return a}function ce(e){return q(e?.chat_name,e?.chat_title,e?.name,e?.file_name,e?.file_id)}function ie(e){return function(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}(e?.last_message_time??e?.last_message_date??e?.last_message_timestamp??e?.last_chat_time??e?.last_chat_date??e?.last_interaction??e?.update_time??e?.timestamp??e?.time??null)??function(e){const n=e.replace(/\.jsonl$/i,'').trim(),a=/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/,t=n.match(a);if(!t)return null;const r=Number(t[1]),o=Number(t[2]),c=Number(t[3]),i=t[4]?Number(t[4]):0,l=t[5]?Number(t[5]):0,d=t[6]?Number(t[6]):0;if(!r||!o||!c)return null;const s=new Date(r,o-1,c,i,l,d).getTime();return Number.isNaN(s)?null:s}(String(e?.file_name??e?.file_id??''))}return(0,T.watch)(a,e=>{if(!e)return t.value=[],r.value=null,o.value=null,c.value=[],i.value=null,h.value=1,f.value=!1,v.value='',x.value=!1,y.value='',void(w.value='');!async function(e){const n=++k;t.value=[],c.value=[],r.value=null,o.value=null,i.value=null,h.value=1;const[l,d]=await Promise.allSettled([M(e),L(e)]);if(n!==k||a.value?.id!==e.id)return;const s='fulfilled'===l.status?l.value:{openings:[],profile:null,openingSummary:null};t.value=s.openings,r.value=s.profile,o.value=s.openingSummary;const u='fulfilled'===d.status?d.value:{list:[],summary:null};c.value=u.list,i.value=u.summary}(e)},{immediate:!0}),(n,t)=>((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,[a.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:0,class:'cardhub-manage cardhub-modal',onClick:t[1]||(t[1]=(0,T.withModifiers)((...n)=>e.closeManage&&e.closeManage(...n),['self']))},[(0,T.createElementVNode)('div',Te,[(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:t[0]||(t[0]=(...n)=>e.closeManage&&e.closeManage(...n))},'×'),(0,T.createVNode)(Be,{'manage-card':a.value,'manage-avatar-url':l.value,'manage-overview':u.value,'display-tags':e.displayTags,'open-note-dialog':N},null,8,['manage-card','manage-avatar-url','manage-overview','display-tags']),(0,T.createVNode)(fe,{'manage-card':a.value,'manage-details':p.value,'manage-details-hint':d.value,'opening-items':b.value,'manage-chats':c.value,'paged-chats':m.value,'chat-page':h.value,'chat-total-pages':g.value,'manage-chat-hint':s.value,'open-detail':B,'open-opening':A,'open-latest-chat':j,'open-new-chat':F,'open-chat':H,'prev-chat-page':C,'next-chat-page':E,'handle-card-action':e.handleCardAction,'manage-delete':e.manageDelete},null,8,['manage-card','manage-details','manage-details-hint','opening-items','manage-chats','paged-chats','chat-page','chat-total-pages','manage-chat-hint','handle-card-action','manage-delete'])])])):(0,T.createCommentVNode)('v-if',!0),f.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-note cardhub-modal',onClick:(0,T.withModifiers)(V,['self'])},[(0,T.createElementVNode)('div',ze,[(0,T.createElementVNode)('div',{class:'cardhub-note__header'},[t[3]||(t[3]=(0,T.createElementVNode)('div',{class:'cardhub-note__title'},'备注',-1)),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:V},'×')]),(0,T.withDirectives)((0,T.createElementVNode)('textarea',{'onUpdate:modelValue':t[2]||(t[2]=e=>v.value=e),class:'cardhub-note__input',placeholder:'填写备注内容'},null,512),[[T.vModelText,v.value]]),(0,T.createElementVNode)('div',{class:'cardhub-note__actions'},[(0,T.createElementVNode)('button',{class:'cardhub-note__btn is-secondary',type:'button',onClick:V},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-note__btn is-primary',type:'button',onClick:S},'保存')])])])):(0,T.createCommentVNode)('v-if',!0),x.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:2,class:'cardhub-manage-viewer cardhub-modal',onClick:(0,T.withModifiers)(D,['self'])},[(0,T.createElementVNode)('div',{class:'cardhub-manage-viewer__panel cardhub-modal__panel',role:'dialog','aria-label':y.value},[(0,T.createElementVNode)('div',De,[(0,T.createElementVNode)('div',Me,(0,T.toDisplayString)(y.value),1),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:D},'×')]),(0,T.createElementVNode)('div',{class:'cardhub-manage-viewer__content',innerHTML:w.value},null,8,Le)],8,Ae)])):(0,T.createCommentVNode)('v-if',!0)],64))}});function je(e){const n=(0,T.ref)(!1),a=(0,T.ref)('filter'),t=(0,T.ref)([]),r=(0,T.ref)(''),o=(0,T.ref)(''),c=(0,T.ref)([]),i=(0,T.computed)(()=>e.filteredCharacters.value),l=(0,T.computed)(()=>{const n=r.value.trim().toLowerCase();return n?i.value.filter(a=>{if(a.name.toLowerCase().includes(n))return!0;return e.displayTags(a).some(e=>e.toLowerCase().includes(n))}):i.value}),d=(0,T.computed)(()=>new Set(t.value)),s=(0,T.computed)(()=>e.allTags.value);return{tagManagerOpen:n,tagManagerTab:a,openTagManager:function(e='filter'){if('batch'===e){if(!l.value.length)return void toastr.warning('当前没有可操作的角色卡');o.value='',r.value='',c.value=[],t.value=l.value.map(e=>e.id)}a.value=e,n.value=!0},closeTagManager:function(){n.value=!1},batchTagSelectedIds:t,batchTagSearch:r,batchTagInput:o,batchTagSelectedTags:c,batchTagSelectedSet:d,batchTagVisibleCandidates:l,batchTagSuggestions:s,toggleBatchTagSelection:function(e){d.value.has(e)?t.value=t.value.filter(n=>n!==e):t.value=[...t.value,e]},selectAllBatchTags:function(){t.value=l.value.map(e=>e.id)},clearBatchTagSelection:function(){t.value=[]},toggleBatchTagSuggestion:function(e){c.value.includes(e)?c.value=c.value.filter(n=>n!==e):c.value=[...c.value,e]},applyBatchTags:async function(n){if(!t.value.length)return void toastr.warning('请先选择要操作的角色卡');const a=function(e,n){const a=e.split(/[,，\n;；、]/).map(e=>e.trim()).filter(Boolean);return Array.from(new Set([...a,...n]))}(o.value,c.value);if(!a.length)return void toastr.warning('请输入要操作的标签');const r='add'===n?'添加':'移除',i=`将${r}标签：${a.join('、')}\n应用到 ${t.value.length} 张角色卡，是否继续？`;if('confirm'!==await e.openConfirm({title:`批量${r}标签`,message:i,confirmLabel:`继续${r}`,cancelLabel:'取消'}))return;const l=function(n){const a=new Map(e.allCards.value.map(e=>[e.id,e]));return n.map(e=>a.get(e)).filter(Boolean)}(t.value);let d=0;l.forEach(t=>{const r=e.displayTags(t),o=new Set(r);'add'===n?a.forEach(e=>o.add(e)):a.forEach(e=>o.delete(e));const c=Array.from(o);(function(e,n){if(e.length!==n.length)return!1;const a=new Set(e);return n.every(e=>a.has(e))})(r,c)||(e.applyTagUpdate(t,c),d+=1)}),toastr.success(`已处理 ${d} 张角色卡`)}}}function Fe(e){const n=(0,T.ref)(null),a=(0,T.ref)(!1),t=(0,T.ref)([]),r=(0,T.ref)(''),o=(0,T.ref)('all'),c=(0,T.ref)([]),i=(0,T.computed)(()=>[...e.allCards.value]),l=(0,T.computed)(()=>{const e=new Set;return i.value.forEach(n=>{(n.tags??[]).forEach(n=>e.add(n))}),c.value.forEach(n=>e.add(n)),Array.from(e).sort((e,n)=>e.localeCompare(n,'zh-CN'))}),d=(0,T.computed)(()=>{let e=i.value;'imported'===o.value?e=e.filter(e=>'tavern'===e.origin):'unimported'===o.value&&(e=e.filter(e=>'library'===e.origin)),c.value.length&&(e=e.filter(e=>c.value.some(n=>(e.tags??[]).includes(n))));const n=r.value.trim().toLowerCase();return n?e.filter(e=>{if(e.name.toLowerCase().includes(n))return!0;return(e.tags??[]).some(e=>e.toLowerCase().includes(n))}):e}),s=(0,T.computed)(()=>new Set(t.value)),u=(0,T.computed)(()=>i.value.filter(e=>s.value.has(e.id)));function p(){a.value=!0,t.value=d.value.map(e=>e.id)}async function b(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const a=function(n){const a=e.normalizeNameKey(n);return a?e.getCharacters().find(n=>e.normalizeNameKey(n.name)===a)??null:null}(n.name);if(a)return void toastr.warning(`已存在同名角色「${a.name}」，已跳过导入`);const t=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};delete t['Content-Type'];const r=await e.fetchCharacterSummaries(),o=new Set(r.map(n=>e.normalizeAvatarKey(n.avatar??'')).filter(Boolean));if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);await TavernHelper.importRawCharacter(n.name,a)}else{const e=new File([n.raw],`${n.name}.json`,{type:'application/json'}),a=new FormData;a.append('avatar',e),a.append('file_type','json'),a.append('preserved_name',e.name),await fetch('/api/characters/import',{method:'POST',headers:t,body:a,cache:'no-cache'})}const c=await e.fetchCharacterSummaries(),i=new Set([n.name]);if('json'===n.rawType)try{const e=JSON.parse(n.raw);e?.name&&i.add(e.name),e?.data?.name&&i.add(e.data.name)}catch{}const l=c.find(n=>{const a=e.normalizeAvatarKey(n.avatar??'');return a&&!o.has(a)}),d=c.find(n=>Array.from(i).some(a=>e.normalizeNameKey(n.name)===e.normalizeNameKey(a))),s=l??d??null;if(s){e.setLibrary(e.removeFromLibrary(n.id));const a=n.tags?.length?n.tags:e.extractCardTagsFromData(e.parseLibraryCardData(n));if(a.length){const n=e.updateCharacterTags(s,a);s.tags=n}toastr.success(`已导入 ${n.name}`)}else toastr.warning(`导入完成但未在角色列表中找到「${n.name}」，已保留未导入记录`);e.setCharacters(c)}async function h(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){const a=await e.dataUrlToBlob(n.raw);return void e.downloadBlob(a,`${n.name}.png`)}const a=new Blob([n.raw],{type:'application/json'});e.downloadBlob(a,`${n.name}.json`)}async function g(n){if('library'===n.origin)return void await h(n);if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const t=await fetch(a,{cache:'no-cache'}),r=await t.blob();e.downloadBlob(r,`${n.name}.png`)}function m(e,n){const a=e?.characterId??n?.characterId??'';return null==a?'':String(a)}async function f(n,a){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let t;try{t=window.parent?.SillyTavern}catch{t=void 0}t??=SillyTavern;const r='function'==typeof t?.getContext?t.getContext():null,o=r?.characters??t?.characters??[],c=function(n,a){const t=e.normalizeNameKey(a.name),r=a.avatar?e.normalizeAvatarKey(a.avatar):'',o=r?n.findIndex(n=>e.normalizeAvatarKey(String(n.avatar??''))===r):-1;if(o>=0)return o;const c=n.findIndex(n=>e.normalizeNameKey(String(n.name??''))===t);return c>=0?c:n.findIndex(n=>e.normalizeNameKey(String(n?.data?.name??''))===t)}(o,n),i=m(r,t);if(c>=0&&i&&String(c)===String(i))if(o.length>1){const n=0===c?1:0,a=(r&&'function'==typeof r.selectCharacterById?r.selectCharacterById:null)??(t&&'function'==typeof t.selectCharacterById?t.selectCharacterById:null);if(a)try{await a(n,{switchMenu:!1}),await async function(n,a,t,r){const o=String(n),c=Date.now();for(;Date.now()-c<r;){if(m(a,t)===o)return!0;await e.sleep(80)}return!1}(n,r,t,3e3)}catch(e){console.warn('[CardHub] 删除前切换角色失败',e)}}else toastr.warning('当前角色为唯一角色，删除后酒馆可能需要刷新');const l=r?.getRequestHeaders?r.getRequestHeaders():t?.getRequestHeaders?.();if(!l||!Object.keys(l).length)return toastr.error('删除失败：无法获取请求头'),!1;const d={avatar_url:n.avatar,delete_chats:a},s=await fetch('/api/characters/delete',{method:'POST',headers:{...l,'Content-Type':'application/json'},body:JSON.stringify(d),cache:'no-cache'});if(s.ok){try{await triggerSlash('/closechat')}catch(e){console.warn('[CardHub] 关闭聊天失败',e)}return!0}const u=await s.text();return toastr.error(`删除失败：${s.status} ${u||s.statusText}`),!1}return{importInput:n,exportDialogOpen:a,exportSearch:r,exportStatusFilter:o,exportTagFilters:c,exportAllTags:l,exportVisibleCandidates:d,exportSelectedItems:u,exportSelectedIds:t,openExportDialog:p,exportSelected:async function(){p()},confirmExportSelected:async function(){const n=u.value;if(!n.length)return void toastr.warning('请选择要导出的角色卡');const t=e.selectedTags.value.length?e.selectedTags.value.join('、'):'无',r='all'===e.statusFilter.value?'全部':'imported'===e.statusFilter.value?'已导入':'未导入',o=e.stateSearch.value.trim()||'无',c=`将导出 ${n.length} 张角色卡。\n筛选状态：${r}\n筛选标签：${t}\n搜索关键字：${o}\n是否继续？`;if('confirm'===await e.openConfirm({title:'批量导出',message:c,confirmLabel:'继续导出',cancelLabel:'取消'})){a.value=!1;for(const a of n)await g(a),await e.sleep(120);toastr.success(`批量导出完成，共 ${n.length} 张`)}},isExportSelected:function(e){return s.value.has(e)},toggleExportSelection:function(e){s.value.has(e)?t.value=t.value.filter(n=>n!==e):t.value=[...t.value,e]},selectAllExport:function(){t.value=d.value.map(e=>e.id)},clearExportSelection:function(){t.value=[]},triggerImport:function(){n.value?.click()},handleImportFiles:async function(n){const a=n.target,t=a?.files;if(!t||!t.length)return;const r=await e.addToLibrary(t,e.getLibrary());e.setLibrary(r),a.value=''},handleCardAction:async function(e){'library'===e.origin?await b(e):g(e)},importLibraryCard:b,exportCard:g,exportLibraryCard:h,manageDelete:async function(n){if('library'===n.origin){if('confirm'!==await e.openConfirm({title:'删除角色',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'删除',cancelLabel:'取消'}))return;return e.setLibrary(e.removeFromLibrary(n.id)),void e.closeManage()}if('confirm'!==await e.openConfirm({title:'删除角色',message:`确定要删除「${n.name}」吗？`,confirmLabel:'继续',cancelLabel:'取消'}))return;const a=await e.openConfirm({title:'删除方式',message:`删除「${n.name}」：\n- 移到私有库：可在私有库中找回\n- 永久删除：不可恢复`,confirmLabel:'移到私有库',altLabel:'永久删除',cancelLabel:'取消'});if('cancel'===a)return;if('confirm'===a){await async function(n){if(!n.avatar)return;const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const t=await fetch(a,{cache:'no-cache'}),r=await t.blob(),o=await e.addToLibrary([new File([r],`${n.name}.png`,{type:'image/png'})]);e.setLibrary(o)}(n);if(!await f(n,!1))return;e.closeManage();const a=await e.fetchCharacterSummaries();return void e.setCharacters(a)}if('confirm'!==await e.openConfirm({title:'永久删除',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'永久删除',cancelLabel:'取消'}))return;if(!await f(n,!0))return;e.closeManage();const t=await e.fetchCharacterSummaries();e.setCharacters(t)}}}const He={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},Ie={class:'cardhub-toolbar'},Pe={class:'cardhub-body'},Oe={class:'cardhub-sidebar'},Ue={class:'cardhub-filter-row'},Ke={class:'cardhub-filter-block'},Re={class:'cardhub-chip-row'},Ye={class:'cardhub-filter-block'},qe={class:'cardhub-chip-row'},Je={class:'cardhub-tag-filter'},We=['onClick'],Xe={class:'cardhub-content'},Ze={key:0,class:'cardhub-loading'},Ge={key:1,class:'cardhub-empty'},Qe={key:2,class:'cardhub-grid-wrap'},en={class:'cardhub-pagination'},nn={key:0,class:'cardhub-pagination__actions'},an=['disabled'],tn=['disabled'],rn={class:'cardhub-pagination__status'},on={class:'cardhub-grid'},cn=['onClick'],ln={class:'cardhub-card__info'},dn={class:'cardhub-card__head'},sn={class:'cardhub-card__name'},un=['onClick'],pn={class:'cardhub-card__meta'},bn={key:0,class:'cardhub-card__note'},hn={class:'cardhub-card__tags'},gn=['onClick'],mn=['onClick'],fn=['onKeydown','onBlur'],vn=['onClick'],xn={class:'cardhub-card__actions'},_n=['onClick'],yn=['onClick'],wn={class:'cardhub-confirm__panel cardhub-modal__panel',role:'dialog','aria-modal':'true'},kn={class:'cardhub-confirm__title'},Cn={class:'cardhub-confirm__message'},En={class:'cardhub-confirm__actions'},Nn={class:'cardhub-tag-manager__panel cardhub-modal__panel',role:'dialog','aria-label':'标签管理'},Vn={class:'cardhub-tag-manager__header'},Sn={key:0,class:'cardhub-tag-manager__subtitle'},Bn={key:1,class:'cardhub-tag-manager__subtitle'},Tn={class:'cardhub-tag-manager__tabs'},zn={key:0,class:'cardhub-tag-manager__section'},An={class:'cardhub-tag-manager__actions'},Dn=['disabled'],Mn={class:'cardhub-tag-manager__list'},Ln=['onClick'],$n={key:1,class:'cardhub-tag-manager__section cardhub-tag-manager__batch'},jn={class:'cardhub-batch__filters'},Fn={class:'cardhub-batch__field'},Hn={key:0,class:'cardhub-batch__suggestions'},In={class:'cardhub-batch__suggest-row'},Pn=['onClick'],On={class:'cardhub-batch__toolbar'},Un={class:'cardhub-batch__list'},Kn=['checked','onChange'],Rn={class:'cardhub-batch__main'},Yn={class:'cardhub-batch__name'},qn={class:'cardhub-batch__meta'},Jn={key:0,class:'cardhub-batch__tags'},Wn={class:'cardhub-export__panel cardhub-modal__panel',role:'dialog','aria-label':'批量导出'},Xn={class:'cardhub-export__header'},Zn={class:'cardhub-export__subtitle'},Gn={class:'cardhub-export__filters'},Qn={class:'cardhub-export__filter-row'},ea={class:'cardhub-export__filter-row'},na=['onClick'],aa={class:'cardhub-export__toolbar'},ta={class:'cardhub-export__list'},ra=['checked','onChange'],oa={class:'cardhub-export__main'},ca={class:'cardhub-export__name'},ia={class:'cardhub-export__meta'},la={key:0,class:'cardhub-export__tags'},da={class:'cardhub-theme__panel cardhub-modal__panel',role:'dialog','aria-label':'配色设置'},sa={class:'cardhub-theme__grid'},ua={class:'cardhub-theme__field'},pa={class:'cardhub-theme__field'},ba={class:'cardhub-theme__field'},ha={class:'cardhub-theme__field'},ga={class:'cardhub-theme__field'},ma={class:'cardhub-theme__field'},fa={class:'cardhub-theme__field'},va={class:'cardhub-theme__field'},xa={class:'cardhub-theme__field'},_a={class:'cardhub-theme__presets'},ya=['onClick'],wa='cardhub_favorites',ka='cardhub_last_chat_cache',Ca='cardhub_import_cache',Ea='cardhub_notes',Na='cardhub_theme',Va=(0,T.defineComponent)({__name:'App',setup(e){const n=(0,T.ref)('all'),a=(0,T.ref)(24),r=(0,T.ref)(1),o=(0,T.ref)(null),c=(0,T.reactive)({open:!1,title:'',message:'',confirmLabel:'确定',cancelLabel:'取消',altLabel:'',resolve:null}),i=(0,T.computed)(()=>[...A.characters,...A.library]),d=(0,T.computed)(()=>{const e=new Map;return i.value.forEach(n=>{e.set(n.id,I(n))}),e}),{selectedTags:s,allTags:u,applyTagFilter:p,toggleTagFilter:b,clearTagFilter:h}=function(e,n){const a=(0,T.ref)([]),t=(0,T.computed)(()=>{const t=new Set;return e.value.forEach(e=>{n(e).forEach(e=>t.add(e))}),a.value.forEach(e=>t.add(e)),Array.from(t).sort((e,n)=>e.localeCompare(n,'zh-CN'))});return{selectedTags:a,allTags:t,applyTagFilter:function(e){return a.value.length?e.filter(e=>a.value.some(a=>n(e).includes(a))):e},toggleTagFilter:function(e){a.value.includes(e)?a.value=a.value.filter(n=>n!==e):a.value=[...a.value,e]},clearTagFilter:function(){a.value=[]}}}(i,I),g=(0,T.ref)([]),m=(0,T.computed)(()=>new Set(g.value)),f=(0,T.ref)('recent'),v=(0,T.ref)(!1),x=(0,T.ref)({}),y=(0,T.ref)({}),w=(0,T.ref)({}),k={bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'},C=(0,T.ref)(!1),E=(0,T.ref)({...k}),N=(0,T.reactive)({...k}),F=(0,T.computed)(()=>{const e=C.value?N:E.value;return{'--cardhub-bg-start':e.bgStart,'--cardhub-bg-end':e.bgEnd,'--cardhub-surface':e.surface,'--cardhub-surface-alt':e.surfaceAlt,'--cardhub-text':e.text,'--cardhub-text-muted':e.textMuted,'--cardhub-accent':e.accent,'--cardhub-accent-strong':e.accentStrong,'--cardhub-border':e.border,'--cardhub-surface-rgb':La(e.surface),'--cardhub-surface-alt-rgb':La(e.surfaceAlt),'--cardhub-border-rgb':La(e.border),'--cardhub-accent-rgb':La(e.accent),'--cardhub-accent-strong-rgb':La(e.accentStrong),'--cardhub-accent-text':$a(e.accent),'--cardhub-accent-strong-text':$a(e.accentStrong)}}),H=[{name:'晨雾',value:{bgStart:'#f6f8fb',bgEnd:'#e6ebf2',surface:'#fdfdfe',surfaceAlt:'#f1f4f9',text:'#1b1e22',textMuted:'#6b7480',accent:'#7fb3e1',accentStrong:'#243a52',border:'#d5dde8'}},{name:'白天',value:{bgStart:'#fdfaf4',bgEnd:'#f2ebe1',surface:'#fffefb',surfaceAlt:'#f7efe6',text:'#1d1a17',textMuted:'#7a6f63',accent:'#e3a981',accentStrong:'#3f2c22',border:'#e4d7c8'}},{name:'夜晚',value:{bgStart:'#14181d',bgEnd:'#0d1116',surface:'#1e242b',surfaceAlt:'#242b34',text:'#eef2f7',textMuted:'#b2bdc9',accent:'#6fa2d1',accentStrong:'#d7e6f4',border:'#36414c'}},{name:'茶棕',value:{bgStart:'#f7f1e7',bgEnd:'#e6d8c6',surface:'#fcf6ee',surfaceAlt:'#f2e4d6',text:'#2a1f18',textMuted:'#8a6d5a',accent:'#c47b52',accentStrong:'#3e2a22',border:'#ddc7b4'}},{name:'赤陶',value:{bgStart:'#fbf1ea',bgEnd:'#ecd5c8',surface:'#fff7f1',surfaceAlt:'#f4e1d6',text:'#2d2018',textMuted:'#8b6a5a',accent:'#d17a4f',accentStrong:'#4c2d21',border:'#e3c3b3'}},{name:'薄荷',value:{bgStart:'#f2fbf7',bgEnd:'#dcefe7',surface:'#f9fffd',surfaceAlt:'#e8f4f0',text:'#1a2a26',textMuted:'#5f7a73',accent:'#60b6a4',accentStrong:'#1f4c43',border:'#c5ddd5'}},{name:'海盐',value:{bgStart:'#f3f8fb',bgEnd:'#d9e7f3',surface:'#f9fcff',surfaceAlt:'#e9f2f9',text:'#1b2530',textMuted:'#5f7388',accent:'#5da3cf',accentStrong:'#1f3e57',border:'#c8d9e7'}},{name:'石墨',value:{bgStart:'#2a2d33',bgEnd:'#1e2126',surface:'#333741',surfaceAlt:'#3b404b',text:'#f3f5f8',textMuted:'#c1c7d0',accent:'#9aa6b2',accentStrong:'#e0e5ea',border:'#4b5261'}}],O=(0,T.computed)(()=>{const e=function(e){if(!v.value)return e;return e.filter(e=>m.value.has(e.id))}(function(e){if('imported'===n.value)return e.filter(e=>!Ma(e));if('unimported'===n.value)return e.filter(e=>Ma(e));return e}(i.value)),a=A.search.trim().toLowerCase();return Da(a?p(e).filter(e=>{if(e.name.toLowerCase().includes(a))return!0;return(d.value.get(e.id)??I(e)).some(e=>e.toLowerCase().includes(a))}):p(e))}),{tagManagerOpen:U,tagManagerTab:K,openTagManager:R,closeTagManager:Y,batchTagSelectedIds:q,batchTagSearch:J,batchTagInput:W,batchTagSelectedTags:X,batchTagSelectedSet:Z,batchTagVisibleCandidates:G,batchTagSuggestions:Q,toggleBatchTagSelection:ee,selectAllBatchTags:ne,clearBatchTagSelection:ae,toggleBatchTagSuggestion:te,applyBatchTags:re}=je({allCards:i,filteredCharacters:O,allTags:u,displayTags:De,applyTagUpdate:Qa,openConfirm:Za}),oe=(0,T.toRef)(A,'search'),{importInput:ce,exportDialogOpen:ie,exportSearch:le,exportStatusFilter:de,exportTagFilters:se,exportAllTags:ue,exportVisibleCandidates:pe,exportSelectedItems:be,exportSelectedIds:he,openExportDialog:ge,exportSelected:me,confirmExportSelected:fe,isExportSelected:ve,toggleExportSelection:xe,selectAllExport:_e,clearExportSelection:ye,triggerImport:we,handleImportFiles:ke,handleCardAction:Ce,importLibraryCard:Ee,exportCard:Ne,exportLibraryCard:Ve,manageDelete:Se}=Fe({allCards:i,stateSearch:oe,selectedTags:s,statusFilter:n,getCharacters:()=>A.characters,getLibrary:()=>A.library,setLibrary:j,setCharacters:Xa,fetchCharacterSummaries:t,addToLibrary:S,removeFromLibrary:B,updateCharacterTags:P,parseLibraryCardData:st,extractCardTagsFromData:function(e){const n=e?.tags??e?.data?.tags;if(!Array.isArray(n))return[];return n.filter(e=>'string'==typeof e).map(e=>e.trim()).filter(Boolean)},normalizeNameKey:function(e){return e.trim().toLocaleLowerCase()},normalizeAvatarKey:function(e){let n=e.trim();if(!n)return'';try{n=decodeURIComponent(n)}catch{}n=n.split('?')[0],n.includes('/')&&(n=n.split('/').pop()??n);return n.trim().toLowerCase()},dataUrlToBlob:async function(e){const n=await fetch(e);return await n.blob()},downloadBlob:function(e,n){const a=URL.createObjectURL(e),t=document.createElement('a');t.href=a,t.download=n,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(a)},openConfirm:Za,closeManage:dt,sleep:Ct}),Be=(0,T.computed)(()=>{const e=Math.ceil(O.value.length/a.value);return e>0?e:1}),Te=(0,T.computed)(()=>{const e=(r.value-1)*a.value;return O.value.slice(e,e+a.value)});function ze(e,n=!1){const a=e.avatar;return a?/^(data:|https?:|\/)/.test(a)?a:n&&'tavern'===e.origin?TavernHelper.getCharAvatarPath(a,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(a)}`:null}function Ae(e){const n=ze(e);return n?{backgroundImage:`url(${n})`}:{}}function De(e){return d.value.get(e.id)??I(e)}function Me(e){return e.note?.trim()??''}function Le(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[ka]:e})}function Va(e){return'tavern'!==e.origin?null:e.avatar?`avatar:${e.avatar}`:e.name?`name:${e.name}`:null}function Sa(e){if('number'==typeof e.createdAt&&e.createdAt>0)return e.createdAt;const n=Va(e);return n?y.value[n]??0:0}function Ba(e){if('number'==typeof e.lastChatAt&&e.lastChatAt>0)return e.lastChatAt;const n=Va(e);return n?x.value[n]??0:0}function Ta(e,n){if(n<=0||'tavern'!==e.origin)return;const a=new Set;if(e.avatar&&a.add(`avatar:${e.avatar}`),e.name&&a.add(`name:${e.name}`),!a.size)return;const t={...x.value};let r=!1;a.forEach(e=>{(t[e]??0)<n&&(t[e]=n,r=!0)}),r&&(x.value=t,Le(t))}function za(e){y.value=e,function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Ca]:e})}(e)}function Aa(e){m.value.has(e.id)?g.value=g.value.filter(n=>n!==e.id):g.value=[...g.value,e.id],function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[wa]:e})}(g.value)}function Da(e){const n=e.map(e=>({item:e,tagCount:(d.value.get(e.id)??I(e)).length})),a=(e,n)=>e.localeCompare(n,'zh-CN');return n.sort((e,n)=>{const t=e.item,r=n.item;if('name'===f.value)return a(t.name,r.name);if('tags'===f.value)return n.tagCount!==e.tagCount?n.tagCount-e.tagCount:a(t.name,r.name);if('imported'===f.value){const e=Sa(t),n=Sa(r);return n!==e?n-e:a(t.name,r.name)}const o=Ba(t),c=Ba(r);if(c!==o)return c-o;const i=t.createdAt??0,l=r.createdAt??0;return l!==i?l-i:a(t.name,r.name)}).map(e=>e.item)}function Ma(e){return!('library'!==e.origin&&!Boolean(e.rawType))||A.library.some(n=>n.id===e.id)}function La(e){const n=e.replace('#','');if(6!==n.length)return'0, 0, 0';return`${Number.parseInt(n.slice(0,2),16)}, ${Number.parseInt(n.slice(2,4),16)}, ${Number.parseInt(n.slice(4,6),16)}`}function $a(e){const n=La(e).split(',').map(e=>Number(e.trim()));if(3!==n.length)return'#1b1b1b';const[a,t,r]=n.map(e=>e/255);return.2126*a+.7152*t+.0722*r>.6?'#1b1b1b':'#ffffff'}let ja=0,Fa=null;function Ha(e){ja&&(cancelAnimationFrame(ja),ja=0),Fa&&window.clearTimeout(Fa),Fa=window.setTimeout(()=>{Fa=null,ja=requestAnimationFrame(()=>{ja=0,function(e){const n=function(){try{return(window.parent?.document??document).querySelector('.cardhub-root')}catch{return document.querySelector('.cardhub-root')}}();if(!n)return;n.style.setProperty('--cardhub-bg-start',e.bgStart),n.style.setProperty('--cardhub-bg-end',e.bgEnd),n.style.setProperty('--cardhub-surface',e.surface),n.style.setProperty('--cardhub-surface-alt',e.surfaceAlt),n.style.setProperty('--cardhub-text',e.text),n.style.setProperty('--cardhub-text-muted',e.textMuted),n.style.setProperty('--cardhub-accent',e.accent),n.style.setProperty('--cardhub-accent-strong',e.accentStrong),n.style.setProperty('--cardhub-border',e.border),n.style.setProperty('--cardhub-surface-rgb',La(e.surface)),n.style.setProperty('--cardhub-surface-alt-rgb',La(e.surfaceAlt)),n.style.setProperty('--cardhub-border-rgb',La(e.border)),n.style.setProperty('--cardhub-accent-rgb',La(e.accent)),n.style.setProperty('--cardhub-accent-strong-rgb',La(e.accentStrong)),n.style.setProperty('--cardhub-accent-text',$a(e.accent)),n.style.setProperty('--cardhub-accent-strong-text',$a(e.accentStrong))}(e)})},80)}function Ia(){const e=TavernHelper.getVariables({type:'global'});return function(e){if(!e||'object'!=typeof e)return{...k};const n=e,a=e=>{const a=n[e];return/^#[0-9a-f]{6}$/i.test(a)?a:k[e]};return{bgStart:a('bgStart'),bgEnd:a('bgEnd'),surface:a('surface'),surfaceAlt:a('surfaceAlt'),text:a('text'),textMuted:a('textMuted'),accent:a('accent'),accentStrong:a('accentStrong'),border:a('border')}}(e?.[Na])}function Pa(){const e=E.value;Object.assign(N,e),C.value=!0,(0,T.nextTick)(()=>Ha(e))}function Oa(){C.value=!1,Object.assign(N,E.value),Ha(E.value)}function Ua(){Object.assign(N,k)}function Ka(){E.value={...N},function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Na]:e})}(E.value),Ha(E.value),C.value=!1}function Ra(){se.value=[]}function Ya(){ie.value=!1}function qa(){r.value>1&&(r.value-=1)}function Ja(){r.value<Be.value&&(r.value+=1)}function Wa(e){if('tavern'!==e.origin)return null;const n=e.tagKey??e.avatar??e.name;return n?`tavern:${n}`:null}function Xa(e){L(function(e){return e.map(e=>{const n=Wa(e);return n?{...e,note:w.value[n]??''}:{...e,note:e.note??''}})}(e))}function Za(e){return c.open&&c.resolve&&c.resolve('cancel'),c.title=e.title??'确认操作',c.message=e.message,c.confirmLabel=e.confirmLabel??'确定',c.cancelLabel=e.cancelLabel??'取消',c.altLabel=e.altLabel??'',c.open=!0,new Promise(e=>{c.resolve=e})}function Ga(e){if(!c.open)return;c.open=!1;const n=c.resolve;c.resolve=null,n&&n(e)}function Qa(e,n){if(Ma(e)){j(function(e,n,a){const t=(Array.isArray(a)&&a.length?a:V()).map(a=>a.id!==e?a:{...a,tags:n,tagsEdited:!0});return l(t),t}(e.id,n,A.library))}else{const a=P(e,n);e.tags=a,L([...A.characters])}}(0,T.watch)(N,e=>{C.value&&Ha({...e})},{deep:!0}),(0,T.onMounted)(()=>{const e=Ia();E.value=e,Object.assign(N,e),(0,T.nextTick)(()=>Ha(e)),g.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[wa];return Array.isArray(n)?n.filter(e=>'string'==typeof e):[]}(),x.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[ka];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),y.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[Ca];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'number'==typeof e&&!Number.isNaN(e));return Object.fromEntries(a)}(),w.value=function(){const e=TavernHelper.getVariables({type:'global'}),n=e?.[Ea];if(!n||'object'!=typeof n)return{};const a=Object.entries(n).filter(([,e])=>'string'==typeof e&&e.trim().length>0);return Object.fromEntries(a)}(),wt(i.value),kt(i.value)}),(0,T.watch)([()=>A.search,n,()=>s.value.join('|'),f,v],()=>{r.value=1}),(0,T.watch)([O,Be],()=>{r.value>Be.value&&(r.value=Be.value),r.value<1&&(r.value=1)}),(0,T.watch)([f,i],()=>{'recent'===f.value&&wt(i.value),'imported'===f.value&&kt(i.value)});const{tagKey:et,activeTagKey:nt,tagInput:at,startTagEdit:tt,cancelTagEdit:rt,confirmTag:ot,removeTag:ct}=function(e){const n=(0,T.ref)(null),a=(0,T.ref)('');function t(e){return e.id}function r(){n.value=null,a.value=''}return{tagKey:t,activeTagKey:n,tagInput:a,startTagEdit:function(e){n.value=t(e),a.value='',(0,T.nextTick)(()=>{const e=document.querySelector('.cardhub-tag-input');e?.focus()})},cancelTagEdit:r,confirmTag:function(o){if(n.value!==t(o))return;const c=a.value.trim();if(c){const n=[...e.getTags(o),c];e.applyTagUpdate(o,n)}r()},removeTag:function(n,a){const t=e.getTags(n).filter(e=>e!==a);e.applyTagUpdate(n,t)}}}({getTags:I,applyTagUpdate:Qa});function it(e,n){const a=n.trim();if(Ma(e)){const n=function(e,n,a){const t=(Array.isArray(a)&&a.length?a:V()).map(a=>a.id!==e?a:{...a,note:n});return l(t),t}(e.id,a,A.library);j(n);const t=n.find(n=>n.id===e.id);return void(t&&(o.value=t))}const t=Wa(e);if(!t)return;const r={...w.value};a?r[t]=a:delete r[t],w.value=r,function(e){const n=TavernHelper.getVariables({type:'global'});TavernHelper.replaceVariables({type:'global'},{...n,[Ea]:e})}(r);const c=A.characters.map(n=>n.id===e.id?{...n,note:a}:n);L(c);const i=c.find(n=>n.id===e.id);i&&(o.value=i)}function lt(e){o.value=e}function dt(){o.value=null}function st(e){return e.raw&&e.rawType?'json'===e.rawType?ut(e.raw):'png'===e.rawType?function(e){const n=function(e){const n=e.indexOf(',');if(n<0)return null;const a=e.slice(n+1);try{const e=atob(a),n=new Uint8Array(e.length);for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}catch{return null}}(e);if(!n)return null;const a=function(e){if(e.length<8)return[];const n=[137,80,78,71,13,10,26,10];for(let a=0;a<n.length;a+=1)if(e[a]!==n[a])return[];const a=[];let t=8;for(;t+8<=e.length;){const n=gt(e,t),r=mt(e.subarray(t+4,t+8)),o=t+8,c=o+n;if(c+4>e.length)break;const i=e.subarray(o,c);if('tEXt'===r){const e=pt(i);e&&a.push(e)}else if('iTXt'===r){const e=bt(i);e&&a.push(e)}t=c+4}return a}(n),t=new Set(['chara','character','tavern','tavern_character','card']);for(const e of a){if(e.key&&!t.has(e.key.toLowerCase()))continue;const n=ht(e.value);if(n)return n}return null}(e.raw):null:null}function ut(e){try{return JSON.parse(e)}catch{return null}}function pt(e){const n=e.indexOf(0);if(n<0)return null;const a=mt(e.subarray(0,n)).trim(),t=mt(e.subarray(n+1)).trim();return a&&t?{key:a,value:t}:null}function bt(e){const n=e.indexOf(0);if(n<0||n+2>=e.length)return null;const a=mt(e.subarray(0,n)).trim(),t=1===e[n+1];let r=n+2;const o=e.indexOf(0,r);if(o<0)return null;r=o+1;const c=e.indexOf(0,r);if(c<0)return null;if(r=c+1,t)return null;const i=mt(e.subarray(r)).trim();return a&&i?{key:a,value:i}:null}function ht(e){const n=e.trim();if(!n)return null;const a=ut(n);if(a)return a;if(!function(e){if(e.length<16||e.length%4!=0)return!1;return/^[A-Za-z0-9+/=]+$/.test(e)}(n))return null;const t=function(e){try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return(new TextDecoder).decode(a)}catch{return null}}(n);return t?ut(t):null}function gt(e,n){return(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0}function mt(e){return(new TextDecoder).decode(e)}function ft(...e){for(const n of e)if('string'==typeof n){const e=n.trim();if(e)return e}return''}function vt(e){if('number'==typeof e&&!Number.isNaN(e))return e<1e12?1e3*e:e;if('string'==typeof e){const n=Date.parse(e);if(!Number.isNaN(n))return n}return null}function xt(e){const n=[e?.last_message_time,e?.last_message_date,e?.update_time,e?.last_modified,e?.create_date,e?.timestamp,e?.time];for(const e of n){const n=vt(e);if(n)return n}const a=ft(e?.file_name,e?.file_id);return a?function(e){const n=e.replace(/\.jsonl$/i,'').trim().match(/(\d{4})[./-](\d{1,2})[./-](\d{1,2})(?:[ T_@-]*(\d{1,2})[:：](\d{1,2})(?:[:：](\d{1,2}))?)?/);if(!n)return null;const a=Number(n[1]),t=Number(n[2]),r=Number(n[3]),o=n[4]?Number(n[4]):0,c=n[5]?Number(n[5]):0,i=n[6]?Number(n[6]):0;if(!a||!t||!r)return null;const l=new Date(a,t-1,r,o,c,i).getTime();return Number.isNaN(l)?null:l}(a):null}function _t(e){return[...e].sort((e,n)=>{const a=xt(e)??0;return(xt(n)??0)-a})}let yt=0;async function wt(e){if('recent'!==f.value)return;const n=e.filter(e=>'tavern'===e.origin&&(!('number'==typeof e.lastChatAt&&e.lastChatAt>0)&&Ba(e)<=0));if(!n.length)return;const a=++yt;for(const e of n){if(a!==yt||'recent'!==f.value)return;if('tavern'!==e.origin)continue;if('number'==typeof e.lastChatAt&&e.lastChatAt>0)continue;const n=Ba(e);let t=null;try{t=await TavernHelper.getChatHistoryBrief(e.name??e.avatar??'',!0)}catch(e){console.warn('[CardHub] 读取聊天简报失败',e)}if(Array.isArray(t)&&t.length){const a=xt(_t(t)[0])??0;a>n&&Ta(e,a)}await Ct(80)}}function kt(e){const n={...y.value};let a=!1;const t=Date.now();e.forEach((r,o)=>{if('tavern'!==r.origin)return;if('number'==typeof r.createdAt&&r.createdAt>0)return;const c=Va(r);c&&!n[c]&&(n[c]=t-1e3*(e.length-1-o),a=!0)}),a&&za(n)}function Ct(e){return new Promise(n=>setTimeout(n,e))}async function Et(){M(!0);try{Xa(await t()),j(V())}finally{M(!1)}}function Nt(){D(!1)}return(e,a)=>((0,T.openBlock)(),(0,T.createElementBlock)('div',{class:(0,T.normalizeClass)(['cardhub-root',{open:(0,T.unref)(A).open}]),style:(0,T.normalizeStyle)(F.value)},[(0,T.createElementVNode)('div',{class:'cardhub-backdrop',onClick:Nt}),(0,T.createElementVNode)('section',He,[(0,T.createElementVNode)('header',{class:'cardhub-header'},[a[59]||(a[59]=(0,T.createElementVNode)('div',{class:'cardhub-title'},[(0,T.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,T.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,T.createElementVNode)('div',{class:'cardhub-actions'},[(0,T.createElementVNode)('button',{class:'cardhub-theme-trigger',type:'button','aria-label':'配色',onClick:Pa},[...a[57]||(a[57]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-palette','aria-hidden':'true'},null,-1)])]),(0,T.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:Nt},[...a[58]||(a[58]=[(0,T.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,T.createElementVNode)('div',Ie,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[0]||(a[0]=e=>(0,T.unref)(A).search=e),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(A).search]]),(0,T.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:Et},'刷新'),(0,T.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[1]||(a[1]=(...e)=>(0,T.unref)(we)&&(0,T.unref)(we)(...e))},'导入'),(0,T.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:a[2]||(a[2]=(...e)=>(0,T.unref)(me)&&(0,T.unref)(me)(...e))},'批量导出'),(0,T.createElementVNode)('input',{ref_key:'importInput',ref:ce,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:a[3]||(a[3]=(...e)=>(0,T.unref)(ke)&&(0,T.unref)(ke)(...e))},null,544)]),(0,T.createElementVNode)('div',Pe,[(0,T.createElementVNode)('div',Oe,[(0,T.createElementVNode)('div',Ue,[(0,T.createElementVNode)('div',Ke,[a[60]||(a[60]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,T.createElementVNode)('div',Re,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'all'===n.value}]),type:'button',onClick:a[4]||(a[4]=e=>n.value='all')},' 全部 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'imported'===n.value}]),type:'button',onClick:a[5]||(a[5]=e=>n.value='imported')},' 已导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===n.value}]),type:'button',onClick:a[6]||(a[6]=e=>n.value='unimported')},' 未导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':v.value}]),type:'button',onClick:a[7]||(a[7]=e=>v.value=!v.value)},' 收藏 ',2)])]),(0,T.createElementVNode)('div',Ye,[a[61]||(a[61]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'排序',-1)),(0,T.createElementVNode)('div',qe,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'recent'===f.value}]),type:'button',onClick:a[8]||(a[8]=e=>f.value='recent')},' 最近聊天 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'name'===f.value}]),type:'button',onClick:a[9]||(a[9]=e=>f.value='name')},' 名称 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'tags'===f.value}]),type:'button',onClick:a[10]||(a[10]=e=>f.value='tags')},' 标签数量 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-chip',{'is-active':'imported'===f.value}]),type:'button',onClick:a[11]||(a[11]=e=>f.value='imported')},' 导入时间 ',2)])])]),a[62]||(a[62]=(0,T.createElementVNode)('div',{class:'cardhub-divider'},null,-1)),a[63]||(a[63]=(0,T.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,T.createElementVNode)('div',Je,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(u),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':(0,T.unref)(s).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(b)(e)},(0,T.toDisplayString)(e),11,We))),128))]),(0,T.unref)(s).length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:a[12]||(a[12]=(...e)=>(0,T.unref)(h)&&(0,T.unref)(h)(...e))},' 清空标签 ')):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('button',{class:'cardhub-chip cardhub-chip--more',type:'button',onClick:a[13]||(a[13]=e=>(0,T.unref)(R)('filter'))},' 标签管理 ')]),(0,T.createElementVNode)('div',Xe,[(0,T.unref)(A).loading?((0,T.openBlock)(),(0,T.createElementBlock)('div',Ze,'正在读取角色卡...')):O.value.length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Qe,[(0,T.createElementVNode)('div',en,[Be.value>1?((0,T.openBlock)(),(0,T.createElementBlock)('div',nn,[(0,T.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:r.value<=1,onClick:qa},' 上一页 ',8,an),(0,T.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:r.value>=Be.value,onClick:Ja},' 下一页 ',8,tn)])):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('span',rn,'第 '+(0,T.toDisplayString)(r.value)+' / '+(0,T.toDisplayString)(Be.value)+' 页',1)]),(0,T.createElementVNode)('div',on,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(Te.value,e=>{return(0,T.openBlock)(),(0,T.createElementBlock)('article',{key:e.id,class:'cardhub-card',onClick:n=>lt(e)},[(0,T.createElementVNode)('div',{class:(0,T.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(ze(e))}]),style:(0,T.normalizeStyle)(Ae(e))},[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(e.name.slice(0,1)||'?'),1)],6),(0,T.createElementVNode)('div',ln,[(0,T.createElementVNode)('div',dn,[(0,T.createElementVNode)('div',sn,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-fav',{'is-active':(n=e.id,m.value.has(n))}]),type:'button','aria-label':'收藏',onClick:(0,T.withModifiers)(n=>Aa(e),['stop'])},[...a[64]||(a[64]=[(0,T.createElementVNode)('i',{class:'fa-solid fa-star','aria-hidden':'true'},null,-1)])],10,un)]),(0,T.createElementVNode)('div',pn,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(De(e).length)+' 标签',1)]),Me(e)?((0,T.openBlock)(),(0,T.createElementBlock)('div',bn,(0,T.toDisplayString)(Me(e)),1)):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('div',hn,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(De(e),n=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:n,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:(0,T.withModifiers)(a=>(0,T.unref)(ct)(e,n),['stop'])},[(0,T.createTextVNode)((0,T.toDisplayString)(n)+' ',1),a[65]||(a[65]=(0,T.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,gn))),128)),(0,T.unref)(nt)!==(0,T.unref)(et)(e)?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:(0,T.withModifiers)(n=>(0,T.unref)(tt)(e),['stop'])},' + 标签 ',8,mn)):((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-tag-edit',onClick:a[16]||(a[16]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[17]||(a[17]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[18]||(a[18]=(0,T.withModifiers)(()=>{},['stop']))},[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[14]||(a[14]=e=>(0,T.isRef)(at)?at.value=e:null),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,T.withKeys)((0,T.withModifiers)(n=>(0,T.unref)(ot)(e),['prevent']),['enter']),a[15]||(a[15]=(0,T.withKeys)((0,T.withModifiers)((...e)=>(0,T.unref)(rt)&&(0,T.unref)(rt)(...e),['prevent']),['esc']))],onBlur:n=>(0,T.unref)(ot)(e)},null,40,fn),[[T.vModelText,(0,T.unref)(at)]]),(0,T.createElementVNode)('button',{class:'cardhub-tag-confirm',type:'button',onClick:n=>(0,T.unref)(ot)(e)},'✔',8,vn)],32))])]),(0,T.createElementVNode)('div',xn,[(0,T.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,T.withModifiers)(n=>(0,T.unref)(Ce)(e),['stop']),onPointerdown:a[19]||(a[19]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[20]||(a[20]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[21]||(a[21]=(0,T.withModifiers)(()=>{},['stop']))},(0,T.toDisplayString)('tavern'===e.origin?'导出':'导入'),41,_n),(0,T.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,T.withModifiers)(n=>lt(e),['stop']),onPointerdown:a[22]||(a[22]=(0,T.withModifiers)(()=>{},['stop'])),onMousedown:a[23]||(a[23]=(0,T.withModifiers)(()=>{},['stop'])),onTouchstart:a[24]||(a[24]=(0,T.withModifiers)(()=>{},['stop']))},' 管理 ',40,yn)])],8,cn);var n}),128))])])):((0,T.openBlock)(),(0,T.createElementBlock)('div',Ge,'暂无角色卡，或没有匹配的搜索结果。'))])])]),(0,T.createVNode)($e,{card:o.value,'display-tags':De,'handle-card-action':(0,T.unref)(Ce),'manage-delete':(0,T.unref)(Se),'close-manage':dt,'close-root':Nt,'apply-note-update':it,'parse-library-card-data':st,'update-last-chat-cache-for-card':Ta},null,8,['card','handle-card-action','manage-delete']),c.open?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:0,class:'cardhub-confirm cardhub-modal',onClick:a[28]||(a[28]=(0,T.withModifiers)(e=>Ga('cancel'),['self']))},[(0,T.createElementVNode)('div',wn,[(0,T.createElementVNode)('div',kn,(0,T.toDisplayString)(c.title),1),(0,T.createElementVNode)('div',Cn,(0,T.toDisplayString)(c.message),1),(0,T.createElementVNode)('div',En,[(0,T.createElementVNode)('button',{class:'cardhub-confirm__button is-cancel',type:'button',onClick:a[25]||(a[25]=e=>Ga('cancel'))},(0,T.toDisplayString)(c.cancelLabel),1),c.altLabel?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-confirm__button is-danger',type:'button',onClick:a[26]||(a[26]=e=>Ga('alt'))},(0,T.toDisplayString)(c.altLabel),1)):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('button',{class:'cardhub-confirm__button is-confirm',type:'button',onClick:a[27]||(a[27]=e=>Ga('confirm'))},(0,T.toDisplayString)(c.confirmLabel),1)])])])):(0,T.createCommentVNode)('v-if',!0),(0,T.unref)(U)?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:1,class:'cardhub-tag-manager cardhub-modal',onClick:a[40]||(a[40]=(0,T.withModifiers)((...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e),['self']))},[(0,T.createElementVNode)('div',Nn,[(0,T.createElementVNode)('div',Vn,[(0,T.createElementVNode)('div',null,[a[66]||(a[66]=(0,T.createElementVNode)('div',{class:'cardhub-tag-manager__title'},'标签管理',-1)),'filter'===(0,T.unref)(K)?((0,T.openBlock)(),(0,T.createElementBlock)('div',Sn,' 已选 '+(0,T.toDisplayString)((0,T.unref)(s).length)+' / '+(0,T.toDisplayString)((0,T.unref)(u).length),1)):((0,T.openBlock)(),(0,T.createElementBlock)('div',Bn,' 已选 '+(0,T.toDisplayString)((0,T.unref)(q).length)+' / '+(0,T.toDisplayString)((0,T.unref)(G).length),1))]),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:a[29]||(a[29]=(...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e))},'×')]),(0,T.createElementVNode)('div',Tn,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'filter'===(0,T.unref)(K)}]),type:'button',onClick:a[30]||(a[30]=e=>(0,T.unref)(R)('filter'))},' 标签筛选 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-tag-manager__tab',{'is-active':'batch'===(0,T.unref)(K)}]),type:'button',onClick:a[31]||(a[31]=e=>(0,T.unref)(R)('batch'))},' 批量标签 ',2)]),'filter'===(0,T.unref)(K)?((0,T.openBlock)(),(0,T.createElementBlock)('div',zn,[(0,T.createElementVNode)('div',An,[(0,T.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-secondary',type:'button',disabled:!(0,T.unref)(s).length,onClick:a[32]||(a[32]=(...e)=>(0,T.unref)(h)&&(0,T.unref)(h)(...e))},' 清空 ',8,Dn),a[67]||(a[67]=(0,T.createElementVNode)('div',{class:'cardhub-tag-manager__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-tag-manager__btn is-primary',type:'button',onClick:a[33]||(a[33]=(...e)=>(0,T.unref)(Y)&&(0,T.unref)(Y)(...e))},'完成')]),(0,T.createElementVNode)('div',Mn,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(u),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-tag-manager__chip',{'is-active':(0,T.unref)(s).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(b)(e)},(0,T.toDisplayString)(e),11,Ln))),128))])])):((0,T.openBlock)(),(0,T.createElementBlock)('div',$n,[(0,T.createElementVNode)('div',jn,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[34]||(a[34]=e=>(0,T.isRef)(J)?J.value=e:null),class:'cardhub-batch__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(J)]]),a[68]||(a[68]=(0,T.createElementVNode)('div',{class:'cardhub-batch__hint'},'提示：可先在主界面筛选，再切换到批量标签。',-1))]),(0,T.createElementVNode)('div',Fn,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[35]||(a[35]=e=>(0,T.isRef)(W)?W.value=e:null),type:'text',placeholder:'输入标签，逗号/换行分隔'},null,512),[[T.vModelText,(0,T.unref)(W)]])]),(0,T.unref)(Q).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Hn,[a[69]||(a[69]=(0,T.createElementVNode)('span',{class:'cardhub-batch__suggest-title'},'已有标签',-1)),(0,T.createElementVNode)('div',In,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(Q),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-batch__chip',{'is-active':(0,T.unref)(X).includes(e)}]),type:'button',onClick:n=>(0,T.unref)(te)(e)},(0,T.toDisplayString)(e),11,Pn))),128))])])):(0,T.createCommentVNode)('v-if',!0),(0,T.createElementVNode)('div',On,[(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[36]||(a[36]=(...e)=>(0,T.unref)(ne)&&(0,T.unref)(ne)(...e))},'全选'),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-secondary',type:'button',onClick:a[37]||(a[37]=(...e)=>(0,T.unref)(ae)&&(0,T.unref)(ae)(...e))},'清空'),a[70]||(a[70]=(0,T.createElementVNode)('div',{class:'cardhub-batch__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-ghost',type:'button',onClick:a[38]||(a[38]=e=>(0,T.unref)(re)('remove'))},' 移除标签 '),(0,T.createElementVNode)('button',{class:'cardhub-batch__btn is-primary',type:'button',onClick:a[39]||(a[39]=e=>(0,T.unref)(re)('add'))},'添加标签')]),(0,T.createElementVNode)('div',Un,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(G),e=>((0,T.openBlock)(),(0,T.createElementBlock)('label',{key:e.id,class:'cardhub-batch__item'},[(0,T.createElementVNode)('input',{class:'cardhub-batch__checkbox',type:'checkbox',checked:(0,T.unref)(Z).has(e.id),onChange:n=>(0,T.unref)(ee)(e.id)},null,40,Kn),(0,T.createElementVNode)('div',Rn,[(0,T.createElementVNode)('div',Yn,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('div',qn,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(De(e).length)+' 标签',1)]),De(e).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',Jn,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(De(e).slice(0,3),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-batch__tag'},(0,T.toDisplayString)(e),1))),128))])):(0,T.createCommentVNode)('v-if',!0)])]))),128))])]))])])):(0,T.createCommentVNode)('v-if',!0),(0,T.unref)(ie)?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:2,class:'cardhub-export cardhub-modal',onClick:(0,T.withModifiers)(Ya,['self'])},[(0,T.createElementVNode)('div',Wn,[(0,T.createElementVNode)('div',Xn,[(0,T.createElementVNode)('div',null,[a[71]||(a[71]=(0,T.createElementVNode)('div',{class:'cardhub-export__title'},'批量导出',-1)),(0,T.createElementVNode)('div',Zn,' 已选 '+(0,T.toDisplayString)((0,T.unref)(be).length)+' / '+(0,T.toDisplayString)((0,T.unref)(pe).length),1)]),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Ya},'×')]),(0,T.createElementVNode)('div',Gn,[(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[41]||(a[41]=e=>(0,T.isRef)(le)?le.value=e:null),class:'cardhub-export__search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[T.vModelText,(0,T.unref)(le)]]),(0,T.createElementVNode)('div',Qn,[(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'all'===(0,T.unref)(de)}]),type:'button',onClick:a[42]||(a[42]=e=>de.value='all')},' 全部 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'imported'===(0,T.unref)(de)}]),type:'button',onClick:a[43]||(a[43]=e=>de.value='imported')},' 已导入 ',2),(0,T.createElementVNode)('button',{class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':'unimported'===(0,T.unref)(de)}]),type:'button',onClick:a[44]||(a[44]=e=>de.value='unimported')},' 未导入 ',2)]),(0,T.createElementVNode)('div',ea,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(ue),e=>((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:e,class:(0,T.normalizeClass)(['cardhub-export__chip',{'is-active':(0,T.unref)(se).includes(e)}]),type:'button',onClick:n=>function(e){se.value.includes(e)?se.value=se.value.filter(n=>n!==e):se.value=[...se.value,e]}(e)},(0,T.toDisplayString)(e),11,na))),128)),(0,T.unref)(se).length?((0,T.openBlock)(),(0,T.createElementBlock)('button',{key:0,class:'cardhub-export__chip cardhub-export__chip--clear',type:'button',onClick:Ra},' 清空标签 ')):(0,T.createCommentVNode)('v-if',!0)])]),(0,T.createElementVNode)('div',aa,[(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[45]||(a[45]=(...e)=>(0,T.unref)(_e)&&(0,T.unref)(_e)(...e))},'全选'),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:a[46]||(a[46]=(...e)=>(0,T.unref)(ye)&&(0,T.unref)(ye)(...e))},'清空'),a[72]||(a[72]=(0,T.createElementVNode)('div',{class:'cardhub-export__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-secondary',type:'button',onClick:Ya},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-export__btn is-primary',type:'button',onClick:a[47]||(a[47]=(...e)=>(0,T.unref)(fe)&&(0,T.unref)(fe)(...e))},'导出已选')]),(0,T.createElementVNode)('div',ta,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)((0,T.unref)(pe),e=>((0,T.openBlock)(),(0,T.createElementBlock)('label',{key:e.id,class:'cardhub-export__item'},[(0,T.createElementVNode)('input',{class:'cardhub-export__checkbox',type:'checkbox',checked:(0,T.unref)(ve)(e.id),onChange:n=>(0,T.unref)(xe)(e.id)},null,40,ra),(0,T.createElementVNode)('div',oa,[(0,T.createElementVNode)('div',ca,(0,T.toDisplayString)(e.name),1),(0,T.createElementVNode)('div',ia,[(0,T.createElementVNode)('span',null,(0,T.toDisplayString)('tavern'===e.origin?'已导入':'未导入'),1),(0,T.createElementVNode)('span',null,(0,T.toDisplayString)(De(e).length)+' 标签',1)]),De(e).length?((0,T.openBlock)(),(0,T.createElementBlock)('div',la,[((0,T.openBlock)(!0),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(De(e).slice(0,3),e=>((0,T.openBlock)(),(0,T.createElementBlock)('span',{key:e,class:'cardhub-export__tag'},(0,T.toDisplayString)(e),1))),128))])):(0,T.createCommentVNode)('v-if',!0)])]))),128))])])])):(0,T.createCommentVNode)('v-if',!0),C.value?((0,T.openBlock)(),(0,T.createElementBlock)('div',{key:3,class:'cardhub-theme cardhub-modal',onClick:(0,T.withModifiers)(Oa,['self'])},[(0,T.createElementVNode)('div',da,[(0,T.createElementVNode)('div',{class:'cardhub-theme__header'},[a[73]||(a[73]=(0,T.createElementVNode)('div',null,[(0,T.createElementVNode)('div',{class:'cardhub-theme__title'},'配色设置'),(0,T.createElementVNode)('div',{class:'cardhub-theme__subtitle'},'修改后可直接预览，保存到全局')],-1)),(0,T.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Oa},'×')]),(0,T.createElementVNode)('div',sa,[(0,T.createElementVNode)('label',ua,[a[74]||(a[74]=(0,T.createElementVNode)('span',null,'背景渐变 1',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[48]||(a[48]=e=>N.bgStart=e),type:'color'},null,512),[[T.vModelText,N.bgStart]])]),(0,T.createElementVNode)('label',pa,[a[75]||(a[75]=(0,T.createElementVNode)('span',null,'背景渐变 2',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[49]||(a[49]=e=>N.bgEnd=e),type:'color'},null,512),[[T.vModelText,N.bgEnd]])]),(0,T.createElementVNode)('label',ba,[a[76]||(a[76]=(0,T.createElementVNode)('span',null,'卡片/面板底色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[50]||(a[50]=e=>N.surface=e),type:'color'},null,512),[[T.vModelText,N.surface]])]),(0,T.createElementVNode)('label',ha,[a[77]||(a[77]=(0,T.createElementVNode)('span',null,'浅色底',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[51]||(a[51]=e=>N.surfaceAlt=e),type:'color'},null,512),[[T.vModelText,N.surfaceAlt]])]),(0,T.createElementVNode)('label',ga,[a[78]||(a[78]=(0,T.createElementVNode)('span',null,'主文本',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[52]||(a[52]=e=>N.text=e),type:'color'},null,512),[[T.vModelText,N.text]])]),(0,T.createElementVNode)('label',ma,[a[79]||(a[79]=(0,T.createElementVNode)('span',null,'次级文本',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[53]||(a[53]=e=>N.textMuted=e),type:'color'},null,512),[[T.vModelText,N.textMuted]])]),(0,T.createElementVNode)('label',fa,[a[80]||(a[80]=(0,T.createElementVNode)('span',null,'强调色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[54]||(a[54]=e=>N.accent=e),type:'color'},null,512),[[T.vModelText,N.accent]])]),(0,T.createElementVNode)('label',va,[a[81]||(a[81]=(0,T.createElementVNode)('span',null,'强调深色',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[55]||(a[55]=e=>N.accentStrong=e),type:'color'},null,512),[[T.vModelText,N.accentStrong]])]),(0,T.createElementVNode)('label',xa,[a[82]||(a[82]=(0,T.createElementVNode)('span',null,'边框',-1)),(0,T.withDirectives)((0,T.createElementVNode)('input',{'onUpdate:modelValue':a[56]||(a[56]=e=>N.border=e),type:'color'},null,512),[[T.vModelText,N.border]])])]),(0,T.createElementVNode)('div',_a,[((0,T.openBlock)(),(0,T.createElementBlock)(T.Fragment,null,(0,T.renderList)(H,e=>(0,T.createElementVNode)('button',{key:e.name,class:'cardhub-theme__preset',type:'button',onClick:n=>function(e){Object.assign(N,e.value)}(e)},(0,T.toDisplayString)(e.name),9,ya)),64))]),(0,T.createElementVNode)('div',{class:'cardhub-theme__actions'},[(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:Ua},'恢复默认'),a[83]||(a[83]=(0,T.createElementVNode)('div',{class:'cardhub-theme__spacer'},null,-1)),(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-secondary',type:'button',onClick:Oa},'取消'),(0,T.createElementVNode)('button',{class:'cardhub-theme__btn is-primary',type:'button',onClick:Ka},'保存')])])])):(0,T.createCommentVNode)('v-if',!0)],6))}}),Sa=Va;function Ba(){const e=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        width: 100vw;\n        height: 100vh;\n        min-height: 100vh;\n        height: 100dvh;\n        min-height: 100dvh;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: var(--cardhub-text, #1b1b1b);\n        --cardhub-bg-start: #fff9f0;\n        --cardhub-bg-end: #f3e4d4;\n        --cardhub-surface: #fffaf4;\n        --cardhub-surface-alt: #fff6ea;\n        --cardhub-text: #1b1b1b;\n        --cardhub-text-muted: #7d5b46;\n        --cardhub-accent: #e7b191;\n        --cardhub-accent-strong: #3a2a22;\n        --cardhub-border: #e2c7b3;\n        --cardhub-surface-rgb: 255, 250, 244;\n        --cardhub-surface-alt-rgb: 255, 246, 234;\n        --cardhub-border-rgb: 226, 199, 179;\n        --cardhub-accent-rgb: 231, 177, 145;\n        --cardhub-accent-strong-rgb: 58, 42, 34;\n        --cardhub-accent-text: #1b1b1b;\n        --cardhub-accent-strong-text: #ffffff;\n        --cardhub-shadow-strong: 0 26px 70px rgba(43, 32, 24, 0.22);\n        --cardhub-shadow-soft: 0 12px 26px rgba(43, 32, 24, 0.16);\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        animation: cardhub-backdrop-in 220ms ease;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, var(--cardhub-bg-start), var(--cardhub-bg-end));\n        border-radius: 28px;\n        box-shadow: var(--cardhub-shadow-strong);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        animation: cardhub-panel-in 240ms ease;\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-theme-trigger {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.4);\n        color: var(--cardhub-text);\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.65);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n        align-items: center;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n        height: 32px;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n        cursor: pointer;\n        font-size: 12px;\n        height: 32px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease, color 160ms ease;\n        box-shadow: 0 6px 16px rgba(var(--cardhub-accent-rgb), 0.2);\n      }\n\n      .cardhub-button:hover {\n        background: rgba(var(--cardhub-accent-rgb), 0.85);\n        color: var(--cardhub-accent-text);\n        box-shadow: 0 8px 18px rgba(var(--cardhub-accent-rgb), 0.3);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: rgba(var(--cardhub-surface-rgb), 0.75);\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-button,\n      .cardhub-export__btn,\n      .cardhub-batch__btn,\n      .cardhub-theme__btn,\n      .cardhub-confirm__button {\n        height: 32px;\n        padding: 6px 12px;\n        line-height: 1;\n        font-weight: 500;\n        letter-spacing: 0.2px;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        overflow: auto;\n        min-height: 0;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(var(--cardhub-border-rgb), 0.6);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.92);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-border-rgb), 0.18),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.35);\n      }\n\n      .cardhub-chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 12px 22px rgba(43, 32, 24, 0.2),\n          0 0 0 1px rgba(var(--cardhub-accent-strong-rgb), 0.45);\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.96);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(var(--cardhub-border-rgb), 0.24);\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n        box-shadow: 0 10px 20px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-chip--more {\n        margin-top: 4px;\n      }\n\n      .cardhub-filter-row {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-filter-block {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-filter-block + .cardhub-filter-block {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.8);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.08);\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(var(--cardhub-border-rgb), 0.95);\n        transform: translateY(-1px);\n        box-shadow: 0 8px 16px rgba(43, 32, 24, 0.12);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n        box-shadow: var(--cardhub-shadow-soft);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, var(--cardhub-bg-start), var(--cardhub-accent));\n        background-size: cover;\n        background-position: center;\n        color: var(--cardhub-text);\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__info {\n        min-width: 0;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n        min-width: 0;\n        flex: 1;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n\n      .cardhub-card__head {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n      }\n\n      .cardhub-fav {\n        border: none;\n        background: rgba(var(--cardhub-border-rgb), 0.3);\n        color: var(--cardhub-text-muted);\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-fav.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        box-shadow:\n          0 6px 14px rgba(var(--cardhub-accent-strong-rgb), 0.35),\n          0 0 0 2px rgba(var(--cardhub-accent-strong-rgb), 0.25);\n        transform: scale(1.06);\n      }\n\n      .cardhub-fav:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-fav:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-card__note {\n        margin-top: 6px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        word-break: break-word;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(var(--cardhub-accent-strong-rgb), 0.45);\n        background: rgba(var(--cardhub-accent-strong-rgb), 0.18);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(var(--cardhub-border-rgb), 0.9);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        max-width: 100%;\n        color: var(--cardhub-text);\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-edit {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        min-width: 0;\n        max-width: 100%;\n      }\n\n      .cardhub-tag-confirm {\n        border: none;\n        background: rgba(var(--cardhub-accent-rgb), 0.2);\n        color: var(--cardhub-text);\n        width: 22px;\n        height: 22px;\n        border-radius: 999px;\n        cursor: pointer;\n        font-size: 12px;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(var(--cardhub-border-rgb), 1);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n        box-shadow:\n          0 10px 22px rgba(43, 32, 24, 0.22),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.45);\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.95);\n        color: var(--cardhub-text);\n        box-shadow:\n          0 10px 20px rgba(43, 32, 24, 0.16),\n          0 0 0 1px rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.5);\n        color: var(--cardhub-text);\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.75);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__name {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-note-trigger {\n        border: none;\n        width: 26px;\n        height: 26px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-border-rgb), 0.35);\n        color: var(--cardhub-text);\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-note-trigger:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.55);\n      }\n\n      .cardhub-note-trigger:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 26px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.9);\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__detail-toggle {\n        justify-self: end;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 2px 0;\n      }\n\n      .cardhub-manage__toggle {\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: rgba(var(--cardhub-accent-strong-rgb), 0.6);\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.98);\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(var(--cardhub-border-rgb), 0.5);\n      }\n\n      .cardhub-manage__opening-title {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        margin-bottom: 4px;\n      }\n\n      .cardhub-manage__opening-body {\n        font-size: 12px;\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__opening-toggle {\n        margin-top: 6px;\n        border: none;\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        font-size: 11px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(var(--cardhub-border-rgb), 0.2);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: var(--cardhub-text);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-text {\n        color: var(--cardhub-text);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__pager {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        margin-top: 8px;\n      }\n\n      .cardhub-manage__pager-btn {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.95);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__pager-btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-manage__pager-status {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-manage__actions {\n        padding-top: 12px;\n        border-top: 1px dashed rgba(var(--cardhub-border-rgb), 0.6);\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-root .cardhub-modal {\n        position: fixed !important;\n        inset: 0 !important;\n        display: grid !important;\n        place-items: center !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        height: 100dvh !important;\n      }\n\n      .cardhub-root .cardhub-modal__panel {\n        position: fixed !important;\n        left: 50% !important;\n        top: 50% !important;\n        transform: translate(-50%, -50%) !important;\n        margin: 0 !important;\n      }\n\n      .cardhub-note {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 200000;\n      }\n\n      .cardhub-note__panel {\n        width: min(520px, 92vw);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        position: relative;\n      }\n\n      .cardhub-note__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-note__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-note__input {\n        width: 100%;\n        min-height: 120px;\n        border-radius: 14px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        padding: 10px 12px;\n        font-size: 13px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        resize: vertical;\n      }\n\n      .cardhub-note__actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n\n      .cardhub-note__btn {\n        border: none;\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-note__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-manage-viewer {\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-manage-viewer__panel {\n        width: min(620px, 92vw);\n        max-height: 80vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 24px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        position: relative;\n        display: grid;\n        gap: 12px;\n        overflow: auto;\n        overflow-x: hidden;\n      }\n\n      .cardhub-manage-viewer__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-manage-viewer__title {\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .cardhub-manage-viewer__content {\n        font-size: 13px;\n        line-height: 1.6;\n        color: var(--cardhub-text);\n        white-space: pre-wrap;\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      }\n\n      .cardhub-note__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-note__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100011;\n      }\n\n      .cardhub-tag-manager__panel {\n        width: min(700px, 92vw);\n        max-height: 82vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        grid-template-rows: auto auto 1fr;\n        position: relative;\n      }\n\n      .cardhub-tag-manager__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-tag-manager__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-tag-manager__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-tag-manager__tabs {\n        display: flex;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__tab {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__tab.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__tab:not(.is-active):hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__section {\n        display: grid;\n        gap: 12px;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__actions {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-tag-manager__spacer {\n        flex: 1;\n      }\n\n      .cardhub-tag-manager__btn {\n        border: none;\n        border-radius: 999px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-tag-manager__btn.is-primary {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n      }\n\n      .cardhub-tag-manager__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-tag-manager__btn:disabled {\n        opacity: 0.5;\n        cursor: default;\n      }\n\n      .cardhub-tag-manager__btn:not(:disabled):hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-tag-manager__list {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n      }\n\n      .cardhub-tag-manager__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-manager__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-tag-manager__chip:hover {\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag-manager__batch {\n        display: grid;\n        grid-template-rows: auto auto auto auto 1fr;\n        min-height: 0;\n      }\n\n      .cardhub-tag-manager__batch .cardhub-batch__list {\n        max-height: none;\n        min-height: 0;\n        overflow: auto;\n      }\n\n      .cardhub-export {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        z-index: 100003;\n      }\n\n      .cardhub-export__panel {\n        width: min(720px, 92vw);\n        max-height: 86vh;\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n        overflow: hidden;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-export__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-export__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-export__filters {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-export__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 6px 12px;\n        background: var(--cardhub-surface);\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__filter-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-export__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-export__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-export__chip:not(.is-active):hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.85);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-export__chip--clear {\n        margin-left: auto;\n      }\n\n      .cardhub-export__spacer {\n        flex: 1;\n      }\n\n      .cardhub-export__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-export__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-export__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-export__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-export__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 4px;\n        max-height: 58vh;\n      }\n\n      .cardhub-export__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 10px;\n        align-items: center;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        cursor: pointer;\n      }\n\n      .cardhub-export__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-export__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-export__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-export__name {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-export__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-export__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-export__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__filters {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-batch__search {\n        border-radius: 999px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 8px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__hint {\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__field input {\n        width: 100%;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n        padding: 10px 12px;\n        font-size: 13px;\n        background: rgba(var(--cardhub-surface-rgb), 0.85);\n      }\n\n      .cardhub-batch__suggestions {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-batch__suggest-title {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__suggest-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__chip {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: var(--cardhub-text);\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-batch__chip.is-active {\n        background: var(--cardhub-accent-strong);\n        color: var(--cardhub-accent-strong-text);\n        border-color: transparent;\n      }\n\n      .cardhub-batch__toolbar {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .cardhub-batch__spacer {\n        flex: 1;\n      }\n\n      .cardhub-batch__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-batch__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-batch__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.7);\n      }\n\n      .cardhub-batch__btn.is-ghost {\n        background: rgba(var(--cardhub-accent-rgb), 0.12);\n        color: var(--cardhub-accent-strong);\n      }\n\n      .cardhub-batch__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-batch__list {\n        display: grid;\n        gap: 8px;\n        overflow: auto;\n        padding-right: 6px;\n        max-height: 42vh;\n      }\n\n      .cardhub-batch__item {\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        padding: 10px 12px;\n        border-radius: 12px;\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.4);\n        background: rgba(var(--cardhub-surface-alt-rgb), 0.75);\n        cursor: pointer;\n        transition: border-color 160ms ease;\n      }\n\n      .cardhub-batch__item:hover {\n        border-color: rgba(var(--cardhub-border-rgb), 0.8);\n      }\n\n      .cardhub-batch__checkbox {\n        width: 16px;\n        height: 16px;\n      }\n\n      .cardhub-batch__main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-batch__name {\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .cardhub-batch__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 11px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-batch__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n      }\n\n      .cardhub-batch__tag {\n        padding: 3px 8px;\n        border-radius: 999px;\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        font-size: 10px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme {\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        z-index: 100005;\n      }\n\n      .cardhub-theme__panel {\n        width: min(640px, 92vw);\n        max-height: calc(100% - 48px);\n        background: var(--cardhub-surface-alt);\n        border-radius: 22px;\n        box-shadow: var(--cardhub-shadow-strong);\n        padding: 18px 20px;\n        display: grid;\n        gap: 14px;\n        overflow: auto;\n        margin: auto;\n        position: relative;\n      }\n\n      .cardhub-theme__header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 12px;\n      }\n\n      .cardhub-theme__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--cardhub-text);\n      }\n\n      .cardhub-theme__subtitle {\n        font-size: 12px;\n        color: var(--cardhub-text-muted);\n      }\n\n      .cardhub-theme__grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n      }\n\n      .cardhub-theme__field {\n        display: grid;\n        gap: 6px;\n        font-size: 12px;\n        color: var(--cardhub-text);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n        border-radius: 14px;\n        padding: 10px 12px;\n      }\n\n      .cardhub-theme__field input[type=\'color\'] {\n        width: 100%;\n        height: 36px;\n        border: none;\n        background: transparent;\n        cursor: pointer;\n      }\n\n      .cardhub-theme__actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-theme__presets {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-theme__preset {\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n        background: rgba(var(--cardhub-surface-rgb), 0.9);\n        color: var(--cardhub-text-muted);\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-theme__preset:hover {\n        background: rgba(var(--cardhub-surface-rgb), 0.98);\n        border-color: rgba(var(--cardhub-border-rgb), 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-theme__spacer {\n        flex: 1;\n      }\n\n      .cardhub-theme__btn {\n        border: none;\n        border-radius: 999px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-theme__btn.is-primary {\n        background: var(--cardhub-accent);\n        color: var(--cardhub-accent-text);\n      }\n\n      .cardhub-theme__btn.is-secondary {\n        background: transparent;\n        color: var(--cardhub-text-muted);\n        border: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n      }\n\n      .cardhub-theme__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-fav:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-theme-trigger:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible,\n      .cardhub-export__btn:focus-visible,\n      .cardhub-batch__btn:focus-visible,\n      .cardhub-tag-manager__btn:focus-visible,\n      .cardhub-tag-manager__tab:focus-visible,\n      .cardhub-theme__btn:focus-visible {\n        outline: 2px solid rgba(var(--cardhub-accent-rgb), 0.6);\n        outline-offset: 2px;\n      }\n\n      @keyframes cardhub-panel-in {\n        0% {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        100% {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @keyframes cardhub-backdrop-in {\n        0% {\n          opacity: 0;\n        }\n        100% {\n          opacity: 1;\n        }\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          min-height: 100vh !important;\n          height: 100dvh !important;\n          min-height: 100dvh !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 10px 12px;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          position: sticky;\n          top: 0;\n          z-index: 3;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-title__main {\n          font-size: 18px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 10px;\n        }\n\n        .cardhub-close {\n          width: 26px;\n          height: 26px;\n          font-size: 15px;\n          line-height: 26px;\n        }\n\n        .cardhub-theme-trigger {\n          width: 26px;\n          height: 26px;\n          font-size: 12px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          column-gap: 6px;\n          row-gap: 8px;\n          padding: 8px 12px;\n          position: sticky;\n          top: 44px;\n          z-index: 2;\n          background: var(--cardhub-surface-alt);\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 12px;\n          padding: 6px 10px;\n          height: 34px;\n        }\n\n        .cardhub-toolbar {\n          column-gap: 6px;\n          row-gap: 8px;\n        }\n\n        .cardhub-button {\n          flex: 0 1 auto;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 32px;\n          line-height: 1;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n          -webkit-overflow-scrolling: touch;\n          padding-bottom: env(safe-area-inset-bottom);\n          scroll-padding-bottom: env(safe-area-inset-bottom);\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(var(--cardhub-border-rgb), 0.6);\n          padding: 8px 10px;\n          max-height: none;\n          overflow: visible;\n          background: rgba(var(--cardhub-surface-rgb), 0.65);\n          border-radius: 12px;\n          margin: 0 10px 8px;\n          gap: 8px;\n        }\n\n        .cardhub-section-title {\n          font-size: 9px;\n          margin-bottom: 4px;\n        }\n\n        .cardhub-filter-row {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-filter-block {\n          gap: 6px;\n        }\n\n        .cardhub-filter-block .cardhub-chip-row {\n          flex-wrap: wrap;\n          overflow: visible;\n          mask-image: none;\n          -webkit-mask-image: none;\n        }\n\n        .cardhub-divider {\n          margin: 4px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: nowrap;\n          overflow-x: auto;\n          -webkit-overflow-scrolling: touch;\n          gap: 6px;\n          padding-bottom: 4px;\n          mask-image: linear-gradient(90deg, transparent 0%, #000 12px, #000 calc(100% - 12px), transparent 100%);\n          -webkit-mask-image: linear-gradient(\n            90deg,\n            transparent 0%,\n            #000 12px,\n            #000 calc(100% - 12px),\n            transparent 100%\n          );\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 6px 10px;\n          min-height: 30px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n          min-height: 28px;\n          line-height: 1;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 10px;\n          padding-bottom: calc(10px + env(safe-area-inset-bottom));\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n          position: sticky;\n          bottom: 0;\n          background: var(--cardhub-surface-alt);\n          padding: 8px 12px 6px;\n          padding-right: 72px;\n          border-top: 1px solid rgba(var(--cardhub-border-rgb), 0.5);\n          z-index: 1;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-pagination__status {\n          position: absolute;\n          right: 12px;\n          top: 10px;\n          font-size: 10px;\n          white-space: nowrap;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: 1fr;\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-fav {\n          width: 22px;\n          height: 22px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__note {\n          font-size: 10px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n          color: var(--cardhub-text);\n        }\n\n        .cardhub-tag-confirm {\n          width: 20px;\n          height: 20px;\n          font-size: 11px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__detail-toggle,\n        .cardhub-manage__toggle,\n        .cardhub-manage__opening-toggle {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__opening-title {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__opening-body {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n          overflow-wrap: anywhere;\n          word-break: break-word;\n        }\n\n        .cardhub-manage__pager {\n          gap: 8px;\n        }\n\n        .cardhub-manage__pager-btn {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-manage__pager-status {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n\n        .cardhub-export__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-export__filters {\n          gap: 8px;\n        }\n\n        .cardhub-export__search {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-export__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-export__list {\n          max-height: 48vh;\n        }\n\n        .cardhub-export__item {\n          grid-template-columns: auto 1fr;\n          gap: 8px;\n          padding: 8px 10px;\n        }\n\n        .cardhub-export__name {\n          font-size: 12px;\n        }\n\n        .cardhub-export__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-export__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-note__input {\n          min-height: 100px;\n          font-size: 12px;\n        }\n\n        .cardhub-tag-manager__tab {\n          font-size: 11px;\n          padding: 5px 10px;\n        }\n\n        .cardhub-tag-manager__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-tag-manager__chip {\n          font-size: 10px;\n          padding: 5px 9px;\n        }\n\n        .cardhub-batch__toolbar {\n          gap: 6px;\n        }\n\n        .cardhub-batch__search,\n        .cardhub-batch__field input {\n          font-size: 12px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-batch__chip {\n          font-size: 10px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-batch__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-batch__list {\n          max-height: 40vh;\n        }\n\n        .cardhub-tag-manager__batch .cardhub-batch__list {\n          max-height: none;\n        }\n\n        .cardhub-batch__name {\n          font-size: 12px;\n        }\n\n        .cardhub-batch__meta {\n          font-size: 10px;\n        }\n\n        .cardhub-batch__tag {\n          font-size: 9px;\n        }\n\n        .cardhub-theme__grid {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px 10px;\n        }\n\n        .cardhub-theme__field {\n          font-size: 11px;\n          padding: 6px 10px;\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          gap: 10px;\n          flex: 1 1 calc(50% - 6px);\n          min-width: 0;\n        }\n\n        .cardhub-theme__field span {\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-theme__field input[type=\'color\'] {\n          height: 26px;\n          width: 70px;\n        }\n\n        .cardhub-theme__btn {\n          font-size: 11px;\n          padding: 6px 10px;\n          height: 28px;\n        }\n\n        .cardhub-theme__presets {\n          gap: 6px;\n        }\n\n        .cardhub-theme__preset {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-root .cardhub-modal {\n          position: fixed !important;\n          inset: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          height: 100dvh !important;\n          display: grid !important;\n          place-items: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root .cardhub-modal__panel {\n          position: fixed !important;\n          left: 50% !important;\n          top: 50% !important;\n          transform: translate(-50%, -50%) !important;\n          margin: 0 !important;\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n          overflow-x: hidden !important;\n        }\n      }\n    ').appendTo('head'),n=$('<div>').attr('script_id',getScriptId()).addClass('cardhub-mount').appendTo('body'),a=(0,T.createApp)(Sa);return a.mount(n[0]),(0,T.watch)(()=>A.open,()=>{},{immediate:!0}),{app:a,mount:n,style:e}}let Ta=null;function za(){Ta||(Ta=Ba())}function Aa(){return{open:(e='manual')=>{za(),D(!0,e)},close:()=>{D(!1)},toggle:(e='manual')=>{za(),D(!A.open,e)},refresh:async()=>{za(),await async function(){M(!0);try{L(await t()),j(V())}finally{M(!1)}}()},destroy:()=>{Ta&&function(e){e.app.unmount(),e.mount.remove(),e.style.remove()}(Ta),Ta=null}}}function Da(){const n=Aa(),a=e(n);n.refresh(),$(window).on('pagehide',()=>{a(),n.destroy()})}$(()=>{errorCatched(Da)()});
//# sourceMappingURL=index.js.map