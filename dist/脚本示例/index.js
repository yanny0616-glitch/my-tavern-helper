import{createPinia as n,defineStore as a,storeToRefs as e}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';import{default as r}from'https://testingcf.jsdelivr.net/npm/dedent/+esm';import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';var i={61(n){n.exports=Vue},119(){$(()=>{replaceScriptButtons([{name:'晚上好',visible:!0}]),eventOn(getButtonEvent('晚上好'),()=>{toastr.warning('晚安, 络络')})})},205(n,a,e){var t=e(383);t.__esModule&&(t=t.default),'string'==typeof t&&(t=[[n.id,t,'']]),t.locals&&(n.exports=t.locals);(0,e(424).A)('2292e056',t,!1,{ssrId:!0})},331(){$(()=>{toastr.success('你已经成功加载示例脚本!','恭喜你!')}),$(window).on('pagehide',()=>{toastr.info('你已经卸载示例脚本!','再见!')})},337(n,a,e){function t(n='head'){const a=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone()).appendTo(n);return{destroy:()=>a.remove()}}function r(){return $('<div>').attr('script_id',getScriptId())}function i(){let n=SillyTavern.getCurrentChatId();return eventOn(tavern_events.CHAT_CHANGED,a=>{n!==a&&(n=a,window.location.reload())})}e.d(a,{N7:()=>t,g8:()=>r,hb:()=>i})},383(n,a,e){e.r(a),e.d(a,{default:()=>c});var t=e(492),r=e.n(t),i=e(748),o=e.n(i)()(r());o.push([n.id,'.cardhub-root[data-v-fe13b558]{position:fixed;inset:0;z-index:9999;font-family:"ZCOOL XiaoWei","STSong","Songti SC","SimSun",serif;color:#1b1b1b;display:none;align-items:center;justify-content:center}.cardhub-root.open[data-v-fe13b558]{display:flex;align-items:center;justify-content:center}.cardhub-backdrop[data-v-fe13b558]{position:absolute;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(6px);opacity:0;transition:opacity 180ms ease}.cardhub-root.open .cardhub-backdrop[data-v-fe13b558]{opacity:1}.cardhub-panel[data-v-fe13b558]{position:relative;width:min(980px,94%);max-height:92%;background:linear-gradient(160deg,#fff9f0,#f3e4d4);border-radius:28px;box-shadow:0 30px 90px rgba(0,0,0,0.28);display:flex;flex-direction:column;overflow:hidden;z-index:1;opacity:0;transform:translateY(8px) scale(0.985);transition:opacity 180ms ease,transform 180ms ease}.cardhub-root.open .cardhub-panel[data-v-fe13b558]{opacity:1;transform:translateY(0) scale(1)}.cardhub-header[data-v-fe13b558]{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid rgba(86,59,44,0.15)}.cardhub-title__main[data-v-fe13b558]{font-size:26px;letter-spacing:2px}.cardhub-title__sub[data-v-fe13b558]{font-size:12px;color:#7d5b46;margin-left:10px}.cardhub-actions[data-v-fe13b558]{display:flex;gap:10px}.cardhub-close[data-v-fe13b558]{border:none;background:rgba(43,32,24,0.12);color:#3b2a20;width:34px;height:34px;border-radius:999px;font-size:20px;line-height:34px;text-align:center;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-close[data-v-fe13b558]:hover{background:rgba(43,32,24,0.2)}.cardhub-close[data-v-fe13b558]:active{transform:scale(0.96)}.cardhub-toolbar[data-v-fe13b558]{display:flex;gap:8px;padding:12px 20px;flex-wrap:wrap}.cardhub-search[data-v-fe13b558]{flex:1;min-width:180px;border-radius:999px;border:1px solid rgba(86,59,44,0.2);padding:6px 12px;background:#fffaf4}.cardhub-button[data-v-fe13b558]{border:none;padding:6px 14px;border-radius:999px;background:#d46b3d;color:#fff;cursor:pointer;font-size:12px;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-button[data-v-fe13b558]:hover{background:#c55f36;box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-button[data-v-fe13b558]:active{transform:translateY(1px)}.cardhub-button.is-ghost[data-v-fe13b558]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-button.is-ghost[data-v-fe13b558]:hover{background:rgba(106,63,42,0.08);border-color:rgba(106,63,42,0.6);box-shadow:none}.cardhub-import-input[data-v-fe13b558]{display:none}.cardhub-body[data-v-fe13b558]{display:grid;grid-template-columns:minmax(160px,220px) 1fr;gap:0;flex:1;min-height:0}.cardhub-sidebar[data-v-fe13b558]{padding:20px;border-right:1px solid rgba(86,59,44,0.15);display:flex;flex-direction:column;gap:12px}.cardhub-chip-row[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-divider[data-v-fe13b558]{height:1px;width:100%;background:rgba(86,59,44,0.15);margin:8px 0}.cardhub-section-title[data-v-fe13b558]{font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-chip[data-v-fe13b558]{text-align:left;border:none;background:rgba(255,255,255,0.6);border-radius:12px;padding:8px 10px;cursor:pointer;font-size:12px;transition:background-color 160ms ease,color 160ms ease,transform 120ms ease}.cardhub-chip.is-active[data-v-fe13b558]{background:#2b2018;color:#fff5ea}.cardhub-chip[data-v-fe13b558]:not(.is-active):hover{background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-placeholder[data-v-fe13b558]{font-size:12px;color:#9a7a63}.cardhub-tag-filter[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-tag-filter__chip[data-v-fe13b558]{border:1px solid rgba(106,63,42,0.25);background:rgba(255,255,255,0.7);border-radius:999px;padding:6px 10px;font-size:12px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag-filter__chip.is-active[data-v-fe13b558]{background:#2b2018;color:#fff5ea;border-color:transparent}.cardhub-tag-filter__chip[data-v-fe13b558]:not(.is-active):hover{border-color:rgba(106,63,42,0.45);background:rgba(255,255,255,0.9);transform:translateY(-1px)}.cardhub-chip--clear[data-v-fe13b558]{margin-top:8px}.cardhub-content[data-v-fe13b558]{padding:20px;overflow:auto;flex:1;min-height:0}.cardhub-grid-wrap[data-v-fe13b558]{display:grid;gap:12px}.cardhub-pagination[data-v-fe13b558]{display:flex;align-items:center;justify-content:flex-end;gap:10px;flex-wrap:wrap}.cardhub-pagination__status[data-v-fe13b558]{font-size:12px;color:#7d5b46}.cardhub-pagination__actions[data-v-fe13b558]{display:flex;gap:8px;align-items:center;margin-right:auto}.cardhub-pagination__button[data-v-fe13b558]{border:1px solid rgba(106,63,42,0.35);background:rgba(255,255,255,0.85);color:#6a3f2a;border-radius:999px;padding:4px 10px;font-size:11px;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-pagination__button[data-v-fe13b558]:disabled{opacity:0.4;cursor:default}.cardhub-pagination__button[data-v-fe13b558]:not(:disabled):hover{background:rgba(255,255,255,1);border-color:rgba(106,63,42,0.6);transform:translateY(-1px)}.cardhub-pagination__button[data-v-fe13b558]:not(:disabled):active{transform:translateY(0)}.cardhub-loading[data-v-fe13b558],.cardhub-empty[data-v-fe13b558]{padding:40px 0;text-align:center;color:#7d5b46}.cardhub-grid[data-v-fe13b558]{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));justify-items:center}.cardhub-card[data-v-fe13b558]{background:rgba(255,255,255,0.78);border-radius:18px;padding:14px;display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;border:1px solid rgba(86,59,44,0.15);cursor:pointer;transition:transform 140ms ease,box-shadow 180ms ease,border-color 180ms ease;width:100%;max-width:260px}.cardhub-card[data-v-fe13b558]:hover{transform:translateY(-2px);border-color:rgba(86,59,44,0.25);box-shadow:0 12px 26px rgba(43,32,24,0.16)}.cardhub-card[data-v-fe13b558]:active{transform:translateY(0)}.cardhub-card__avatar[data-v-fe13b558]{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#f4d7c4,#d36a3b);background-size:cover;background-position:center;color:#4a2a1f;display:grid;place-items:center;font-weight:700}.cardhub-card__avatar.has-avatar span[data-v-fe13b558]{display:none}.cardhub-card__name[data-v-fe13b558]{font-size:14px;font-weight:600}.cardhub-card__meta[data-v-fe13b558]{display:flex;gap:8px;font-size:11px;color:#7d5b46}.cardhub-card__tags[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}.cardhub-tag[data-v-fe13b558]{border:1px solid rgba(106,63,42,0.3);background:#fff6ea;border-radius:999px;padding:4px 8px;font-size:11px;color:#6a3f2a;cursor:pointer;transition:background-color 160ms ease,border-color 160ms ease,transform 120ms ease}.cardhub-tag[data-v-fe13b558]:hover{background:#fffaf4;border-color:rgba(106,63,42,0.5);transform:translateY(-1px)}.cardhub-tag__remove[data-v-fe13b558]{margin-left:4px;font-weight:700}.cardhub-tag.is-add[data-v-fe13b558]{background:transparent;border-style:dashed}.cardhub-tag-input[data-v-fe13b558]{border:1px dashed rgba(106,63,42,0.5);background:#fffaf4;border-radius:999px;padding:4px 10px;font-size:11px;min-width:80px;color:#6a3f2a;outline:none;height:24px;line-height:16px}.cardhub-tag-input[data-v-fe13b558]:focus{border-color:rgba(106,63,42,0.85)}.cardhub-card__action[data-v-fe13b558]{grid-column:span 2;margin-top:10px;border:none;background:#2b2018;color:#fff5ea;padding:6px 12px;border-radius:12px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease}.cardhub-card__actions[data-v-fe13b558]{grid-column:span 2;display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}.cardhub-card__action.is-secondary[data-v-fe13b558]{background:#d9c6b6;color:#3b2a20}.cardhub-card__action[data-v-fe13b558]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-card__action[data-v-fe13b558]:active{transform:translateY(0)}.cardhub-preview[data-v-fe13b558]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100000}.cardhub-preview__panel[data-v-fe13b558]{width:min(520px,92vw);background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:20px;position:relative;display:grid;gap:14px}.cardhub-preview__close[data-v-fe13b558]{position:absolute;top:14px;right:14px;border:none;width:30px;height:30px;border-radius:999px;background:rgba(43,32,24,0.15);color:#3b2a20;font-size:18px;cursor:pointer;transition:background-color 160ms ease,transform 120ms ease}.cardhub-preview__close[data-v-fe13b558]:hover{background:rgba(43,32,24,0.25)}.cardhub-preview__close[data-v-fe13b558]:active{transform:scale(0.96)}.cardhub-preview__avatar[data-v-fe13b558]{width:100%;height:260px;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-preview__avatar img[data-v-fe13b558]{width:100%;height:100%;object-fit:contain}.cardhub-preview__info[data-v-fe13b558]{display:grid;gap:6px}.cardhub-preview__name[data-v-fe13b558]{font-size:20px;font-weight:700}.cardhub-preview__meta[data-v-fe13b558]{display:flex;gap:10px;font-size:12px;color:#7d5b46}.cardhub-preview__tags[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:8px}.cardhub-preview__tag[data-v-fe13b558]{padding:6px 10px;border-radius:999px;border:1px solid rgba(106,63,42,0.3);background:#fffaf4;font-size:12px;color:#6a3f2a}.cardhub-preview__actions[data-v-fe13b558]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-manage[data-v-fe13b558]{position:fixed;inset:0;background:rgba(24,16,10,0.45);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100001}.cardhub-manage__panel[data-v-fe13b558]{width:min(760px,94vw);max-height:88vh;background:#fff6ea;border-radius:26px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:22px;position:relative;display:grid;gap:16px;overflow:auto}.cardhub-manage__top[data-v-fe13b558]{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}.cardhub-manage__media[data-v-fe13b558]{width:220px;aspect-ratio:3/4;height:auto;border-radius:18px;background:#ead7c4;display:grid;place-items:center;overflow:hidden}.cardhub-manage__media img[data-v-fe13b558]{width:100%;height:100%;object-fit:cover}.cardhub-manage__summary[data-v-fe13b558]{display:grid;gap:6px}.cardhub-manage__overview[data-v-fe13b558]{display:grid;gap:10px;margin-top:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.cardhub-manage__overview-card[data-v-fe13b558]{background:rgba(255,255,255,0.7);border:1px solid rgba(106,63,42,0.2);border-radius:14px;padding:10px 12px;display:grid;gap:4px}.cardhub-manage__overview-label[data-v-fe13b558]{font-size:10px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__overview-value[data-v-fe13b558]{font-size:13px;font-weight:600;color:#3b2a20}.cardhub-manage__overview-hint[data-v-fe13b558]{font-size:11px;color:#7d5b46}.cardhub-manage__section[data-v-fe13b558]{display:grid;gap:8px}.cardhub-manage__details[data-v-fe13b558]{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.cardhub-manage__detail[data-v-fe13b558]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;display:grid;gap:6px}.cardhub-manage__detail-label[data-v-fe13b558]{font-size:11px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__detail-content[data-v-fe13b558]{font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap}.cardhub-manage__label[data-v-fe13b558]{display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:12px;color:#7d5b46;text-transform:uppercase;letter-spacing:1px}.cardhub-manage__btn[data-v-fe13b558]{border:none;border-radius:12px;padding:6px 12px;font-size:12px;cursor:pointer;text-transform:none;transition:background-color 160ms ease,transform 120ms ease,box-shadow 160ms ease}.cardhub-manage__btn.is-primary[data-v-fe13b558]{background:#2b2018;color:#fff5ea}.cardhub-manage__btn.is-secondary[data-v-fe13b558]{background:#d9c6b6;color:#3b2a20}.cardhub-manage__jump-row[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:8px;align-items:center}.cardhub-manage__btn[data-v-fe13b558]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.15)}.cardhub-manage__btn.is-primary[data-v-fe13b558]:hover{background:#241a14}.cardhub-manage__btn.is-secondary[data-v-fe13b558]:hover{background:#d1bca8}.cardhub-manage__btn[data-v-fe13b558]:active{transform:translateY(0)}.cardhub-manage__content[data-v-fe13b558]{background:#fffaf4;border:1px solid rgba(106,63,42,0.2);border-radius:16px;padding:12px 14px;font-size:12px;line-height:1.5;color:#3b2a20;white-space:pre-wrap}.cardhub-manage__opening[data-v-fe13b558]{padding:6px 0;border-bottom:1px dashed rgba(106,63,42,0.2)}.cardhub-manage__opening[data-v-fe13b558]:last-child{border-bottom:none}.cardhub-manage__chat[data-v-fe13b558]{display:grid;gap:10px}.cardhub-manage__chat-row[data-v-fe13b558]{display:grid;grid-template-columns:minmax(140px,220px) 1fr;gap:12px;font-size:12px;color:#3b2a20;align-items:start;padding:6px 8px;border-radius:10px;cursor:pointer}.cardhub-manage__chat-row[data-v-fe13b558]:hover{background:rgba(106,63,42,0.08)}.cardhub-manage__chat-main[data-v-fe13b558]{display:grid;gap:4px}.cardhub-manage__chat-name[data-v-fe13b558]{flex:0 0 auto;font-weight:600;color:#6a3f2a;word-break:break-word}.cardhub-manage__chat-label[data-v-fe13b558]{font-size:11px;color:#9a7a63;word-break:break-word}.cardhub-manage__chat-tags[data-v-fe13b558]{display:flex;flex-wrap:wrap;gap:4px}.cardhub-manage__chat-tag[data-v-fe13b558]{padding:2px 6px;border-radius:999px;border:1px solid rgba(106,63,42,0.2);background:rgba(255,255,255,0.75);font-size:10px;color:#6a3f2a}.cardhub-manage__chat-text[data-v-fe13b558]{color:#3b2a20;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.cardhub-manage__empty[data-v-fe13b558]{font-size:12px;color:#9a7a63}.cardhub-manage__actions[data-v-fe13b558]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.cardhub-confirm[data-v-fe13b558]{position:absolute;inset:0;background:rgba(24,16,10,0.55);backdrop-filter:blur(6px);display:grid;place-items:center;z-index:100002}.cardhub-confirm__panel[data-v-fe13b558]{width:min(460px,92vw);background:#fff6ea;border-radius:22px;box-shadow:0 26px 70px rgba(0,0,0,0.25);padding:18px 20px;display:grid;gap:12px}.cardhub-confirm__title[data-v-fe13b558]{font-size:16px;font-weight:600;color:#2b2018}.cardhub-confirm__message[data-v-fe13b558]{font-size:13px;line-height:1.5;color:#4a2a1f;white-space:pre-wrap}.cardhub-confirm__actions[data-v-fe13b558]{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}.cardhub-confirm__button[data-v-fe13b558]{border:none;border-radius:999px;padding:8px 14px;font-size:12px;cursor:pointer;transition:transform 120ms ease,box-shadow 160ms ease,background-color 160ms ease,border-color 160ms ease}.cardhub-confirm__button.is-confirm[data-v-fe13b558]{background:#d46b3d;color:#fff}.cardhub-confirm__button.is-cancel[data-v-fe13b558]{background:transparent;color:#6a3f2a;border:1px solid rgba(106,63,42,0.4)}.cardhub-confirm__button.is-danger[data-v-fe13b558]{background:#b6452a;color:#fff}.cardhub-confirm__button[data-v-fe13b558]:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(43,32,24,0.18)}.cardhub-confirm__button[data-v-fe13b558]:active{transform:translateY(0)}.cardhub-button[data-v-fe13b558]:focus-visible,.cardhub-chip[data-v-fe13b558]:focus-visible,.cardhub-tag-filter__chip[data-v-fe13b558]:focus-visible,.cardhub-tag[data-v-fe13b558]:focus-visible,.cardhub-card__action[data-v-fe13b558]:focus-visible,.cardhub-pagination__button[data-v-fe13b558]:focus-visible,.cardhub-manage__btn[data-v-fe13b558]:focus-visible,.cardhub-close[data-v-fe13b558]:focus-visible,.cardhub-preview__close[data-v-fe13b558]:focus-visible,.cardhub-confirm__button[data-v-fe13b558]:focus-visible{outline:2px solid rgba(212,107,61,0.6);outline-offset:2px}@media (max-width:720px){.cardhub-root[data-v-fe13b558]{position:absolute !important;inset:0 !important;z-index:99999 !important;display:none;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-root.open[data-v-fe13b558]{display:flex !important}.cardhub-backdrop[data-v-fe13b558]{position:absolute !important;inset:0 !important;z-index:99998 !important;background:rgba(0,0,0,0.4) !important;backdrop-filter:blur(8px) !important}.cardhub-panel[data-v-fe13b558]{position:relative !important;width:100% !important;height:100% !important;max-height:100% !important;max-width:none !important;margin:0 !important;border-radius:24px !important;box-shadow:0 12px 48px rgba(0,0,0,0.3),0 2px 8px rgba(0,0,0,0.1) !important;display:flex !important;flex-direction:column !important;z-index:99999 !important;overflow:hidden !important;border:1px solid rgba(255,255,255,0.15) !important}.cardhub-header[data-v-fe13b558]{flex-shrink:0;padding:14px 16px;border-bottom:1px solid rgba(86,59,44,0.12)}.cardhub-title__main[data-v-fe13b558]{font-size:20px}.cardhub-title__sub[data-v-fe13b558]{font-size:11px}.cardhub-close[data-v-fe13b558]{width:28px;height:28px;font-size:16px;line-height:28px}.cardhub-toolbar[data-v-fe13b558]{flex-shrink:0;display:flex;flex-wrap:wrap;gap:8px;padding:10px 14px}.cardhub-search[data-v-fe13b558]{width:100%;font-size:13px;padding:8px 12px}.cardhub-button[data-v-fe13b558]{flex:1;min-width:0;font-size:11px;padding:6px 10px}.cardhub-body[data-v-fe13b558]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:auto}.cardhub-sidebar[data-v-fe13b558]{flex-shrink:0;border-right:none;border-bottom:1px solid rgba(86,59,44,0.12);padding:10px 14px;max-height:none;overflow:visible}.cardhub-section-title[data-v-fe13b558]{font-size:10px;margin-bottom:6px}.cardhub-divider[data-v-fe13b558]{margin:6px 0}.cardhub-chip-row[data-v-fe13b558],.cardhub-tag-filter[data-v-fe13b558]{display:flex;flex-wrap:wrap;overflow:visible;gap:6px;padding-bottom:4px}.cardhub-chip-row[data-v-fe13b558]::-webkit-scrollbar,.cardhub-tag-filter[data-v-fe13b558]::-webkit-scrollbar{height:4px}.cardhub-chip-row[data-v-fe13b558]::-webkit-scrollbar-thumb,.cardhub-tag-filter[data-v-fe13b558]::-webkit-scrollbar-thumb{background:rgba(106,63,42,0.15);border-radius:999px}.cardhub-chip[data-v-fe13b558]{font-size:11px;padding:5px 10px;white-space:nowrap;flex-shrink:0}.cardhub-tag-filter__chip[data-v-fe13b558]{font-size:10px;padding:4px 8px;white-space:nowrap;flex-shrink:0}.cardhub-content[data-v-fe13b558]{flex:1;min-height:0;overflow:visible;padding:12px}.cardhub-pagination[data-v-fe13b558]{align-items:flex-start}.cardhub-pagination__actions[data-v-fe13b558]{width:100%}.cardhub-pagination__button[data-v-fe13b558]{flex:1;text-align:center}.cardhub-grid[data-v-fe13b558]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;justify-content:center;justify-items:center}.cardhub-card[data-v-fe13b558]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:10px;border-radius:14px;min-width:0;width:100%;max-width:none}.cardhub-card__avatar[data-v-fe13b558]{width:40px;height:40px;flex-shrink:0;border-radius:10px}.cardhub-card__info[data-v-fe13b558]{flex:1;min-width:0}.cardhub-card__name[data-v-fe13b558]{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.cardhub-card__meta[data-v-fe13b558]{font-size:10px;gap:6px}.cardhub-card__tags[data-v-fe13b558]{margin-top:4px;gap:4px}.cardhub-tag[data-v-fe13b558]{font-size:9px;padding:3px 6px}.cardhub-card__actions[data-v-fe13b558]{display:flex;flex-direction:column;gap:4px;flex-shrink:0}.cardhub-card__action[data-v-fe13b558]{padding:5px 10px;font-size:10px;border-radius:8px}.cardhub-preview[data-v-fe13b558],.cardhub-manage[data-v-fe13b558]{position:absolute !important;inset:0 !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:16px !important;box-sizing:border-box !important;overflow-y:auto !important}.cardhub-preview__panel[data-v-fe13b558],.cardhub-manage__panel[data-v-fe13b558]{width:calc(100vw - 32px) !important;max-width:360px !important;max-height:calc(100vh - 32px) !important;max-height:calc(100dvh - 32px) !important;border-radius:18px !important;padding:16px !important;overflow:auto !important}.cardhub-preview__avatar[data-v-fe13b558]{height:180px;border-radius:14px}.cardhub-preview__name[data-v-fe13b558]{font-size:16px}.cardhub-preview__meta[data-v-fe13b558]{font-size:11px}.cardhub-preview__tag[data-v-fe13b558]{font-size:10px;padding:4px 8px}.cardhub-preview__actions[data-v-fe13b558]{gap:8px}.cardhub-manage__top[data-v-fe13b558]{grid-template-columns:1fr;gap:12px}.cardhub-manage__media[data-v-fe13b558]{width:120px;margin:0 auto}.cardhub-manage__overview[data-v-fe13b558]{grid-template-columns:1fr}.cardhub-manage__overview-value[data-v-fe13b558]{font-size:12px}.cardhub-manage__overview-hint[data-v-fe13b558]{font-size:10px}.cardhub-manage__label[data-v-fe13b558]{flex-direction:column;align-items:flex-start;gap:6px;font-size:10px}.cardhub-manage__details[data-v-fe13b558]{grid-template-columns:1fr}.cardhub-manage__detail-label[data-v-fe13b558]{font-size:10px}.cardhub-manage__detail-content[data-v-fe13b558]{font-size:11px}.cardhub-manage__btn[data-v-fe13b558]{width:100%;text-align:center;font-size:10px}.cardhub-manage__jump-row[data-v-fe13b558]{width:100%}.cardhub-manage__content[data-v-fe13b558]{font-size:11px;padding:10px}.cardhub-manage__chat-row[data-v-fe13b558]{grid-template-columns:1fr;gap:3px;font-size:11px}.cardhub-manage__chat-label[data-v-fe13b558]{font-size:10px}.cardhub-manage__chat-tag[data-v-fe13b558]{font-size:9px}.cardhub-manage__chat-text[data-v-fe13b558]{-webkit-line-clamp:2}.cardhub-manage__actions[data-v-fe13b558]{grid-template-columns:1fr 1fr;gap:8px}}\n','',{version:3,sources:['webpack://./../../App.vue'],names:[],mappings:'AAyxDA,+BACE,cAAe,CACf,OAAQ,CACR,YAAa,CACb,+DAAoE,CACpE,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,oCACE,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,mCACE,iBAAkB,CAClB,OAAQ,CACR,0BAA8B,CAC9B,yBAA0B,CAC1B,SAAU,CACV,6BACF,CAEA,sDACE,SACF,CAEA,gCACE,iBAAkB,CAClB,oBAAsB,CACtB,cAAe,CACf,kDAAqD,CACrD,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eAAgB,CAChB,SAAU,CACV,SAAU,CACV,sCAAuC,CACvC,kDACF,CAEA,mDACE,SAAU,CACV,gCACF,CAEA,iCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,iBAAkB,CAClB,2CACF,CAEA,sCACE,cAAe,CACf,kBACF,CAEA,qCACE,cAAe,CACf,aAAc,CACd,gBACF,CAEA,kCACE,YAAa,CACb,QACF,CAEA,gCACE,WAAY,CACZ,8BAAkC,CAClC,aAAc,CACd,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,2DACF,CAEA,sCACE,6BACF,CAEA,uCACE,qBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,cACF,CAEA,iCACE,MAAO,CACP,eAAgB,CAChB,mBAAoB,CACpB,mCAAuC,CACvC,gBAAiB,CACjB,kBACF,CAEA,iCACE,WAAY,CACZ,gBAAiB,CACjB,mBAAoB,CACpB,kBAAmB,CACnB,UAAW,CACX,cAAe,CACf,cAAe,CACf,iFACF,CAEA,uCACE,kBAAmB,CACnB,yCACF,CAEA,wCACE,yBACF,CAEA,0CACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,gDACE,+BAAmC,CACnC,gCAAoC,CACpC,eACF,CAEA,uCACE,YACF,CAEA,+BACE,YAAa,CACb,6CAA+C,CAC/C,KAAM,CACN,MAAO,CACP,YACF,CAEA,kCACE,YAAa,CACb,0CAA8C,CAC9C,YAAa,CACb,qBAAsB,CACtB,QACF,CAEA,mCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,kCACE,UAAW,CACX,UAAW,CACX,8BAAkC,CAClC,YACF,CAEA,wCACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,+BACE,eAAgB,CAChB,WAAY,CACZ,gCAAoC,CACpC,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,4EACF,CAEA,yCACE,kBAAmB,CACnB,aACF,CAEA,qDACE,gCAAoC,CACpC,0BACF,CAEA,sCACE,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,2CACE,qCAAyC,CACzC,gCAAoC,CACpC,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,cAAe,CACf,oGACF,CAEA,qDACE,kBAAmB,CACnB,aAAc,CACd,wBACF,CAEA,iEACE,iCAAqC,CACrC,gCAAoC,CACpC,0BACF,CAEA,sCACE,cACF,CAEE,kCACE,YAAa,CACb,aAAc,CACd,MAAO,CACP,YACF,CAEF,oCACE,YAAa,CACb,QACF,CAEA,qCACE,YAAa,CACb,kBAAmB,CACnB,wBAAyB,CACzB,QAAS,CACT,cACF,CAEA,6CACE,cAAe,CACf,aACF,CAEA,8CACE,YAAa,CACb,OAAQ,CACR,kBAAmB,CACnB,iBACF,CAEA,6CACE,qCAAyC,CACzC,iCAAqC,CACrC,aAAc,CACd,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mFACF,CAEA,sDACE,WAAY,CACZ,cACF,CAEA,kEACE,8BAAkC,CAClC,gCAAoC,CACpC,0BACF,CAEA,mEACE,uBACF,CAEA,kEAEE,cAAe,CACf,iBAAkB,CAClB,aACF,CAEA,+BACE,YAAa,CACb,QAAS,CACT,yDAA4D,CAC5D,oBACF,CAEA,+BACE,iCAAqC,CACrC,kBAAmB,CACnB,YAAa,CACb,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,kBAAmB,CACnB,oCAAwC,CACxC,cAAe,CACf,6EAAgF,CAChF,UAAW,CACX,eACF,CAEA,qCACE,0BAA2B,CAC3B,gCAAoC,CACpC,0CACF,CAEA,sCACE,uBACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,kDAAqD,CACrD,qBAAsB,CACtB,0BAA2B,CAC3B,aAAc,CACd,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,uDACE,YACF,CAEA,qCACE,cAAe,CACf,eACF,CAEA,qCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,aACF,CAEA,qCACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,8BACE,oCAAwC,CACxC,kBAAmB,CACnB,mBAAoB,CACpB,eAAgB,CAChB,cAAe,CACf,aAAc,CACd,cAAe,CACf,mFACF,CAEA,oCACE,kBAAmB,CACnB,gCAAoC,CACpC,0BACF,CAEA,sCACE,eAAgB,CAChB,eACF,CAEA,qCACE,sBAAuB,CACvB,mBACF,CAEA,oCACE,qCAAyC,CACzC,kBAAmB,CACnB,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,aAAc,CACd,YAAa,CACb,WAAY,CACZ,gBACF,CAEA,0CACE,iCACF,CAEA,uCACE,kBAAmB,CACnB,eAAgB,CAChB,WAAY,CACZ,kBAAmB,CACnB,aAAc,CACd,gBAAiB,CACjB,kBAAmB,CACnB,cAAe,CACf,cAAe,CACf,iFACF,CAEA,wCACE,kBAAmB,CACnB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,eACF,CAEA,oDACE,kBAAmB,CACnB,aACF,CAEA,6CACE,0BAA2B,CAC3B,yCACF,CAEA,8CACE,uBACF,CAEA,kCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,iBAAkB,CAClB,QAAS,CACT,UAAW,CACX,WAAY,CACZ,UAAW,CACX,WAAY,CACZ,mBAAoB,CACpB,8BAAkC,CAClC,aAAc,CACd,cAAe,CACf,cAAe,CACf,2DACF,CAEA,+CACE,8BACF,CAEA,gDACE,qBACF,CAEA,0CACE,UAAW,CACX,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,8CACE,UAAW,CACX,WAAY,CACZ,kBACF,CAEA,wCACE,YAAa,CACb,OACF,CAEA,wCACE,cAAe,CACf,eACF,CAEA,wCACE,YAAa,CACb,QAAS,CACT,cAAe,CACf,aACF,CAEA,wCACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,uCACE,gBAAiB,CACjB,mBAAoB,CACpB,oCAAwC,CACxC,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,2CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,iCACE,cAAe,CACf,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,wCACE,qBAAuB,CACvB,eAAgB,CAChB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,YAAa,CACb,iBAAkB,CAClB,YAAa,CACb,QAAS,CACT,aACF,CAEA,sCACE,YAAa,CACb,8BAA+B,CAC/B,QAAS,CACT,iBACF,CAEA,wCACE,WAAY,CACZ,gBAAmB,CACnB,WAAY,CACZ,kBAAmB,CACnB,kBAAmB,CACnB,YAAa,CACb,kBAAmB,CACnB,eACF,CAEA,4CACE,UAAW,CACX,WAAY,CACZ,gBACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,2CACE,YAAa,CACb,QAAS,CACT,eAAgB,CAChB,wDACF,CAEA,gDACE,gCAAoC,CACpC,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,YAAa,CACb,OACF,CAEA,iDACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,iDACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,gDACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,OACF,CAEA,0CACE,YAAa,CACb,QAAS,CACT,wDACF,CAEA,yCACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,YAAa,CACb,OACF,CAEA,+CACE,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,iDACE,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,wCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,OAAQ,CACR,cAAe,CACf,aAAc,CACd,wBAAyB,CACzB,kBACF,CAEA,sCACE,WAAY,CACZ,kBAAmB,CACnB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,mBAAoB,CACpB,iFACF,CAEA,iDACE,kBAAmB,CACnB,aACF,CAEA,mDACE,kBAAmB,CACnB,aACF,CAEA,2CACE,YAAa,CACb,cAAe,CACf,OAAQ,CACR,kBACF,CAEA,4CACE,0BAA2B,CAC3B,yCACF,CAEA,uDACE,kBACF,CAEA,yDACE,kBACF,CAEA,6CACE,uBACF,CAEA,0CACE,kBAAmB,CACnB,oCAAwC,CACxC,kBAAmB,CACnB,iBAAkB,CAClB,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,0CACE,aAAc,CACd,4CACF,CAEA,qDACE,kBACF,CAEA,uCACE,YAAa,CACb,QACF,CAEA,2CACE,YAAa,CACb,6CAA+C,CAC/C,QAAS,CACT,cAAe,CACf,aAAc,CACd,iBAAkB,CAClB,eAAgB,CAChB,kBAAmB,CACnB,cACF,CAEA,iDACE,+BACF,CAEA,4CACE,YAAa,CACb,OACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,aAAc,CACd,qBACF,CAEA,6CACE,cAAe,CACf,aAAc,CACd,qBACF,CAEA,4CACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,2CACE,eAAgB,CAChB,mBAAoB,CACpB,oCAAwC,CACxC,iCAAqC,CACrC,cAAe,CACf,aACF,CAEA,4CACE,aAAc,CACd,eAAgB,CAChB,mBAAoB,CACpB,oBAAqB,CACrB,2BAA4B,CAC5B,eACF,CAEA,wCACE,cAAe,CACf,aACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,QACF,CAEA,kCACE,iBAAkB,CAClB,OAAQ,CACR,8BAAkC,CAClC,yBAA0B,CAC1B,YAAa,CACb,kBAAmB,CACnB,cACF,CAEA,yCACE,qBAAuB,CACvB,kBAAmB,CACnB,kBAAmB,CACnB,uCAA2C,CAC3C,iBAAkB,CAClB,YAAa,CACb,QACF,CAEA,yCACE,cAAe,CACf,eAAgB,CAChB,aACF,CAEA,2CACE,cAAe,CACf,eAAgB,CAChB,aAAc,CACd,oBACF,CAEA,2CACE,YAAa,CACb,QAAS,CACT,wBAAyB,CACzB,cACF,CAEA,0CACE,WAAY,CACZ,mBAAoB,CACpB,gBAAiB,CACjB,cAAe,CACf,cAAe,CACf,yGACF,CAEA,qDACE,kBAAmB,CACnB,UACF,CAEA,oDACE,sBAAuB,CACvB,aAAc,CACd,oCACF,CAEA,oDACE,kBAAmB,CACnB,UACF,CAEA,gDACE,0BAA2B,CAC3B,yCACF,CAEA,iDACE,uBACF,CAEA,kgBAUE,sCAA0C,CAC1C,kBACF,CACA,yBACE,+BACE,4BAA6B,CAC7B,kBAAmB,CACnB,wBAAyB,CACzB,YAAa,CACb,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCAAiC,CACjC,0BACF,CAEA,oCACE,uBACF,CAEA,mCACE,4BAA6B,CAC7B,kBAAmB,CACnB,wBAAyB,CACzB,qCAAyC,CACzC,oCACF,CAEA,gCACE,4BAA6B,CAC7B,qBAAsB,CACtB,sBAAuB,CACvB,0BAA2B,CAC3B,yBAA0B,CAC1B,mBAAoB,CACpB,6BAA8B,CAC9B,2EAAmF,CACnF,uBAAwB,CACxB,gCAAiC,CACjC,wBAAyB,CACzB,0BAA2B,CAC3B,kDACF,CAEA,iCACE,aAAc,CACd,iBAAkB,CAClB,2CACF,CAEA,sCACE,cACF,CAEA,qCACE,cACF,CAEA,gCACE,UAAW,CACX,WAAY,CACZ,cAAe,CACf,gBACF,CAEA,kCACE,aAAc,CACd,YAAa,CACb,cAAe,CACf,OAAQ,CACR,iBACF,CAEA,iCACE,UAAW,CACX,cAAe,CACf,gBACF,CAEA,iCACE,MAAO,CACP,WAAY,CACZ,cAAe,CACf,gBACF,CAEA,+BACE,YAAa,CACb,qBAAsB,CACtB,MAAO,CACP,YAAa,CACb,aACF,CAEA,kCACE,aAAc,CACd,iBAAkB,CAClB,2CAA+C,CAC/C,iBAAkB,CAClB,eAAgB,CAChB,gBACF,CAEA,wCACE,cAAe,CACf,iBACF,CAEA,kCACE,YACF,CAEA,wEAEE,YAAa,CACb,cAAe,CACf,gBAAiB,CACjB,OAAQ,CACR,kBACF,CAEA,8GAEE,UACF,CAEA,0HAEE,+BAAmC,CACnC,mBACF,CAEA,+BACE,cAAe,CACf,gBAAiB,CACjB,kBAAmB,CACnB,aACF,CAEA,2CACE,cAAe,CACf,eAAgB,CAChB,kBAAmB,CACnB,aACF,CAEA,kCACE,MAAO,CACP,YAAa,CACb,gBAAiB,CACjB,YACF,CAEA,qCACE,sBACF,CAEA,8CACE,UACF,CAEA,6CACE,MAAO,CACP,iBACF,CAEA,+BACE,YAAa,CACb,wDAA2D,CAC3D,QAAS,CACT,sBAAuB,CACvB,oBACF,CAEA,+BACE,YAAa,CACb,kBAAmB,CACnB,kBAAmB,CACnB,QAAS,CACT,YAAa,CACb,kBAAmB,CACnB,WAAY,CACZ,UAAW,CACX,cACF,CAEA,uCACE,UAAW,CACX,WAAY,CACZ,aAAc,CACd,kBACF,CAEA,qCACE,MAAO,CACP,WACF,CAEA,qCACE,cAAe,CACf,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,qCACE,cAAe,CACf,OACF,CAEA,qCACE,cAAe,CACf,OACF,CAEA,8BACE,aAAc,CACd,eACF,CAEA,wCACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,aACF,CAEA,uCACE,gBAAiB,CACjB,cAAe,CACf,iBACF,CAEA,mEAEE,4BAA6B,CAC7B,kBAAmB,CACnB,uBAAwB,CACxB,6BAA8B,CAC9B,iCAAkC,CAClC,uBAAwB,CACxB,gCAAiC,CACjC,0BACF,CAEA,iFAEE,mCAAoC,CACpC,0BAA2B,CAC3B,wCAAyC,CACzC,yCAA0C,CAC1C,6BAA8B,CAC9B,uBAAwB,CACxB,wBACF,CAEA,0CACE,YAAa,CACb,kBACF,CAEA,wCACE,cACF,CAEA,wCACE,cACF,CAEA,uCACE,cAAe,CACf,eACF,CAEA,2CACE,OACF,CAEA,sCACE,yBAA0B,CAC1B,QACF,CAEA,wCACE,WAAY,CACZ,aACF,CAEA,2CACE,yBACF,CAEA,iDACE,cACF,CAEA,gDACE,cACF,CAEA,wCACE,qBAAsB,CACtB,sBAAuB,CACvB,OAAQ,CACR,cACF,CAEA,0CACE,yBACF,CAEA,+CACE,cACF,CAEA,iDACE,cACF,CAEA,sCACE,UAAW,CACX,iBAAkB,CAClB,cACF,CAEA,2CACE,UACF,CAEA,0CACE,cAAe,CACf,YACF,CAEA,2CACE,yBAA0B,CAC1B,OAAQ,CACR,cACF,CAEA,6CACE,cACF,CAEA,2CACE,aACF,CAEA,4CACE,oBACF,CAEA,0CACE,6BAA8B,CAC9B,OACF,CACF',sourcesContent:['<template>\n  <div class="cardhub-root" :class="{ open: state.open }">\n    <div class="cardhub-backdrop" @click="close" />\n    <section class="cardhub-panel" role="dialog" aria-label="CardHub 角色卡管理器">\n      <header class="cardhub-header">\n        <div class="cardhub-title">\n          <span class="cardhub-title__main">CardHub</span>\n          <span class="cardhub-title__sub">角色卡管理器</span>\n        </div>\n        <div class="cardhub-actions">\n          <button class="cardhub-close" type="button" aria-label="关闭" @click="close">\n            <span aria-hidden="true">×</span>\n          </button>\n        </div>\n      </header>\n\n      <div class="cardhub-toolbar">\n        <input\n          v-model="state.search"\n          class="cardhub-search"\n          type="search"\n          placeholder="搜索角色名或标签"\n        />\n        <button class="cardhub-button" type="button" @click="refresh">刷新</button>\n        <button class="cardhub-button is-ghost" type="button" @click="triggerImport">导入</button>\n        <button class="cardhub-button is-ghost" type="button" @click="exportSelected">批量导出</button>\n        <input\n          ref="importInput"\n          class="cardhub-import-input"\n          type="file"\n          accept=".png,.json"\n          multiple\n          @change="handleImportFiles"\n        />\n      </div>\n\n      <div class="cardhub-body">\n        <div class="cardhub-sidebar">\n          <div class="cardhub-section-title">分类</div>\n          <div class="cardhub-chip-row">\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'all\' }"\n              type="button"\n              @click="statusFilter = \'all\'"\n            >\n              全部\n            </button>\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'imported\' }"\n              type="button"\n              @click="statusFilter = \'imported\'"\n            >\n              已导入\n            </button>\n            <button\n              class="cardhub-chip"\n              :class="{ \'is-active\': statusFilter === \'unimported\' }"\n              type="button"\n              @click="statusFilter = \'unimported\'"\n            >\n              未导入\n            </button>\n          </div>\n          <div class="cardhub-divider" />\n          <div class="cardhub-section-title">标签</div>\n          <div class="cardhub-tag-filter">\n            <button\n              v-for="tag in allTags"\n              :key="tag"\n              class="cardhub-tag-filter__chip"\n              :class="{ \'is-active\': selectedTags.includes(tag) }"\n              type="button"\n              @click="toggleTagFilter(tag)"\n            >\n              {{ tag }}\n            </button>\n          </div>\n          <button\n            v-if="selectedTags.length"\n            class="cardhub-chip cardhub-chip--clear"\n            type="button"\n            @click="clearTagFilter"\n          >\n            清空标签\n          </button>\n        </div>\n\n        <div class="cardhub-content">\n          <div v-if="state.loading" class="cardhub-loading">正在读取角色卡...</div>\n          <div v-else-if="!filteredCharacters.length" class="cardhub-empty">\n            暂无角色卡，或没有匹配的搜索结果。\n          </div>\n          <div v-else class="cardhub-grid-wrap">\n            <div class="cardhub-pagination">\n              <div v-if="totalPages > 1" class="cardhub-pagination__actions">\n                <button\n                  class="cardhub-pagination__button"\n                  type="button"\n                  :disabled="currentPage <= 1"\n                  @click="prevPage"\n                >\n                  上一页\n                </button>\n                <button\n                  class="cardhub-pagination__button"\n                  type="button"\n                  :disabled="currentPage >= totalPages"\n                  @click="nextPage"\n                >\n                  下一页\n                </button>\n              </div>\n              <span class="cardhub-pagination__status">第 {{ currentPage }} / {{ totalPages }} 页</span>\n            </div>\n            <div class="cardhub-grid">\n            <article\n              v-for="character in pagedCharacters"\n              :key="character.id"\n              class="cardhub-card"\n              @click="openManage(character)"\n            >\n              <div\n                class="cardhub-card__avatar"\n                :class="{ \'has-avatar\': Boolean(avatarUrl(character)) }"\n                :style="avatarStyle(character)"\n              >\n                <span>{{ character.name.slice(0, 1) || \'?\' }}</span>\n              </div>\n              <div class="cardhub-card__info">\n                <div class="cardhub-card__name">{{ character.name }}</div>\n                <div class="cardhub-card__meta">\n                  <span>{{ character.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n                  <span>{{ displayTags(character).length }} 标签</span>\n                </div>\n                <div class="cardhub-card__tags">\n                  <button\n                    v-for="tag in displayTags(character)"\n                    :key="tag"\n                    class="cardhub-tag"\n                    type="button"\n                    title="点击移除标签"\n                    @click.stop="removeTag(character, tag)"\n                  >\n                    {{ tag }}\n                    <span class="cardhub-tag__remove">×</span>\n                  </button>\n                  <button\n                    v-if="activeTagKey !== tagKey(character)"\n                    class="cardhub-tag is-add"\n                    type="button"\n                    @click.stop="startTagEdit(character)"\n                  >\n                    + 标签\n                  </button>\n                  <input\n                    v-else\n                    v-model="tagInput"\n                    class="cardhub-tag-input"\n                    type="text"\n                    placeholder="新标签"\n                    @keydown.enter.prevent="confirmTag(character)"\n                    @keydown.esc.prevent="cancelTagEdit"\n                    @blur="confirmTag(character)"\n                    @click.stop\n                    @mousedown.stop\n                    @touchstart.stop\n                  />\n                </div>\n              </div>\n              <div class="cardhub-card__actions">\n                <button\n                  class="cardhub-card__action is-secondary"\n                  type="button"\n                  @click.stop="handleCardAction(character)"\n                  @pointerdown.stop\n                  @mousedown.stop\n                  @touchstart.stop\n                >\n                  {{ character.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n                </button>\n                <button\n                  class="cardhub-card__action"\n                  type="button"\n                  @click.stop="openManage(character)"\n                  @pointerdown.stop\n                  @mousedown.stop\n                  @touchstart.stop\n                >\n                  管理\n                </button>\n              </div>\n            </article>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <div v-if="manageCard" class="cardhub-manage" @click.self="closeManage">\n      <div class="cardhub-manage__panel" role="dialog" aria-label="角色管理">\n        <button class="cardhub-preview__close" type="button" @click="closeManage">×</button>\n        <div class="cardhub-manage__top">\n          <div class="cardhub-manage__summary">\n            <div class="cardhub-preview__name">{{ manageCard.name }}</div>\n            <div class="cardhub-preview__meta">\n              <span>{{ manageCard.origin === \'tavern\' ? \'已导入\' : \'未导入\' }}</span>\n              <span>{{ displayTags(manageCard).length }} 标签</span>\n            </div>\n            <div class="cardhub-preview__tags">\n              <span v-for="tag in displayTags(manageCard)" :key="tag" class="cardhub-preview__tag">\n                {{ tag }}\n              </span>\n            </div>\n            <div class="cardhub-manage__overview">\n              <div\n                v-for="item in manageOverview"\n                :key="item.label"\n                class="cardhub-manage__overview-card"\n              >\n                <div class="cardhub-manage__overview-label">{{ item.label }}</div>\n                <div class="cardhub-manage__overview-value">{{ item.value }}</div>\n                <div v-if="item.hint" class="cardhub-manage__overview-hint">{{ item.hint }}</div>\n              </div>\n            </div>\n          </div>\n          <div class="cardhub-manage__media">\n            <img v-if="manageAvatarUrl" :src="manageAvatarUrl" alt="" />\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">角色卡预览</div>\n          <div v-if="manageDetails.length" class="cardhub-manage__details">\n            <div v-for="detail in manageDetails" :key="detail.label" class="cardhub-manage__detail">\n              <div class="cardhub-manage__detail-label">{{ detail.label }}</div>\n              <div class="cardhub-manage__detail-content">{{ detail.value }}</div>\n            </div>\n          </div>\n          <div v-else class="cardhub-manage__empty">{{ manageDetailsHint }}</div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">开场白</div>\n          <div class="cardhub-manage__content">\n            <template v-if="manageOpeningLines.length">\n              <div v-for="(opening, index) in manageOpeningLines" :key="index" class="cardhub-manage__opening">\n                {{ opening }}\n              </div>\n            </template>\n            <template v-else>暂无开场白</template>\n          </div>\n        </div>\n        <div class="cardhub-manage__section">\n          <div class="cardhub-manage__label">\n            <span>最近聊天</span>\n            <div class="cardhub-manage__jump-row">\n              <button\n                class="cardhub-manage__btn is-primary"\n                type="button"\n                @click="openLatestChat"\n                @pointerdown.stop\n                @mousedown.stop\n                @touchstart.stop\n              >\n                进入最近聊天\n              </button>\n              <button\n                class="cardhub-manage__btn is-secondary"\n                type="button"\n                @click="openNewChat"\n                @pointerdown.stop\n                @mousedown.stop\n                @touchstart.stop\n              >\n                新聊天\n              </button>\n            </div>\n          </div>\n          <div v-if="manageChats.length" class="cardhub-manage__chat">\n            <div\n              v-for="(msg, index) in manageChats"\n              :key="index"\n              class="cardhub-manage__chat-row"\n              role="button"\n              tabindex="0"\n              @click="openChat(msg)"\n              @keydown.enter.prevent="openChat(msg)"\n            >\n              <div class="cardhub-manage__chat-main">\n                <div class="cardhub-manage__chat-name">{{ msg.name }}</div>\n                <div v-if="msg.label && msg.label !== msg.name" class="cardhub-manage__chat-label">\n                  {{ msg.label }}\n                </div>\n                <div v-if="msg.keywords.length" class="cardhub-manage__chat-tags">\n                  <span v-for="keyword in msg.keywords" :key="keyword" class="cardhub-manage__chat-tag">\n                    {{ keyword }}\n                  </span>\n                </div>\n              </div>\n              <span class="cardhub-manage__chat-text">{{ msg.mes }}</span>\n            </div>\n          </div>\n          <div v-else class="cardhub-manage__empty">{{ manageChatHint }}</div>\n        </div>\n        <div class="cardhub-manage__actions">\n          <button\n            class="cardhub-manage__btn is-secondary"\n            type="button"\n            @click.stop="handleCardAction(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            {{ manageCard.origin === \'tavern\' ? \'导出\' : \'导入\' }}\n          </button>\n          <button\n            class="cardhub-manage__btn is-primary"\n            type="button"\n            @click.stop="manageDelete(manageCard)"\n            @pointerdown.stop\n            @mousedown.stop\n            @touchstart.stop\n          >\n            删除\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div v-if="confirmState.open" class="cardhub-confirm" @click.self="resolveConfirm(\'cancel\')">\n      <div class="cardhub-confirm__panel" role="dialog" aria-modal="true">\n        <div class="cardhub-confirm__title">{{ confirmState.title }}</div>\n        <div class="cardhub-confirm__message">{{ confirmState.message }}</div>\n        <div class="cardhub-confirm__actions">\n          <button class="cardhub-confirm__button is-cancel" type="button" @click="resolveConfirm(\'cancel\')">\n            {{ confirmState.cancelLabel }}\n          </button>\n          <button\n            v-if="confirmState.altLabel"\n            class="cardhub-confirm__button is-danger"\n            type="button"\n            @click="resolveConfirm(\'alt\')"\n          >\n            {{ confirmState.altLabel }}\n          </button>\n          <button class="cardhub-confirm__button is-confirm" type="button" @click="resolveConfirm(\'confirm\')">\n            {{ confirmState.confirmLabel }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { computed, nextTick, reactive, ref, watch } from \'vue\';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from \'../state/store\';\nimport { fetchCharacterSummaries } from \'../services/characterSource\';\nimport { regexFromString } from \'./util/common\';\nimport type { CardHubItem } from \'../types\';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from \'../services/libraryService\';\nimport { getMergedTags, updateCharacterTags } from \'../services/tagService\';\n\nconst selectedTags = ref<string[]>([]);\nconst activeTagKey = ref<string | null>(null);\nconst tagInput = ref(\'\');\nconst statusFilter = ref<\'all\' | \'imported\' | \'unimported\'>(\'all\');\nconst pageSize = ref(24);\nconst currentPage = ref(1);\nconst importInput = ref<HTMLInputElement | null>(null);\nconst manageCard = ref<CardHubItem | null>(null);\nconst manageOpenings = ref<string[]>([]);\ntype ManageChatEntry = {\n  name: string;\n  label?: string;\n  mes: string;\n  file: string;\n  keywords: string[];\n};\n\nconst manageChats = ref<ManageChatEntry[]>([]);\nconst manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\nlet manageRequestId = 0;\ntype ManageDetail = {\n  label: string;\n  value: string;\n};\ntype ManageProfile = {\n  description?: string;\n  personality?: string;\n  scenario?: string;\n  creatorNotes?: string;\n  systemPrompt?: string;\n  postHistory?: string;\n  creator?: string;\n  worldBookName?: string;\n  worldBookCount?: number;\n};\ntype ManageOpeningSummary = {\n  total: number;\n  alternate: number;\n};\ntype ManageChatSummary = {\n  total: number;\n  latest: string;\n};\ntype ManageChatData = {\n  list: ManageChatEntry[];\n  summary: ManageChatSummary | null;\n};\ntype ManageOverviewItem = {\n  label: string;\n  value: string;\n  hint?: string;\n};\ntype ManageData = {\n  openings: string[];\n  profile: ManageProfile | null;\n  openingSummary: ManageOpeningSummary | null;\n};\ntype ConfirmResult = \'confirm\' | \'cancel\' | \'alt\';\ntype ConfirmOptions = {\n  title?: string;\n  message: string;\n  confirmLabel?: string;\n  cancelLabel?: string;\n  altLabel?: string;\n};\n\nconst confirmState = reactive({\n  open: false,\n  title: \'\',\n  message: \'\',\n  confirmLabel: \'确定\',\n  cancelLabel: \'取消\',\n  altLabel: \'\',\n  resolve: null as null | ((result: ConfirmResult) => void),\n});\n\nconst allCards = computed(() => [...state.characters, ...state.library]);\nconst manageProfile = ref<ManageProfile | null>(null);\nconst manageOpeningSummary = ref<ManageOpeningSummary | null>(null);\nconst manageChatSummary = ref<ManageChatSummary | null>(null);\nconst manageDetails = computed(() => {\n  const profile = manageProfile.value;\n  if (!profile) {\n    return [] as ManageDetail[];\n  }\n  const details: ManageDetail[] = [];\n  const pushDetail = (label: string, value: string, maxChars = 240) => {\n    const preview = previewDetailText(value, 3, maxChars);\n    if (preview) {\n      details.push({ label, value: preview });\n    }\n  };\n  pushDetail(\'角色描述\', profile.description ?? \'\');\n  pushDetail(\'性格\', profile.personality ?? \'\');\n  pushDetail(\'场景\', profile.scenario ?? \'\');\n  pushDetail(\'创作者备注\', profile.creatorNotes ?? \'\');\n  pushDetail(\'系统提示\', profile.systemPrompt ?? \'\', 200);\n  pushDetail(\'历史指令\', profile.postHistory ?? \'\', 200);\n  pushDetail(\'作者\', profile.creator ?? \'\', 80);\n  return details;\n});\n\nconst manageDetailsHint = computed(() => {\n  if (!manageCard.value || manageDetails.value.length) {\n    return \'\';\n  }\n  if (manageCard.value.origin === \'library\') {\n    return \'未导入卡片暂无可预览内容，可先导入后查看详情。\';\n  }\n  return \'暂无角色卡详情。\';\n});\n\nconst manageChatHint = computed(() => {\n  if (manageCard.value?.origin === \'library\') {\n    return \'未导入卡片暂无聊天记录。\';\n  }\n  return \'暂无聊天记录。\';\n});\nconst manageOverview = computed(() => {\n  const items: ManageOverviewItem[] = [];\n  const profile = manageProfile.value;\n  const worldName = profile?.worldBookName?.trim() || \'\';\n  const worldCount = profile?.worldBookCount;\n  let worldValue = \'未绑定\';\n  let worldHint = \'\';\n  if (worldName || typeof worldCount === \'number\') {\n    worldValue = worldName || \'角色世界书\';\n    worldHint = typeof worldCount === \'number\' ? `${worldCount} 条` : \'\';\n  }\n  items.push({ label: \'世界书\', value: worldValue, hint: worldHint });\n\n  const chat = manageChatSummary.value;\n  let chatValue = \'暂无聊天\';\n  let chatHint = \'\';\n  if (chat && chat.total > 0) {\n    chatValue = `${chat.total} 个聊天`;\n    if (chat.latest) {\n      chatHint = `最近：${chat.latest}`;\n    }\n  }\n  items.push({ label: \'聊天概况\', value: chatValue, hint: chatHint });\n\n  const opening = manageOpeningSummary.value;\n  let openingValue = \'暂无开场白\';\n  let openingHint = \'\';\n  if (opening && opening.total > 0) {\n    openingValue = `${opening.total} 条`;\n    openingHint = opening.alternate > 0 ? `替代：${opening.alternate} 条` : \'无替代\';\n  }\n  items.push({ label: \'开场白\', value: openingValue, hint: openingHint });\n  return items;\n});\n\nconst filteredCharacters = computed(() => {\n  const list = applyStatusFilter(allCards.value);\n  const keyword = state.search.trim();\n  if (!keyword) {\n    return applyTagFilter(list);\n  }\n  const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), \'i\');\n  return applyTagFilter(list).filter(character => {\n    return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\n  });\n});\n\nconst totalPages = computed(() => {\n  const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n  return total > 0 ? total : 1;\n});\n\nconst pagedCharacters = computed(() => {\n  const start = (currentPage.value - 1) * pageSize.value;\n  return filteredCharacters.value.slice(start, start + pageSize.value);\n});\n\nconst allTags = computed(() => {\n  const tagSet = new Set<string>();\n  allCards.value.forEach(character => {\n    getMergedTags(character).forEach(tag => tagSet.add(tag));\n  });\n  selectedTags.value.forEach(tag => tagSet.add(tag));\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b, \'zh-CN\'));\n});\n\nfunction avatarUrl(character: CardHubItem, useFull = false): string | null {\n  const avatar = character.avatar;\n  if (!avatar) {\n    return null;\n  }\n  if (/^(data:|https?:|\\/)/.test(avatar)) {\n    return avatar;\n  }\n  if (useFull && character.origin === \'tavern\') {\n    return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n  }\n  return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n}\n\nfunction avatarStyle(character: CardHubItem): Record<string, string> {\n  const url = avatarUrl(character);\n  return url ? { backgroundImage: `url(${url})` } : {};\n}\n\nfunction displayTags(character: CardHubItem): string[] {\n  return getMergedTags(character);\n}\n\nconst manageAvatarUrl = computed(() => {\n  if (!manageCard.value) {\n    return null;\n  }\n  return avatarUrl(manageCard.value, true);\n});\n\nfunction applyStatusFilter(list: CardHubItem[]): CardHubItem[] {\n  if (statusFilter.value === \'imported\') {\n    return list.filter(item => item.origin === \'tavern\');\n  }\n  if (statusFilter.value === \'unimported\') {\n    return list.filter(item => item.origin === \'library\');\n  }\n  return list;\n}\n\nfunction applyTagFilter(list: CardHubItem[]): CardHubItem[] {\n  if (!selectedTags.value.length) {\n    return list;\n  }\n  return list.filter(character =>\n    selectedTags.value.some(tag => getMergedTags(character).includes(tag)),\n  );\n}\n\nfunction toggleTagFilter(tag: string) {\n  if (selectedTags.value.includes(tag)) {\n    selectedTags.value = selectedTags.value.filter(item => item !== tag);\n  } else {\n    selectedTags.value = [...selectedTags.value, tag];\n  }\n}\n\nfunction clearTagFilter() {\n  selectedTags.value = [];\n}\n\nwatch([() => state.search, statusFilter, () => selectedTags.value.join(\'|\')], () => {\n  currentPage.value = 1;\n});\n\nwatch([filteredCharacters, totalPages], () => {\n  if (currentPage.value > totalPages.value) {\n    currentPage.value = totalPages.value;\n  }\n  if (currentPage.value < 1) {\n    currentPage.value = 1;\n  }\n});\n\nfunction prevPage() {\n  if (currentPage.value > 1) {\n    currentPage.value -= 1;\n  }\n}\n\nfunction nextPage() {\n  if (currentPage.value < totalPages.value) {\n    currentPage.value += 1;\n  }\n}\n\nfunction normalizeNameKey(value: string): string {\n  return value.trim().toLocaleLowerCase();\n}\n\nfunction findDuplicateCharacterByName(name: string): CardHubItem | null {\n  const target = normalizeNameKey(name);\n  if (!target) {\n    return null;\n  }\n  return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\n}\n\nfunction openConfirm(options: ConfirmOptions): Promise<ConfirmResult> {\n  if (confirmState.open && confirmState.resolve) {\n    confirmState.resolve(\'cancel\');\n  }\n  confirmState.title = options.title ?? \'确认操作\';\n  confirmState.message = options.message;\n  confirmState.confirmLabel = options.confirmLabel ?? \'确定\';\n  confirmState.cancelLabel = options.cancelLabel ?? \'取消\';\n  confirmState.altLabel = options.altLabel ?? \'\';\n  confirmState.open = true;\n\n  return new Promise(resolve => {\n    confirmState.resolve = resolve;\n  });\n}\n\nfunction resolveConfirm(result: ConfirmResult) {\n  if (!confirmState.open) {\n    return;\n  }\n  confirmState.open = false;\n  const resolver = confirmState.resolve;\n  confirmState.resolve = null;\n  if (resolver) {\n    resolver(result);\n  }\n}\n\n\nfunction removeTag(character: CardHubItem, tag: string) {\n  const nextTags = getMergedTags(character).filter(item => item !== tag);\n  applyTagUpdate(character, nextTags);\n}\n\nfunction tagKey(character: CardHubItem): string {\n  return character.id;\n}\n\nfunction startTagEdit(character: CardHubItem) {\n  activeTagKey.value = tagKey(character);\n  tagInput.value = \'\';\n  nextTick(() => {\n    const input = document.querySelector<HTMLInputElement>(\'.cardhub-tag-input\');\n    input?.focus();\n  });\n}\n\nfunction confirmTag(character: CardHubItem) {\n  if (activeTagKey.value !== tagKey(character)) {\n    return;\n  }\n  const input = tagInput.value.trim();\n  if (input) {\n    const nextTags = [...getMergedTags(character), input];\n    applyTagUpdate(character, nextTags);\n  }\n  cancelTagEdit();\n}\n\nfunction cancelTagEdit() {\n  activeTagKey.value = null;\n  tagInput.value = \'\';\n}\n\nfunction applyTagUpdate(character: CardHubItem, nextTags: string[]) {\n  if (character.origin === \'library\') {\n    const updatedLibrary = updateLibraryTags(character.id, nextTags);\n    setLibrary(updatedLibrary);\n  } else {\n    const next = updateCharacterTags(character, nextTags);\n    character.tags = next;\n    setCharacters([...state.characters]);\n  }\n}\n\nfunction triggerImport() {\n  importInput.value?.click();\n}\n\nasync function handleImportFiles(event: Event) {\n  const target = event.target as HTMLInputElement | null;\n  const files = target?.files;\n  if (!files || !files.length) {\n    return;\n  }\n  const updated = await addToLibrary(files, state.library);\n  setLibrary(updated);\n  target.value = \'\';\n}\n\nasync function exportSelected() {\n  const list = filteredCharacters.value;\n  if (!list.length) {\n    toastr.warning(\'当前没有可导出的角色卡\');\n    return;\n  }\n  const tagLabel = selectedTags.value.length ? selectedTags.value.join(\'、\') : \'无\';\n  const statusLabel =\n    statusFilter.value === \'all\'\n      ? \'全部\'\n      : statusFilter.value === \'imported\'\n        ? \'已导入\'\n        : \'未导入\';\n  const searchLabel = state.search.trim() || \'无\';\n  const message =\n    `将导出 ${list.length} 张角色卡。\\n` +\n    `筛选状态：${statusLabel}\\n` +\n    `筛选标签：${tagLabel}\\n` +\n    `搜索关键字：${searchLabel}\\n` +\n    `是否继续？`;\n\n  const result = await openConfirm({\n    title: \'批量导出\',\n    message,\n    confirmLabel: \'继续导出\',\n    cancelLabel: \'取消\',\n  });\n  if (result !== \'confirm\') {\n    return;\n  }\n  list.forEach(item => exportCard(item));\n}\n\nasync function handleCardAction(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await importLibraryCard(card);\n  } else {\n    exportCard(card);\n  }\n}\n\nasync function importLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'缺少导入数据\');\n    return;\n  }\n  const duplicate = findDuplicateCharacterByName(card.name);\n  if (duplicate) {\n    toastr.warning(`已存在同名角色「${duplicate.name}」，已跳过导入`);\n    return;\n  }\n  const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {}) as Record<string, string>;\n  delete (headers as Record<string, string>)[\'Content-Type\'];\n\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    await TavernHelper.importRawCharacter(card.name, blob);\n  } else {\n    const file = new File([card.raw], `${card.name}.json`, { type: \'application/json\' });\n    const form = new FormData();\n    form.append(\'avatar\', file);\n    form.append(\'file_type\', \'json\');\n    form.append(\'preserved_name\', file.name);\n    await fetch(\'/api/characters/import\', {\n      method: \'POST\',\n      headers,\n      body: form,\n      cache: \'no-cache\',\n    });\n  }\n\n  setLibrary(removeFromLibrary(card.id));\n  const characters = await fetchCharacterSummaries();\n  setCharacters(characters);\n  toastr.success(`已导入 ${card.name}`);\n}\n\nasync function exportCard(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    await exportLibraryCard(card);\n    return;\n  }\n  if (!card.avatar) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  downloadBlob(blob, `${card.name}.png`);\n}\n\nasync function exportLibraryCard(card: CardHubItem) {\n  if (!card.raw || !card.rawType) {\n    toastr.error(\'无法导出：缺少原始数据\');\n    return;\n  }\n  if (card.rawType === \'png\') {\n    const blob = await dataUrlToBlob(card.raw);\n    downloadBlob(blob, `${card.name}.png`);\n    return;\n  }\n  const blob = new Blob([card.raw], { type: \'application/json\' });\n  downloadBlob(blob, `${card.name}.json`);\n}\n\nasync function openManage(card: CardHubItem) {\n  const requestId = ++manageRequestId;\n  manageCard.value = card;\n  manageOpenings.value = [];\n  manageChats.value = [];\n  manageProfile.value = null;\n  manageOpeningSummary.value = null;\n  manageChatSummary.value = null;\n\n  const [manageResult, chatsResult] = await Promise.allSettled([\n    resolveManageData(card),\n    resolveRecentChats(card),\n  ]);\n\n  if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n    return;\n  }\n\n  const manageData: ManageData =\n    manageResult.status === \'fulfilled\'\n      ? manageResult.value\n      : { openings: [], profile: null, openingSummary: null };\n  manageOpenings.value = manageData.openings;\n  manageProfile.value = manageData.profile;\n  manageOpeningSummary.value = manageData.openingSummary;\n\n  const chatData: ManageChatData =\n    chatsResult.status === \'fulfilled\'\n      ? chatsResult.value\n      : { list: [], summary: null };\n  manageChats.value = chatData.list;\n  manageChatSummary.value = chatData.summary;\n}\n\nfunction closeManage() {\n  manageCard.value = null;\n  manageOpenings.value = [];\n  manageChats.value = [];\n  manageProfile.value = null;\n  manageOpeningSummary.value = null;\n  manageChatSummary.value = null;\n}\n\nasync function resolveManageData(card: CardHubItem): Promise<ManageData> {\n  if (card.origin !== \'tavern\') {\n    const data = parseLibraryCardData(card);\n    return {\n      openings: extractOpeningMessages(data),\n      profile: extractCardProfile(data),\n      openingSummary: extractOpeningSummary(data),\n    };\n  }\n  const raw = await getFullCharacterData(card);\n  const fallback =\n    raw ??\n    TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true } as any) ??\n    TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true } as any);\n  const primary = raw ?? fallback;\n  let openings = extractOpeningMessages(primary);\n  if (!openings.length && fallback && fallback !== primary) {\n    openings = extractOpeningMessages(fallback);\n  }\n  const openingSummary = extractOpeningSummary(primary ?? fallback);\n  return {\n    openings,\n    profile: extractCardProfile(primary ?? fallback),\n    openingSummary,\n  };\n}\n\nfunction parseLibraryCardData(card: CardHubItem): any | null {\n  if (!card.raw || !card.rawType) {\n    return null;\n  }\n  if (card.rawType === \'json\') {\n    return parseJsonSafe(card.raw);\n  }\n  if (card.rawType === \'png\') {\n    return parsePngCardData(card.raw);\n  }\n  return null;\n}\n\nfunction parseJsonSafe(raw: string): any | null {\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nfunction parsePngCardData(dataUrl: string): any | null {\n  const bytes = dataUrlToBytes(dataUrl);\n  if (!bytes) {\n    return null;\n  }\n  const chunks = extractPngTextChunks(bytes);\n  const allowedKeys = new Set([\'chara\', \'character\', \'tavern\', \'tavern_character\', \'card\']);\n  for (const chunk of chunks) {\n    if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n      continue;\n    }\n    const parsed = parseCardPayload(chunk.value);\n    if (parsed) {\n      return parsed;\n    }\n  }\n  return null;\n}\n\nfunction dataUrlToBytes(dataUrl: string): Uint8Array | null {\n  const comma = dataUrl.indexOf(\',\');\n  if (comma < 0) {\n    return null;\n  }\n  const base64 = dataUrl.slice(comma + 1);\n  try {\n    const binary = atob(base64);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n  } catch {\n    return null;\n  }\n}\n\nfunction extractPngTextChunks(bytes: Uint8Array): Array<{ key: string; value: string }> {\n  if (bytes.length < 8) {\n    return [];\n  }\n  const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n  for (let i = 0; i < signature.length; i += 1) {\n    if (bytes[i] !== signature[i]) {\n      return [];\n    }\n  }\n  const chunks: Array<{ key: string; value: string }> = [];\n  let offset = 8;\n  while (offset + 8 <= bytes.length) {\n    const length = readUint32BE(bytes, offset);\n    const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n    const dataStart = offset + 8;\n    const dataEnd = dataStart + length;\n    if (dataEnd + 4 > bytes.length) {\n      break;\n    }\n    const data = bytes.subarray(dataStart, dataEnd);\n    if (type === \'tEXt\') {\n      const entry = parseTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    } else if (type === \'iTXt\') {\n      const entry = parseIntlTextChunk(data);\n      if (entry) {\n        chunks.push(entry);\n      }\n    }\n    offset = dataEnd + 4;\n  }\n  return chunks;\n}\n\nfunction parseTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseIntlTextChunk(data: Uint8Array): { key: string; value: string } | null {\n  const nullIndex = data.indexOf(0);\n  if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n    return null;\n  }\n  const key = bytesToString(data.subarray(0, nullIndex)).trim();\n  const compressed = data[nullIndex + 1] === 1;\n  let cursor = nullIndex + 2;\n  const langEnd = data.indexOf(0, cursor);\n  if (langEnd < 0) {\n    return null;\n  }\n  cursor = langEnd + 1;\n  const translatedEnd = data.indexOf(0, cursor);\n  if (translatedEnd < 0) {\n    return null;\n  }\n  cursor = translatedEnd + 1;\n  if (compressed) {\n    return null;\n  }\n  const value = bytesToString(data.subarray(cursor)).trim();\n  if (!key || !value) {\n    return null;\n  }\n  return { key, value };\n}\n\nfunction parseCardPayload(value: string): any | null {\n  const trimmed = value.trim();\n  if (!trimmed) {\n    return null;\n  }\n  const direct = parseJsonSafe(trimmed);\n  if (direct) {\n    return direct;\n  }\n  if (!isLikelyBase64(trimmed)) {\n    return null;\n  }\n  const decoded = decodeBase64Text(trimmed);\n  if (!decoded) {\n    return null;\n  }\n  return parseJsonSafe(decoded);\n}\n\nfunction decodeBase64Text(value: string): string | null {\n  try {\n    const binary = atob(value);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return new TextDecoder().decode(bytes);\n  } catch {\n    return null;\n  }\n}\n\nfunction isLikelyBase64(value: string): boolean {\n  if (value.length < 16 || value.length % 4 !== 0) {\n    return false;\n  }\n  return /^[A-Za-z0-9+/=]+$/.test(value);\n}\n\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\n  return (\n    (bytes[offset] << 24) |\n    (bytes[offset + 1] << 16) |\n    (bytes[offset + 2] << 8) |\n    bytes[offset + 3]\n  ) >>> 0;\n}\n\nfunction bytesToString(bytes: Uint8Array): string {\n  return new TextDecoder().decode(bytes);\n}\n\nasync function getFullCharacterData(card: CardHubItem): Promise<SillyTavern.v1CharData | null> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  if (ctx?.getCharacters) {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色卡列表失败\', error);\n    }\n  }\n  const list = ctx?.characters ?? st?.characters ?? [];\n  if (!list.length) {\n    return null;\n  }\n  const byAvatar = card.avatar\n    ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\n    : -1;\n  const byName = list.findIndex(item => item.name === card.name);\n  const idx = byAvatar >= 0 ? byAvatar : byName;\n  if (idx < 0) {\n    return null;\n  }\n  if (ctx?.unshallowCharacter) {\n    try {\n      await ctx.unshallowCharacter(idx);\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡详情失败\', error);\n    }\n  }\n  const updatedList = ctx?.characters ?? list;\n  const data = updatedList[idx] ?? null;\n  if (data?.first_mes || data?.data?.first_mes) {\n    return data;\n  }\n  if (ctx?.getCharacterCardFields) {\n    try {\n      const fields = await ctx.getCharacterCardFields({ chid: idx });\n      if (fields?.first_mes || fields?.data?.first_mes) {\n        return fields;\n      }\n    } catch (error) {\n      console.warn(\'[CardHub] 读取角色卡字段失败\', error);\n    }\n  }\n  const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n  return fallback ?? data;\n}\n\nfunction extractCardProfile(data: any): ManageProfile | null {\n  if (!data) {\n    return null;\n  }\n  const profile: ManageProfile = {\n    description: pickString(data?.description, data?.data?.description),\n    personality: pickString(data?.personality, data?.data?.personality),\n    scenario: pickString(data?.scenario, data?.data?.scenario),\n    creatorNotes: pickString(\n      data?.creatorcomment,\n      data?.data?.creatorcomment,\n      data?.creator_notes,\n      data?.data?.creator_notes,\n    ),\n    systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n    postHistory: pickString(\n      data?.post_history_instructions,\n      data?.data?.post_history_instructions,\n    ),\n    creator: pickString(data?.creator, data?.data?.creator),\n  };\n  const book = data?.character_book ?? data?.data?.character_book;\n  if (book) {\n    profile.worldBookName = pickString(book?.name);\n    profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n  }\n  const hasValue =\n    Boolean(profile.description) ||\n    Boolean(profile.personality) ||\n    Boolean(profile.scenario) ||\n    Boolean(profile.creatorNotes) ||\n    Boolean(profile.systemPrompt) ||\n    Boolean(profile.postHistory) ||\n    Boolean(profile.creator) ||\n    Boolean(profile.worldBookName) ||\n    typeof profile.worldBookCount === \'number\';\n  return hasValue ? profile : null;\n}\n\nfunction pickString(...values: unknown[]): string {\n  for (const value of values) {\n    if (typeof value === \'string\') {\n      const trimmed = value.trim();\n      if (trimmed) {\n        return trimmed;\n      }\n    }\n  }\n  return \'\';\n}\n\nfunction extractOpeningSummary(data: any): ManageOpeningSummary | null {\n  if (!data) {\n    return null;\n  }\n  const first = typeof data?.first_mes === \'string\' ? data.first_mes : data?.data?.first_mes;\n  const firstCount = typeof first === \'string\' && first.trim() ? 1 : 0;\n  const alt =\n    data?.alternate_greetings ??\n    data?.data?.alternate_greetings ??\n    data?.extensions?.alternate_greetings ??\n    data?.data?.extensions?.alternate_greetings;\n  let alternate = 0;\n  if (Array.isArray(alt)) {\n    alternate = alt.filter(item => typeof item === \'string\' && item.trim()).length;\n  } else if (typeof alt === \'string\' && alt.trim()) {\n    alternate = 1;\n  }\n  return {\n    total: firstCount + alternate,\n    alternate,\n  };\n}\n\nfunction extractOpeningMessages(data: any): string[] {\n  if (!data) {\n    return [];\n  }\n  const list: string[] = [];\n  const first = typeof data?.first_mes === \'string\' ? data.first_mes : data?.data?.first_mes;\n  if (typeof first === \'string\' && first.trim()) {\n    list.push(first.trim());\n  }\n  const alt =\n    data?.alternate_greetings ??\n    data?.data?.alternate_greetings ??\n    data?.extensions?.alternate_greetings ??\n    data?.data?.extensions?.alternate_greetings;\n  if (Array.isArray(alt)) {\n    alt.forEach(item => {\n      if (typeof item === \'string\' && item.trim()) {\n        list.push(item.trim());\n      }\n    });\n  } else if (typeof alt === \'string\' && alt.trim()) {\n    list.push(alt.trim());\n  }\n  return list;\n}\n\nfunction normalizeBriefMessage(value: string): string {\n  return value\n    .replace(/<br\\s*\\/?>/gi, \' \')\n    .replace(/<[^>]+>/g, \' \')\n    .replace(/\\s+/g, \' \')\n    .trim();\n}\n\nfunction formatMaybeTimestamp(value: unknown): string {\n  if (typeof value === \'number\' && !Number.isNaN(value)) {\n    const ms = value < 1e12 ? value * 1000 : value;\n    return new Date(ms).toLocaleString(\'zh-CN\', { hour12: false });\n  }\n  if (typeof value === \'string\') {\n    const trimmed = value.trim();\n    if (trimmed) {\n      return trimmed;\n    }\n  }\n  return \'\';\n}\n\nfunction extractChatLatestLabel(entry: any): string {\n  const candidates = [\n    entry?.last_message_time,\n    entry?.last_message_date,\n    entry?.update_time,\n    entry?.last_modified,\n    entry?.create_date,\n    entry?.timestamp,\n    entry?.time,\n  ];\n  for (const value of candidates) {\n    const label = formatMaybeTimestamp(value);\n    if (label) {\n      return label;\n    }\n  }\n  const fallback = pickString(entry?.file_name, entry?.file_id);\n  if (!fallback) {\n    return \'\';\n  }\n  return fallback.replace(/\\.jsonl$/i, \'\');\n}\n\nfunction formatChatTitle(entry: any): string {\n  const label = extractChatLatestLabel(entry);\n  return label || \'聊天记录\';\n}\n\nfunction formatChatFileLabel(entry: any): string {\n  const raw = pickString(entry?.file_name, entry?.file_id);\n  if (!raw) {\n    return \'\';\n  }\n  return raw.replace(/\\.jsonl$/i, \'\');\n}\n\nfunction extractChatKeywords(value: string, max = 3): string[] {\n  const normalized = normalizeBriefMessage(value);\n  if (!normalized) {\n    return [];\n  }\n  const keywords = new Set<string>();\n  const stopWords = new Set([\n    \'the\',\n    \'and\',\n    \'you\',\n    \'your\',\n    \'are\',\n    \'this\',\n    \'that\',\n    \'with\',\n    \'have\',\n    \'not\',\n    \'for\',\n    \'from\',\n    \'what\',\n    \'why\',\n    \'when\',\n    \'where\',\n    \'then\',\n    \'into\',\n    \'out\',\n    \'here\',\n    \'there\',\n    \'这个\',\n    \'那个\',\n    \'我们\',\n    \'你们\',\n    \'他们\',\n    \'她们\',\n    \'因为\',\n    \'但是\',\n    \'然后\',\n    \'如果\',\n    \'可以\',\n    \'没有\',\n    \'不是\',\n    \'已经\',\n    \'现在\',\n    \'一个\',\n    \'一些\',\n    \'还有\',\n    \'所以\',\n    \'这种\',\n  ]);\n  const bracketMatches = normalized.match(/\\[[^\\]]{2,16}\\]/g) ?? [];\n  for (const match of bracketMatches) {\n    const cleaned = match.slice(1, -1).trim();\n    if (cleaned) {\n      keywords.add(cleaned);\n    }\n    if (keywords.size >= max) {\n      return Array.from(keywords).slice(0, max);\n    }\n  }\n  const wordMatches = normalized.match(/[\\u4e00-\\u9fa5]{2,}|[A-Za-z0-9]{3,}/g) ?? [];\n  for (const word of wordMatches) {\n    const lower = word.toLowerCase();\n    if (stopWords.has(word) || stopWords.has(lower)) {\n      continue;\n    }\n    keywords.add(word);\n    if (keywords.size >= max) {\n      break;\n    }\n  }\n  return Array.from(keywords).slice(0, max);\n}\n\nfunction previewDetailText(text: string, maxLines: number, maxChars: number): string {\n  const trimmed = text.replace(/\\r/g, \'\').trim();\n  if (!trimmed) {\n    return \'\';\n  }\n  const lines = extractContentLines(trimmed);\n  const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n  let preview = source.slice(0, maxLines).join(\'\\n\').trim();\n  if (!preview) {\n    return \'\';\n  }\n  const truncated = preview.length > maxChars;\n  if (truncated) {\n    preview = preview.slice(0, maxChars).trim();\n  }\n  const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n  if (hasMore && !preview.endsWith(\'…\')) {\n    preview = `${preview}…`;\n  }\n  return preview;\n}\n\nfunction previewOpenings(openings: string[], maxItems: number): string[] {\n  return openings\n    .map(opening => previewOpeningLines(opening, 2).join(\'\\n\'))\n    .filter(preview => preview.trim().length > 0)\n    .slice(0, maxItems);\n}\n\nfunction previewOpeningLines(text: string, maxLines: number): string[] {\n  const trimmed = text.replace(/\\r/g, \'\').trim();\n  if (!trimmed) {\n    return [];\n  }\n  const contentLines = extractContentLines(trimmed);\n  if (contentLines.length >= maxLines) {\n    return contentLines.slice(0, maxLines);\n  }\n  const normalized = normalizeBriefMessage(trimmed);\n  if (!normalized) {\n    return contentLines.slice(0, maxLines);\n  }\n  const chunks = chunkText(normalized, 60);\n  if (!contentLines.length) {\n    return chunks.slice(0, maxLines);\n  }\n  const combined = [...contentLines];\n  for (const chunk of chunks) {\n    if (combined.length >= maxLines) {\n      break;\n    }\n    if (combined[0] !== chunk) {\n      combined.push(chunk);\n    }\n  }\n  return combined.slice(0, maxLines);\n}\n\nfunction extractContentLines(text: string): string[] {\n  const lines = text\n    .split(\'\\n\')\n    .map(part => part.trim())\n    .filter(part => part.length > 0);\n  const filtered: string[] = [];\n  for (const line of lines) {\n    if (line.startsWith(\'```\')) {\n      continue;\n    }\n    if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n      continue;\n    }\n    filtered.push(line);\n  }\n  return filtered;\n}\n\nfunction chunkText(text: string, size: number): string[] {\n  const chunks: string[] = [];\n  for (let i = 0; i < text.length; i += size) {\n    const chunk = text.slice(i, i + size).trim();\n    if (chunk) {\n      chunks.push(chunk);\n    }\n  }\n  return chunks;\n}\n\nasync function resolveRecentChats(card: CardHubItem): Promise<ManageChatData> {\n  if (card.origin !== \'tavern\') {\n    return { list: [], summary: null };\n  }\n  const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\n  if (!Array.isArray(brief) || !brief.length) {\n    return { list: [], summary: { total: 0, latest: \'\' } };\n  }\n  const list = brief.slice(0, 3).map((entry: any) => ({\n    name: formatChatTitle(entry),\n    label: formatChatFileLabel(entry),\n    file: String(entry?.file_name ?? entry?.file_id ?? \'\'),\n    mes: normalizeBriefMessage(String(entry?.mes ?? \'\')).slice(0, 120),\n    keywords: extractChatKeywords(String(entry?.mes ?? \'\')),\n  }));\n  const latest = extractChatLatestLabel(brief[0]);\n  return {\n    list,\n    summary: {\n      total: brief.length,\n      latest,\n    },\n  };\n}\n\nasync function openLatestChat() {\n  if (!manageChats.value.length) {\n    toastr.warning(\'暂无聊天记录\');\n    return;\n  }\n  await openChat(manageChats.value[0]);\n}\n\nasync function openNewChat() {\n  const selection = await selectManageCharacter({ ensureSelected: true });\n  if (!selection) {\n    return;\n  }\n  try {\n    await triggerSlash(\'/newchat\');\n    closeManage();\n    close();\n  } catch (error) {\n    console.warn(\'[CardHub] 新聊天失败\', error);\n    toastr.error(\'无法创建新聊天\');\n  }\n}\n\nasync function openChat(chat: { file: string }) {\n  const file = chat.file;\n  if (!file) {\n    toastr.warning(\'未找到聊天文件\');\n    return;\n  }\n  const selection = await selectManageCharacter({ ensureSelected: true });\n  if (!selection) {\n    return;\n  }\n  const { ctx, st } = selection;\n  const target = normalizeChatId(file);\n  const opener =\n    (ctx && typeof ctx.openCharacterChat === \'function\' ? ctx.openCharacterChat : null) ??\n    (st && typeof st.openCharacterChat === \'function\' ? st.openCharacterChat : null);\n  if (!opener) {\n    toastr.error(\'无法打开聊天：缺少接口\');\n    return;\n  }\n  try {\n    void Promise.resolve(opener(target)).catch(error => {\n      console.warn(\'[CardHub] 打开聊天失败\', error);\n    });\n  } catch (error) {\n    console.warn(\'[CardHub] 打开聊天失败\', error);\n  }\n  const opened = await waitForChatOpen(target, ctx, st, 6000);\n  if (opened) {\n    closeManage();\n    close();\n    return;\n  }\n  toastr.warning(\'未能打开聊天，可能需要先手动切到该角色\');\n}\n\nasync function selectManageCharacter(\n  options: { ensureSelected?: boolean } = {},\n): Promise<{ ctx: any; st: typeof SillyTavern | undefined; idx: number } | null> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === \'function\') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn(\'[CardHub] 刷新角色列表失败\', error);\n    }\n  }\n  const list = ctx?.characters ?? st?.characters ?? [];\n  const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n  if (idx < 0) {\n    toastr.warning(\'未找到角色索引，请先手动切到该角色后再试\');\n    return null;\n  }\n  const selector =\n    (ctx && typeof ctx.selectCharacterById === \'function\' ? ctx.selectCharacterById : null) ??\n    (st && typeof st.selectCharacterById === \'function\' ? st.selectCharacterById : null);\n  if (!selector) {\n    toastr.warning(\'无法切换角色，请先手动切到该角色后再试\');\n    return null;\n  }\n  try {\n    await selector(idx, { switchMenu: false });\n  } catch (error) {\n    console.warn(\'[CardHub] 切换角色失败\', error);\n  }\n  const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n  if (options.ensureSelected && !selected) {\n    toastr.warning(\'角色切换未完成，请稍后再试\');\n    return null;\n  }\n  return { ctx, st, idx };\n}\n\nasync function waitForCharacterSelection(\n  idx: number,\n  ctx: any,\n  st: typeof SillyTavern | undefined,\n  timeoutMs: number,\n): Promise<boolean> {\n  const target = String(idx);\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const current = getCurrentCharacterId(ctx, st);\n    if (current === target) {\n      return true;\n    }\n    await sleep(80);\n  }\n  return false;\n}\n\nfunction getCurrentCharacterId(ctx: any, st: typeof SillyTavern | undefined): string {\n  const value = ctx?.characterId ?? st?.characterId ?? \'\';\n  return value === undefined || value === null ? \'\' : String(value);\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction findCharacterIndex(list: SillyTavern.v1CharData[], card: CardHubItem): number {\n  if (card.avatar) {\n    const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\n    if (byAvatar >= 0) {\n      return byAvatar;\n    }\n  }\n  return list.findIndex(item => item.name === card.name);\n}\n\nfunction normalizeChatId(id: string): string {\n  return id.endsWith(\'.jsonl\') ? id : `${id}.jsonl`;\n}\n\nasync function waitForChatOpen(\n  file: string,\n  ctx: any,\n  st: typeof SillyTavern | undefined,\n  timeoutMs: number,\n): Promise<boolean> {\n  const target = normalizeChatId(file);\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const current = ctx?.chatId ?? st?.chatId;\n    if (current === target) {\n      return true;\n    }\n    await new Promise(resolve => setTimeout(resolve, 200));\n  }\n  return false;\n}\n\nasync function manageDelete(card: CardHubItem) {\n  if (card.origin === \'library\') {\n    const confirmDelete = await openConfirm({\n      title: \'删除角色\',\n      message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n      confirmLabel: \'删除\',\n      cancelLabel: \'取消\',\n    });\n    if (confirmDelete !== \'confirm\') {\n      return;\n    }\n    setLibrary(removeFromLibrary(card.id));\n    closeManage();\n    return;\n  }\n\n  const confirmDelete = await openConfirm({\n    title: \'删除角色\',\n    message: `确定要删除「${card.name}」吗？`,\n    confirmLabel: \'继续\',\n    cancelLabel: \'取消\',\n  });\n  if (confirmDelete !== \'confirm\') {\n    return;\n  }\n  const deleteChoice = await openConfirm({\n    title: \'删除方式\',\n    message:\n      `删除「${card.name}」：\\n` +\n      `- 移到私有库：可在私有库中找回\\n` +\n      `- 永久删除：不可恢复`,\n    confirmLabel: \'移到私有库\',\n    altLabel: \'永久删除\',\n    cancelLabel: \'取消\',\n  });\n  if (deleteChoice === \'cancel\') {\n    return;\n  }\n  if (deleteChoice === \'confirm\') {\n    await moveToLibrary(card);\n    const deleted = await deleteFromTavern(card, false);\n    if (!deleted) {\n      return;\n    }\n    closeManage();\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    return;\n  }\n  const confirmPermanent = await openConfirm({\n    title: \'永久删除\',\n    message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n    confirmLabel: \'永久删除\',\n    cancelLabel: \'取消\',\n  });\n  if (confirmPermanent !== \'confirm\') {\n    return;\n  }\n  const deleted = await deleteFromTavern(card, true);\n  if (!deleted) {\n    return;\n  }\n  closeManage();\n  const characters = await fetchCharacterSummaries();\n  setCharacters(characters);\n}\n\nasync function moveToLibrary(card: CardHubItem) {\n  if (!card.avatar) {\n    return;\n  }\n  const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n  if (!avatarPath) {\n    toastr.error(\'无法导出：缺少头像信息\');\n    return;\n  }\n  const response = await fetch(avatarPath, { cache: \'no-cache\' });\n  const blob = await response.blob();\n  const updated = await addToLibrary([\n    new File([blob], `${card.name}.png`, { type: \'image/png\' }),\n  ]);\n  setLibrary(updated);\n}\n\nasync function deleteFromTavern(card: CardHubItem, deleteChats: boolean): Promise<boolean> {\n  if (!card.avatar) {\n    toastr.error(\'删除失败：缺少头像信息\');\n    return false;\n  }\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === \'function\' ? st.getContext() : null;\n  const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.()) as\n    | Record<string, string>\n    | undefined;\n  if (!headers || !Object.keys(headers).length) {\n    toastr.error(\'删除失败：无法获取请求头\');\n    return false;\n  }\n  const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n  const response = await fetch(\'/api/characters/delete\', {\n    method: \'POST\',\n    headers: { ...headers, \'Content-Type\': \'application/json\' },\n    body: JSON.stringify(payload),\n    cache: \'no-cache\',\n  });\n  if (response.ok) {\n    return true;\n  }\n  const detail = await response.text();\n  toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n  return false;\n}\n\nfunction downloadBlob(blob: Blob, fileName: string) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement(\'a\');\n  a.href = url;\n  a.download = fileName;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\n\n\nasync function dataUrlToBlob(dataUrl: string): Promise<Blob> {\n  const response = await fetch(dataUrl);\n  return await response.blob();\n}\n\n\nasync function refresh() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nfunction close() {\n  setOpen(false);\n}\n\n<\/script>\n\n<style scoped>\n.cardhub-root {\n  position: fixed;\n  inset: 0;\n  z-index: 9999;\n  font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n  color: #1b1b1b;\n  display: none;\n  align-items: center;\n  justify-content: center;\n}\n\n.cardhub-root.open {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.cardhub-backdrop {\n  position: absolute;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(6px);\n  opacity: 0;\n  transition: opacity 180ms ease;\n}\n\n.cardhub-root.open .cardhub-backdrop {\n  opacity: 1;\n}\n\n.cardhub-panel {\n  position: relative;\n  width: min(980px, 94%);\n  max-height: 92%;\n  background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n  border-radius: 28px;\n  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  z-index: 1;\n  opacity: 0;\n  transform: translateY(8px) scale(0.985);\n  transition: opacity 180ms ease, transform 180ms ease;\n}\n\n.cardhub-root.open .cardhub-panel {\n  opacity: 1;\n  transform: translateY(0) scale(1);\n}\n\n.cardhub-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 20px 24px;\n  border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n}\n\n.cardhub-title__main {\n  font-size: 26px;\n  letter-spacing: 2px;\n}\n\n.cardhub-title__sub {\n  font-size: 12px;\n  color: #7d5b46;\n  margin-left: 10px;\n}\n\n.cardhub-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.cardhub-close {\n  border: none;\n  background: rgba(43, 32, 24, 0.12);\n  color: #3b2a20;\n  width: 34px;\n  height: 34px;\n  border-radius: 999px;\n  font-size: 20px;\n  line-height: 34px;\n  text-align: center;\n  cursor: pointer;\n  transition: background-color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-close:hover {\n  background: rgba(43, 32, 24, 0.2);\n}\n\n.cardhub-close:active {\n  transform: scale(0.96);\n}\n\n.cardhub-toolbar {\n  display: flex;\n  gap: 8px;\n  padding: 12px 20px;\n  flex-wrap: wrap;\n}\n\n.cardhub-search {\n  flex: 1;\n  min-width: 180px;\n  border-radius: 999px;\n  border: 1px solid rgba(86, 59, 44, 0.2);\n  padding: 6px 12px;\n  background: #fffaf4;\n}\n\n.cardhub-button {\n  border: none;\n  padding: 6px 14px;\n  border-radius: 999px;\n  background: #d46b3d;\n  color: #fff;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n}\n\n.cardhub-button:hover {\n  background: #c55f36;\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-button:active {\n  transform: translateY(1px);\n}\n\n.cardhub-button.is-ghost {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-button.is-ghost:hover {\n  background: rgba(106, 63, 42, 0.08);\n  border-color: rgba(106, 63, 42, 0.6);\n  box-shadow: none;\n}\n\n.cardhub-import-input {\n  display: none;\n}\n\n.cardhub-body {\n  display: grid;\n  grid-template-columns: minmax(160px, 220px) 1fr;\n  gap: 0;\n  flex: 1;\n  min-height: 0;\n}\n\n.cardhub-sidebar {\n  padding: 20px;\n  border-right: 1px solid rgba(86, 59, 44, 0.15);\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.cardhub-chip-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-divider {\n  height: 1px;\n  width: 100%;\n  background: rgba(86, 59, 44, 0.15);\n  margin: 8px 0;\n}\n\n.cardhub-section-title {\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-chip {\n  text-align: left;\n  border: none;\n  background: rgba(255, 255, 255, 0.6);\n  border-radius: 12px;\n  padding: 8px 10px;\n  cursor: pointer;\n  font-size: 12px;\n  transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-chip:not(.is-active):hover {\n  background: rgba(255, 255, 255, 0.9);\n  transform: translateY(-1px);\n}\n\n.cardhub-placeholder {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-tag-filter {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-tag-filter__chip {\n  border: 1px solid rgba(106, 63, 42, 0.25);\n  background: rgba(255, 255, 255, 0.7);\n  border-radius: 999px;\n  padding: 6px 10px;\n  font-size: 12px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-tag-filter__chip.is-active {\n  background: #2b2018;\n  color: #fff5ea;\n  border-color: transparent;\n}\n\n.cardhub-tag-filter__chip:not(.is-active):hover {\n  border-color: rgba(106, 63, 42, 0.45);\n  background: rgba(255, 255, 255, 0.9);\n  transform: translateY(-1px);\n}\n\n.cardhub-chip--clear {\n  margin-top: 8px;\n}\n\n  .cardhub-content {\n    padding: 20px;\n    overflow: auto;\n    flex: 1;\n    min-height: 0;\n  }\n\n.cardhub-grid-wrap {\n  display: grid;\n  gap: 12px;\n}\n\n.cardhub-pagination {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 10px;\n  flex-wrap: wrap;\n}\n\n.cardhub-pagination__status {\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-pagination__actions {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  margin-right: auto;\n}\n\n.cardhub-pagination__button {\n  border: 1px solid rgba(106, 63, 42, 0.35);\n  background: rgba(255, 255, 255, 0.85);\n  color: #6a3f2a;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  cursor: pointer;\n  transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-pagination__button:disabled {\n  opacity: 0.4;\n  cursor: default;\n}\n\n.cardhub-pagination__button:not(:disabled):hover {\n  background: rgba(255, 255, 255, 1);\n  border-color: rgba(106, 63, 42, 0.6);\n  transform: translateY(-1px);\n}\n\n.cardhub-pagination__button:not(:disabled):active {\n  transform: translateY(0);\n}\n\n.cardhub-loading,\n.cardhub-empty {\n  padding: 40px 0;\n  text-align: center;\n  color: #7d5b46;\n}\n\n.cardhub-grid {\n  display: grid;\n  gap: 14px;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  justify-items: center;\n}\n\n.cardhub-card {\n  background: rgba(255, 255, 255, 0.78);\n  border-radius: 18px;\n  padding: 14px;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  gap: 12px;\n  align-items: center;\n  border: 1px solid rgba(86, 59, 44, 0.15);\n  cursor: pointer;\n  transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n  width: 100%;\n  max-width: 260px;\n}\n\n.cardhub-card:hover {\n  transform: translateY(-2px);\n  border-color: rgba(86, 59, 44, 0.25);\n  box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\n}\n\n.cardhub-card:active {\n  transform: translateY(0);\n}\n\n.cardhub-card__avatar {\n  width: 42px;\n  height: 42px;\n  border-radius: 12px;\n  background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n  background-size: cover;\n  background-position: center;\n  color: #4a2a1f;\n  display: grid;\n  place-items: center;\n  font-weight: 700;\n}\n\n.cardhub-card__avatar.has-avatar span {\n  display: none;\n}\n\n.cardhub-card__name {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.cardhub-card__meta {\n  display: flex;\n  gap: 8px;\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-card__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n  margin-top: 8px;\n  align-items: center;\n}\n\n.cardhub-tag {\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fff6ea;\n  border-radius: 999px;\n  padding: 4px 8px;\n  font-size: 11px;\n  color: #6a3f2a;\n  cursor: pointer;\n  transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-tag:hover {\n  background: #fffaf4;\n  border-color: rgba(106, 63, 42, 0.5);\n  transform: translateY(-1px);\n}\n\n.cardhub-tag__remove {\n  margin-left: 4px;\n  font-weight: 700;\n}\n\n.cardhub-tag.is-add {\n  background: transparent;\n  border-style: dashed;\n}\n\n.cardhub-tag-input {\n  border: 1px dashed rgba(106, 63, 42, 0.5);\n  background: #fffaf4;\n  border-radius: 999px;\n  padding: 4px 10px;\n  font-size: 11px;\n  min-width: 80px;\n  color: #6a3f2a;\n  outline: none;\n  height: 24px;\n  line-height: 16px;\n}\n\n.cardhub-tag-input:focus {\n  border-color: rgba(106, 63, 42, 0.85);\n}\n\n.cardhub-card__action {\n  grid-column: span 2;\n  margin-top: 10px;\n  border: none;\n  background: #2b2018;\n  color: #fff5ea;\n  padding: 6px 12px;\n  border-radius: 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n}\n\n.cardhub-card__actions {\n  grid-column: span 2;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 8px;\n  margin-top: 10px;\n}\n\n.cardhub-card__action.is-secondary {\n  background: #d9c6b6;\n  color: #3b2a20;\n}\n\n.cardhub-card__action:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n}\n\n.cardhub-card__action:active {\n  transform: translateY(0);\n}\n\n.cardhub-preview {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100000;\n}\n\n.cardhub-preview__panel {\n  width: min(520px, 92vw);\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 20px;\n  position: relative;\n  display: grid;\n  gap: 14px;\n}\n\n.cardhub-preview__close {\n  position: absolute;\n  top: 14px;\n  right: 14px;\n  border: none;\n  width: 30px;\n  height: 30px;\n  border-radius: 999px;\n  background: rgba(43, 32, 24, 0.15);\n  color: #3b2a20;\n  font-size: 18px;\n  cursor: pointer;\n  transition: background-color 160ms ease, transform 120ms ease;\n}\n\n.cardhub-preview__close:hover {\n  background: rgba(43, 32, 24, 0.25);\n}\n\n.cardhub-preview__close:active {\n  transform: scale(0.96);\n}\n\n.cardhub-preview__avatar {\n  width: 100%;\n  height: 260px;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-preview__avatar img {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n}\n\n.cardhub-preview__info {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-preview__name {\n  font-size: 20px;\n  font-weight: 700;\n}\n\n.cardhub-preview__meta {\n  display: flex;\n  gap: 10px;\n  font-size: 12px;\n  color: #7d5b46;\n}\n\n.cardhub-preview__tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.cardhub-preview__tag {\n  padding: 6px 10px;\n  border-radius: 999px;\n  border: 1px solid rgba(106, 63, 42, 0.3);\n  background: #fffaf4;\n  font-size: 12px;\n  color: #6a3f2a;\n}\n\n.cardhub-preview__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n\n.cardhub-manage {\n  position: fixed;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.45);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100001;\n}\n\n.cardhub-manage__panel {\n  width: min(760px, 94vw);\n  max-height: 88vh;\n  background: #fff6ea;\n  border-radius: 26px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 22px;\n  position: relative;\n  display: grid;\n  gap: 16px;\n  overflow: auto;\n}\n\n.cardhub-manage__top {\n  display: grid;\n  grid-template-columns: 1fr auto;\n  gap: 16px;\n  align-items: start;\n}\n\n.cardhub-manage__media {\n  width: 220px;\n  aspect-ratio: 3 / 4;\n  height: auto;\n  border-radius: 18px;\n  background: #ead7c4;\n  display: grid;\n  place-items: center;\n  overflow: hidden;\n}\n\n.cardhub-manage__media img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.cardhub-manage__summary {\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-manage__overview {\n  display: grid;\n  gap: 10px;\n  margin-top: 10px;\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n}\n\n.cardhub-manage__overview-card {\n  background: rgba(255, 255, 255, 0.7);\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 14px;\n  padding: 10px 12px;\n  display: grid;\n  gap: 4px;\n}\n\n.cardhub-manage__overview-label {\n  font-size: 10px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__overview-value {\n  font-size: 13px;\n  font-weight: 600;\n  color: #3b2a20;\n}\n\n.cardhub-manage__overview-hint {\n  font-size: 11px;\n  color: #7d5b46;\n}\n\n.cardhub-manage__section {\n  display: grid;\n  gap: 8px;\n}\n\n.cardhub-manage__details {\n  display: grid;\n  gap: 12px;\n  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n}\n\n.cardhub-manage__detail {\n  background: #fffaf4;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 16px;\n  padding: 12px 14px;\n  display: grid;\n  gap: 6px;\n}\n\n.cardhub-manage__detail-label {\n  font-size: 11px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__detail-content {\n  font-size: 12px;\n  line-height: 1.5;\n  color: #3b2a20;\n  white-space: pre-wrap;\n}\n\n.cardhub-manage__label {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 8px;\n  font-size: 12px;\n  color: #7d5b46;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n}\n\n.cardhub-manage__btn {\n  border: none;\n  border-radius: 12px;\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  text-transform: none;\n  transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n}\n\n.cardhub-manage__btn.is-primary {\n  background: #2b2018;\n  color: #fff5ea;\n}\n\n.cardhub-manage__btn.is-secondary {\n  background: #d9c6b6;\n  color: #3b2a20;\n}\n\n.cardhub-manage__jump-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  align-items: center;\n}\n\n.cardhub-manage__btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n}\n\n.cardhub-manage__btn.is-primary:hover {\n  background: #241a14;\n}\n\n.cardhub-manage__btn.is-secondary:hover {\n  background: #d1bca8;\n}\n\n.cardhub-manage__btn:active {\n  transform: translateY(0);\n}\n\n.cardhub-manage__content {\n  background: #fffaf4;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  border-radius: 16px;\n  padding: 12px 14px;\n  font-size: 12px;\n  line-height: 1.5;\n  color: #3b2a20;\n  white-space: pre-wrap;\n}\n\n.cardhub-manage__opening {\n  padding: 6px 0;\n  border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n}\n\n.cardhub-manage__opening:last-child {\n  border-bottom: none;\n}\n\n.cardhub-manage__chat {\n  display: grid;\n  gap: 10px;\n}\n\n.cardhub-manage__chat-row {\n  display: grid;\n  grid-template-columns: minmax(140px, 220px) 1fr;\n  gap: 12px;\n  font-size: 12px;\n  color: #3b2a20;\n  align-items: start;\n  padding: 6px 8px;\n  border-radius: 10px;\n  cursor: pointer;\n}\n\n.cardhub-manage__chat-row:hover {\n  background: rgba(106, 63, 42, 0.08);\n}\n\n.cardhub-manage__chat-main {\n  display: grid;\n  gap: 4px;\n}\n\n.cardhub-manage__chat-name {\n  flex: 0 0 auto;\n  font-weight: 600;\n  color: #6a3f2a;\n  word-break: break-word;\n}\n\n.cardhub-manage__chat-label {\n  font-size: 11px;\n  color: #9a7a63;\n  word-break: break-word;\n}\n\n.cardhub-manage__chat-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n}\n\n.cardhub-manage__chat-tag {\n  padding: 2px 6px;\n  border-radius: 999px;\n  border: 1px solid rgba(106, 63, 42, 0.2);\n  background: rgba(255, 255, 255, 0.75);\n  font-size: 10px;\n  color: #6a3f2a;\n}\n\n.cardhub-manage__chat-text {\n  color: #3b2a20;\n  line-height: 1.5;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.cardhub-manage__empty {\n  font-size: 12px;\n  color: #9a7a63;\n}\n\n.cardhub-manage__actions {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n\n.cardhub-confirm {\n  position: absolute;\n  inset: 0;\n  background: rgba(24, 16, 10, 0.55);\n  backdrop-filter: blur(6px);\n  display: grid;\n  place-items: center;\n  z-index: 100002;\n}\n\n.cardhub-confirm__panel {\n  width: min(460px, 92vw);\n  background: #fff6ea;\n  border-radius: 22px;\n  box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n  padding: 18px 20px;\n  display: grid;\n  gap: 12px;\n}\n\n.cardhub-confirm__title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #2b2018;\n}\n\n.cardhub-confirm__message {\n  font-size: 13px;\n  line-height: 1.5;\n  color: #4a2a1f;\n  white-space: pre-wrap;\n}\n\n.cardhub-confirm__actions {\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n  flex-wrap: wrap;\n}\n\n.cardhub-confirm__button {\n  border: none;\n  border-radius: 999px;\n  padding: 8px 14px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n}\n\n.cardhub-confirm__button.is-confirm {\n  background: #d46b3d;\n  color: #fff;\n}\n\n.cardhub-confirm__button.is-cancel {\n  background: transparent;\n  color: #6a3f2a;\n  border: 1px solid rgba(106, 63, 42, 0.4);\n}\n\n.cardhub-confirm__button.is-danger {\n  background: #b6452a;\n  color: #fff;\n}\n\n.cardhub-confirm__button:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n}\n\n.cardhub-confirm__button:active {\n  transform: translateY(0);\n}\n\n.cardhub-button:focus-visible,\n.cardhub-chip:focus-visible,\n.cardhub-tag-filter__chip:focus-visible,\n.cardhub-tag:focus-visible,\n.cardhub-card__action:focus-visible,\n.cardhub-pagination__button:focus-visible,\n.cardhub-manage__btn:focus-visible,\n.cardhub-close:focus-visible,\n.cardhub-preview__close:focus-visible,\n.cardhub-confirm__button:focus-visible {\n  outline: 2px solid rgba(212, 107, 61, 0.6);\n  outline-offset: 2px;\n}\n@media (max-width: 720px) {\n  .cardhub-root {\n    position: absolute !important;\n    inset: 0 !important;\n    z-index: 99999 !important;\n    display: none;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n    overflow-y: auto !important;\n  }\n\n  .cardhub-root.open {\n    display: flex !important;\n  }\n\n  .cardhub-backdrop {\n    position: absolute !important;\n    inset: 0 !important;\n    z-index: 99998 !important;\n    background: rgba(0, 0, 0, 0.4) !important;\n    backdrop-filter: blur(8px) !important;\n  }\n\n  .cardhub-panel {\n    position: relative !important;\n    width: 100% !important;\n    height: 100% !important;\n    max-height: 100% !important;\n    max-width: none !important;\n    margin: 0 !important;\n    border-radius: 24px !important;\n    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.1) !important;\n    display: flex !important;\n    flex-direction: column !important;\n    z-index: 99999 !important;\n    overflow: hidden !important;\n    border: 1px solid rgba(255, 255, 255, 0.15) !important;\n  }\n\n  .cardhub-header {\n    flex-shrink: 0;\n    padding: 14px 16px;\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n  }\n\n  .cardhub-title__main {\n    font-size: 20px;\n  }\n\n  .cardhub-title__sub {\n    font-size: 11px;\n  }\n\n  .cardhub-close {\n    width: 28px;\n    height: 28px;\n    font-size: 16px;\n    line-height: 28px;\n  }\n\n  .cardhub-toolbar {\n    flex-shrink: 0;\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    padding: 10px 14px;\n  }\n\n  .cardhub-search {\n    width: 100%;\n    font-size: 13px;\n    padding: 8px 12px;\n  }\n\n  .cardhub-button {\n    flex: 1;\n    min-width: 0;\n    font-size: 11px;\n    padding: 6px 10px;\n  }\n\n  .cardhub-body {\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0;\n    overflow: auto;\n  }\n\n  .cardhub-sidebar {\n    flex-shrink: 0;\n    border-right: none;\n    border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n    padding: 10px 14px;\n    max-height: none;\n    overflow: visible;\n  }\n\n  .cardhub-section-title {\n    font-size: 10px;\n    margin-bottom: 6px;\n  }\n\n  .cardhub-divider {\n    margin: 6px 0;\n  }\n\n  .cardhub-chip-row,\n  .cardhub-tag-filter {\n    display: flex;\n    flex-wrap: wrap;\n    overflow: visible;\n    gap: 6px;\n    padding-bottom: 4px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar,\n  .cardhub-tag-filter::-webkit-scrollbar {\n    height: 4px;\n  }\n\n  .cardhub-chip-row::-webkit-scrollbar-thumb,\n  .cardhub-tag-filter::-webkit-scrollbar-thumb {\n    background: rgba(106, 63, 42, 0.15);\n    border-radius: 999px;\n  }\n\n  .cardhub-chip {\n    font-size: 11px;\n    padding: 5px 10px;\n    white-space: nowrap;\n    flex-shrink: 0;\n  }\n\n  .cardhub-tag-filter__chip {\n    font-size: 10px;\n    padding: 4px 8px;\n    white-space: nowrap;\n    flex-shrink: 0;\n  }\n\n  .cardhub-content {\n    flex: 1;\n    min-height: 0;\n    overflow: visible;\n    padding: 12px;\n  }\n\n  .cardhub-pagination {\n    align-items: flex-start;\n  }\n\n  .cardhub-pagination__actions {\n    width: 100%;\n  }\n\n  .cardhub-pagination__button {\n    flex: 1;\n    text-align: center;\n  }\n\n  .cardhub-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n    gap: 10px;\n    justify-content: center;\n    justify-items: center;\n  }\n\n  .cardhub-card {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 10px;\n    padding: 10px;\n    border-radius: 14px;\n    min-width: 0;\n    width: 100%;\n    max-width: none;\n  }\n\n  .cardhub-card__avatar {\n    width: 40px;\n    height: 40px;\n    flex-shrink: 0;\n    border-radius: 10px;\n  }\n\n  .cardhub-card__info {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .cardhub-card__name {\n    font-size: 13px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .cardhub-card__meta {\n    font-size: 10px;\n    gap: 6px;\n  }\n\n  .cardhub-card__tags {\n    margin-top: 4px;\n    gap: 4px;\n  }\n\n  .cardhub-tag {\n    font-size: 9px;\n    padding: 3px 6px;\n  }\n\n  .cardhub-card__actions {\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n    flex-shrink: 0;\n  }\n\n  .cardhub-card__action {\n    padding: 5px 10px;\n    font-size: 10px;\n    border-radius: 8px;\n  }\n\n  .cardhub-preview,\n  .cardhub-manage {\n    position: absolute !important;\n    inset: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    padding: 16px !important;\n    box-sizing: border-box !important;\n    overflow-y: auto !important;\n  }\n\n  .cardhub-preview__panel,\n  .cardhub-manage__panel {\n    width: calc(100vw - 32px) !important;\n    max-width: 360px !important;\n    max-height: calc(100vh - 32px) !important;\n    max-height: calc(100dvh - 32px) !important;\n    border-radius: 18px !important;\n    padding: 16px !important;\n    overflow: auto !important;\n  }\n\n  .cardhub-preview__avatar {\n    height: 180px;\n    border-radius: 14px;\n  }\n\n  .cardhub-preview__name {\n    font-size: 16px;\n  }\n\n  .cardhub-preview__meta {\n    font-size: 11px;\n  }\n\n  .cardhub-preview__tag {\n    font-size: 10px;\n    padding: 4px 8px;\n  }\n\n  .cardhub-preview__actions {\n    gap: 8px;\n  }\n\n  .cardhub-manage__top {\n    grid-template-columns: 1fr;\n    gap: 12px;\n  }\n\n  .cardhub-manage__media {\n    width: 120px;\n    margin: 0 auto;\n  }\n\n  .cardhub-manage__overview {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-manage__overview-value {\n    font-size: 12px;\n  }\n\n  .cardhub-manage__overview-hint {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__label {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 6px;\n    font-size: 10px;\n  }\n\n  .cardhub-manage__details {\n    grid-template-columns: 1fr;\n  }\n\n  .cardhub-manage__detail-label {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__detail-content {\n    font-size: 11px;\n  }\n\n  .cardhub-manage__btn {\n    width: 100%;\n    text-align: center;\n    font-size: 10px;\n  }\n\n  .cardhub-manage__jump-row {\n    width: 100%;\n  }\n\n  .cardhub-manage__content {\n    font-size: 11px;\n    padding: 10px;\n  }\n\n  .cardhub-manage__chat-row {\n    grid-template-columns: 1fr;\n    gap: 3px;\n    font-size: 11px;\n  }\n\n  .cardhub-manage__chat-label {\n    font-size: 10px;\n  }\n\n  .cardhub-manage__chat-tag {\n    font-size: 9px;\n  }\n\n  .cardhub-manage__chat-text {\n    -webkit-line-clamp: 2;\n  }\n\n  .cardhub-manage__actions {\n    grid-template-columns: 1fr 1fr;\n    gap: 8px;\n  }\n}\n</style>\n'],sourceRoot:''}]);const c=o},424(n,a,e){function t(n,a){for(var e=[],t={},r=0;r<a.length;r++){var i=a[r],o=i[0],c={id:n+':'+r,css:i[1],media:i[2],sourceMap:i[3]};t[o]?t[o].parts.push(c):e.push(t[o]={id:o,parts:[c]})}return e}e.d(a,{A:()=>g});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var i={},o=r&&(document.head||document.getElementsByTagName('head')[0]),c=null,s=0,d=!1,l=function(){},p=null,u='data-vue-ssr-id',b='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(n,a,e,r){d=e,p=r||{};var o=t(n,a);return f(o),function(a){for(var e=[],r=0;r<o.length;r++){var c=o[r];(s=i[c.id]).refs--,e.push(s)}a?f(o=t(n,a)):o=[];for(r=0;r<e.length;r++){var s;if(0===(s=e[r]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete i[s.id]}}}}function f(n){for(var a=0;a<n.length;a++){var e=n[a],t=i[e.id];if(t){t.refs++;for(var r=0;r<t.parts.length;r++)t.parts[r](e.parts[r]);for(;r<e.parts.length;r++)t.parts.push(A(e.parts[r]));t.parts.length>e.parts.length&&(t.parts.length=e.parts.length)}else{var o=[];for(r=0;r<e.parts.length;r++)o.push(A(e.parts[r]));i[e.id]={id:e.id,refs:1,parts:o}}}}function m(){var n=document.createElement('style');return n.type='text/css',o.appendChild(n),n}function A(n){var a,e,t=document.querySelector('style['+u+'~="'+n.id+'"]');if(t){if(d)return l;t.parentNode.removeChild(t)}if(b){var r=s++;t=c||(c=m()),a=x.bind(null,t,r,!1),e=x.bind(null,t,r,!0)}else t=m(),a=v.bind(null,t),e=function(){t.parentNode.removeChild(t)};return a(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap)return;a(n=t)}else e()}}var h,C=(h=[],function(n,a){return h[n]=a,h.filter(Boolean).join('\n')});function x(n,a,e,t){var r=e?'':t.css;if(n.styleSheet)n.styleSheet.cssText=C(a,r);else{var i=document.createTextNode(r),o=n.childNodes;o[a]&&n.removeChild(o[a]),o.length?n.insertBefore(i,o[a]):n.appendChild(i)}}function v(n,a){var e=a.css,t=a.media,r=a.sourceMap;if(t&&n.setAttribute('media',t),p.ssrId&&n.setAttribute(u,a.id),r&&(e+='\n/*# sourceURL='+r.sources[0]+' */',e+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},492(n){n.exports=function(n){var a=n[1],e=n[3];if(!e)return a;if('function'==typeof btoa){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(t),i='/*# '.concat(r,' */');return[a].concat([i]).join('\n')}return[a].join('\n')}},502(n,a){a.A=(n,a)=>{const e=n.__vccOpts||n;for(const[n,t]of a)e[n]=t;return e}},748(n){n.exports=function(n){var a=[];return a.toString=function(){return this.map(function(a){var e='',t=void 0!==a[5];return a[4]&&(e+='@supports ('.concat(a[4],') {')),a[2]&&(e+='@media '.concat(a[2],' {')),t&&(e+='@layer'.concat(a[5].length>0?' '.concat(a[5]):'',' {')),e+=n(a),t&&(e+='}'),a[2]&&(e+='}'),a[4]&&(e+='}'),e}).join('')},a.i=function(n,e,t,r,i){'string'==typeof n&&(n=[[null,n,void 0]]);var o={};if(t)for(var c=0;c<this.length;c++){var s=this[c][0];null!=s&&(o[s]=!0)}for(var d=0;d<n.length;d++){var l=[].concat(n[d]);t&&o[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]='@layer'.concat(l[5].length>0?' '.concat(l[5]):'',' {').concat(l[1],'}')),l[5]=i),e&&(l[2]?(l[1]='@media '.concat(l[2],' {').concat(l[1],'}'),l[2]=e):l[2]=e),r&&(l[4]?(l[1]='@supports ('.concat(l[4],') {').concat(l[1],'}'),l[4]=r):l[4]=''.concat(r)),a.push(l))}},a}},968(){eventOn(tavern_events.MESSAGE_UPDATED,n=>{toastr.error(`谁让你动我第 ${n} 楼消息的😡`,'干什么!')})}},o={};function c(n){var a=o[n];if(void 0!==a)return a.exports;var e=o[n]={id:n,exports:{}};return i[n](e,e.exports,c),e.exports}c.n=n=>{var a=n&&n.__esModule?()=>n.default:()=>n;return c.d(a,{a}),a},c.d=(n,a)=>{for(var e in a)c.o(a,e)&&!c.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:a[e]})},c.o=(n,a)=>Object.prototype.hasOwnProperty.call(n,a),c.r=n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})},(()=>{c(331),c(119),c(968);var i=c(337);(0,i.hb)();var o=c(61);const s=z,d=s.z.object({button_selected:s.z.boolean().default(!1)}).prefault({}),l=a('settings',()=>{const n=(0,o.ref)(d.parse(getVariables({type:'script',script_id:getScriptId()})));return(0,o.watchEffect)(()=>{insertOrAssignVariables(t(n.value),{type:'script',script_id:getScriptId()})}),{settings:n}}),p={class:'example-extension-settings'},u={class:'inline-drawer'},b={class:'inline-drawer-content'},g={class:'example-extension_block flex-container'},f=(0,o.defineComponent)({__name:'设置界面',setup(n){const{settings:a}=e(l()),t=()=>{toastr.success('你好呀!')};return(n,e)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',p,[(0,o.createElementVNode)('div',u,[e[3]||(e[3]=(0,o.createElementVNode)('div',{class:'inline-drawer-toggle inline-drawer-header'},[(0,o.createElementVNode)('b',null,(0,o.toDisplayString)('脚本示例')),(0,o.createElementVNode)('div',{class:'inline-drawer-icon fa-solid fa-circle-chevron-down down'})],-1)),(0,o.createElementVNode)('div',b,[(0,o.createElementVNode)('div',{class:'example-extension_block flex-container'},[(0,o.createElementVNode)('input',{class:'menu_button',type:'submit',value:'示例按钮',onClick:t})]),(0,o.createElementVNode)('div',g,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':e[0]||(e[0]=n=>(0,o.unref)(a).button_selected=n),type:'checkbox'},null,512),[[o.vModelCheckbox,(0,o.unref)(a).button_selected]]),e[1]||(e[1]=(0,o.createElementVNode)('label',{for:'example_setting'},(0,o.toDisplayString)('示例开关'),-1))]),e[2]||(e[2]=(0,o.createElementVNode)('hr',{class:'sysHR'},null,-1))])])]))}});$(()=>{const a=(0,o.createApp)(f).use(n()),e=(0,i.g8)().appendTo('#extensions_settings2');a.mount(e[0]);const{destroy:t}=(0,i.N7)();$(window).on('pagehide',()=>{a.unmount(),e.remove(),t()})}),$(async()=>{0===getLastMessageId()&&await createChatMessages([{role:'assistant',message:r('\n                   [查看日记: 这是第二次看我的日记了呢~]\n                   <roleplay_options>\n                   接受日记本并翻阅: 青空黎接过她递来的粉色日记本，在天台阳光下缓缓翻开第一页\n                   保持沉默盯着她看: 青空黎没有接本子，只是盯着她略显紧张的表情和轻颤的声音\n                   坐到她身边: 青空黎没有立刻回应，而是缓缓走到络络身边坐下，等待她自己继续说\n                   开玩笑化解气氛: 青空黎微微一笑，开玩笑地说「所以，是要让我当监督官啦？」\n                   跳过时间: 青空黎接过日记本，安静地翻了几页，时间悄然流逝至黄昏深处\n                   和络络聊天: 青空黎试探性地问：「这本是从哪天开始写的？都写些什么呀？」\n                   </roleplay_options>\n                 ')},{role:'assistant',message:r('\n                   [查看日记: 真是的, 就这么喜欢看吗(v〃ω〃)]\n                   <roleplay_options>\n                   阅读日记第一页：青空黎打开粉色的日记本，从第一页开始认真阅读络络的记录内容。\n                   问她封面上的兔子贴纸：青空黎好奇那枚蓝色兔子贴纸的来历，转头向络络询问。\n                   观察络络的小动作：青空黎不急着翻开日记，而是注意到络络表情里一丝期待与不安。\n                   和她闲聊天气：青空黎随口聊起傍晚风有点凉，试图舒缓紧张气氛。\n                   调侃她：“有哪页是‘不许看’的？”青空黎轻松地试图化解她的小慌乱。\n                   转身回教室：青空黎接过日记却并未立刻翻开，而是表示回教室再看，打算慢慢阅读。\n                   </roleplay_options>\n                 ')}],{refresh:'all'})})})(),(()=>{function n(n){const t=[],r=function(n){const t=`cardhub-entry-${getScriptId()}`,r=$(`#${t}`);if(r.length)return r.addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').empty(),null;const i=function(){const n=['#rm_button_bar','#character_panel','#rightNavBar','#right-nav-panel','#character-search','#top-settings-holder'];for(const a of n){const n=$(a).first();if(n.length)return n}const a=$('button, .menu_button, .nav_button').filter((_,n)=>{const a=$(n).text(),e=n.getAttribute('title')??n.getAttribute('aria-label')??'';return/角色管理/.test(a)||/角色管理/.test(e)}).first();if(a.length){const n=a.closest('nav, header, section, div');return n.length?n:a.parent()}return null}();if(!i)return console.warn('[CardHub] 未找到角色管理入口挂载点'),null;const o=e(()=>n.open('role')),c=$('<button>').attr('id',t).attr('type','button').addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button').attr('title','打开 CardHub 角色卡管理器').attr('aria-label','打开 CardHub 角色卡管理器').on('click pointerup touchend',n=>{n.preventDefault(),n.stopImmediatePropagation(),o()});i.append(c);const s=a(c[0],o);return()=>{c.off('click'),c.remove(),s()}}(n);r&&t.push(r);const i=function(n){const t=`cardhub-magic-${getScriptId()}`,r=$('#extensionsMenuButton');if(!r.length)return console.warn('[CardHub] 未找到左侧魔法棒入口'),null;const i=()=>{const r=$('#extensionsMenu');if(!r||r.find(`#${t}`).length)return;const i=e(()=>n.open('magic')),o=$('<div>').attr('id',t).addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry').attr('role','button').attr('tabindex','0').html('<i class="fa-solid fa-id-badge" aria-hidden="true"></i><span>角色卡管理器</span>').on('click pointerup touchend',n=>{n.preventDefault(),n.stopImmediatePropagation(),i()});r.append(o);const c=a(o[0],i);o.data('cardhub-dispose',c)};r.on('click.cardhub',()=>{setTimeout(i,0)});const o=new MutationObserver(()=>i()),c=window.parent?.document??document;return o.observe(c.body,{childList:!0,subtree:!0}),()=>{o.disconnect(),r.off('click.cardhub'),$(`#${t}`).remove()}}(n);return i&&t.push(i),()=>{t.forEach(n=>n())}}function a(n,a){const e=n=>{n.preventDefault(),n.stopImmediatePropagation(),a()};return n.addEventListener('pointerdown',e,{capture:!0}),n.addEventListener('mousedown',e,{capture:!0}),n.addEventListener('touchstart',e,{capture:!0}),()=>{n.removeEventListener('pointerdown',e,{capture:!0}),n.removeEventListener('mousedown',e,{capture:!0}),n.removeEventListener('touchstart',e,{capture:!0})}}function e(n){let a=0;return()=>{const e=Date.now();e-a<250||(a=e,n())}}var t=c(61),r=c(337);async function i(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}n??=SillyTavern;const a='function'==typeof n?.getContext?n.getContext():null;if('function'==typeof a?.getCharacters)try{await a.getCharacters()}catch(n){console.warn('[CardHub] 读取角色列表失败，将使用缓存数据',n)}const e=a?.characters??SillyTavern?.characters??[],t=new Map,r=new Map,i=new Map;return Array.isArray(a?.tags)&&a.tags.forEach(n=>{n?.id&&n?.name&&i.set(n.id,n.name)}),e.map((n,e)=>{const o=n.tags??n.data?.tags??[],c=n.avatar,s=n.name??'未命名角色',d=n.create_date??n.date_added??n.chat??String(e),l=c??`name:${s}::${d}`;let p=l;if(!c){const n=r.get(l)??0;r.set(l,n+1),n&&(p=`${l}::${n}`)}const u=(a?.tagMap?.[p]??[]).map(n=>i.get(n)).filter(Boolean),b=Array.from(new Set([...o,...u])),g=c?`avatar:${c}`:`name:${s}::${d}`,f=t.get(g)??0;t.set(g,f+1);return{id:f?`${g}::${f}`:g,name:s,avatar:n.avatar??null,tags:b,tagKey:p,origin:'tavern'}})}function o(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(n){const a=16*Math.random()|0;return('x'===n?a:3&a|8).toString(16)})}const s='cardhub_library';function d(){return{type:'script',script_id:getScriptId()}}function l(n){const a=TavernHelper.getVariables(d());TavernHelper.replaceVariables(d(),{...a,[s]:{entries:n}})}function p(n){return new Promise((a,e)=>{const t=new FileReader;t.onload=()=>a(String(t.result||'')),t.onerror=()=>e(t.error),t.readAsDataURL(n)})}function u(n){return new Promise((a,e)=>{const t=new FileReader;t.onload=()=>a(String(t.result||'')),t.onerror=()=>e(t.error),t.readAsText(n)})}function b(n){return n.replace(/\.(png|json)$/i,'')}function g(n){if(null===n||'object'!=typeof n)return JSON.stringify(n);if(Array.isArray(n))return`[${n.map(n=>g(n)).join(',')}]`;return`{${Object.entries(n).sort(([n],[a])=>n.localeCompare(a)).map(([n,a])=>`${JSON.stringify(n)}:${g(a)}`).join(',')}}`}function f(n,a){let e=a;if('json'===n){const n=a.trim();try{e=g(JSON.parse(n))}catch{e=n}}return`${n}:${function(n){let a=5381;for(let e=0;e<n.length;e+=1)a=33*a^n.charCodeAt(e);return(a>>>0).toString(16)}(e)}`}function m(){return function(){const n=TavernHelper.getVariables(d()),a=n?.[s];return a&&'object'==typeof a?{entries:Array.isArray(a.entries)?a.entries:[]}:{entries:[]}}().entries}async function A(n,a){const e=Array.from(n);if(!e.length)return m();const t=Array.isArray(a)&&a.length?a:m(),r=new Set;t.forEach(n=>{const a=function(n){if(n.fingerprint)return n.fingerprint;if(!n.rawType||!n.raw)return null;const a=f(n.rawType,n.raw);return n.fingerprint=a,a}(n);a&&r.add(a)});const i=[];for(const n of e){const a=b(n.name);if(n.name.toLowerCase().endsWith('.png')){const e=await p(n),t=f('png',e);if(r.has(t))continue;r.add(t),i.push({id:o(),name:a,avatar:e,tags:[],origin:'library',rawType:'png',raw:e,fingerprint:t})}else if(n.name.toLowerCase().endsWith('.json')){const e=await u(n);let t=a;try{const n=JSON.parse(e);t=n.name??n.data?.name??t}catch{}const c=f('json',e);if(r.has(c))continue;r.add(c),i.push({id:o(),name:t,avatar:null,tags:[],origin:'library',rawType:'json',raw:e,fingerprint:c})}}const c=[...t,...i];return l(c),c}function h(n){const a=m().filter(a=>a.id!==n);return l(a),a}const C=(0,t.reactive)({open:!1,loading:!1,search:'',lastOpenSource:'manual',characters:[],library:[]});function x(n,a){C.open=n,a&&(C.lastOpenSource=a)}function v(n){C.loading=n}function y(n){C.characters=n}function w(n){C.library=n}function B(){let n;try{n=window.parent?.SillyTavern}catch{n=void 0}return n??=SillyTavern,'function'!=typeof n?.getContext?null:n.getContext()}function k(n){Array.isArray(n.tags)||(n.tags=[]),n.tagMap||(n.tagMap={})}function E(n){if('library'===n.origin)return n.tags??[];const a=n.tags??[],e=function(n){if(!n)return[];const a=B();if(!a||!a.tagMap||!Array.isArray(a.tags))return[];const e=new Map;return a.tags.forEach(n=>{n?.id&&n?.name&&e.set(n.id,n.name)}),(a.tagMap[n]??[]).map(n=>e.get(n)).filter(Boolean)}(n.tagKey??n.avatar);return Array.from(new Set([...a,...e]))}function S(n,a){const e=B();if(!e)return a;const t=function(n,a){if(!Array.isArray(n.characters))return null;const e=a.avatar?n.characters.find(n=>n.avatar===a.avatar):null;return e||(n.characters.find(n=>n.name===a.name)??null)}(e,n);if(!t)return a;const r=Array.from(new Set(a.map(n=>n.trim().replace(/\s+/g,' ')).filter(Boolean)));t.tags=r,t.data&&(t.data.tags=r),k(e);const i=r.map(n=>function(n,a){k(n);const e=n.tags.find(n=>n.name===a);if(e)return e;const t={id:'function'==typeof crypto?.randomUUID?crypto.randomUUID():`tag-${Date.now()}`,name:a};return n.tags.push({id:t.id,name:t.name}),t}(e,n).id),o=n.tagKey??t.avatar??null;return o&&(e.tagMap[o]=i),e.saveSettingsDebounced?.(),r}const F={class:'cardhub-panel',role:'dialog','aria-label':'CardHub 角色卡管理器'},T={class:'cardhub-toolbar'},L={class:'cardhub-body'},D={class:'cardhub-sidebar'},N={class:'cardhub-chip-row'},M={class:'cardhub-tag-filter'},Y=['onClick'],j={class:'cardhub-content'},O={key:0,class:'cardhub-loading'},V={key:1,class:'cardhub-empty'},I={key:2,class:'cardhub-grid-wrap'},P={class:'cardhub-pagination'},H={key:0,class:'cardhub-pagination__actions'},U=['disabled'],R=['disabled'],q={class:'cardhub-pagination__status'},W={class:'cardhub-grid'},Q=['onClick'],Z={class:'cardhub-card__info'},K={class:'cardhub-card__name'},X={class:'cardhub-card__meta'},J={class:'cardhub-card__tags'},G=['onClick'],nn=['onClick'],an=['onKeydown','onBlur'],en={class:'cardhub-card__actions'},tn=['onClick'],rn=['onClick'],on={class:'cardhub-manage__panel',role:'dialog','aria-label':'角色管理'},cn={class:'cardhub-manage__top'},sn={class:'cardhub-manage__summary'},dn={class:'cardhub-preview__name'},ln={class:'cardhub-preview__meta'},pn={class:'cardhub-preview__tags'},un={class:'cardhub-manage__overview'},bn={class:'cardhub-manage__overview-label'},gn={class:'cardhub-manage__overview-value'},fn={key:0,class:'cardhub-manage__overview-hint'},mn={class:'cardhub-manage__media'},An=['src'],hn={class:'cardhub-manage__section'},Cn={key:0,class:'cardhub-manage__details'},xn={class:'cardhub-manage__detail-label'},vn={class:'cardhub-manage__detail-content'},yn={key:1,class:'cardhub-manage__empty'},_n={class:'cardhub-manage__section'},wn={class:'cardhub-manage__content'},Bn={class:'cardhub-manage__section'},kn={class:'cardhub-manage__label'},En={class:'cardhub-manage__jump-row'},Sn={key:0,class:'cardhub-manage__chat'},zn=['onClick','onKeydown'],Fn={class:'cardhub-manage__chat-main'},Tn={class:'cardhub-manage__chat-name'},Ln={key:0,class:'cardhub-manage__chat-label'},Dn={key:1,class:'cardhub-manage__chat-tags'},Nn={class:'cardhub-manage__chat-text'},Mn={key:1,class:'cardhub-manage__empty'},Yn={class:'cardhub-manage__actions'},jn={class:'cardhub-confirm__panel',role:'dialog','aria-modal':'true'},On={class:'cardhub-confirm__title'},Vn={class:'cardhub-confirm__message'},In={class:'cardhub-confirm__actions'},Pn=(0,t.defineComponent)({__name:'App',setup(n){const a=(0,t.ref)([]),e=(0,t.ref)(null),r=(0,t.ref)(''),o=(0,t.ref)('all'),c=(0,t.ref)(24),s=(0,t.ref)(1),d=(0,t.ref)(null),p=(0,t.ref)(null),u=(0,t.ref)([]),b=(0,t.ref)([]),g=(0,t.computed)(()=>{return n=u.value,a=3,n.map(n=>function(n,a){const e=n.replace(/\r/g,'').trim();if(!e)return[];const t=ja(e);if(t.length>=a)return t.slice(0,a);const r=Ta(e);if(!r)return t.slice(0,a);const i=Oa(r,60);if(!t.length)return i.slice(0,a);const o=[...t];for(const n of i){if(o.length>=a)break;o[0]!==n&&o.push(n)}return o.slice(0,a)}(n,2).join('\n')).filter(n=>n.trim().length>0).slice(0,a);var n,a});let f=0;const B=(0,t.reactive)({open:!1,title:'',message:'',confirmLabel:'确定',cancelLabel:'取消',altLabel:'',resolve:null}),k=(0,t.computed)(()=>[...C.characters,...C.library]),Pn=(0,t.ref)(null),Hn=(0,t.ref)(null),$n=(0,t.ref)(null),Un=(0,t.computed)(()=>{const n=Pn.value;if(!n)return[];const a=[],e=(n,e,t=240)=>{const r=function(n,a,e){const t=n.replace(/\r/g,'').trim();if(!t)return'';const r=ja(t),i=r.length?r:Oa(Ta(t),60);let o=i.slice(0,a).join('\n').trim();if(!o)return'';const c=o.length>e;c&&(o=o.slice(0,e).trim());const s=c||i.length>a||t.length>o.length;s&&!o.endsWith('…')&&(o=`${o}…`);return o}(e,3,t);r&&a.push({label:n,value:r})};return e('角色描述',n.description??''),e('性格',n.personality??''),e('场景',n.scenario??''),e('创作者备注',n.creatorNotes??''),e('系统提示',n.systemPrompt??'',200),e('历史指令',n.postHistory??'',200),e('作者',n.creator??'',80),a}),Rn=(0,t.computed)(()=>!p.value||Un.value.length?'':'library'===p.value.origin?'未导入卡片暂无可预览内容，可先导入后查看详情。':'暂无角色卡详情。'),qn=(0,t.computed)(()=>'library'===p.value?.origin?'未导入卡片暂无聊天记录。':'暂无聊天记录。'),Wn=(0,t.computed)(()=>{const n=[],a=Pn.value,e=a?.worldBookName?.trim()||'',t=a?.worldBookCount;let r='未绑定',i='';(e||'number'==typeof t)&&(r=e||'角色世界书',i='number'==typeof t?`${t} 条`:''),n.push({label:'世界书',value:r,hint:i});const o=$n.value;let c='暂无聊天',s='';o&&o.total>0&&(c=`${o.total} 个聊天`,o.latest&&(s=`最近：${o.latest}`)),n.push({label:'聊天概况',value:c,hint:s});const d=Hn.value;let l='暂无开场白',p='';return d&&d.total>0&&(l=`${d.total} 条`,p=d.alternate>0?`替代：${d.alternate} 条`:'无替代'),n.push({label:'开场白',value:l,hint:p}),n}),Qn=(0,t.computed)(()=>{const n=function(n){if('imported'===o.value)return n.filter(n=>'tavern'===n.origin);if('unimported'===o.value)return n.filter(n=>'library'===n.origin);return n}(k.value),a=C.search.trim();if(!a)return ea(n);const e=function(n){if(!n)return null;try{const a=n.match(/\/(.+)\/([a-z]*)/i);if(!a)return new RegExp(_.escapeRegExp(n),'i');if(a[2]&&!/^(?!.*?(.).*?\1)[gmixXsuUAJ]+$/.test(a[3]))return new RegExp(n,'i');let e=a[2]??'';return _.pull(e,'g'),-1===e.indexOf('i')&&(e+='i'),new RegExp(a[1],e)}catch{return null}}(a)??new RegExp(_.escapeRegExp(a),'i');return ea(n).filter(n=>e.test(n.name)||n.tags.some(n=>e.test(n)))}),Zn=(0,t.computed)(()=>{const n=Math.ceil(Qn.value.length/c.value);return n>0?n:1}),Kn=(0,t.computed)(()=>{const n=(s.value-1)*c.value;return Qn.value.slice(n,n+c.value)}),Xn=(0,t.computed)(()=>{const n=new Set;return k.value.forEach(a=>{E(a).forEach(a=>n.add(a))}),a.value.forEach(a=>n.add(a)),Array.from(n).sort((n,a)=>n.localeCompare(a,'zh-CN'))});function Jn(n,a=!1){const e=n.avatar;return e?/^(data:|https?:|\/)/.test(e)?e:a&&'tavern'===n.origin?TavernHelper.getCharAvatarPath(e,!0)??`/thumbnail?type=avatar&file=${encodeURIComponent(e)}`:`/thumbnail?type=avatar&file=${encodeURIComponent(e)}`:null}function Gn(n){const a=Jn(n);return a?{backgroundImage:`url(${a})`}:{}}function na(n){return E(n)}const aa=(0,t.computed)(()=>p.value?Jn(p.value,!0):null);function ea(n){return a.value.length?n.filter(n=>a.value.some(a=>E(n).includes(a))):n}function ta(){a.value=[]}function ra(){s.value>1&&(s.value-=1)}function ia(){s.value<Zn.value&&(s.value+=1)}function oa(n){return n.trim().toLocaleLowerCase()}function ca(n){return B.open&&B.resolve&&B.resolve('cancel'),B.title=n.title??'确认操作',B.message=n.message,B.confirmLabel=n.confirmLabel??'确定',B.cancelLabel=n.cancelLabel??'取消',B.altLabel=n.altLabel??'',B.open=!0,new Promise(n=>{B.resolve=n})}function sa(n){if(!B.open)return;B.open=!1;const a=B.resolve;B.resolve=null,a&&a(n)}function da(n){return n.id}function la(n){if(e.value!==da(n))return;const a=r.value.trim();if(a){ua(n,[...E(n),a])}pa()}function pa(){e.value=null,r.value=''}function ua(n,a){if('library'===n.origin){w(function(n,a){const e=m().map(e=>e.id!==n?e:{...e,tags:a});return l(e),e}(n.id,a))}else{const e=S(n,a);n.tags=e,y([...C.characters])}}function ba(){d.value?.click()}async function ga(n){const a=n.target,e=a?.files;if(!e||!e.length)return;w(await A(e,C.library)),a.value=''}async function fa(){const n=Qn.value;if(!n.length)return void toastr.warning('当前没有可导出的角色卡');const e=a.value.length?a.value.join('、'):'无',t='all'===o.value?'全部':'imported'===o.value?'已导入':'未导入',r=C.search.trim()||'无',i=`将导出 ${n.length} 张角色卡。\n筛选状态：${t}\n筛选标签：${e}\n搜索关键字：${r}\n是否继续？`;'confirm'===await ca({title:'批量导出',message:i,confirmLabel:'继续导出',cancelLabel:'取消'})&&n.forEach(n=>Aa(n))}async function ma(n){'library'===n.origin?await async function(n){if(!n.raw||!n.rawType)return void toastr.error('缺少导入数据');const a=function(n){const a=oa(n);return a?C.characters.find(n=>oa(n.name)===a)??null:null}(n.name);if(a)return void toastr.warning(`已存在同名角色「${a.name}」，已跳过导入`);const e=SillyTavern?.getRequestHeaders?SillyTavern.getRequestHeaders():{};if(delete e['Content-Type'],'png'===n.rawType){const a=await Ka(n.raw);await TavernHelper.importRawCharacter(n.name,a)}else{const a=new File([n.raw],`${n.name}.json`,{type:'application/json'}),t=new FormData;t.append('avatar',a),t.append('file_type','json'),t.append('preserved_name',a.name),await fetch('/api/characters/import',{method:'POST',headers:e,body:t,cache:'no-cache'})}w(h(n.id));y(await i()),toastr.success(`已导入 ${n.name}`)}(n):Aa(n)}async function Aa(n){if('library'===n.origin)return void await async function(n){if(!n.raw||!n.rawType)return void toastr.error('无法导出：缺少原始数据');if('png'===n.rawType){return void Za(await Ka(n.raw),`${n.name}.png`)}const a=new Blob([n.raw],{type:'application/json'});Za(a,`${n.name}.json`)}(n);if(!n.avatar)return void toastr.error('无法导出：缺少头像信息');const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const e=await fetch(a,{cache:'no-cache'});Za(await e.blob(),`${n.name}.png`)}async function ha(n){const a=++f;p.value=n,u.value=[],b.value=[],Pn.value=null,Hn.value=null,$n.value=null;const[e,t]=await Promise.allSettled([xa(n),Va(n)]);if(a!==f||p.value?.id!==n.id)return;const r='fulfilled'===e.status?e.value:{openings:[],profile:null,openingSummary:null};u.value=r.openings,Pn.value=r.profile,Hn.value=r.openingSummary;const i='fulfilled'===t.status?t.value:{list:[],summary:null};b.value=i.list,$n.value=i.summary}function Ca(){p.value=null,u.value=[],b.value=[],Pn.value=null,Hn.value=null,$n.value=null}async function xa(n){if('tavern'!==n.origin){const a=function(n){if(!n.raw||!n.rawType)return null;if('json'===n.rawType)return va(n.raw);if('png'===n.rawType)return function(n){const a=function(n){const a=n.indexOf(',');if(a<0)return null;const e=n.slice(a+1);try{const n=atob(e),a=new Uint8Array(n.length);for(let e=0;e<n.length;e+=1)a[e]=n.charCodeAt(e);return a}catch{return null}}(n);if(!a)return null;const e=function(n){if(n.length<8)return[];const a=[137,80,78,71,13,10,26,10];for(let e=0;e<a.length;e+=1)if(n[e]!==a[e])return[];const e=[];let t=8;for(;t+8<=n.length;){const a=Ba(n,t),r=ka(n.subarray(t+4,t+8)),i=t+8,o=i+a;if(o+4>n.length)break;const c=n.subarray(i,o);if('tEXt'===r){const n=ya(c);n&&e.push(n)}else if('iTXt'===r){const n=_a(c);n&&e.push(n)}t=o+4}return e}(a),t=new Set(['chara','character','tavern','tavern_character','card']);for(const n of e){if(n.key&&!t.has(n.key.toLowerCase()))continue;const a=wa(n.value);if(a)return a}return null}(n.raw);return null}(n);return{openings:Fa(a),profile:Ea(a),openingSummary:za(a)}}const a=await async function(n){let a;try{a=window.parent?.SillyTavern}catch{a=void 0}a??=SillyTavern;const e='function'==typeof a?.getContext?a.getContext():null;if(e?.getCharacters)try{await e.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色卡列表失败',n)}const t=e?.characters??a?.characters??[];if(!t.length)return null;const r=n.avatar?t.findIndex(a=>a.avatar===n.avatar||a.name===n.avatar):-1,i=t.findIndex(a=>a.name===n.name),o=r>=0?r:i;if(o<0)return null;if(e?.unshallowCharacter)try{await e.unshallowCharacter(o)}catch(n){console.warn('[CardHub] 读取角色卡详情失败',n)}const c=(e?.characters??t)[o]??null;if(c?.first_mes||c?.data?.first_mes)return c;if(e?.getCharacterCardFields)try{const n=await e.getCharacterCardFields({chid:o});if(n?.first_mes||n?.data?.first_mes)return n}catch(n){console.warn('[CardHub] 读取角色卡字段失败',n)}const s=TavernHelper.getCharData(n.avatar??n.name,!0);return s??c}(n),e=a??TavernHelper.RawCharacter?.find({name:n.avatar??n.name,allowAvatar:!0})??TavernHelper.RawCharacter?.find({name:n.name,allowAvatar:!0}),t=a??e;let r=Fa(t);!r.length&&e&&e!==t&&(r=Fa(e));const i=za(t??e);return{openings:r,profile:Ea(t??e),openingSummary:i}}function va(n){try{return JSON.parse(n)}catch{return null}}function ya(n){const a=n.indexOf(0);if(a<0)return null;const e=ka(n.subarray(0,a)).trim(),t=ka(n.subarray(a+1)).trim();return e&&t?{key:e,value:t}:null}function _a(n){const a=n.indexOf(0);if(a<0||a+2>=n.length)return null;const e=ka(n.subarray(0,a)).trim(),t=1===n[a+1];let r=a+2;const i=n.indexOf(0,r);if(i<0)return null;r=i+1;const o=n.indexOf(0,r);if(o<0)return null;if(r=o+1,t)return null;const c=ka(n.subarray(r)).trim();return e&&c?{key:e,value:c}:null}function wa(n){const a=n.trim();if(!a)return null;const e=va(a);if(e)return e;if(!function(n){if(n.length<16||n.length%4!=0)return!1;return/^[A-Za-z0-9+/=]+$/.test(n)}(a))return null;const t=function(n){try{const a=atob(n),e=new Uint8Array(a.length);for(let n=0;n<a.length;n+=1)e[n]=a.charCodeAt(n);return(new TextDecoder).decode(e)}catch{return null}}(a);return t?va(t):null}function Ba(n,a){return(n[a]<<24|n[a+1]<<16|n[a+2]<<8|n[a+3])>>>0}function ka(n){return(new TextDecoder).decode(n)}function Ea(n){if(!n)return null;const a={description:Sa(n?.description,n?.data?.description),personality:Sa(n?.personality,n?.data?.personality),scenario:Sa(n?.scenario,n?.data?.scenario),creatorNotes:Sa(n?.creatorcomment,n?.data?.creatorcomment,n?.creator_notes,n?.data?.creator_notes),systemPrompt:Sa(n?.system_prompt,n?.data?.system_prompt),postHistory:Sa(n?.post_history_instructions,n?.data?.post_history_instructions),creator:Sa(n?.creator,n?.data?.creator)},e=n?.character_book??n?.data?.character_book;e&&(a.worldBookName=Sa(e?.name),a.worldBookCount=Array.isArray(e?.entries)?e.entries.length:void 0);return Boolean(a.description)||Boolean(a.personality)||Boolean(a.scenario)||Boolean(a.creatorNotes)||Boolean(a.systemPrompt)||Boolean(a.postHistory)||Boolean(a.creator)||Boolean(a.worldBookName)||'number'==typeof a.worldBookCount?a:null}function Sa(...n){for(const a of n)if('string'==typeof a){const n=a.trim();if(n)return n}return''}function za(n){if(!n)return null;const a='string'==typeof n?.first_mes?n.first_mes:n?.data?.first_mes,e='string'==typeof a&&a.trim()?1:0,t=n?.alternate_greetings??n?.data?.alternate_greetings??n?.extensions?.alternate_greetings??n?.data?.extensions?.alternate_greetings;let r=0;return Array.isArray(t)?r=t.filter(n=>'string'==typeof n&&n.trim()).length:'string'==typeof t&&t.trim()&&(r=1),{total:e+r,alternate:r}}function Fa(n){if(!n)return[];const a=[],e='string'==typeof n?.first_mes?n.first_mes:n?.data?.first_mes;'string'==typeof e&&e.trim()&&a.push(e.trim());const t=n?.alternate_greetings??n?.data?.alternate_greetings??n?.extensions?.alternate_greetings??n?.data?.extensions?.alternate_greetings;return Array.isArray(t)?t.forEach(n=>{'string'==typeof n&&n.trim()&&a.push(n.trim())}):'string'==typeof t&&t.trim()&&a.push(t.trim()),a}function Ta(n){return n.replace(/<br\s*\/?>/gi,' ').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim()}function La(n){if('number'==typeof n&&!Number.isNaN(n)){return new Date(n<1e12?1e3*n:n).toLocaleString('zh-CN',{hour12:!1})}if('string'==typeof n){const a=n.trim();if(a)return a}return''}function Da(n){const a=[n?.last_message_time,n?.last_message_date,n?.update_time,n?.last_modified,n?.create_date,n?.timestamp,n?.time];for(const n of a){const a=La(n);if(a)return a}const e=Sa(n?.file_name,n?.file_id);return e?e.replace(/\.jsonl$/i,''):''}function Na(n){return Da(n)||'聊天记录'}function Ma(n){const a=Sa(n?.file_name,n?.file_id);return a?a.replace(/\.jsonl$/i,''):''}function Ya(n,a=3){const e=Ta(n);if(!e)return[];const t=new Set,r=new Set(['the','and','you','your','are','this','that','with','have','not','for','from','what','why','when','where','then','into','out','here','there','这个','那个','我们','你们','他们','她们','因为','但是','然后','如果','可以','没有','不是','已经','现在','一个','一些','还有','所以','这种']),i=e.match(/\[[^\]]{2,16}\]/g)??[];for(const n of i){const e=n.slice(1,-1).trim();if(e&&t.add(e),t.size>=a)return Array.from(t).slice(0,a)}const o=e.match(/[\u4e00-\u9fa5]{2,}|[A-Za-z0-9]{3,}/g)??[];for(const n of o){const e=n.toLowerCase();if(!r.has(n)&&!r.has(e)&&(t.add(n),t.size>=a))break}return Array.from(t).slice(0,a)}function ja(n){const a=n.split('\n').map(n=>n.trim()).filter(n=>n.length>0),e=[];for(const n of a)n.startsWith('```')||/^<\/?(html|head|body|meta|title|script|style|!doctype)\b/i.test(n)||e.push(n);return e}function Oa(n,a){const e=[];for(let t=0;t<n.length;t+=a){const r=n.slice(t,t+a).trim();r&&e.push(r)}return e}async function Va(n){if('tavern'!==n.origin)return{list:[],summary:null};const a=await TavernHelper.getChatHistoryBrief(n.avatar??n.name,!0);if(!Array.isArray(a)||!a.length)return{list:[],summary:{total:0,latest:''}};const e=a.slice(0,3).map(n=>({name:Na(n),label:Ma(n),file:String(n?.file_name??n?.file_id??''),mes:Ta(String(n?.mes??'')).slice(0,120),keywords:Ya(String(n?.mes??''))})),t=Da(a[0]);return{list:e,summary:{total:a.length,latest:t}}}async function Ia(){b.value.length?await Ha(b.value[0]):toastr.warning('暂无聊天记录')}async function Pa(){if(await $a({ensureSelected:!0}))try{await triggerSlash('/newchat'),Ca(),Ja()}catch(n){console.warn('[CardHub] 新聊天失败',n),toastr.error('无法创建新聊天')}}async function Ha(n){const a=n.file;if(!a)return void toastr.warning('未找到聊天文件');const e=await $a({ensureSelected:!0});if(!e)return;const{ctx:t,st:r}=e,i=qa(a),o=(t&&'function'==typeof t.openCharacterChat?t.openCharacterChat:null)??(r&&'function'==typeof r.openCharacterChat?r.openCharacterChat:null);if(!o)return void toastr.error('无法打开聊天：缺少接口');try{Promise.resolve(o(i)).catch(n=>{console.warn('[CardHub] 打开聊天失败',n)})}catch(n){console.warn('[CardHub] 打开聊天失败',n)}const c=await async function(n,a,e,t){const r=qa(n),i=Date.now();for(;Date.now()-i<t;){if((a?.chatId??e?.chatId)===r)return!0;await new Promise(n=>setTimeout(n,200))}return!1}(i,t,r,6e3);if(c)return Ca(),void Ja();toastr.warning('未能打开聊天，可能需要先手动切到该角色')}async function $a(n={}){let a;try{a=window.parent?.SillyTavern}catch{a=void 0}a??=SillyTavern;const e='function'==typeof a?.getContext?a.getContext():null;if('function'==typeof e?.getCharacters)try{await e.getCharacters()}catch(n){console.warn('[CardHub] 刷新角色列表失败',n)}const t=e?.characters??a?.characters??[],r=p.value&&Array.isArray(t)?function(n,a){if(a.avatar){const e=n.findIndex(n=>n.avatar===a.avatar||n.name===a.avatar);if(e>=0)return e}return n.findIndex(n=>n.name===a.name)}(t,p.value):-1;if(r<0)return toastr.warning('未找到角色索引，请先手动切到该角色后再试'),null;const i=(e&&'function'==typeof e.selectCharacterById?e.selectCharacterById:null)??(a&&'function'==typeof a.selectCharacterById?a.selectCharacterById:null);if(!i)return toastr.warning('无法切换角色，请先手动切到该角色后再试'),null;try{await i(r,{switchMenu:!1})}catch(n){console.warn('[CardHub] 切换角色失败',n)}const o=await async function(n,a,e,t){const r=String(n),i=Date.now();for(;Date.now()-i<t;){if(Ua(a,e)===r)return!0;await Ra(80)}return!1}(r,e,a,3e3);return n.ensureSelected&&!o?(toastr.warning('角色切换未完成，请稍后再试'),null):{ctx:e,st:a,idx:r}}function Ua(n,a){const e=n?.characterId??a?.characterId??'';return null==e?'':String(e)}function Ra(n){return new Promise(a=>setTimeout(a,n))}function qa(n){return n.endsWith('.jsonl')?n:`${n}.jsonl`}async function Wa(n){if('library'===n.origin){if('confirm'!==await ca({title:'删除角色',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'删除',cancelLabel:'取消'}))return;return w(h(n.id)),void Ca()}if('confirm'!==await ca({title:'删除角色',message:`确定要删除「${n.name}」吗？`,confirmLabel:'继续',cancelLabel:'取消'}))return;const a=await ca({title:'删除方式',message:`删除「${n.name}」：\n- 移到私有库：可在私有库中找回\n- 永久删除：不可恢复`,confirmLabel:'移到私有库',altLabel:'永久删除',cancelLabel:'取消'});if('cancel'===a)return;if('confirm'===a){await async function(n){if(!n.avatar)return;const a=TavernHelper.getCharAvatarPath(n.avatar);if(!a)return void toastr.error('无法导出：缺少头像信息');const e=await fetch(a,{cache:'no-cache'}),t=await e.blob(),r=await A([new File([t],`${n.name}.png`,{type:'image/png'})]);w(r)}(n);if(!await Qa(n,!1))return;Ca();return void y(await i())}if('confirm'!==await ca({title:'永久删除',message:`确认永久删除「${n.name}」？此操作不可恢复。`,confirmLabel:'永久删除',cancelLabel:'取消'}))return;if(!await Qa(n,!0))return;Ca();y(await i())}async function Qa(n,a){if(!n.avatar)return toastr.error('删除失败：缺少头像信息'),!1;let e;try{e=window.parent?.SillyTavern}catch{e=void 0}e??=SillyTavern;const t='function'==typeof e?.getContext?e.getContext():null,r=t?.getRequestHeaders?t.getRequestHeaders():e?.getRequestHeaders?.();if(!r||!Object.keys(r).length)return toastr.error('删除失败：无法获取请求头'),!1;const i={avatar_url:n.avatar,delete_chats:a},o=await fetch('/api/characters/delete',{method:'POST',headers:{...r,'Content-Type':'application/json'},body:JSON.stringify(i),cache:'no-cache'});if(o.ok)return!0;const c=await o.text();return toastr.error(`删除失败：${o.status} ${c||o.statusText}`),!1}function Za(n,a){const e=URL.createObjectURL(n),t=document.createElement('a');t.href=e,t.download=a,document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(e)}async function Ka(n){const a=await fetch(n);return await a.blob()}async function Xa(){v(!0);try{y(await i()),w(m())}finally{v(!1)}}function Ja(){x(!1)}return(0,t.watch)([()=>C.search,o,()=>a.value.join('|')],()=>{s.value=1}),(0,t.watch)([Qn,Zn],()=>{s.value>Zn.value&&(s.value=Zn.value),s.value<1&&(s.value=1)}),(n,i)=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{class:(0,t.normalizeClass)(['cardhub-root',{open:(0,t.unref)(C).open}])},[(0,t.createElementVNode)('div',{class:'cardhub-backdrop',onClick:Ja}),(0,t.createElementVNode)('section',F,[(0,t.createElementVNode)('header',{class:'cardhub-header'},[i[33]||(i[33]=(0,t.createElementVNode)('div',{class:'cardhub-title'},[(0,t.createElementVNode)('span',{class:'cardhub-title__main'},'CardHub'),(0,t.createElementVNode)('span',{class:'cardhub-title__sub'},'角色卡管理器')],-1)),(0,t.createElementVNode)('div',{class:'cardhub-actions'},[(0,t.createElementVNode)('button',{class:'cardhub-close',type:'button','aria-label':'关闭',onClick:Ja},[...i[32]||(i[32]=[(0,t.createElementVNode)('span',{'aria-hidden':'true'},'×',-1)])])])]),(0,t.createElementVNode)('div',T,[(0,t.withDirectives)((0,t.createElementVNode)('input',{'onUpdate:modelValue':i[0]||(i[0]=n=>(0,t.unref)(C).search=n),class:'cardhub-search',type:'search',placeholder:'搜索角色名或标签'},null,512),[[t.vModelText,(0,t.unref)(C).search]]),(0,t.createElementVNode)('button',{class:'cardhub-button',type:'button',onClick:Xa},'刷新'),(0,t.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:ba},'导入'),(0,t.createElementVNode)('button',{class:'cardhub-button is-ghost',type:'button',onClick:fa},'批量导出'),(0,t.createElementVNode)('input',{ref_key:'importInput',ref:d,class:'cardhub-import-input',type:'file',accept:'.png,.json',multiple:'',onChange:ga},null,544)]),(0,t.createElementVNode)('div',L,[(0,t.createElementVNode)('div',D,[i[34]||(i[34]=(0,t.createElementVNode)('div',{class:'cardhub-section-title'},'分类',-1)),(0,t.createElementVNode)('div',N,[(0,t.createElementVNode)('button',{class:(0,t.normalizeClass)(['cardhub-chip',{'is-active':'all'===o.value}]),type:'button',onClick:i[1]||(i[1]=n=>o.value='all')},' 全部 ',2),(0,t.createElementVNode)('button',{class:(0,t.normalizeClass)(['cardhub-chip',{'is-active':'imported'===o.value}]),type:'button',onClick:i[2]||(i[2]=n=>o.value='imported')},' 已导入 ',2),(0,t.createElementVNode)('button',{class:(0,t.normalizeClass)(['cardhub-chip',{'is-active':'unimported'===o.value}]),type:'button',onClick:i[3]||(i[3]=n=>o.value='unimported')},' 未导入 ',2)]),i[35]||(i[35]=(0,t.createElementVNode)('div',{class:'cardhub-divider'},null,-1)),i[36]||(i[36]=(0,t.createElementVNode)('div',{class:'cardhub-section-title'},'标签',-1)),(0,t.createElementVNode)('div',M,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Xn.value,n=>((0,t.openBlock)(),(0,t.createElementBlock)('button',{key:n,class:(0,t.normalizeClass)(['cardhub-tag-filter__chip',{'is-active':a.value.includes(n)}]),type:'button',onClick:e=>function(n){a.value.includes(n)?a.value=a.value.filter(a=>a!==n):a.value=[...a.value,n]}(n)},(0,t.toDisplayString)(n),11,Y))),128))]),a.value.length?((0,t.openBlock)(),(0,t.createElementBlock)('button',{key:0,class:'cardhub-chip cardhub-chip--clear',type:'button',onClick:ta},' 清空标签 ')):(0,t.createCommentVNode)('v-if',!0)]),(0,t.createElementVNode)('div',j,[(0,t.unref)(C).loading?((0,t.openBlock)(),(0,t.createElementBlock)('div',O,'正在读取角色卡...')):Qn.value.length?((0,t.openBlock)(),(0,t.createElementBlock)('div',I,[(0,t.createElementVNode)('div',P,[Zn.value>1?((0,t.openBlock)(),(0,t.createElementBlock)('div',H,[(0,t.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:s.value<=1,onClick:ra},' 上一页 ',8,U),(0,t.createElementVNode)('button',{class:'cardhub-pagination__button',type:'button',disabled:s.value>=Zn.value,onClick:ia},' 下一页 ',8,R)])):(0,t.createCommentVNode)('v-if',!0),(0,t.createElementVNode)('span',q,'第 '+(0,t.toDisplayString)(s.value)+' / '+(0,t.toDisplayString)(Zn.value)+' 页',1)]),(0,t.createElementVNode)('div',W,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Kn.value,n=>((0,t.openBlock)(),(0,t.createElementBlock)('article',{key:n.id,class:'cardhub-card',onClick:a=>ha(n)},[(0,t.createElementVNode)('div',{class:(0,t.normalizeClass)(['cardhub-card__avatar',{'has-avatar':Boolean(Jn(n))}]),style:(0,t.normalizeStyle)(Gn(n))},[(0,t.createElementVNode)('span',null,(0,t.toDisplayString)(n.name.slice(0,1)||'?'),1)],6),(0,t.createElementVNode)('div',Z,[(0,t.createElementVNode)('div',K,(0,t.toDisplayString)(n.name),1),(0,t.createElementVNode)('div',X,[(0,t.createElementVNode)('span',null,(0,t.toDisplayString)('tavern'===n.origin?'已导入':'未导入'),1),(0,t.createElementVNode)('span',null,(0,t.toDisplayString)(na(n).length)+' 标签',1)]),(0,t.createElementVNode)('div',J,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(na(n),a=>((0,t.openBlock)(),(0,t.createElementBlock)('button',{key:a,class:'cardhub-tag',type:'button',title:'点击移除标签',onClick:(0,t.withModifiers)(e=>function(n,a){ua(n,E(n).filter(n=>n!==a))}(n,a),['stop'])},[(0,t.createTextVNode)((0,t.toDisplayString)(a)+' ',1),i[37]||(i[37]=(0,t.createElementVNode)('span',{class:'cardhub-tag__remove'},'×',-1))],8,G))),128)),e.value!==da(n)?((0,t.openBlock)(),(0,t.createElementBlock)('button',{key:0,class:'cardhub-tag is-add',type:'button',onClick:(0,t.withModifiers)(a=>function(n){e.value=da(n),r.value='',(0,t.nextTick)(()=>{const n=document.querySelector('.cardhub-tag-input');n?.focus()})}(n),['stop'])},' + 标签 ',8,nn)):(0,t.withDirectives)(((0,t.openBlock)(),(0,t.createElementBlock)('input',{key:1,'onUpdate:modelValue':i[4]||(i[4]=n=>r.value=n),class:'cardhub-tag-input',type:'text',placeholder:'新标签',onKeydown:[(0,t.withKeys)((0,t.withModifiers)(a=>la(n),['prevent']),['enter']),(0,t.withKeys)((0,t.withModifiers)(pa,['prevent']),['esc'])],onBlur:a=>la(n),onClick:i[5]||(i[5]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[6]||(i[6]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[7]||(i[7]=(0,t.withModifiers)(()=>{},['stop']))},null,40,an)),[[t.vModelText,r.value]])])]),(0,t.createElementVNode)('div',en,[(0,t.createElementVNode)('button',{class:'cardhub-card__action is-secondary',type:'button',onClick:(0,t.withModifiers)(a=>ma(n),['stop']),onPointerdown:i[8]||(i[8]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[9]||(i[9]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[10]||(i[10]=(0,t.withModifiers)(()=>{},['stop']))},(0,t.toDisplayString)('tavern'===n.origin?'导出':'导入'),41,tn),(0,t.createElementVNode)('button',{class:'cardhub-card__action',type:'button',onClick:(0,t.withModifiers)(a=>ha(n),['stop']),onPointerdown:i[11]||(i[11]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[12]||(i[12]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[13]||(i[13]=(0,t.withModifiers)(()=>{},['stop']))},' 管理 ',40,rn)])],8,Q))),128))])])):((0,t.openBlock)(),(0,t.createElementBlock)('div',V,' 暂无角色卡，或没有匹配的搜索结果。 '))])])]),p.value?((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:0,class:'cardhub-manage',onClick:(0,t.withModifiers)(Ca,['self'])},[(0,t.createElementVNode)('div',on,[(0,t.createElementVNode)('button',{class:'cardhub-preview__close',type:'button',onClick:Ca},'×'),(0,t.createElementVNode)('div',cn,[(0,t.createElementVNode)('div',sn,[(0,t.createElementVNode)('div',dn,(0,t.toDisplayString)(p.value.name),1),(0,t.createElementVNode)('div',ln,[(0,t.createElementVNode)('span',null,(0,t.toDisplayString)('tavern'===p.value.origin?'已导入':'未导入'),1),(0,t.createElementVNode)('span',null,(0,t.toDisplayString)(na(p.value).length)+' 标签',1)]),(0,t.createElementVNode)('div',pn,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(na(p.value),n=>((0,t.openBlock)(),(0,t.createElementBlock)('span',{key:n,class:'cardhub-preview__tag'},(0,t.toDisplayString)(n),1))),128))]),(0,t.createElementVNode)('div',un,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Wn.value,n=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:n.label,class:'cardhub-manage__overview-card'},[(0,t.createElementVNode)('div',bn,(0,t.toDisplayString)(n.label),1),(0,t.createElementVNode)('div',gn,(0,t.toDisplayString)(n.value),1),n.hint?((0,t.openBlock)(),(0,t.createElementBlock)('div',fn,(0,t.toDisplayString)(n.hint),1)):(0,t.createCommentVNode)('v-if',!0)]))),128))])]),(0,t.createElementVNode)('div',mn,[aa.value?((0,t.openBlock)(),(0,t.createElementBlock)('img',{key:0,src:aa.value,alt:''},null,8,An)):(0,t.createCommentVNode)('v-if',!0)])]),(0,t.createElementVNode)('div',hn,[i[38]||(i[38]=(0,t.createElementVNode)('div',{class:'cardhub-manage__label'},'角色卡预览',-1)),Un.value.length?((0,t.openBlock)(),(0,t.createElementBlock)('div',Cn,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(Un.value,n=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:n.label,class:'cardhub-manage__detail'},[(0,t.createElementVNode)('div',xn,(0,t.toDisplayString)(n.label),1),(0,t.createElementVNode)('div',vn,(0,t.toDisplayString)(n.value),1)]))),128))])):((0,t.openBlock)(),(0,t.createElementBlock)('div',yn,(0,t.toDisplayString)(Rn.value),1))]),(0,t.createElementVNode)('div',_n,[i[39]||(i[39]=(0,t.createElementVNode)('div',{class:'cardhub-manage__label'},'开场白',-1)),(0,t.createElementVNode)('div',wn,[g.value.length?((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,{key:0},(0,t.renderList)(g.value,(n,a)=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:a,class:'cardhub-manage__opening'},(0,t.toDisplayString)(n),1))),128)):((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:1},[(0,t.createTextVNode)('暂无开场白')],64))])]),(0,t.createElementVNode)('div',Bn,[(0,t.createElementVNode)('div',kn,[i[40]||(i[40]=(0,t.createElementVNode)('span',null,'最近聊天',-1)),(0,t.createElementVNode)('div',En,[(0,t.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:Ia,onPointerdown:i[14]||(i[14]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[15]||(i[15]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[16]||(i[16]=(0,t.withModifiers)(()=>{},['stop']))},' 进入最近聊天 ',32),(0,t.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:Pa,onPointerdown:i[17]||(i[17]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[18]||(i[18]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[19]||(i[19]=(0,t.withModifiers)(()=>{},['stop']))},' 新聊天 ',32)])]),b.value.length?((0,t.openBlock)(),(0,t.createElementBlock)('div',Sn,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(b.value,(n,a)=>((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:a,class:'cardhub-manage__chat-row',role:'button',tabindex:'0',onClick:a=>Ha(n),onKeydown:(0,t.withKeys)((0,t.withModifiers)(a=>Ha(n),['prevent']),['enter'])},[(0,t.createElementVNode)('div',Fn,[(0,t.createElementVNode)('div',Tn,(0,t.toDisplayString)(n.name),1),n.label&&n.label!==n.name?((0,t.openBlock)(),(0,t.createElementBlock)('div',Ln,(0,t.toDisplayString)(n.label),1)):(0,t.createCommentVNode)('v-if',!0),n.keywords.length?((0,t.openBlock)(),(0,t.createElementBlock)('div',Dn,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(n.keywords,n=>((0,t.openBlock)(),(0,t.createElementBlock)('span',{key:n,class:'cardhub-manage__chat-tag'},(0,t.toDisplayString)(n),1))),128))])):(0,t.createCommentVNode)('v-if',!0)]),(0,t.createElementVNode)('span',Nn,(0,t.toDisplayString)(n.mes),1)],40,zn))),128))])):((0,t.openBlock)(),(0,t.createElementBlock)('div',Mn,(0,t.toDisplayString)(qn.value),1))]),(0,t.createElementVNode)('div',Yn,[(0,t.createElementVNode)('button',{class:'cardhub-manage__btn is-secondary',type:'button',onClick:i[20]||(i[20]=(0,t.withModifiers)(n=>ma(p.value),['stop'])),onPointerdown:i[21]||(i[21]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[22]||(i[22]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[23]||(i[23]=(0,t.withModifiers)(()=>{},['stop']))},(0,t.toDisplayString)('tavern'===p.value.origin?'导出':'导入'),33),(0,t.createElementVNode)('button',{class:'cardhub-manage__btn is-primary',type:'button',onClick:i[24]||(i[24]=(0,t.withModifiers)(n=>Wa(p.value),['stop'])),onPointerdown:i[25]||(i[25]=(0,t.withModifiers)(()=>{},['stop'])),onMousedown:i[26]||(i[26]=(0,t.withModifiers)(()=>{},['stop'])),onTouchstart:i[27]||(i[27]=(0,t.withModifiers)(()=>{},['stop']))},' 删除 ',32)])])])):(0,t.createCommentVNode)('v-if',!0),B.open?((0,t.openBlock)(),(0,t.createElementBlock)('div',{key:1,class:'cardhub-confirm',onClick:i[31]||(i[31]=(0,t.withModifiers)(n=>sa('cancel'),['self']))},[(0,t.createElementVNode)('div',jn,[(0,t.createElementVNode)('div',On,(0,t.toDisplayString)(B.title),1),(0,t.createElementVNode)('div',Vn,(0,t.toDisplayString)(B.message),1),(0,t.createElementVNode)('div',In,[(0,t.createElementVNode)('button',{class:'cardhub-confirm__button is-cancel',type:'button',onClick:i[28]||(i[28]=n=>sa('cancel'))},(0,t.toDisplayString)(B.cancelLabel),1),B.altLabel?((0,t.openBlock)(),(0,t.createElementBlock)('button',{key:0,class:'cardhub-confirm__button is-danger',type:'button',onClick:i[29]||(i[29]=n=>sa('alt'))},(0,t.toDisplayString)(B.altLabel),1)):(0,t.createCommentVNode)('v-if',!0),(0,t.createElementVNode)('button',{class:'cardhub-confirm__button is-confirm',type:'button',onClick:i[30]||(i[30]=n=>sa('confirm'))},(0,t.toDisplayString)(B.confirmLabel),1)])])])):(0,t.createCommentVNode)('v-if',!0)],2))}});c(205);const Hn=(0,c(502).A)(Pn,[['__scopeId','data-v-fe13b558']]);let $n=null,Un=null,Rn=null;function qn(){Un||(Rn=$('<style>').attr('data-cardhub-style',getScriptId()).text('\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        z-index: 9999;\n        font-family: "ZCOOL XiaoWei", "STSong", "Songti SC", "SimSun", serif;\n        color: #1b1b1b;\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n        border-radius: 28px;\n        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: #7d5b46;\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(43, 32, 24, 0.12);\n        color: #3b2a20;\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(86, 59, 44, 0.2);\n        padding: 6px 12px;\n        background: #fffaf4;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: #d46b3d;\n        color: #fff;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-button:hover {\n        background: #c55f36;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(106, 63, 42, 0.08);\n        border-color: rgba(106, 63, 42, 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(86, 59, 44, 0.15);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(86, 59, 44, 0.15);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(106, 63, 42, 0.25);\n        background: rgba(255, 255, 255, 0.7);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n        border-color: transparent;\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(106, 63, 42, 0.45);\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(106, 63, 42, 0.35);\n        background: rgba(255, 255, 255, 0.85);\n        color: #6a3f2a;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(106, 63, 42, 0.6);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: #7d5b46;\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(255, 255, 255, 0.78);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(86, 59, 44, 0.15);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(86, 59, 44, 0.25);\n        box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n        background-size: cover;\n        background-position: center;\n        color: #4a2a1f;\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fff6ea;\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: #fffaf4;\n        border-color: rgba(106, 63, 42, 0.5);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(106, 63, 42, 0.5);\n        background: #fffaf4;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: #6a3f2a;\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(106, 63, 42, 0.85);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: #2b2018;\n        color: #fff5ea;\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(43, 32, 24, 0.15);\n        color: #3b2a20;\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(43, 32, 24, 0.25);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fffaf4;\n        font-size: 12px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(255, 255, 255, 0.7);\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: none;\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: #241a14;\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: #d1bca8;\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: #3b2a20;\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(106, 63, 42, 0.08);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: #6a3f2a;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: #9a7a63;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-tag {\n        padding: 2px 6px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        background: rgba(255, 255, 255, 0.75);\n        font-size: 10px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-manage__chat-text {\n        color: #3b2a20;\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        position: absolute;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100002;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: #fff6ea;\n        border-radius: 22px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: #2b2018;\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: #4a2a1f;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: #d46b3d;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: #b6452a;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible {\n        outline: 2px solid rgba(212, 107, 61, 0.6);\n        outline-offset: 2px;\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 14px 16px;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n        }\n\n        .cardhub-title__main {\n          font-size: 20px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 11px;\n        }\n\n        .cardhub-close {\n          width: 28px;\n          height: 28px;\n          font-size: 16px;\n          line-height: 28px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          padding: 10px 14px;\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 13px;\n          padding: 8px 12px;\n        }\n\n        .cardhub-button {\n          flex: 1;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n          padding: 10px 14px;\n          max-height: none;\n          overflow: visible;\n        }\n\n        .cardhub-section-title {\n          font-size: 10px;\n          margin-bottom: 6px;\n        }\n\n        .cardhub-divider {\n          margin: 6px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: wrap;\n          overflow: visible;\n          gap: 6px;\n          padding-bottom: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 5px 10px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 4px 8px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 12px;\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview,\n        .cardhub-manage {\n          position: absolute !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-preview__panel,\n        .cardhub-manage__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n        }\n\n        .cardhub-preview__avatar {\n          height: 180px;\n          border-radius: 14px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-preview__actions {\n          gap: 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-tag {\n          font-size: 9px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n      }\n    ').appendTo('head'),Un=(0,r.g8)().addClass('cardhub-mount').appendTo('body'),$n=(0,t.createApp)(Hn),$n.mount(Un[0]),(0,t.watch)(()=>C.open,()=>{},{immediate:!0}))}function Wn(){return{open:(n='manual')=>{qn(),x(!0,n)},close:()=>{x(!1)},toggle:(n='manual')=>{qn(),x(!C.open,n)},refresh:async()=>{qn(),await async function(){v(!0);try{y(await i()),w(m())}finally{v(!1)}}()},destroy:()=>{$n&&$n.unmount(),Un&&Un.remove(),Rn&&Rn.remove(),$n=null,Un=null,Rn=null}}}function Qn(){const a=Wn(),e=n(a);a.refresh(),$(window).on('pagehide',()=>{e(),a.destroy()})}$(()=>{errorCatched(Qn)()})})();
//# sourceMappingURL=index.js.map