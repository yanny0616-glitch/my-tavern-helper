{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/示例/前端界面示例/加载和卸载时执行函数.ts","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"VueRouter\"","webpack://tavern_helper_template/./示例/前端界面示例/日记.vue?7675","webpack://tavern_helper_template/示例/前端界面示例/日记.vue?5719","webpack://tavern_helper_template/示例/前端界面示例/界面.vue?cd88","src://tavern_helper_template/示例/前端界面示例/界面.vue","webpack://tavern_helper_template/./示例/前端界面示例/选择框.vue?68c2","webpack://tavern_helper_template/示例/前端界面示例/选择框.vue?f9cd","src://tavern_helper_template/示例/前端界面示例/界面.ts","src://tavern_helper_template/src/角色卡管理插件/entry/buttons.ts","src://tavern_helper_template/src/角色卡管理插件/services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src/角色卡管理插件/services/libraryService.ts","src://tavern_helper_template/src/角色卡管理插件/state/store.ts","src://tavern_helper_template/src/角色卡管理插件/services/tagService.ts","src://tavern_helper_template/src/角色卡管理插件/ui/App.vue","src://tavern_helper_template/src/角色卡管理插件/ui/util/common.ts","webpack://tavern_helper_template/src/角色卡管理插件/ui/App.vue?a8e8","src://tavern_helper_template/src/角色卡管理插件/entry/portal.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src/角色卡管理插件/index.ts"],"sourcesContent":["module.exports = Vue;","// 在界面加载好后执行某个函数\n// 注意: 必须使用 `$()` 而不是 `document.addEventListener('DOMContentLoaded'`, 后者会让实时修改失效\n$(() => {\n  toastr.success('你已经成功加载界面!', '恭喜你!');\n});\n\n// 在界面卸载时执行某个函数\n$(window).on('pagehide', () => {\n  toastr.info('你已经卸载界面!', '再见!');\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = VueRouter;","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\n\nimport { ref, onMounted } from 'vue';\nconst _hoisted_1 = { class: \"message-content font-bold underline\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: '日记',\n    setup(__props) {\n        const display_text = ref('');\n        function captureDisplayText() {\n            // 通过 substitudeMacros 我们可以解析酒馆宏\n            const character_name = substitudeMacros('{{char}}');\n            // 通过 getCurrentMessageId 我们可以获取界面所在的楼层号\n            const message_id = getCurrentMessageId();\n            // 通过 getChatMessages 我们可以获取楼层内容\n            const chat_message = getChatMessages(message_id)[0];\n            // 我们可以从楼层的消息中通过正则提取出对话内容, 由于这是在代码中做, 相比起直接用酒馆正则会更加方便: 我们完全可以用其他代码对文本进行更多处理\n            const dialogue = chat_message.message.match(/\\[查看日记[:：]\\s*(.+)\\]/)?.[1] ?? '';\n            const text = `${character_name}: ${dialogue}`;\n            display_text.value = text;\n        }\n        onMounted(() => {\n            captureDisplayText();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"clickdiv\",\n                tabindex: \"1\",\n                onClick: _cache[0] || (_cache[0] = ($event) => (_ctx.$router.push('/选择框')))\n            }, [\n                _createElementVNode(\"span\", _hoisted_1, _toDisplayString(_unref(display_text)), 1 /* TEXT */)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./日记.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./日记.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./日记.vue?vue&type=style&index=0&id=2f0970f0&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2f0970f0\"]])\n\nexport default __exports__","/* unplugin-vue-components disabled */import { render } from \"./界面.vue?vue&type=template&id=0dd9707a\"\nconst script = {}\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx, _cache) {\n  const _component_RouterView = _resolveComponent(\"RouterView\")\n\n  return (_openBlock(), _createBlock(_component_RouterView))\n}","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode } from \"vue\";\n\nimport { ref } from 'vue';\nconst _hoisted_1 = { class: \"roleplay_options\" };\nconst _hoisted_2 = { class: \"roleplay_options_back\" };\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = { class: \"roleplay_options_title\" };\nconst _hoisted_5 = { class: \"roleplay_options_content\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: '选择框',\n    props: {\n        message: {}\n    },\n    setup(__props) {\n        const props = __props;\n        const options = ref((() => {\n            const text = props.message.match(/<roleplay_options>(.*?)<\\/roleplay_options>/s)?.[1] ?? '';\n            const item_matches = [...text.matchAll(/(.+?)[:：]\\s*(.+)/gm)];\n            return item_matches.map(match => ({\n                title: match[1],\n                content: match[2].replace(/^\\$\\{(.+)\\}$/, '$1').replace(/^「(.+)」$/, '$1'),\n            }));\n        })());\n        async function handleClick(item) {\n            await createChatMessages([{ role: 'user', message: item.content }]);\n            triggerSlash('/trigger');\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(options), (option) => {\n                        return (_openBlock(), _createElementBlock(\"div\", {\n                            key: option.title,\n                            class: \"roleplay_options_item\",\n                            tabindex: \"1\",\n                            onClick: ($event) => (handleClick(option))\n                        }, [\n                            _createElementVNode(\"span\", _hoisted_4, [\n                                _createElementVNode(\"strong\", null, _toDisplayString(option.title), 1 /* TEXT */)\n                            ]),\n                            _cache[0] || (_cache[0] = _createElementVNode(\"hr\", { class: \"roleplay_options_hr\" }, null, -1 /* CACHED */)),\n                            _createElementVNode(\"span\", _hoisted_5, _toDisplayString(option.content), 1 /* TEXT */)\n                        ], 8 /* PROPS */, _hoisted_3));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./选择框.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./选择框.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./选择框.vue?vue&type=style&index=0&id=010a817f&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-010a817f\"]])\n\nexport default __exports__","import { createMemoryHistory, createRouter } from 'vue-router';\nimport Diary from './日记.vue';\nimport App from './界面.vue';\nimport RoleplayOptions from './选择框.vue';\nconst router = createRouter({\n    history: createMemoryHistory(),\n    routes: [\n        { path: '/日记', component: Diary },\n        {\n            path: '/选择框',\n            component: RoleplayOptions,\n            props: { message: getChatMessages(getCurrentMessageId())[0].message },\n        },\n    ],\n});\nrouter.replace('/日记');\n$(() => {\n    createApp(App).use(router).mount('#app');\n});\n","import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  const $existing = $(`#${buttonId}`);\n  if ($existing.length) {\n    $existing\n      .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n      .attr('title', '打开 CardHub 角色卡管理器')\n      .attr('aria-label', '打开 CardHub 角色卡管理器')\n      .empty();\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] 未找到角色管理入口挂载点');\n    return null;\n  }\n\n  const openOnce = createOpenOnce(() => controller.open('role'));\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n    .attr('title', '打开 CardHub 角色卡管理器')\n    .attr('aria-label', '打开 CardHub 角色卡管理器')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      openOnce();\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], openOnce);\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return /角色管理/.test(text) || /角色管理/.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] 未找到左侧魔法棒入口');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const openOnce = createOpenOnce(() => controller.open('magic'));\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .html('<i class=\"fa-solid fa-id-badge\" aria-hidden=\"true\"></i><span>角色卡管理器</span>')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        openOnce();\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], openOnce);\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n\nfunction createOpenOnce(handler: () => void): () => void {\n  let lastFiredAt = 0;\n  return () => {\n    const now = Date.now();\n    if (now - lastFiredAt < 250) {\n      return;\n    }\n    lastFiredAt = now;\n    handler();\n  };\n}\n","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] 读取角色列表失败，将使用缓存数据', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const idCounts = new Map<string, number>();\n  const tagKeyCounts = new Map<string, number>();\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map((character, index) => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar;\n    const name = character.name ?? '未命名角色';\n    const stamp = character.create_date ?? character.date_added ?? character.chat ?? String(index);\n    const tagBaseKey = avatarKey ?? `name:${name}::${stamp}`;\n    let tagKey = tagBaseKey;\n    if (!avatarKey) {\n      const tagCount = tagKeyCounts.get(tagBaseKey) ?? 0;\n      tagKeyCounts.set(tagBaseKey, tagCount + 1);\n      if (tagCount) {\n        tagKey = `${tagBaseKey}::${tagCount}`;\n      }\n    }\n\n    const mappedIds = ctx?.tagMap?.[tagKey] ?? [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = Array.from(new Set([...directTags, ...mappedTags]));\n    const baseId = avatarKey ? `avatar:${avatarKey}` : `name:${name}::${stamp}`;\n    const count = idCounts.get(baseId) ?? 0;\n    idCounts.set(baseId, count + 1);\n    const id = count ? `${baseId}::${count}` : baseId;\n\n    return {\n      id,\n      name,\n      avatar: character.avatar ?? null,\n      tags,\n      tagKey,\n      origin: 'tavern',\n    };\n  });\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\n\nconst LIBRARY_KEY = 'cardhub_library';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibrary(): StoredLibrary {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  const raw = vars?.[LIBRARY_KEY];\n  if (!raw || typeof raw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((raw as StoredLibrary).entries) ? (raw as StoredLibrary).entries : [];\n  return { entries };\n}\n\nfunction writeLibrary(entries: CardHubItem[]) {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  TavernHelper.replaceVariables(getStorage(), {\n    ...vars,\n    [LIBRARY_KEY]: { entries },\n  });\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nfunction hashString(value: string): string {\n  let hash = 5381;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = (hash * 33) ^ value.charCodeAt(i);\n  }\n  return (hash >>> 0).toString(16);\n}\n\nfunction stableStringify(value: unknown): string {\n  if (value === null || typeof value !== 'object') {\n    return JSON.stringify(value);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(item => stableStringify(item)).join(',')}]`;\n  }\n  const entries = Object.entries(value as Record<string, unknown>).sort(([a], [b]) =>\n    a.localeCompare(b),\n  );\n  return `{${entries\n    .map(([key, val]) => `${JSON.stringify(key)}:${stableStringify(val)}`)\n    .join(',')}}`;\n}\n\nfunction buildFingerprint(rawType: CardHubItem['rawType'], raw: string): string {\n  let source = raw;\n  if (rawType === 'json') {\n    const trimmed = raw.trim();\n    try {\n      source = stableStringify(JSON.parse(trimmed));\n    } catch {\n      source = trimmed;\n    }\n  }\n  return `${rawType}:${hashString(source)}`;\n}\n\nfunction ensureFingerprint(entry: CardHubItem): string | null {\n  if (entry.fingerprint) {\n    return entry.fingerprint;\n  }\n  if (!entry.rawType || !entry.raw) {\n    return null;\n  }\n  const fingerprint = buildFingerprint(entry.rawType, entry.raw);\n  entry.fingerprint = fingerprint;\n  return fingerprint;\n}\n\nexport function loadLibrary(): CardHubItem[] {\n  return readLibrary().entries;\n}\n\nexport async function addToLibrary(\n  files: FileList | File[],\n  existingEntries?: CardHubItem[],\n): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return loadLibrary();\n  }\n  const current = Array.isArray(existingEntries) && existingEntries.length\n    ? existingEntries\n    : loadLibrary();\n  const fingerprints = new Set<string>();\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n  });\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      const fingerprint = buildFingerprint('png', dataUrl);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name,\n        avatar: dataUrl,\n        tags: [],\n        origin: 'library',\n        rawType: 'png',\n        raw: dataUrl,\n        fingerprint,\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      const fingerprint = buildFingerprint('json', text);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: [],\n        origin: 'library',\n        rawType: 'json',\n        raw: text,\n        fingerprint,\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  writeLibrary(merged);\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[]): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.filter(entry => entry.id !== entryId);\n  writeLibrary(updated);\n  return updated;\n}\n\n","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setSearch(search: string) {\n  cardHubState.search = search;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library;\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar\n    ? ctx.characters.find(character => character.avatar === target.avatar)\n    : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nexport function getAllTagsFromContext(): string[] {\n  const ctx = getContext();\n  if (!ctx || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  return ctx.tags.map(tag => tag.name).filter(Boolean);\n}\n\nexport function getTagsForAvatar(tagKey: string | null | undefined): string[] {\n  if (!tagKey) {\n    return [];\n  }\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const ids = ctx.tagMap[tagKey] ?? [];\n  return ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const direct = target.tags ?? [];\n  const mapped = getTagsForAvatar(target.tagKey ?? target.avatar);\n  return Array.from(new Set([...direct, ...mapped]));\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(\n    new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)),\n  );\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const tagKey = target.tagKey ?? character.avatar ?? null;\n  if (tagKey) {\n    ctx.tagMap![tagKey] = tagIds;\n  }\n\n  ctx.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub 角色卡管理器\"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-chip-row\" };\nconst _hoisted_6 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = { class: \"cardhub-content\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_10 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_11 = {\n    key: 2,\n    class: \"cardhub-grid-wrap\"\n};\nconst _hoisted_12 = { class: \"cardhub-pagination\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"cardhub-pagination__actions\"\n};\nconst _hoisted_14 = [\"disabled\"];\nconst _hoisted_15 = [\"disabled\"];\nconst _hoisted_16 = { class: \"cardhub-pagination__status\" };\nconst _hoisted_17 = { class: \"cardhub-grid\" };\nconst _hoisted_18 = [\"onClick\"];\nconst _hoisted_19 = { class: \"cardhub-card__info\" };\nconst _hoisted_20 = { class: \"cardhub-card__name\" };\nconst _hoisted_21 = { class: \"cardhub-card__meta\" };\nconst _hoisted_22 = { class: \"cardhub-card__tags\" };\nconst _hoisted_23 = [\"onClick\"];\nconst _hoisted_24 = [\"onClick\"];\nconst _hoisted_25 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_26 = { class: \"cardhub-card__actions\" };\nconst _hoisted_27 = [\"onClick\"];\nconst _hoisted_28 = [\"onClick\"];\nconst _hoisted_29 = {\n    class: \"cardhub-manage__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"角色管理\"\n};\nconst _hoisted_30 = { class: \"cardhub-manage__top\" };\nconst _hoisted_31 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_32 = { class: \"cardhub-preview__name\" };\nconst _hoisted_33 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_34 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_35 = { class: \"cardhub-manage__overview\" };\nconst _hoisted_36 = { class: \"cardhub-manage__overview-label\" };\nconst _hoisted_37 = { class: \"cardhub-manage__overview-value\" };\nconst _hoisted_38 = {\n    key: 0,\n    class: \"cardhub-manage__overview-hint\"\n};\nconst _hoisted_39 = { class: \"cardhub-manage__media\" };\nconst _hoisted_40 = [\"src\"];\nconst _hoisted_41 = { class: \"cardhub-manage__section\" };\nconst _hoisted_42 = {\n    key: 0,\n    class: \"cardhub-manage__details\"\n};\nconst _hoisted_43 = { class: \"cardhub-manage__detail-label\" };\nconst _hoisted_44 = { class: \"cardhub-manage__detail-content\" };\nconst _hoisted_45 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_46 = { class: \"cardhub-manage__section\" };\nconst _hoisted_47 = { class: \"cardhub-manage__content\" };\nconst _hoisted_48 = { class: \"cardhub-manage__section\" };\nconst _hoisted_49 = { class: \"cardhub-manage__label\" };\nconst _hoisted_50 = { class: \"cardhub-manage__jump-row\" };\nconst _hoisted_51 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_52 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_53 = { class: \"cardhub-manage__chat-main\" };\nconst _hoisted_54 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_55 = {\n    key: 0,\n    class: \"cardhub-manage__chat-label\"\n};\nconst _hoisted_56 = {\n    key: 1,\n    class: \"cardhub-manage__chat-tags\"\n};\nconst _hoisted_57 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_58 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_59 = { class: \"cardhub-manage__actions\" };\nconst _hoisted_60 = {\n    class: \"cardhub-confirm__panel\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\"\n};\nconst _hoisted_61 = { class: \"cardhub-confirm__title\" };\nconst _hoisted_62 = { class: \"cardhub-confirm__message\" };\nconst _hoisted_63 = { class: \"cardhub-confirm__actions\" };\nimport { computed, nextTick, reactive, ref, watch } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { regexFromString } from './util/common';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const selectedTags = ref([]);\n        const activeTagKey = ref(null);\n        const tagInput = ref('');\n        const statusFilter = ref('all');\n        const pageSize = ref(24);\n        const currentPage = ref(1);\n        const importInput = ref(null);\n        const manageCard = ref(null);\n        const manageOpenings = ref([]);\n        const manageChats = ref([]);\n        const manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\n        let manageRequestId = 0;\n        const confirmState = reactive({\n            open: false,\n            title: '',\n            message: '',\n            confirmLabel: '确定',\n            cancelLabel: '取消',\n            altLabel: '',\n            resolve: null,\n        });\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const manageProfile = ref(null);\n        const manageOpeningSummary = ref(null);\n        const manageChatSummary = ref(null);\n        const manageDetails = computed(() => {\n            const profile = manageProfile.value;\n            if (!profile) {\n                return [];\n            }\n            const details = [];\n            const pushDetail = (label, value, maxChars = 240) => {\n                const preview = previewDetailText(value, 3, maxChars);\n                if (preview) {\n                    details.push({ label, value: preview });\n                }\n            };\n            pushDetail('角色描述', profile.description ?? '');\n            pushDetail('性格', profile.personality ?? '');\n            pushDetail('场景', profile.scenario ?? '');\n            pushDetail('创作者备注', profile.creatorNotes ?? '');\n            pushDetail('系统提示', profile.systemPrompt ?? '', 200);\n            pushDetail('历史指令', profile.postHistory ?? '', 200);\n            pushDetail('作者', profile.creator ?? '', 80);\n            return details;\n        });\n        const manageDetailsHint = computed(() => {\n            if (!manageCard.value || manageDetails.value.length) {\n                return '';\n            }\n            if (manageCard.value.origin === 'library') {\n                return '未导入卡片暂无可预览内容，可先导入后查看详情。';\n            }\n            return '暂无角色卡详情。';\n        });\n        const manageChatHint = computed(() => {\n            if (manageCard.value?.origin === 'library') {\n                return '未导入卡片暂无聊天记录。';\n            }\n            return '暂无聊天记录。';\n        });\n        const manageOverview = computed(() => {\n            const items = [];\n            const profile = manageProfile.value;\n            const worldName = profile?.worldBookName?.trim() || '';\n            const worldCount = profile?.worldBookCount;\n            let worldValue = '未绑定';\n            let worldHint = '';\n            if (worldName || typeof worldCount === 'number') {\n                worldValue = worldName || '角色世界书';\n                worldHint = typeof worldCount === 'number' ? `${worldCount} 条` : '';\n            }\n            items.push({ label: '世界书', value: worldValue, hint: worldHint });\n            const chat = manageChatSummary.value;\n            let chatValue = '暂无聊天';\n            let chatHint = '';\n            if (chat && chat.total > 0) {\n                chatValue = `${chat.total} 个聊天`;\n                if (chat.latest) {\n                    chatHint = `最近：${chat.latest}`;\n                }\n            }\n            items.push({ label: '聊天概况', value: chatValue, hint: chatHint });\n            const opening = manageOpeningSummary.value;\n            let openingValue = '暂无开场白';\n            let openingHint = '';\n            if (opening && opening.total > 0) {\n                openingValue = `${opening.total} 条`;\n                openingHint = opening.alternate > 0 ? `替代：${opening.alternate} 条` : '无替代';\n            }\n            items.push({ label: '开场白', value: openingValue, hint: openingHint });\n            return items;\n        });\n        const filteredCharacters = computed(() => {\n            const list = applyStatusFilter(allCards.value);\n            const keyword = state.search.trim();\n            if (!keyword) {\n                return applyTagFilter(list);\n            }\n            const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), 'i');\n            return applyTagFilter(list).filter(character => {\n                return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\n            });\n        });\n        const totalPages = computed(() => {\n            const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n            return total > 0 ? total : 1;\n        });\n        const pagedCharacters = computed(() => {\n            const start = (currentPage.value - 1) * pageSize.value;\n            return filteredCharacters.value.slice(start, start + pageSize.value);\n        });\n        const allTags = computed(() => {\n            const tagSet = new Set();\n            allCards.value.forEach(character => {\n                getMergedTags(character).forEach(tag => tagSet.add(tag));\n            });\n            selectedTags.value.forEach(tag => tagSet.add(tag));\n            return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return getMergedTags(character);\n        }\n        const manageAvatarUrl = computed(() => {\n            if (!manageCard.value) {\n                return null;\n            }\n            return avatarUrl(manageCard.value, true);\n        });\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => item.origin === 'tavern');\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => item.origin === 'library');\n            }\n            return list;\n        }\n        function applyTagFilter(list) {\n            if (!selectedTags.value.length) {\n                return list;\n            }\n            return list.filter(character => selectedTags.value.some(tag => getMergedTags(character).includes(tag)));\n        }\n        function toggleTagFilter(tag) {\n            if (selectedTags.value.includes(tag)) {\n                selectedTags.value = selectedTags.value.filter(item => item !== tag);\n            }\n            else {\n                selectedTags.value = [...selectedTags.value, tag];\n            }\n        }\n        function clearTagFilter() {\n            selectedTags.value = [];\n        }\n        watch([() => state.search, statusFilter, () => selectedTags.value.join('|')], () => {\n            currentPage.value = 1;\n        });\n        watch([filteredCharacters, totalPages], () => {\n            if (currentPage.value > totalPages.value) {\n                currentPage.value = totalPages.value;\n            }\n            if (currentPage.value < 1) {\n                currentPage.value = 1;\n            }\n        });\n        function prevPage() {\n            if (currentPage.value > 1) {\n                currentPage.value -= 1;\n            }\n        }\n        function nextPage() {\n            if (currentPage.value < totalPages.value) {\n                currentPage.value += 1;\n            }\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function findDuplicateCharacterByName(name) {\n            const target = normalizeNameKey(name);\n            if (!target) {\n                return null;\n            }\n            return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\n        }\n        function openConfirm(options) {\n            if (confirmState.open && confirmState.resolve) {\n                confirmState.resolve('cancel');\n            }\n            confirmState.title = options.title ?? '确认操作';\n            confirmState.message = options.message;\n            confirmState.confirmLabel = options.confirmLabel ?? '确定';\n            confirmState.cancelLabel = options.cancelLabel ?? '取消';\n            confirmState.altLabel = options.altLabel ?? '';\n            confirmState.open = true;\n            return new Promise(resolve => {\n                confirmState.resolve = resolve;\n            });\n        }\n        function resolveConfirm(result) {\n            if (!confirmState.open) {\n                return;\n            }\n            confirmState.open = false;\n            const resolver = confirmState.resolve;\n            confirmState.resolve = null;\n            if (resolver) {\n                resolver(result);\n            }\n        }\n        function removeTag(character, tag) {\n            const nextTags = getMergedTags(character).filter(item => item !== tag);\n            applyTagUpdate(character, nextTags);\n        }\n        function tagKey(character) {\n            return character.id;\n        }\n        function startTagEdit(character) {\n            activeTagKey.value = tagKey(character);\n            tagInput.value = '';\n            nextTick(() => {\n                const input = document.querySelector('.cardhub-tag-input');\n                input?.focus();\n            });\n        }\n        function confirmTag(character) {\n            if (activeTagKey.value !== tagKey(character)) {\n                return;\n            }\n            const input = tagInput.value.trim();\n            if (input) {\n                const nextTags = [...getMergedTags(character), input];\n                applyTagUpdate(character, nextTags);\n            }\n            cancelTagEdit();\n        }\n        function cancelTagEdit() {\n            activeTagKey.value = null;\n            tagInput.value = '';\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (character.origin === 'library') {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTags(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        function triggerImport() {\n            importInput.value?.click();\n        }\n        async function handleImportFiles(event) {\n            const target = event.target;\n            const files = target?.files;\n            if (!files || !files.length) {\n                return;\n            }\n            const updated = await addToLibrary(files, state.library);\n            setLibrary(updated);\n            target.value = '';\n        }\n        async function exportSelected() {\n            const list = filteredCharacters.value;\n            if (!list.length) {\n                toastr.warning('当前没有可导出的角色卡');\n                return;\n            }\n            const tagLabel = selectedTags.value.length ? selectedTags.value.join('、') : '无';\n            const statusLabel = statusFilter.value === 'all'\n                ? '全部'\n                : statusFilter.value === 'imported'\n                    ? '已导入'\n                    : '未导入';\n            const searchLabel = state.search.trim() || '无';\n            const message = `将导出 ${list.length} 张角色卡。\\n` +\n                `筛选状态：${statusLabel}\\n` +\n                `筛选标签：${tagLabel}\\n` +\n                `搜索关键字：${searchLabel}\\n` +\n                `是否继续？`;\n            const result = await openConfirm({\n                title: '批量导出',\n                message,\n                confirmLabel: '继续导出',\n                cancelLabel: '取消',\n            });\n            if (result !== 'confirm') {\n                return;\n            }\n            list.forEach(item => exportCard(item));\n        }\n        async function handleCardAction(card) {\n            if (card.origin === 'library') {\n                await importLibraryCard(card);\n            }\n            else {\n                exportCard(card);\n            }\n        }\n        async function importLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('缺少导入数据');\n                return;\n            }\n            const duplicate = findDuplicateCharacterByName(card.name);\n            if (duplicate) {\n                toastr.warning(`已存在同名角色「${duplicate.name}」，已跳过导入`);\n                return;\n            }\n            const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {});\n            delete headers['Content-Type'];\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                await TavernHelper.importRawCharacter(card.name, blob);\n            }\n            else {\n                const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n                const form = new FormData();\n                form.append('avatar', file);\n                form.append('file_type', 'json');\n                form.append('preserved_name', file.name);\n                await fetch('/api/characters/import', {\n                    method: 'POST',\n                    headers,\n                    body: form,\n                    cache: 'no-cache',\n                });\n            }\n            setLibrary(removeFromLibrary(card.id));\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n            toastr.success(`已导入 ${card.name}`);\n        }\n        async function exportCard(card) {\n            if (card.origin === 'library') {\n                await exportLibraryCard(card);\n                return;\n            }\n            if (!card.avatar) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            downloadBlob(blob, `${card.name}.png`);\n        }\n        async function exportLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('无法导出：缺少原始数据');\n                return;\n            }\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                downloadBlob(blob, `${card.name}.png`);\n                return;\n            }\n            const blob = new Blob([card.raw], { type: 'application/json' });\n            downloadBlob(blob, `${card.name}.json`);\n        }\n        async function openManage(card) {\n            const requestId = ++manageRequestId;\n            manageCard.value = card;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n            const [manageResult, chatsResult] = await Promise.allSettled([\n                resolveManageData(card),\n                resolveRecentChats(card),\n            ]);\n            if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n                return;\n            }\n            const manageData = manageResult.status === 'fulfilled'\n                ? manageResult.value\n                : { openings: [], profile: null, openingSummary: null };\n            manageOpenings.value = manageData.openings;\n            manageProfile.value = manageData.profile;\n            manageOpeningSummary.value = manageData.openingSummary;\n            const chatData = chatsResult.status === 'fulfilled'\n                ? chatsResult.value\n                : { list: [], summary: null };\n            manageChats.value = chatData.list;\n            manageChatSummary.value = chatData.summary;\n        }\n        function closeManage() {\n            manageCard.value = null;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n        }\n        async function resolveManageData(card) {\n            if (card.origin !== 'tavern') {\n                const data = parseLibraryCardData(card);\n                return {\n                    openings: extractOpeningMessages(data),\n                    profile: extractCardProfile(data),\n                    openingSummary: extractOpeningSummary(data),\n                };\n            }\n            const raw = await getFullCharacterData(card);\n            const fallback = raw ??\n                TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            const primary = raw ?? fallback;\n            let openings = extractOpeningMessages(primary);\n            if (!openings.length && fallback && fallback !== primary) {\n                openings = extractOpeningMessages(fallback);\n            }\n            const openingSummary = extractOpeningSummary(primary ?? fallback);\n            return {\n                openings,\n                profile: extractCardProfile(primary ?? fallback),\n                openingSummary,\n            };\n        }\n        function parseLibraryCardData(card) {\n            if (!card.raw || !card.rawType) {\n                return null;\n            }\n            if (card.rawType === 'json') {\n                return parseJsonSafe(card.raw);\n            }\n            if (card.rawType === 'png') {\n                return parsePngCardData(card.raw);\n            }\n            return null;\n        }\n        function parseJsonSafe(raw) {\n            try {\n                return JSON.parse(raw);\n            }\n            catch {\n                return null;\n            }\n        }\n        function parsePngCardData(dataUrl) {\n            const bytes = dataUrlToBytes(dataUrl);\n            if (!bytes) {\n                return null;\n            }\n            const chunks = extractPngTextChunks(bytes);\n            const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n            for (const chunk of chunks) {\n                if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n                    continue;\n                }\n                const parsed = parseCardPayload(chunk.value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function dataUrlToBytes(dataUrl) {\n            const comma = dataUrl.indexOf(',');\n            if (comma < 0) {\n                return null;\n            }\n            const base64 = dataUrl.slice(comma + 1);\n            try {\n                const binary = atob(base64);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return bytes;\n            }\n            catch {\n                return null;\n            }\n        }\n        function extractPngTextChunks(bytes) {\n            if (bytes.length < 8) {\n                return [];\n            }\n            const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n            for (let i = 0; i < signature.length; i += 1) {\n                if (bytes[i] !== signature[i]) {\n                    return [];\n                }\n            }\n            const chunks = [];\n            let offset = 8;\n            while (offset + 8 <= bytes.length) {\n                const length = readUint32BE(bytes, offset);\n                const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n                const dataStart = offset + 8;\n                const dataEnd = dataStart + length;\n                if (dataEnd + 4 > bytes.length) {\n                    break;\n                }\n                const data = bytes.subarray(dataStart, dataEnd);\n                if (type === 'tEXt') {\n                    const entry = parseTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                else if (type === 'iTXt') {\n                    const entry = parseIntlTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                offset = dataEnd + 4;\n            }\n            return chunks;\n        }\n        function parseTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseIntlTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const compressed = data[nullIndex + 1] === 1;\n            let cursor = nullIndex + 2;\n            const langEnd = data.indexOf(0, cursor);\n            if (langEnd < 0) {\n                return null;\n            }\n            cursor = langEnd + 1;\n            const translatedEnd = data.indexOf(0, cursor);\n            if (translatedEnd < 0) {\n                return null;\n            }\n            cursor = translatedEnd + 1;\n            if (compressed) {\n                return null;\n            }\n            const value = bytesToString(data.subarray(cursor)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseCardPayload(value) {\n            const trimmed = value.trim();\n            if (!trimmed) {\n                return null;\n            }\n            const direct = parseJsonSafe(trimmed);\n            if (direct) {\n                return direct;\n            }\n            if (!isLikelyBase64(trimmed)) {\n                return null;\n            }\n            const decoded = decodeBase64Text(trimmed);\n            if (!decoded) {\n                return null;\n            }\n            return parseJsonSafe(decoded);\n        }\n        function decodeBase64Text(value) {\n            try {\n                const binary = atob(value);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return new TextDecoder().decode(bytes);\n            }\n            catch {\n                return null;\n            }\n        }\n        function isLikelyBase64(value) {\n            if (value.length < 16 || value.length % 4 !== 0) {\n                return false;\n            }\n            return /^[A-Za-z0-9+/=]+$/.test(value);\n        }\n        function readUint32BE(bytes, offset) {\n            return ((bytes[offset] << 24) |\n                (bytes[offset + 1] << 16) |\n                (bytes[offset + 2] << 8) |\n                bytes[offset + 3]) >>> 0;\n        }\n        function bytesToString(bytes) {\n            return new TextDecoder().decode(bytes);\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色卡列表失败', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar\n                ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\n                : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡详情失败', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡字段失败', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractCardProfile(data) {\n            if (!data) {\n                return null;\n            }\n            const profile = {\n                description: pickString(data?.description, data?.data?.description),\n                personality: pickString(data?.personality, data?.data?.personality),\n                scenario: pickString(data?.scenario, data?.data?.scenario),\n                creatorNotes: pickString(data?.creatorcomment, data?.data?.creatorcomment, data?.creator_notes, data?.data?.creator_notes),\n                systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n                postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n                creator: pickString(data?.creator, data?.data?.creator),\n            };\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (book) {\n                profile.worldBookName = pickString(book?.name);\n                profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n            }\n            const hasValue = Boolean(profile.description) ||\n                Boolean(profile.personality) ||\n                Boolean(profile.scenario) ||\n                Boolean(profile.creatorNotes) ||\n                Boolean(profile.systemPrompt) ||\n                Boolean(profile.postHistory) ||\n                Boolean(profile.creator) ||\n                Boolean(profile.worldBookName) ||\n                typeof profile.worldBookCount === 'number';\n            return hasValue ? profile : null;\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function extractOpeningSummary(data) {\n            if (!data) {\n                return null;\n            }\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            let alternate = 0;\n            if (Array.isArray(alt)) {\n                alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                alternate = 1;\n            }\n            return {\n                total: firstCount + alternate,\n                alternate,\n            };\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function formatMaybeTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                const ms = value < 1e12 ? value * 1000 : value;\n                return new Date(ms).toLocaleString('zh-CN', { hour12: false });\n            }\n            if (typeof value === 'string') {\n                const trimmed = value.trim();\n                if (trimmed) {\n                    return trimmed;\n                }\n            }\n            return '';\n        }\n        function extractChatLatestLabel(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const label = formatMaybeTimestamp(value);\n                if (label) {\n                    return label;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (!fallback) {\n                return '';\n            }\n            return fallback.replace(/\\.jsonl$/i, '');\n        }\n        function formatChatTitle(entry) {\n            const label = extractChatLatestLabel(entry);\n            return label || '聊天记录';\n        }\n        function formatChatFileLabel(entry) {\n            const raw = pickString(entry?.file_name, entry?.file_id);\n            if (!raw) {\n                return '';\n            }\n            return raw.replace(/\\.jsonl$/i, '');\n        }\n        function extractChatKeywords(value, max = 3) {\n            const normalized = normalizeBriefMessage(value);\n            if (!normalized) {\n                return [];\n            }\n            const keywords = new Set();\n            const stopWords = new Set([\n                'the',\n                'and',\n                'you',\n                'your',\n                'are',\n                'this',\n                'that',\n                'with',\n                'have',\n                'not',\n                'for',\n                'from',\n                'what',\n                'why',\n                'when',\n                'where',\n                'then',\n                'into',\n                'out',\n                'here',\n                'there',\n                '这个',\n                '那个',\n                '我们',\n                '你们',\n                '他们',\n                '她们',\n                '因为',\n                '但是',\n                '然后',\n                '如果',\n                '可以',\n                '没有',\n                '不是',\n                '已经',\n                '现在',\n                '一个',\n                '一些',\n                '还有',\n                '所以',\n                '这种',\n            ]);\n            const bracketMatches = normalized.match(/\\[[^\\]]{2,16}\\]/g) ?? [];\n            for (const match of bracketMatches) {\n                const cleaned = match.slice(1, -1).trim();\n                if (cleaned) {\n                    keywords.add(cleaned);\n                }\n                if (keywords.size >= max) {\n                    return Array.from(keywords).slice(0, max);\n                }\n            }\n            const wordMatches = normalized.match(/[\\u4e00-\\u9fa5]{2,}|[A-Za-z0-9]{3,}/g) ?? [];\n            for (const word of wordMatches) {\n                const lower = word.toLowerCase();\n                if (stopWords.has(word) || stopWords.has(lower)) {\n                    continue;\n                }\n                keywords.add(word);\n                if (keywords.size >= max) {\n                    break;\n                }\n            }\n            return Array.from(keywords).slice(0, max);\n        }\n        function previewDetailText(text, maxLines, maxChars) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return '';\n            }\n            const lines = extractContentLines(trimmed);\n            const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n            let preview = source.slice(0, maxLines).join('\\n').trim();\n            if (!preview) {\n                return '';\n            }\n            const truncated = preview.length > maxChars;\n            if (truncated) {\n                preview = preview.slice(0, maxChars).trim();\n            }\n            const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n            if (hasMore && !preview.endsWith('…')) {\n                preview = `${preview}…`;\n            }\n            return preview;\n        }\n        function previewOpenings(openings, maxItems) {\n            return openings\n                .map(opening => previewOpeningLines(opening, 2).join('\\n'))\n                .filter(preview => preview.trim().length > 0)\n                .slice(0, maxItems);\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return { list: [], summary: null };\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return { list: [], summary: { total: 0, latest: '' } };\n            }\n            const list = brief.slice(0, 3).map((entry) => ({\n                name: formatChatTitle(entry),\n                label: formatChatFileLabel(entry),\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n                keywords: extractChatKeywords(String(entry?.mes ?? '')),\n            }));\n            const latest = extractChatLatestLabel(brief[0]);\n            return {\n                list,\n                summary: {\n                    total: brief.length,\n                    latest,\n                },\n            };\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('暂无聊天记录');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openNewChat() {\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            try {\n                await triggerSlash('/newchat');\n                closeManage();\n                close();\n            }\n            catch (error) {\n                console.warn('[CardHub] 新聊天失败', error);\n                toastr.error('无法创建新聊天');\n            }\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('未找到聊天文件');\n                return;\n            }\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            const { ctx, st } = selection;\n            const target = normalizeChatId(file);\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('无法打开聊天：缺少接口');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] 打开聊天失败', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] 打开聊天失败', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                closeManage();\n                close();\n                return;\n            }\n            toastr.warning('未能打开聊天，可能需要先手动切到该角色');\n        }\n        async function selectManageCharacter(options = {}) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色列表失败', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            if (idx < 0) {\n                toastr.warning('未找到角色索引，请先手动切到该角色后再试');\n                return null;\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (!selector) {\n                toastr.warning('无法切换角色，请先手动切到该角色后再试');\n                return null;\n            }\n            try {\n                await selector(idx, { switchMenu: false });\n            }\n            catch (error) {\n                console.warn('[CardHub] 切换角色失败', error);\n            }\n            const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n            if (options.ensureSelected && !selected) {\n                toastr.warning('角色切换未完成，请稍后再试');\n                return null;\n            }\n            return { ctx, st, idx };\n        }\n        async function waitForCharacterSelection(idx, ctx, st, timeoutMs) {\n            const target = String(idx);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = getCurrentCharacterId(ctx, st);\n                if (current === target) {\n                    return true;\n                }\n                await sleep(80);\n            }\n            return false;\n        }\n        function getCurrentCharacterId(ctx, st) {\n            const value = ctx?.characterId ?? st?.characterId ?? '';\n            return value === undefined || value === null ? '' : String(value);\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function findCharacterIndex(list, card) {\n            if (card.avatar) {\n                const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\n                if (byAvatar >= 0) {\n                    return byAvatar;\n                }\n            }\n            return list.findIndex(item => item.name === card.name);\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await new Promise(resolve => setTimeout(resolve, 200));\n            }\n            return false;\n        }\n        async function manageDelete(card) {\n            if (card.origin === 'library') {\n                const confirmDelete = await openConfirm({\n                    title: '删除角色',\n                    message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n                    confirmLabel: '删除',\n                    cancelLabel: '取消',\n                });\n                if (confirmDelete !== 'confirm') {\n                    return;\n                }\n                setLibrary(removeFromLibrary(card.id));\n                closeManage();\n                return;\n            }\n            const confirmDelete = await openConfirm({\n                title: '删除角色',\n                message: `确定要删除「${card.name}」吗？`,\n                confirmLabel: '继续',\n                cancelLabel: '取消',\n            });\n            if (confirmDelete !== 'confirm') {\n                return;\n            }\n            const deleteChoice = await openConfirm({\n                title: '删除方式',\n                message: `删除「${card.name}」：\\n` +\n                    `- 移到私有库：可在私有库中找回\\n` +\n                    `- 永久删除：不可恢复`,\n                confirmLabel: '移到私有库',\n                altLabel: '永久删除',\n                cancelLabel: '取消',\n            });\n            if (deleteChoice === 'cancel') {\n                return;\n            }\n            if (deleteChoice === 'confirm') {\n                await moveToLibrary(card);\n                const deleted = await deleteFromTavern(card, false);\n                if (!deleted) {\n                    return;\n                }\n                closeManage();\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                return;\n            }\n            const confirmPermanent = await openConfirm({\n                title: '永久删除',\n                message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n                confirmLabel: '永久删除',\n                cancelLabel: '取消',\n            });\n            if (confirmPermanent !== 'confirm') {\n                return;\n            }\n            const deleted = await deleteFromTavern(card, true);\n            if (!deleted) {\n                return;\n            }\n            closeManage();\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n        }\n        async function moveToLibrary(card) {\n            if (!card.avatar) {\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            const updated = await addToLibrary([\n                new File([blob], `${card.name}.png`, { type: 'image/png' }),\n            ]);\n            setLibrary(updated);\n        }\n        async function deleteFromTavern(card, deleteChats) {\n            if (!card.avatar) {\n                toastr.error('删除失败：缺少头像信息');\n                return false;\n            }\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.());\n            if (!headers || !Object.keys(headers).length) {\n                toastr.error('删除失败：无法获取请求头');\n                return false;\n            }\n            const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n            const response = await fetch('/api/characters/delete', {\n                method: 'POST',\n                headers: { ...headers, 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n                cache: 'no-cache',\n            });\n            if (response.ok) {\n                return true;\n            }\n            const detail = await response.text();\n            toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n            return false;\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                setLibrary(loadLibrary());\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }])\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[33] || (_cache[33] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"角色卡管理器\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"关闭\",\n                                onClick: close\n                            }, [...(_cache[32] || (_cache[32] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"×\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"搜索角色名或标签\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"刷新\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: triggerImport\n                        }, \"导入\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: exportSelected\n                        }, \"批量导出\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: handleImportFiles\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[34] || (_cache[34] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"分类\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                    type: \"button\",\n                                    onClick: _cache[1] || (_cache[1] = ($event) => (statusFilter.value = 'all'))\n                                }, \" 全部 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[2] || (_cache[2] = ($event) => (statusFilter.value = 'imported'))\n                                }, \" 已导入 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[3] || (_cache[3] = ($event) => (statusFilter.value = 'unimported'))\n                                }, \" 未导入 \", 2 /* CLASS */)\n                            ]),\n                            _cache[35] || (_cache[35] = _createElementVNode(\"div\", { class: \"cardhub-divider\" }, null, -1 /* CACHED */)),\n                            _cache[36] || (_cache[36] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"标签\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allTags.value, (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': selectedTags.value.includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (toggleTagFilter(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_7));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (selectedTags.value.length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: clearTagFilter\n                                }, \" 清空标签 \"))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"正在读取角色卡...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \" 暂无角色卡，或没有匹配的搜索结果。 \"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                        _createElementVNode(\"div\", _hoisted_12, [\n                                            (totalPages.value > 1)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value <= 1,\n                                                        onClick: prevPage\n                                                    }, \" 上一页 \", 8 /* PROPS */, _hoisted_14),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value >= totalPages.value,\n                                                        onClick: nextPage\n                                                    }, \" 下一页 \", 8 /* PROPS */, _hoisted_15)\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"span\", _hoisted_16, \"第 \" + _toDisplayString(currentPage.value) + \" / \" + _toDisplayString(totalPages.value) + \" 页\", 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_17, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedCharacters.value, (character) => {\n                                                return (_openBlock(), _createElementBlock(\"article\", {\n                                                    key: character.id,\n                                                    class: \"cardhub-card\",\n                                                    onClick: ($event) => (openManage(character))\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                        style: _normalizeStyle(avatarStyle(character))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                    ], 6 /* CLASS, STYLE */),\n                                                    _createElementVNode(\"div\", _hoisted_19, [\n                                                        _createElementVNode(\"div\", _hoisted_20, _toDisplayString(character.name), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_21, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" 标签\", 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_22, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-tag\",\n                                                                    type: \"button\",\n                                                                    title: \"点击移除标签\",\n                                                                    onClick: _withModifiers(($event) => (removeTag(character, tag)), [\"stop\"])\n                                                                }, [\n                                                                    _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                    _cache[37] || (_cache[37] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"×\", -1 /* CACHED */))\n                                                                ], 8 /* PROPS */, _hoisted_23));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (activeTagKey.value !== tagKey(character))\n                                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: 0,\n                                                                    class: \"cardhub-tag is-add\",\n                                                                    type: \"button\",\n                                                                    onClick: _withModifiers(($event) => (startTagEdit(character)), [\"stop\"])\n                                                                }, \" + 标签 \", 8 /* PROPS */, _hoisted_24))\n                                                                : _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                                                                    key: 1,\n                                                                    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((tagInput).value = $event)),\n                                                                    class: \"cardhub-tag-input\",\n                                                                    type: \"text\",\n                                                                    placeholder: \"新标签\",\n                                                                    onKeydown: [\n                                                                        _withKeys(_withModifiers(($event) => (confirmTag(character)), [\"prevent\"]), [\"enter\"]),\n                                                                        _withKeys(_withModifiers(cancelTagEdit, [\"prevent\"]), [\"esc\"])\n                                                                    ],\n                                                                    onBlur: ($event) => (confirmTag(character)),\n                                                                    onClick: _cache[5] || (_cache[5] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onMousedown: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onTouchstart: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"]))\n                                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_25)), [\n                                                                    [_vModelText, tagInput.value]\n                                                                ])\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_26, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action is-secondary\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (handleCardAction(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[9] || (_cache[9] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[10] || (_cache[10] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, _toDisplayString(character.origin === 'tavern' ? '导出' : '导入'), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_27),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[11] || (_cache[11] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, \" 管理 \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_28)\n                                                    ])\n                                                ], 8 /* PROPS */, _hoisted_18));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                        ])\n                    ])\n                ]),\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-manage\",\n                        onClick: _withModifiers(closeManage, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_29, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: closeManage\n                            }, \"×\"),\n                            _createElementVNode(\"div\", _hoisted_30, [\n                                _createElementVNode(\"div\", _hoisted_31, [\n                                    _createElementVNode(\"div\", _hoisted_32, _toDisplayString(manageCard.value.name), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_33, [\n                                        _createElementVNode(\"span\", null, _toDisplayString(manageCard.value.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(manageCard.value).length) + \" 标签\", 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_34, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(manageCard.value), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: tag,\n                                                class: \"cardhub-preview__tag\"\n                                            }, _toDisplayString(tag), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_35, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageOverview.value, (item) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: item.label,\n                                                class: \"cardhub-manage__overview-card\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_36, _toDisplayString(item.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_37, _toDisplayString(item.value), 1 /* TEXT */),\n                                                (item.hint)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_38, _toDisplayString(item.hint), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_39, [\n                                    (manageAvatarUrl.value)\n                                        ? (_openBlock(), _createElementBlock(\"img\", {\n                                            key: 0,\n                                            src: manageAvatarUrl.value,\n                                            alt: \"\"\n                                        }, null, 8 /* PROPS */, _hoisted_40))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_41, [\n                                _cache[38] || (_cache[38] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"角色卡预览\", -1 /* CACHED */)),\n                                (manageDetails.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_42, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageDetails.value, (detail) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: detail.label,\n                                                class: \"cardhub-manage__detail\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_43, _toDisplayString(detail.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_44, _toDisplayString(detail.value), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_45, _toDisplayString(manageDetailsHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_46, [\n                                _cache[39] || (_cache[39] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"开场白\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_47, [\n                                    (manageOpeningLines.value.length)\n                                        ? (_openBlock(true), _createElementBlock(_Fragment, { key: 0 }, _renderList(manageOpeningLines.value, (opening, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__opening\"\n                                            }, _toDisplayString(opening), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                            _createTextVNode(\"暂无开场白\")\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_48, [\n                                _createElementVNode(\"div\", _hoisted_49, [\n                                    _cache[40] || (_cache[40] = _createElementVNode(\"span\", null, \"最近聊天\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_50, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: openLatestChat,\n                                            onPointerdown: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[15] || (_cache[15] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \" 进入最近聊天 \", 32 /* NEED_HYDRATION */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: openNewChat,\n                                            onPointerdown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \" 新聊天 \", 32 /* NEED_HYDRATION */)\n                                    ])\n                                ]),\n                                (manageChats.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_51, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageChats.value, (msg, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__chat-row\",\n                                                role: \"button\",\n                                                tabindex: \"0\",\n                                                onClick: ($event) => (openChat(msg)),\n                                                onKeydown: _withKeys(_withModifiers(($event) => (openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_53, [\n                                                    _createElementVNode(\"div\", _hoisted_54, _toDisplayString(msg.name), 1 /* TEXT */),\n                                                    (msg.label && msg.label !== msg.name)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_55, _toDisplayString(msg.label), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (msg.keywords.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_56, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(msg.keywords, (keyword) => {\n                                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                                    key: keyword,\n                                                                    class: \"cardhub-manage__chat-tag\"\n                                                                }, _toDisplayString(keyword), 1 /* TEXT */));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ]),\n                                                _createElementVNode(\"span\", _hoisted_57, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                            ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_52));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_58, _toDisplayString(manageChatHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_59, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[20] || (_cache[20] = _withModifiers(($event) => (handleCardAction(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[22] || (_cache[22] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"]))\n                                }, _toDisplayString(manageCard.value.origin === 'tavern' ? '导出' : '导入'), 33 /* TEXT, NEED_HYDRATION */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[24] || (_cache[24] = _withModifiers(($event) => (manageDelete(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[25] || (_cache[25] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[26] || (_cache[26] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[27] || (_cache[27] = _withModifiers(() => { }, [\"stop\"]))\n                                }, \" 删除 \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (confirmState.open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-confirm\",\n                        onClick: _cache[31] || (_cache[31] = _withModifiers(($event) => (resolveConfirm('cancel')), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_60, [\n                            _createElementVNode(\"div\", _hoisted_61, _toDisplayString(confirmState.title), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_62, _toDisplayString(confirmState.message), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_63, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-cancel\",\n                                    type: \"button\",\n                                    onClick: _cache[28] || (_cache[28] = ($event) => (resolveConfirm('cancel')))\n                                }, _toDisplayString(confirmState.cancelLabel), 1 /* TEXT */),\n                                (confirmState.altLabel)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"cardhub-confirm__button is-danger\",\n                                        type: \"button\",\n                                        onClick: _cache[29] || (_cache[29] = ($event) => (resolveConfirm('alt')))\n                                    }, _toDisplayString(confirmState.altLabel), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-confirm\",\n                                    type: \"button\",\n                                    onClick: _cache[30] || (_cache[30] = ($event) => (resolveConfirm('confirm')))\n                                }, _toDisplayString(confirmState.confirmLabel), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=fe13b558&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-fe13b558\"]])\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport App from '../ui/App.vue';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet app: ReturnType<typeof createApp> | null = null;\nlet $mount: JQuery<HTMLDivElement> | null = null;\nlet $style: JQuery<HTMLElement> | null = null;\n\nfunction ensureMounted() {\n  if ($mount) {\n    return;\n  }\n\n  $style = $(`<style>`)\n    .attr('data-cardhub-style', getScriptId())\n    .text(`\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: #1b1b1b;\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n        border-radius: 28px;\n        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: #7d5b46;\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(43, 32, 24, 0.12);\n        color: #3b2a20;\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(86, 59, 44, 0.2);\n        padding: 6px 12px;\n        background: #fffaf4;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: #d46b3d;\n        color: #fff;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-button:hover {\n        background: #c55f36;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(106, 63, 42, 0.08);\n        border-color: rgba(106, 63, 42, 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(86, 59, 44, 0.15);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(86, 59, 44, 0.15);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(106, 63, 42, 0.25);\n        background: rgba(255, 255, 255, 0.7);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n        border-color: transparent;\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(106, 63, 42, 0.45);\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(106, 63, 42, 0.35);\n        background: rgba(255, 255, 255, 0.85);\n        color: #6a3f2a;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(106, 63, 42, 0.6);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: #7d5b46;\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(255, 255, 255, 0.78);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(86, 59, 44, 0.15);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(86, 59, 44, 0.25);\n        box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n        background-size: cover;\n        background-position: center;\n        color: #4a2a1f;\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fff6ea;\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: #fffaf4;\n        border-color: rgba(106, 63, 42, 0.5);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(106, 63, 42, 0.5);\n        background: #fffaf4;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: #6a3f2a;\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(106, 63, 42, 0.85);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: #2b2018;\n        color: #fff5ea;\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(43, 32, 24, 0.15);\n        color: #3b2a20;\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(43, 32, 24, 0.25);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fffaf4;\n        font-size: 12px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(255, 255, 255, 0.7);\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: none;\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: #241a14;\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: #d1bca8;\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: #3b2a20;\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(106, 63, 42, 0.08);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: #6a3f2a;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: #9a7a63;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-tag {\n        padding: 2px 6px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        background: rgba(255, 255, 255, 0.75);\n        font-size: 10px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-manage__chat-text {\n        color: #3b2a20;\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        position: absolute;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100002;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: #fff6ea;\n        border-radius: 22px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: #2b2018;\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: #4a2a1f;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: #d46b3d;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: #b6452a;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible {\n        outline: 2px solid rgba(212, 107, 61, 0.6);\n        outline-offset: 2px;\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 14px 16px;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n        }\n\n        .cardhub-title__main {\n          font-size: 20px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 11px;\n        }\n\n        .cardhub-close {\n          width: 28px;\n          height: 28px;\n          font-size: 16px;\n          line-height: 28px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          padding: 10px 14px;\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 13px;\n          padding: 8px 12px;\n        }\n\n        .cardhub-button {\n          flex: 1;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n          padding: 10px 14px;\n          max-height: none;\n          overflow: visible;\n        }\n\n        .cardhub-section-title {\n          font-size: 10px;\n          margin-bottom: 6px;\n        }\n\n        .cardhub-divider {\n          margin: 6px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: wrap;\n          overflow: visible;\n          gap: 6px;\n          padding-bottom: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 5px 10px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 4px 8px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 12px;\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview,\n        .cardhub-manage {\n          position: absolute !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-preview__panel,\n        .cardhub-manage__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n        }\n\n        .cardhub-preview__avatar {\n          height: 180px;\n          border-radius: 14px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-preview__actions {\n          gap: 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-tag {\n          font-size: 9px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n      }\n    `)\n    .appendTo('head');\n\n  $mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  app = createApp(App);\n  app.mount($mount[0]);\n\n  watch(() => cardHubState.open, () => {}, { immediate: true });\n}\n\n\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (app) {\n        app.unmount();\n      }\n      if ($mount) {\n        $mount.remove();\n      }\n      if ($style) {\n        $style.remove();\n      }\n      app = null;\n      $mount = null;\n      $style = null;\n    },\n  };\n}\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["module","exports","Vue","$","toastr","success","window","on","info","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","VueRouter","_hoisted_1","class","__name","setup","__props","display_text","ref","onMounted","character_name","substitudeMacros","message_id","getCurrentMessageId","chat_message","getChatMessages","text","message","match","value","captureDisplayText","_ctx","_cache","tabindex","onClick","$event","$router","push","script","_component_RouterView","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","options","matchAll","map","title","content","replace","option","async","item","createChatMessages","role","triggerSlash","router","createRouter","history","createMemoryHistory","routes","path","component","createApp","use","mount","registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$existing","length","addClass","attr","empty","$anchor","selectors","selector","$target","first","$button","filter","_","el","getAttribute","test","$container","closest","parent","findRoleManagerAnchor","console","warn","openOnce","createOpenOnce","open","event","preventDefault","stopImmediatePropagation","append","bindOpenEvents","off","remove","registerRoleManagerEntry","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","html","entryDisposer","data","setTimeout","observer","MutationObserver","rootDocument","document","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","handler","wrapped","addEventListener","capture","removeEventListener","lastFiredAt","now","Date","fetchCharacterSummaries","st","SillyTavern","ctx","getContext","getCharacters","error","list","characters","idCounts","Map","tagKeyCounts","tagIdToName","Array","isArray","tags","tag","id","name","set","character","index","directTags","avatarKey","avatar","stamp","create_date","date_added","chat","String","tagBaseKey","tagKey","tagCount","get","mappedTags","tagMap","Boolean","from","Set","baseId","count","origin","uuidv4","c","r","Math","random","toString","LIBRARY_KEY","getStorage","type","script_id","writeLibrary","entries","vars","TavernHelper","getVariables","replaceVariables","readFileAsDataUrl","file","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","readFileAsText","readAsText","normalizeName","fileName","stableStringify","JSON","stringify","join","Object","sort","a","b","localeCompare","buildFingerprint","rawType","raw","source","trimmed","trim","parse","hash","i","charCodeAt","hashString","loadLibrary","readLibrary","addToLibrary","files","existingEntries","current","fingerprints","entry","fingerprint","ensureFingerprint","add","nextEntries","toLowerCase","endsWith","dataUrl","has","parsedName","json","merged","removeFromLibrary","entryId","updated","cardHubState","reactive","loading","search","lastOpenSource","library","setOpen","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","direct","mapped","getTagsForAvatar","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","tagIds","tagName","existing","crypto","randomUUID","ensureTag","saveSettingsDebounced","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","selectedTags","activeTagKey","tagInput","statusFilter","pageSize","currentPage","importInput","manageCard","manageOpenings","manageChats","manageOpeningLines","computed","previewOpenings","openings","maxItems","opening","maxLines","contentLines","extractContentLines","slice","normalized","normalizeBriefMessage","chunks","chunkText","combined","chunk","previewOpeningLines","preview","manageRequestId","confirmState","confirmLabel","cancelLabel","altLabel","allCards","manageProfile","manageOpeningSummary","manageChatSummary","manageDetails","profile","details","pushDetail","label","maxChars","lines","truncated","hasMore","previewDetailText","description","personality","scenario","creatorNotes","systemPrompt","postHistory","creator","manageDetailsHint","manageChatHint","manageOverview","items","worldName","worldBookName","worldCount","worldBookCount","worldValue","worldHint","hint","chatValue","chatHint","total","latest","openingValue","openingHint","alternate","filteredCharacters","applyStatusFilter","keyword","applyTagFilter","matcher","input","RegExp","escapeRegExp","flags","pull","indexOf","some","totalPages","ceil","pagedCharacters","start","allTags","tagSet","avatarUrl","useFull","getCharAvatarPath","encodeURIComponent","avatarStyle","url","backgroundImage","displayTags","manageAvatarUrl","includes","clearTagFilter","prevPage","nextPage","normalizeNameKey","toLocaleLowerCase","openConfirm","resolveConfirm","resolver","confirmTag","applyTagUpdate","cancelTagEdit","updateLibraryTags","next","triggerImport","click","handleImportFiles","exportSelected","warning","tagLabel","statusLabel","searchLabel","exportCard","handleCardAction","card","duplicate","findDuplicateCharacterByName","headers","getRequestHeaders","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","fetch","method","cache","importLibraryCard","downloadBlob","Blob","exportLibraryCard","avatarPath","response","openManage","requestId","manageResult","chatsResult","allSettled","resolveManageData","resolveRecentChats","manageData","status","openingSummary","chatData","summary","closeManage","parseJsonSafe","bytes","comma","base64","binary","atob","Uint8Array","dataUrlToBytes","signature","offset","readUint32BE","bytesToString","subarray","dataStart","dataEnd","parseTextChunk","parseIntlTextChunk","extractPngTextChunks","allowedKeys","parsed","parseCardPayload","parsePngCardData","parseLibraryCardData","extractOpeningMessages","extractCardProfile","extractOpeningSummary","findIndex","byName","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","RawCharacter","allowAvatar","primary","nullIndex","compressed","cursor","langEnd","translatedEnd","isLikelyBase64","decoded","TextDecoder","decode","decodeBase64Text","pickString","creatorcomment","creator_notes","system_prompt","post_history_instructions","book","character_book","values","firstCount","alt","alternate_greetings","extensions","formatMaybeTimestamp","Number","isNaN","toLocaleString","hour12","extractChatLatestLabel","candidates","last_message_time","last_message_date","update_time","last_modified","timestamp","time","file_name","file_id","formatChatTitle","formatChatFileLabel","extractChatKeywords","max","keywords","stopWords","bracketMatches","size","wordMatches","word","lower","split","part","filtered","line","startsWith","brief","getChatHistoryBrief","mes","openLatestChat","openChat","openNewChat","selectManageCharacter","ensureSelected","close","selection","normalizeChatId","opener","openCharacterChat","catch","opened","timeoutMs","chatId","waitForChatOpen","findCharacterIndex","selectCharacterById","switchMenu","selected","getCurrentCharacterId","sleep","waitForCharacterSelection","characterId","ms","manageDelete","deleteChoice","moveToLibrary","deleteFromTavern","deleteChats","keys","payload","avatar_url","delete_chats","ok","detail","statusText","URL","createObjectURL","createElement","href","download","appendChild","revokeObjectURL","refresh","watch","placeholder","ref_key","accept","multiple","onChange","disabled","style","nextTick","querySelector","focus","onKeydown","onBlur","onMousedown","onTouchstart","onPointerdown","src","msg","app","$mount","$style","ensureMounted","appendTo","App","immediate","createCardHubController","toggle","refreshCharacters","destroy","unmount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}