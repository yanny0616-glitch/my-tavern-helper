{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","webpack://tavern_helper_template/./src/手机角色状态栏/app.vue?0e5f","webpack://tavern_helper_template/src/手机角色状态栏/app.vue?a1b5","src://tavern_helper_template/src/手机角色状态栏/index.ts","src://tavern_helper_template/src/角色卡管理插件/entry/buttons.ts","src://tavern_helper_template/src/角色卡管理插件/services/characterSource.ts","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/src/角色卡管理插件/services/libraryService.ts","src://tavern_helper_template/src/角色卡管理插件/state/store.ts","src://tavern_helper_template/src/角色卡管理插件/services/tagService.ts","src://tavern_helper_template/src/角色卡管理插件/ui/App.vue","src://tavern_helper_template/src/角色卡管理插件/ui/util/common.ts","webpack://tavern_helper_template/src/角色卡管理插件/ui/App.vue?a8e8","src://tavern_helper_template/src/角色卡管理插件/entry/portal.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src/角色卡管理插件/index.ts"],"sourcesContent":["module.exports = Vue;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = { class: \"scene\" };\nconst _hoisted_2 = { class: \"phone\" };\nconst _hoisted_3 = { class: \"phone-shell\" };\nconst _hoisted_4 = { class: \"phone-bezel\" };\nconst _hoisted_5 = { class: \"screen\" };\nconst _hoisted_6 = {\n    class: \"hero stagger\",\n    style: { \"--delay\": \"2\" }\n};\nconst _hoisted_7 = { class: \"role-meta\" };\nconst _hoisted_8 = { class: \"role-subtitle\" };\nconst _hoisted_9 = {\n    class: \"status-panel stagger\",\n    style: { \"--delay\": \"3\" }\n};\nconst _hoisted_10 = { class: \"panel-header\" };\nconst _hoisted_11 = { class: \"chip\" };\nconst _hoisted_12 = { class: \"stats-grid\" };\nconst _hoisted_13 = { class: \"stat-card\" };\nconst _hoisted_14 = { class: \"value\" };\nconst _hoisted_15 = { class: \"stat-card\" };\nconst _hoisted_16 = { class: \"value\" };\nconst _hoisted_17 = { class: \"stat-card\" };\nconst _hoisted_18 = { class: \"value\" };\nconst _hoisted_19 = { class: \"bars\" };\nconst _hoisted_20 = { class: \"bar\" };\nconst _hoisted_21 = {\n    class: \"chat-panel stagger\",\n    style: { \"--delay\": \"4\" }\n};\nconst _hoisted_22 = { class: \"chat\" };\nconst _hoisted_23 = { class: \"bubble incoming\" };\nimport { computed, ref } from 'vue';\nconst sampleStatus = `<status>\n2024.12.24 周二\n10:00 上午\n古城 主殿\n冬 大雪\n黑色大衣,深灰围巾,牛仔裤,短靴\n站在窗边,单手插兜,指尖轻触玻璃窗\n平静,意外\n「怎么会看到她？」\n</status>`;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const rawText = ref(window.statusText || sampleStatus);\n        function extractLines(text) {\n            const match = text.match(/<status>([\\s\\S]*?)<\\/status>/);\n            const block = match ? match[1] : text;\n            return block\n                .split(/\\r?\\n/)\n                .map(line => line.trim())\n                .filter(Boolean);\n        }\n        const status = computed(() => {\n            const lines = extractLines(rawText.value);\n            let name = '未知角色';\n            const nameIndex = lines.findIndex(line => /^角色[:：]/.test(line));\n            if (nameIndex !== -1) {\n                const match = lines[nameIndex].match(/^角色[:：]\\s*(.+)$/);\n                if (match)\n                    name = match[1].trim();\n                lines.splice(nameIndex, 1);\n            }\n            return {\n                name,\n                date: lines[0] || '----',\n                time: lines[1] || '--:--',\n                location: lines[2] || '未知地点',\n                weather: lines[3] || '天气未知',\n                outfit: lines[4] || '未记录',\n                posture: lines[5] || '未记录',\n                emotions: lines[6] || '平静',\n                thought: lines[7] || '',\n            };\n        });\n        const emotions = computed(() => {\n            const raw = status.value.emotions;\n            const parts = raw\n                .split(/[，,]/)\n                .map(item => item.trim())\n                .filter(Boolean);\n            if (!parts.length) {\n                return [{ name: '平静', value: 50 }];\n            }\n            return parts.map(item => {\n                const match = item.match(/^(.*?)(?:\\s*(\\d+)%|\\s+(\\d+))?$/);\n                const name = match ? match[1].trim() : item;\n                const value = match && (match[2] || match[3]) ? Number(match[2] || match[3]) : 50;\n                return { name, value: Math.min(100, Math.max(0, value)) };\n            });\n        });\n        window.setStatusText = text => {\n            rawText.value = text;\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[19] || (_cache[19] = _createElementVNode(\"div\", { class: \"ambient-layer\" }, null, -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[16] || (_cache[16] = _createElementVNode(\"div\", { class: \"notch\" }, [\n                                _createElementVNode(\"span\", { class: \"camera\" }),\n                                _createElementVNode(\"span\", { class: \"speaker\" })\n                            ], -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _cache[15] || (_cache[15] = _createStaticVNode(\"<header class=\\\"topbar stagger\\\" style=\\\"--delay:1;\\\" data-v-65093584><div class=\\\"time\\\" data-v-65093584>21:48</div><div class=\\\"status-icons\\\" data-v-65093584><span class=\\\"signal\\\" data-v-65093584></span><span class=\\\"wifi\\\" data-v-65093584></span><span class=\\\"battery\\\" data-v-65093584>82%</span></div></header>\", 1)),\n                                _createElementVNode(\"section\", _hoisted_6, [\n                                    _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"avatar-ring\" }, [\n                                        _createElementVNode(\"div\", { class: \"avatar\" }),\n                                        _createElementVNode(\"span\", { class: \"pulse\" })\n                                    ], -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _cache[0] || (_cache[0] = _createElementVNode(\"p\", { class: \"role-title\" }, \"角色状态栏\", -1 /* CACHED */)),\n                                        _createElementVNode(\"h1\", null, _toDisplayString(status.value.name), 1 /* TEXT */),\n                                        _createElementVNode(\"p\", _hoisted_8, \"位置: \" + _toDisplayString(status.value.location) + \" | 时间: \" + _toDisplayString(status.value.date) + \" \" + _toDisplayString(status.value.time), 1 /* TEXT */)\n                                    ]),\n                                    _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"status-pill\" }, \"在线\", -1 /* CACHED */))\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_9, [\n                                    _createElementVNode(\"div\", _hoisted_10, [\n                                        _cache[3] || (_cache[3] = _createElementVNode(\"h2\", null, \"当前状态\", -1 /* CACHED */)),\n                                        _createElementVNode(\"span\", _hoisted_11, _toDisplayString(status.value.weather), 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_12, [\n                                        _createElementVNode(\"div\", _hoisted_13, [\n                                            _cache[4] || (_cache[4] = _createElementVNode(\"span\", { class: \"label\" }, \"天气\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_14, _toDisplayString(status.value.weather), 1 /* TEXT */),\n                                            _cache[5] || (_cache[5] = _createElementVNode(\"span\", { class: \"note\" }, \"环境\", -1 /* CACHED */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_15, [\n                                            _cache[6] || (_cache[6] = _createElementVNode(\"span\", { class: \"label\" }, \"外观\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_16, _toDisplayString(status.value.outfit), 1 /* TEXT */),\n                                            _cache[7] || (_cache[7] = _createElementVNode(\"span\", { class: \"note\" }, \"穿着\", -1 /* CACHED */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_17, [\n                                            _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"label\" }, \"姿态\", -1 /* CACHED */)),\n                                            _createElementVNode(\"span\", _hoisted_18, _toDisplayString(status.value.posture), 1 /* TEXT */),\n                                            _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"note\" }, \"动作\", -1 /* CACHED */))\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_19, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(emotions.value, (emotion) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: emotion.name,\n                                                class: \"bar-row\"\n                                            }, [\n                                                _createElementVNode(\"span\", null, _toDisplayString(emotion.name), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_20, [\n                                                    _createElementVNode(\"i\", {\n                                                        style: _normalizeStyle({ width: `${emotion.value}%` })\n                                                    }, null, 4 /* STYLE */)\n                                                ]),\n                                                _createElementVNode(\"em\", null, _toDisplayString(emotion.value) + \"%\", 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_21, [\n                                    _cache[13] || (_cache[13] = _createElementVNode(\"div\", { class: \"panel-header\" }, [\n                                        _createElementVNode(\"h2\", null, \"聊天界面\"),\n                                        _createElementVNode(\"span\", { class: \"chip\" }, \"3 条新消息\")\n                                    ], -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_22, [\n                                        _createElementVNode(\"div\", _hoisted_23, [\n                                            _createElementVNode(\"p\", null, _toDisplayString(status.value.thought || '我看到了你。今晚别走那么快。'), 1 /* TEXT */),\n                                            _cache[10] || (_cache[10] = _createElementVNode(\"span\", { class: \"stamp\" }, \"19:34\", -1 /* CACHED */))\n                                        ]),\n                                        _cache[11] || (_cache[11] = _createElementVNode(\"div\", { class: \"bubble outgoing\" }, [\n                                            _createElementVNode(\"p\", null, \"我们不熟，请别打扰。\"),\n                                            _createElementVNode(\"span\", { class: \"stamp\" }, \"19:35\")\n                                        ], -1 /* CACHED */)),\n                                        _cache[12] || (_cache[12] = _createElementVNode(\"div\", { class: \"bubble incoming\" }, [\n                                            _createElementVNode(\"p\", null, \"胃不好就别空着，坐回去。\"),\n                                            _createElementVNode(\"span\", { class: \"stamp\" }, \"19:35\")\n                                        ], -1 /* CACHED */))\n                                    ]),\n                                    _cache[14] || (_cache[14] = _createElementVNode(\"div\", { class: \"input-bar\" }, [\n                                        _createElementVNode(\"span\", null, \"输入消息...\"),\n                                        _createElementVNode(\"button\", { class: \"send-btn\" }, \"发送\")\n                                    ], -1 /* CACHED */))\n                                ])\n                            ])\n                        ]),\n                        _cache[17] || (_cache[17] = _createElementVNode(\"div\", { class: \"side-buttons\" }, [\n                            _createElementVNode(\"span\"),\n                            _createElementVNode(\"span\"),\n                            _createElementVNode(\"span\", { class: \"long\" })\n                        ], -1 /* CACHED */))\n                    ]),\n                    _cache[18] || (_cache[18] = _createElementVNode(\"p\", { class: \"device-label\" }, \"手机角色状态栏\", -1 /* CACHED */))\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=65093584&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-65093584\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport app from './app.vue';\n\n$(() => {\n  createApp(app).mount('#app');\n});\n","import type { EntrySource } from '../types';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n};\n\nexport function registerEntryButtons(controller: CardHubController): () => void {\n  const disposers: Array<() => void> = [];\n  const roleDisposer = registerRoleManagerEntry(controller);\n  if (roleDisposer) {\n    disposers.push(roleDisposer);\n  }\n  const magicDisposer = registerMagicMenuEntry(controller);\n  if (magicDisposer) {\n    disposers.push(magicDisposer);\n  }\n  return () => {\n    disposers.forEach(dispose => dispose());\n  };\n}\n\nfunction registerRoleManagerEntry(controller: CardHubController): (() => void) | null {\n  const buttonId = `cardhub-entry-${getScriptId()}`;\n  const $existing = $(`#${buttonId}`);\n  if ($existing.length) {\n    $existing\n      .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n      .attr('title', '打开 CardHub 角色卡管理器')\n      .attr('aria-label', '打开 CardHub 角色卡管理器')\n      .empty();\n    return null;\n  }\n\n  const $anchor = findRoleManagerAnchor();\n  if (!$anchor) {\n    console.warn('[CardHub] 未找到角色管理入口挂载点');\n    return null;\n  }\n\n  const openOnce = createOpenOnce(() => controller.open('role'));\n  const $button = $('<button>')\n    .attr('id', buttonId)\n    .attr('type', 'button')\n    .addClass('menu_button fa-solid fa-rectangle-list cardhub-entry-button')\n    .attr('title', '打开 CardHub 角色卡管理器')\n    .attr('aria-label', '打开 CardHub 角色卡管理器')\n    .on('click pointerup touchend', event => {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      openOnce();\n    });\n\n  $anchor.append($button);\n  const roleDisposer = bindOpenEvents($button[0], openOnce);\n\n  return () => {\n    $button.off('click');\n    $button.remove();\n    roleDisposer();\n  };\n}\n\nfunction findRoleManagerAnchor(): JQuery<HTMLElement> | null {\n  const selectors = [\n    '#rm_button_bar',\n    '#character_panel',\n    '#rightNavBar',\n    '#right-nav-panel',\n    '#character-search',\n    '#top-settings-holder',\n  ];\n\n  for (const selector of selectors) {\n    const $target = $(selector).first();\n    if ($target.length) {\n      return $target;\n    }\n  }\n\n  const $button = $('button, .menu_button, .nav_button')\n    .filter((_, el) => {\n      const text = $(el).text();\n      const title = el.getAttribute('title') ?? el.getAttribute('aria-label') ?? '';\n      return /角色管理/.test(text) || /角色管理/.test(title);\n    })\n    .first();\n\n  if ($button.length) {\n    const $container = $button.closest('nav, header, section, div');\n    return $container.length ? $container : $button.parent();\n  }\n\n  return null;\n}\n\nfunction registerMagicMenuEntry(controller: CardHubController): (() => void) | null {\n  const menuId = `cardhub-magic-${getScriptId()}`;\n  const $magicButton = $('#extensionsMenuButton');\n  if (!$magicButton.length) {\n    console.warn('[CardHub] 未找到左侧魔法棒入口');\n    return null;\n  }\n\n  const onMenuOpen = () => {\n    const $menu = $('#extensionsMenu');\n    if (!$menu || $menu.find(`#${menuId}`).length) {\n      return;\n    }\n\n    const openOnce = createOpenOnce(() => controller.open('magic'));\n    const $entry = $('<div>')\n      .attr('id', menuId)\n      .addClass('list-group-item flex-container flexGap5 interactable cardhub-menu-entry')\n      .attr('role', 'button')\n      .attr('tabindex', '0')\n      .html('<i class=\"fa-solid fa-id-badge\" aria-hidden=\"true\"></i><span>角色卡管理器</span>')\n      .on('click pointerup touchend', event => {\n        event.preventDefault();\n        event.stopImmediatePropagation();\n        openOnce();\n      });\n\n    $menu.append($entry);\n    const entryDisposer = bindOpenEvents($entry[0], openOnce);\n    $entry.data('cardhub-dispose', entryDisposer);\n  };\n\n  $magicButton.on('click.cardhub', () => {\n    setTimeout(onMenuOpen, 0);\n  });\n\n  const observer = new MutationObserver(() => onMenuOpen());\n  const rootDocument = window.parent?.document ?? document;\n  observer.observe(rootDocument.body, { childList: true, subtree: true });\n\n  return () => {\n    observer.disconnect();\n    $magicButton.off('click.cardhub');\n    $(`#${menuId}`).remove();\n  };\n}\n\nfunction bindOpenEvents(target: HTMLElement, handler: () => void): () => void {\n  const wrapped = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    handler();\n  };\n\n  target.addEventListener('pointerdown', wrapped, { capture: true });\n  target.addEventListener('mousedown', wrapped, { capture: true });\n  target.addEventListener('touchstart', wrapped, { capture: true });\n\n  return () => {\n    target.removeEventListener('pointerdown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('mousedown', wrapped, { capture: true } as AddEventListenerOptions);\n    target.removeEventListener('touchstart', wrapped, { capture: true } as AddEventListenerOptions);\n  };\n}\n\nfunction createOpenOnce(handler: () => void): () => void {\n  let lastFiredAt = 0;\n  return () => {\n    const now = Date.now();\n    if (now - lastFiredAt < 250) {\n      return;\n    }\n    lastFiredAt = now;\n    handler();\n  };\n}\n","import type { CardHubItem } from '../types';\n\nexport async function fetchCharacterSummaries(): Promise<CardHubItem[]> {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n  if (typeof ctx?.getCharacters === 'function') {\n    try {\n      await ctx.getCharacters();\n    } catch (error) {\n      console.warn('[CardHub] 读取角色列表失败，将使用缓存数据', error);\n    }\n  }\n\n  const list = ctx?.characters ?? SillyTavern?.characters ?? [];\n  const idCounts = new Map<string, number>();\n  const tagKeyCounts = new Map<string, number>();\n  const tagIdToName = new Map<string, string>();\n  if (Array.isArray(ctx?.tags)) {\n    ctx.tags.forEach(tag => {\n      if (tag?.id && tag?.name) {\n        tagIdToName.set(tag.id, tag.name);\n      }\n    });\n  }\n\n  return list.map((character, index) => {\n    const directTags = character.tags ?? character.data?.tags ?? [];\n    const avatarKey = character.avatar;\n    const name = character.name ?? '未命名角色';\n    const stamp = character.create_date ?? character.date_added ?? character.chat ?? String(index);\n    const tagBaseKey = avatarKey ?? `name:${name}::${stamp}`;\n    let tagKey = tagBaseKey;\n    if (!avatarKey) {\n      const tagCount = tagKeyCounts.get(tagBaseKey) ?? 0;\n      tagKeyCounts.set(tagBaseKey, tagCount + 1);\n      if (tagCount) {\n        tagKey = `${tagBaseKey}::${tagCount}`;\n      }\n    }\n\n    const mappedIds = ctx?.tagMap?.[tagKey] ?? [];\n    const mappedTags = mappedIds.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n    const tags = Array.from(new Set([...directTags, ...mappedTags]));\n    const baseId = avatarKey ? `avatar:${avatarKey}` : `name:${name}::${stamp}`;\n    const count = idCounts.get(baseId) ?? 0;\n    idCounts.set(baseId, count + 1);\n    const id = count ? `${baseId}::${count}` : baseId;\n\n    return {\n      id,\n      name,\n      avatar: character.avatar ?? null,\n      tags,\n      tagKey,\n      origin: 'tavern',\n    };\n  });\n}\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","import { uuidv4 } from '../../../util/common';\nimport type { CardHubItem } from '../types';\n\nconst LIBRARY_KEY = 'cardhub_library';\n\ntype StoredLibrary = {\n  entries: CardHubItem[];\n};\n\nfunction getStorage() {\n  return {\n    type: 'script',\n    script_id: getScriptId(),\n  } as const;\n}\n\nfunction readLibrary(): StoredLibrary {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  const raw = vars?.[LIBRARY_KEY];\n  if (!raw || typeof raw !== 'object') {\n    return { entries: [] };\n  }\n  const entries = Array.isArray((raw as StoredLibrary).entries) ? (raw as StoredLibrary).entries : [];\n  return { entries };\n}\n\nfunction writeLibrary(entries: CardHubItem[]) {\n  const vars = TavernHelper.getVariables(getStorage()) as Record<string, unknown>;\n  TavernHelper.replaceVariables(getStorage(), {\n    ...vars,\n    [LIBRARY_KEY]: { entries },\n  });\n}\n\nfunction readFileAsDataUrl(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsDataURL(file);\n  });\n}\n\nfunction readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(String(reader.result || ''));\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(file);\n  });\n}\n\nfunction normalizeName(fileName: string): string {\n  return fileName.replace(/\\.(png|json)$/i, '');\n}\n\nfunction hashString(value: string): string {\n  let hash = 5381;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = (hash * 33) ^ value.charCodeAt(i);\n  }\n  return (hash >>> 0).toString(16);\n}\n\nfunction stableStringify(value: unknown): string {\n  if (value === null || typeof value !== 'object') {\n    return JSON.stringify(value);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(item => stableStringify(item)).join(',')}]`;\n  }\n  const entries = Object.entries(value as Record<string, unknown>).sort(([a], [b]) =>\n    a.localeCompare(b),\n  );\n  return `{${entries\n    .map(([key, val]) => `${JSON.stringify(key)}:${stableStringify(val)}`)\n    .join(',')}}`;\n}\n\nfunction buildFingerprint(rawType: CardHubItem['rawType'], raw: string): string {\n  let source = raw;\n  if (rawType === 'json') {\n    const trimmed = raw.trim();\n    try {\n      source = stableStringify(JSON.parse(trimmed));\n    } catch {\n      source = trimmed;\n    }\n  }\n  return `${rawType}:${hashString(source)}`;\n}\n\nfunction ensureFingerprint(entry: CardHubItem): string | null {\n  if (entry.fingerprint) {\n    return entry.fingerprint;\n  }\n  if (!entry.rawType || !entry.raw) {\n    return null;\n  }\n  const fingerprint = buildFingerprint(entry.rawType, entry.raw);\n  entry.fingerprint = fingerprint;\n  return fingerprint;\n}\n\nexport function loadLibrary(): CardHubItem[] {\n  return readLibrary().entries;\n}\n\nexport async function addToLibrary(\n  files: FileList | File[],\n  existingEntries?: CardHubItem[],\n): Promise<CardHubItem[]> {\n  const list = Array.from(files);\n  if (!list.length) {\n    return loadLibrary();\n  }\n  const current = Array.isArray(existingEntries) && existingEntries.length\n    ? existingEntries\n    : loadLibrary();\n  const fingerprints = new Set<string>();\n  current.forEach(entry => {\n    const fingerprint = ensureFingerprint(entry);\n    if (fingerprint) {\n      fingerprints.add(fingerprint);\n    }\n  });\n  const nextEntries: CardHubItem[] = [];\n\n  for (const file of list) {\n    const name = normalizeName(file.name);\n    if (file.name.toLowerCase().endsWith('.png')) {\n      const dataUrl = await readFileAsDataUrl(file);\n      const fingerprint = buildFingerprint('png', dataUrl);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name,\n        avatar: dataUrl,\n        tags: [],\n        origin: 'library',\n        rawType: 'png',\n        raw: dataUrl,\n        fingerprint,\n      });\n    } else if (file.name.toLowerCase().endsWith('.json')) {\n      const text = await readFileAsText(file);\n      let parsedName = name;\n      try {\n        const json = JSON.parse(text) as { name?: string; data?: { name?: string } };\n        parsedName = json.name ?? json.data?.name ?? parsedName;\n      } catch {\n        // ignore invalid json name parsing\n      }\n      const fingerprint = buildFingerprint('json', text);\n      if (fingerprints.has(fingerprint)) {\n        continue;\n      }\n      fingerprints.add(fingerprint);\n      nextEntries.push({\n        id: uuidv4(),\n        name: parsedName,\n        avatar: null,\n        tags: [],\n        origin: 'library',\n        rawType: 'json',\n        raw: text,\n        fingerprint,\n      });\n    }\n  }\n\n  const merged = [...current, ...nextEntries];\n  writeLibrary(merged);\n  return merged;\n}\n\nexport function updateLibraryTags(entryId: string, tags: string[]): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.map(entry => {\n    if (entry.id !== entryId) {\n      return entry;\n    }\n    return { ...entry, tags };\n  });\n  writeLibrary(updated);\n  return updated;\n}\n\nexport function removeFromLibrary(entryId: string): CardHubItem[] {\n  const current = loadLibrary();\n  const updated = current.filter(entry => entry.id !== entryId);\n  writeLibrary(updated);\n  return updated;\n}\n\n","import { reactive } from 'vue';\nimport type { CardHubItem, EntrySource } from '../types';\n\ntype CardHubState = {\n  open: boolean;\n  loading: boolean;\n  search: string;\n  lastOpenSource: EntrySource;\n  characters: CardHubItem[];\n  library: CardHubItem[];\n};\n\nexport const cardHubState = reactive<CardHubState>({\n  open: false,\n  loading: false,\n  search: '',\n  lastOpenSource: 'manual',\n  characters: [],\n  library: [],\n});\n\nexport function setOpen(open: boolean, source?: EntrySource) {\n  cardHubState.open = open;\n  if (source) {\n    cardHubState.lastOpenSource = source;\n  }\n}\n\nexport function setLoading(loading: boolean) {\n  cardHubState.loading = loading;\n}\n\nexport function setSearch(search: string) {\n  cardHubState.search = search;\n}\n\nexport function setCharacters(characters: CardHubItem[]) {\n  cardHubState.characters = characters;\n}\n\nexport function setLibrary(library: CardHubItem[]) {\n  cardHubState.library = library;\n}\n","import type { CardHubItem } from '../types';\n\ntype TagItem = {\n  id: string;\n  name: string;\n};\n\ntype TagStore = {\n  tags?: TagItem[];\n  tagMap?: Record<string, string[]>;\n  characters?: Array<{\n    name?: string;\n    avatar?: string | null;\n    tags?: string[];\n    data?: { tags?: string[] };\n  }>;\n  saveSettingsDebounced?: () => void;\n};\n\nfunction getContext(): TagStore | null {\n  let st: typeof SillyTavern | undefined;\n  try {\n    st = window.parent?.SillyTavern;\n  } catch {\n    st = undefined;\n  }\n  st ??= SillyTavern;\n  if (typeof st?.getContext !== 'function') {\n    return null;\n  }\n  return st.getContext() as TagStore;\n}\n\nfunction normalizeTagName(name: string): string {\n  return name.trim().replace(/\\s+/g, ' ');\n}\n\nfunction ensureTagStore(ctx: TagStore) {\n  if (!Array.isArray(ctx.tags)) {\n    ctx.tags = [];\n  }\n  if (!ctx.tagMap) {\n    ctx.tagMap = {};\n  }\n}\n\nfunction ensureTag(ctx: TagStore, tagName: string): TagItem {\n  ensureTagStore(ctx);\n  const existing = ctx.tags!.find(tag => tag.name === tagName);\n  if (existing) {\n    return existing;\n  }\n  const id = typeof crypto?.randomUUID === 'function' ? crypto.randomUUID() : `tag-${Date.now()}`;\n  const tag: TagItem = {\n    id,\n    name: tagName,\n  };\n  ctx.tags!.push({\n    id: tag.id,\n    name: tag.name,\n  });\n  return tag;\n}\n\nfunction findCharacter(ctx: TagStore, target: CardHubItem) {\n  if (!Array.isArray(ctx.characters)) {\n    return null;\n  }\n  const byAvatar = target.avatar\n    ? ctx.characters.find(character => character.avatar === target.avatar)\n    : null;\n  if (byAvatar) {\n    return byAvatar;\n  }\n  return ctx.characters.find(character => character.name === target.name) ?? null;\n}\n\nexport function getAllTagsFromContext(): string[] {\n  const ctx = getContext();\n  if (!ctx || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  return ctx.tags.map(tag => tag.name).filter(Boolean);\n}\n\nexport function getTagsForAvatar(tagKey: string | null | undefined): string[] {\n  if (!tagKey) {\n    return [];\n  }\n  const ctx = getContext();\n  if (!ctx || !ctx.tagMap || !Array.isArray(ctx.tags)) {\n    return [];\n  }\n  const tagIdToName = new Map<string, string>();\n  ctx.tags.forEach(tag => {\n    if (tag?.id && tag?.name) {\n      tagIdToName.set(tag.id, tag.name);\n    }\n  });\n  const ids = ctx.tagMap[tagKey] ?? [];\n  return ids.map(id => tagIdToName.get(id)).filter(Boolean) as string[];\n}\n\nexport function getMergedTags(target: CardHubItem): string[] {\n  if (target.origin === 'library') {\n    return target.tags ?? [];\n  }\n  const direct = target.tags ?? [];\n  const mapped = getTagsForAvatar(target.tagKey ?? target.avatar);\n  return Array.from(new Set([...direct, ...mapped]));\n}\n\nexport function updateCharacterTags(target: CardHubItem, nextTags: string[]): string[] {\n  const ctx = getContext();\n  if (!ctx) {\n    return nextTags;\n  }\n  const character = findCharacter(ctx, target);\n  if (!character) {\n    return nextTags;\n  }\n  const cleaned = Array.from(\n    new Set(nextTags.map(tag => normalizeTagName(tag)).filter(Boolean)),\n  );\n\n  character.tags = cleaned;\n  if (character.data) {\n    character.data.tags = cleaned;\n  }\n\n  ensureTagStore(ctx);\n  const tagIds = cleaned.map(tag => ensureTag(ctx, tag).id);\n  const tagKey = target.tagKey ?? character.avatar ?? null;\n  if (tagKey) {\n    ctx.tagMap![tagKey] = tagIds;\n  }\n\n  ctx.saveSettingsDebounced?.();\n\n  return cleaned;\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, withModifiers as _withModifiers, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n    class: \"cardhub-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"CardHub 角色卡管理器\"\n};\nconst _hoisted_2 = { class: \"cardhub-toolbar\" };\nconst _hoisted_3 = { class: \"cardhub-body\" };\nconst _hoisted_4 = { class: \"cardhub-sidebar\" };\nconst _hoisted_5 = { class: \"cardhub-chip-row\" };\nconst _hoisted_6 = { class: \"cardhub-tag-filter\" };\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = { class: \"cardhub-content\" };\nconst _hoisted_9 = {\n    key: 0,\n    class: \"cardhub-loading\"\n};\nconst _hoisted_10 = {\n    key: 1,\n    class: \"cardhub-empty\"\n};\nconst _hoisted_11 = {\n    key: 2,\n    class: \"cardhub-grid-wrap\"\n};\nconst _hoisted_12 = { class: \"cardhub-pagination\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"cardhub-pagination__actions\"\n};\nconst _hoisted_14 = [\"disabled\"];\nconst _hoisted_15 = [\"disabled\"];\nconst _hoisted_16 = { class: \"cardhub-pagination__status\" };\nconst _hoisted_17 = { class: \"cardhub-grid\" };\nconst _hoisted_18 = [\"onClick\"];\nconst _hoisted_19 = { class: \"cardhub-card__info\" };\nconst _hoisted_20 = { class: \"cardhub-card__name\" };\nconst _hoisted_21 = { class: \"cardhub-card__meta\" };\nconst _hoisted_22 = { class: \"cardhub-card__tags\" };\nconst _hoisted_23 = [\"onClick\"];\nconst _hoisted_24 = [\"onClick\"];\nconst _hoisted_25 = [\"onKeydown\", \"onBlur\"];\nconst _hoisted_26 = { class: \"cardhub-card__actions\" };\nconst _hoisted_27 = [\"onClick\"];\nconst _hoisted_28 = [\"onClick\"];\nconst _hoisted_29 = {\n    class: \"cardhub-manage__panel\",\n    role: \"dialog\",\n    \"aria-label\": \"角色管理\"\n};\nconst _hoisted_30 = { class: \"cardhub-manage__top\" };\nconst _hoisted_31 = { class: \"cardhub-manage__summary\" };\nconst _hoisted_32 = { class: \"cardhub-preview__name\" };\nconst _hoisted_33 = { class: \"cardhub-preview__meta\" };\nconst _hoisted_34 = { class: \"cardhub-preview__tags\" };\nconst _hoisted_35 = { class: \"cardhub-manage__overview\" };\nconst _hoisted_36 = { class: \"cardhub-manage__overview-label\" };\nconst _hoisted_37 = { class: \"cardhub-manage__overview-value\" };\nconst _hoisted_38 = {\n    key: 0,\n    class: \"cardhub-manage__overview-hint\"\n};\nconst _hoisted_39 = { class: \"cardhub-manage__media\" };\nconst _hoisted_40 = [\"src\"];\nconst _hoisted_41 = { class: \"cardhub-manage__section\" };\nconst _hoisted_42 = {\n    key: 0,\n    class: \"cardhub-manage__details\"\n};\nconst _hoisted_43 = { class: \"cardhub-manage__detail-label\" };\nconst _hoisted_44 = { class: \"cardhub-manage__detail-content\" };\nconst _hoisted_45 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_46 = { class: \"cardhub-manage__section\" };\nconst _hoisted_47 = { class: \"cardhub-manage__content\" };\nconst _hoisted_48 = { class: \"cardhub-manage__section\" };\nconst _hoisted_49 = { class: \"cardhub-manage__label\" };\nconst _hoisted_50 = { class: \"cardhub-manage__jump-row\" };\nconst _hoisted_51 = {\n    key: 0,\n    class: \"cardhub-manage__chat\"\n};\nconst _hoisted_52 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_53 = { class: \"cardhub-manage__chat-main\" };\nconst _hoisted_54 = { class: \"cardhub-manage__chat-name\" };\nconst _hoisted_55 = {\n    key: 0,\n    class: \"cardhub-manage__chat-label\"\n};\nconst _hoisted_56 = {\n    key: 1,\n    class: \"cardhub-manage__chat-tags\"\n};\nconst _hoisted_57 = { class: \"cardhub-manage__chat-text\" };\nconst _hoisted_58 = {\n    key: 1,\n    class: \"cardhub-manage__empty\"\n};\nconst _hoisted_59 = { class: \"cardhub-manage__actions\" };\nconst _hoisted_60 = {\n    class: \"cardhub-confirm__panel\",\n    role: \"dialog\",\n    \"aria-modal\": \"true\"\n};\nconst _hoisted_61 = { class: \"cardhub-confirm__title\" };\nconst _hoisted_62 = { class: \"cardhub-confirm__message\" };\nconst _hoisted_63 = { class: \"cardhub-confirm__actions\" };\nimport { computed, nextTick, reactive, ref, watch } from 'vue';\nimport { cardHubState as state, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { regexFromString } from './util/common';\nimport { addToLibrary, loadLibrary, removeFromLibrary, updateLibraryTags } from '../services/libraryService';\nimport { getMergedTags, updateCharacterTags } from '../services/tagService';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const selectedTags = ref([]);\n        const activeTagKey = ref(null);\n        const tagInput = ref('');\n        const statusFilter = ref('all');\n        const pageSize = ref(24);\n        const currentPage = ref(1);\n        const importInput = ref(null);\n        const manageCard = ref(null);\n        const manageOpenings = ref([]);\n        const manageChats = ref([]);\n        const manageOpeningLines = computed(() => previewOpenings(manageOpenings.value, 3));\n        let manageRequestId = 0;\n        const confirmState = reactive({\n            open: false,\n            title: '',\n            message: '',\n            confirmLabel: '确定',\n            cancelLabel: '取消',\n            altLabel: '',\n            resolve: null,\n        });\n        const allCards = computed(() => [...state.characters, ...state.library]);\n        const manageProfile = ref(null);\n        const manageOpeningSummary = ref(null);\n        const manageChatSummary = ref(null);\n        const manageDetails = computed(() => {\n            const profile = manageProfile.value;\n            if (!profile) {\n                return [];\n            }\n            const details = [];\n            const pushDetail = (label, value, maxChars = 240) => {\n                const preview = previewDetailText(value, 3, maxChars);\n                if (preview) {\n                    details.push({ label, value: preview });\n                }\n            };\n            pushDetail('角色描述', profile.description ?? '');\n            pushDetail('性格', profile.personality ?? '');\n            pushDetail('场景', profile.scenario ?? '');\n            pushDetail('创作者备注', profile.creatorNotes ?? '');\n            pushDetail('系统提示', profile.systemPrompt ?? '', 200);\n            pushDetail('历史指令', profile.postHistory ?? '', 200);\n            pushDetail('作者', profile.creator ?? '', 80);\n            return details;\n        });\n        const manageDetailsHint = computed(() => {\n            if (!manageCard.value || manageDetails.value.length) {\n                return '';\n            }\n            if (manageCard.value.origin === 'library') {\n                return '未导入卡片暂无可预览内容，可先导入后查看详情。';\n            }\n            return '暂无角色卡详情。';\n        });\n        const manageChatHint = computed(() => {\n            if (manageCard.value?.origin === 'library') {\n                return '未导入卡片暂无聊天记录。';\n            }\n            return '暂无聊天记录。';\n        });\n        const manageOverview = computed(() => {\n            const items = [];\n            const profile = manageProfile.value;\n            const worldName = profile?.worldBookName?.trim() || '';\n            const worldCount = profile?.worldBookCount;\n            let worldValue = '未绑定';\n            let worldHint = '';\n            if (worldName || typeof worldCount === 'number') {\n                worldValue = worldName || '角色世界书';\n                worldHint = typeof worldCount === 'number' ? `${worldCount} 条` : '';\n            }\n            items.push({ label: '世界书', value: worldValue, hint: worldHint });\n            const chat = manageChatSummary.value;\n            let chatValue = '暂无聊天';\n            let chatHint = '';\n            if (chat && chat.total > 0) {\n                chatValue = `${chat.total} 个聊天`;\n                if (chat.latest) {\n                    chatHint = `最近：${chat.latest}`;\n                }\n            }\n            items.push({ label: '聊天概况', value: chatValue, hint: chatHint });\n            const opening = manageOpeningSummary.value;\n            let openingValue = '暂无开场白';\n            let openingHint = '';\n            if (opening && opening.total > 0) {\n                openingValue = `${opening.total} 条`;\n                openingHint = opening.alternate > 0 ? `替代：${opening.alternate} 条` : '无替代';\n            }\n            items.push({ label: '开场白', value: openingValue, hint: openingHint });\n            return items;\n        });\n        const filteredCharacters = computed(() => {\n            const list = applyStatusFilter(allCards.value);\n            const keyword = state.search.trim();\n            if (!keyword) {\n                return applyTagFilter(list);\n            }\n            const matcher = regexFromString(keyword) ?? new RegExp(_.escapeRegExp(keyword), 'i');\n            return applyTagFilter(list).filter(character => {\n                return matcher.test(character.name) || character.tags.some(tag => matcher.test(tag));\n            });\n        });\n        const totalPages = computed(() => {\n            const total = Math.ceil(filteredCharacters.value.length / pageSize.value);\n            return total > 0 ? total : 1;\n        });\n        const pagedCharacters = computed(() => {\n            const start = (currentPage.value - 1) * pageSize.value;\n            return filteredCharacters.value.slice(start, start + pageSize.value);\n        });\n        const allTags = computed(() => {\n            const tagSet = new Set();\n            allCards.value.forEach(character => {\n                getMergedTags(character).forEach(tag => tagSet.add(tag));\n            });\n            selectedTags.value.forEach(tag => tagSet.add(tag));\n            return Array.from(tagSet).sort((a, b) => a.localeCompare(b, 'zh-CN'));\n        });\n        function avatarUrl(character, useFull = false) {\n            const avatar = character.avatar;\n            if (!avatar) {\n                return null;\n            }\n            if (/^(data:|https?:|\\/)/.test(avatar)) {\n                return avatar;\n            }\n            if (useFull && character.origin === 'tavern') {\n                return TavernHelper.getCharAvatarPath(avatar, true) ?? `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n            }\n            return `/thumbnail?type=avatar&file=${encodeURIComponent(avatar)}`;\n        }\n        function avatarStyle(character) {\n            const url = avatarUrl(character);\n            return url ? { backgroundImage: `url(${url})` } : {};\n        }\n        function displayTags(character) {\n            return getMergedTags(character);\n        }\n        const manageAvatarUrl = computed(() => {\n            if (!manageCard.value) {\n                return null;\n            }\n            return avatarUrl(manageCard.value, true);\n        });\n        function applyStatusFilter(list) {\n            if (statusFilter.value === 'imported') {\n                return list.filter(item => item.origin === 'tavern');\n            }\n            if (statusFilter.value === 'unimported') {\n                return list.filter(item => item.origin === 'library');\n            }\n            return list;\n        }\n        function applyTagFilter(list) {\n            if (!selectedTags.value.length) {\n                return list;\n            }\n            return list.filter(character => selectedTags.value.some(tag => getMergedTags(character).includes(tag)));\n        }\n        function toggleTagFilter(tag) {\n            if (selectedTags.value.includes(tag)) {\n                selectedTags.value = selectedTags.value.filter(item => item !== tag);\n            }\n            else {\n                selectedTags.value = [...selectedTags.value, tag];\n            }\n        }\n        function clearTagFilter() {\n            selectedTags.value = [];\n        }\n        watch([() => state.search, statusFilter, () => selectedTags.value.join('|')], () => {\n            currentPage.value = 1;\n        });\n        watch([filteredCharacters, totalPages], () => {\n            if (currentPage.value > totalPages.value) {\n                currentPage.value = totalPages.value;\n            }\n            if (currentPage.value < 1) {\n                currentPage.value = 1;\n            }\n        });\n        function prevPage() {\n            if (currentPage.value > 1) {\n                currentPage.value -= 1;\n            }\n        }\n        function nextPage() {\n            if (currentPage.value < totalPages.value) {\n                currentPage.value += 1;\n            }\n        }\n        function normalizeNameKey(value) {\n            return value.trim().toLocaleLowerCase();\n        }\n        function findDuplicateCharacterByName(name) {\n            const target = normalizeNameKey(name);\n            if (!target) {\n                return null;\n            }\n            return state.characters.find(item => normalizeNameKey(item.name) === target) ?? null;\n        }\n        function openConfirm(options) {\n            if (confirmState.open && confirmState.resolve) {\n                confirmState.resolve('cancel');\n            }\n            confirmState.title = options.title ?? '确认操作';\n            confirmState.message = options.message;\n            confirmState.confirmLabel = options.confirmLabel ?? '确定';\n            confirmState.cancelLabel = options.cancelLabel ?? '取消';\n            confirmState.altLabel = options.altLabel ?? '';\n            confirmState.open = true;\n            return new Promise(resolve => {\n                confirmState.resolve = resolve;\n            });\n        }\n        function resolveConfirm(result) {\n            if (!confirmState.open) {\n                return;\n            }\n            confirmState.open = false;\n            const resolver = confirmState.resolve;\n            confirmState.resolve = null;\n            if (resolver) {\n                resolver(result);\n            }\n        }\n        function removeTag(character, tag) {\n            const nextTags = getMergedTags(character).filter(item => item !== tag);\n            applyTagUpdate(character, nextTags);\n        }\n        function tagKey(character) {\n            return character.id;\n        }\n        function startTagEdit(character) {\n            activeTagKey.value = tagKey(character);\n            tagInput.value = '';\n            nextTick(() => {\n                const input = document.querySelector('.cardhub-tag-input');\n                input?.focus();\n            });\n        }\n        function confirmTag(character) {\n            if (activeTagKey.value !== tagKey(character)) {\n                return;\n            }\n            const input = tagInput.value.trim();\n            if (input) {\n                const nextTags = [...getMergedTags(character), input];\n                applyTagUpdate(character, nextTags);\n            }\n            cancelTagEdit();\n        }\n        function cancelTagEdit() {\n            activeTagKey.value = null;\n            tagInput.value = '';\n        }\n        function applyTagUpdate(character, nextTags) {\n            if (character.origin === 'library') {\n                const updatedLibrary = updateLibraryTags(character.id, nextTags);\n                setLibrary(updatedLibrary);\n            }\n            else {\n                const next = updateCharacterTags(character, nextTags);\n                character.tags = next;\n                setCharacters([...state.characters]);\n            }\n        }\n        function triggerImport() {\n            importInput.value?.click();\n        }\n        async function handleImportFiles(event) {\n            const target = event.target;\n            const files = target?.files;\n            if (!files || !files.length) {\n                return;\n            }\n            const updated = await addToLibrary(files, state.library);\n            setLibrary(updated);\n            target.value = '';\n        }\n        async function exportSelected() {\n            const list = filteredCharacters.value;\n            if (!list.length) {\n                toastr.warning('当前没有可导出的角色卡');\n                return;\n            }\n            const tagLabel = selectedTags.value.length ? selectedTags.value.join('、') : '无';\n            const statusLabel = statusFilter.value === 'all'\n                ? '全部'\n                : statusFilter.value === 'imported'\n                    ? '已导入'\n                    : '未导入';\n            const searchLabel = state.search.trim() || '无';\n            const message = `将导出 ${list.length} 张角色卡。\\n` +\n                `筛选状态：${statusLabel}\\n` +\n                `筛选标签：${tagLabel}\\n` +\n                `搜索关键字：${searchLabel}\\n` +\n                `是否继续？`;\n            const result = await openConfirm({\n                title: '批量导出',\n                message,\n                confirmLabel: '继续导出',\n                cancelLabel: '取消',\n            });\n            if (result !== 'confirm') {\n                return;\n            }\n            list.forEach(item => exportCard(item));\n        }\n        async function handleCardAction(card) {\n            if (card.origin === 'library') {\n                await importLibraryCard(card);\n            }\n            else {\n                exportCard(card);\n            }\n        }\n        async function importLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('缺少导入数据');\n                return;\n            }\n            const duplicate = findDuplicateCharacterByName(card.name);\n            if (duplicate) {\n                toastr.warning(`已存在同名角色「${duplicate.name}」，已跳过导入`);\n                return;\n            }\n            const headers = (SillyTavern?.getRequestHeaders ? SillyTavern.getRequestHeaders() : {});\n            delete headers['Content-Type'];\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                await TavernHelper.importRawCharacter(card.name, blob);\n            }\n            else {\n                const file = new File([card.raw], `${card.name}.json`, { type: 'application/json' });\n                const form = new FormData();\n                form.append('avatar', file);\n                form.append('file_type', 'json');\n                form.append('preserved_name', file.name);\n                await fetch('/api/characters/import', {\n                    method: 'POST',\n                    headers,\n                    body: form,\n                    cache: 'no-cache',\n                });\n            }\n            setLibrary(removeFromLibrary(card.id));\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n            toastr.success(`已导入 ${card.name}`);\n        }\n        async function exportCard(card) {\n            if (card.origin === 'library') {\n                await exportLibraryCard(card);\n                return;\n            }\n            if (!card.avatar) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            downloadBlob(blob, `${card.name}.png`);\n        }\n        async function exportLibraryCard(card) {\n            if (!card.raw || !card.rawType) {\n                toastr.error('无法导出：缺少原始数据');\n                return;\n            }\n            if (card.rawType === 'png') {\n                const blob = await dataUrlToBlob(card.raw);\n                downloadBlob(blob, `${card.name}.png`);\n                return;\n            }\n            const blob = new Blob([card.raw], { type: 'application/json' });\n            downloadBlob(blob, `${card.name}.json`);\n        }\n        async function openManage(card) {\n            const requestId = ++manageRequestId;\n            manageCard.value = card;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n            const [manageResult, chatsResult] = await Promise.allSettled([\n                resolveManageData(card),\n                resolveRecentChats(card),\n            ]);\n            if (requestId !== manageRequestId || manageCard.value?.id !== card.id) {\n                return;\n            }\n            const manageData = manageResult.status === 'fulfilled'\n                ? manageResult.value\n                : { openings: [], profile: null, openingSummary: null };\n            manageOpenings.value = manageData.openings;\n            manageProfile.value = manageData.profile;\n            manageOpeningSummary.value = manageData.openingSummary;\n            const chatData = chatsResult.status === 'fulfilled'\n                ? chatsResult.value\n                : { list: [], summary: null };\n            manageChats.value = chatData.list;\n            manageChatSummary.value = chatData.summary;\n        }\n        function closeManage() {\n            manageCard.value = null;\n            manageOpenings.value = [];\n            manageChats.value = [];\n            manageProfile.value = null;\n            manageOpeningSummary.value = null;\n            manageChatSummary.value = null;\n        }\n        async function resolveManageData(card) {\n            if (card.origin !== 'tavern') {\n                const data = parseLibraryCardData(card);\n                return {\n                    openings: extractOpeningMessages(data),\n                    profile: extractCardProfile(data),\n                    openingSummary: extractOpeningSummary(data),\n                };\n            }\n            const raw = await getFullCharacterData(card);\n            const fallback = raw ??\n                TavernHelper.RawCharacter?.find({ name: card.avatar ?? card.name, allowAvatar: true }) ??\n                TavernHelper.RawCharacter?.find({ name: card.name, allowAvatar: true });\n            const primary = raw ?? fallback;\n            let openings = extractOpeningMessages(primary);\n            if (!openings.length && fallback && fallback !== primary) {\n                openings = extractOpeningMessages(fallback);\n            }\n            const openingSummary = extractOpeningSummary(primary ?? fallback);\n            return {\n                openings,\n                profile: extractCardProfile(primary ?? fallback),\n                openingSummary,\n            };\n        }\n        function parseLibraryCardData(card) {\n            if (!card.raw || !card.rawType) {\n                return null;\n            }\n            if (card.rawType === 'json') {\n                return parseJsonSafe(card.raw);\n            }\n            if (card.rawType === 'png') {\n                return parsePngCardData(card.raw);\n            }\n            return null;\n        }\n        function parseJsonSafe(raw) {\n            try {\n                return JSON.parse(raw);\n            }\n            catch {\n                return null;\n            }\n        }\n        function parsePngCardData(dataUrl) {\n            const bytes = dataUrlToBytes(dataUrl);\n            if (!bytes) {\n                return null;\n            }\n            const chunks = extractPngTextChunks(bytes);\n            const allowedKeys = new Set(['chara', 'character', 'tavern', 'tavern_character', 'card']);\n            for (const chunk of chunks) {\n                if (chunk.key && !allowedKeys.has(chunk.key.toLowerCase())) {\n                    continue;\n                }\n                const parsed = parseCardPayload(chunk.value);\n                if (parsed) {\n                    return parsed;\n                }\n            }\n            return null;\n        }\n        function dataUrlToBytes(dataUrl) {\n            const comma = dataUrl.indexOf(',');\n            if (comma < 0) {\n                return null;\n            }\n            const base64 = dataUrl.slice(comma + 1);\n            try {\n                const binary = atob(base64);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return bytes;\n            }\n            catch {\n                return null;\n            }\n        }\n        function extractPngTextChunks(bytes) {\n            if (bytes.length < 8) {\n                return [];\n            }\n            const signature = [137, 80, 78, 71, 13, 10, 26, 10];\n            for (let i = 0; i < signature.length; i += 1) {\n                if (bytes[i] !== signature[i]) {\n                    return [];\n                }\n            }\n            const chunks = [];\n            let offset = 8;\n            while (offset + 8 <= bytes.length) {\n                const length = readUint32BE(bytes, offset);\n                const type = bytesToString(bytes.subarray(offset + 4, offset + 8));\n                const dataStart = offset + 8;\n                const dataEnd = dataStart + length;\n                if (dataEnd + 4 > bytes.length) {\n                    break;\n                }\n                const data = bytes.subarray(dataStart, dataEnd);\n                if (type === 'tEXt') {\n                    const entry = parseTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                else if (type === 'iTXt') {\n                    const entry = parseIntlTextChunk(data);\n                    if (entry) {\n                        chunks.push(entry);\n                    }\n                }\n                offset = dataEnd + 4;\n            }\n            return chunks;\n        }\n        function parseTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const value = bytesToString(data.subarray(nullIndex + 1)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseIntlTextChunk(data) {\n            const nullIndex = data.indexOf(0);\n            if (nullIndex < 0 || nullIndex + 2 >= data.length) {\n                return null;\n            }\n            const key = bytesToString(data.subarray(0, nullIndex)).trim();\n            const compressed = data[nullIndex + 1] === 1;\n            let cursor = nullIndex + 2;\n            const langEnd = data.indexOf(0, cursor);\n            if (langEnd < 0) {\n                return null;\n            }\n            cursor = langEnd + 1;\n            const translatedEnd = data.indexOf(0, cursor);\n            if (translatedEnd < 0) {\n                return null;\n            }\n            cursor = translatedEnd + 1;\n            if (compressed) {\n                return null;\n            }\n            const value = bytesToString(data.subarray(cursor)).trim();\n            if (!key || !value) {\n                return null;\n            }\n            return { key, value };\n        }\n        function parseCardPayload(value) {\n            const trimmed = value.trim();\n            if (!trimmed) {\n                return null;\n            }\n            const direct = parseJsonSafe(trimmed);\n            if (direct) {\n                return direct;\n            }\n            if (!isLikelyBase64(trimmed)) {\n                return null;\n            }\n            const decoded = decodeBase64Text(trimmed);\n            if (!decoded) {\n                return null;\n            }\n            return parseJsonSafe(decoded);\n        }\n        function decodeBase64Text(value) {\n            try {\n                const binary = atob(value);\n                const bytes = new Uint8Array(binary.length);\n                for (let i = 0; i < binary.length; i += 1) {\n                    bytes[i] = binary.charCodeAt(i);\n                }\n                return new TextDecoder().decode(bytes);\n            }\n            catch {\n                return null;\n            }\n        }\n        function isLikelyBase64(value) {\n            if (value.length < 16 || value.length % 4 !== 0) {\n                return false;\n            }\n            return /^[A-Za-z0-9+/=]+$/.test(value);\n        }\n        function readUint32BE(bytes, offset) {\n            return ((bytes[offset] << 24) |\n                (bytes[offset + 1] << 16) |\n                (bytes[offset + 2] << 8) |\n                bytes[offset + 3]) >>> 0;\n        }\n        function bytesToString(bytes) {\n            return new TextDecoder().decode(bytes);\n        }\n        async function getFullCharacterData(card) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (ctx?.getCharacters) {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色卡列表失败', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            if (!list.length) {\n                return null;\n            }\n            const byAvatar = card.avatar\n                ? list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar)\n                : -1;\n            const byName = list.findIndex(item => item.name === card.name);\n            const idx = byAvatar >= 0 ? byAvatar : byName;\n            if (idx < 0) {\n                return null;\n            }\n            if (ctx?.unshallowCharacter) {\n                try {\n                    await ctx.unshallowCharacter(idx);\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡详情失败', error);\n                }\n            }\n            const updatedList = ctx?.characters ?? list;\n            const data = updatedList[idx] ?? null;\n            if (data?.first_mes || data?.data?.first_mes) {\n                return data;\n            }\n            if (ctx?.getCharacterCardFields) {\n                try {\n                    const fields = await ctx.getCharacterCardFields({ chid: idx });\n                    if (fields?.first_mes || fields?.data?.first_mes) {\n                        return fields;\n                    }\n                }\n                catch (error) {\n                    console.warn('[CardHub] 读取角色卡字段失败', error);\n                }\n            }\n            const fallback = TavernHelper.getCharData(card.avatar ?? card.name, true);\n            return fallback ?? data;\n        }\n        function extractCardProfile(data) {\n            if (!data) {\n                return null;\n            }\n            const profile = {\n                description: pickString(data?.description, data?.data?.description),\n                personality: pickString(data?.personality, data?.data?.personality),\n                scenario: pickString(data?.scenario, data?.data?.scenario),\n                creatorNotes: pickString(data?.creatorcomment, data?.data?.creatorcomment, data?.creator_notes, data?.data?.creator_notes),\n                systemPrompt: pickString(data?.system_prompt, data?.data?.system_prompt),\n                postHistory: pickString(data?.post_history_instructions, data?.data?.post_history_instructions),\n                creator: pickString(data?.creator, data?.data?.creator),\n            };\n            const book = data?.character_book ?? data?.data?.character_book;\n            if (book) {\n                profile.worldBookName = pickString(book?.name);\n                profile.worldBookCount = Array.isArray(book?.entries) ? book.entries.length : undefined;\n            }\n            const hasValue = Boolean(profile.description) ||\n                Boolean(profile.personality) ||\n                Boolean(profile.scenario) ||\n                Boolean(profile.creatorNotes) ||\n                Boolean(profile.systemPrompt) ||\n                Boolean(profile.postHistory) ||\n                Boolean(profile.creator) ||\n                Boolean(profile.worldBookName) ||\n                typeof profile.worldBookCount === 'number';\n            return hasValue ? profile : null;\n        }\n        function pickString(...values) {\n            for (const value of values) {\n                if (typeof value === 'string') {\n                    const trimmed = value.trim();\n                    if (trimmed) {\n                        return trimmed;\n                    }\n                }\n            }\n            return '';\n        }\n        function extractOpeningSummary(data) {\n            if (!data) {\n                return null;\n            }\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            const firstCount = typeof first === 'string' && first.trim() ? 1 : 0;\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            let alternate = 0;\n            if (Array.isArray(alt)) {\n                alternate = alt.filter(item => typeof item === 'string' && item.trim()).length;\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                alternate = 1;\n            }\n            return {\n                total: firstCount + alternate,\n                alternate,\n            };\n        }\n        function extractOpeningMessages(data) {\n            if (!data) {\n                return [];\n            }\n            const list = [];\n            const first = typeof data?.first_mes === 'string' ? data.first_mes : data?.data?.first_mes;\n            if (typeof first === 'string' && first.trim()) {\n                list.push(first.trim());\n            }\n            const alt = data?.alternate_greetings ??\n                data?.data?.alternate_greetings ??\n                data?.extensions?.alternate_greetings ??\n                data?.data?.extensions?.alternate_greetings;\n            if (Array.isArray(alt)) {\n                alt.forEach(item => {\n                    if (typeof item === 'string' && item.trim()) {\n                        list.push(item.trim());\n                    }\n                });\n            }\n            else if (typeof alt === 'string' && alt.trim()) {\n                list.push(alt.trim());\n            }\n            return list;\n        }\n        function normalizeBriefMessage(value) {\n            return value\n                .replace(/<br\\s*\\/?>/gi, ' ')\n                .replace(/<[^>]+>/g, ' ')\n                .replace(/\\s+/g, ' ')\n                .trim();\n        }\n        function formatMaybeTimestamp(value) {\n            if (typeof value === 'number' && !Number.isNaN(value)) {\n                const ms = value < 1e12 ? value * 1000 : value;\n                return new Date(ms).toLocaleString('zh-CN', { hour12: false });\n            }\n            if (typeof value === 'string') {\n                const trimmed = value.trim();\n                if (trimmed) {\n                    return trimmed;\n                }\n            }\n            return '';\n        }\n        function extractChatLatestLabel(entry) {\n            const candidates = [\n                entry?.last_message_time,\n                entry?.last_message_date,\n                entry?.update_time,\n                entry?.last_modified,\n                entry?.create_date,\n                entry?.timestamp,\n                entry?.time,\n            ];\n            for (const value of candidates) {\n                const label = formatMaybeTimestamp(value);\n                if (label) {\n                    return label;\n                }\n            }\n            const fallback = pickString(entry?.file_name, entry?.file_id);\n            if (!fallback) {\n                return '';\n            }\n            return fallback.replace(/\\.jsonl$/i, '');\n        }\n        function formatChatTitle(entry) {\n            const label = extractChatLatestLabel(entry);\n            return label || '聊天记录';\n        }\n        function formatChatFileLabel(entry) {\n            const raw = pickString(entry?.file_name, entry?.file_id);\n            if (!raw) {\n                return '';\n            }\n            return raw.replace(/\\.jsonl$/i, '');\n        }\n        function extractChatKeywords(value, max = 3) {\n            const normalized = normalizeBriefMessage(value);\n            if (!normalized) {\n                return [];\n            }\n            const keywords = new Set();\n            const stopWords = new Set([\n                'the',\n                'and',\n                'you',\n                'your',\n                'are',\n                'this',\n                'that',\n                'with',\n                'have',\n                'not',\n                'for',\n                'from',\n                'what',\n                'why',\n                'when',\n                'where',\n                'then',\n                'into',\n                'out',\n                'here',\n                'there',\n                '这个',\n                '那个',\n                '我们',\n                '你们',\n                '他们',\n                '她们',\n                '因为',\n                '但是',\n                '然后',\n                '如果',\n                '可以',\n                '没有',\n                '不是',\n                '已经',\n                '现在',\n                '一个',\n                '一些',\n                '还有',\n                '所以',\n                '这种',\n            ]);\n            const bracketMatches = normalized.match(/\\[[^\\]]{2,16}\\]/g) ?? [];\n            for (const match of bracketMatches) {\n                const cleaned = match.slice(1, -1).trim();\n                if (cleaned) {\n                    keywords.add(cleaned);\n                }\n                if (keywords.size >= max) {\n                    return Array.from(keywords).slice(0, max);\n                }\n            }\n            const wordMatches = normalized.match(/[\\u4e00-\\u9fa5]{2,}|[A-Za-z0-9]{3,}/g) ?? [];\n            for (const word of wordMatches) {\n                const lower = word.toLowerCase();\n                if (stopWords.has(word) || stopWords.has(lower)) {\n                    continue;\n                }\n                keywords.add(word);\n                if (keywords.size >= max) {\n                    break;\n                }\n            }\n            return Array.from(keywords).slice(0, max);\n        }\n        function previewDetailText(text, maxLines, maxChars) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return '';\n            }\n            const lines = extractContentLines(trimmed);\n            const source = lines.length ? lines : chunkText(normalizeBriefMessage(trimmed), 60);\n            let preview = source.slice(0, maxLines).join('\\n').trim();\n            if (!preview) {\n                return '';\n            }\n            const truncated = preview.length > maxChars;\n            if (truncated) {\n                preview = preview.slice(0, maxChars).trim();\n            }\n            const hasMore = truncated || source.length > maxLines || trimmed.length > preview.length;\n            if (hasMore && !preview.endsWith('…')) {\n                preview = `${preview}…`;\n            }\n            return preview;\n        }\n        function previewOpenings(openings, maxItems) {\n            return openings\n                .map(opening => previewOpeningLines(opening, 2).join('\\n'))\n                .filter(preview => preview.trim().length > 0)\n                .slice(0, maxItems);\n        }\n        function previewOpeningLines(text, maxLines) {\n            const trimmed = text.replace(/\\r/g, '').trim();\n            if (!trimmed) {\n                return [];\n            }\n            const contentLines = extractContentLines(trimmed);\n            if (contentLines.length >= maxLines) {\n                return contentLines.slice(0, maxLines);\n            }\n            const normalized = normalizeBriefMessage(trimmed);\n            if (!normalized) {\n                return contentLines.slice(0, maxLines);\n            }\n            const chunks = chunkText(normalized, 60);\n            if (!contentLines.length) {\n                return chunks.slice(0, maxLines);\n            }\n            const combined = [...contentLines];\n            for (const chunk of chunks) {\n                if (combined.length >= maxLines) {\n                    break;\n                }\n                if (combined[0] !== chunk) {\n                    combined.push(chunk);\n                }\n            }\n            return combined.slice(0, maxLines);\n        }\n        function extractContentLines(text) {\n            const lines = text\n                .split('\\n')\n                .map(part => part.trim())\n                .filter(part => part.length > 0);\n            const filtered = [];\n            for (const line of lines) {\n                if (line.startsWith('```')) {\n                    continue;\n                }\n                if (/^<\\/?(html|head|body|meta|title|script|style|!doctype)\\b/i.test(line)) {\n                    continue;\n                }\n                filtered.push(line);\n            }\n            return filtered;\n        }\n        function chunkText(text, size) {\n            const chunks = [];\n            for (let i = 0; i < text.length; i += size) {\n                const chunk = text.slice(i, i + size).trim();\n                if (chunk) {\n                    chunks.push(chunk);\n                }\n            }\n            return chunks;\n        }\n        async function resolveRecentChats(card) {\n            if (card.origin !== 'tavern') {\n                return { list: [], summary: null };\n            }\n            const brief = await TavernHelper.getChatHistoryBrief(card.avatar ?? card.name, true);\n            if (!Array.isArray(brief) || !brief.length) {\n                return { list: [], summary: { total: 0, latest: '' } };\n            }\n            const list = brief.slice(0, 3).map((entry) => ({\n                name: formatChatTitle(entry),\n                label: formatChatFileLabel(entry),\n                file: String(entry?.file_name ?? entry?.file_id ?? ''),\n                mes: normalizeBriefMessage(String(entry?.mes ?? '')).slice(0, 120),\n                keywords: extractChatKeywords(String(entry?.mes ?? '')),\n            }));\n            const latest = extractChatLatestLabel(brief[0]);\n            return {\n                list,\n                summary: {\n                    total: brief.length,\n                    latest,\n                },\n            };\n        }\n        async function openLatestChat() {\n            if (!manageChats.value.length) {\n                toastr.warning('暂无聊天记录');\n                return;\n            }\n            await openChat(manageChats.value[0]);\n        }\n        async function openNewChat() {\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            try {\n                await triggerSlash('/newchat');\n                closeManage();\n                close();\n            }\n            catch (error) {\n                console.warn('[CardHub] 新聊天失败', error);\n                toastr.error('无法创建新聊天');\n            }\n        }\n        async function openChat(chat) {\n            const file = chat.file;\n            if (!file) {\n                toastr.warning('未找到聊天文件');\n                return;\n            }\n            const selection = await selectManageCharacter({ ensureSelected: true });\n            if (!selection) {\n                return;\n            }\n            const { ctx, st } = selection;\n            const target = normalizeChatId(file);\n            const opener = (ctx && typeof ctx.openCharacterChat === 'function' ? ctx.openCharacterChat : null) ??\n                (st && typeof st.openCharacterChat === 'function' ? st.openCharacterChat : null);\n            if (!opener) {\n                toastr.error('无法打开聊天：缺少接口');\n                return;\n            }\n            try {\n                void Promise.resolve(opener(target)).catch(error => {\n                    console.warn('[CardHub] 打开聊天失败', error);\n                });\n            }\n            catch (error) {\n                console.warn('[CardHub] 打开聊天失败', error);\n            }\n            const opened = await waitForChatOpen(target, ctx, st, 6000);\n            if (opened) {\n                closeManage();\n                close();\n                return;\n            }\n            toastr.warning('未能打开聊天，可能需要先手动切到该角色');\n        }\n        async function selectManageCharacter(options = {}) {\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            if (typeof ctx?.getCharacters === 'function') {\n                try {\n                    await ctx.getCharacters();\n                }\n                catch (error) {\n                    console.warn('[CardHub] 刷新角色列表失败', error);\n                }\n            }\n            const list = ctx?.characters ?? st?.characters ?? [];\n            const idx = manageCard.value && Array.isArray(list) ? findCharacterIndex(list, manageCard.value) : -1;\n            if (idx < 0) {\n                toastr.warning('未找到角色索引，请先手动切到该角色后再试');\n                return null;\n            }\n            const selector = (ctx && typeof ctx.selectCharacterById === 'function' ? ctx.selectCharacterById : null) ??\n                (st && typeof st.selectCharacterById === 'function' ? st.selectCharacterById : null);\n            if (!selector) {\n                toastr.warning('无法切换角色，请先手动切到该角色后再试');\n                return null;\n            }\n            try {\n                await selector(idx, { switchMenu: false });\n            }\n            catch (error) {\n                console.warn('[CardHub] 切换角色失败', error);\n            }\n            const selected = await waitForCharacterSelection(idx, ctx, st, 3000);\n            if (options.ensureSelected && !selected) {\n                toastr.warning('角色切换未完成，请稍后再试');\n                return null;\n            }\n            return { ctx, st, idx };\n        }\n        async function waitForCharacterSelection(idx, ctx, st, timeoutMs) {\n            const target = String(idx);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = getCurrentCharacterId(ctx, st);\n                if (current === target) {\n                    return true;\n                }\n                await sleep(80);\n            }\n            return false;\n        }\n        function getCurrentCharacterId(ctx, st) {\n            const value = ctx?.characterId ?? st?.characterId ?? '';\n            return value === undefined || value === null ? '' : String(value);\n        }\n        function sleep(ms) {\n            return new Promise(resolve => setTimeout(resolve, ms));\n        }\n        function findCharacterIndex(list, card) {\n            if (card.avatar) {\n                const byAvatar = list.findIndex(item => item.avatar === card.avatar || item.name === card.avatar);\n                if (byAvatar >= 0) {\n                    return byAvatar;\n                }\n            }\n            return list.findIndex(item => item.name === card.name);\n        }\n        function normalizeChatId(id) {\n            return id.endsWith('.jsonl') ? id : `${id}.jsonl`;\n        }\n        async function waitForChatOpen(file, ctx, st, timeoutMs) {\n            const target = normalizeChatId(file);\n            const start = Date.now();\n            while (Date.now() - start < timeoutMs) {\n                const current = ctx?.chatId ?? st?.chatId;\n                if (current === target) {\n                    return true;\n                }\n                await new Promise(resolve => setTimeout(resolve, 200));\n            }\n            return false;\n        }\n        async function manageDelete(card) {\n            if (card.origin === 'library') {\n                const confirmDelete = await openConfirm({\n                    title: '删除角色',\n                    message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n                    confirmLabel: '删除',\n                    cancelLabel: '取消',\n                });\n                if (confirmDelete !== 'confirm') {\n                    return;\n                }\n                setLibrary(removeFromLibrary(card.id));\n                closeManage();\n                return;\n            }\n            const confirmDelete = await openConfirm({\n                title: '删除角色',\n                message: `确定要删除「${card.name}」吗？`,\n                confirmLabel: '继续',\n                cancelLabel: '取消',\n            });\n            if (confirmDelete !== 'confirm') {\n                return;\n            }\n            const deleteChoice = await openConfirm({\n                title: '删除方式',\n                message: `删除「${card.name}」：\\n` +\n                    `- 移到私有库：可在私有库中找回\\n` +\n                    `- 永久删除：不可恢复`,\n                confirmLabel: '移到私有库',\n                altLabel: '永久删除',\n                cancelLabel: '取消',\n            });\n            if (deleteChoice === 'cancel') {\n                return;\n            }\n            if (deleteChoice === 'confirm') {\n                await moveToLibrary(card);\n                const deleted = await deleteFromTavern(card, false);\n                if (!deleted) {\n                    return;\n                }\n                closeManage();\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                return;\n            }\n            const confirmPermanent = await openConfirm({\n                title: '永久删除',\n                message: `确认永久删除「${card.name}」？此操作不可恢复。`,\n                confirmLabel: '永久删除',\n                cancelLabel: '取消',\n            });\n            if (confirmPermanent !== 'confirm') {\n                return;\n            }\n            const deleted = await deleteFromTavern(card, true);\n            if (!deleted) {\n                return;\n            }\n            closeManage();\n            const characters = await fetchCharacterSummaries();\n            setCharacters(characters);\n        }\n        async function moveToLibrary(card) {\n            if (!card.avatar) {\n                return;\n            }\n            const avatarPath = TavernHelper.getCharAvatarPath(card.avatar);\n            if (!avatarPath) {\n                toastr.error('无法导出：缺少头像信息');\n                return;\n            }\n            const response = await fetch(avatarPath, { cache: 'no-cache' });\n            const blob = await response.blob();\n            const updated = await addToLibrary([\n                new File([blob], `${card.name}.png`, { type: 'image/png' }),\n            ]);\n            setLibrary(updated);\n        }\n        async function deleteFromTavern(card, deleteChats) {\n            if (!card.avatar) {\n                toastr.error('删除失败：缺少头像信息');\n                return false;\n            }\n            let st;\n            try {\n                st = window.parent?.SillyTavern;\n            }\n            catch {\n                st = undefined;\n            }\n            st ??= SillyTavern;\n            const ctx = typeof st?.getContext === 'function' ? st.getContext() : null;\n            const headers = (ctx?.getRequestHeaders ? ctx.getRequestHeaders() : st?.getRequestHeaders?.());\n            if (!headers || !Object.keys(headers).length) {\n                toastr.error('删除失败：无法获取请求头');\n                return false;\n            }\n            const payload = { avatar_url: card.avatar, delete_chats: deleteChats };\n            const response = await fetch('/api/characters/delete', {\n                method: 'POST',\n                headers: { ...headers, 'Content-Type': 'application/json' },\n                body: JSON.stringify(payload),\n                cache: 'no-cache',\n            });\n            if (response.ok) {\n                return true;\n            }\n            const detail = await response.text();\n            toastr.error(`删除失败：${response.status} ${detail || response.statusText}`);\n            return false;\n        }\n        function downloadBlob(blob, fileName) {\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            URL.revokeObjectURL(url);\n        }\n        async function dataUrlToBlob(dataUrl) {\n            const response = await fetch(dataUrl);\n            return await response.blob();\n        }\n        async function refresh() {\n            setLoading(true);\n            try {\n                const characters = await fetchCharacterSummaries();\n                setCharacters(characters);\n                setLibrary(loadLibrary());\n            }\n            finally {\n                setLoading(false);\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"cardhub-root\", { open: _unref(state).open }])\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"cardhub-backdrop\",\n                    onClick: close\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", { class: \"cardhub-header\" }, [\n                        _cache[33] || (_cache[33] = _createElementVNode(\"div\", { class: \"cardhub-title\" }, [\n                            _createElementVNode(\"span\", { class: \"cardhub-title__main\" }, \"CardHub\"),\n                            _createElementVNode(\"span\", { class: \"cardhub-title__sub\" }, \"角色卡管理器\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"cardhub-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-close\",\n                                type: \"button\",\n                                \"aria-label\": \"关闭\",\n                                onClick: close\n                            }, [...(_cache[32] || (_cache[32] = [\n                                    _createElementVNode(\"span\", { \"aria-hidden\": \"true\" }, \"×\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(state).search) = $event)),\n                            class: \"cardhub-search\",\n                            type: \"search\",\n                            placeholder: \"搜索角色名或标签\"\n                        }, null, 512 /* NEED_PATCH */), [\n                            [_vModelText, _unref(state).search]\n                        ]),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button\",\n                            type: \"button\",\n                            onClick: refresh\n                        }, \"刷新\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: triggerImport\n                        }, \"导入\"),\n                        _createElementVNode(\"button\", {\n                            class: \"cardhub-button is-ghost\",\n                            type: \"button\",\n                            onClick: exportSelected\n                        }, \"批量导出\"),\n                        _createElementVNode(\"input\", {\n                            ref_key: \"importInput\",\n                            ref: importInput,\n                            class: \"cardhub-import-input\",\n                            type: \"file\",\n                            accept: \".png,.json\",\n                            multiple: \"\",\n                            onChange: handleImportFiles\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"div\", _hoisted_4, [\n                            _cache[34] || (_cache[34] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"分类\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_5, [\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'all' }]),\n                                    type: \"button\",\n                                    onClick: _cache[1] || (_cache[1] = ($event) => (statusFilter.value = 'all'))\n                                }, \" 全部 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'imported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[2] || (_cache[2] = ($event) => (statusFilter.value = 'imported'))\n                                }, \" 已导入 \", 2 /* CLASS */),\n                                _createElementVNode(\"button\", {\n                                    class: _normalizeClass([\"cardhub-chip\", { 'is-active': statusFilter.value === 'unimported' }]),\n                                    type: \"button\",\n                                    onClick: _cache[3] || (_cache[3] = ($event) => (statusFilter.value = 'unimported'))\n                                }, \" 未导入 \", 2 /* CLASS */)\n                            ]),\n                            _cache[35] || (_cache[35] = _createElementVNode(\"div\", { class: \"cardhub-divider\" }, null, -1 /* CACHED */)),\n                            _cache[36] || (_cache[36] = _createElementVNode(\"div\", { class: \"cardhub-section-title\" }, \"标签\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allTags.value, (tag) => {\n                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                        key: tag,\n                                        class: _normalizeClass([\"cardhub-tag-filter__chip\", { 'is-active': selectedTags.value.includes(tag) }]),\n                                        type: \"button\",\n                                        onClick: ($event) => (toggleTagFilter(tag))\n                                    }, _toDisplayString(tag), 11 /* TEXT, CLASS, PROPS */, _hoisted_7));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ]),\n                            (selectedTags.value.length)\n                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                    key: 0,\n                                    class: \"cardhub-chip cardhub-chip--clear\",\n                                    type: \"button\",\n                                    onClick: clearTagFilter\n                                }, \" 清空标签 \"))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_8, [\n                            (_unref(state).loading)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"正在读取角色卡...\"))\n                                : (!filteredCharacters.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \" 暂无角色卡，或没有匹配的搜索结果。 \"))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                        _createElementVNode(\"div\", _hoisted_12, [\n                                            (totalPages.value > 1)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value <= 1,\n                                                        onClick: prevPage\n                                                    }, \" 上一页 \", 8 /* PROPS */, _hoisted_14),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"cardhub-pagination__button\",\n                                                        type: \"button\",\n                                                        disabled: currentPage.value >= totalPages.value,\n                                                        onClick: nextPage\n                                                    }, \" 下一页 \", 8 /* PROPS */, _hoisted_15)\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"span\", _hoisted_16, \"第 \" + _toDisplayString(currentPage.value) + \" / \" + _toDisplayString(totalPages.value) + \" 页\", 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_17, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(pagedCharacters.value, (character) => {\n                                                return (_openBlock(), _createElementBlock(\"article\", {\n                                                    key: character.id,\n                                                    class: \"cardhub-card\",\n                                                    onClick: ($event) => (openManage(character))\n                                                }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: _normalizeClass([\"cardhub-card__avatar\", { 'has-avatar': Boolean(avatarUrl(character)) }]),\n                                                        style: _normalizeStyle(avatarStyle(character))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(character.name.slice(0, 1) || '?'), 1 /* TEXT */)\n                                                    ], 6 /* CLASS, STYLE */),\n                                                    _createElementVNode(\"div\", _hoisted_19, [\n                                                        _createElementVNode(\"div\", _hoisted_20, _toDisplayString(character.name), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_21, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(character.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(displayTags(character).length) + \" 标签\", 1 /* TEXT */)\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_22, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(character), (tag) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: tag,\n                                                                    class: \"cardhub-tag\",\n                                                                    type: \"button\",\n                                                                    title: \"点击移除标签\",\n                                                                    onClick: _withModifiers(($event) => (removeTag(character, tag)), [\"stop\"])\n                                                                }, [\n                                                                    _createTextVNode(_toDisplayString(tag) + \" \", 1 /* TEXT */),\n                                                                    _cache[37] || (_cache[37] = _createElementVNode(\"span\", { class: \"cardhub-tag__remove\" }, \"×\", -1 /* CACHED */))\n                                                                ], 8 /* PROPS */, _hoisted_23));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (activeTagKey.value !== tagKey(character))\n                                                                ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: 0,\n                                                                    class: \"cardhub-tag is-add\",\n                                                                    type: \"button\",\n                                                                    onClick: _withModifiers(($event) => (startTagEdit(character)), [\"stop\"])\n                                                                }, \" + 标签 \", 8 /* PROPS */, _hoisted_24))\n                                                                : _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                                                                    key: 1,\n                                                                    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((tagInput).value = $event)),\n                                                                    class: \"cardhub-tag-input\",\n                                                                    type: \"text\",\n                                                                    placeholder: \"新标签\",\n                                                                    onKeydown: [\n                                                                        _withKeys(_withModifiers(($event) => (confirmTag(character)), [\"prevent\"]), [\"enter\"]),\n                                                                        _withKeys(_withModifiers(cancelTagEdit, [\"prevent\"]), [\"esc\"])\n                                                                    ],\n                                                                    onBlur: ($event) => (confirmTag(character)),\n                                                                    onClick: _cache[5] || (_cache[5] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onMousedown: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"])),\n                                                                    onTouchstart: _cache[7] || (_cache[7] = _withModifiers(() => { }, [\"stop\"]))\n                                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_25)), [\n                                                                    [_vModelText, tagInput.value]\n                                                                ])\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_26, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action is-secondary\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (handleCardAction(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[8] || (_cache[8] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[9] || (_cache[9] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[10] || (_cache[10] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, _toDisplayString(character.origin === 'tavern' ? '导出' : '导入'), 41 /* TEXT, PROPS, NEED_HYDRATION */, _hoisted_27),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"cardhub-card__action\",\n                                                            type: \"button\",\n                                                            onClick: _withModifiers(($event) => (openManage(character)), [\"stop\"]),\n                                                            onPointerdown: _cache[11] || (_cache[11] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onMousedown: _cache[12] || (_cache[12] = _withModifiers(() => { }, [\"stop\"])),\n                                                            onTouchstart: _cache[13] || (_cache[13] = _withModifiers(() => { }, [\"stop\"]))\n                                                        }, \" 管理 \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_28)\n                                                    ])\n                                                ], 8 /* PROPS */, _hoisted_18));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ])\n                                    ]))\n                        ])\n                    ])\n                ]),\n                (manageCard.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"cardhub-manage\",\n                        onClick: _withModifiers(closeManage, [\"self\"])\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_29, [\n                            _createElementVNode(\"button\", {\n                                class: \"cardhub-preview__close\",\n                                type: \"button\",\n                                onClick: closeManage\n                            }, \"×\"),\n                            _createElementVNode(\"div\", _hoisted_30, [\n                                _createElementVNode(\"div\", _hoisted_31, [\n                                    _createElementVNode(\"div\", _hoisted_32, _toDisplayString(manageCard.value.name), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_33, [\n                                        _createElementVNode(\"span\", null, _toDisplayString(manageCard.value.origin === 'tavern' ? '已导入' : '未导入'), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(displayTags(manageCard.value).length) + \" 标签\", 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_34, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(displayTags(manageCard.value), (tag) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: tag,\n                                                class: \"cardhub-preview__tag\"\n                                            }, _toDisplayString(tag), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_35, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageOverview.value, (item) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: item.label,\n                                                class: \"cardhub-manage__overview-card\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_36, _toDisplayString(item.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_37, _toDisplayString(item.value), 1 /* TEXT */),\n                                                (item.hint)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_38, _toDisplayString(item.hint), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_39, [\n                                    (manageAvatarUrl.value)\n                                        ? (_openBlock(), _createElementBlock(\"img\", {\n                                            key: 0,\n                                            src: manageAvatarUrl.value,\n                                            alt: \"\"\n                                        }, null, 8 /* PROPS */, _hoisted_40))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_41, [\n                                _cache[38] || (_cache[38] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"角色卡预览\", -1 /* CACHED */)),\n                                (manageDetails.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_42, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageDetails.value, (detail) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: detail.label,\n                                                class: \"cardhub-manage__detail\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_43, _toDisplayString(detail.label), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", _hoisted_44, _toDisplayString(detail.value), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_45, _toDisplayString(manageDetailsHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_46, [\n                                _cache[39] || (_cache[39] = _createElementVNode(\"div\", { class: \"cardhub-manage__label\" }, \"开场白\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_47, [\n                                    (manageOpeningLines.value.length)\n                                        ? (_openBlock(true), _createElementBlock(_Fragment, { key: 0 }, _renderList(manageOpeningLines.value, (opening, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__opening\"\n                                            }, _toDisplayString(opening), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                            _createTextVNode(\"暂无开场白\")\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_48, [\n                                _createElementVNode(\"div\", _hoisted_49, [\n                                    _cache[40] || (_cache[40] = _createElementVNode(\"span\", null, \"最近聊天\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_50, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-primary\",\n                                            type: \"button\",\n                                            onClick: openLatestChat,\n                                            onPointerdown: _cache[14] || (_cache[14] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[15] || (_cache[15] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[16] || (_cache[16] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \" 进入最近聊天 \", 32 /* NEED_HYDRATION */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"cardhub-manage__btn is-secondary\",\n                                            type: \"button\",\n                                            onClick: openNewChat,\n                                            onPointerdown: _cache[17] || (_cache[17] = _withModifiers(() => { }, [\"stop\"])),\n                                            onMousedown: _cache[18] || (_cache[18] = _withModifiers(() => { }, [\"stop\"])),\n                                            onTouchstart: _cache[19] || (_cache[19] = _withModifiers(() => { }, [\"stop\"]))\n                                        }, \" 新聊天 \", 32 /* NEED_HYDRATION */)\n                                    ])\n                                ]),\n                                (manageChats.value.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_51, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(manageChats.value, (msg, index) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: index,\n                                                class: \"cardhub-manage__chat-row\",\n                                                role: \"button\",\n                                                tabindex: \"0\",\n                                                onClick: ($event) => (openChat(msg)),\n                                                onKeydown: _withKeys(_withModifiers(($event) => (openChat(msg)), [\"prevent\"]), [\"enter\"])\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_53, [\n                                                    _createElementVNode(\"div\", _hoisted_54, _toDisplayString(msg.name), 1 /* TEXT */),\n                                                    (msg.label && msg.label !== msg.name)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_55, _toDisplayString(msg.label), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (msg.keywords.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_56, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(msg.keywords, (keyword) => {\n                                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                                    key: keyword,\n                                                                    class: \"cardhub-manage__chat-tag\"\n                                                                }, _toDisplayString(keyword), 1 /* TEXT */));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ]),\n                                                _createElementVNode(\"span\", _hoisted_57, _toDisplayString(msg.mes), 1 /* TEXT */)\n                                            ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_52));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_58, _toDisplayString(manageChatHint.value), 1 /* TEXT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_59, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-secondary\",\n                                    type: \"button\",\n                                    onClick: _cache[20] || (_cache[20] = _withModifiers(($event) => (handleCardAction(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[21] || (_cache[21] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[22] || (_cache[22] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[23] || (_cache[23] = _withModifiers(() => { }, [\"stop\"]))\n                                }, _toDisplayString(manageCard.value.origin === 'tavern' ? '导出' : '导入'), 33 /* TEXT, NEED_HYDRATION */),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-manage__btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[24] || (_cache[24] = _withModifiers(($event) => (manageDelete(manageCard.value)), [\"stop\"])),\n                                    onPointerdown: _cache[25] || (_cache[25] = _withModifiers(() => { }, [\"stop\"])),\n                                    onMousedown: _cache[26] || (_cache[26] = _withModifiers(() => { }, [\"stop\"])),\n                                    onTouchstart: _cache[27] || (_cache[27] = _withModifiers(() => { }, [\"stop\"]))\n                                }, \" 删除 \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (confirmState.open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"cardhub-confirm\",\n                        onClick: _cache[31] || (_cache[31] = _withModifiers(($event) => (resolveConfirm('cancel')), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_60, [\n                            _createElementVNode(\"div\", _hoisted_61, _toDisplayString(confirmState.title), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_62, _toDisplayString(confirmState.message), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_63, [\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-cancel\",\n                                    type: \"button\",\n                                    onClick: _cache[28] || (_cache[28] = ($event) => (resolveConfirm('cancel')))\n                                }, _toDisplayString(confirmState.cancelLabel), 1 /* TEXT */),\n                                (confirmState.altLabel)\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"cardhub-confirm__button is-danger\",\n                                        type: \"button\",\n                                        onClick: _cache[29] || (_cache[29] = ($event) => (resolveConfirm('alt')))\n                                    }, _toDisplayString(confirmState.altLabel), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"button\", {\n                                    class: \"cardhub-confirm__button is-confirm\",\n                                    type: \"button\",\n                                    onClick: _cache[30] || (_cache[30] = ($event) => (resolveConfirm('confirm')))\n                                }, _toDisplayString(confirmState.confirmLabel), 1 /* TEXT */)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","import { compare } from 'compare-versions';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return new RegExp(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return new RegExp(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return new RegExp(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=fe13b558&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-fe13b558\"]])\n\nexport default __exports__","import { createApp, watch } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport { fetchCharacterSummaries } from '../services/characterSource';\nimport { loadLibrary } from '../services/libraryService';\nimport { cardHubState, setCharacters, setLibrary, setLoading, setOpen } from '../state/store';\nimport type { EntrySource } from '../types';\nimport App from '../ui/App.vue';\n\ntype CardHubController = {\n  open: (source?: EntrySource) => void;\n  close: () => void;\n  toggle: (source?: EntrySource) => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet app: ReturnType<typeof createApp> | null = null;\nlet $mount: JQuery<HTMLDivElement> | null = null;\nlet $style: JQuery<HTMLElement> | null = null;\n\nfunction ensureMounted() {\n  if ($mount) {\n    return;\n  }\n\n  $style = $(`<style>`)\n    .attr('data-cardhub-style', getScriptId())\n    .text(`\n      .cardhub-root {\n        position: fixed;\n        inset: 0;\n        z-index: 9999;\n        font-family: \"ZCOOL XiaoWei\", \"STSong\", \"Songti SC\", \"SimSun\", serif;\n        color: #1b1b1b;\n        display: none;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-root.open {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .cardhub-backdrop {\n        position: absolute;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.4);\n        backdrop-filter: blur(6px);\n        opacity: 0;\n        transition: opacity 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-backdrop {\n        opacity: 1;\n      }\n\n      .cardhub-panel {\n        position: relative;\n        width: min(980px, 94%);\n        max-height: 92%;\n        background: linear-gradient(160deg, #fff9f0, #f3e4d4);\n        border-radius: 28px;\n        box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        z-index: 1;\n        opacity: 0;\n        transform: translateY(8px) scale(0.985);\n        transition: opacity 180ms ease, transform 180ms ease;\n      }\n\n      .cardhub-root.open .cardhub-panel {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n\n      .cardhub-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid rgba(86, 59, 44, 0.15);\n      }\n\n      .cardhub-title__main {\n        font-size: 26px;\n        letter-spacing: 2px;\n      }\n\n      .cardhub-title__sub {\n        font-size: 12px;\n        color: #7d5b46;\n        margin-left: 10px;\n      }\n\n      .cardhub-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .cardhub-close {\n        border: none;\n        background: rgba(43, 32, 24, 0.12);\n        color: #3b2a20;\n        width: 34px;\n        height: 34px;\n        border-radius: 999px;\n        font-size: 20px;\n        line-height: 34px;\n        text-align: center;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-close:hover {\n        background: rgba(43, 32, 24, 0.2);\n      }\n\n      .cardhub-close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-toolbar {\n        display: flex;\n        gap: 8px;\n        padding: 12px 20px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-search {\n        flex: 1;\n        min-width: 180px;\n        border-radius: 999px;\n        border: 1px solid rgba(86, 59, 44, 0.2);\n        padding: 6px 12px;\n        background: #fffaf4;\n      }\n\n      .cardhub-button {\n        border: none;\n        padding: 6px 14px;\n        border-radius: 999px;\n        background: #d46b3d;\n        color: #fff;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-button:hover {\n        background: #c55f36;\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-button:active {\n        transform: translateY(1px);\n      }\n\n      .cardhub-button.is-ghost {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-button.is-ghost:hover {\n        background: rgba(106, 63, 42, 0.08);\n        border-color: rgba(106, 63, 42, 0.6);\n        box-shadow: none;\n      }\n\n      .cardhub-import-input {\n        display: none;\n      }\n\n      .cardhub-body {\n        display: grid;\n        grid-template-columns: minmax(160px, 220px) 1fr;\n        gap: 0;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-sidebar {\n        padding: 20px;\n        border-right: 1px solid rgba(86, 59, 44, 0.15);\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .cardhub-chip-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-divider {\n        height: 1px;\n        width: 100%;\n        background: rgba(86, 59, 44, 0.15);\n        margin: 8px 0;\n      }\n\n      .cardhub-section-title {\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-chip {\n        text-align: left;\n        border: none;\n        background: rgba(255, 255, 255, 0.6);\n        border-radius: 12px;\n        padding: 8px 10px;\n        cursor: pointer;\n        font-size: 12px;\n        transition: background-color 160ms ease, color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-chip:not(.is-active):hover {\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-placeholder {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-tag-filter {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-tag-filter__chip {\n        border: 1px solid rgba(106, 63, 42, 0.25);\n        background: rgba(255, 255, 255, 0.7);\n        border-radius: 999px;\n        padding: 6px 10px;\n        font-size: 12px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag-filter__chip.is-active {\n        background: #2b2018;\n        color: #fff5ea;\n        border-color: transparent;\n      }\n\n      .cardhub-tag-filter__chip:not(.is-active):hover {\n        border-color: rgba(106, 63, 42, 0.45);\n        background: rgba(255, 255, 255, 0.9);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-chip--clear {\n        margin-top: 8px;\n      }\n\n      .cardhub-content {\n        padding: 20px;\n        overflow: auto;\n        flex: 1;\n        min-height: 0;\n      }\n\n      .cardhub-grid-wrap {\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        gap: 10px;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-pagination__status {\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-pagination__actions {\n        display: flex;\n        gap: 8px;\n        align-items: center;\n        margin-right: auto;\n      }\n\n      .cardhub-pagination__button {\n        border: 1px solid rgba(106, 63, 42, 0.35);\n        background: rgba(255, 255, 255, 0.85);\n        color: #6a3f2a;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-pagination__button:disabled {\n        opacity: 0.4;\n        cursor: default;\n      }\n\n      .cardhub-pagination__button:not(:disabled):hover {\n        background: rgba(255, 255, 255, 1);\n        border-color: rgba(106, 63, 42, 0.6);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-pagination__button:not(:disabled):active {\n        transform: translateY(0);\n      }\n\n      .cardhub-loading,\n      .cardhub-empty {\n        padding: 40px 0;\n        text-align: center;\n        color: #7d5b46;\n      }\n\n      .cardhub-grid {\n        display: grid;\n        gap: 14px;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        justify-items: center;\n      }\n\n      .cardhub-card {\n        background: rgba(255, 255, 255, 0.78);\n        border-radius: 18px;\n        padding: 14px;\n        display: grid;\n        grid-template-columns: auto 1fr;\n        gap: 12px;\n        align-items: center;\n        border: 1px solid rgba(86, 59, 44, 0.15);\n        cursor: pointer;\n        transition: transform 140ms ease, box-shadow 180ms ease, border-color 180ms ease;\n        width: 100%;\n        max-width: 260px;\n      }\n\n      .cardhub-card:hover {\n        transform: translateY(-2px);\n        border-color: rgba(86, 59, 44, 0.25);\n        box-shadow: 0 12px 26px rgba(43, 32, 24, 0.16);\n      }\n\n      .cardhub-card:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-card__avatar {\n        width: 42px;\n        height: 42px;\n        border-radius: 12px;\n        background: linear-gradient(135deg, #f4d7c4, #d36a3b);\n        background-size: cover;\n        background-position: center;\n        color: #4a2a1f;\n        display: grid;\n        place-items: center;\n        font-weight: 700;\n      }\n\n      .cardhub-card__avatar.has-avatar span {\n        display: none;\n      }\n\n      .cardhub-card__name {\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .cardhub-card__meta {\n        display: flex;\n        gap: 8px;\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-card__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 8px;\n        align-items: center;\n      }\n\n      .cardhub-tag {\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fff6ea;\n        border-radius: 999px;\n        padding: 4px 8px;\n        font-size: 11px;\n        color: #6a3f2a;\n        cursor: pointer;\n        transition: background-color 160ms ease, border-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-tag:hover {\n        background: #fffaf4;\n        border-color: rgba(106, 63, 42, 0.5);\n        transform: translateY(-1px);\n      }\n\n      .cardhub-tag__remove {\n        margin-left: 4px;\n        font-weight: 700;\n      }\n\n      .cardhub-tag.is-add {\n        background: transparent;\n        border-style: dashed;\n      }\n\n      .cardhub-tag-input {\n        border: 1px dashed rgba(106, 63, 42, 0.5);\n        background: #fffaf4;\n        border-radius: 999px;\n        padding: 4px 10px;\n        font-size: 11px;\n        min-width: 80px;\n        color: #6a3f2a;\n        outline: none;\n        height: 24px;\n        line-height: 16px;\n      }\n\n      .cardhub-tag-input:focus {\n        border-color: rgba(106, 63, 42, 0.85);\n      }\n\n      .cardhub-card__action {\n        grid-column: span 2;\n        margin-top: 10px;\n        border: none;\n        background: #2b2018;\n        color: #fff5ea;\n        padding: 6px 12px;\n        border-radius: 12px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease;\n      }\n\n      .cardhub-card__actions {\n        grid-column: span 2;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-top: 10px;\n      }\n\n      .cardhub-card__action.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-card__action:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-card__action:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-preview {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100000;\n      }\n\n      .cardhub-preview__panel {\n        width: min(520px, 92vw);\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 20px;\n        position: relative;\n        display: grid;\n        gap: 14px;\n      }\n\n      .cardhub-preview__close {\n        position: absolute;\n        top: 14px;\n        right: 14px;\n        border: none;\n        width: 30px;\n        height: 30px;\n        border-radius: 999px;\n        background: rgba(43, 32, 24, 0.15);\n        color: #3b2a20;\n        font-size: 18px;\n        cursor: pointer;\n        transition: background-color 160ms ease, transform 120ms ease;\n      }\n\n      .cardhub-preview__close:hover {\n        background: rgba(43, 32, 24, 0.25);\n      }\n\n      .cardhub-preview__close:active {\n        transform: scale(0.96);\n      }\n\n      .cardhub-preview__avatar {\n        width: 100%;\n        height: 260px;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-preview__avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n      }\n\n      .cardhub-preview__info {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-preview__name {\n        font-size: 20px;\n        font-weight: 700;\n      }\n\n      .cardhub-preview__meta {\n        display: flex;\n        gap: 10px;\n        font-size: 12px;\n        color: #7d5b46;\n      }\n\n      .cardhub-preview__tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n      }\n\n      .cardhub-preview__tag {\n        padding: 6px 10px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.3);\n        background: #fffaf4;\n        font-size: 12px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-preview__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-manage {\n        position: fixed;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.45);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100001;\n      }\n\n      .cardhub-manage__panel {\n        width: min(760px, 94vw);\n        max-height: 88vh;\n        background: #fff6ea;\n        border-radius: 26px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 22px;\n        position: relative;\n        display: grid;\n        gap: 16px;\n        overflow: auto;\n      }\n\n      .cardhub-manage__top {\n        display: grid;\n        grid-template-columns: 1fr auto;\n        gap: 16px;\n        align-items: start;\n      }\n\n      .cardhub-manage__media {\n        width: 220px;\n        aspect-ratio: 3 / 4;\n        height: auto;\n        border-radius: 18px;\n        background: #ead7c4;\n        display: grid;\n        place-items: center;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__media img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .cardhub-manage__summary {\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__overview {\n        display: grid;\n        gap: 10px;\n        margin-top: 10px;\n        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n      }\n\n      .cardhub-manage__overview-card {\n        background: rgba(255, 255, 255, 0.7);\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 14px;\n        padding: 10px 12px;\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__overview-label {\n        font-size: 10px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__overview-value {\n        font-size: 13px;\n        font-weight: 600;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__overview-hint {\n        font-size: 11px;\n        color: #7d5b46;\n      }\n\n      .cardhub-manage__section {\n        display: grid;\n        gap: 8px;\n      }\n\n      .cardhub-manage__details {\n        display: grid;\n        gap: 12px;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n      }\n\n      .cardhub-manage__detail {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        display: grid;\n        gap: 6px;\n      }\n\n      .cardhub-manage__detail-label {\n        font-size: 11px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__detail-content {\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__label {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 8px;\n        font-size: 12px;\n        color: #7d5b46;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n      }\n\n      .cardhub-manage__btn {\n        border: none;\n        border-radius: 12px;\n        padding: 6px 12px;\n        font-size: 12px;\n        cursor: pointer;\n        text-transform: none;\n        transition: background-color 160ms ease, transform 120ms ease, box-shadow 160ms ease;\n      }\n\n      .cardhub-manage__btn.is-primary {\n        background: #2b2018;\n        color: #fff5ea;\n      }\n\n      .cardhub-manage__btn.is-secondary {\n        background: #d9c6b6;\n        color: #3b2a20;\n      }\n\n      .cardhub-manage__jump-row {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .cardhub-manage__btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.15);\n      }\n\n      .cardhub-manage__btn.is-primary:hover {\n        background: #241a14;\n      }\n\n      .cardhub-manage__btn.is-secondary:hover {\n        background: #d1bca8;\n      }\n\n      .cardhub-manage__btn:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-manage__content {\n        background: #fffaf4;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        border-radius: 16px;\n        padding: 12px 14px;\n        font-size: 12px;\n        line-height: 1.5;\n        color: #3b2a20;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-manage__opening {\n        padding: 6px 0;\n        border-bottom: 1px dashed rgba(106, 63, 42, 0.2);\n      }\n\n      .cardhub-manage__opening:last-child {\n        border-bottom: none;\n      }\n\n      .cardhub-manage__chat {\n        display: grid;\n        gap: 10px;\n      }\n\n      .cardhub-manage__chat-row {\n        display: grid;\n        grid-template-columns: minmax(140px, 220px) 1fr;\n        gap: 12px;\n        font-size: 12px;\n        color: #3b2a20;\n        align-items: start;\n        padding: 6px 8px;\n        border-radius: 10px;\n        cursor: pointer;\n      }\n\n      .cardhub-manage__chat-row:hover {\n        background: rgba(106, 63, 42, 0.08);\n      }\n\n      .cardhub-manage__chat-main {\n        display: grid;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-name {\n        flex: 0 0 auto;\n        font-weight: 600;\n        color: #6a3f2a;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-label {\n        font-size: 11px;\n        color: #9a7a63;\n        word-break: break-word;\n      }\n\n      .cardhub-manage__chat-tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 4px;\n      }\n\n      .cardhub-manage__chat-tag {\n        padding: 2px 6px;\n        border-radius: 999px;\n        border: 1px solid rgba(106, 63, 42, 0.2);\n        background: rgba(255, 255, 255, 0.75);\n        font-size: 10px;\n        color: #6a3f2a;\n      }\n\n      .cardhub-manage__chat-text {\n        color: #3b2a20;\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      .cardhub-manage__empty {\n        font-size: 12px;\n        color: #9a7a63;\n      }\n\n      .cardhub-manage__actions {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n      }\n\n      .cardhub-confirm {\n        position: absolute;\n        inset: 0;\n        background: rgba(24, 16, 10, 0.55);\n        backdrop-filter: blur(6px);\n        display: grid;\n        place-items: center;\n        z-index: 100002;\n      }\n\n      .cardhub-confirm__panel {\n        width: min(460px, 92vw);\n        background: #fff6ea;\n        border-radius: 22px;\n        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.25);\n        padding: 18px 20px;\n        display: grid;\n        gap: 12px;\n      }\n\n      .cardhub-confirm__title {\n        font-size: 16px;\n        font-weight: 600;\n        color: #2b2018;\n      }\n\n      .cardhub-confirm__message {\n        font-size: 13px;\n        line-height: 1.5;\n        color: #4a2a1f;\n        white-space: pre-wrap;\n      }\n\n      .cardhub-confirm__actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        flex-wrap: wrap;\n      }\n\n      .cardhub-confirm__button {\n        border: none;\n        border-radius: 999px;\n        padding: 8px 14px;\n        font-size: 12px;\n        cursor: pointer;\n        transition: transform 120ms ease, box-shadow 160ms ease, background-color 160ms ease, border-color 160ms ease;\n      }\n\n      .cardhub-confirm__button.is-confirm {\n        background: #d46b3d;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button.is-cancel {\n        background: transparent;\n        color: #6a3f2a;\n        border: 1px solid rgba(106, 63, 42, 0.4);\n      }\n\n      .cardhub-confirm__button.is-danger {\n        background: #b6452a;\n        color: #fff;\n      }\n\n      .cardhub-confirm__button:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 14px rgba(43, 32, 24, 0.18);\n      }\n\n      .cardhub-confirm__button:active {\n        transform: translateY(0);\n      }\n\n      .cardhub-button:focus-visible,\n      .cardhub-chip:focus-visible,\n      .cardhub-tag-filter__chip:focus-visible,\n      .cardhub-tag:focus-visible,\n      .cardhub-card__action:focus-visible,\n      .cardhub-pagination__button:focus-visible,\n      .cardhub-manage__btn:focus-visible,\n      .cardhub-close:focus-visible,\n      .cardhub-preview__close:focus-visible,\n      .cardhub-confirm__button:focus-visible {\n        outline: 2px solid rgba(212, 107, 61, 0.6);\n        outline-offset: 2px;\n      }\n      @media (max-width: 720px) {\n        .cardhub-root {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99999 !important;\n          display: none;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-root.open {\n          display: flex !important;\n        }\n\n        .cardhub-backdrop {\n          position: absolute !important;\n          inset: 0 !important;\n          z-index: 99998 !important;\n          background: rgba(0, 0, 0, 0.4) !important;\n          backdrop-filter: blur(8px) !important;\n        }\n\n        .cardhub-panel {\n          position: relative !important;\n          transform: none !important;\n          width: 100% !important;\n          height: 100% !important;\n          max-height: 100% !important;\n          max-width: none !important;\n          margin: 0 !important;\n          border-radius: 20px !important;\n          box-shadow: 0 16px 64px rgba(0, 0, 0, 0.35) !important;\n          display: flex !important;\n          flex-direction: column !important;\n          z-index: 100000 !important;\n          overflow: hidden !important;\n          border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        }\n\n        .cardhub-header {\n          flex-shrink: 0;\n          padding: 14px 16px;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n        }\n\n        .cardhub-title__main {\n          font-size: 20px;\n        }\n\n        .cardhub-title__sub {\n          font-size: 11px;\n        }\n\n        .cardhub-close {\n          width: 28px;\n          height: 28px;\n          font-size: 16px;\n          line-height: 28px;\n        }\n\n        .cardhub-toolbar {\n          flex-shrink: 0;\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          padding: 10px 14px;\n        }\n\n        .cardhub-search {\n          width: 100%;\n          font-size: 13px;\n          padding: 8px 12px;\n        }\n\n        .cardhub-button {\n          flex: 1;\n          min-width: 0;\n          font-size: 11px;\n          padding: 6px 10px;\n        }\n\n        .cardhub-body {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          min-height: 0;\n          overflow: auto;\n        }\n\n        .cardhub-sidebar {\n          flex-shrink: 0;\n          border-right: none;\n          border-bottom: 1px solid rgba(86, 59, 44, 0.12);\n          padding: 10px 14px;\n          max-height: none;\n          overflow: visible;\n        }\n\n        .cardhub-section-title {\n          font-size: 10px;\n          margin-bottom: 6px;\n        }\n\n        .cardhub-divider {\n          margin: 6px 0;\n        }\n\n        .cardhub-chip-row,\n        .cardhub-tag-filter {\n          display: flex;\n          flex-wrap: wrap;\n          overflow: visible;\n          gap: 6px;\n          padding-bottom: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar,\n        .cardhub-tag-filter::-webkit-scrollbar {\n          height: 4px;\n        }\n\n        .cardhub-chip-row::-webkit-scrollbar-thumb,\n        .cardhub-tag-filter::-webkit-scrollbar-thumb {\n          background: rgba(106, 63, 42, 0.15);\n          border-radius: 999px;\n        }\n\n        .cardhub-chip {\n          font-size: 11px;\n          padding: 5px 10px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-tag-filter__chip {\n          font-size: 10px;\n          padding: 4px 8px;\n          white-space: nowrap;\n          flex-shrink: 0;\n        }\n\n        .cardhub-content {\n          flex: 1;\n          min-height: 0;\n          overflow: visible;\n          padding: 12px;\n        }\n\n        .cardhub-pagination {\n          align-items: flex-start;\n        }\n\n        .cardhub-pagination__actions {\n          width: 100%;\n        }\n\n        .cardhub-pagination__button {\n          flex: 1;\n          text-align: center;\n        }\n\n        .cardhub-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n          gap: 10px;\n          justify-content: center;\n          justify-items: center;\n        }\n\n        .cardhub-card {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 10px;\n          padding: 10px;\n          border-radius: 14px;\n          min-width: 0;\n          width: 100%;\n          max-width: none;\n        }\n\n        .cardhub-card__avatar {\n          width: 40px;\n          height: 40px;\n          flex-shrink: 0;\n          border-radius: 10px;\n        }\n\n        .cardhub-card__info {\n          flex: 1;\n          min-width: 0;\n        }\n\n        .cardhub-card__name {\n          font-size: 13px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .cardhub-card__meta {\n          font-size: 10px;\n          gap: 6px;\n        }\n\n        .cardhub-card__tags {\n          margin-top: 4px;\n          gap: 4px;\n        }\n\n        .cardhub-tag {\n          font-size: 9px;\n          padding: 3px 6px;\n        }\n\n        .cardhub-card__actions {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n          flex-shrink: 0;\n        }\n\n        .cardhub-card__action {\n          padding: 5px 10px;\n          font-size: 10px;\n          border-radius: 8px;\n        }\n\n        .cardhub-preview,\n        .cardhub-manage {\n          position: absolute !important;\n          inset: 0 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          padding: 16px !important;\n          box-sizing: border-box !important;\n          overflow-y: auto !important;\n        }\n\n        .cardhub-preview__panel,\n        .cardhub-manage__panel {\n          width: calc(100vw - 32px) !important;\n          max-width: 360px !important;\n          max-height: calc(100vh - 32px) !important;\n          max-height: calc(100dvh - 32px) !important;\n          border-radius: 18px !important;\n          padding: 16px !important;\n          overflow: auto !important;\n        }\n\n        .cardhub-preview__avatar {\n          height: 180px;\n          border-radius: 14px;\n        }\n\n        .cardhub-preview__name {\n          font-size: 16px;\n        }\n\n        .cardhub-preview__meta {\n          font-size: 11px;\n        }\n\n        .cardhub-preview__tag {\n          font-size: 10px;\n          padding: 4px 8px;\n        }\n\n        .cardhub-preview__actions {\n          gap: 8px;\n        }\n\n        .cardhub-manage__top {\n          grid-template-columns: 1fr;\n          gap: 12px;\n        }\n\n        .cardhub-manage__media {\n          width: 120px;\n          margin: 0 auto;\n        }\n\n        .cardhub-manage__overview {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__overview-value {\n          font-size: 12px;\n        }\n\n        .cardhub-manage__overview-hint {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__label {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 6px;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__details {\n          grid-template-columns: 1fr;\n        }\n\n        .cardhub-manage__detail-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__detail-content {\n          font-size: 11px;\n        }\n\n        .cardhub-manage__btn {\n          width: 100%;\n          text-align: center;\n          font-size: 10px;\n        }\n\n        .cardhub-manage__jump-row {\n          width: 100%;\n        }\n\n        .cardhub-manage__content {\n          font-size: 11px;\n          padding: 10px;\n        }\n\n        .cardhub-manage__chat-row {\n          grid-template-columns: 1fr;\n          gap: 3px;\n          font-size: 11px;\n        }\n\n        .cardhub-manage__chat-label {\n          font-size: 10px;\n        }\n\n        .cardhub-manage__chat-tag {\n          font-size: 9px;\n        }\n\n        .cardhub-manage__chat-text {\n          -webkit-line-clamp: 2;\n        }\n\n        .cardhub-manage__actions {\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n      }\n    `)\n    .appendTo('head');\n\n  $mount = createScriptIdDiv().addClass('cardhub-mount').appendTo('body');\n  app = createApp(App);\n  app.mount($mount[0]);\n\n  watch(() => cardHubState.open, () => {}, { immediate: true });\n}\n\n\n\nasync function refreshCharacters() {\n  setLoading(true);\n  try {\n    const characters = await fetchCharacterSummaries();\n    setCharacters(characters);\n    setLibrary(loadLibrary());\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createCardHubController(): CardHubController {\n  return {\n    open: (source = 'manual') => {\n      ensureMounted();\n      setOpen(true, source);\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: (source = 'manual') => {\n      ensureMounted();\n      setOpen(!cardHubState.open, source);\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshCharacters();\n    },\n    destroy: () => {\n      if (app) {\n        app.unmount();\n      }\n      if ($mount) {\n        $mount.remove();\n      }\n      if ($style) {\n        $style.remove();\n      }\n      app = null;\n      $mount = null;\n      $style = null;\n    },\n  };\n}\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createCardHubController } from './entry/portal';\n\nfunction init() {\n  const controller = createCardHubController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  controller.refresh();\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n"],"names":["module","exports","Vue","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","style","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","__name","setup","__props","rawText","ref","window","statusText","status","computed","lines","text","match","split","map","line","trim","filter","Boolean","extractLines","value","name","nameIndex","findIndex","test","splice","date","time","location","weather","outfit","posture","emotions","thought","parts","item","length","Number","Math","min","max","setStatusText","_ctx","_cache","emotion","width","$","createApp","app","mount","registerEntryButtons","controller","disposers","roleDisposer","buttonId","getScriptId","$existing","addClass","attr","empty","$anchor","selectors","selector","$target","first","$button","_","el","title","getAttribute","$container","closest","parent","findRoleManagerAnchor","console","warn","openOnce","createOpenOnce","open","on","event","preventDefault","stopImmediatePropagation","append","bindOpenEvents","off","remove","registerRoleManagerEntry","push","magicDisposer","menuId","$magicButton","onMenuOpen","$menu","find","$entry","html","entryDisposer","data","setTimeout","observer","MutationObserver","rootDocument","document","observe","body","childList","subtree","disconnect","registerMagicMenuEntry","forEach","dispose","handler","wrapped","addEventListener","capture","removeEventListener","lastFiredAt","now","Date","async","fetchCharacterSummaries","st","SillyTavern","ctx","getContext","getCharacters","error","list","characters","idCounts","Map","tagKeyCounts","tagIdToName","Array","isArray","tags","tag","id","set","character","index","directTags","avatarKey","avatar","stamp","create_date","date_added","chat","String","tagBaseKey","tagKey","tagCount","get","mappedTags","tagMap","from","Set","baseId","count","origin","uuidv4","replace","c","r","random","toString","LIBRARY_KEY","getStorage","type","script_id","writeLibrary","entries","vars","TavernHelper","getVariables","replaceVariables","readFileAsDataUrl","file","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","readFileAsText","readAsText","normalizeName","fileName","stableStringify","JSON","stringify","join","Object","sort","a","b","localeCompare","buildFingerprint","rawType","raw","source","trimmed","parse","hash","i","charCodeAt","hashString","loadLibrary","readLibrary","addToLibrary","files","existingEntries","current","fingerprints","entry","fingerprint","ensureFingerprint","add","nextEntries","toLowerCase","endsWith","dataUrl","has","parsedName","json","merged","removeFromLibrary","entryId","updated","cardHubState","reactive","loading","search","lastOpenSource","library","setOpen","setLoading","setCharacters","setLibrary","ensureTagStore","getMergedTags","direct","mapped","getTagsForAvatar","updateCharacterTags","nextTags","byAvatar","findCharacter","cleaned","tagIds","tagName","existing","crypto","randomUUID","ensureTag","saveSettingsDebounced","role","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","selectedTags","activeTagKey","tagInput","statusFilter","pageSize","currentPage","importInput","manageCard","manageOpenings","manageChats","manageOpeningLines","previewOpenings","openings","maxItems","opening","maxLines","contentLines","extractContentLines","slice","normalized","normalizeBriefMessage","chunks","chunkText","combined","chunk","previewOpeningLines","preview","manageRequestId","confirmState","message","confirmLabel","cancelLabel","altLabel","allCards","manageProfile","manageOpeningSummary","manageChatSummary","manageDetails","profile","details","pushDetail","label","maxChars","truncated","hasMore","previewDetailText","description","personality","scenario","creatorNotes","systemPrompt","postHistory","creator","manageDetailsHint","manageChatHint","manageOverview","items","worldName","worldBookName","worldCount","worldBookCount","worldValue","worldHint","hint","chatValue","chatHint","total","latest","openingValue","openingHint","alternate","filteredCharacters","applyStatusFilter","keyword","applyTagFilter","matcher","input","RegExp","escapeRegExp","flags","pull","indexOf","some","totalPages","ceil","pagedCharacters","start","allTags","tagSet","avatarUrl","useFull","getCharAvatarPath","encodeURIComponent","avatarStyle","url","backgroundImage","displayTags","manageAvatarUrl","includes","clearTagFilter","prevPage","nextPage","normalizeNameKey","toLocaleLowerCase","openConfirm","options","resolveConfirm","resolver","confirmTag","applyTagUpdate","cancelTagEdit","updateLibraryTags","next","triggerImport","click","handleImportFiles","exportSelected","toastr","warning","tagLabel","statusLabel","searchLabel","exportCard","handleCardAction","card","duplicate","findDuplicateCharacterByName","headers","getRequestHeaders","blob","dataUrlToBlob","importRawCharacter","File","form","FormData","fetch","method","cache","success","importLibraryCard","downloadBlob","Blob","exportLibraryCard","avatarPath","response","openManage","requestId","manageResult","chatsResult","allSettled","resolveManageData","resolveRecentChats","manageData","openingSummary","chatData","summary","closeManage","parseJsonSafe","bytes","comma","base64","binary","atob","Uint8Array","dataUrlToBytes","signature","offset","readUint32BE","bytesToString","subarray","dataStart","dataEnd","parseTextChunk","parseIntlTextChunk","extractPngTextChunks","allowedKeys","parsed","parseCardPayload","parsePngCardData","parseLibraryCardData","extractOpeningMessages","extractCardProfile","extractOpeningSummary","byName","idx","unshallowCharacter","first_mes","getCharacterCardFields","fields","chid","fallback","getCharData","getFullCharacterData","RawCharacter","allowAvatar","primary","nullIndex","compressed","cursor","langEnd","translatedEnd","isLikelyBase64","decoded","TextDecoder","decode","decodeBase64Text","pickString","creatorcomment","creator_notes","system_prompt","post_history_instructions","book","character_book","values","firstCount","alt","alternate_greetings","extensions","formatMaybeTimestamp","isNaN","toLocaleString","hour12","extractChatLatestLabel","candidates","last_message_time","last_message_date","update_time","last_modified","timestamp","file_name","file_id","formatChatTitle","formatChatFileLabel","extractChatKeywords","keywords","stopWords","bracketMatches","size","wordMatches","word","lower","part","filtered","startsWith","brief","getChatHistoryBrief","mes","openLatestChat","openChat","openNewChat","selectManageCharacter","ensureSelected","triggerSlash","close","selection","normalizeChatId","opener","openCharacterChat","catch","opened","timeoutMs","chatId","waitForChatOpen","findCharacterIndex","selectCharacterById","switchMenu","selected","getCurrentCharacterId","sleep","waitForCharacterSelection","characterId","ms","manageDelete","deleteChoice","moveToLibrary","deleteFromTavern","deleteChats","keys","payload","avatar_url","delete_chats","ok","detail","URL","createObjectURL","createElement","href","download","appendChild","revokeObjectURL","refresh","watch","onClick","$event","placeholder","ref_key","accept","multiple","onChange","disabled","nextTick","querySelector","focus","onKeydown","onBlur","onMousedown","onTouchstart","onPointerdown","src","msg","tabindex","$mount","$style","ensureMounted","appendTo","App","immediate","createCardHubController","toggle","refreshCharacters","destroy","unmount","init","cleanupEntries","errorCatched"],"ignoreList":[],"sourceRoot":""}