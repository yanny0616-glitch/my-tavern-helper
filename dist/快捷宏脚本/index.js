const e=Vue;const n=Symbol('MacroUi'),t={class:'macro-panel',role:'dialog','aria-label':'快捷语句管理'},a={class:'macro-header'},r={class:'macro-header-actions'},o={class:'macro-body'},c={class:'macro-sidebar'},l={class:'macro-list'},i=['onClick'],s={class:'macro-item__row'},d={class:'macro-item__name'},m={class:'macro-item__actions'},p=['onClick'],u=['onClick'],f={class:'macro-item__meta'},x={key:0},b={key:1},v={key:2},g={key:3},h={class:'macro-actions'},y={class:'macro-content'},V={class:'macro-field'},E={key:1,class:'macro-empty'},k={key:0,class:'macro-field'},N={key:1,class:'macro-field'},w={class:'macro-scope-row'},C={key:1,class:'macro-scope-hint'},M={key:2,class:'macro-toggle-row'},B={class:'macro-toggle'},T={class:'macro-toggle'},S={class:'macro-toggle'},D=['disabled'],I=['disabled'],A={class:'macro-footer'},U={class:'macro-theme-panel',role:'dialog','aria-label':'主题配色设置'},j={class:'macro-theme-header'},L={class:'macro-theme-body'},F={class:'macro-theme-presets'},H=['onClick'],O={class:'macro-theme-grid'},q={class:'macro-theme-item'},G={class:'macro-theme-item'},P={class:'macro-theme-item'},Y={class:'macro-theme-item'},J={class:'macro-theme-item'},K={class:'macro-theme-item'},Q={class:'macro-theme-item'},R={class:'macro-theme-footer'},W=(0,e.defineComponent)({__name:'App',setup(W){const X=(0,e.inject)(n);if(!X)throw new Error('Macro UI context missing.');const{visible:Z,macros:ee,theme:ne,selectedId:te,selectedMacro:ae,selectMacro:re,currentCharacterLabel:oe,bindCurrentCharacter:ce,close:le,addMacro:ie,duplicateMacro:se,removeMacro:de,moveMacro:me,resetTheme:pe,save:ue}=X,fe=(0,e.ref)(!1),xe=[{name:'白天',colors:{bg:'#f6f1ea',surface:'#ffffff',surfaceAlt:'#f1ebe4',text:'#1c1c1c',textMuted:'#6a5f54',accent:'#d9934f',border:'#e3d6c9'}},{name:'夜晚',colors:{bg:'#0f1115',surface:'#1b1f27',surfaceAlt:'#232836',text:'#f5f5f7',textMuted:'#a7b0c0',accent:'#4cc3ff',border:'#2f3647'}},{name:'雾蓝',colors:{bg:'#e8eef6',surface:'#f7f9fc',surfaceAlt:'#e3ecf7',text:'#1b2533',textMuted:'#5b6b7f',accent:'#5e8cff',border:'#c8d6ea'}},{name:'琥珀',colors:{bg:'#f7efe4',surface:'#fff7ee',surfaceAlt:'#f4e3d0',text:'#2a1f17',textMuted:'#6f5a4a',accent:'#c9783b',border:'#e3c9b2'}}];return(n,W)=>((0,e.openBlock)(),(0,e.createElementBlock)('div',{class:(0,e.normalizeClass)(['macro-root',{open:(0,e.unref)(Z)}])},[(0,e.createElementVNode)('div',{class:'macro-backdrop',onClick:W[0]||(W[0]=(...n)=>(0,e.unref)(le)&&(0,e.unref)(le)(...n))}),(0,e.createElementVNode)('section',t,[(0,e.createElementVNode)('header',a,[W[27]||(W[27]=(0,e.createElementVNode)('div',{class:'macro-title'},[(0,e.createElementVNode)('div',{class:'macro-title__main'},'快捷语句管理'),(0,e.createElementVNode)('div',{class:'macro-title__sub'},'更新后会同步脚本按钮，支持发送/追加/换行控制。')],-1)),(0,e.createElementVNode)('div',r,[(0,e.createElementVNode)('button',{class:'macro-icon-btn',type:'button','aria-label':'配色',onClick:W[1]||(W[1]=e=>fe.value=!0)},[...W[26]||(W[26]=[(0,e.createElementVNode)('i',{class:'fa-solid fa-palette','aria-hidden':'true'},null,-1)])]),(0,e.createElementVNode)('button',{class:'macro-close',type:'button',onClick:W[2]||(W[2]=(...n)=>(0,e.unref)(le)&&(0,e.unref)(le)(...n))},'关闭')])]),(0,e.createElementVNode)('div',o,[(0,e.createElementVNode)('aside',c,[W[30]||(W[30]=(0,e.createElementVNode)('div',{class:'macro-section-title'},'快捷语句列表',-1)),(0,e.createElementVNode)('div',l,[((0,e.openBlock)(!0),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)((0,e.unref)(ee),n=>((0,e.openBlock)(),(0,e.createElementBlock)('button',{key:n.id,class:(0,e.normalizeClass)(['macro-item',{active:n.id===(0,e.unref)(te)}]),type:'button',onClick:t=>(0,e.unref)(re)(n.id)},[(0,e.createElementVNode)('div',s,[(0,e.createElementVNode)('div',d,(0,e.toDisplayString)(n.name||'未命名'),1),(0,e.createElementVNode)('div',m,[(0,e.createElementVNode)('button',{class:'macro-icon-btn',type:'button','aria-label':'复制',onClick:(0,e.withModifiers)(e=>{return t=n.id,re(t),void se();var t},['stop'])},[...W[28]||(W[28]=[(0,e.createElementVNode)('i',{class:'fa-solid fa-copy','aria-hidden':'true'},null,-1)])],8,p),(0,e.createElementVNode)('button',{class:'macro-icon-btn',type:'button','aria-label':'删除',onClick:(0,e.withModifiers)(e=>{return t=n.id,re(t),void de();var t},['stop'])},[...W[29]||(W[29]=[(0,e.createElementVNode)('i',{class:'fa-solid fa-trash','aria-hidden':'true'},null,-1)])],8,u)])]),(0,e.createElementVNode)('div',f,[(0,e.createElementVNode)('span',null,(0,e.toDisplayString)('global'===n.scope?'全局':'角色'),1),n.send?((0,e.openBlock)(),(0,e.createElementBlock)('span',x,'发送')):(0,e.createCommentVNode)('v-if',!0),n.append?((0,e.openBlock)(),(0,e.createElementBlock)('span',b,' · 追加')):(0,e.createCommentVNode)('v-if',!0),n.newline?(0,e.createCommentVNode)('v-if',!0):((0,e.openBlock)(),(0,e.createElementBlock)('span',v,' · 无换行')),n.send||n.append||!n.newline?(0,e.createCommentVNode)('v-if',!0):((0,e.openBlock)(),(0,e.createElementBlock)('span',g,'默认'))])],10,i))),128))]),(0,e.createElementVNode)('div',h,[(0,e.createElementVNode)('button',{class:'macro-btn',type:'button',onClick:W[3]||(W[3]=(...n)=>(0,e.unref)(ie)&&(0,e.unref)(ie)(...n))},'新增')])]),(0,e.createElementVNode)('main',y,[(0,e.createElementVNode)('div',V,[W[31]||(W[31]=(0,e.createElementVNode)('div',{class:'macro-section-title'},'编辑快捷语句',-1)),W[32]||(W[32]=(0,e.createElementVNode)('label',null,'名称',-1)),(0,e.unref)(ae)?(0,e.withDirectives)(((0,e.openBlock)(),(0,e.createElementBlock)('input',{key:0,class:'macro-input','data-focus':'name','onUpdate:modelValue':W[4]||(W[4]=n=>(0,e.unref)(ae).name=n),placeholder:'例如：继续'},null,512)),[[e.vModelText,(0,e.unref)(ae).name]]):((0,e.openBlock)(),(0,e.createElementBlock)('div',E,'请选择左侧语句'))]),(0,e.unref)(ae)?((0,e.openBlock)(),(0,e.createElementBlock)('div',k,[W[33]||(W[33]=(0,e.createElementVNode)('label',null,'内容',-1)),(0,e.withDirectives)((0,e.createElementVNode)('textarea',{class:'macro-textarea','onUpdate:modelValue':W[5]||(W[5]=n=>(0,e.unref)(ae).content=n),placeholder:'输入要插入的文本'},null,512),[[e.vModelText,(0,e.unref)(ae).content]])])):(0,e.createCommentVNode)('v-if',!0),(0,e.unref)(ae)?((0,e.openBlock)(),(0,e.createElementBlock)('div',N,[W[35]||(W[35]=(0,e.createElementVNode)('label',null,'作用范围',-1)),(0,e.createElementVNode)('div',w,[(0,e.withDirectives)((0,e.createElementVNode)('select',{'onUpdate:modelValue':W[6]||(W[6]=n=>(0,e.unref)(ae).scope=n),class:'macro-select'},[...W[34]||(W[34]=[(0,e.createElementVNode)('option',{value:'global'},'全局快捷回复',-1),(0,e.createElementVNode)('option',{value:'character'},'角色快捷回复',-1)])],512),[[e.vModelSelect,(0,e.unref)(ae).scope]]),'character'===(0,e.unref)(ae).scope?((0,e.openBlock)(),(0,e.createElementBlock)('button',{key:0,class:'macro-btn is-ghost',type:'button',onClick:W[7]||(W[7]=(...n)=>(0,e.unref)(ce)&&(0,e.unref)(ce)(...n))},' 绑定当前角色 ')):(0,e.createCommentVNode)('v-if',!0),'character'===(0,e.unref)(ae).scope?((0,e.openBlock)(),(0,e.createElementBlock)('span',C,(0,e.toDisplayString)((0,e.unref)(oe)),1)):(0,e.createCommentVNode)('v-if',!0)])])):(0,e.createCommentVNode)('v-if',!0),(0,e.unref)(ae)?((0,e.openBlock)(),(0,e.createElementBlock)('div',M,[(0,e.createElementVNode)('label',B,[(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':W[8]||(W[8]=n=>(0,e.unref)(ae).send=n)},null,512),[[e.vModelCheckbox,(0,e.unref)(ae).send]]),W[36]||(W[36]=(0,e.createTextVNode)(' 自动发送',-1))]),(0,e.createElementVNode)('label',T,[(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':W[9]||(W[9]=n=>(0,e.unref)(ae).append=n)},null,512),[[e.vModelCheckbox,(0,e.unref)(ae).append]]),W[37]||(W[37]=(0,e.createTextVNode)(' 追加到输入框',-1))]),(0,e.createElementVNode)('label',S,[(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'checkbox','onUpdate:modelValue':W[10]||(W[10]=n=>(0,e.unref)(ae).newline=n)},null,512),[[e.vModelCheckbox,(0,e.unref)(ae).newline]]),W[38]||(W[38]=(0,e.createTextVNode)(' 自动换行',-1))]),(0,e.createElementVNode)('button',{class:'macro-btn is-ghost',type:'button',disabled:!(0,e.unref)(ae),onClick:W[11]||(W[11]=n=>(0,e.unref)(me)(-1))},' 上移 ',8,D),(0,e.createElementVNode)('button',{class:'macro-btn is-ghost',type:'button',disabled:!(0,e.unref)(ae),onClick:W[12]||(W[12]=n=>(0,e.unref)(me)(1))},' 下移 ',8,I)])):(0,e.createCommentVNode)('v-if',!0)])]),(0,e.createElementVNode)('footer',A,[(0,e.createElementVNode)('button',{class:'macro-btn is-ghost',type:'button',onClick:W[13]||(W[13]=(...n)=>(0,e.unref)(le)&&(0,e.unref)(le)(...n))},'取消'),(0,e.createElementVNode)('button',{class:'macro-btn is-primary',type:'button',onClick:W[14]||(W[14]=(...n)=>(0,e.unref)(ue)&&(0,e.unref)(ue)(...n))},'保存')])]),fe.value?((0,e.openBlock)(),(0,e.createElementBlock)('div',{key:0,class:'macro-theme-modal',onClick:W[25]||(W[25]=(0,e.withModifiers)(e=>fe.value=!1,['self']))},[(0,e.createElementVNode)('section',U,[(0,e.createElementVNode)('header',j,[W[39]||(W[39]=(0,e.createElementVNode)('div',null,[(0,e.createElementVNode)('div',{class:'macro-theme-title'},'主题配色'),(0,e.createElementVNode)('div',{class:'macro-theme-sub'},'选择预设或手动微调颜色')],-1)),(0,e.createElementVNode)('button',{class:'macro-close',type:'button',onClick:W[15]||(W[15]=e=>fe.value=!1)},'关闭')]),(0,e.createElementVNode)('div',L,[(0,e.createElementVNode)('div',F,[((0,e.openBlock)(),(0,e.createElementBlock)(e.Fragment,null,(0,e.renderList)(xe,n=>(0,e.createElementVNode)('button',{key:n.name,class:'macro-theme-preset',type:'button',onClick:e=>{return t=n.colors,void(ne.value={...t});var t}},[(0,e.createElementVNode)('span',{class:'macro-theme-dot',style:(0,e.normalizeStyle)({background:n.colors.accent})},null,4),(0,e.createTextVNode)(' '+(0,e.toDisplayString)(n.name),1)],8,H)),64))]),(0,e.createElementVNode)('div',O,[(0,e.createElementVNode)('div',q,[W[40]||(W[40]=(0,e.createElementVNode)('span',null,'背景',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[16]||(W[16]=n=>(0,e.unref)(ne).bg=n)},null,512),[[e.vModelText,(0,e.unref)(ne).bg]])]),(0,e.createElementVNode)('div',G,[W[41]||(W[41]=(0,e.createElementVNode)('span',null,'面板',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[17]||(W[17]=n=>(0,e.unref)(ne).surface=n)},null,512),[[e.vModelText,(0,e.unref)(ne).surface]])]),(0,e.createElementVNode)('div',P,[W[42]||(W[42]=(0,e.createElementVNode)('span',null,'面板辅助',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[18]||(W[18]=n=>(0,e.unref)(ne).surfaceAlt=n)},null,512),[[e.vModelText,(0,e.unref)(ne).surfaceAlt]])]),(0,e.createElementVNode)('div',Y,[W[43]||(W[43]=(0,e.createElementVNode)('span',null,'文字',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[19]||(W[19]=n=>(0,e.unref)(ne).text=n)},null,512),[[e.vModelText,(0,e.unref)(ne).text]])]),(0,e.createElementVNode)('div',J,[W[44]||(W[44]=(0,e.createElementVNode)('span',null,'次级文字',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[20]||(W[20]=n=>(0,e.unref)(ne).textMuted=n)},null,512),[[e.vModelText,(0,e.unref)(ne).textMuted]])]),(0,e.createElementVNode)('div',K,[W[45]||(W[45]=(0,e.createElementVNode)('span',null,'强调色',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[21]||(W[21]=n=>(0,e.unref)(ne).accent=n)},null,512),[[e.vModelText,(0,e.unref)(ne).accent]])]),(0,e.createElementVNode)('div',Q,[W[46]||(W[46]=(0,e.createElementVNode)('span',null,'边框',-1)),(0,e.withDirectives)((0,e.createElementVNode)('input',{type:'color','onUpdate:modelValue':W[22]||(W[22]=n=>(0,e.unref)(ne).border=n)},null,512),[[e.vModelText,(0,e.unref)(ne).border]])])])]),(0,e.createElementVNode)('footer',R,[(0,e.createElementVNode)('button',{class:'macro-btn is-ghost',type:'button',onClick:W[23]||(W[23]=(...n)=>(0,e.unref)(pe)&&(0,e.unref)(pe)(...n))},'恢复默认主题'),(0,e.createElementVNode)('button',{class:'macro-btn is-primary',type:'button',onClick:W[24]||(W[24]=e=>fe.value=!1)},'完成')])])])):(0,e.createCommentVNode)('v-if',!0)],2))}}),X=z,Z=X.z.object({bg:X.z.string().default('#f6f1ea'),surface:X.z.string().default('#ffffff'),surfaceAlt:X.z.string().default('#f1ebe4'),text:X.z.string().default('#1c1c1c'),textMuted:X.z.string().default('#6a5f54'),accent:X.z.string().default('#d9934f'),border:X.z.string().default('#e3d6c9')}).prefault({}),ee=X.z.object({id:X.z.string().default(''),name:X.z.string().default(''),content:X.z.string().default(''),send:X.z.boolean().default(!1),append:X.z.boolean().default(!1),newline:X.z.boolean().default(!0),scope:X.z.enum(['global','character']).default('global'),characterId:X.z.string().default('')}).prefault({}),ne=X.z.object({macros:X.z.array(ee).default([]),theme:Z.default({})}).prefault({macros:[],theme:Z.parse({})}),te={type:'script',script_id:getScriptId()},ae='管理快捷语句',re=[{id:'',name:'问候',content:'你好！',send:!1,append:!1,newline:!0,scope:'global',characterId:''},{id:'',name:'继续',content:'继续。',send:!0,append:!1,newline:!0,scope:'global',characterId:''}],oe=Z.parse({});function ce(e){return e.map(e=>({...e,id:e.id||SillyTavern.uuidv4()}))}function le(){const e=SillyTavern?.characterId??SillyTavern?.getContext?.().characterId??'';return null==e?'':String(e)}function ie(e){const n=le();return e.map(e=>'character'!==e.scope||e.characterId?e:{...e,characterId:n})}function se(e){const n=[],t=new Set,a=[];for(const r of e){const e=r.name.trim();e?e!==ae?t.has(e)?n.push(`快捷语句名称 "${e}" 重复，已忽略后续条目。`):(t.add(e),a.push({...r,name:e})):n.push(`快捷语句名称 "${ae}" 保留，已忽略。`):n.push('忽略空名称的快捷语句。')}return{macros:ce(a),warnings:n}}function de(e){replaceVariables(e,te)}function me(e,n){const t=new Set(n.map(e=>e.name));if(!t.has(e))return e;let a=2;for(;t.has(`${e} ${a}`);)a+=1;return`${e} ${a}`}function pe(){const e=$('#send_but, #send_button, #send').first();e.length?e.trigger('click'):toastr.warning('未找到发送按钮，请手动发送。')}async function ue(e){const n=function(){const e=['#send_textarea','#sendTextArea','#send-textarea','textarea#send_textarea','textarea#sendTextArea','textarea#send-textarea','textarea[name="send_textarea"]'];for(const n of e){const e=$(n).first();if(e.length)return e}return null}();if(!n)return void toastr.error('未找到输入框，无法插入快捷语句。');const t=String(n.val()??''),a=e.append&&t&&e.newline?'\n':'',r=e.append?`${t}${a}${e.content}`:`${e.content}${e.newline?'\n':''}`;if(n.val(r),n.trigger('input'),n.trigger('change'),n.trigger('focus'),e.send){if(await async function(e){const n=e.trimEnd();if(!n.trim())return toastr.warning('快捷语句为空，未发送。'),!0;try{return await createChatMessages([{role:'user',message:n}]),await triggerSlash('/trigger'),!0}catch(e){return console.error('快捷语句发送失败，尝试点击发送按钮。',e),!1}}(r))return n.val(''),n.trigger('input'),void n.trigger('change');SillyTavern.activateSendButtons?.(),setTimeout(pe,0)}}function fe(e){const n=le(),t=e.macros.filter(e=>'global'===e.scope||e.characterId&&e.characterId===n),a=[{name:ae,visible:!0},...t.map(e=>({name:e.name,visible:!0}))];replaceScriptButtons(a)}const xe=[];let be=null;function ve(){for(;xe.length;)xe.pop().stop()}function ge(e){ve();const n=le();e.macros.filter(e=>'global'===e.scope||'character'===e.scope&&e.characterId===n).forEach(e=>{xe.push(eventOn(getButtonEvent(e.name),()=>{ue(e)}))})}function he(t,a){const r=(0,e.ref)(!1),o=(0,e.ref)([]),c=(0,e.ref)({...oe}),l=(0,e.ref)(null),i=(0,e.computed)(()=>o.value.find(e=>e.id===l.value)??null);let s=null,d=null,m=null;function p(e){if(!d)return;d.find('.macro-root').css({'--macro-bg':e.bg,'--macro-surface':e.surface,'--macro-surface-alt':e.surfaceAlt,'--macro-text':e.text,'--macro-text-muted':e.textMuted,'--macro-accent':e.accent,'--macro-border':e.border})}function u(){const e=t();o.value=_.cloneDeep(e.macros),c.value=_.cloneDeep(e.theme),o.value.length&&!l.value&&(l.value=o.value[0].id),l.value&&!o.value.some(e=>e.id===l.value)&&(l.value=o.value[0]?.id??null),p(c.value)}function f(){if(d)return;m=$('<style>').attr('data-macro-style',getScriptId()).text('\n    .macro-root {\n      position: fixed;\n      inset: 0;\n      width: 100vw;\n      height: 100vh;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;\n      color: var(--macro-text, #f5f5f7);\n      --macro-bg: #f6f1ea;\n      --macro-surface: #ffffff;\n      --macro-surface-alt: #f1ebe4;\n      --macro-text: #1c1c1c;\n      --macro-text-muted: #6a5f54;\n      --macro-accent: #d9934f;\n      --macro-border: #e3d6c9;\n      z-index: 9999;\n    }\n\n    .macro-root.open {\n      display: flex;\n    }\n\n    .macro-backdrop {\n      position: absolute;\n      inset: 0;\n      background: rgba(10, 12, 16, 0.55);\n      backdrop-filter: blur(4px);\n    }\n\n    .macro-panel {\n      position: relative;\n      width: min(980px, 96vw);\n      height: min(680px, 92vh);\n      background: var(--macro-surface) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 16px;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35);\n      z-index: 1;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      border-bottom: 1px solid var(--macro-border);\n      background: linear-gradient(135deg, rgba(217, 147, 79, 0.14), rgba(255, 250, 243, 0.92));\n    }\n\n    .macro-header-actions {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n\n    .macro-title__main {\n      font-size: 18px;\n      font-weight: 600;\n      letter-spacing: 0.5px;\n    }\n\n    .macro-title__sub {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      margin-top: 4px;\n    }\n\n    .macro-close {\n      border: 1px solid var(--macro-border);\n      background: transparent;\n      color: var(--macro-text);\n      border-radius: 10px;\n      padding: 6px 12px;\n      cursor: pointer;\n    }\n\n    .macro-icon-btn {\n      border: 1px solid var(--macro-border);\n      background: color-mix(in srgb, var(--macro-surface) 82%, var(--macro-text) 18%);\n      color: var(--macro-text);\n      border-radius: 10px;\n      padding: 6px 10px;\n      cursor: pointer;\n      font-size: 12px;\n      line-height: 1;\n    }\n\n    .macro-body {\n      flex: 1;\n      display: grid;\n      grid-template-columns: 260px 1fr;\n      min-height: 0;\n    }\n\n    .macro-sidebar {\n      border-right: 1px solid var(--macro-border) !important;\n      background: var(--macro-surface-alt) !important;\n      display: flex;\n      flex-direction: column;\n      min-height: 0;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-section-title {\n      padding: 14px 16px;\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      text-transform: uppercase;\n      letter-spacing: 1.2px;\n    }\n\n    .macro-list {\n      flex: 1;\n      overflow: auto;\n      padding: 0 12px 12px;\n    }\n\n    .macro-item {\n      border: 1px solid transparent;\n      background: transparent;\n      border-radius: 10px;\n      padding: 10px 12px;\n      margin-bottom: 8px;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      text-align: left;\n      color: inherit;\n    }\n\n    .macro-item__row {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 10px;\n    }\n\n    .macro-item__actions {\n      display: flex;\n      gap: 6px;\n    }\n\n    .macro-item.active {\n      border-color: rgba(76, 195, 255, 0.6);\n      background: rgba(76, 195, 255, 0.12);\n    }\n\n    .macro-item__name {\n      font-size: 14px;\n      font-weight: 600;\n    }\n\n    .macro-item__meta {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-actions {\n      display: flex;\n      gap: 8px;\n      padding: 12px 16px 16px;\n      border-top: 1px solid var(--macro-border);\n    }\n\n    .macro-content {\n      display: flex;\n      flex-direction: column;\n      gap: 18px;\n      padding: 18px 20px;\n      overflow: auto;\n      background: var(--macro-surface) !important;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-field {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .macro-field label {\n      font-size: 13px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-input,\n    .macro-textarea {\n      width: 100%;\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 10px;\n      padding: 10px 12px;\n      font-size: 14px;\n      box-shadow: none !important;\n    }\n\n    .macro-textarea {\n      min-height: 140px;\n      resize: vertical;\n    }\n\n    .macro-input:focus,\n    .macro-textarea:focus {\n      outline: none;\n      border-color: var(--macro-accent) !important;\n      box-shadow: 0 0 0 2px color-mix(in srgb, var(--macro-accent) 30%, transparent) !important;\n    }\n\n    .macro-root input,\n    .macro-root textarea {\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border-color: var(--macro-border) !important;\n      box-shadow: none !important;\n      filter: none !important;\n    }\n\n    .macro-empty {\n      font-size: 13px;\n      color: var(--macro-text-muted);\n      padding: 8px 0;\n    }\n\n    .macro-toggle-row {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n      align-items: center;\n    }\n\n    .macro-toggle {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 13px;\n    }\n\n    .macro-theme-grid {\n      display: grid;\n      grid-template-columns: repeat(2, minmax(0, 1fr));\n      gap: 12px;\n    }\n\n    .macro-theme-modal {\n      position: absolute;\n      inset: 0;\n      background: rgba(12, 14, 18, 0.65);\n      backdrop-filter: blur(6px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 24px;\n      z-index: 2;\n    }\n\n    .macro-theme-panel {\n      width: min(720px, 92vw);\n      background: var(--macro-surface);\n      border: 1px solid var(--macro-border);\n      border-radius: 16px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);\n    }\n\n    .macro-theme-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px 0;\n    }\n\n    .macro-theme-title {\n      font-size: 18px;\n      font-weight: 600;\n    }\n\n    .macro-theme-sub {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      margin-top: 4px;\n    }\n\n    .macro-theme-body {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      padding: 0 20px;\n    }\n\n    .macro-theme-presets {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n    }\n\n    .macro-theme-preset {\n      border: 1px solid var(--macro-border);\n      background: rgba(12, 14, 20, 0.12);\n      color: var(--macro-text);\n      border-radius: 999px;\n      padding: 6px 14px;\n      font-size: 13px;\n      cursor: pointer;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .macro-theme-dot {\n      width: 10px;\n      height: 10px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n\n    .macro-theme-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      padding: 0 20px 18px;\n    }\n\n    .macro-select {\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 10px;\n      padding: 8px 12px;\n      font-size: 13px;\n    }\n\n    .macro-scope-row {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      flex-wrap: wrap;\n    }\n\n    .macro-scope-hint {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-theme-item {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 10px;\n      background: color-mix(in srgb, var(--macro-surface) 86%, var(--macro-text) 14%);\n      border: 1px solid var(--macro-border);\n      border-radius: 10px;\n      padding: 8px 10px;\n      font-size: 12px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-theme-item input[type="color"] {\n      border: none;\n      background: transparent;\n      width: 36px;\n      height: 24px;\n      padding: 0;\n    }\n\n    .macro-btn {\n      border: 1px solid var(--macro-border);\n      background: color-mix(in srgb, var(--macro-surface) 82%, var(--macro-text) 18%);\n      color: var(--macro-text);\n      border-radius: 10px;\n      padding: 8px 12px;\n      font-size: 13px;\n      cursor: pointer;\n    }\n\n    .macro-btn.is-primary {\n      border-color: var(--macro-accent);\n      background: var(--macro-accent);\n      color: #05131b;\n      font-weight: 600;\n    }\n\n    .macro-btn.is-ghost {\n      background: transparent;\n    }\n\n    .macro-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      padding: 14px 20px;\n      border-top: 1px solid var(--macro-border);\n      background: rgba(10, 12, 16, 0.6);\n    }\n\n    @media (max-width: 900px) {\n      .macro-body {\n        grid-template-columns: 1fr;\n      }\n\n      .macro-sidebar {\n        border-right: none;\n        border-bottom: 1px solid var(--macro-border);\n      }\n    }\n  ').appendTo('head'),d=$('<div>').attr('script_id',getScriptId()).addClass('macro-mount').appendTo('body'),s=(0,e.createApp)(W);const t=(0,e.computed)(()=>function(){const e=le(),n=Number(e),t=SillyTavern?.characters;return!Number.isNaN(n)&&t?.[n]?.name?`当前角色：${t[n].name}`:e?`当前角色ID：${e}`:'未选择角色'}()),p={visible:r,macros:o,theme:c,selectedId:l,selectedMacro:i,selectMacro:e=>{l.value=e},currentCharacterLabel:t,bindCurrentCharacter:()=>{const e=i.value;e&&(e.scope='character',e.characterId=le())},close:()=>{r.value=!1},addMacro:()=>{const e=me('新快捷语句',o.value),n={id:SillyTavern.uuidv4(),name:e,content:'',send:!1,append:!1,newline:!0,scope:'global',characterId:''};o.value.push(n),l.value=n.id},duplicateMacro:()=>{const e=i.value;if(!e)return;const n=me(`${e.name} 副本`,o.value),t={..._.cloneDeep(e),id:SillyTavern.uuidv4(),name:n};o.value.push(t),l.value=t.id},removeMacro:()=>{const e=i.value;if(!e)return;const n=o.value.filter(n=>n.id!==e.id);o.value=n,l.value=n[0]?.id??null},moveMacro:e=>{const n=i.value;if(!n)return;const t=o.value.findIndex(e=>e.id===n.id),a=t+e;if(a<0||a>=o.value.length)return;const r=[...o.value],[c]=r.splice(t,1);r.splice(a,0,c),o.value=r},resetTheme:()=>{c.value={...oe}},save:()=>{const e=se(ie(o.value));e.warnings.forEach(e=>toastr.warning(e));const n={macros:e.macros,theme:Z.parse(c.value)};a(n),r.value=!1}};s.provide(n,p),s.mount(d[0])}(0,e.watch)(()=>c.value,e=>p(Z.parse(e)),{deep:!0});const x=e=>{'Escape'===e.key&&r.value&&(r.value=!1)};return window.parent.addEventListener('keydown',x),{open:function(){f(),u(),r.value=!0,setTimeout(()=>{const e=window.parent.document.querySelector('[data-focus="name"]');e?.focus()},0)},syncFromSettings:u,destroy:()=>{window.parent.removeEventListener('keydown',x),s?.unmount(),d?.remove(),m?.remove(),d=null,m=null,s=null}}}function ye(){let e=function(){const e=getVariables(te);let n=ne.parse(e??{});return Array.isArray(e?.macros)?n.macros=ce(n.macros):(n={macros:ce(re),theme:oe},replaceVariables(n,te)),n.macros=ie(n.macros),e?.theme||(n.theme=oe,replaceVariables(n,te)),n}();const n=se(e.macros);n.warnings.length&&n.warnings.forEach(e=>toastr.warning(e)),e={macros:n.macros,theme:Z.parse(e.theme)},de(e),fe(e),ge(e);const t=he(()=>e,n=>{e=n,de(e),fe(e),ge(e)});!function(e){be||(be=eventOn(getButtonEvent(ae),()=>{e.open()}))}(t);const a=eventOn(tavern_events.CHAT_CHANGED,()=>{fe(e),ge(e)});$(window).on('pagehide',()=>{ve(),a.stop(),be?.stop(),be=null,t.destroy()})}$(()=>{errorCatched(ye)()});
//# sourceMappingURL=index.js.map