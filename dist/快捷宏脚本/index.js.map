{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/快捷宏脚本/core/constants.ts","src://tavern_helper_template/src/快捷宏脚本/integration/buttons.ts","src://tavern_helper_template/src/快捷宏脚本/integration/character.ts","src://tavern_helper_template/src/快捷宏脚本/integration/macro-strategies.ts","src://tavern_helper_template/src/快捷宏脚本/integration/input.ts","src://tavern_helper_template/src/快捷宏脚本/core/macros.ts","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/快捷宏脚本/core/schema.ts","src://tavern_helper_template/src/快捷宏脚本/core/settings.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/快捷宏脚本/ui/context.ts","src://tavern_helper_template/src/快捷宏脚本/ui/MacroListItem.vue","webpack://tavern_helper_template/src/快捷宏脚本/ui/MacroListItem.vue?7b58","src://tavern_helper_template/src/快捷宏脚本/ui/theme-presets.ts","src://tavern_helper_template/src/快捷宏脚本/ui/App.vue","webpack://tavern_helper_template/src/快捷宏脚本/ui/App.vue?30a0","src://tavern_helper_template/src/快捷宏脚本/ui/manager.ts","src://tavern_helper_template/src/快捷宏脚本/ui/style.ts","src://tavern_helper_template/src/快捷宏脚本/entry/portal.ts","src://tavern_helper_template/src/快捷宏脚本/index.ts"],"sourcesContent":["export const SCRIPT_OPTION: VariableOption = { type: 'script', script_id: getScriptId() };\nexport const MANAGE_BUTTON_NAME = '管理快捷语句';\n","import type { Settings } from '../core/schema';\nimport type { Macro } from '../ui/context';\nimport { MANAGE_BUTTON_NAME } from '../core/constants';\n\ntype MacroButtonManagerOptions = {\n  getCurrentCharacterId: () => string;\n  applyMacro: (macro: Macro) => Promise<void>;\n};\n\ntype MacroButtonManager = {\n  render: (settings: Settings) => void;\n  bind: (settings: Settings) => void;\n  ensureManageButton: (manager: { open: () => void }) => void;\n  dispose: () => void;\n};\n\nfunction getVisibleMacros(settings: Settings, currentId: string): Macro[] {\n  return settings.macros.filter(macro => {\n    if (!macro.enabled) {\n      return false;\n    }\n    if (macro.scope === 'global') {\n      return true;\n    }\n    return macro.characterId && macro.characterId === currentId;\n  });\n}\n\nexport function createMacroButtonManager(options: MacroButtonManagerOptions): MacroButtonManager {\n  const macroButtonStops: EventOnReturn[] = [];\n  let manageButtonStop: EventOnReturn | null = null;\n\n  function clearMacroButtonEvents() {\n    while (macroButtonStops.length) {\n      macroButtonStops.pop()!.stop();\n    }\n  }\n\n  function render(settings: Settings) {\n    const currentId = options.getCurrentCharacterId();\n    const visibleMacros = getVisibleMacros(settings, currentId);\n    const buttons: ScriptButton[] = [\n      { name: MANAGE_BUTTON_NAME, visible: true },\n      ...visibleMacros.map(macro => ({ name: macro.name, visible: true })),\n    ];\n\n    replaceScriptButtons(buttons);\n  }\n\n  function bind(settings: Settings) {\n    clearMacroButtonEvents();\n    const currentId = options.getCurrentCharacterId();\n    getVisibleMacros(settings, currentId).forEach(macro => {\n      macroButtonStops.push(\n        eventOn(getButtonEvent(macro.name), () => {\n          void options.applyMacro(macro);\n        }),\n      );\n    });\n  }\n\n  function ensureManageButton(manager: { open: () => void }) {\n    if (manageButtonStop) {\n      return;\n    }\n    manageButtonStop = eventOn(getButtonEvent(MANAGE_BUTTON_NAME), () => {\n      manager.open();\n    });\n  }\n\n  function dispose() {\n    clearMacroButtonEvents();\n    manageButtonStop?.stop();\n    manageButtonStop = null;\n  }\n\n  return {\n    render,\n    bind,\n    ensureManageButton,\n    dispose,\n  };\n}\n","export function getCurrentCharacterId(): string {\n  const raw = (SillyTavern as any)?.characterId ?? (SillyTavern as any)?.getContext?.().characterId ?? '';\n  if (raw === undefined || raw === null) {\n    return '';\n  }\n  return String(raw);\n}\n\nexport function getCurrentCharacterLabel(): string {\n  const id = getCurrentCharacterId();\n  const idx = Number(id);\n  const list = (SillyTavern as any)?.characters as { name?: string }[] | undefined;\n  if (!Number.isNaN(idx) && list?.[idx]?.name) {\n    return `当前角色：${list[idx].name}`;\n  }\n  return id ? `当前角色ID：${id}` : '未选择角色';\n}\n","import type { Macro } from '../ui/context';\n\nexport type MacroActionState = {\n  mode: 'replace' | 'append';\n  newline: boolean;\n};\n\nexport type MacroActionContext = {\n  macro: Macro;\n  input: JQuery<HTMLTextAreaElement>;\n  current: string;\n  content: string;\n  state: MacroActionState;\n  replacement: string | null;\n  setContent: (value: string) => void;\n  setReplacement: (value: string) => void;\n  setInputValue: (value: string) => void;\n  clearInput: () => void;\n};\n\nexport type MacroActionStrategy = {\n  id: string;\n  prepare?: (ctx: MacroActionContext) => void;\n  afterApply?: (ctx: MacroActionContext) => Promise<void>;\n};\n\nfunction clickSendButton(): boolean {\n  const $button = $('#send_but, #send_button, #send').first();\n  if ($button.length) {\n    $button.trigger('click');\n    return true;\n  }\n  toastr.warning('未找到发送按钮，请手动发送。');\n  return false;\n}\n\nexport function buildMacroReplacement(ctx: MacroActionContext): string {\n  const content = ctx.content;\n  if (ctx.state.mode === 'append') {\n    const prefix = ctx.current && ctx.state.newline ? '\\n' : '';\n    return `${ctx.current}${prefix}${content}`;\n  }\n  return `${content}${ctx.state.newline ? '\\n' : ''}`;\n}\n\nexport const macroActionStrategies: MacroActionStrategy[] = [\n  {\n    id: 'append',\n    prepare: ctx => {\n      ctx.state.mode = ctx.macro.send ? 'replace' : ctx.macro.append ? 'append' : 'replace';\n    },\n  },\n  {\n    id: 'newline',\n    prepare: ctx => {\n      ctx.state.newline = ctx.macro.newline;\n    },\n  },\n  {\n    id: 'send',\n    afterApply: async ctx => {\n      if (!ctx.macro.send) {\n        return;\n      }\n      const replacement = ctx.replacement ?? '';\n      if (!replacement.trim()) {\n        toastr.warning('快捷语句为空，未发送。');\n        return;\n      }\n      ctx.setInputValue(replacement);\n      SillyTavern.activateSendButtons?.();\n      setTimeout(() => {\n        const clicked = clickSendButton();\n        if (clicked) {\n          setTimeout(() => ctx.clearInput(), 300);\n        }\n      }, 0);\n    },\n  },\n];\n\nexport async function runMacroActionPipeline(\n  ctx: MacroActionContext,\n  strategies: MacroActionStrategy[] = macroActionStrategies,\n) {\n  strategies.forEach(strategy => strategy.prepare?.(ctx));\n  if (ctx.replacement === null) {\n    ctx.setReplacement(buildMacroReplacement(ctx));\n  }\n  const replacement = ctx.replacement ?? '';\n  ctx.setInputValue(replacement);\n\n  for (const strategy of strategies) {\n    if (strategy.afterApply) {\n      await strategy.afterApply(ctx);\n    }\n  }\n}\n","import type { Macro } from '../ui/context';\nimport type { MacroActionContext } from './macro-strategies';\nimport { runMacroActionPipeline } from './macro-strategies';\n\nexport function findInput(): JQuery<HTMLTextAreaElement> | null {\n  const selectors = [\n    '#send_textarea',\n    '#sendTextArea',\n    '#send-textarea',\n    'textarea#send_textarea',\n    'textarea#sendTextArea',\n    'textarea#send-textarea',\n    'textarea[name=\"send_textarea\"]',\n  ];\n\n  for (const selector of selectors) {\n    const $input = $(selector).first() as JQuery<HTMLTextAreaElement>;\n    if ($input.length) {\n      return $input;\n    }\n  }\n\n  return null;\n}\n\nexport async function applyMacro(macro: Macro) {\n  const $input = findInput();\n  if (!$input) {\n    toastr.error('未找到输入框，无法插入快捷语句。');\n    return;\n  }\n\n  const current = String($input.val() ?? '');\n  const ctx: MacroActionContext = {\n    macro,\n    input: $input,\n    current,\n    content: macro.content,\n    state: { mode: 'replace' as const, newline: true },\n    replacement: null as string | null,\n    setContent(value: string) {\n      ctx.content = value;\n    },\n    setReplacement(value: string) {\n      ctx.replacement = value;\n    },\n    setInputValue(value: string) {\n      $input.val(value);\n      $input.trigger('input');\n      $input.trigger('change');\n    },\n    clearInput() {\n      $input.val('');\n      $input.trigger('input');\n      $input.trigger('change');\n    },\n  };\n\n  await runMacroActionPipeline(ctx);\n  $input.trigger('focus');\n}\n","import type { Macro } from '../ui/context';\nimport { MANAGE_BUTTON_NAME } from './constants';\n\nexport function ensureMacroIds(macros: Macro[]): Macro[] {\n  return macros.map(macro => ({\n    ...macro,\n    id: macro.id || SillyTavern.uuidv4(),\n  }));\n}\n\nexport function ensureScopeDefaults(macros: Macro[], currentId: string): Macro[] {\n  return macros.map(macro => {\n    if (macro.scope === 'character' && !macro.characterId) {\n      return { ...macro, characterId: currentId };\n    }\n    return macro;\n  });\n}\n\nexport function normalizeMacros(macros: Macro[]): { macros: Macro[]; warnings: string[] } {\n  const warnings: string[] = [];\n  const seen = new Set<string>();\n  const normalized: Macro[] = [];\n\n  for (const macro of macros) {\n    const name = macro.name.trim();\n    if (!name) {\n      warnings.push('忽略空名称的快捷语句。');\n      continue;\n    }\n    if (name === MANAGE_BUTTON_NAME) {\n      warnings.push(`快捷语句名称 \"${MANAGE_BUTTON_NAME}\" 保留，已忽略。`);\n      continue;\n    }\n    if (seen.has(name)) {\n      warnings.push(`快捷语句名称 \"${name}\" 重复，已忽略后续条目。`);\n      continue;\n    }\n    seen.add(name);\n    normalized.push({ ...macro, name });\n  }\n\n  return { macros: ensureMacroIds(normalized), warnings };\n}\n\nexport function getUniqueName(baseName: string, macros: Macro[]): string {\n  const existing = new Set(macros.map(macro => macro.name));\n  if (!existing.has(baseName)) {\n    return baseName;\n  }\n  let index = 2;\n  while (existing.has(`${baseName} ${index}`)) {\n    index += 1;\n  }\n  return `${baseName} ${index}`;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const ThemeSchema = z\n    .object({\n    bg: z.string().default('#f6f1ea'),\n    surface: z.string().default('#ffffff'),\n    surfaceAlt: z.string().default('#f1ebe4'),\n    text: z.string().default('#1c1c1c'),\n    textMuted: z.string().default('#6a5f54'),\n    accent: z.string().default('#d9934f'),\n    border: z.string().default('#e3d6c9'),\n})\n    .prefault({});\nexport const MacroSchema = z\n    .object({\n    id: z.string().default(''),\n    name: z.string().default(''),\n    content: z.string().default(''),\n    send: z.boolean().default(false),\n    append: z.boolean().default(false),\n    newline: z.boolean().default(true),\n    scope: z.enum(['global', 'character']).default('global'),\n    characterId: z.string().default(''),\n    pinned: z.boolean().default(false),\n    lastUsedAt: z.number().default(0),\n    enabled: z.boolean().default(true),\n})\n    .prefault({});\nexport const SettingsSchema = z\n    .object({\n    macros: z.array(MacroSchema).default([]),\n    theme: ThemeSchema.default({}),\n})\n    .prefault({ macros: [], theme: ThemeSchema.parse({}) });\nexport const DEFAULT_MACROS = [\n    {\n        id: '',\n        name: '问候',\n        content: '你好！',\n        send: false,\n        append: false,\n        newline: true,\n        scope: 'global',\n        characterId: '',\n        pinned: false,\n        lastUsedAt: 0,\n        enabled: true,\n    },\n    {\n        id: '',\n        name: '继续',\n        content: '继续。',\n        send: true,\n        append: false,\n        newline: true,\n        scope: 'global',\n        characterId: '',\n        pinned: false,\n        lastUsedAt: 0,\n        enabled: true,\n    },\n];\nexport const DEFAULT_THEME = ThemeSchema.parse({});\n","import type { Settings } from './schema';\nimport { SCRIPT_OPTION } from './constants';\nimport { ensureMacroIds, ensureScopeDefaults } from './macros';\nimport { DEFAULT_MACROS, DEFAULT_THEME, SettingsSchema } from './schema';\n\nexport function loadSettings(getCurrentCharacterId: () => string): Settings {\n  const raw = getVariables(SCRIPT_OPTION);\n  let settings = SettingsSchema.parse(raw ?? {});\n\n  if (!Array.isArray(raw?.macros)) {\n    settings = { macros: ensureMacroIds(DEFAULT_MACROS), theme: DEFAULT_THEME };\n    replaceVariables(settings, SCRIPT_OPTION);\n  } else {\n    settings.macros = ensureMacroIds(settings.macros);\n  }\n\n  settings.macros = ensureScopeDefaults(settings.macros, getCurrentCharacterId());\n\n  if (!raw?.theme) {\n    settings.theme = DEFAULT_THEME;\n    replaceVariables(settings, SCRIPT_OPTION);\n  }\n\n  return settings;\n}\n\nexport function saveSettings(settings: Settings) {\n  replaceVariables(settings, SCRIPT_OPTION);\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import type { ComputedRef, Ref } from 'vue';\n\nexport type Macro = {\n  id: string;\n  name: string;\n  content: string;\n  send: boolean;\n  append: boolean;\n  newline: boolean;\n  scope: 'global' | 'character';\n  characterId: string;\n  pinned: boolean;\n  lastUsedAt: number;\n  enabled: boolean;\n};\n\nexport type Theme = {\n  bg: string;\n  surface: string;\n  surfaceAlt: string;\n  text: string;\n  textMuted: string;\n  accent: string;\n  border: string;\n};\n\nexport type MacroUiContext = {\n  visible: Ref<boolean>;\n  macros: Ref<Macro[]>;\n  theme: Ref<Theme>;\n  selectedId: Ref<string | null>;\n  selectedMacro: ComputedRef<Macro | null>;\n  selectMacro: (id: string) => void;\n  currentCharacterLabel: ComputedRef<string>;\n  bindCurrentCharacter: () => void;\n  close: () => void;\n  addMacro: () => void;\n  duplicateMacro: () => void;\n  removeMacro: () => void;\n  moveMacro: (delta: number) => void;\n  resetTheme: () => void;\n  save: () => void;\n};\n\nexport const MacroUiKey = Symbol('MacroUi');\n","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, withModifiers as _withModifiers, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = { class: \"macro-item__row\" };\nconst _hoisted_2 = { class: \"macro-item__name\" };\nconst _hoisted_3 = { class: \"macro-item__actions\" };\nconst _hoisted_4 = [\"aria-label\", \"title\"];\nconst _hoisted_5 = [\"aria-label\", \"title\"];\nconst _hoisted_6 = { class: \"macro-item__meta\" };\nconst _hoisted_7 = { class: \"macro-tag\" };\nconst _hoisted_8 = {\n    key: 0,\n    class: \"macro-tag\"\n};\nconst _hoisted_9 = {\n    key: 1,\n    class: \"macro-tag\"\n};\nconst _hoisted_10 = {\n    key: 2,\n    class: \"macro-tag\"\n};\nconst _hoisted_11 = {\n    key: 3,\n    class: \"macro-tag\"\n};\nconst _hoisted_12 = {\n    key: 4,\n    class: \"macro-tag\"\n};\nconst _hoisted_13 = {\n    key: 5,\n    class: \"macro-tag\"\n};\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'MacroListItem',\n    props: {\n        macro: {},\n        mode: {},\n        characterLabel: {}\n    },\n    emits: [\"pin\", \"duplicate\", \"hide\", \"toggle\", \"edit\", \"delete\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, _toDisplayString(__props.macro.name || '未命名'), 1 /* TEXT */),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _createElementVNode(\"button\", {\n                            class: \"macro-icon-btn\",\n                            type: \"button\",\n                            \"aria-label\": __props.macro.pinned ? '取消收藏' : '收藏',\n                            title: __props.macro.pinned ? '取消收藏' : '收藏',\n                            onClick: _cache[0] || (_cache[0] = _withModifiers(($event) => (emit('pin', __props.macro.id)), [\"stop\"]))\n                        }, [\n                            _createElementVNode(\"i\", {\n                                class: _normalizeClass([\"macro-icon\", __props.macro.pinned ? 'fa-solid fa-star is-pinned' : 'fa-regular fa-star']),\n                                \"aria-hidden\": \"true\"\n                            }, null, 2 /* CLASS */)\n                        ], 8 /* PROPS */, _hoisted_4),\n                        (__props.mode === 'active')\n                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-icon-btn\",\n                                    type: \"button\",\n                                    \"aria-label\": \"复制\",\n                                    title: \"复制\",\n                                    onClick: _cache[1] || (_cache[1] = _withModifiers(($event) => (emit('duplicate', __props.macro.id)), [\"stop\"]))\n                                }, [...(_cache[6] || (_cache[6] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-regular fa-copy\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))]),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-icon-btn\",\n                                    type: \"button\",\n                                    \"aria-label\": \"移出列表\",\n                                    title: \"移出列表\",\n                                    onClick: _cache[2] || (_cache[2] = _withModifiers(($event) => (emit('hide', __props.macro.id)), [\"stop\"]))\n                                }, [...(_cache[7] || (_cache[7] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-regular fa-eye-slash\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))])\n                            ], 64 /* STABLE_FRAGMENT */))\n                            : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-icon-btn\",\n                                    type: \"button\",\n                                    \"aria-label\": __props.macro.enabled ? '移出快捷回复' : '加入快捷回复',\n                                    title: __props.macro.enabled ? '移出快捷回复' : '加入快捷回复',\n                                    onClick: _cache[3] || (_cache[3] = _withModifiers(($event) => (emit('toggle', __props.macro.id)), [\"stop\"]))\n                                }, [\n                                    _createElementVNode(\"i\", {\n                                        class: _normalizeClass([\"macro-icon\", __props.macro.enabled ? 'fa-solid fa-minus' : 'fa-solid fa-plus']),\n                                        \"aria-hidden\": \"true\"\n                                    }, null, 2 /* CLASS */)\n                                ], 8 /* PROPS */, _hoisted_5),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-icon-btn\",\n                                    type: \"button\",\n                                    \"aria-label\": \"编辑\",\n                                    title: \"编辑\",\n                                    onClick: _cache[4] || (_cache[4] = _withModifiers(($event) => (emit('edit', __props.macro.id)), [\"stop\"]))\n                                }, [...(_cache[8] || (_cache[8] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-regular fa-pen-to-square\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))]),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-icon-btn\",\n                                    type: \"button\",\n                                    \"aria-label\": \"删除\",\n                                    title: \"删除\",\n                                    onClick: _cache[5] || (_cache[5] = _withModifiers(($event) => (emit('delete', __props.macro.id)), [\"stop\"]))\n                                }, [...(_cache[9] || (_cache[9] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-regular fa-trash-can\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))])\n                            ], 64 /* STABLE_FRAGMENT */))\n                    ])\n                ]),\n                _createElementVNode(\"div\", _hoisted_6, [\n                    _createElementVNode(\"span\", _hoisted_7, [\n                        _createElementVNode(\"i\", {\n                            class: _normalizeClass([\"macro-icon fa-solid\", __props.macro.scope === 'global' ? 'fa-globe' : 'fa-user']),\n                            \"aria-hidden\": \"true\"\n                        }, null, 2 /* CLASS */),\n                        _createTextVNode(\" \" + _toDisplayString(__props.macro.scope === 'global' ? '全局' : '角色'), 1 /* TEXT */)\n                    ]),\n                    (__props.macro.scope === 'character' && __props.characterLabel)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, [\n                            _cache[10] || (_cache[10] = _createElementVNode(\"i\", {\n                                class: \"macro-icon fa-regular fa-id-badge\",\n                                \"aria-hidden\": \"true\"\n                            }, null, -1 /* CACHED */)),\n                            _createTextVNode(\" \" + _toDisplayString(__props.characterLabel), 1 /* TEXT */)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (__props.macro.send)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_9, [...(_cache[11] || (_cache[11] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-regular fa-paper-plane\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 发送 \", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (__props.macro.append)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_10, [...(_cache[12] || (_cache[12] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-solid fa-plus\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 追加 \", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (!__props.macro.send && !__props.macro.append)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_11, [...(_cache[13] || (_cache[13] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-regular fa-square\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 覆盖 \", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (!__props.macro.newline)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_12, [...(_cache[14] || (_cache[14] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-solid fa-ban\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 无换行 \", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (!__props.macro.enabled)\n                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_13, [...(_cache[15] || (_cache[15] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-regular fa-eye-slash\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 未显示 \", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true)\n                ])\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./MacroListItem.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./MacroListItem.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import type { Theme } from './context';\n\nexport const themePresets: { name: string; colors: Theme }[] = [\n  {\n    name: '白天',\n    colors: {\n      bg: '#f6f1ea',\n      surface: '#ffffff',\n      surfaceAlt: '#f1ebe4',\n      text: '#1c1c1c',\n      textMuted: '#6a5f54',\n      accent: '#d9934f',\n      border: '#e3d6c9',\n    },\n  },\n  {\n    name: '夜晚',\n    colors: {\n      bg: '#0f1115',\n      surface: '#1b1f27',\n      surfaceAlt: '#232836',\n      text: '#f5f5f7',\n      textMuted: '#a7b0c0',\n      accent: '#4cc3ff',\n      border: '#2f3647',\n    },\n  },\n  {\n    name: '雾蓝',\n    colors: {\n      bg: '#e8eef6',\n      surface: '#f7f9fc',\n      surfaceAlt: '#e3ecf7',\n      text: '#1b2533',\n      textMuted: '#5b6b7f',\n      accent: '#5e8cff',\n      border: '#c8d6ea',\n    },\n  },\n  {\n    name: '琥珀',\n    colors: {\n      bg: '#f7efe4',\n      surface: '#fff7ee',\n      surfaceAlt: '#f4e3d0',\n      text: '#2a1f17',\n      textMuted: '#6f5a4a',\n      accent: '#c9783b',\n      border: '#e3c9b2',\n    },\n  },\n];\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createVNode as _createVNode, withModifiers as _withModifiers, withKeys as _withKeys, normalizeClass as _normalizeClass, vModelText as _vModelText, withDirectives as _withDirectives, vModelSelect as _vModelSelect, toDisplayString as _toDisplayString, vModelCheckbox as _vModelCheckbox, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n    class: \"macro-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"快捷语句管理\"\n};\nconst _hoisted_2 = { class: \"macro-header\" };\nconst _hoisted_3 = { class: \"macro-header-actions\" };\nconst _hoisted_4 = { class: \"macro-body\" };\nconst _hoisted_5 = { class: \"macro-sidebar\" };\nconst _hoisted_6 = { class: \"macro-list\" };\nconst _hoisted_7 = {\n    key: 0,\n    class: \"macro-empty-list\"\n};\nconst _hoisted_8 = {\n    key: 0,\n    class: \"macro-subtitle\"\n};\nconst _hoisted_9 = {\n    key: 1,\n    class: \"macro-group\"\n};\nconst _hoisted_10 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_11 = {\n    key: 2,\n    class: \"macro-subtitle\"\n};\nconst _hoisted_12 = {\n    key: 3,\n    class: \"macro-group\"\n};\nconst _hoisted_13 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_14 = { class: \"macro-actions\" };\nconst _hoisted_15 = { class: \"macro-content\" };\nconst _hoisted_16 = { class: \"macro-field\" };\nconst _hoisted_17 = {\n    key: 1,\n    class: \"macro-empty\"\n};\nconst _hoisted_18 = {\n    key: 0,\n    class: \"macro-field\"\n};\nconst _hoisted_19 = {\n    key: 1,\n    class: \"macro-field\"\n};\nconst _hoisted_20 = { class: \"macro-scope-row\" };\nconst _hoisted_21 = {\n    key: 1,\n    class: \"macro-scope-hint\"\n};\nconst _hoisted_22 = {\n    key: 2,\n    class: \"macro-toggle-row\"\n};\nconst _hoisted_23 = { class: \"macro-toggle\" };\nconst _hoisted_24 = [\"disabled\"];\nconst _hoisted_25 = [\"disabled\"];\nconst _hoisted_26 = { class: \"macro-footer\" };\nconst _hoisted_27 = {\n    class: \"macro-library-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"宏库管理\"\n};\nconst _hoisted_28 = { class: \"macro-library-header\" };\nconst _hoisted_29 = { class: \"macro-library-body\" };\nconst _hoisted_30 = { class: \"macro-search\" };\nconst _hoisted_31 = { class: \"macro-filters\" };\nconst _hoisted_32 = { class: \"macro-library-list\" };\nconst _hoisted_33 = { class: \"macro-list\" };\nconst _hoisted_34 = { class: \"macro-group\" };\nconst _hoisted_35 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_36 = {\n    key: 0,\n    class: \"macro-empty-list\"\n};\nconst _hoisted_37 = { class: \"macro-group\" };\nconst _hoisted_38 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_39 = {\n    key: 1,\n    class: \"macro-subtitle\"\n};\nconst _hoisted_40 = {\n    key: 2,\n    class: \"macro-group\"\n};\nconst _hoisted_41 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_42 = {\n    key: 3,\n    class: \"macro-subtitle\"\n};\nconst _hoisted_43 = {\n    key: 4,\n    class: \"macro-group\"\n};\nconst _hoisted_44 = [\"onClick\", \"onKeydown\"];\nconst _hoisted_45 = {\n    key: 5,\n    class: \"macro-empty-list\"\n};\nconst _hoisted_46 = {\n    key: 0,\n    class: \"macro-library-editor\"\n};\nconst _hoisted_47 = { class: \"macro-editor\" };\nconst _hoisted_48 = { class: \"macro-field\" };\nconst _hoisted_49 = { class: \"macro-field\" };\nconst _hoisted_50 = { class: \"macro-field\" };\nconst _hoisted_51 = { class: \"macro-scope-row\" };\nconst _hoisted_52 = {\n    key: 1,\n    class: \"macro-scope-hint\"\n};\nconst _hoisted_53 = { class: \"macro-toggle-row\" };\nconst _hoisted_54 = { class: \"macro-toggle\" };\nconst _hoisted_55 = { class: \"macro-toggle\" };\nconst _hoisted_56 = { class: \"macro-library-footer\" };\nconst _hoisted_57 = {\n    class: \"macro-theme-panel\",\n    role: \"dialog\",\n    \"aria-label\": \"主题配色设置\"\n};\nconst _hoisted_58 = { class: \"macro-theme-header\" };\nconst _hoisted_59 = { class: \"macro-theme-body\" };\nconst _hoisted_60 = { class: \"macro-theme-presets\" };\nconst _hoisted_61 = [\"onClick\"];\nconst _hoisted_62 = { class: \"macro-theme-grid\" };\nconst _hoisted_63 = { class: \"macro-theme-item\" };\nconst _hoisted_64 = { class: \"macro-theme-item\" };\nconst _hoisted_65 = { class: \"macro-theme-item\" };\nconst _hoisted_66 = { class: \"macro-theme-item\" };\nconst _hoisted_67 = { class: \"macro-theme-item\" };\nconst _hoisted_68 = { class: \"macro-theme-item\" };\nconst _hoisted_69 = { class: \"macro-theme-item\" };\nconst _hoisted_70 = { class: \"macro-theme-footer\" };\nimport { computed, inject, nextTick, ref, watch } from 'vue';\nimport { MacroUiKey } from './context';\nimport { getCurrentCharacterId } from '../integration/character';\nimport { getUniqueName } from '../core/macros';\nimport MacroListItem from './MacroListItem.vue';\nimport { themePresets } from './theme-presets';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const ctx = inject(MacroUiKey);\n        if (!ctx) {\n            throw new Error('Macro UI context missing.');\n        }\n        const { visible, macros, theme, selectedId, selectedMacro, selectMacro, currentCharacterLabel, bindCurrentCharacter, close, addMacro, duplicateMacro, removeMacro, moveMacro, resetTheme, save, } = ctx;\n        const themeOpen = ref(false);\n        const libraryOpen = ref(false);\n        const librarySelectedId = ref(null);\n        const searchTerm = ref('');\n        const scopeFilter = ref('all');\n        const onlyPinned = ref(false);\n        const onlyRecent = ref(false);\n        const contentRef = ref(null);\n        const libraryContentRef = ref(null);\n        const normalizedSearch = computed(() => searchTerm.value.trim().toLowerCase());\n        const matchesMacro = (macro) => {\n            const query = normalizedSearch.value;\n            if (query) {\n                const haystack = `${macro.name} ${macro.content}`.toLowerCase();\n                if (!haystack.includes(query)) {\n                    return false;\n                }\n            }\n            if (scopeFilter.value !== 'all' && macro.scope !== scopeFilter.value) {\n                return false;\n            }\n            if (onlyPinned.value && !macro.pinned) {\n                return false;\n            }\n            return true;\n        };\n        const filteredMacros = computed(() => macros.value.filter(matchesMacro));\n        const activeMacros = computed(() => macros.value.filter(macro => macro.enabled));\n        const recentAll = computed(() => macros.value.filter(macro => macro.lastUsedAt > 0).sort((a, b) => b.lastUsedAt - a.lastUsedAt));\n        const recentMacros = computed(() => recentAll.value.filter(matchesMacro));\n        const recentPreview = computed(() => recentMacros.value.slice(0, 5));\n        const showRecentSection = computed(() => !onlyRecent.value && !normalizedSearch.value && recentPreview.value.length > 0);\n        const orderPinnedFirst = (list) => {\n            const pinned = list.filter(macro => macro.pinned);\n            const rest = list.filter(macro => !macro.pinned);\n            return [...pinned, ...rest];\n        };\n        const groupedMacros = computed(() => ({\n            global: orderPinnedFirst(filteredMacros.value.filter(macro => macro.scope === 'global')),\n            character: orderPinnedFirst(filteredMacros.value.filter(macro => macro.scope === 'character')),\n        }));\n        const activeGrouped = computed(() => ({\n            global: orderPinnedFirst(activeMacros.value.filter(macro => macro.scope === 'global')),\n            character: orderPinnedFirst(activeMacros.value.filter(macro => macro.scope === 'character')),\n        }));\n        const librarySelectedMacro = computed(() => macros.value.find(macro => macro.id === librarySelectedId.value) ?? null);\n        const actionMode = computed({\n            get() {\n                if (!selectedMacro.value) {\n                    return 'replace';\n                }\n                if (selectedMacro.value.send) {\n                    return 'send';\n                }\n                if (selectedMacro.value.append) {\n                    return 'append';\n                }\n                return 'replace';\n            },\n            set(mode) {\n                if (!selectedMacro.value) {\n                    return;\n                }\n                selectedMacro.value.send = mode === 'send';\n                selectedMacro.value.append = mode === 'append';\n            },\n        });\n        const applyPreset = (colors) => {\n            theme.value = { ...colors };\n        };\n        const getCharacterLabelById = (id) => {\n            const idx = Number(id);\n            const list = SillyTavern?.characters;\n            if (!Number.isNaN(idx) && list?.[idx]?.name) {\n                return list[idx].name;\n            }\n            return id ? `角色ID：${id}` : '';\n        };\n        const getMacroCharacterLabel = (macro) => {\n            if (macro.scope !== 'character') {\n                return '';\n            }\n            return getCharacterLabelById(macro.characterId);\n        };\n        const resizeContent = () => {\n            const el = contentRef.value;\n            if (!el) {\n                return;\n            }\n            el.style.height = 'auto';\n            el.style.height = `${el.scrollHeight}px`;\n        };\n        const resizeLibraryContent = () => {\n            const el = libraryContentRef.value;\n            if (!el) {\n                return;\n            }\n            el.style.height = 'auto';\n            el.style.height = `${el.scrollHeight}px`;\n        };\n        watch(() => selectedMacro.value?.content, async () => {\n            await nextTick();\n            resizeContent();\n        }, { immediate: true });\n        watch(() => librarySelectedMacro.value?.content, async () => {\n            await nextTick();\n            resizeLibraryContent();\n        }, { immediate: true });\n        watch(() => visible.value, nextVisible => {\n            if (!nextVisible) {\n                libraryOpen.value = false;\n                themeOpen.value = false;\n            }\n        });\n        watch(() => libraryOpen.value, nextOpen => {\n            if (!nextOpen && selectedMacro.value && !selectedMacro.value.enabled) {\n                selectedId.value = activeMacros.value[0]?.id ?? null;\n            }\n        });\n        watch(() => filteredMacros.value, next => {\n            if (!libraryOpen.value) {\n                return;\n            }\n            if (!librarySelectedId.value || !next.some(macro => macro.id === librarySelectedId.value)) {\n                librarySelectedId.value = null;\n            }\n        }, { deep: true });\n        const duplicateItem = (id) => {\n            selectMacro(id);\n            duplicateMacro();\n        };\n        const deleteItem = (id) => {\n            const index = macros.value.findIndex(macro => macro.id === id);\n            if (index < 0) {\n                return;\n            }\n            const wasSelectedMain = selectedId.value === id;\n            const wasSelectedLibrary = librarySelectedId.value === id;\n            macros.value.splice(index, 1);\n            if (wasSelectedMain) {\n                selectedId.value = activeMacros.value[0]?.id ?? null;\n            }\n            if (wasSelectedLibrary) {\n                librarySelectedId.value = filteredMacros.value[0]?.id ?? null;\n            }\n        };\n        const togglePinned = (id) => {\n            const target = macros.value.find(macro => macro.id === id);\n            if (!target) {\n                return;\n            }\n            target.pinned = !target.pinned;\n        };\n        const toggleEnabled = (id) => {\n            const target = macros.value.find(macro => macro.id === id);\n            if (!target) {\n                return;\n            }\n            target.enabled = !target.enabled;\n        };\n        const hideFromList = (id) => {\n            const target = macros.value.find(macro => macro.id === id);\n            if (!target) {\n                return;\n            }\n            target.enabled = false;\n            if (selectedId.value === id) {\n                selectedId.value = activeMacros.value[0]?.id ?? null;\n            }\n            if (librarySelectedId.value === id) {\n                librarySelectedId.value = null;\n            }\n        };\n        const editFromLibrary = (id) => {\n            librarySelectedId.value = id;\n        };\n        const selectLibraryMacro = (id) => {\n            librarySelectedId.value = id;\n        };\n        const createMacroDraft = (enabled, selectInMain) => {\n            const macro = {\n                id: SillyTavern.uuidv4(),\n                name: getUniqueName('新快捷语句', macros.value),\n                content: '',\n                send: false,\n                append: false,\n                newline: true,\n                scope: 'global',\n                characterId: '',\n                pinned: false,\n                lastUsedAt: 0,\n                enabled,\n            };\n            macros.value.push(macro);\n            if (selectInMain) {\n                selectedId.value = macro.id;\n            }\n            librarySelectedId.value = macro.id;\n        };\n        const addFromLibrary = () => {\n            createMacroDraft(false, false);\n        };\n        const openLibrary = (resetSelection) => {\n            if (resetSelection) {\n                librarySelectedId.value = null;\n            }\n            libraryOpen.value = true;\n        };\n        const libraryActionMode = computed({\n            get() {\n                if (!librarySelectedMacro.value) {\n                    return 'replace';\n                }\n                if (librarySelectedMacro.value.send) {\n                    return 'send';\n                }\n                if (librarySelectedMacro.value.append) {\n                    return 'append';\n                }\n                return 'replace';\n            },\n            set(mode) {\n                if (!librarySelectedMacro.value) {\n                    return;\n                }\n                librarySelectedMacro.value.send = mode === 'send';\n                librarySelectedMacro.value.append = mode === 'append';\n            },\n        });\n        const bindCurrentCharacterToLibrary = () => {\n            const current = librarySelectedMacro.value;\n            if (!current) {\n                return;\n            }\n            current.scope = 'character';\n            current.characterId = getCurrentCharacterId();\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"macro-root\", { open: _unref(visible) }])\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"macro-backdrop\",\n                    onClick: _cache[0] || (_cache[0] =\n                        //@ts-ignore\n                        (...args) => (_unref(close) && _unref(close)(...args)))\n                }),\n                _createElementVNode(\"section\", _hoisted_1, [\n                    _createElementVNode(\"header\", _hoisted_2, [\n                        _cache[46] || (_cache[46] = _createElementVNode(\"div\", { class: \"macro-title\" }, [\n                            _createElementVNode(\"div\", { class: \"macro-title__main\" }, \"快捷语句管理\"),\n                            _createElementVNode(\"div\", { class: \"macro-title__sub\" }, \"更新后会同步脚本按钮，支持发送/追加/换行控制。\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", _hoisted_3, [\n                            _createElementVNode(\"button\", {\n                                class: \"macro-icon-btn\",\n                                type: \"button\",\n                                \"aria-label\": \"宏库\",\n                                title: \"宏库\",\n                                onClick: _cache[1] || (_cache[1] = ($event) => (openLibrary(true)))\n                            }, [...(_cache[43] || (_cache[43] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"macro-icon fa-solid fa-layer-group\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"macro-icon-btn\",\n                                type: \"button\",\n                                \"aria-label\": \"配色\",\n                                title: \"配色\",\n                                onClick: _cache[2] || (_cache[2] = ($event) => (themeOpen.value = true))\n                            }, [...(_cache[44] || (_cache[44] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"macro-icon fa-solid fa-palette\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"macro-close\",\n                                type: \"button\",\n                                \"aria-label\": \"关闭\",\n                                title: \"关闭\",\n                                onClick: _cache[3] || (_cache[3] =\n                                    //@ts-ignore\n                                    (...args) => (_unref(close) && _unref(close)(...args)))\n                            }, [...(_cache[45] || (_cache[45] = [\n                                    _createElementVNode(\"i\", {\n                                        class: \"macro-icon fa-solid fa-xmark\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _createElementVNode(\"aside\", _hoisted_5, [\n                            _cache[49] || (_cache[49] = _createElementVNode(\"div\", { class: \"macro-section-title\" }, \"快捷语句列表\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                (!activeGrouped.value.global.length && !activeGrouped.value.character.length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                                        _cache[47] || (_cache[47] = _createTextVNode(\" 当前没有显示的快捷语句 \", -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"macro-btn is-ghost\",\n                                            type: \"button\",\n                                            onClick: _cache[4] || (_cache[4] = ($event) => (openLibrary(true)))\n                                        }, \"打开宏库\")\n                                    ]))\n                                    : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                        (activeGrouped.value.global.length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \"全局\"))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (activeGrouped.value.global.length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(activeGrouped.value.global, (macro) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: macro.id,\n                                                        class: _normalizeClass([\"macro-item\", { active: macro.id === _unref(selectedId) }]),\n                                                        onClick: ($event) => (_unref(selectMacro)(macro.id)),\n                                                        role: \"button\",\n                                                        tabindex: \"0\",\n                                                        onKeydown: [\n                                                            _withKeys(_withModifiers(($event) => (_unref(selectMacro)(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                            _withKeys(_withModifiers(($event) => (_unref(selectMacro)(macro.id)), [\"prevent\"]), [\"space\"])\n                                                        ]\n                                                    }, [\n                                                        _createVNode(MacroListItem, {\n                                                            macro: macro,\n                                                            mode: \"active\",\n                                                            \"character-label\": getMacroCharacterLabel(macro),\n                                                            onPin: togglePinned,\n                                                            onDuplicate: duplicateItem,\n                                                            onHide: hideFromList\n                                                        }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                    ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_10));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (activeGrouped.value.character.length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, \"角色\"))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (activeGrouped.value.character.length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(activeGrouped.value.character, (macro) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: macro.id,\n                                                        class: _normalizeClass([\"macro-item\", { active: macro.id === _unref(selectedId) }]),\n                                                        onClick: ($event) => (_unref(selectMacro)(macro.id)),\n                                                        role: \"button\",\n                                                        tabindex: \"0\",\n                                                        onKeydown: [\n                                                            _withKeys(_withModifiers(($event) => (_unref(selectMacro)(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                            _withKeys(_withModifiers(($event) => (_unref(selectMacro)(macro.id)), [\"prevent\"]), [\"space\"])\n                                                        ]\n                                                    }, [\n                                                        _createVNode(MacroListItem, {\n                                                            macro: macro,\n                                                            mode: \"active\",\n                                                            \"character-label\": getMacroCharacterLabel(macro),\n                                                            onPin: togglePinned,\n                                                            onDuplicate: duplicateItem,\n                                                            onHide: hideFromList\n                                                        }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                    ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_13));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ], 64 /* STABLE_FRAGMENT */))\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_14, [\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-btn\",\n                                    type: \"button\",\n                                    onClick: _cache[5] || (_cache[5] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(addMacro) && _unref(addMacro)(...args)))\n                                }, [...(_cache[48] || (_cache[48] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-solid fa-plus\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */),\n                                        _createTextVNode(\" 新增 \", -1 /* CACHED */)\n                                    ]))])\n                            ])\n                        ]),\n                        _createElementVNode(\"main\", _hoisted_15, [\n                            _createElementVNode(\"div\", _hoisted_16, [\n                                _cache[50] || (_cache[50] = _createElementVNode(\"div\", { class: \"macro-section-title\" }, \"编辑快捷语句\", -1 /* CACHED */)),\n                                _cache[51] || (_cache[51] = _createElementVNode(\"label\", null, \"名称\", -1 /* CACHED */)),\n                                (_unref(selectedMacro))\n                                    ? _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                                        key: 0,\n                                        class: \"macro-input\",\n                                        \"data-focus\": \"name\",\n                                        \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => ((_unref(selectedMacro).name) = $event)),\n                                        placeholder: \"例如：继续\"\n                                    }, null, 512 /* NEED_PATCH */)), [\n                                        [_vModelText, _unref(selectedMacro).name]\n                                    ])\n                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_17, \"请选择左侧语句\"))\n                            ]),\n                            (_unref(selectedMacro))\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [\n                                    _cache[52] || (_cache[52] = _createElementVNode(\"label\", null, \"内容\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                        ref_key: \"contentRef\",\n                                        ref: contentRef,\n                                        class: \"macro-textarea\",\n                                        \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => ((_unref(selectedMacro).content) = $event)),\n                                        placeholder: \"输入要插入的文本\",\n                                        onInput: resizeContent\n                                    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                        [_vModelText, _unref(selectedMacro).content]\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            (_unref(selectedMacro))\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [\n                                    _cache[54] || (_cache[54] = _createElementVNode(\"label\", null, \"作用范围\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_20, [\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": _cache[8] || (_cache[8] = ($event) => ((_unref(selectedMacro).scope) = $event)),\n                                            class: \"macro-select\"\n                                        }, [...(_cache[53] || (_cache[53] = [\n                                                _createElementVNode(\"option\", { value: \"global\" }, \"全局快捷回复\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"character\" }, \"角色快捷回复\", -1 /* CACHED */)\n                                            ]))], 512 /* NEED_PATCH */), [\n                                            [_vModelSelect, _unref(selectedMacro).scope]\n                                        ]),\n                                        (_unref(selectedMacro).scope === 'character')\n                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                key: 0,\n                                                class: \"macro-btn is-ghost\",\n                                                type: \"button\",\n                                                onClick: _cache[9] || (_cache[9] =\n                                                    //@ts-ignore\n                                                    (...args) => (_unref(bindCurrentCharacter) && _unref(bindCurrentCharacter)(...args)))\n                                            }, \" 绑定当前角色 \"))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (_unref(selectedMacro).scope === 'character')\n                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_21, _toDisplayString(_unref(currentCharacterLabel)), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            (_unref(selectedMacro))\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, [\n                                    _cache[59] || (_cache[59] = _createElementVNode(\"label\", { class: \"macro-toggle\" }, \"发送方式\", -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"select\", {\n                                        \"onUpdate:modelValue\": _cache[10] || (_cache[10] = ($event) => ((actionMode).value = $event)),\n                                        class: \"macro-select\"\n                                    }, [...(_cache[55] || (_cache[55] = [\n                                            _createElementVNode(\"option\", { value: \"send\" }, \"直接发送\", -1 /* CACHED */),\n                                            _createElementVNode(\"option\", { value: \"append\" }, \"追加到输入框\", -1 /* CACHED */),\n                                            _createElementVNode(\"option\", { value: \"replace\" }, \"覆盖输入框\", -1 /* CACHED */)\n                                        ]))], 512 /* NEED_PATCH */), [\n                                        [_vModelSelect, actionMode.value]\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_23, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"checkbox\",\n                                            \"onUpdate:modelValue\": _cache[11] || (_cache[11] = ($event) => ((_unref(selectedMacro).newline) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(selectedMacro).newline]\n                                        ]),\n                                        _cache[56] || (_cache[56] = _createTextVNode(\" 自动换行\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"button\", {\n                                        class: \"macro-btn is-ghost\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedMacro),\n                                        onClick: _cache[12] || (_cache[12] = ($event) => (_unref(moveMacro)(-1)))\n                                    }, [...(_cache[57] || (_cache[57] = [\n                                            _createElementVNode(\"i\", {\n                                                class: \"macro-icon fa-solid fa-arrow-up\",\n                                                \"aria-hidden\": \"true\"\n                                            }, null, -1 /* CACHED */),\n                                            _createTextVNode(\" 上移 \", -1 /* CACHED */)\n                                        ]))], 8 /* PROPS */, _hoisted_24),\n                                    _createElementVNode(\"button\", {\n                                        class: \"macro-btn is-ghost\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedMacro),\n                                        onClick: _cache[13] || (_cache[13] = ($event) => (_unref(moveMacro)(1)))\n                                    }, [...(_cache[58] || (_cache[58] = [\n                                            _createElementVNode(\"i\", {\n                                                class: \"macro-icon fa-solid fa-arrow-down\",\n                                                \"aria-hidden\": \"true\"\n                                            }, null, -1 /* CACHED */),\n                                            _createTextVNode(\" 下移 \", -1 /* CACHED */)\n                                        ]))], 8 /* PROPS */, _hoisted_25)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ])\n                    ]),\n                    _createElementVNode(\"footer\", _hoisted_26, [\n                        _createElementVNode(\"button\", {\n                            class: \"macro-btn is-ghost\",\n                            type: \"button\",\n                            onClick: _cache[14] || (_cache[14] =\n                                //@ts-ignore\n                                (...args) => (_unref(close) && _unref(close)(...args)))\n                        }, [...(_cache[60] || (_cache[60] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-solid fa-xmark\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 取消 \", -1 /* CACHED */)\n                            ]))]),\n                        _createElementVNode(\"button\", {\n                            class: \"macro-btn is-primary\",\n                            type: \"button\",\n                            onClick: _cache[15] || (_cache[15] =\n                                //@ts-ignore\n                                (...args) => (_unref(save) && _unref(save)(...args)))\n                        }, [...(_cache[61] || (_cache[61] = [\n                                _createElementVNode(\"i\", {\n                                    class: \"macro-icon fa-solid fa-check\",\n                                    \"aria-hidden\": \"true\"\n                                }, null, -1 /* CACHED */),\n                                _createTextVNode(\" 保存 \", -1 /* CACHED */)\n                            ]))])\n                    ])\n                ]),\n                (libraryOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"macro-library-modal\",\n                        onClick: _cache[31] || (_cache[31] = _withModifiers(($event) => (libraryOpen.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"section\", _hoisted_27, [\n                            _createElementVNode(\"header\", _hoisted_28, [\n                                _cache[63] || (_cache[63] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"macro-theme-title\" }, \"宏库管理\"),\n                                    _createElementVNode(\"div\", { class: \"macro-theme-sub\" }, \"在这里选择需要显示在快捷回复的内容\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-close\",\n                                    type: \"button\",\n                                    \"aria-label\": \"关闭\",\n                                    title: \"关闭\",\n                                    onClick: _cache[16] || (_cache[16] = ($event) => (libraryOpen.value = false))\n                                }, [...(_cache[62] || (_cache[62] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-solid fa-xmark\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_29, [\n                                _createElementVNode(\"div\", _hoisted_30, [\n                                    _cache[65] || (_cache[65] = _createElementVNode(\"i\", {\n                                        class: \"macro-icon fa-solid fa-magnifying-glass\",\n                                        \"aria-hidden\": \"true\"\n                                    }, null, -1 /* CACHED */)),\n                                    _withDirectives(_createElementVNode(\"input\", {\n                                        \"onUpdate:modelValue\": _cache[17] || (_cache[17] = ($event) => ((searchTerm).value = $event)),\n                                        class: \"macro-search-input\",\n                                        placeholder: \"搜索名称或内容\"\n                                    }, null, 512 /* NEED_PATCH */), [\n                                        [_vModelText, searchTerm.value]\n                                    ]),\n                                    (searchTerm.value)\n                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                            key: 0,\n                                            class: \"macro-icon-btn is-ghost\",\n                                            type: \"button\",\n                                            \"aria-label\": \"清除\",\n                                            onClick: _cache[18] || (_cache[18] = ($event) => (searchTerm.value = ''))\n                                        }, [...(_cache[64] || (_cache[64] = [\n                                                _createElementVNode(\"i\", {\n                                                    class: \"macro-icon fa-solid fa-xmark\",\n                                                    \"aria-hidden\": \"true\"\n                                                }, null, -1 /* CACHED */)\n                                            ]))]))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_31, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"macro-filter-chip\", { active: scopeFilter.value === 'all' }]),\n                                        type: \"button\",\n                                        onClick: _cache[19] || (_cache[19] = ($event) => (scopeFilter.value = 'all'))\n                                    }, \" 全部 \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"macro-filter-chip\", { active: scopeFilter.value === 'global' }]),\n                                        type: \"button\",\n                                        onClick: _cache[20] || (_cache[20] = ($event) => (scopeFilter.value = 'global'))\n                                    }, \" 全局 \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"macro-filter-chip\", { active: scopeFilter.value === 'character' }]),\n                                        type: \"button\",\n                                        onClick: _cache[21] || (_cache[21] = ($event) => (scopeFilter.value = 'character'))\n                                    }, \" 角色 \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"macro-filter-chip\", { active: onlyPinned.value }]),\n                                        type: \"button\",\n                                        onClick: _cache[22] || (_cache[22] = ($event) => (onlyPinned.value = !onlyPinned.value))\n                                    }, [...(_cache[66] || (_cache[66] = [\n                                            _createElementVNode(\"i\", {\n                                                class: \"macro-icon fa-solid fa-star\",\n                                                \"aria-hidden\": \"true\"\n                                            }, null, -1 /* CACHED */),\n                                            _createTextVNode(\" 收藏 \", -1 /* CACHED */)\n                                        ]))], 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"macro-filter-chip\", { active: onlyRecent.value }]),\n                                        type: \"button\",\n                                        onClick: _cache[23] || (_cache[23] = ($event) => (onlyRecent.value = !onlyRecent.value))\n                                    }, [...(_cache[67] || (_cache[67] = [\n                                            _createElementVNode(\"i\", {\n                                                class: \"macro-icon fa-solid fa-clock-rotate-left\",\n                                                \"aria-hidden\": \"true\"\n                                            }, null, -1 /* CACHED */),\n                                            _createTextVNode(\" 最近 \", -1 /* CACHED */)\n                                        ]))], 2 /* CLASS */)\n                                ]),\n                                _createElementVNode(\"div\", {\n                                    class: _normalizeClass([\"macro-library-grid\", { 'is-editing': !!librarySelectedMacro.value }])\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_32, [\n                                        _createElementVNode(\"div\", _hoisted_33, [\n                                            (onlyRecent.value)\n                                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                                    _cache[68] || (_cache[68] = _createElementVNode(\"div\", { class: \"macro-subtitle\" }, \"最近使用\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"div\", _hoisted_34, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(recentMacros.value, (macro) => {\n                                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                                key: macro.id,\n                                                                class: _normalizeClass([\"macro-item\", { active: macro.id === librarySelectedId.value }]),\n                                                                onClick: ($event) => (selectLibraryMacro(macro.id)),\n                                                                role: \"button\",\n                                                                tabindex: \"0\",\n                                                                onKeydown: [\n                                                                    _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                                    _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"space\"])\n                                                                ]\n                                                            }, [\n                                                                _createVNode(MacroListItem, {\n                                                                    macro: macro,\n                                                                    mode: \"library\",\n                                                                    \"character-label\": getMacroCharacterLabel(macro),\n                                                                    onPin: togglePinned,\n                                                                    onToggle: toggleEnabled,\n                                                                    onEdit: editFromLibrary,\n                                                                    onDelete: deleteItem\n                                                                }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                            ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_35));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (!recentMacros.value.length)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_36, \"暂无最近使用\"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ])\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                                : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                                    (showRecentSection.value)\n                                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                                            _cache[69] || (_cache[69] = _createElementVNode(\"div\", { class: \"macro-subtitle\" }, \"最近使用\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"div\", _hoisted_37, [\n                                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(recentPreview.value, (macro) => {\n                                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                                        key: macro.id,\n                                                                        class: _normalizeClass([\"macro-item\", { active: macro.id === librarySelectedId.value }]),\n                                                                        onClick: ($event) => (selectLibraryMacro(macro.id)),\n                                                                        role: \"button\",\n                                                                        tabindex: \"0\",\n                                                                        onKeydown: [\n                                                                            _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                                            _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"space\"])\n                                                                        ]\n                                                                    }, [\n                                                                        _createVNode(MacroListItem, {\n                                                                            macro: macro,\n                                                                            mode: \"library\",\n                                                                            \"character-label\": getMacroCharacterLabel(macro),\n                                                                            onPin: togglePinned,\n                                                                            onToggle: toggleEnabled,\n                                                                            onEdit: editFromLibrary,\n                                                                            onDelete: deleteItem\n                                                                        }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                                    ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_38));\n                                                                }), 128 /* KEYED_FRAGMENT */))\n                                                            ])\n                                                        ], 64 /* STABLE_FRAGMENT */))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (groupedMacros.value.global.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_39, \"全局\"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (groupedMacros.value.global.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_40, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(groupedMacros.value.global, (macro) => {\n                                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: macro.id,\n                                                                    class: _normalizeClass([\"macro-item\", { active: macro.id === librarySelectedId.value }]),\n                                                                    onClick: ($event) => (selectLibraryMacro(macro.id)),\n                                                                    role: \"button\",\n                                                                    tabindex: \"0\",\n                                                                    onKeydown: [\n                                                                        _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                                        _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"space\"])\n                                                                    ]\n                                                                }, [\n                                                                    _createVNode(MacroListItem, {\n                                                                        macro: macro,\n                                                                        mode: \"library\",\n                                                                        \"character-label\": getMacroCharacterLabel(macro),\n                                                                        onPin: togglePinned,\n                                                                        onToggle: toggleEnabled,\n                                                                        onEdit: editFromLibrary,\n                                                                        onDelete: deleteItem\n                                                                    }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                                ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_41));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (groupedMacros.value.character.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_42, \"角色\"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (groupedMacros.value.character.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_43, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(groupedMacros.value.character, (macro) => {\n                                                                return (_openBlock(), _createElementBlock(\"div\", {\n                                                                    key: macro.id,\n                                                                    class: _normalizeClass([\"macro-item\", { active: macro.id === librarySelectedId.value }]),\n                                                                    onClick: ($event) => (selectLibraryMacro(macro.id)),\n                                                                    role: \"button\",\n                                                                    tabindex: \"0\",\n                                                                    onKeydown: [\n                                                                        _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"enter\"]),\n                                                                        _withKeys(_withModifiers(($event) => (selectLibraryMacro(macro.id)), [\"prevent\"]), [\"space\"])\n                                                                    ]\n                                                                }, [\n                                                                    _createVNode(MacroListItem, {\n                                                                        macro: macro,\n                                                                        mode: \"library\",\n                                                                        \"character-label\": getMacroCharacterLabel(macro),\n                                                                        onPin: togglePinned,\n                                                                        onToggle: toggleEnabled,\n                                                                        onEdit: editFromLibrary,\n                                                                        onDelete: deleteItem\n                                                                    }, null, 8 /* PROPS */, [\"macro\", \"character-label\"])\n                                                                ], 42 /* CLASS, PROPS, NEED_HYDRATION */, _hoisted_44));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (!groupedMacros.value.global.length && !groupedMacros.value.character.length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_45, \" 没有匹配的快捷语句 \"))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                        ])\n                                    ]),\n                                    (librarySelectedMacro.value)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_46, [\n                                            _createElementVNode(\"div\", _hoisted_47, [\n                                                _cache[78] || (_cache[78] = _createElementVNode(\"div\", { class: \"macro-section-title\" }, \"编辑宏\", -1 /* CACHED */)),\n                                                _createElementVNode(\"div\", _hoisted_48, [\n                                                    _cache[70] || (_cache[70] = _createElementVNode(\"label\", null, \"名称\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        class: \"macro-input\",\n                                                        \"onUpdate:modelValue\": _cache[24] || (_cache[24] = ($event) => ((librarySelectedMacro.value.name) = $event)),\n                                                        placeholder: \"例如：继续\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, librarySelectedMacro.value.name]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_49, [\n                                                    _cache[71] || (_cache[71] = _createElementVNode(\"label\", null, \"内容\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        ref_key: \"libraryContentRef\",\n                                                        ref: libraryContentRef,\n                                                        class: \"macro-textarea\",\n                                                        \"onUpdate:modelValue\": _cache[25] || (_cache[25] = ($event) => ((librarySelectedMacro.value.content) = $event)),\n                                                        placeholder: \"输入要插入的文本\",\n                                                        onInput: resizeLibraryContent\n                                                    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                        [_vModelText, librarySelectedMacro.value.content]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_50, [\n                                                    _cache[73] || (_cache[73] = _createElementVNode(\"label\", null, \"作用范围\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"div\", _hoisted_51, [\n                                                        _withDirectives(_createElementVNode(\"select\", {\n                                                            \"onUpdate:modelValue\": _cache[26] || (_cache[26] = ($event) => ((librarySelectedMacro.value.scope) = $event)),\n                                                            class: \"macro-select\"\n                                                        }, [...(_cache[72] || (_cache[72] = [\n                                                                _createElementVNode(\"option\", { value: \"global\" }, \"全局快捷回复\", -1 /* CACHED */),\n                                                                _createElementVNode(\"option\", { value: \"character\" }, \"角色快捷回复\", -1 /* CACHED */)\n                                                            ]))], 512 /* NEED_PATCH */), [\n                                                            [_vModelSelect, librarySelectedMacro.value.scope]\n                                                        ]),\n                                                        (librarySelectedMacro.value.scope === 'character')\n                                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: 0,\n                                                                class: \"macro-btn is-ghost\",\n                                                                type: \"button\",\n                                                                onClick: bindCurrentCharacterToLibrary\n                                                            }, \" 绑定当前角色 \"))\n                                                            : _createCommentVNode(\"v-if\", true),\n                                                        (librarySelectedMacro.value.scope === 'character')\n                                                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_52, _toDisplayString(getMacroCharacterLabel(librarySelectedMacro.value)), 1 /* TEXT */))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_53, [\n                                                    _cache[77] || (_cache[77] = _createElementVNode(\"label\", { class: \"macro-toggle\" }, \"发送方式\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"select\", {\n                                                        \"onUpdate:modelValue\": _cache[27] || (_cache[27] = ($event) => ((libraryActionMode).value = $event)),\n                                                        class: \"macro-select\"\n                                                    }, [...(_cache[74] || (_cache[74] = [\n                                                            _createElementVNode(\"option\", { value: \"send\" }, \"直接发送\", -1 /* CACHED */),\n                                                            _createElementVNode(\"option\", { value: \"append\" }, \"追加到输入框\", -1 /* CACHED */),\n                                                            _createElementVNode(\"option\", { value: \"replace\" }, \"覆盖输入框\", -1 /* CACHED */)\n                                                        ]))], 512 /* NEED_PATCH */), [\n                                                        [_vModelSelect, libraryActionMode.value]\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_54, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            type: \"checkbox\",\n                                                            \"onUpdate:modelValue\": _cache[28] || (_cache[28] = ($event) => ((librarySelectedMacro.value.newline) = $event))\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, librarySelectedMacro.value.newline]\n                                                        ]),\n                                                        _cache[75] || (_cache[75] = _createTextVNode(\" 自动换行 \", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_55, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            type: \"checkbox\",\n                                                            \"onUpdate:modelValue\": _cache[29] || (_cache[29] = ($event) => ((librarySelectedMacro.value.enabled) = $event))\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, librarySelectedMacro.value.enabled]\n                                                        ]),\n                                                        _cache[76] || (_cache[76] = _createTextVNode(\" 显示在快捷回复 \", -1 /* CACHED */))\n                                                    ])\n                                                ])\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ], 2 /* CLASS */)\n                            ]),\n                            _createElementVNode(\"footer\", _hoisted_56, [\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-btn is-ghost\",\n                                    type: \"button\",\n                                    onClick: addFromLibrary\n                                }, [...(_cache[79] || (_cache[79] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-solid fa-plus\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */),\n                                        _createTextVNode(\" 新增 \", -1 /* CACHED */)\n                                    ]))]),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[30] || (_cache[30] = ($event) => (libraryOpen.value = false))\n                                }, \"完成\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (themeOpen.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"macro-theme-modal\",\n                        onClick: _cache[42] || (_cache[42] = _withModifiers(($event) => (themeOpen.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"section\", _hoisted_57, [\n                            _createElementVNode(\"header\", _hoisted_58, [\n                                _cache[81] || (_cache[81] = _createElementVNode(\"div\", null, [\n                                    _createElementVNode(\"div\", { class: \"macro-theme-title\" }, \"主题配色\"),\n                                    _createElementVNode(\"div\", { class: \"macro-theme-sub\" }, \"选择预设或手动微调颜色\")\n                                ], -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-close\",\n                                    type: \"button\",\n                                    \"aria-label\": \"关闭\",\n                                    title: \"关闭\",\n                                    onClick: _cache[32] || (_cache[32] = ($event) => (themeOpen.value = false))\n                                }, [...(_cache[80] || (_cache[80] = [\n                                        _createElementVNode(\"i\", {\n                                            class: \"macro-icon fa-solid fa-xmark\",\n                                            \"aria-hidden\": \"true\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_59, [\n                                _createElementVNode(\"div\", _hoisted_60, [\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(themePresets), (preset) => {\n                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                            key: preset.name,\n                                            class: \"macro-theme-preset\",\n                                            type: \"button\",\n                                            onClick: ($event) => (applyPreset(preset.colors))\n                                        }, [\n                                            _createElementVNode(\"span\", {\n                                                class: \"macro-theme-dot\",\n                                                style: _normalizeStyle({ background: preset.colors.accent })\n                                            }, null, 4 /* STYLE */),\n                                            _createTextVNode(\" \" + _toDisplayString(preset.name), 1 /* TEXT */)\n                                        ], 8 /* PROPS */, _hoisted_61));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_62, [\n                                    _createElementVNode(\"div\", _hoisted_63, [\n                                        _cache[82] || (_cache[82] = _createElementVNode(\"span\", null, \"背景\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[33] || (_cache[33] = ($event) => ((_unref(theme).bg) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).bg]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_64, [\n                                        _cache[83] || (_cache[83] = _createElementVNode(\"span\", null, \"面板\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[34] || (_cache[34] = ($event) => ((_unref(theme).surface) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).surface]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_65, [\n                                        _cache[84] || (_cache[84] = _createElementVNode(\"span\", null, \"面板辅助\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[35] || (_cache[35] = ($event) => ((_unref(theme).surfaceAlt) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).surfaceAlt]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_66, [\n                                        _cache[85] || (_cache[85] = _createElementVNode(\"span\", null, \"文字\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[36] || (_cache[36] = ($event) => ((_unref(theme).text) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).text]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_67, [\n                                        _cache[86] || (_cache[86] = _createElementVNode(\"span\", null, \"次级文字\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[37] || (_cache[37] = ($event) => ((_unref(theme).textMuted) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).textMuted]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_68, [\n                                        _cache[87] || (_cache[87] = _createElementVNode(\"span\", null, \"强调色\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[38] || (_cache[38] = ($event) => ((_unref(theme).accent) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).accent]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_69, [\n                                        _cache[88] || (_cache[88] = _createElementVNode(\"span\", null, \"边框\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            type: \"color\",\n                                            \"onUpdate:modelValue\": _cache[39] || (_cache[39] = ($event) => ((_unref(theme).border) = $event))\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(theme).border]\n                                        ])\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"footer\", _hoisted_70, [\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-btn is-ghost\",\n                                    type: \"button\",\n                                    onClick: _cache[40] || (_cache[40] =\n                                        //@ts-ignore\n                                        (...args) => (_unref(resetTheme) && _unref(resetTheme)(...args)))\n                                }, \"恢复默认主题\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"macro-btn is-primary\",\n                                    type: \"button\",\n                                    onClick: _cache[41] || (_cache[41] = ($event) => (themeOpen.value = false))\n                                }, \"完成\")\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { computed, createApp, nextTick, ref, watch } from 'vue';\n\nimport { ensureScopeDefaults, getUniqueName, normalizeMacros } from '../core/macros';\nimport { DEFAULT_THEME, ThemeSchema } from '../core/schema';\nimport { getCurrentCharacterId, getCurrentCharacterLabel } from '../integration/character';\nimport App from './App.vue';\nimport { MacroUiKey } from './context';\nimport type { Macro, MacroUiContext, Theme } from './context';\nimport type { Settings } from '../core/schema';\nimport { buildStyleText } from './style';\n\nexport function createMacroManager(getSettings: () => Settings, onSave: (next: Settings) => void) {\n  const visible = ref(false);\n  const macros = ref<Macro[]>([]);\n  const theme = ref<Theme>({ ...DEFAULT_THEME });\n  const selectedId = ref<string | null>(null);\n  const selectedMacro = computed(() => macros.value.find(macro => macro.id === selectedId.value) ?? null);\n\n  let app: ReturnType<typeof createApp> | null = null;\n  let mountEl: HTMLDivElement | null = null;\n  let styleElement: HTMLStyleElement | null = null;\n  const hostFrame = window.frameElement as HTMLIFrameElement | null;\n\n  function setFrameLayout() {\n    if (!hostFrame) {\n      return;\n    }\n    hostFrame.style.position = 'fixed';\n    hostFrame.style.inset = '0';\n    hostFrame.style.width = '100vw';\n    hostFrame.style.height = '100vh';\n    hostFrame.style.border = 'none';\n    hostFrame.style.background = 'transparent';\n    hostFrame.style.zIndex = '9999';\n  }\n\n  function setFrameInteractivity(active: boolean) {\n    if (!hostFrame) {\n      return;\n    }\n    hostFrame.style.pointerEvents = active ? 'auto' : 'none';\n    hostFrame.style.display = active ? 'block' : 'none';\n  }\n\n  setFrameLayout();\n  setFrameInteractivity(false);\n\n  function applyThemeColors(nextTheme: Theme) {\n    const root = document.querySelector<HTMLElement>('.macro-root');\n    if (!root) {\n      return;\n    }\n    root.style.setProperty('--macro-bg', nextTheme.bg);\n    root.style.setProperty('--macro-surface', nextTheme.surface);\n    root.style.setProperty('--macro-surface-alt', nextTheme.surfaceAlt);\n    root.style.setProperty('--macro-text', nextTheme.text);\n    root.style.setProperty('--macro-text-muted', nextTheme.textMuted);\n    root.style.setProperty('--macro-accent', nextTheme.accent);\n    root.style.setProperty('--macro-border', nextTheme.border);\n  }\n\n  function syncFromSettings() {\n    const settings = getSettings();\n    macros.value = _.cloneDeep(settings.macros);\n    theme.value = _.cloneDeep(settings.theme);\n    if (macros.value.length && !selectedId.value) {\n      selectedId.value = macros.value[0].id;\n    }\n    if (selectedId.value && !macros.value.some(macro => macro.id === selectedId.value)) {\n      selectedId.value = macros.value[0]?.id ?? null;\n    }\n    applyThemeColors(theme.value);\n  }\n\n  function onKeydown(event: KeyboardEvent) {\n    if (event.key === 'Escape' && visible.value) {\n      close();\n    }\n  }\n\n  function ensureMounted() {\n    if (mountEl) {\n      return;\n    }\n    if (!document.body || !document.head) {\n      setTimeout(ensureMounted, 50);\n      return;\n    }\n\n    setFrameLayout();\n    styleElement = document.createElement('style');\n    styleElement.setAttribute('data-macro-style', getScriptId());\n    styleElement.textContent = buildStyleText();\n    document.head.appendChild(styleElement);\n\n    mountEl = document.createElement('div');\n    mountEl.className = 'macro-mount';\n    mountEl.setAttribute('script_id', getScriptId());\n    document.body.appendChild(mountEl);\n\n    app = createApp(App);\n    const currentCharacterLabel = computed(() => getCurrentCharacterLabel());\n    const uiContext: MacroUiContext = {\n      visible,\n      macros,\n      theme,\n      selectedId,\n      selectedMacro,\n      selectMacro: id => {\n        selectedId.value = id;\n      },\n      currentCharacterLabel,\n      bindCurrentCharacter: () => {\n        const current = selectedMacro.value;\n        if (!current) {\n          return;\n        }\n        current.scope = 'character';\n        current.characterId = getCurrentCharacterId();\n      },\n      close: () => {\n        visible.value = false;\n      },\n      addMacro: () => {\n        const name = getUniqueName('新快捷语句', macros.value);\n        const macro: Macro = {\n          id: SillyTavern.uuidv4(),\n          name,\n          content: '',\n          send: false,\n          append: false,\n          newline: true,\n          scope: 'global',\n          characterId: '',\n          pinned: false,\n          lastUsedAt: 0,\n          enabled: true,\n        };\n        macros.value.push(macro);\n        selectedId.value = macro.id;\n      },\n      duplicateMacro: () => {\n        const current = selectedMacro.value;\n        if (!current) {\n          return;\n        }\n        const name = getUniqueName(`${current.name} 副本`, macros.value);\n        const macro: Macro = {\n          ..._.cloneDeep(current),\n          id: SillyTavern.uuidv4(),\n          name,\n        };\n        macros.value.push(macro);\n        selectedId.value = macro.id;\n      },\n      removeMacro: () => {\n        const current = selectedMacro.value;\n        if (!current) {\n          return;\n        }\n        const next = macros.value.filter(macro => macro.id !== current.id);\n        macros.value = next;\n        selectedId.value = next[0]?.id ?? null;\n      },\n      moveMacro: delta => {\n        const current = selectedMacro.value;\n        if (!current) {\n          return;\n        }\n        const index = macros.value.findIndex(macro => macro.id === current.id);\n        const nextIndex = index + delta;\n        if (nextIndex < 0 || nextIndex >= macros.value.length) {\n          return;\n        }\n        const reordered = [...macros.value];\n        const [item] = reordered.splice(index, 1);\n        reordered.splice(nextIndex, 0, item);\n        macros.value = reordered;\n      },\n      resetTheme: () => {\n        theme.value = { ...DEFAULT_THEME };\n      },\n      save: () => {\n        const normalized = normalizeMacros(ensureScopeDefaults(macros.value, getCurrentCharacterId()));\n        normalized.warnings.forEach(warning => toastr.warning(warning));\n        const nextSettings: Settings = {\n          macros: normalized.macros,\n          theme: ThemeSchema.parse(theme.value),\n        };\n        onSave(nextSettings);\n        visible.value = false;\n      },\n    };\n    app.provide(MacroUiKey, uiContext);\n    app.mount(mountEl);\n    applyThemeColors(ThemeSchema.parse(theme.value));\n    setFrameInteractivity(visible.value);\n  }\n\n  watch(\n    () => theme.value,\n    nextTheme => applyThemeColors(ThemeSchema.parse(nextTheme)),\n    { deep: true },\n  );\n\n  watch(\n    () => visible.value,\n    async nextVisible => {\n      if (nextVisible) {\n        await nextTick();\n        setFrameInteractivity(true);\n      } else {\n        setFrameInteractivity(false);\n      }\n    },\n  );\n\n  function open() {\n    ensureMounted();\n    syncFromSettings();\n    visible.value = true;\n    setTimeout(() => {\n      const input = document.querySelector<HTMLInputElement>('[data-focus=\"name\"]');\n      input?.focus();\n    }, 0);\n  }\n\n  function close() {\n    visible.value = false;\n    setFrameInteractivity(false);\n  }\n\n  window.parent.addEventListener('keydown', onKeydown);\n\n  return {\n    open,\n    syncFromSettings,\n    destroy: () => {\n      window.parent.removeEventListener('keydown', onKeydown);\n      app?.unmount();\n      mountEl?.remove();\n      styleElement?.remove();\n      mountEl = null;\n      styleElement = null;\n      app = null;\n      setFrameInteractivity(false);\n    },\n  };\n}\n","export function buildStyleText() {\n  return `\n    @import url('https://cdn.jsdelivr.net/gh/lxgw/LxgwWenkai-Webfont@1.7.0/style.css');\n    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css');\n\n    .macro-root {\n      position: fixed;\n      inset: 0;\n      width: 100vw;\n      height: 100vh;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n      font-family: \"LXGW WenKai\", \"PingFang SC\", \"Microsoft YaHei\", sans-serif;\n      color: var(--macro-text, #f5f5f7);\n      background: transparent;\n      --macro-bg: #f6f1ea;\n      --macro-surface: #ffffff;\n      --macro-surface-alt: #f1ebe4;\n      --macro-text: #1c1c1c;\n      --macro-text-muted: #6a5f54;\n      --macro-accent: #d9934f;\n      --macro-border: #e3d6c9;\n      --macro-shadow: 0 22px 48px rgba(43, 34, 24, 0.22);\n      --macro-ring: rgba(217, 147, 79, 0.18);\n      z-index: 9999;\n    }\n\n    html, body {\n      margin: 0;\n      padding: 0;\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      background: transparent;\n    }\n\n    .macro-root.open {\n      display: flex;\n    }\n\n    .macro-root.open .macro-panel {\n      animation: macro-panel-enter 0.22s ease;\n    }\n\n    .macro-root.open .macro-backdrop {\n      animation: macro-backdrop-fade 0.22s ease;\n    }\n\n    .macro-backdrop {\n      position: absolute;\n      inset: 0;\n      background: rgba(12, 14, 18, 0.52);\n      backdrop-filter: blur(8px) saturate(1.05);\n    }\n\n    .macro-panel {\n      position: relative;\n      width: min(920px, 100%);\n      max-width: 100%;\n      max-height: min(720px, 86vh);\n      height: auto;\n      background: var(--macro-surface) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 22px;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n      box-shadow: var(--macro-shadow);\n      z-index: 1;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px;\n      border-bottom: 1px solid var(--macro-border);\n      background: linear-gradient(135deg, rgba(217, 147, 79, 0.18), rgba(255, 250, 243, 0.9));\n    }\n\n    .macro-header-actions {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n    }\n\n    .macro-title__main {\n      font-size: 18px;\n      font-weight: 600;\n      letter-spacing: 0.6px;\n    }\n\n    .macro-title__sub {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      margin-top: 4px;\n    }\n\n    .macro-close {\n      border: 1px solid var(--macro-border);\n      background: var(--macro-surface);\n      color: var(--macro-text);\n      border-radius: 999px;\n      width: 34px;\n      height: 34px;\n      padding: 0;\n      cursor: pointer;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .macro-icon-btn {\n      border: 1px solid var(--macro-border);\n      background: var(--macro-surface);\n      color: var(--macro-text);\n      border-radius: 999px;\n      width: 32px;\n      height: 32px;\n      padding: 0;\n      cursor: pointer;\n      font-size: 12px;\n      line-height: 1;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .macro-icon {\n      font-size: 14px;\n      line-height: 1;\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      opacity: 0.88;\n    }\n\n    .macro-icon.is-pinned {\n      color: var(--macro-accent);\n      opacity: 1;\n    }\n\n    .macro-icon-btn,\n    .macro-btn,\n    .macro-close,\n    .macro-select {\n      transition:\n        background-color 0.18s ease,\n        border-color 0.18s ease,\n        box-shadow 0.18s ease,\n        transform 0.18s ease;\n    }\n\n    .macro-icon-btn:hover,\n    .macro-close:hover {\n      background: color-mix(in srgb, var(--macro-surface) 78%, var(--macro-accent) 22%);\n      border-color: color-mix(in srgb, var(--macro-border) 40%, var(--macro-accent) 60%);\n    }\n\n    .macro-btn:hover {\n      background: color-mix(in srgb, var(--macro-surface) 78%, var(--macro-accent) 22%);\n      border-color: color-mix(in srgb, var(--macro-border) 40%, var(--macro-accent) 60%);\n    }\n\n    .macro-icon-btn:active,\n    .macro-btn:active,\n    .macro-close:active {\n      transform: translateY(1px) scale(0.98);\n    }\n\n    .macro-icon-btn.is-ghost {\n      border-color: transparent;\n      background: transparent;\n      width: 26px;\n      height: 26px;\n    }\n\n    .macro-icon-btn.is-ghost:hover {\n      background: color-mix(in srgb, var(--macro-surface) 70%, var(--macro-accent) 30%);\n    }\n\n    .macro-btn:disabled,\n    .macro-icon-btn:disabled,\n    .macro-close:disabled {\n      opacity: 0.45;\n      cursor: not-allowed;\n      transform: none;\n      box-shadow: none;\n    }\n\n    .macro-icon-btn:focus-visible,\n    .macro-btn:focus-visible,\n    .macro-close:focus-visible,\n    .macro-select:focus-visible {\n      outline: none;\n      border-color: var(--macro-accent);\n      box-shadow: 0 0 0 3px var(--macro-ring);\n    }\n\n    .macro-body {\n      flex: 1;\n      display: grid;\n      grid-template-columns: 280px minmax(0, 1fr);\n      min-height: 0;\n      min-width: 0;\n      overflow-x: hidden;\n    }\n\n    .macro-sidebar {\n      border-right: 1px solid var(--macro-border) !important;\n      background: color-mix(in srgb, var(--macro-surface) 70%, var(--macro-surface-alt) 30%) !important;\n      display: flex;\n      flex-direction: column;\n      min-height: 0;\n      min-width: 0;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-section-title {\n      padding: 14px 16px;\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      text-transform: uppercase;\n      letter-spacing: 1.2px;\n    }\n\n    .macro-list {\n      flex: 1;\n      overflow: auto;\n      overflow-x: hidden;\n      padding: 0 12px 12px;\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n    }\n\n    .macro-group {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .macro-subtitle {\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: 1.4px;\n      color: var(--macro-text-muted);\n      padding: 2px 6px 0;\n    }\n\n    .macro-empty-list {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      padding: 6px 6px 2px;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .macro-empty-list .macro-btn {\n      align-self: flex-start;\n    }\n\n    .macro-item {\n      border: 1px solid transparent;\n      background: color-mix(in srgb, var(--macro-surface) 92%, transparent);\n      border-radius: 12px;\n      padding: 10px 12px;\n      margin-bottom: 0;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      text-align: left;\n      color: inherit;\n      width: 100%;\n      box-sizing: border-box;\n    }\n\n    .macro-item:focus-visible {\n      outline: none;\n      border-color: var(--macro-accent);\n      box-shadow: 0 0 0 3px var(--macro-ring);\n    }\n\n    .macro-item__row {\n      display: grid;\n      grid-template-columns: minmax(0, 1fr) auto;\n      align-items: center;\n      gap: 10px;\n    }\n\n    .macro-item__actions {\n      display: flex;\n      gap: 6px;\n      flex-shrink: 0;\n    }\n\n    .macro-search {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 0 16px 10px;\n    }\n\n    .macro-search-input {\n      flex: 1;\n      border: 1px solid var(--macro-border);\n      background: var(--macro-surface);\n      color: var(--macro-text);\n      border-radius: 999px;\n      padding: 6px 12px;\n      font-size: 12px;\n    }\n\n    .macro-search-input:focus {\n      outline: none;\n      border-color: var(--macro-accent);\n      box-shadow: 0 0 0 3px var(--macro-ring);\n    }\n\n    .macro-filters {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n      padding: 0 16px 10px;\n    }\n\n    .macro-filter-chip {\n      border: 1px solid var(--macro-border);\n      background: var(--macro-surface);\n      color: var(--macro-text);\n      border-radius: 999px;\n      padding: 4px 10px;\n      font-size: 12px;\n      cursor: pointer;\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      transition: all 0.18s ease;\n    }\n\n    .macro-filter-chip.active {\n      background: color-mix(in srgb, var(--macro-accent) 20%, var(--macro-surface) 80%);\n      border-color: color-mix(in srgb, var(--macro-border) 40%, var(--macro-accent) 60%);\n      color: var(--macro-text);\n    }\n\n    .macro-filter-chip:hover {\n      background: color-mix(in srgb, var(--macro-surface) 78%, var(--macro-accent) 22%);\n      border-color: color-mix(in srgb, var(--macro-border) 40%, var(--macro-accent) 60%);\n    }\n\n    .macro-filter-chip .macro-icon {\n      font-size: 12px;\n    }\n\n    .macro-item__actions .macro-icon-btn {\n      width: 28px;\n      height: 28px;\n    }\n\n    .macro-item.active {\n      border-color: var(--macro-accent);\n      background: color-mix(in srgb, var(--macro-accent) 12%, var(--macro-surface) 88%);\n    }\n\n    .macro-item__name {\n      font-size: 14px;\n      font-weight: 600;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    .macro-item__meta {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n    }\n\n    .macro-actions {\n      display: flex;\n      gap: 8px;\n      padding: 12px 16px 16px;\n      border-top: 1px solid var(--macro-border);\n    }\n\n    .macro-content {\n      display: flex;\n      flex-direction: column;\n      gap: 18px;\n      padding: 18px 20px;\n      overflow: auto;\n      overflow-x: hidden;\n      min-width: 0;\n      background: var(--macro-surface) !important;\n      color: var(--macro-text) !important;\n    }\n\n    .macro-field {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    .macro-field label {\n      font-size: 13px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-input,\n    .macro-textarea {\n      width: 100%;\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 12px;\n      padding: 10px 12px;\n      font-size: 14px;\n      box-shadow: none !important;\n    }\n\n    .macro-textarea {\n      min-height: 140px;\n      resize: vertical;\n    }\n\n    .macro-input:focus,\n    .macro-textarea:focus {\n      outline: none;\n      border-color: var(--macro-accent) !important;\n      box-shadow: 0 0 0 3px var(--macro-ring) !important;\n    }\n\n    .macro-root input,\n    .macro-root textarea {\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border-color: var(--macro-border) !important;\n      box-shadow: none !important;\n      filter: none !important;\n    }\n\n    .macro-empty {\n      font-size: 13px;\n      color: var(--macro-text-muted);\n      padding: 8px 0;\n    }\n\n    .macro-toggle-row {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12px;\n      align-items: center;\n    }\n\n    .macro-toggle {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      font-size: 13px;\n    }\n\n    .macro-tag {\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n      padding: 2px 8px;\n      border-radius: 999px;\n      background: color-mix(in srgb, var(--macro-surface-alt) 70%, transparent);\n      border: 1px solid color-mix(in srgb, var(--macro-border) 80%, transparent);\n      font-size: 11px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-tag .macro-icon {\n      font-size: 12px;\n      opacity: 0.8;\n    }\n\n    .macro-theme-grid {\n      display: grid;\n      grid-template-columns: repeat(2, minmax(0, 1fr));\n      gap: 12px;\n    }\n\n    .macro-theme-modal {\n      position: absolute;\n      inset: 0;\n      background: rgba(12, 14, 18, 0.55);\n      backdrop-filter: blur(6px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 24px;\n      z-index: 2;\n    }\n\n    .macro-library-modal {\n      position: absolute;\n      inset: 0;\n      background: rgba(12, 14, 18, 0.55);\n      backdrop-filter: blur(6px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 24px;\n      z-index: 2;\n    }\n\n    .macro-library-panel {\n      width: min(920px, 100%);\n      max-height: min(760px, 90vh);\n      background: var(--macro-surface);\n      border: 1px solid var(--macro-border);\n      border-radius: 18px;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n      box-shadow: var(--macro-shadow);\n    }\n\n    .macro-library-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px 0;\n    }\n\n    .macro-library-body {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      padding: 8px 0 12px;\n      overflow: auto;\n      flex: 1;\n    }\n\n    .macro-library-grid {\n      display: grid;\n      grid-template-columns: 1fr;\n      gap: 16px;\n      padding: 0 20px 12px;\n      min-height: 0;\n    }\n\n    .macro-library-grid.is-editing {\n      grid-template-columns: minmax(0, 1fr) minmax(0, 360px);\n    }\n\n    .macro-library-list,\n    .macro-library-editor {\n      min-width: 0;\n      min-height: 0;\n    }\n\n    .macro-library-editor {\n      border-left: 1px solid var(--macro-border);\n      padding-left: 16px;\n      overflow: auto;\n      max-height: 100%;\n    }\n\n    .macro-library-list .macro-list {\n      padding: 0;\n    }\n\n    .macro-editor {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .macro-library-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      padding: 14px 20px;\n      border-top: 1px solid var(--macro-border);\n      background: var(--macro-surface-alt);\n    }\n\n    .macro-library-body .macro-search,\n    .macro-library-body .macro-filters {\n      padding: 0 20px 10px;\n    }\n\n    .macro-theme-panel {\n      width: min(720px, 92vw);\n      background: var(--macro-surface);\n      border: 1px solid var(--macro-border);\n      border-radius: 18px;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      box-shadow: var(--macro-shadow);\n    }\n\n    .macro-theme-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16px 20px 0;\n    }\n\n    .macro-theme-title {\n      font-size: 18px;\n      font-weight: 600;\n    }\n\n    .macro-theme-sub {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      margin-top: 4px;\n    }\n\n    .macro-theme-body {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      padding: 0 20px;\n    }\n\n    .macro-theme-presets {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n    }\n\n    .macro-theme-preset {\n      border: 1px solid var(--macro-border);\n      background: rgba(12, 14, 20, 0.12);\n      color: var(--macro-text);\n      border-radius: 999px;\n      padding: 6px 14px;\n      font-size: 13px;\n      cursor: pointer;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .macro-theme-dot {\n      width: 10px;\n      height: 10px;\n      border-radius: 50%;\n      display: inline-block;\n    }\n\n    .macro-theme-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      padding: 0 20px 18px;\n    }\n\n    .macro-select {\n      appearance: none;\n      background: var(--macro-surface-alt) !important;\n      color: var(--macro-text) !important;\n      border: 1px solid var(--macro-border) !important;\n      border-radius: 12px;\n      padding: 8px 36px 8px 12px;\n      font-size: 13px;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236a5f54' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\n      background-repeat: no-repeat;\n      background-position: right 10px center;\n      background-size: 14px;\n    }\n\n    .macro-scope-row {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      flex-wrap: wrap;\n    }\n\n    .macro-scope-hint {\n      font-size: 12px;\n      color: var(--macro-text-muted);\n      max-width: 220px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n    }\n\n    .macro-theme-item {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 10px;\n      background: color-mix(in srgb, var(--macro-surface) 86%, var(--macro-text) 14%);\n      border: 1px solid var(--macro-border);\n      border-radius: 12px;\n      padding: 8px 10px;\n      font-size: 12px;\n      color: var(--macro-text-muted);\n    }\n\n    .macro-theme-item input[type=\"color\"] {\n      border: none;\n      background: transparent;\n      width: 36px;\n      height: 24px;\n      padding: 0;\n    }\n\n    .macro-btn {\n      border: 1px solid var(--macro-border);\n      background: color-mix(in srgb, var(--macro-surface) 88%, var(--macro-text) 12%);\n      color: var(--macro-text);\n      border-radius: 12px;\n      padding: 8px 12px;\n      font-size: 13px;\n      cursor: pointer;\n      display: inline-flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    .macro-btn.is-primary {\n      border-color: var(--macro-accent);\n      background: var(--macro-accent);\n      color: #05131b;\n      font-weight: 600;\n    }\n\n    .macro-btn.is-ghost {\n      background: transparent;\n    }\n\n    .macro-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 10px;\n      padding: 14px 20px;\n      border-top: 1px solid var(--macro-border);\n      background: linear-gradient(180deg, color-mix(in srgb, var(--macro-surface) 90%, transparent), var(--macro-surface-alt));\n    }\n\n    .macro-list::-webkit-scrollbar,\n    .macro-content::-webkit-scrollbar {\n      width: 8px;\n      height: 8px;\n    }\n\n    .macro-list::-webkit-scrollbar-thumb,\n    .macro-content::-webkit-scrollbar-thumb {\n      background: color-mix(in srgb, var(--macro-text) 15%, transparent);\n      border-radius: 999px;\n    }\n\n    @media (max-width: 900px) {\n      .macro-root {\n        padding: 12px;\n      }\n\n      .macro-body {\n        grid-template-columns: 1fr;\n      }\n\n      .macro-sidebar {\n        border-right: none;\n        border-bottom: 1px solid var(--macro-border);\n      }\n\n      .macro-library-grid {\n        grid-template-columns: 1fr;\n      }\n\n      .macro-library-editor {\n        border-left: none;\n        border-top: 1px solid var(--macro-border);\n        padding-left: 0;\n        padding-top: 16px;\n      }\n    }\n\n    @media (max-width: 640px) {\n      .macro-panel,\n      .macro-library-panel {\n        width: 100%;\n        max-height: 92vh;\n        border-radius: 16px;\n      }\n    }\n\n    @keyframes macro-panel-enter {\n      from {\n        opacity: 0;\n        transform: translateY(10px) scale(0.98);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n    }\n\n    @keyframes macro-backdrop-fade {\n      from {\n        opacity: 0;\n      }\n      to {\n        opacity: 1;\n      }\n    }\n  `;\n}\n","import { createMacroButtonManager } from '../integration/buttons';\nimport { getCurrentCharacterId } from '../integration/character';\nimport { applyMacro } from '../integration/input';\nimport { normalizeMacros } from '../core/macros';\nimport { loadSettings, saveSettings } from '../core/settings';\nimport { ThemeSchema } from '../core/schema';\nimport { createMacroManager } from '../ui/manager';\nimport type { Macro } from '../ui/context';\n\nexport function initMacroManager() {\n  let settings = loadSettings(getCurrentCharacterId);\n  const normalized = normalizeMacros(settings.macros);\n  if (normalized.warnings.length) {\n    normalized.warnings.forEach(warning => toastr.warning(warning));\n  }\n  settings = {\n    macros: normalized.macros,\n    theme: ThemeSchema.parse(settings.theme),\n  };\n  saveSettings(settings);\n  let manager: ReturnType<typeof createMacroManager>;\n\n  const applyMacroWithUsage = async (macro: Macro) => {\n    await applyMacro(macro);\n    const target = settings.macros.find(item => item.id === macro.id);\n    if (!target) {\n      return;\n    }\n    target.lastUsedAt = Date.now();\n    saveSettings(settings);\n    manager?.syncFromSettings();\n  };\n\n  const buttonManager = createMacroButtonManager({ getCurrentCharacterId, applyMacro: applyMacroWithUsage });\n  buttonManager.render(settings);\n  buttonManager.bind(settings);\n\n  manager = createMacroManager(\n    () => settings,\n    nextSettings => {\n      settings = nextSettings;\n      saveSettings(settings);\n      buttonManager.render(settings);\n      buttonManager.bind(settings);\n    },\n  );\n\n  buttonManager.ensureManageButton(manager);\n\n  const refreshOnChat = eventOn(tavern_events.CHAT_CHANGED, () => {\n    buttonManager.render(settings);\n    buttonManager.bind(settings);\n  });\n\n  $(window).on('pagehide', () => {\n    refreshOnChat.stop();\n    buttonManager.dispose();\n    manager.destroy();\n  });\n}\n","import { initMacroManager } from './entry/portal';\n\n$(() => {\n  errorCatched(initMacroManager)();\n});\n"],"names":["SCRIPT_OPTION","type","script_id","getScriptId","MANAGE_BUTTON_NAME","getVisibleMacros","settings","currentId","macros","filter","macro","enabled","scope","characterId","getCurrentCharacterId","raw","SillyTavern","getContext","String","macroActionStrategies","id","prepare","ctx","state","mode","send","append","newline","afterApply","async","replacement","trim","setInputValue","activateSendButtons","setTimeout","$button","$","first","length","trigger","toastr","warning","clickSendButton","clearInput","applyMacro","$input","selectors","selector","findInput","error","current","val","input","content","setContent","value","setReplacement","strategies","forEach","strategy","prefix","buildMacroReplacement","runMacroActionPipeline","ensureMacroIds","map","uuidv4","ensureScopeDefaults","normalizeMacros","warnings","seen","Set","normalized","name","has","push","add","getUniqueName","baseName","existing","index","z","ThemeSchema","object","bg","string","default","surface","surfaceAlt","text","textMuted","accent","border","prefault","MacroSchema","boolean","enum","pinned","lastUsedAt","number","SettingsSchema","array","theme","parse","DEFAULT_MACROS","DEFAULT_THEME","saveSettings","replaceVariables","Vue","MacroUiKey","Symbol","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","key","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","__name","props","characterLabel","emits","setup","__props","emit","__emit","_ctx","_cache","title","onClick","$event","themePresets","colors","role","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","inject","Error","visible","selectedId","selectedMacro","selectMacro","currentCharacterLabel","bindCurrentCharacter","close","addMacro","duplicateMacro","removeMacro","moveMacro","resetTheme","save","themeOpen","ref","libraryOpen","librarySelectedId","searchTerm","scopeFilter","onlyPinned","onlyRecent","contentRef","libraryContentRef","normalizedSearch","computed","toLowerCase","matchesMacro","query","includes","filteredMacros","activeMacros","recentAll","sort","a","b","recentMacros","recentPreview","slice","showRecentSection","orderPinnedFirst","list","groupedMacros","global","character","activeGrouped","librarySelectedMacro","find","actionMode","get","set","getMacroCharacterLabel","idx","Number","characters","isNaN","getCharacterLabelById","resizeContent","el","style","height","scrollHeight","resizeLibraryContent","watch","nextTick","immediate","nextVisible","nextOpen","next","some","deep","duplicateItem","deleteItem","findIndex","wasSelectedMain","wasSelectedLibrary","splice","togglePinned","target","toggleEnabled","hideFromList","editFromLibrary","selectLibraryMacro","addFromLibrary","selectInMain","createMacroDraft","openLibrary","resetSelection","libraryActionMode","bindCurrentCharacterToLibrary","open","args","active","tabindex","onKeydown","MacroListItem","onPin","onDuplicate","onHide","placeholder","ref_key","onInput","disabled","onToggle","onEdit","onDelete","preset","background","createMacroManager","getSettings","onSave","app","mountEl","styleElement","hostFrame","window","frameElement","setFrameLayout","position","inset","width","zIndex","setFrameInteractivity","pointerEvents","display","applyThemeColors","nextTheme","root","document","querySelector","setProperty","syncFromSettings","_","cloneDeep","event","ensureMounted","body","head","createElement","setAttribute","textContent","appendChild","className","createApp","App","getCurrentCharacterLabel","uiContext","delta","nextIndex","reordered","item","nextSettings","provide","mount","parent","addEventListener","focus","destroy","removeEventListener","unmount","remove","initMacroManager","getVariables","Array","isArray","loadSettings","manager","buttonManager","options","macroButtonStops","manageButtonStop","clearMacroButtonEvents","pop","stop","render","visibleMacros","buttons","replaceScriptButtons","bind","eventOn","getButtonEvent","ensureManageButton","dispose","createMacroButtonManager","Date","now","refreshOnChat","tavern_events","CHAT_CHANGED","on","errorCatched"],"sourceRoot":""}