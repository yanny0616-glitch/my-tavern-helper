function e(){return(window.parent?.SillyTavern??window.SillyTavern).getContext()}function n(e){return e.extensionSettings??{}}function t(){return window??(window.parent||{})}function a(){const n=e(),t=n?.getRequestHeaders?.();return t??{'Content-Type':'application/json'}}function i(e){const n=t();return'function'==typeof n.getExtensionType?n.getExtensionType(e):null}async function o(e){const n=t();if('function'==typeof n.getExtensionInstallationInfo){const t=e.filter(e=>'third-party'===e.kind),a=await Promise.all(t.map(async e=>{try{const t=await n.getExtensionInstallationInfo(e.name),a=n.getExtensionType?n.getExtensionType(e.name):null,i=!(!t||'system'===a)&&('global'!==a||(!n.isAdmin||n.isAdmin())),o=t?t.is_up_to_date?'up-to-date':'update-available':'unknown';return{name:e.name,update:{status:o,info:t,type:a,canUpdate:i}}}catch{return{name:e.name,update:{status:'error'}}}})),i=new Map(a.map(e=>[e.name,e.update]));return e.map(e=>({...e,update:i.get(e.name)??e.update}))}const o=e.filter(e=>'third-party'===e.kind),r=await Promise.all(o.map(async e=>{const n=i(e.name),t=await async function(e,n){try{const t=await fetch('/api/extensions/version',{method:'POST',headers:a(),body:JSON.stringify({extensionName:e,global:n})});return t.ok?await t.json():null}catch{return null}}(e.name,'global'===n);if(!t)return{name:e.name,update:{status:'unknown'}};const o=t.isUpToDate?'up-to-date':'update-available';return{name:e.name,update:{status:o,info:{current_branch_name:t.currentBranchName,current_commit_hash:t.currentCommitHash,is_up_to_date:t.isUpToDate,remote_url:t.remoteUrl},type:n,canUpdate:!t.isUpToDate}}})),l=new Map(r.map(e=>[e.name,e.update]));return e.map(e=>({...e,update:l.get(e.name)??{status:'unknown'}}))}async function r(e){const n={};return await Promise.all(e.map(async e=>{const t=await async function(e){const n=[`/scripts/extensions/third-party/${e}/manifest.json`,`/scripts/extensions/third-party/${e}/manifest.yaml`,`/scripts/extensions/third-party/${e}/manifest.yml`];for(const t of n)try{const n=await fetch(t,{method:'GET'});if(!n.ok)continue;const a=await n.text();if(t.endsWith('.json')){const n=JSON.parse(a),t=n.displayName||n.display_name||n.title||n.name;if(t&&t!==e)return t}}catch{continue}return null}(e);t&&(n[e]=t)})),n}async function l(e,t){const a=function(e){const t=(n(e).disabledExtensions??[]).filter(e=>'string'==typeof e&&e.startsWith('third-party/')).map(e=>e.replace(/^third-party\//,''));return new Set(t)}(t),i=function(e){const n=new Set,t=['link[href*="/scripts/extensions/third-party/"]','script[src*="/scripts/extensions/third-party/"]','img[src*="/scripts/extensions/third-party/"]'].join(',');return e.querySelectorAll(t).forEach(e=>{const t=(e.getAttribute('href')||e.getAttribute('src')||'').match(/\/scripts\/extensions\/third-party\/([^/]+)\//);t&&n.add(t[1])}),Array.from(n).sort((e,n)=>e.localeCompare(n))}(e),l=function(e){const n=new Set,t=['link[href*="/scripts/extensions/"]','script[src*="/scripts/extensions/"]'].join(',');return e.querySelectorAll(t).forEach(e=>{const t=e.getAttribute('href')||e.getAttribute('src')||'';if(t.includes('/third-party/'))return;const a=t.match(/\/scripts\/extensions\/([^/]+)\//);a&&n.add(a[1])}),Array.from(n).sort((e,n)=>e.localeCompare(n))}(e),s=new Set([...i,...a]),c=await r(Array.from(s));return o([...Array.from(s).sort((e,n)=>e.localeCompare(n)).map(e=>({name:e,displayName:c[e],kind:'third-party',status:a.has(e)?'disabled':'enabled'})),...l.map(e=>({name:e,kind:'core',status:'enabled'}))])}const s=Vue,c=(0,s.reactive)({open:!1,loading:!1,filter:'',entries:[],updateSelection:{},updating:!1}),d={};function p(e){c.open=e}function u(e){c.loading=e}function m(e){c.filter=e}function f(e){c.entries=e,function(e){const n=new Set(e.filter(e=>'update-available'===e.update?.status).map(e=>e.name));Object.keys(c.updateSelection).forEach(e=>{n.has(e)||delete c.updateSelection[e]})}(e)}function g(e,n){n?c.updateSelection[e]=!0:delete c.updateSelection[e]}function x(e){c.updating=e}const b={class:'em-root'},h={class:'em-header'},y={class:'em-actions'},v={class:'em-body'},w=['value'],k={class:'em-toolbar-row'},E={class:'em-toolbar'},N=['data-count','title'],V={key:0,class:'em-loading'},C={class:'em-list'},S={key:0,class:'em-empty'},B={class:'em-item-name'},j={key:0,class:'em-tag core'},M={key:1,class:'em-update-pill',title:'有更新'},T={key:0,class:'em-item-meta'},A={class:'em-item-meta'},L={class:'em-item-actions'},P=['disabled','onClick'],q=['title','onClick'],D=['disabled','aria-checked','onClick','title'],O={key:1,class:'em-confirm'},I={class:'em-confirm-card'},U={class:'em-confirm-desc'},H={class:'em-confirm-actions'},J=['disabled'],R=(0,s.defineComponent)({__name:'App',setup(o){const r=c,l=(0,s.ref)(null),u=(0,s.ref)(null),f=(0,s.ref)(!1),R=(0,s.ref)(!1),W=(0,s.ref)(!1),Y=(0,s.ref)({x:0,y:0}),F=(0,s.ref)({x:0,y:0}),G=(0,s.ref)(null),X=(0,s.ref)(!1),Z=(0,s.computed)(()=>{const e=r.filter.trim().toLowerCase();return e?r.entries.filter(n=>(n.displayName??n.name).toLowerCase().includes(e)||n.name.toLowerCase().includes(e)):r.entries}),K=(0,s.computed)(()=>r.entries.filter(e=>'update-available'===e.update?.status)),Q=(0,s.computed)(()=>K.value.length),ee=(0,s.computed)(()=>K.value.filter(e=>r.updateSelection[e.name])),ne=(0,s.computed)(()=>ee.value.length),te=(0,s.computed)(()=>R.value?{left:`${F.value.x}px`,top:`${F.value.y}px`}:{});function ae(e,n){const t=u.value?.getBoundingClientRect();if(!t)return{x:e,y:n};const a=window.parent??window,i=a.innerWidth-t.width-8,o=a.innerHeight-t.height-8;return{x:Math.min(Math.max(8,e),Math.max(8,i)),y:Math.min(Math.max(28,n),Math.max(28,o))}}function ie(e){if(window.matchMedia('(max-width: 640px)').matches)return;e.preventDefault(),e.stopPropagation();const n=u.value?.getBoundingClientRect();if(!n)return;R.value=!0,f.value=!0,W.value=!0,Y.value={x:e.clientX-n.left,y:e.clientY-n.top};const t=ae(n.left,n.top);F.value=t,e.target.setPointerCapture?.(e.pointerId),window.setTimeout(()=>{W.value=!1},200)}function oe(e){if(!f.value)return;e.preventDefault();const n=e.clientX-Y.value.x,t=e.clientY-Y.value.y;F.value=ae(n,t)}function re(e){f.value&&(f.value=!1,e.target.releasePointerCapture?.(e.pointerId))}function le(e){W.value||e.target===e.currentTarget&&se()}function se(){p(!1)}function ce(){d.refresh()}function de(){(window.parent??window).location?.reload()}function pe(){K.value.forEach(e=>g(e.name,!0))}function ue(){Object.keys(c.updateSelection).forEach(e=>{delete c.updateSelection[e]})}async function me(){const e=ne.value>0?ee.value.map(e=>e.name):K.value.map(e=>e.name);if(e.length&&!r.updating){x(!0);try{await async function(e){const n=t();if('function'!=typeof n.updateExtension){const n=[],t=[];for(const o of e)try{const e='global'===i(o);(await fetch('/api/extensions/update',{method:'POST',headers:a(),body:JSON.stringify({extensionName:o,global:e})})).ok?n.push(o):t.push(o)}catch{t.push(o)}return{ok:n,failed:t}}const o=[],r=[];for(const t of e)try{const e=await n.updateExtension(t);e?.ok?o.push(t):r.push(t)}catch{r.push(t)}return{ok:o,failed:r}}(e)}finally{x(!1),ce()}}}function fe(){G.value=null}async function ge(){const e=G.value;if(e&&!X.value){X.value=!0;try{await async function(e){const n=t();if('function'==typeof n.uninstallExtension)try{const t=await n.uninstallExtension(e);return!!t?.ok}catch{return!1}try{const n='global'===i(e);return(await fetch('/api/extensions/uninstall',{method:'POST',headers:a(),body:JSON.stringify({extensionName:e,global:n})})).ok}catch{return!1}}(e.name)&&ce()}finally{X.value=!1,G.value=null}}}function xe(t){if('third-party'!==t.kind)return;const a=e(),i='enabled'===t.status;!function(e,t,a){const i=n(e),o=new Set((i.disabledExtensions??[]).filter(e=>'string'==typeof e)),r=`third-party/${t}`;a?o.add(r):o.delete(r),i.disabledExtensions=Array.from(o),function(e){e.saveSettingsDebounced?.()}(e)}(a,t.name,i),t.status=i?'disabled':'enabled'}function be(){const e=l.value;if(!e)return;const n=window.parent??window;e.style.setProperty('--em-viewport-w',`${n.innerWidth}px`),e.style.setProperty('--em-viewport-h',`${n.innerHeight}px`)}return(0,s.watch)(()=>r.open,async e=>{if(!e)return f.value=!1,void(R.value=!1);await(0,s.nextTick)(),R.value=!1,r.filter&&m(''),be()}),(0,s.onMounted)(()=>{const e=window.parent??window;e.addEventListener('pointermove',oe),e.addEventListener('pointerup',re),e.addEventListener('pointercancel',re),e.addEventListener('resize',be),e.addEventListener('orientationchange',be),be()}),(0,s.onUnmounted)(()=>{const e=window.parent??window;e.removeEventListener('pointermove',oe),e.removeEventListener('pointerup',re),e.removeEventListener('pointercancel',re),e.removeEventListener('resize',be),e.removeEventListener('orientationchange',be)}),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.unref)(r).open?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,ref_key:'overlayRef',ref:l,class:'em-overlay',onClick:le},[(0,s.createElementVNode)('div',{ref_key:'modalRef',ref:u,class:(0,s.normalizeClass)(['em-modal',{dragged:R.value}]),style:(0,s.normalizeStyle)(te.value),onClick:n[1]||(n[1]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',b,[(0,s.createElementVNode)('div',h,[(0,s.createElementVNode)('div',{class:'em-dragbar',onPointerdown:ie},null,32),n[3]||(n[3]=(0,s.createElementVNode)('div',{class:'em-title'},'扩展管理器',-1)),(0,s.createElementVNode)('div',y,[(0,s.createElementVNode)('button',{class:'em-close icon-only',title:'关闭',onClick:(0,s.withModifiers)(se,['stop'])},[...n[2]||(n[2]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-xmark'},null,-1)])])])]),(0,s.createElementVNode)('div',v,[(0,s.createElementVNode)('input',{class:'em-search',value:(0,s.unref)(r).filter,placeholder:'搜索扩展名称...',onInput:n[0]||(n[0]=e=>(0,s.unref)(m)(e.target.value))},null,40,w),(0,s.createElementVNode)('div',k,[n[9]||(n[9]=(0,s.createElementVNode)('div',{class:'em-hint'},'切换会写入 disabledExtensions，重载后生效。',-1)),(0,s.createElementVNode)('div',E,[(0,s.createElementVNode)('button',{class:'em-btn icon-only',title:'刷新列表',onClick:ce},[...n[4]||(n[4]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-rotate'},null,-1)])]),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['em-btn icon-only',{'has-badge':Q.value>0}]),'data-count':Q.value,title:ne.value>0?`更新所选 ${ne.value} 个`:`更新全部 ${Q.value} 个`,onClick:me},[...n[5]||(n[5]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-cloud-arrow-down'},null,-1)])],10,N),(0,s.createElementVNode)('button',{class:'em-btn icon-only',title:'全选可更新',onClick:pe},[...n[6]||(n[6]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-square-check'},null,-1)])]),(0,s.createElementVNode)('button',{class:'em-btn icon-only',title:'清空选择',onClick:ue},[...n[7]||(n[7]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-square-minus'},null,-1)])]),(0,s.createElementVNode)('button',{class:'em-btn primary icon-only',title:'重载页面',onClick:de},[...n[8]||(n[8]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-arrow-rotate-right'},null,-1)])])])]),(0,s.unref)(r).loading?((0,s.openBlock)(),(0,s.createElementBlock)('div',V,'加载中...')):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createElementVNode)('div',C,[Z.value.length?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',S,'没有匹配项。')),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(Z.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.name,class:'em-item'},[(0,s.createElementVNode)('div',null,[(0,s.createElementVNode)('div',B,[(0,s.createTextVNode)((0,s.toDisplayString)(e.displayName??e.name)+' ',1),'core'===e.kind?((0,s.openBlock)(),(0,s.createElementBlock)('span',j,'核心')):(0,s.createCommentVNode)('v-if',!0),'update-available'===e.update?.status?((0,s.openBlock)(),(0,s.createElementBlock)('span',M,[...n[10]||(n[10]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-circle-up'},null,-1)])])):(0,s.createCommentVNode)('v-if',!0)]),e.displayName?((0,s.openBlock)(),(0,s.createElementBlock)('div',T,'目录名：'+(0,s.toDisplayString)(e.name),1)):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('div',A,'第三方标识：'+(0,s.toDisplayString)(e.kind),1),(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['em-status',e.status])},(0,s.toDisplayString)('enabled'===e.status?'已启用':'已禁用'),3)]),(0,s.createElementVNode)('div',L,[(0,s.createElementVNode)('button',{class:'em-action-delete',disabled:'third-party'!==e.kind,title:'删除扩展',onClick:(0,s.withModifiers)(n=>function(e){'third-party'===e.kind&&(G.value=e)}(e),['stop'])},[...n[11]||(n[11]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-trash-can'},null,-1)])],8,P),'update-available'===e.update?.status?((0,s.openBlock)(),(0,s.createElementBlock)('button',{key:0,class:(0,s.normalizeClass)(['em-update-select',{selected:!!(0,s.unref)(r).updateSelection[e.name]}]),title:(0,s.unref)(r).updateSelection[e.name]?'已加入更新队列':'加入更新队列',onClick:n=>{var t;g(t=e.name,!r.updateSelection[t])}},[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(['fa-solid',(0,s.unref)(r).updateSelection[e.name]?'fa-square-check':'fa-square'])},null,2)],10,q)):(0,s.createCommentVNode)('v-if',!0),(0,s.createElementVNode)('button',{class:(0,s.normalizeClass)(['em-toggle-switch',{on:'enabled'===e.status}]),disabled:'third-party'!==e.kind,role:'switch','aria-checked':'enabled'===e.status,onClick:(0,s.withModifiers)(n=>xe(e),['stop']),title:'enabled'===e.status?'禁用':'启用'},null,10,D)])]))),128))])])],6)],512)):(0,s.createCommentVNode)('v-if',!0),G.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',O,[(0,s.createElementVNode)('div',I,[n[12]||(n[12]=(0,s.createElementVNode)('div',{class:'em-confirm-title'},'确认删除扩展？',-1)),(0,s.createElementVNode)('div',U,(0,s.toDisplayString)(G.value.displayName??G.value.name),1),(0,s.createElementVNode)('div',H,[(0,s.createElementVNode)('button',{class:'em-btn',onClick:fe},'取消'),(0,s.createElementVNode)('button',{class:'em-btn danger',disabled:X.value,onClick:ge},'删除',8,J)])])])):(0,s.createCommentVNode)('v-if',!0)],64))}});function W(){const e=$('<style>').attr('data-em-style',getScriptId()).text('\n@import url(\'https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap\');\n\n.em-overlay {\n  position: fixed;\n  inset: 0;\n  width: var(--em-viewport-w, 100%);\n  height: var(--em-viewport-h, 100%);\n  min-width: 100%;\n  min-height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  background: rgba(10, 12, 20, 0.72);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  z-index: 10000;\n  box-sizing: border-box;\n}\n\n.em-modal {\n  position: relative;\n  width: min(980px, calc(var(--em-viewport-w, 100%) - 48px));\n  height: min(820px, calc(var(--em-viewport-h, 100%) - 120px));\n  pointer-events: auto;\n}\n\n.em-modal.dragged {\n  position: fixed;\n}\n\n.em-dragbar {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  height: 100%;\n  cursor: move;\n  user-select: none;\n  touch-action: none;\n  z-index: 1;\n}\n\n.em-close {\n  padding: 4px 10px;\n  border-radius: 999px;\n  border: 1px solid rgba(255,255,255,0.2);\n  background: rgba(30, 41, 59, 0.9);\n  color: #e2e8f0;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.em-close.icon-only {\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.em-root {\n  height: 100%;\n  color: #e2e8f0;\n  font-family: \'Zen Maru Gothic\', \'PingFang SC\', \'Microsoft YaHei\', sans-serif;\n  background:\n    radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.24), transparent 40%),\n    radial-gradient(circle at 80% 14%, rgba(34, 197, 94, 0.24), transparent 35%),\n    radial-gradient(circle at 12% 90%, rgba(248, 113, 113, 0.2), transparent 40%),\n    linear-gradient(160deg, #0b1020 0%, #111827 40%, #0b1226 100%);\n  border-radius: 16px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 24px 48px rgba(0,0,0,0.45);\n  border: 1px solid rgba(255,255,255,0.08);\n}\n\n.em-header {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n  background: rgba(15, 23, 42, 0.75);\n  backdrop-filter: blur(6px);\n}\n\n.em-title {\n  font-size: 16px;\n  font-weight: 700;\n  letter-spacing: 1px;\n  text-transform: uppercase;\n  position: relative;\n  z-index: 2;\n}\n\n.em-actions {\n  display: flex;\n  gap: 8px;\n  position: relative;\n  z-index: 2;\n}\n\n.em-btn {\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: 0.2s ease;\n  color: #e2e8f0;\n  background: rgba(30, 41, 59, 0.7);\n}\n\n.em-btn.icon-only {\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.em-btn.has-badge {\n  position: relative;\n}\n\n.em-btn.has-badge::after {\n  content: attr(data-count);\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  background: #f59e0b;\n  color: #111827;\n  font-size: 10px;\n  font-weight: 700;\n  border-radius: 999px;\n  padding: 2px 5px;\n  min-width: 16px;\n  text-align: center;\n  box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);\n}\n\n.em-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);\n}\n\n.em-btn.primary {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  border-color: rgba(34, 197, 94, 0.6);\n}\n\n.em-btn.danger {\n  background: linear-gradient(135deg, #f87171, #ef4444);\n  border-color: rgba(248, 113, 113, 0.6);\n  color: #111827;\n}\n\n.em-body {\n  padding: 14px 18px 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.em-toolbar-row {\n  display: grid;\n  grid-template-columns: minmax(0, 1fr) auto;\n  align-items: center;\n  justify-content: space-between;\n  gap: 10px;\n  flex-wrap: nowrap;\n  min-height: 40px;\n}\n\n.em-toolbar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  min-height: 36px;\n  padding: 0 2px;\n  flex-shrink: 0;\n  margin-left: auto;\n}\n\n.em-search {\n  width: 100%;\n  border-radius: 12px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  background: rgba(15, 23, 42, 0.75);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  font-size: 13px;\n  outline: none;\n}\n\n.em-hint {\n  font-size: 11px;\n  color: rgba(226, 232, 240, 0.65);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n\n.em-list {\n  padding: 0 18px 18px;\n  overflow: auto;\n  flex: 1;\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 12px;\n}\n\n.em-item {\n  background: rgba(15, 23, 42, 0.7);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 14px;\n  padding: 12px 14px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);\n}\n\n.em-item-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.em-action-delete {\n  width: 34px;\n  height: 34px;\n  padding: 0;\n  border-radius: 10px;\n  border: 1px solid rgba(248, 113, 113, 0.5);\n  background: rgba(239, 68, 68, 0.15);\n  color: #f87171;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: 0.2s ease;\n}\n\n.em-action-delete:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.em-item-name {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.em-update-pill {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  width: 22px;\n  height: 22px;\n  border-radius: 999px;\n  background: rgba(245, 158, 11, 0.2);\n  color: #f59e0b;\n  border: 1px solid rgba(245, 158, 11, 0.4);\n  font-size: 11px;\n}\n\n.em-item-meta {\n  font-size: 11px;\n  font-family: \'JetBrains Mono\', monospace;\n  color: rgba(148, 163, 184, 0.8);\n}\n\n.em-tag {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 11px;\n  padding: 2px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  margin-left: 6px;\n}\n\n.em-tag.core {\n  color: #f8fafc;\n  background: rgba(148, 163, 184, 0.2);\n}\n\n.em-status {\n  margin-top: 4px;\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.em-status.enabled {\n  color: #34d399;\n}\n\n.em-status.disabled {\n  color: #fbbf24;\n}\n\n.em-update-select {\n  width: 36px;\n  height: 34px;\n  padding: 0;\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  background: rgba(30, 41, 59, 0.7);\n  color: #e2e8f0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: 0.2s ease;\n}\n\n.em-update-select.selected {\n  background: rgba(34, 197, 94, 0.25);\n  border-color: rgba(34, 197, 94, 0.6);\n  color: #22c55e;\n}\n\n.em-toggle-switch {\n  position: relative;\n  width: 50px;\n  height: 26px;\n  border-radius: 999px;\n  border: 1px solid rgba(148, 163, 184, 0.35);\n  background: rgba(30, 41, 59, 0.7);\n  cursor: pointer;\n  transition: 0.2s ease;\n  box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.25);\n  padding: 0;\n  line-height: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: flex-start;\n  box-sizing: border-box;\n}\n\n.em-toggle-switch::after {\n  content: \'\';\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  width: 22px;\n  height: 22px;\n  border-radius: 50%;\n  background: #f8fafc;\n  transform: none;\n  transition: 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n}\n\n.em-toggle-switch.on {\n  background: linear-gradient(135deg, #34d399, #22c55e);\n  border-color: rgba(34, 197, 94, 0.6);\n}\n\n.em-toggle-switch.on::after {\n  left: calc(100% - 24px);\n}\n\n.em-toggle-switch:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.em-empty {\n  border-radius: 12px;\n  border: 1px dashed rgba(148, 163, 184, 0.3);\n  padding: 12px;\n  text-align: center;\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.7);\n  background: rgba(15, 23, 42, 0.6);\n}\n\n.em-loading {\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.7);\n}\n\n.em-confirm {\n  position: fixed;\n  inset: 0;\n  background: rgba(10, 12, 20, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n\n.em-confirm-card {\n  width: min(420px, 86vw);\n  background: rgba(15, 23, 42, 0.9);\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  border-radius: 14px;\n  padding: 16px 18px;\n  color: #e2e8f0;\n  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);\n}\n\n.em-confirm-title {\n  font-size: 14px;\n  font-weight: 700;\n}\n\n.em-confirm-desc {\n  margin-top: 6px;\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.75);\n}\n\n.em-confirm-actions {\n  margin-top: 14px;\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n\n@media (max-width: 640px) {\n  .em-modal {\n    width: calc(var(--em-viewport-w, 100%) - 24px);\n    height: calc(var(--em-viewport-h, 100%) - 24px);\n    position: fixed;\n    inset: 12px;\n  }\n  .em-modal.dragged {\n    position: fixed;\n    left: auto;\n    top: auto;\n    right: auto;\n    bottom: auto;\n  }\n  .em-header {\n    flex-direction: row;\n    align-items: center;\n    padding: 12px 14px;\n  }\n  .em-title {\n    font-size: 14px;\n    letter-spacing: 0.5px;\n  }\n  .em-actions {\n    gap: 6px;\n  }\n  .em-dragbar {\n    display: none;\n  }\n  .em-toolbar {\n    gap: 6px;\n  }\n  .em-btn.icon-only {\n    width: 28px;\n    height: 28px;\n  }\n  .em-hint {\n    font-size: 10px;\n  }\n}\n\n@media (min-width: 900px) {\n  .em-list {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n  }\n}\n\n@media (min-width: 1200px) {\n  .em-list {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n').appendTo('head'),n=$('<div>').attr('script_id',getScriptId()).addClass('em-mount').appendTo('body'),t=(0,s.createApp)(R);return t.mount(n[0]),{app:t,mount:n,style:e}}let Y=null;function F(){Y||(Y=W())}async function G(){u(!0);try{const n=e(),t=window.parent?.document??document;f(await l(t,n))}finally{u(!1)}}function X(){const e=function(){const e={open:()=>{F(),p(!0),G()},close:()=>{p(!1)},toggle:()=>{F();const e=!c.open;p(e),e&&G()},refresh:async()=>{F(),await G()},destroy:()=>{Y&&function(e){e.app.unmount(),e.mount.remove(),e.style.remove()}(Y),Y=null}};return d.refresh=e.refresh,d.close=e.close,e}(),n=function(e){const n=window.parent?.document??document;let t=null;const a=()=>(t=function(e){const n=e.querySelector('[data-em-launcher="1"]');if(n){const t=e.querySelector('#extensions_details');return t&&n.previousElementSibling!==t&&t.insertAdjacentElement('afterend',n),n}const t=e.querySelector('#extensions_settings');if(!t)return null;const a=e.querySelector('#extensions_details'),i=a?.closest('.alignitemscenter.flex-container.wide100p'),o=function(e){const n=e.createElement('div');return n.setAttribute('data-em-launcher','1'),n.className='menu_button menu_button_icon interactable icon-only',n.title='扩展管理',n.innerHTML='<i class="fa-solid fa-puzzle-piece"></i>',n}(e);if(a)return a.insertAdjacentElement('afterend',o),o;if(i)return i.appendChild(o),o;const r=e.createElement('div');return r.setAttribute('data-em-launcher-bar','1'),r.setAttribute('style',['display:flex','justify-content:flex-end','gap:8px','padding:6px 0 10px','border-bottom:1px solid rgba(0,0,0,0.08)','margin-bottom:10px'].join(';')),r.appendChild(o),t.prepend(r),o}(n),!!t&&(t.addEventListener('click',()=>e.open()),!0));if(!a()){const e=new MutationObserver(()=>a());return e.observe(n.documentElement,{childList:!0,subtree:!0}),()=>{e.disconnect(),t?.remove()}}return()=>{t?.remove()}}(e);$(window).on('pagehide',()=>{n(),e.destroy()})}$(()=>{errorCatched(X)()});
//# sourceMappingURL=index.js.map