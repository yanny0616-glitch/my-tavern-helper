{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/扩展管理器/services/tavern.ts","src://tavern_helper_template/src/扩展管理器/services/updates.ts","src://tavern_helper_template/src/扩展管理器/services/entries.ts","src://tavern_helper_template/src/扩展管理器/services/dom-scan.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/扩展管理器/state/store.ts","src://tavern_helper_template/src/扩展管理器/ui/App.vue","webpack://tavern_helper_template/src/扩展管理器/ui/App.vue?0d84","src://tavern_helper_template/src/扩展管理器/entry/portal.mount.ts","src://tavern_helper_template/src/扩展管理器/entry/portal.styles.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/src/扩展管理器/entry/portal.controller.ts","src://tavern_helper_template/src/扩展管理器/index.ts","src://tavern_helper_template/src/扩展管理器/entry/buttons.ts"],"sourcesContent":["import { TavernContext } from '../types';\n\ntype SillyTavernLike = {\n  getContext: () => TavernContext;\n};\n\nexport function getSillyTavern(): SillyTavernLike {\n  return ((window.parent as { SillyTavern?: SillyTavernLike })?.SillyTavern ??\n    (window as { SillyTavern?: SillyTavernLike }).SillyTavern)!;\n}\n\nexport function getContext(): TavernContext {\n  return getSillyTavern().getContext();\n}\n\nexport function getExtensionSettings(ctx: TavernContext): Record<string, unknown> {\n  return (ctx.extensionSettings as Record<string, unknown>) ?? {};\n}\n\nexport function saveSettings(ctx: TavernContext): void {\n  ctx.saveSettingsDebounced?.();\n}\n","import type { ExtensionEntry, ExtensionInstallationInfo, ExtensionUpdateInfo } from '../types';\nimport { getContext } from './tavern';\n\ntype ExtensionApi = {\n  getExtensionInstallationInfo?: (id: string) => Promise<ExtensionInstallationInfo | null>;\n  getExtensionType?: (id: string) => 'local' | 'global' | 'system' | null;\n  updateExtension?: (id: string) => Promise<Response>;\n  isAdmin?: () => boolean;\n};\n\nfunction getApi(): ExtensionApi {\n  // Extension APIs are exposed on the script iframe window, not the parent.\n  return (window as ExtensionApi) ?? ((window.parent as ExtensionApi) || {});\n}\n\nfunction getRequestHeadersSafe(): Record<string, string> {\n  const ctx = getContext();\n  const headers = ctx?.getRequestHeaders?.();\n  return (headers as Record<string, string>) ?? { 'Content-Type': 'application/json' };\n}\n\nfunction getExtensionTypeSafe(name: string): 'local' | 'global' | 'system' | null {\n  const api = getApi();\n  if (typeof api.getExtensionType === 'function') {\n    return api.getExtensionType(name);\n  }\n  return null;\n}\n\nasync function getExtensionVersionApi(\n  extensionName: string,\n  global: boolean,\n): Promise<{\n  currentBranchName: string;\n  currentCommitHash: string;\n  isUpToDate: boolean;\n  remoteUrl: string;\n} | null> {\n  try {\n    const response = await fetch('/api/extensions/version', {\n      method: 'POST',\n      headers: getRequestHeadersSafe(),\n      body: JSON.stringify({ extensionName, global }),\n    });\n    if (!response.ok) {\n      return null;\n    }\n    return (await response.json()) as {\n      currentBranchName: string;\n      currentCommitHash: string;\n      isUpToDate: boolean;\n      remoteUrl: string;\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport function canCheckUpdates(): boolean {\n  const api = getApi();\n  return typeof api.getExtensionInstallationInfo === 'function' || true;\n}\n\nexport async function applyUpdateInfo(entries: ExtensionEntry[]): Promise<ExtensionEntry[]> {\n  const api = getApi();\n  const apiAvailable = typeof api.getExtensionInstallationInfo === 'function';\n\n  if (apiAvailable) {\n    const candidates = entries.filter(entry => entry.kind === 'third-party');\n    const results = await Promise.all(\n      candidates.map(async entry => {\n        try {\n          const info = await api.getExtensionInstallationInfo!(entry.name);\n          const type = api.getExtensionType ? api.getExtensionType(entry.name) : null;\n          const canUpdate =\n            info && type !== 'system' ? (type === 'global' ? (api.isAdmin ? api.isAdmin() : true) : true) : false;\n          const status: ExtensionUpdateInfo['status'] = info\n            ? info.is_up_to_date\n              ? 'up-to-date'\n              : 'update-available'\n            : 'unknown';\n          return { name: entry.name, update: { status, info, type, canUpdate } as ExtensionUpdateInfo };\n        } catch {\n          return { name: entry.name, update: { status: 'error' } as ExtensionUpdateInfo };\n        }\n      }),\n    );\n\n    const map = new Map(results.map(result => [result.name, result.update]));\n    return entries.map(entry => ({\n      ...entry,\n      update: map.get(entry.name) ?? entry.update,\n    }));\n  }\n\n  const candidates = entries.filter(entry => entry.kind === 'third-party');\n  const results = await Promise.all(\n    candidates.map(async entry => {\n      const type = getExtensionTypeSafe(entry.name);\n      const data = await getExtensionVersionApi(entry.name, type === 'global');\n      if (!data) {\n        return { name: entry.name, update: { status: 'unknown' } as ExtensionUpdateInfo };\n      }\n      const status: ExtensionUpdateInfo['status'] = data.isUpToDate ? 'up-to-date' : 'update-available';\n      return {\n        name: entry.name,\n        update: {\n          status,\n          info: {\n            current_branch_name: data.currentBranchName,\n            current_commit_hash: data.currentCommitHash,\n            is_up_to_date: data.isUpToDate,\n            remote_url: data.remoteUrl,\n          },\n          type,\n          canUpdate: !data.isUpToDate,\n        } as ExtensionUpdateInfo,\n      };\n    }),\n  );\n\n  const map = new Map(results.map(result => [result.name, result.update]));\n  return entries.map(entry => ({\n    ...entry,\n    update: map.get(entry.name) ?? { status: 'unknown' },\n  }));\n}\n\nexport async function updateExtensions(names: string[]): Promise<{ ok: string[]; failed: string[] }> {\n  const api = getApi();\n  if (typeof api.updateExtension !== 'function') {\n    const ok: string[] = [];\n    const failed: string[] = [];\n    for (const name of names) {\n      try {\n        const isGlobal = getExtensionTypeSafe(name) === 'global';\n        const response = await fetch('/api/extensions/update', {\n          method: 'POST',\n          headers: getRequestHeadersSafe(),\n          body: JSON.stringify({ extensionName: name, global: isGlobal }),\n        });\n        if (response.ok) {\n          ok.push(name);\n        } else {\n          failed.push(name);\n        }\n      } catch {\n        failed.push(name);\n      }\n    }\n    return { ok, failed };\n  }\n\n  const ok: string[] = [];\n  const failed: string[] = [];\n  for (const name of names) {\n    try {\n      const res = await api.updateExtension!(name);\n      if (res?.ok) {\n        ok.push(name);\n      } else {\n        failed.push(name);\n      }\n    } catch {\n      failed.push(name);\n    }\n  }\n  return { ok, failed };\n}\n\nexport async function deleteExtension(name: string): Promise<boolean> {\n  const api = getApi() as { uninstallExtension?: (id: string) => Promise<Response> };\n  if (typeof api.uninstallExtension === 'function') {\n    try {\n      const res = await api.uninstallExtension(name);\n      return !!res?.ok;\n    } catch {\n      return false;\n    }\n  }\n\n  try {\n    const isGlobal = getExtensionTypeSafe(name) === 'global';\n    const response = await fetch('/api/extensions/uninstall', {\n      method: 'POST',\n      headers: getRequestHeadersSafe(),\n      body: JSON.stringify({ extensionName: name, global: isGlobal }),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n","import { scanCoreFromDom, scanThirdPartyFromDom } from './dom-scan';\nimport { ExtensionEntry, TavernContext } from '../types';\nimport { getExtensionSettings, saveSettings } from './tavern';\nimport { applyUpdateInfo } from './updates';\n\nasync function fetchManifestName(name: string): Promise<string | null> {\n  const candidates = [\n    `/scripts/extensions/third-party/${name}/manifest.json`,\n    `/scripts/extensions/third-party/${name}/manifest.yaml`,\n    `/scripts/extensions/third-party/${name}/manifest.yml`,\n  ];\n  for (const url of candidates) {\n    try {\n      const res = await fetch(url, { method: 'GET' });\n      if (!res.ok) {\n        continue;\n      }\n      const text = await res.text();\n      if (url.endsWith('.json')) {\n        const data = JSON.parse(text) as Record<string, unknown>;\n        const raw =\n          (data.displayName as string) ||\n          (data.display_name as string) ||\n          (data.title as string) ||\n          (data.name as string);\n        if (raw && raw !== name) {\n          return raw;\n        }\n      }\n    } catch {\n      continue;\n    }\n  }\n  return null;\n}\n\nasync function resolveDisplayNames(names: string[]): Promise<Record<string, string>> {\n  const results: Record<string, string> = {};\n  await Promise.all(\n    names.map(async name => {\n      const displayName = await fetchManifestName(name);\n      if (displayName) {\n        results[name] = displayName;\n      }\n    }),\n  );\n  return results;\n}\n\nexport function getDisabledThirdParty(ctx: TavernContext): Set<string> {\n  const settings = getExtensionSettings(ctx);\n  const disabled = (settings.disabledExtensions ?? []) as unknown[];\n  const names = disabled\n    .filter((item: unknown): item is string => typeof item === 'string' && item.startsWith('third-party/'))\n    .map(item => item.replace(/^third-party\\//, ''));\n  return new Set(names);\n}\n\nexport async function buildEntries(doc: Document, ctx: TavernContext): Promise<ExtensionEntry[]> {\n  const disabledThirdParty = getDisabledThirdParty(ctx);\n  const enabledThirdParty = scanThirdPartyFromDom(doc);\n  const enabledCore = scanCoreFromDom(doc);\n\n  const thirdPartyNames = new Set<string>([...enabledThirdParty, ...disabledThirdParty]);\n  const displayNames = await resolveDisplayNames(Array.from(thirdPartyNames));\n  const thirdPartyEntries: ExtensionEntry[] = Array.from(thirdPartyNames)\n    .sort((a, b) => a.localeCompare(b))\n    .map(name => ({\n      name,\n      displayName: displayNames[name],\n      kind: 'third-party' as const,\n      status: disabledThirdParty.has(name) ? 'disabled' : 'enabled',\n    }));\n\n  const coreEntries: ExtensionEntry[] = enabledCore.map(name => ({\n    name,\n    kind: 'core' as const,\n    status: 'enabled' as const,\n  }));\n\n  const entries = [...thirdPartyEntries, ...coreEntries];\n  return applyUpdateInfo(entries);\n}\n\nexport function setThirdPartyDisabled(ctx: TavernContext, name: string, disabled: boolean): void {\n  const settings = getExtensionSettings(ctx);\n  const list = new Set<string>(\n    ((settings.disabledExtensions ?? []) as unknown[]).filter(\n      (item: unknown): item is string => typeof item === 'string',\n    ),\n  );\n  const key = `third-party/${name}`;\n  if (disabled) {\n    list.add(key);\n  } else {\n    list.delete(key);\n  }\n  settings.disabledExtensions = Array.from(list);\n  saveSettings(ctx);\n}\n","export function scanThirdPartyFromDom(doc: Document): string[] {\n  const names = new Set<string>();\n  const selector = [\n    'link[href*=\"/scripts/extensions/third-party/\"]',\n    'script[src*=\"/scripts/extensions/third-party/\"]',\n    'img[src*=\"/scripts/extensions/third-party/\"]',\n  ].join(',');\n  doc.querySelectorAll(selector).forEach(el => {\n    const url = el.getAttribute('href') || el.getAttribute('src') || '';\n    const match = url.match(/\\/scripts\\/extensions\\/third-party\\/([^/]+)\\//);\n    if (match) {\n      names.add(match[1]);\n    }\n  });\n  return Array.from(names).sort((a, b) => a.localeCompare(b));\n}\n\nexport function scanCoreFromDom(doc: Document): string[] {\n  const names = new Set<string>();\n  const selector = ['link[href*=\"/scripts/extensions/\"]', 'script[src*=\"/scripts/extensions/\"]'].join(',');\n  doc.querySelectorAll(selector).forEach(el => {\n    const url = el.getAttribute('href') || el.getAttribute('src') || '';\n    if (url.includes('/third-party/')) {\n      return;\n    }\n    const match = url.match(/\\/scripts\\/extensions\\/([^/]+)\\//);\n    if (match) {\n      names.add(match[1]);\n    }\n  });\n  return Array.from(names).sort((a, b) => a.localeCompare(b));\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { reactive } from 'vue';\nimport type { ExtensionEntry } from '../types';\n\nexport const extensionManagerState = reactive({\n  open: false,\n  loading: false,\n  filter: '',\n  entries: [] as ExtensionEntry[],\n  updateSelection: {} as Record<string, boolean>,\n  updating: false,\n});\n\nexport const extensionManagerActions: {\n  refresh?: () => Promise<void> | void;\n  close?: () => void;\n} = {};\n\nexport function setOpen(value: boolean) {\n  extensionManagerState.open = value;\n}\n\nexport function setLoading(value: boolean) {\n  extensionManagerState.loading = value;\n}\n\nexport function setFilter(value: string) {\n  extensionManagerState.filter = value;\n}\n\nexport function setEntries(entries: ExtensionEntry[]) {\n  extensionManagerState.entries = entries;\n  syncUpdateSelection(entries);\n}\n\nexport function setUpdateSelected(name: string, value: boolean) {\n  if (value) {\n    extensionManagerState.updateSelection[name] = true;\n  } else {\n    delete extensionManagerState.updateSelection[name];\n  }\n}\n\nexport function clearUpdateSelection() {\n  Object.keys(extensionManagerState.updateSelection).forEach(key => {\n    delete extensionManagerState.updateSelection[key];\n  });\n}\n\nexport function setUpdating(value: boolean) {\n  extensionManagerState.updating = value;\n}\n\nfunction syncUpdateSelection(entries: ExtensionEntry[]) {\n  const allowed = new Set(\n    entries.filter(entry => entry.update?.status === 'update-available').map(entry => entry.name),\n  );\n  Object.keys(extensionManagerState.updateSelection).forEach(name => {\n    if (!allowed.has(name)) {\n      delete extensionManagerState.updateSelection[name];\n    }\n  });\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, withModifiers as _withModifiers, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = { class: \"em-root\" };\nconst _hoisted_2 = { class: \"em-header\" };\nconst _hoisted_3 = { class: \"em-actions\" };\nconst _hoisted_4 = { class: \"em-body\" };\nconst _hoisted_5 = [\"value\"];\nconst _hoisted_6 = { class: \"em-toolbar-row\" };\nconst _hoisted_7 = { class: \"em-toolbar\" };\nconst _hoisted_8 = [\"data-count\", \"title\"];\nconst _hoisted_9 = {\n    key: 0,\n    class: \"em-loading\"\n};\nconst _hoisted_10 = { class: \"em-list\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"em-empty\"\n};\nconst _hoisted_12 = { class: \"em-item-name\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"em-tag core\"\n};\nconst _hoisted_14 = {\n    key: 1,\n    class: \"em-update-pill\",\n    title: \"有更新\"\n};\nconst _hoisted_15 = {\n    key: 0,\n    class: \"em-item-meta\"\n};\nconst _hoisted_16 = { class: \"em-item-meta\" };\nconst _hoisted_17 = { class: \"em-item-actions\" };\nconst _hoisted_18 = [\"disabled\", \"onClick\"];\nconst _hoisted_19 = [\"title\", \"onClick\"];\nconst _hoisted_20 = [\"disabled\", \"aria-checked\", \"onClick\", \"title\"];\nconst _hoisted_21 = {\n    key: 1,\n    class: \"em-confirm\"\n};\nconst _hoisted_22 = { class: \"em-confirm-card\" };\nconst _hoisted_23 = { class: \"em-confirm-desc\" };\nconst _hoisted_24 = { class: \"em-confirm-actions\" };\nconst _hoisted_25 = [\"disabled\"];\nimport { computed, nextTick, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { clearUpdateSelection, extensionManagerActions, extensionManagerState, setFilter, setOpen, setUpdateSelected, setUpdating, } from '../state/store';\nimport { setThirdPartyDisabled } from '../services/entries';\nimport { getContext } from '../services/tavern';\nimport { deleteExtension, updateExtensions } from '../services/updates';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const state = extensionManagerState;\n        const overlayRef = ref(null);\n        const modalRef = ref(null);\n        const dragging = ref(false);\n        const dragged = ref(false);\n        const justDragged = ref(false);\n        const dragOffset = ref({ x: 0, y: 0 });\n        const position = ref({ x: 0, y: 0 });\n        const deleteTarget = ref(null);\n        const deleting = ref(false);\n        const filteredEntries = computed(() => {\n            const keyword = state.filter.trim().toLowerCase();\n            if (!keyword) {\n                return state.entries;\n            }\n            return state.entries.filter(entry => {\n                const name = entry.displayName ?? entry.name;\n                return name.toLowerCase().includes(keyword) || entry.name.toLowerCase().includes(keyword);\n            });\n        });\n        const updateCandidates = computed(() => state.entries.filter(entry => entry.update?.status === 'update-available'));\n        const updateCount = computed(() => updateCandidates.value.length);\n        const selectedUpdates = computed(() => updateCandidates.value.filter(entry => state.updateSelection[entry.name]));\n        const selectedCount = computed(() => selectedUpdates.value.length);\n        const modalStyle = computed(() => {\n            if (!dragged.value) {\n                return {};\n            }\n            return {\n                left: `${position.value.x}px`,\n                top: `${position.value.y}px`,\n            };\n        });\n        function clampPosition(nextX, nextY) {\n            const rect = modalRef.value?.getBoundingClientRect();\n            if (!rect) {\n                return { x: nextX, y: nextY };\n            }\n            const padding = 8;\n            const win = window.parent ?? window;\n            const maxX = win.innerWidth - rect.width - padding;\n            const maxY = win.innerHeight - rect.height - padding;\n            return {\n                x: Math.min(Math.max(padding, nextX), Math.max(padding, maxX)),\n                y: Math.min(Math.max(padding + 20, nextY), Math.max(padding + 20, maxY)),\n            };\n        }\n        function onDragStart(event) {\n            if (window.matchMedia('(max-width: 640px)').matches) {\n                return;\n            }\n            event.preventDefault();\n            event.stopPropagation();\n            const rect = modalRef.value?.getBoundingClientRect();\n            if (!rect) {\n                return;\n            }\n            dragged.value = true;\n            dragging.value = true;\n            justDragged.value = true;\n            dragOffset.value = {\n                x: event.clientX - rect.left,\n                y: event.clientY - rect.top,\n            };\n            const pos = clampPosition(rect.left, rect.top);\n            position.value = pos;\n            event.target.setPointerCapture?.(event.pointerId);\n            window.setTimeout(() => {\n                justDragged.value = false;\n            }, 200);\n        }\n        function onDragMove(event) {\n            if (!dragging.value) {\n                return;\n            }\n            event.preventDefault();\n            const nextX = event.clientX - dragOffset.value.x;\n            const nextY = event.clientY - dragOffset.value.y;\n            position.value = clampPosition(nextX, nextY);\n        }\n        function onDragEnd(event) {\n            if (!dragging.value) {\n                return;\n            }\n            dragging.value = false;\n            event.target.releasePointerCapture?.(event.pointerId);\n        }\n        function onOverlayClick(event) {\n            if (justDragged.value) {\n                return;\n            }\n            if (event.target === event.currentTarget) {\n                close();\n            }\n        }\n        function close() {\n            setOpen(false);\n        }\n        function refresh() {\n            extensionManagerActions.refresh();\n        }\n        function reloadPage() {\n            (window.parent ?? window).location?.reload();\n        }\n        function toggleUpdateSelection(name) {\n            const next = !state.updateSelection[name];\n            setUpdateSelected(name, next);\n        }\n        function selectAllUpdates() {\n            updateCandidates.value.forEach(entry => setUpdateSelected(entry.name, true));\n        }\n        function clearUpdates() {\n            clearUpdateSelection();\n        }\n        async function updateSelected() {\n            const targets = selectedCount.value > 0\n                ? selectedUpdates.value.map(entry => entry.name)\n                : updateCandidates.value.map(entry => entry.name);\n            if (!targets.length || state.updating) {\n                return;\n            }\n            setUpdating(true);\n            try {\n                await updateExtensions(targets);\n            }\n            finally {\n                setUpdating(false);\n                refresh();\n            }\n        }\n        function requestDelete(entry) {\n            if (entry.kind !== 'third-party') {\n                return;\n            }\n            deleteTarget.value = entry;\n        }\n        function cancelDelete() {\n            deleteTarget.value = null;\n        }\n        async function confirmDelete() {\n            const target = deleteTarget.value;\n            if (!target || deleting.value) {\n                return;\n            }\n            deleting.value = true;\n            try {\n                const ok = await deleteExtension(target.name);\n                if (ok) {\n                    refresh();\n                }\n            }\n            finally {\n                deleting.value = false;\n                deleteTarget.value = null;\n            }\n        }\n        function toggleEntry(entry) {\n            if (entry.kind !== 'third-party') {\n                return;\n            }\n            const ctx = getContext();\n            const nextDisabled = entry.status === 'enabled';\n            setThirdPartyDisabled(ctx, entry.name, nextDisabled);\n            entry.status = nextDisabled ? 'disabled' : 'enabled';\n        }\n        watch(() => state.open, async (open) => {\n            if (!open) {\n                dragging.value = false;\n                dragged.value = false;\n                return;\n            }\n            await nextTick();\n            dragged.value = false;\n            if (state.filter) {\n                setFilter('');\n            }\n            syncOverlaySize();\n        });\n        onMounted(() => {\n            const host = window.parent ?? window;\n            host.addEventListener('pointermove', onDragMove);\n            host.addEventListener('pointerup', onDragEnd);\n            host.addEventListener('pointercancel', onDragEnd);\n            host.addEventListener('resize', syncOverlaySize);\n            host.addEventListener('orientationchange', syncOverlaySize);\n            syncOverlaySize();\n        });\n        onUnmounted(() => {\n            const host = window.parent ?? window;\n            host.removeEventListener('pointermove', onDragMove);\n            host.removeEventListener('pointerup', onDragEnd);\n            host.removeEventListener('pointercancel', onDragEnd);\n            host.removeEventListener('resize', syncOverlaySize);\n            host.removeEventListener('orientationchange', syncOverlaySize);\n        });\n        function syncOverlaySize() {\n            const overlay = overlayRef.value;\n            if (!overlay) {\n                return;\n            }\n            const host = window.parent ?? window;\n            overlay.style.setProperty('--em-viewport-w', `${host.innerWidth}px`);\n            overlay.style.setProperty('--em-viewport-h', `${host.innerHeight}px`);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                (_unref(state).open)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        ref_key: \"overlayRef\",\n                        ref: overlayRef,\n                        class: \"em-overlay\",\n                        onClick: onOverlayClick\n                    }, [\n                        _createElementVNode(\"div\", {\n                            ref_key: \"modalRef\",\n                            ref: modalRef,\n                            class: _normalizeClass([\"em-modal\", { dragged: dragged.value }]),\n                            style: _normalizeStyle(modalStyle.value),\n                            onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createElementVNode(\"div\", _hoisted_1, [\n                                _createElementVNode(\"div\", _hoisted_2, [\n                                    _createElementVNode(\"div\", {\n                                        class: \"em-dragbar\",\n                                        onPointerdown: onDragStart\n                                    }, null, 32 /* NEED_HYDRATION */),\n                                    _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"em-title\" }, \"扩展管理器\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_3, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"em-close icon-only\",\n                                            title: \"关闭\",\n                                            onClick: _withModifiers(close, [\"stop\"])\n                                        }, [...(_cache[2] || (_cache[2] = [\n                                                _createElementVNode(\"i\", { class: \"fa-solid fa-xmark\" }, null, -1 /* CACHED */)\n                                            ]))])\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_4, [\n                                    _createElementVNode(\"input\", {\n                                        class: \"em-search\",\n                                        value: _unref(state).filter,\n                                        placeholder: \"搜索扩展名称...\",\n                                        onInput: _cache[0] || (_cache[0] = ($event) => (_unref(setFilter)($event.target.value)))\n                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_5),\n                                    _createElementVNode(\"div\", _hoisted_6, [\n                                        _cache[9] || (_cache[9] = _createElementVNode(\"div\", { class: \"em-hint\" }, \"切换会写入 disabledExtensions，重载后生效。\", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", _hoisted_7, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"em-btn icon-only\",\n                                                title: \"刷新列表\",\n                                                onClick: refresh\n                                            }, [...(_cache[4] || (_cache[4] = [\n                                                    _createElementVNode(\"i\", { class: \"fa-solid fa-rotate\" }, null, -1 /* CACHED */)\n                                                ]))]),\n                                            _createElementVNode(\"button\", {\n                                                class: _normalizeClass([\"em-btn icon-only\", { 'has-badge': updateCount.value > 0 }]),\n                                                \"data-count\": updateCount.value,\n                                                title: selectedCount.value > 0 ? `更新所选 ${selectedCount.value} 个` : `更新全部 ${updateCount.value} 个`,\n                                                onClick: updateSelected\n                                            }, [...(_cache[5] || (_cache[5] = [\n                                                    _createElementVNode(\"i\", { class: \"fa-solid fa-cloud-arrow-down\" }, null, -1 /* CACHED */)\n                                                ]))], 10 /* CLASS, PROPS */, _hoisted_8),\n                                            _createElementVNode(\"button\", {\n                                                class: \"em-btn icon-only\",\n                                                title: \"全选可更新\",\n                                                onClick: selectAllUpdates\n                                            }, [...(_cache[6] || (_cache[6] = [\n                                                    _createElementVNode(\"i\", { class: \"fa-solid fa-square-check\" }, null, -1 /* CACHED */)\n                                                ]))]),\n                                            _createElementVNode(\"button\", {\n                                                class: \"em-btn icon-only\",\n                                                title: \"清空选择\",\n                                                onClick: clearUpdates\n                                            }, [...(_cache[7] || (_cache[7] = [\n                                                    _createElementVNode(\"i\", { class: \"fa-solid fa-square-minus\" }, null, -1 /* CACHED */)\n                                                ]))]),\n                                            _createElementVNode(\"button\", {\n                                                class: \"em-btn primary icon-only\",\n                                                title: \"重载页面\",\n                                                onClick: reloadPage\n                                            }, [...(_cache[8] || (_cache[8] = [\n                                                    _createElementVNode(\"i\", { class: \"fa-solid fa-arrow-rotate-right\" }, null, -1 /* CACHED */)\n                                                ]))])\n                                        ])\n                                    ]),\n                                    (_unref(state).loading)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, \"加载中...\"))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_10, [\n                                    (!filteredEntries.value.length)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, \"没有匹配项。\"))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(filteredEntries.value, (entry) => {\n                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                            key: entry.name,\n                                            class: \"em-item\"\n                                        }, [\n                                            _createElementVNode(\"div\", null, [\n                                                _createElementVNode(\"div\", _hoisted_12, [\n                                                    _createTextVNode(_toDisplayString(entry.displayName ?? entry.name) + \" \", 1 /* TEXT */),\n                                                    (entry.kind === 'core')\n                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_13, \"核心\"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (entry.update?.status === 'update-available')\n                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_14, [...(_cache[10] || (_cache[10] = [\n                                                                _createElementVNode(\"i\", { class: \"fa-solid fa-circle-up\" }, null, -1 /* CACHED */)\n                                                            ]))]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ]),\n                                                (entry.displayName)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, \"目录名：\" + _toDisplayString(entry.name), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                _createElementVNode(\"div\", _hoisted_16, \"第三方标识：\" + _toDisplayString(entry.kind), 1 /* TEXT */),\n                                                _createElementVNode(\"div\", {\n                                                    class: _normalizeClass([\"em-status\", entry.status])\n                                                }, _toDisplayString(entry.status === 'enabled' ? '已启用' : '已禁用'), 3 /* TEXT, CLASS */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_17, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"em-action-delete\",\n                                                    disabled: entry.kind !== 'third-party',\n                                                    title: \"删除扩展\",\n                                                    onClick: _withModifiers(($event) => (requestDelete(entry)), [\"stop\"])\n                                                }, [...(_cache[11] || (_cache[11] = [\n                                                        _createElementVNode(\"i\", { class: \"fa-solid fa-trash-can\" }, null, -1 /* CACHED */)\n                                                    ]))], 8 /* PROPS */, _hoisted_18),\n                                                (entry.update?.status === 'update-available')\n                                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: 0,\n                                                        class: _normalizeClass([\"em-update-select\", { selected: !!_unref(state).updateSelection[entry.name] }]),\n                                                        title: _unref(state).updateSelection[entry.name] ? '已加入更新队列' : '加入更新队列',\n                                                        onClick: ($event) => (toggleUpdateSelection(entry.name))\n                                                    }, [\n                                                        _createElementVNode(\"i\", {\n                                                            class: _normalizeClass([\"fa-solid\", _unref(state).updateSelection[entry.name] ? 'fa-square-check' : 'fa-square'])\n                                                        }, null, 2 /* CLASS */)\n                                                    ], 10 /* CLASS, PROPS */, _hoisted_19))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                _createElementVNode(\"button\", {\n                                                    class: _normalizeClass([\"em-toggle-switch\", { on: entry.status === 'enabled' }]),\n                                                    disabled: entry.kind !== 'third-party',\n                                                    role: \"switch\",\n                                                    \"aria-checked\": entry.status === 'enabled',\n                                                    onClick: _withModifiers(($event) => (toggleEntry(entry)), [\"stop\"]),\n                                                    title: entry.status === 'enabled' ? '禁用' : '启用'\n                                                }, null, 10 /* CLASS, PROPS */, _hoisted_20)\n                                            ])\n                                        ]));\n                                    }), 128 /* KEYED_FRAGMENT */))\n                                ])\n                            ])\n                        ], 6 /* CLASS, STYLE */)\n                    ], 512 /* NEED_PATCH */))\n                    : _createCommentVNode(\"v-if\", true),\n                (deleteTarget.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [\n                        _createElementVNode(\"div\", _hoisted_22, [\n                            _cache[12] || (_cache[12] = _createElementVNode(\"div\", { class: \"em-confirm-title\" }, \"确认删除扩展？\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_23, _toDisplayString(deleteTarget.value.displayName ?? deleteTarget.value.name), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_24, [\n                                _createElementVNode(\"button\", {\n                                    class: \"em-btn\",\n                                    onClick: cancelDelete\n                                }, \"取消\"),\n                                _createElementVNode(\"button\", {\n                                    class: \"em-btn danger\",\n                                    disabled: deleting.value,\n                                    onClick: confirmDelete\n                                }, \"删除\", 8 /* PROPS */, _hoisted_25)\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp } from 'vue';\nimport { createScriptIdDiv } from '../../../util/script';\nimport App from '../ui/App.vue';\nimport { portalStyles } from './portal.styles';\n\nexport type PortalMount = {\n  app: ReturnType<typeof createApp>;\n  mount: JQuery<HTMLDivElement>;\n  style: JQuery<HTMLElement>;\n};\n\nexport function createPortalMount(): PortalMount {\n  const style = $(`<style>`).attr('data-em-style', getScriptId()).text(portalStyles).appendTo('head');\n  const mount = createScriptIdDiv().addClass('em-mount').appendTo('body');\n  const app = createApp(App);\n\n  app.mount(mount[0]);\n\n  return { app, mount, style };\n}\n\nexport function destroyPortalMount(portal: PortalMount) {\n  portal.app.unmount();\n  portal.mount.remove();\n  portal.style.remove();\n}\n","export const portalStyles = `\n@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap');\n\n.em-overlay {\n  position: fixed;\n  inset: 0;\n  width: var(--em-viewport-w, 100%);\n  height: var(--em-viewport-h, 100%);\n  min-width: 100%;\n  min-height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 16px;\n  background: rgba(10, 12, 20, 0.72);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  z-index: 10000;\n  box-sizing: border-box;\n}\n\n.em-modal {\n  position: relative;\n  width: min(980px, calc(var(--em-viewport-w, 100%) - 48px));\n  height: min(820px, calc(var(--em-viewport-h, 100%) - 120px));\n  pointer-events: auto;\n}\n\n.em-modal.dragged {\n  position: fixed;\n}\n\n.em-dragbar {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  height: 100%;\n  cursor: move;\n  user-select: none;\n  touch-action: none;\n  z-index: 1;\n}\n\n.em-close {\n  padding: 4px 10px;\n  border-radius: 999px;\n  border: 1px solid rgba(255,255,255,0.2);\n  background: rgba(30, 41, 59, 0.9);\n  color: #e2e8f0;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.em-close.icon-only {\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.em-root {\n  height: 100%;\n  color: #e2e8f0;\n  font-family: 'Zen Maru Gothic', 'PingFang SC', 'Microsoft YaHei', sans-serif;\n  background:\n    radial-gradient(circle at 12% 18%, rgba(56, 189, 248, 0.24), transparent 40%),\n    radial-gradient(circle at 80% 14%, rgba(34, 197, 94, 0.24), transparent 35%),\n    radial-gradient(circle at 12% 90%, rgba(248, 113, 113, 0.2), transparent 40%),\n    linear-gradient(160deg, #0b1020 0%, #111827 40%, #0b1226 100%);\n  border-radius: 16px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 24px 48px rgba(0,0,0,0.45);\n  border: 1px solid rgba(255,255,255,0.08);\n}\n\n.em-header {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 14px 18px;\n  border-bottom: 1px solid rgba(148, 163, 184, 0.2);\n  background: rgba(15, 23, 42, 0.75);\n  backdrop-filter: blur(6px);\n}\n\n.em-title {\n  font-size: 16px;\n  font-weight: 700;\n  letter-spacing: 1px;\n  text-transform: uppercase;\n  position: relative;\n  z-index: 2;\n}\n\n.em-actions {\n  display: flex;\n  gap: 8px;\n  position: relative;\n  z-index: 2;\n}\n\n.em-btn {\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: 0.2s ease;\n  color: #e2e8f0;\n  background: rgba(30, 41, 59, 0.7);\n}\n\n.em-btn.icon-only {\n  width: 32px;\n  height: 32px;\n  padding: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.em-btn.has-badge {\n  position: relative;\n}\n\n.em-btn.has-badge::after {\n  content: attr(data-count);\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  background: #f59e0b;\n  color: #111827;\n  font-size: 10px;\n  font-weight: 700;\n  border-radius: 999px;\n  padding: 2px 5px;\n  min-width: 16px;\n  text-align: center;\n  box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);\n}\n\n.em-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);\n}\n\n.em-btn.primary {\n  background: linear-gradient(135deg, #22c55e, #16a34a);\n  border-color: rgba(34, 197, 94, 0.6);\n}\n\n.em-btn.danger {\n  background: linear-gradient(135deg, #f87171, #ef4444);\n  border-color: rgba(248, 113, 113, 0.6);\n  color: #111827;\n}\n\n.em-body {\n  padding: 14px 18px 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n.em-toolbar-row {\n  display: grid;\n  grid-template-columns: minmax(0, 1fr) auto;\n  align-items: center;\n  justify-content: space-between;\n  gap: 10px;\n  flex-wrap: nowrap;\n  min-height: 40px;\n}\n\n.em-toolbar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  min-height: 36px;\n  padding: 0 2px;\n  flex-shrink: 0;\n  margin-left: auto;\n}\n\n.em-search {\n  width: 100%;\n  border-radius: 12px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  background: rgba(15, 23, 42, 0.75);\n  color: #e2e8f0;\n  padding: 10px 12px;\n  font-size: 13px;\n  outline: none;\n}\n\n.em-hint {\n  font-size: 11px;\n  color: rgba(226, 232, 240, 0.65);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n\n.em-list {\n  padding: 0 18px 18px;\n  overflow: auto;\n  flex: 1;\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 12px;\n}\n\n.em-item {\n  background: rgba(15, 23, 42, 0.7);\n  border: 1px solid rgba(148, 163, 184, 0.2);\n  border-radius: 14px;\n  padding: 12px 14px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);\n}\n\n.em-item-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.em-action-delete {\n  width: 34px;\n  height: 34px;\n  padding: 0;\n  border-radius: 10px;\n  border: 1px solid rgba(248, 113, 113, 0.5);\n  background: rgba(239, 68, 68, 0.15);\n  color: #f87171;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: 0.2s ease;\n}\n\n.em-action-delete:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.em-item-name {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.em-update-pill {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  width: 22px;\n  height: 22px;\n  border-radius: 999px;\n  background: rgba(245, 158, 11, 0.2);\n  color: #f59e0b;\n  border: 1px solid rgba(245, 158, 11, 0.4);\n  font-size: 11px;\n}\n\n.em-item-meta {\n  font-size: 11px;\n  font-family: 'JetBrains Mono', monospace;\n  color: rgba(148, 163, 184, 0.8);\n}\n\n.em-tag {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 11px;\n  padding: 2px 8px;\n  border-radius: 999px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  margin-left: 6px;\n}\n\n.em-tag.core {\n  color: #f8fafc;\n  background: rgba(148, 163, 184, 0.2);\n}\n\n.em-status {\n  margin-top: 4px;\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.em-status.enabled {\n  color: #34d399;\n}\n\n.em-status.disabled {\n  color: #fbbf24;\n}\n\n.em-update-select {\n  width: 36px;\n  height: 34px;\n  padding: 0;\n  border-radius: 10px;\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  background: rgba(30, 41, 59, 0.7);\n  color: #e2e8f0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: 0.2s ease;\n}\n\n.em-update-select.selected {\n  background: rgba(34, 197, 94, 0.25);\n  border-color: rgba(34, 197, 94, 0.6);\n  color: #22c55e;\n}\n\n.em-toggle-switch {\n  position: relative;\n  width: 50px;\n  height: 26px;\n  border-radius: 999px;\n  border: 1px solid rgba(148, 163, 184, 0.35);\n  background: rgba(30, 41, 59, 0.7);\n  cursor: pointer;\n  transition: 0.2s ease;\n  box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.25);\n  padding: 0;\n  line-height: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: flex-start;\n  box-sizing: border-box;\n}\n\n.em-toggle-switch::after {\n  content: '';\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  width: 22px;\n  height: 22px;\n  border-radius: 50%;\n  background: #f8fafc;\n  transform: none;\n  transition: 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n}\n\n.em-toggle-switch.on {\n  background: linear-gradient(135deg, #34d399, #22c55e);\n  border-color: rgba(34, 197, 94, 0.6);\n}\n\n.em-toggle-switch.on::after {\n  left: calc(100% - 24px);\n}\n\n.em-toggle-switch:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.em-empty {\n  border-radius: 12px;\n  border: 1px dashed rgba(148, 163, 184, 0.3);\n  padding: 12px;\n  text-align: center;\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.7);\n  background: rgba(15, 23, 42, 0.6);\n}\n\n.em-loading {\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.7);\n}\n\n.em-confirm {\n  position: fixed;\n  inset: 0;\n  background: rgba(10, 12, 20, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n\n.em-confirm-card {\n  width: min(420px, 86vw);\n  background: rgba(15, 23, 42, 0.9);\n  border: 1px solid rgba(148, 163, 184, 0.3);\n  border-radius: 14px;\n  padding: 16px 18px;\n  color: #e2e8f0;\n  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);\n}\n\n.em-confirm-title {\n  font-size: 14px;\n  font-weight: 700;\n}\n\n.em-confirm-desc {\n  margin-top: 6px;\n  font-size: 12px;\n  color: rgba(226, 232, 240, 0.75);\n}\n\n.em-confirm-actions {\n  margin-top: 14px;\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n\n@media (max-width: 640px) {\n  .em-modal {\n    width: calc(var(--em-viewport-w, 100%) - 24px);\n    height: calc(var(--em-viewport-h, 100%) - 24px);\n    position: fixed;\n    inset: 12px;\n  }\n  .em-modal.dragged {\n    position: fixed;\n    left: auto;\n    top: auto;\n    right: auto;\n    bottom: auto;\n  }\n  .em-header {\n    flex-direction: row;\n    align-items: center;\n    padding: 12px 14px;\n  }\n  .em-title {\n    font-size: 14px;\n    letter-spacing: 0.5px;\n  }\n  .em-actions {\n    gap: 6px;\n  }\n  .em-dragbar {\n    display: none;\n  }\n  .em-toolbar {\n    gap: 6px;\n  }\n  .em-btn.icon-only {\n    width: 28px;\n    height: 28px;\n  }\n  .em-hint {\n    font-size: 10px;\n  }\n}\n\n@media (min-width: 900px) {\n  .em-list {\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n  }\n}\n\n@media (min-width: 1200px) {\n  .em-list {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n`;\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","import { buildEntries } from '../services/entries';\nimport { getContext } from '../services/tavern';\nimport { extensionManagerActions, extensionManagerState, setEntries, setLoading, setOpen } from '../state/store';\nimport { createPortalMount, destroyPortalMount, type PortalMount } from './portal.mount';\n\nexport type ExtensionManagerController = {\n  open: () => void;\n  close: () => void;\n  toggle: () => void;\n  refresh: () => Promise<void>;\n  destroy: () => void;\n};\n\nlet portal: PortalMount | null = null;\n\nfunction ensureMounted() {\n  if (!portal) {\n    portal = createPortalMount();\n  }\n}\n\nasync function refreshEntries() {\n  setLoading(true);\n  try {\n    const ctx = getContext();\n    const doc = window.parent?.document ?? document;\n    const entries = await buildEntries(doc, ctx);\n    setEntries(entries);\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function createExtensionManagerController(): ExtensionManagerController {\n  const controller: ExtensionManagerController = {\n    open: () => {\n      ensureMounted();\n      setOpen(true);\n      void refreshEntries();\n    },\n    close: () => {\n      setOpen(false);\n    },\n    toggle: () => {\n      ensureMounted();\n      const next = !extensionManagerState.open;\n      setOpen(next);\n      if (next) {\n        void refreshEntries();\n      }\n    },\n    refresh: async () => {\n      ensureMounted();\n      await refreshEntries();\n    },\n    destroy: () => {\n      if (portal) {\n        destroyPortalMount(portal);\n      }\n      portal = null;\n    },\n  };\n\n  extensionManagerActions.refresh = controller.refresh;\n  extensionManagerActions.close = controller.close;\n\n  return controller;\n}\n","import { registerEntryButtons } from './entry/buttons';\nimport { createExtensionManagerController } from './entry/portal';\n\nfunction init() {\n  const controller = createExtensionManagerController();\n  const cleanupEntries = registerEntryButtons(controller);\n\n  $(window).on('pagehide', () => {\n    cleanupEntries();\n    controller.destroy();\n  });\n}\n\n$(() => {\n  errorCatched(init)();\n});\n","import type { ExtensionManagerController } from './portal.controller';\n\ntype Cleanup = () => void;\n\nfunction buildButton(doc: Document): HTMLDivElement {\n  const btn = doc.createElement('div');\n  btn.setAttribute('data-em-launcher', '1');\n  btn.className = 'menu_button menu_button_icon interactable icon-only';\n  btn.title = '扩展管理';\n  btn.innerHTML = '<i class=\"fa-solid fa-puzzle-piece\"></i>';\n  return btn;\n}\n\nfunction ensureButton(doc: Document): HTMLDivElement | null {\n  const existing = doc.querySelector('[data-em-launcher=\"1\"]') as HTMLDivElement | null;\n  if (existing) {\n    const detailsBtn = doc.querySelector('#extensions_details') as HTMLDivElement | null;\n    if (detailsBtn && existing.previousElementSibling !== detailsBtn) {\n      detailsBtn.insertAdjacentElement('afterend', existing);\n    }\n    return existing;\n  }\n\n  const settings = doc.querySelector('#extensions_settings');\n  if (!settings) {\n    return null;\n  }\n\n  const detailsBtn = doc.querySelector('#extensions_details') as HTMLDivElement | null;\n  const targetRow = detailsBtn?.closest('.alignitemscenter.flex-container.wide100p');\n  const btn = buildButton(doc);\n\n  if (detailsBtn) {\n    detailsBtn.insertAdjacentElement('afterend', btn);\n    return btn;\n  }\n\n  if (targetRow) {\n    targetRow.appendChild(btn);\n    return btn;\n  }\n\n  const fallbackBar = doc.createElement('div');\n  fallbackBar.setAttribute('data-em-launcher-bar', '1');\n  fallbackBar.setAttribute(\n    'style',\n    [\n      'display:flex',\n      'justify-content:flex-end',\n      'gap:8px',\n      'padding:6px 0 10px',\n      'border-bottom:1px solid rgba(0,0,0,0.08)',\n      'margin-bottom:10px',\n    ].join(';'),\n  );\n  fallbackBar.appendChild(btn);\n  settings.prepend(fallbackBar);\n  return btn;\n}\n\nexport function registerEntryButtons(controller: ExtensionManagerController): Cleanup {\n  const doc = window.parent?.document ?? document;\n  let btn: HTMLDivElement | null = null;\n\n  const attach = () => {\n    btn = ensureButton(doc);\n    if (btn) {\n      btn.addEventListener('click', () => controller.open());\n      return true;\n    }\n    return false;\n  };\n\n  if (!attach()) {\n    const observer = new MutationObserver(() => attach());\n    observer.observe(doc.documentElement, { childList: true, subtree: true });\n    return () => {\n      observer.disconnect();\n      btn?.remove();\n    };\n  }\n\n  return () => {\n    btn?.remove();\n  };\n}\n"],"names":["getContext","window","parent","SillyTavern","getExtensionSettings","ctx","extensionSettings","getApi","getRequestHeadersSafe","headers","getRequestHeaders","getExtensionTypeSafe","name","api","getExtensionType","async","applyUpdateInfo","entries","getExtensionInstallationInfo","candidates","filter","entry","kind","results","Promise","all","map","info","type","canUpdate","isAdmin","status","is_up_to_date","update","Map","result","get","data","extensionName","global","response","fetch","method","body","JSON","stringify","ok","json","getExtensionVersionApi","isUpToDate","current_branch_name","currentBranchName","current_commit_hash","currentCommitHash","remote_url","remoteUrl","resolveDisplayNames","names","displayName","url","res","text","endsWith","parse","raw","display_name","title","fetchManifestName","buildEntries","doc","disabledThirdParty","disabledExtensions","item","startsWith","replace","Set","getDisabledThirdParty","enabledThirdParty","selector","join","querySelectorAll","forEach","el","match","getAttribute","add","Array","from","sort","a","b","localeCompare","scanThirdPartyFromDom","enabledCore","includes","scanCoreFromDom","thirdPartyNames","displayNames","has","Vue","extensionManagerState","reactive","open","loading","updateSelection","updating","extensionManagerActions","setOpen","value","setLoading","setFilter","setEntries","allowed","Object","keys","syncUpdateSelection","setUpdateSelected","setUpdating","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","key","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","__name","setup","__props","state","overlayRef","ref","modalRef","dragging","dragged","justDragged","dragOffset","x","y","position","deleteTarget","deleting","filteredEntries","computed","keyword","trim","toLowerCase","updateCandidates","updateCount","length","selectedUpdates","selectedCount","modalStyle","left","top","clampPosition","nextX","nextY","rect","getBoundingClientRect","win","maxX","innerWidth","width","maxY","innerHeight","height","Math","min","max","padding","onDragStart","event","matchMedia","matches","preventDefault","stopPropagation","clientX","clientY","pos","target","setPointerCapture","pointerId","setTimeout","onDragMove","onDragEnd","releasePointerCapture","onOverlayClick","currentTarget","close","refresh","reloadPage","location","reload","selectAllUpdates","clearUpdates","updateSelected","targets","updateExtension","failed","isGlobal","push","updateExtensions","cancelDelete","confirmDelete","uninstallExtension","deleteExtension","toggleEntry","nextDisabled","disabled","settings","list","delete","saveSettingsDebounced","saveSettings","setThirdPartyDisabled","syncOverlaySize","overlay","host","style","setProperty","watch","nextTick","onMounted","addEventListener","onUnmounted","removeEventListener","_ctx","_cache","ref_key","onClick","onPointerdown","placeholder","onInput","$event","selected","on","role","createPortalMount","$","attr","getScriptId","appendTo","mount","addClass","app","createApp","App","portal","ensureMounted","refreshEntries","document","init","controller","toggle","next","destroy","unmount","remove","destroyPortalMount","createExtensionManagerController","cleanupEntries","btn","attach","existing","querySelector","detailsBtn","previousElementSibling","insertAdjacentElement","targetRow","closest","createElement","setAttribute","className","innerHTML","buildButton","appendChild","fallbackBar","prepend","ensureButton","observer","MutationObserver","observe","documentElement","childList","subtree","disconnect","registerEntryButtons","errorCatched"],"sourceRoot":""}