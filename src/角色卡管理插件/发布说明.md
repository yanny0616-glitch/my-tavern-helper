# CardHub 角色卡管理器

一个用于 SillyTavern 的角色卡管理脚本，提供搜索、标签、导入导出、详情预览、聊天入口与自定义配色等功能。适用于需要快速整理角色卡的用户。

## 适用场景

- 想快速搜索角色名/标签并管理角色卡
- 想把卡片导入私有库，随时筛选并批量导出
- 想在卡片详情里查看开场白与最近聊天

## 功能概览

- 搜索：角色名 + 标签
- 筛选：已导入 / 未导入
- 收藏：一键收藏并在分类中快速筛选
- 排序：最近聊天 / 名称 / 标签数量 / 导入时间（首次看到时间）
- 标签管理：添加、移除、同步到酒馆标签
- 详情管理：头像、开场白、最近聊天入口
- 导入：支持 `png` / `json` 导入私有库
- 导出：单卡导出 + 批量导出（导出界面可筛选与勾选）
- 配色：支持自定义主题 + 预设主题（白天/夜晚等）
- 设置：私有库存储位置（变量 / IndexedDB）

## 使用说明（详细）

### 打开入口

1. 打开角色管理页面顶部入口，或左下角扩展菜单入口
2. 点击“角色卡管理器”

### 搜索与筛选

- 顶部搜索框：输入角色名或标签关键字
- 分类筛选：已导入 / 未导入
- 收藏筛选：在分类中点击“收藏”
- 标签筛选：点标签进行过滤
- 排序方式：最近聊天 / 名称 / 标签数量 / 导入时间

### 标签管理

- 卡片上点击标签可移除
- 点击 “+ 标签” 可添加
- 标签会同步到酒馆标签系统

### 单卡导出

- 在卡片上点“导出”
- 已导入卡导出为 `png`
- 私有库的 `json` / `png` 会按原格式导出

### 批量导出（推荐）

1. 点击“批量导出”
2. 在导出界面内**单独筛选**（搜索/已导入/标签）
3. 勾选要导出的卡片
4. 点击“导出已选”并确认

### 私有库导入

- 点“导入”选择 `png` 或 `json`
- 导入后进入“未导入”分类，可单卡导入到酒馆

### 配色设置

- 点击“配色”
- 修改颜色后会实时预览
- 点击“保存”写入全局，下次打开自动生效

## 数据存储说明

- 酒馆角色卡：直接读取 SillyTavern 角色列表
- 私有库：保存于全局变量 `cardhub_state`（内部的 `library`）或浏览器 IndexedDB
- 配色：`cardhub_state.theme`
- 收藏：`cardhub_state.favorites`
- 最近聊天缓存：`cardhub_state.lastChatCache`
- 导入时间缓存：`cardhub_state.importCache`
- 备注：`cardhub_state.notes`
- 私有库设置：`cardhub_state.storageSettings`

## 兼容性

- 需要酒馆助手脚本环境
- 支持桌面与手机端布局
- 手机端为单列布局，顶部工具栏固定

## 配色功能

- 支持自定义：背景渐变、面板底色、文本色、强调色、边框色
- 预设主题：可一键切换白天/夜晚等风格
- 保存为全局：下次打开自动生效

## 常见问题

**Q: 为什么配色没有生效？**
A: 请确认脚本已加载且界面已打开；配色修改会实时预览并全局保存。

**Q: 收藏在哪里看？**
A: 在左侧“分类”中点“收藏”即可只看收藏卡片。

**Q: 批量导出是导出全部吗？**
A: 不是。批量导出会进入导出界面，你可以筛选并勾选，确认后才导出。

**Q: 为什么最近聊天排序会反复变化？**
A: 首次排序会逐个扫描聊天简报并写入缓存，所以列表会动态重排；缓存建立后会稳定且变快。

**Q: 导入时间为什么没变化？**
A: 若酒馆未提供创建时间字段，会用“首次被 CardHub 看到的时间”作为导入时间并写入缓存。

**Q: 私有库和酒馆角色卡有什么区别？**
A: 私有库是脚本内保存的卡片集合，不会自动导入酒馆；需要手动导入。

## 更新日志

### 未发布

- 新增：导出界面内独立筛选与勾选
- 新增：配色界面与全局主题保存
- 优化：移动端布局与按钮视觉

### 待合并到版本模板

- 新增：收藏功能与排序（最近聊天/名称/标签数量/导入时间）
- 新增：批量标签（添加/移除）弹窗
- 新增：标签管理合并筛选与批量，私库详情显示导入文件名
- 优化：最近聊天排序缓存与刷新逻辑
- 优化：私库导入识别角色内名称，导入后同步标签
- 优化：删除角色后回主界面，避免跳转聊天
- 优化：手机端分类/排序布局与弹窗表现
- 优化：深色主题标签可读性
- 优化：移动端按钮与筛选卡片可点区域强化
- 优化：移动端筛选标签可横向滚动，避免顶部区域占用
- 优化：分页状态在移动端不再占用一行显示
- 优化：角色卡预览窗口移动端避免横向滚动，内容自动换行
- 修复：私库写入与刷新后丢失问题
- 修复：弹窗层级与关闭按钮定位异常

### 版本模板（可直接复制）

- 版本：x.y.z
- 新增：
- 优化：
- 修复：

## 版本更新

### 版本：v1.3（2026-01-22）(未发布)

- 新增：设置弹窗，支持私有库存储位置切换（变量 / IndexedDB）
- 新增：设置内提供私有库备份导出
- 新增：设置可调每页数量、列表备注摘要显示、默认导出格式
- 新增：设置可调标签默认行数（超过后滚动）
- 新增：设置头像大小与是否同步酒馆标签
- 新增：管理弹窗支持编辑角色卡字段（角色描述 / 创作者备注）
- 新增：重复筛选与重复卡边框标记（私有库/已导入重复）
- 优化：私有库可切换到 IndexedDB 减轻大体积卡顿（仅保存在本地浏览器内）
- 优化：世界书列表条目标题，蓝绿灯显示
- 优化：全局变量合并为 `cardhub_state`，减少变量列表噪音（自动迁移旧数据）
- 修复：部分主题/美化导致弹窗上移或被遮挡
- 修复：收藏/主题/缓存/备注的全局保存失效

### 版本：v1.2

- 新增（主）：开场白列表弹窗（分页+完整渲染）、世界书条目查看、角色备注（列表/详情）
- 新增（次）：开场白/世界书查看入口
- 优化（主）：弹窗居中与层级、移动端筛选区域与按钮视觉层级
- 修复（主）：小分辨率下弹窗遮挡与位置偏移

### 版本：v1.1（2026-01-21 15:18）

- 新增：收藏与排序、批量标签、标签管理合并筛选与批量、私库详情显示导入文件名
- 优化：最近聊天缓存、私库导入识别名称并同步标签、删除后回主界面、移动端布局
- 修复：私库刷新丢失、弹窗层级与关闭按钮定位
- 新增：私库自动读取角色卡自带标签
- 新增：私库标签编辑标记与回填
- 修复：自带标签导入/删除后不再刷新复活
